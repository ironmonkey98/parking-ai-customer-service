(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function r(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=r(i);fetch(i.href,o)}})();function S0(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var y0={exports:{}},ic={},E0={exports:{}},He={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ys=Symbol.for("react.element"),q1=Symbol.for("react.portal"),Y1=Symbol.for("react.fragment"),Q1=Symbol.for("react.strict_mode"),X1=Symbol.for("react.profiler"),Z1=Symbol.for("react.provider"),eS=Symbol.for("react.context"),tS=Symbol.for("react.forward_ref"),rS=Symbol.for("react.suspense"),nS=Symbol.for("react.memo"),iS=Symbol.for("react.lazy"),_h=Symbol.iterator;function oS(e){return e===null||typeof e!="object"?null:(e=_h&&e[_h]||e["@@iterator"],typeof e=="function"?e:null)}var R0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},b0=Object.assign,_0={};function ho(e,t,r){this.props=e,this.context=t,this.refs=_0,this.updater=r||R0}ho.prototype.isReactComponent={};ho.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};ho.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function T0(){}T0.prototype=ho.prototype;function zl(e,t,r){this.props=e,this.context=t,this.refs=_0,this.updater=r||R0}var $l=zl.prototype=new T0;$l.constructor=zl;b0($l,ho.prototype);$l.isPureReactComponent=!0;var Th=Array.isArray,C0=Object.prototype.hasOwnProperty,Kl={current:null},w0={key:!0,ref:!0,__self:!0,__source:!0};function A0(e,t,r){var n,i={},o=null,s=null;if(t!=null)for(n in t.ref!==void 0&&(s=t.ref),t.key!==void 0&&(o=""+t.key),t)C0.call(t,n)&&!w0.hasOwnProperty(n)&&(i[n]=t[n]);var a=arguments.length-2;if(a===1)i.children=r;else if(1<a){for(var c=Array(a),u=0;u<a;u++)c[u]=arguments[u+2];i.children=c}if(e&&e.defaultProps)for(n in a=e.defaultProps,a)i[n]===void 0&&(i[n]=a[n]);return{$$typeof:ys,type:e,key:o,ref:s,props:i,_owner:Kl.current}}function sS(e,t){return{$$typeof:ys,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Gl(e){return typeof e=="object"&&e!==null&&e.$$typeof===ys}function aS(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var Ch=/\/+/g;function xc(e,t){return typeof e=="object"&&e!==null&&e.key!=null?aS(""+e.key):t.toString(36)}function ta(e,t,r,n,i){var o=typeof e;(o==="undefined"||o==="boolean")&&(e=null);var s=!1;if(e===null)s=!0;else switch(o){case"string":case"number":s=!0;break;case"object":switch(e.$$typeof){case ys:case q1:s=!0}}if(s)return s=e,i=i(s),e=n===""?"."+xc(s,0):n,Th(i)?(r="",e!=null&&(r=e.replace(Ch,"$&/")+"/"),ta(i,t,r,"",function(u){return u})):i!=null&&(Gl(i)&&(i=sS(i,r+(!i.key||s&&s.key===i.key?"":(""+i.key).replace(Ch,"$&/")+"/")+e)),t.push(i)),1;if(s=0,n=n===""?".":n+":",Th(e))for(var a=0;a<e.length;a++){o=e[a];var c=n+xc(o,a);s+=ta(o,t,r,c,i)}else if(c=oS(e),typeof c=="function")for(e=c.call(e),a=0;!(o=e.next()).done;)o=o.value,c=n+xc(o,a++),s+=ta(o,t,r,c,i);else if(o==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return s}function Ps(e,t,r){if(e==null)return e;var n=[],i=0;return ta(e,n,"","",function(o){return t.call(r,o,i++)}),n}function cS(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var sr={current:null},ra={transition:null},uS={ReactCurrentDispatcher:sr,ReactCurrentBatchConfig:ra,ReactCurrentOwner:Kl};function k0(){throw Error("act(...) is not supported in production builds of React.")}He.Children={map:Ps,forEach:function(e,t,r){Ps(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return Ps(e,function(){t++}),t},toArray:function(e){return Ps(e,function(t){return t})||[]},only:function(e){if(!Gl(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};He.Component=ho;He.Fragment=Y1;He.Profiler=X1;He.PureComponent=zl;He.StrictMode=Q1;He.Suspense=rS;He.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=uS;He.act=k0;He.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=b0({},e.props),i=e.key,o=e.ref,s=e._owner;if(t!=null){if(t.ref!==void 0&&(o=t.ref,s=Kl.current),t.key!==void 0&&(i=""+t.key),e.type&&e.type.defaultProps)var a=e.type.defaultProps;for(c in t)C0.call(t,c)&&!w0.hasOwnProperty(c)&&(n[c]=t[c]===void 0&&a!==void 0?a[c]:t[c])}var c=arguments.length-2;if(c===1)n.children=r;else if(1<c){a=Array(c);for(var u=0;u<c;u++)a[u]=arguments[u+2];n.children=a}return{$$typeof:ys,type:e.type,key:i,ref:o,props:n,_owner:s}};He.createContext=function(e){return e={$$typeof:eS,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Z1,_context:e},e.Consumer=e};He.createElement=A0;He.createFactory=function(e){var t=A0.bind(null,e);return t.type=e,t};He.createRef=function(){return{current:null}};He.forwardRef=function(e){return{$$typeof:tS,render:e}};He.isValidElement=Gl;He.lazy=function(e){return{$$typeof:iS,_payload:{_status:-1,_result:e},_init:cS}};He.memo=function(e,t){return{$$typeof:nS,type:e,compare:t===void 0?null:t}};He.startTransition=function(e){var t=ra.transition;ra.transition={};try{e()}finally{ra.transition=t}};He.unstable_act=k0;He.useCallback=function(e,t){return sr.current.useCallback(e,t)};He.useContext=function(e){return sr.current.useContext(e)};He.useDebugValue=function(){};He.useDeferredValue=function(e){return sr.current.useDeferredValue(e)};He.useEffect=function(e,t){return sr.current.useEffect(e,t)};He.useId=function(){return sr.current.useId()};He.useImperativeHandle=function(e,t,r){return sr.current.useImperativeHandle(e,t,r)};He.useInsertionEffect=function(e,t){return sr.current.useInsertionEffect(e,t)};He.useLayoutEffect=function(e,t){return sr.current.useLayoutEffect(e,t)};He.useMemo=function(e,t){return sr.current.useMemo(e,t)};He.useReducer=function(e,t,r){return sr.current.useReducer(e,t,r)};He.useRef=function(e){return sr.current.useRef(e)};He.useState=function(e){return sr.current.useState(e)};He.useSyncExternalStore=function(e,t,r){return sr.current.useSyncExternalStore(e,t,r)};He.useTransition=function(){return sr.current.useTransition()};He.version="18.3.1";E0.exports=He;var et=E0.exports;const lS=S0(et);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dS=et,hS=Symbol.for("react.element"),pS=Symbol.for("react.fragment"),fS=Object.prototype.hasOwnProperty,mS=dS.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,gS={key:!0,ref:!0,__self:!0,__source:!0};function P0(e,t,r){var n,i={},o=null,s=null;r!==void 0&&(o=""+r),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(s=t.ref);for(n in t)fS.call(t,n)&&!gS.hasOwnProperty(n)&&(i[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)i[n]===void 0&&(i[n]=t[n]);return{$$typeof:hS,type:e,key:o,ref:s,props:i,_owner:mS.current}}ic.Fragment=pS;ic.jsx=P0;ic.jsxs=P0;y0.exports=ic;var Fe=y0.exports,Nu={},I0={exports:{}},kr={},O0={exports:{}},D0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(I,L){var W=I.length;I.push(L);e:for(;0<W;){var U=W-1>>>1,x=I[U];if(0<i(x,L))I[U]=L,I[W]=x,W=U;else break e}}function r(I){return I.length===0?null:I[0]}function n(I){if(I.length===0)return null;var L=I[0],W=I.pop();if(W!==L){I[0]=W;e:for(var U=0,x=I.length,V=x>>>1;U<V;){var j=2*(U+1)-1,H=I[j],z=j+1,K=I[z];if(0>i(H,W))z<x&&0>i(K,H)?(I[U]=K,I[z]=W,U=z):(I[U]=H,I[j]=W,U=j);else if(z<x&&0>i(K,W))I[U]=K,I[z]=W,U=z;else break e}}return L}function i(I,L){var W=I.sortIndex-L.sortIndex;return W!==0?W:I.id-L.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;e.unstable_now=function(){return o.now()}}else{var s=Date,a=s.now();e.unstable_now=function(){return s.now()-a}}var c=[],u=[],d=1,E=null,m=3,f=!1,y=!1,S=!1,l=typeof setTimeout=="function"?setTimeout:null,h=typeof clearTimeout=="function"?clearTimeout:null,p=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function v(I){for(var L=r(u);L!==null;){if(L.callback===null)n(u);else if(L.startTime<=I)n(u),L.sortIndex=L.expirationTime,t(c,L);else break;L=r(u)}}function g(I){if(S=!1,v(I),!y)if(r(c)!==null)y=!0,N(R);else{var L=r(u);L!==null&&P(g,L.startTime-I)}}function R(I,L){y=!1,S&&(S=!1,h(k),k=-1),f=!0;var W=m;try{for(v(L),E=r(c);E!==null&&(!(E.expirationTime>L)||I&&!b());){var U=E.callback;if(typeof U=="function"){E.callback=null,m=E.priorityLevel;var x=U(E.expirationTime<=L);L=e.unstable_now(),typeof x=="function"?E.callback=x:E===r(c)&&n(c),v(L)}else n(c);E=r(c)}if(E!==null)var V=!0;else{var j=r(u);j!==null&&P(g,j.startTime-L),V=!1}return V}finally{E=null,m=W,f=!1}}var _=!1,w=null,k=-1,O=5,C=-1;function b(){return!(e.unstable_now()-C<O)}function A(){if(w!==null){var I=e.unstable_now();C=I;var L=!0;try{L=w(!0,I)}finally{L?T():(_=!1,w=null)}}else _=!1}var T;if(typeof p=="function")T=function(){p(A)};else if(typeof MessageChannel<"u"){var M=new MessageChannel,D=M.port2;M.port1.onmessage=A,T=function(){D.postMessage(null)}}else T=function(){l(A,0)};function N(I){w=I,_||(_=!0,T())}function P(I,L){k=l(function(){I(e.unstable_now())},L)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(I){I.callback=null},e.unstable_continueExecution=function(){y||f||(y=!0,N(R))},e.unstable_forceFrameRate=function(I){0>I||125<I?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):O=0<I?Math.floor(1e3/I):5},e.unstable_getCurrentPriorityLevel=function(){return m},e.unstable_getFirstCallbackNode=function(){return r(c)},e.unstable_next=function(I){switch(m){case 1:case 2:case 3:var L=3;break;default:L=m}var W=m;m=L;try{return I()}finally{m=W}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(I,L){switch(I){case 1:case 2:case 3:case 4:case 5:break;default:I=3}var W=m;m=I;try{return L()}finally{m=W}},e.unstable_scheduleCallback=function(I,L,W){var U=e.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?U+W:U):W=U,I){case 1:var x=-1;break;case 2:x=250;break;case 5:x=1073741823;break;case 4:x=1e4;break;default:x=5e3}return x=W+x,I={id:d++,callback:L,priorityLevel:I,startTime:W,expirationTime:x,sortIndex:-1},W>U?(I.sortIndex=W,t(u,I),r(c)===null&&I===r(u)&&(S?(h(k),k=-1):S=!0,P(g,W-U))):(I.sortIndex=x,t(c,I),y||f||(y=!0,N(R))),I},e.unstable_shouldYield=b,e.unstable_wrapCallback=function(I){var L=m;return function(){var W=m;m=L;try{return I.apply(this,arguments)}finally{m=W}}}})(D0);O0.exports=D0;var vS=O0.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var SS=et,Ar=vS;function me(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var M0=new Set,Qo={};function Ci(e,t){eo(e,t),eo(e+"Capture",t)}function eo(e,t){for(Qo[e]=t,e=0;e<t.length;e++)M0.add(t[e])}var _n=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Lu=Object.prototype.hasOwnProperty,yS=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,wh={},Ah={};function ES(e){return Lu.call(Ah,e)?!0:Lu.call(wh,e)?!1:yS.test(e)?Ah[e]=!0:(wh[e]=!0,!1)}function RS(e,t,r,n){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function bS(e,t,r,n){if(t===null||typeof t>"u"||RS(e,t,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function ar(e,t,r,n,i,o,s){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=i,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=s}var Kt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Kt[e]=new ar(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Kt[t]=new ar(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Kt[e]=new ar(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Kt[e]=new ar(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Kt[e]=new ar(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Kt[e]=new ar(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Kt[e]=new ar(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Kt[e]=new ar(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Kt[e]=new ar(e,5,!1,e.toLowerCase(),null,!1,!1)});var Jl=/[\-:]([a-z])/g;function ql(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Jl,ql);Kt[t]=new ar(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Jl,ql);Kt[t]=new ar(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Jl,ql);Kt[t]=new ar(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Kt[e]=new ar(e,1,!1,e.toLowerCase(),null,!1,!1)});Kt.xlinkHref=new ar("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Kt[e]=new ar(e,1,!1,e.toLowerCase(),null,!0,!0)});function Yl(e,t,r,n){var i=Kt.hasOwnProperty(t)?Kt[t]:null;(i!==null?i.type!==0:n||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(bS(t,r,i,n)&&(r=null),n||i===null?ES(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):i.mustUseProperty?e[i.propertyName]=r===null?i.type===3?!1:"":r:(t=i.attributeName,n=i.attributeNamespace,r===null?e.removeAttribute(t):(i=i.type,r=i===3||i===4&&r===!0?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}var An=SS.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Is=Symbol.for("react.element"),Ni=Symbol.for("react.portal"),Li=Symbol.for("react.fragment"),Ql=Symbol.for("react.strict_mode"),xu=Symbol.for("react.profiler"),N0=Symbol.for("react.provider"),L0=Symbol.for("react.context"),Xl=Symbol.for("react.forward_ref"),Uu=Symbol.for("react.suspense"),Vu=Symbol.for("react.suspense_list"),Zl=Symbol.for("react.memo"),Dn=Symbol.for("react.lazy"),x0=Symbol.for("react.offscreen"),kh=Symbol.iterator;function So(e){return e===null||typeof e!="object"?null:(e=kh&&e[kh]||e["@@iterator"],typeof e=="function"?e:null)}var St=Object.assign,Uc;function Oo(e){if(Uc===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);Uc=t&&t[1]||""}return`
`+Uc+e}var Vc=!1;function Bc(e,t){if(!e||Vc)return"";Vc=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var n=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){n=u}e.call(t.prototype)}else{try{throw Error()}catch(u){n=u}e()}}catch(u){if(u&&n&&typeof u.stack=="string"){for(var i=u.stack.split(`
`),o=n.stack.split(`
`),s=i.length-1,a=o.length-1;1<=s&&0<=a&&i[s]!==o[a];)a--;for(;1<=s&&0<=a;s--,a--)if(i[s]!==o[a]){if(s!==1||a!==1)do if(s--,a--,0>a||i[s]!==o[a]){var c=`
`+i[s].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}while(1<=s&&0<=a);break}}}finally{Vc=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?Oo(e):""}function _S(e){switch(e.tag){case 5:return Oo(e.type);case 16:return Oo("Lazy");case 13:return Oo("Suspense");case 19:return Oo("SuspenseList");case 0:case 2:case 15:return e=Bc(e.type,!1),e;case 11:return e=Bc(e.type.render,!1),e;case 1:return e=Bc(e.type,!0),e;default:return""}}function Bu(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Li:return"Fragment";case Ni:return"Portal";case xu:return"Profiler";case Ql:return"StrictMode";case Uu:return"Suspense";case Vu:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case L0:return(e.displayName||"Context")+".Consumer";case N0:return(e._context.displayName||"Context")+".Provider";case Xl:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Zl:return t=e.displayName||null,t!==null?t:Bu(e.type)||"Memo";case Dn:t=e._payload,e=e._init;try{return Bu(e(t))}catch{}}return null}function TS(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Bu(t);case 8:return t===Ql?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Yn(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function U0(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function CS(e){var t=U0(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var i=r.get,o=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(s){n=""+s,o.call(this,s)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(s){n=""+s},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Os(e){e._valueTracker||(e._valueTracker=CS(e))}function V0(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=U0(e)?e.checked?"true":"false":e.value),e=n,e!==r?(t.setValue(e),!0):!1}function wa(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function ju(e,t){var r=t.checked;return St({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function Ph(e,t){var r=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;r=Yn(t.value!=null?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function B0(e,t){t=t.checked,t!=null&&Yl(e,"checked",t,!1)}function Fu(e,t){B0(e,t);var r=Yn(t.value),n=t.type;if(r!=null)n==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Hu(e,t.type,r):t.hasOwnProperty("defaultValue")&&Hu(e,t.type,Yn(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function Ih(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function Hu(e,t,r){(t!=="number"||wa(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var Do=Array.isArray;function Gi(e,t,r,n){if(e=e.options,t){t={};for(var i=0;i<r.length;i++)t["$"+r[i]]=!0;for(r=0;r<e.length;r++)i=t.hasOwnProperty("$"+e[r].value),e[r].selected!==i&&(e[r].selected=i),i&&n&&(e[r].defaultSelected=!0)}else{for(r=""+Yn(r),t=null,i=0;i<e.length;i++){if(e[i].value===r){e[i].selected=!0,n&&(e[i].defaultSelected=!0);return}t!==null||e[i].disabled||(t=e[i])}t!==null&&(t.selected=!0)}}function Wu(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(me(91));return St({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Oh(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(me(92));if(Do(r)){if(1<r.length)throw Error(me(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:Yn(r)}}function j0(e,t){var r=Yn(t.value),n=Yn(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),n!=null&&(e.defaultValue=""+n)}function Dh(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function F0(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function zu(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?F0(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Ds,H0=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,n,i){MSApp.execUnsafeLocalFunction(function(){return e(t,r,n,i)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Ds=Ds||document.createElement("div"),Ds.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Ds.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Xo(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var Bo={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},wS=["Webkit","ms","Moz","O"];Object.keys(Bo).forEach(function(e){wS.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Bo[t]=Bo[e]})});function W0(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||Bo.hasOwnProperty(e)&&Bo[e]?(""+t).trim():t+"px"}function z0(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var n=r.indexOf("--")===0,i=W0(r,t[r],n);r==="float"&&(r="cssFloat"),n?e.setProperty(r,i):e[r]=i}}var AS=St({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function $u(e,t){if(t){if(AS[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(me(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(me(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(me(61))}if(t.style!=null&&typeof t.style!="object")throw Error(me(62))}}function Ku(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Gu=null;function ed(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Ju=null,Ji=null,qi=null;function Mh(e){if(e=bs(e)){if(typeof Ju!="function")throw Error(me(280));var t=e.stateNode;t&&(t=uc(t),Ju(e.stateNode,e.type,t))}}function $0(e){Ji?qi?qi.push(e):qi=[e]:Ji=e}function K0(){if(Ji){var e=Ji,t=qi;if(qi=Ji=null,Mh(e),t)for(e=0;e<t.length;e++)Mh(t[e])}}function G0(e,t){return e(t)}function J0(){}var jc=!1;function q0(e,t,r){if(jc)return e(t,r);jc=!0;try{return G0(e,t,r)}finally{jc=!1,(Ji!==null||qi!==null)&&(J0(),K0())}}function Zo(e,t){var r=e.stateNode;if(r===null)return null;var n=uc(r);if(n===null)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(me(231,t,typeof r));return r}var qu=!1;if(_n)try{var yo={};Object.defineProperty(yo,"passive",{get:function(){qu=!0}}),window.addEventListener("test",yo,yo),window.removeEventListener("test",yo,yo)}catch{qu=!1}function kS(e,t,r,n,i,o,s,a,c){var u=Array.prototype.slice.call(arguments,3);try{t.apply(r,u)}catch(d){this.onError(d)}}var jo=!1,Aa=null,ka=!1,Yu=null,PS={onError:function(e){jo=!0,Aa=e}};function IS(e,t,r,n,i,o,s,a,c){jo=!1,Aa=null,kS.apply(PS,arguments)}function OS(e,t,r,n,i,o,s,a,c){if(IS.apply(this,arguments),jo){if(jo){var u=Aa;jo=!1,Aa=null}else throw Error(me(198));ka||(ka=!0,Yu=u)}}function wi(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function Y0(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function Nh(e){if(wi(e)!==e)throw Error(me(188))}function DS(e){var t=e.alternate;if(!t){if(t=wi(e),t===null)throw Error(me(188));return t!==e?null:e}for(var r=e,n=t;;){var i=r.return;if(i===null)break;var o=i.alternate;if(o===null){if(n=i.return,n!==null){r=n;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===r)return Nh(i),e;if(o===n)return Nh(i),t;o=o.sibling}throw Error(me(188))}if(r.return!==n.return)r=i,n=o;else{for(var s=!1,a=i.child;a;){if(a===r){s=!0,r=i,n=o;break}if(a===n){s=!0,n=i,r=o;break}a=a.sibling}if(!s){for(a=o.child;a;){if(a===r){s=!0,r=o,n=i;break}if(a===n){s=!0,n=o,r=i;break}a=a.sibling}if(!s)throw Error(me(189))}}if(r.alternate!==n)throw Error(me(190))}if(r.tag!==3)throw Error(me(188));return r.stateNode.current===r?e:t}function Q0(e){return e=DS(e),e!==null?X0(e):null}function X0(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=X0(e);if(t!==null)return t;e=e.sibling}return null}var Z0=Ar.unstable_scheduleCallback,Lh=Ar.unstable_cancelCallback,MS=Ar.unstable_shouldYield,NS=Ar.unstable_requestPaint,bt=Ar.unstable_now,LS=Ar.unstable_getCurrentPriorityLevel,td=Ar.unstable_ImmediatePriority,eg=Ar.unstable_UserBlockingPriority,Pa=Ar.unstable_NormalPriority,xS=Ar.unstable_LowPriority,tg=Ar.unstable_IdlePriority,oc=null,un=null;function US(e){if(un&&typeof un.onCommitFiberRoot=="function")try{un.onCommitFiberRoot(oc,e,void 0,(e.current.flags&128)===128)}catch{}}var Jr=Math.clz32?Math.clz32:jS,VS=Math.log,BS=Math.LN2;function jS(e){return e>>>=0,e===0?32:31-(VS(e)/BS|0)|0}var Ms=64,Ns=4194304;function Mo(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Ia(e,t){var r=e.pendingLanes;if(r===0)return 0;var n=0,i=e.suspendedLanes,o=e.pingedLanes,s=r&268435455;if(s!==0){var a=s&~i;a!==0?n=Mo(a):(o&=s,o!==0&&(n=Mo(o)))}else s=r&~i,s!==0?n=Mo(s):o!==0&&(n=Mo(o));if(n===0)return 0;if(t!==0&&t!==n&&!(t&i)&&(i=n&-n,o=t&-t,i>=o||i===16&&(o&4194240)!==0))return t;if(n&4&&(n|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)r=31-Jr(t),i=1<<r,n|=e[r],t&=~i;return n}function FS(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function HS(e,t){for(var r=e.suspendedLanes,n=e.pingedLanes,i=e.expirationTimes,o=e.pendingLanes;0<o;){var s=31-Jr(o),a=1<<s,c=i[s];c===-1?(!(a&r)||a&n)&&(i[s]=FS(a,t)):c<=t&&(e.expiredLanes|=a),o&=~a}}function Qu(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function rg(){var e=Ms;return Ms<<=1,!(Ms&4194240)&&(Ms=64),e}function Fc(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function Es(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Jr(t),e[t]=r}function WS(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<r;){var i=31-Jr(r),o=1<<i;t[i]=0,n[i]=-1,e[i]=-1,r&=~o}}function rd(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var n=31-Jr(r),i=1<<n;i&t|e[n]&t&&(e[n]|=t),r&=~i}}var it=0;function ng(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var ig,nd,og,sg,ag,Xu=!1,Ls=[],jn=null,Fn=null,Hn=null,es=new Map,ts=new Map,Nn=[],zS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function xh(e,t){switch(e){case"focusin":case"focusout":jn=null;break;case"dragenter":case"dragleave":Fn=null;break;case"mouseover":case"mouseout":Hn=null;break;case"pointerover":case"pointerout":es.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":ts.delete(t.pointerId)}}function Eo(e,t,r,n,i,o){return e===null||e.nativeEvent!==o?(e={blockedOn:t,domEventName:r,eventSystemFlags:n,nativeEvent:o,targetContainers:[i]},t!==null&&(t=bs(t),t!==null&&nd(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,i!==null&&t.indexOf(i)===-1&&t.push(i),e)}function $S(e,t,r,n,i){switch(t){case"focusin":return jn=Eo(jn,e,t,r,n,i),!0;case"dragenter":return Fn=Eo(Fn,e,t,r,n,i),!0;case"mouseover":return Hn=Eo(Hn,e,t,r,n,i),!0;case"pointerover":var o=i.pointerId;return es.set(o,Eo(es.get(o)||null,e,t,r,n,i)),!0;case"gotpointercapture":return o=i.pointerId,ts.set(o,Eo(ts.get(o)||null,e,t,r,n,i)),!0}return!1}function cg(e){var t=ui(e.target);if(t!==null){var r=wi(t);if(r!==null){if(t=r.tag,t===13){if(t=Y0(r),t!==null){e.blockedOn=t,ag(e.priority,function(){og(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function na(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=Zu(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var n=new r.constructor(r.type,r);Gu=n,r.target.dispatchEvent(n),Gu=null}else return t=bs(r),t!==null&&nd(t),e.blockedOn=r,!1;t.shift()}return!0}function Uh(e,t,r){na(e)&&r.delete(t)}function KS(){Xu=!1,jn!==null&&na(jn)&&(jn=null),Fn!==null&&na(Fn)&&(Fn=null),Hn!==null&&na(Hn)&&(Hn=null),es.forEach(Uh),ts.forEach(Uh)}function Ro(e,t){e.blockedOn===t&&(e.blockedOn=null,Xu||(Xu=!0,Ar.unstable_scheduleCallback(Ar.unstable_NormalPriority,KS)))}function rs(e){function t(i){return Ro(i,e)}if(0<Ls.length){Ro(Ls[0],e);for(var r=1;r<Ls.length;r++){var n=Ls[r];n.blockedOn===e&&(n.blockedOn=null)}}for(jn!==null&&Ro(jn,e),Fn!==null&&Ro(Fn,e),Hn!==null&&Ro(Hn,e),es.forEach(t),ts.forEach(t),r=0;r<Nn.length;r++)n=Nn[r],n.blockedOn===e&&(n.blockedOn=null);for(;0<Nn.length&&(r=Nn[0],r.blockedOn===null);)cg(r),r.blockedOn===null&&Nn.shift()}var Yi=An.ReactCurrentBatchConfig,Oa=!0;function GS(e,t,r,n){var i=it,o=Yi.transition;Yi.transition=null;try{it=1,id(e,t,r,n)}finally{it=i,Yi.transition=o}}function JS(e,t,r,n){var i=it,o=Yi.transition;Yi.transition=null;try{it=4,id(e,t,r,n)}finally{it=i,Yi.transition=o}}function id(e,t,r,n){if(Oa){var i=Zu(e,t,r,n);if(i===null)Qc(e,t,n,Da,r),xh(e,n);else if($S(i,e,t,r,n))n.stopPropagation();else if(xh(e,n),t&4&&-1<zS.indexOf(e)){for(;i!==null;){var o=bs(i);if(o!==null&&ig(o),o=Zu(e,t,r,n),o===null&&Qc(e,t,n,Da,r),o===i)break;i=o}i!==null&&n.stopPropagation()}else Qc(e,t,n,null,r)}}var Da=null;function Zu(e,t,r,n){if(Da=null,e=ed(n),e=ui(e),e!==null)if(t=wi(e),t===null)e=null;else if(r=t.tag,r===13){if(e=Y0(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Da=e,null}function ug(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(LS()){case td:return 1;case eg:return 4;case Pa:case xS:return 16;case tg:return 536870912;default:return 16}default:return 16}}var Un=null,od=null,ia=null;function lg(){if(ia)return ia;var e,t=od,r=t.length,n,i="value"in Un?Un.value:Un.textContent,o=i.length;for(e=0;e<r&&t[e]===i[e];e++);var s=r-e;for(n=1;n<=s&&t[r-n]===i[o-n];n++);return ia=i.slice(e,1<n?1-n:void 0)}function oa(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function xs(){return!0}function Vh(){return!1}function Pr(e){function t(r,n,i,o,s){this._reactName=r,this._targetInst=i,this.type=n,this.nativeEvent=o,this.target=s,this.currentTarget=null;for(var a in e)e.hasOwnProperty(a)&&(r=e[a],this[a]=r?r(o):o[a]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?xs:Vh,this.isPropagationStopped=Vh,this}return St(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=xs)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=xs)},persist:function(){},isPersistent:xs}),t}var po={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},sd=Pr(po),Rs=St({},po,{view:0,detail:0}),qS=Pr(Rs),Hc,Wc,bo,sc=St({},Rs,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ad,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==bo&&(bo&&e.type==="mousemove"?(Hc=e.screenX-bo.screenX,Wc=e.screenY-bo.screenY):Wc=Hc=0,bo=e),Hc)},movementY:function(e){return"movementY"in e?e.movementY:Wc}}),Bh=Pr(sc),YS=St({},sc,{dataTransfer:0}),QS=Pr(YS),XS=St({},Rs,{relatedTarget:0}),zc=Pr(XS),ZS=St({},po,{animationName:0,elapsedTime:0,pseudoElement:0}),ey=Pr(ZS),ty=St({},po,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),ry=Pr(ty),ny=St({},po,{data:0}),jh=Pr(ny),iy={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},oy={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},sy={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ay(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=sy[e])?!!t[e]:!1}function ad(){return ay}var cy=St({},Rs,{key:function(e){if(e.key){var t=iy[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=oa(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?oy[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ad,charCode:function(e){return e.type==="keypress"?oa(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?oa(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),uy=Pr(cy),ly=St({},sc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Fh=Pr(ly),dy=St({},Rs,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ad}),hy=Pr(dy),py=St({},po,{propertyName:0,elapsedTime:0,pseudoElement:0}),fy=Pr(py),my=St({},sc,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),gy=Pr(my),vy=[9,13,27,32],cd=_n&&"CompositionEvent"in window,Fo=null;_n&&"documentMode"in document&&(Fo=document.documentMode);var Sy=_n&&"TextEvent"in window&&!Fo,dg=_n&&(!cd||Fo&&8<Fo&&11>=Fo),Hh=String.fromCharCode(32),Wh=!1;function hg(e,t){switch(e){case"keyup":return vy.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function pg(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var xi=!1;function yy(e,t){switch(e){case"compositionend":return pg(t);case"keypress":return t.which!==32?null:(Wh=!0,Hh);case"textInput":return e=t.data,e===Hh&&Wh?null:e;default:return null}}function Ey(e,t){if(xi)return e==="compositionend"||!cd&&hg(e,t)?(e=lg(),ia=od=Un=null,xi=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return dg&&t.locale!=="ko"?null:t.data;default:return null}}var Ry={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function zh(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Ry[e.type]:t==="textarea"}function fg(e,t,r,n){$0(n),t=Ma(t,"onChange"),0<t.length&&(r=new sd("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var Ho=null,ns=null;function by(e){Cg(e,0)}function ac(e){var t=Bi(e);if(V0(t))return e}function _y(e,t){if(e==="change")return t}var mg=!1;if(_n){var $c;if(_n){var Kc="oninput"in document;if(!Kc){var $h=document.createElement("div");$h.setAttribute("oninput","return;"),Kc=typeof $h.oninput=="function"}$c=Kc}else $c=!1;mg=$c&&(!document.documentMode||9<document.documentMode)}function Kh(){Ho&&(Ho.detachEvent("onpropertychange",gg),ns=Ho=null)}function gg(e){if(e.propertyName==="value"&&ac(ns)){var t=[];fg(t,ns,e,ed(e)),q0(by,t)}}function Ty(e,t,r){e==="focusin"?(Kh(),Ho=t,ns=r,Ho.attachEvent("onpropertychange",gg)):e==="focusout"&&Kh()}function Cy(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return ac(ns)}function wy(e,t){if(e==="click")return ac(t)}function Ay(e,t){if(e==="input"||e==="change")return ac(t)}function ky(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Qr=typeof Object.is=="function"?Object.is:ky;function is(e,t){if(Qr(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var i=r[n];if(!Lu.call(t,i)||!Qr(e[i],t[i]))return!1}return!0}function Gh(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Jh(e,t){var r=Gh(e);e=0;for(var n;r;){if(r.nodeType===3){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=Gh(r)}}function vg(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?vg(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Sg(){for(var e=window,t=wa();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=wa(e.document)}return t}function ud(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Py(e){var t=Sg(),r=e.focusedElem,n=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&vg(r.ownerDocument.documentElement,r)){if(n!==null&&ud(r)){if(t=n.start,e=n.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var i=r.textContent.length,o=Math.min(n.start,i);n=n.end===void 0?o:Math.min(n.end,i),!e.extend&&o>n&&(i=n,n=o,o=i),i=Jh(r,o);var s=Jh(r,n);i&&s&&(e.rangeCount!==1||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==s.node||e.focusOffset!==s.offset)&&(t=t.createRange(),t.setStart(i.node,i.offset),e.removeAllRanges(),o>n?(e.addRange(t),e.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Iy=_n&&"documentMode"in document&&11>=document.documentMode,Ui=null,el=null,Wo=null,tl=!1;function qh(e,t,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;tl||Ui==null||Ui!==wa(n)||(n=Ui,"selectionStart"in n&&ud(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Wo&&is(Wo,n)||(Wo=n,n=Ma(el,"onSelect"),0<n.length&&(t=new sd("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=Ui)))}function Us(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var Vi={animationend:Us("Animation","AnimationEnd"),animationiteration:Us("Animation","AnimationIteration"),animationstart:Us("Animation","AnimationStart"),transitionend:Us("Transition","TransitionEnd")},Gc={},yg={};_n&&(yg=document.createElement("div").style,"AnimationEvent"in window||(delete Vi.animationend.animation,delete Vi.animationiteration.animation,delete Vi.animationstart.animation),"TransitionEvent"in window||delete Vi.transitionend.transition);function cc(e){if(Gc[e])return Gc[e];if(!Vi[e])return e;var t=Vi[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in yg)return Gc[e]=t[r];return e}var Eg=cc("animationend"),Rg=cc("animationiteration"),bg=cc("animationstart"),_g=cc("transitionend"),Tg=new Map,Yh="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Xn(e,t){Tg.set(e,t),Ci(t,[e])}for(var Jc=0;Jc<Yh.length;Jc++){var qc=Yh[Jc],Oy=qc.toLowerCase(),Dy=qc[0].toUpperCase()+qc.slice(1);Xn(Oy,"on"+Dy)}Xn(Eg,"onAnimationEnd");Xn(Rg,"onAnimationIteration");Xn(bg,"onAnimationStart");Xn("dblclick","onDoubleClick");Xn("focusin","onFocus");Xn("focusout","onBlur");Xn(_g,"onTransitionEnd");eo("onMouseEnter",["mouseout","mouseover"]);eo("onMouseLeave",["mouseout","mouseover"]);eo("onPointerEnter",["pointerout","pointerover"]);eo("onPointerLeave",["pointerout","pointerover"]);Ci("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ci("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ci("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ci("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ci("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ci("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var No="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),My=new Set("cancel close invalid load scroll toggle".split(" ").concat(No));function Qh(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,OS(n,t,void 0,e),e.currentTarget=null}function Cg(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var n=e[r],i=n.event;n=n.listeners;e:{var o=void 0;if(t)for(var s=n.length-1;0<=s;s--){var a=n[s],c=a.instance,u=a.currentTarget;if(a=a.listener,c!==o&&i.isPropagationStopped())break e;Qh(i,a,u),o=c}else for(s=0;s<n.length;s++){if(a=n[s],c=a.instance,u=a.currentTarget,a=a.listener,c!==o&&i.isPropagationStopped())break e;Qh(i,a,u),o=c}}}if(ka)throw e=Yu,ka=!1,Yu=null,e}function lt(e,t){var r=t[sl];r===void 0&&(r=t[sl]=new Set);var n=e+"__bubble";r.has(n)||(wg(t,e,2,!1),r.add(n))}function Yc(e,t,r){var n=0;t&&(n|=4),wg(r,e,n,t)}var Vs="_reactListening"+Math.random().toString(36).slice(2);function os(e){if(!e[Vs]){e[Vs]=!0,M0.forEach(function(r){r!=="selectionchange"&&(My.has(r)||Yc(r,!1,e),Yc(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Vs]||(t[Vs]=!0,Yc("selectionchange",!1,t))}}function wg(e,t,r,n){switch(ug(t)){case 1:var i=GS;break;case 4:i=JS;break;default:i=id}r=i.bind(null,t,r,e),i=void 0,!qu||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(i=!0),n?i!==void 0?e.addEventListener(t,r,{capture:!0,passive:i}):e.addEventListener(t,r,!0):i!==void 0?e.addEventListener(t,r,{passive:i}):e.addEventListener(t,r,!1)}function Qc(e,t,r,n,i){var o=n;if(!(t&1)&&!(t&2)&&n!==null)e:for(;;){if(n===null)return;var s=n.tag;if(s===3||s===4){var a=n.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(s===4)for(s=n.return;s!==null;){var c=s.tag;if((c===3||c===4)&&(c=s.stateNode.containerInfo,c===i||c.nodeType===8&&c.parentNode===i))return;s=s.return}for(;a!==null;){if(s=ui(a),s===null)return;if(c=s.tag,c===5||c===6){n=o=s;continue e}a=a.parentNode}}n=n.return}q0(function(){var u=o,d=ed(r),E=[];e:{var m=Tg.get(e);if(m!==void 0){var f=sd,y=e;switch(e){case"keypress":if(oa(r)===0)break e;case"keydown":case"keyup":f=uy;break;case"focusin":y="focus",f=zc;break;case"focusout":y="blur",f=zc;break;case"beforeblur":case"afterblur":f=zc;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=Bh;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=QS;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=hy;break;case Eg:case Rg:case bg:f=ey;break;case _g:f=fy;break;case"scroll":f=qS;break;case"wheel":f=gy;break;case"copy":case"cut":case"paste":f=ry;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=Fh}var S=(t&4)!==0,l=!S&&e==="scroll",h=S?m!==null?m+"Capture":null:m;S=[];for(var p=u,v;p!==null;){v=p;var g=v.stateNode;if(v.tag===5&&g!==null&&(v=g,h!==null&&(g=Zo(p,h),g!=null&&S.push(ss(p,g,v)))),l)break;p=p.return}0<S.length&&(m=new f(m,y,null,r,d),E.push({event:m,listeners:S}))}}if(!(t&7)){e:{if(m=e==="mouseover"||e==="pointerover",f=e==="mouseout"||e==="pointerout",m&&r!==Gu&&(y=r.relatedTarget||r.fromElement)&&(ui(y)||y[Tn]))break e;if((f||m)&&(m=d.window===d?d:(m=d.ownerDocument)?m.defaultView||m.parentWindow:window,f?(y=r.relatedTarget||r.toElement,f=u,y=y?ui(y):null,y!==null&&(l=wi(y),y!==l||y.tag!==5&&y.tag!==6)&&(y=null)):(f=null,y=u),f!==y)){if(S=Bh,g="onMouseLeave",h="onMouseEnter",p="mouse",(e==="pointerout"||e==="pointerover")&&(S=Fh,g="onPointerLeave",h="onPointerEnter",p="pointer"),l=f==null?m:Bi(f),v=y==null?m:Bi(y),m=new S(g,p+"leave",f,r,d),m.target=l,m.relatedTarget=v,g=null,ui(d)===u&&(S=new S(h,p+"enter",y,r,d),S.target=v,S.relatedTarget=l,g=S),l=g,f&&y)t:{for(S=f,h=y,p=0,v=S;v;v=Pi(v))p++;for(v=0,g=h;g;g=Pi(g))v++;for(;0<p-v;)S=Pi(S),p--;for(;0<v-p;)h=Pi(h),v--;for(;p--;){if(S===h||h!==null&&S===h.alternate)break t;S=Pi(S),h=Pi(h)}S=null}else S=null;f!==null&&Xh(E,m,f,S,!1),y!==null&&l!==null&&Xh(E,l,y,S,!0)}}e:{if(m=u?Bi(u):window,f=m.nodeName&&m.nodeName.toLowerCase(),f==="select"||f==="input"&&m.type==="file")var R=_y;else if(zh(m))if(mg)R=Ay;else{R=Cy;var _=Ty}else(f=m.nodeName)&&f.toLowerCase()==="input"&&(m.type==="checkbox"||m.type==="radio")&&(R=wy);if(R&&(R=R(e,u))){fg(E,R,r,d);break e}_&&_(e,m,u),e==="focusout"&&(_=m._wrapperState)&&_.controlled&&m.type==="number"&&Hu(m,"number",m.value)}switch(_=u?Bi(u):window,e){case"focusin":(zh(_)||_.contentEditable==="true")&&(Ui=_,el=u,Wo=null);break;case"focusout":Wo=el=Ui=null;break;case"mousedown":tl=!0;break;case"contextmenu":case"mouseup":case"dragend":tl=!1,qh(E,r,d);break;case"selectionchange":if(Iy)break;case"keydown":case"keyup":qh(E,r,d)}var w;if(cd)e:{switch(e){case"compositionstart":var k="onCompositionStart";break e;case"compositionend":k="onCompositionEnd";break e;case"compositionupdate":k="onCompositionUpdate";break e}k=void 0}else xi?hg(e,r)&&(k="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(k="onCompositionStart");k&&(dg&&r.locale!=="ko"&&(xi||k!=="onCompositionStart"?k==="onCompositionEnd"&&xi&&(w=lg()):(Un=d,od="value"in Un?Un.value:Un.textContent,xi=!0)),_=Ma(u,k),0<_.length&&(k=new jh(k,e,null,r,d),E.push({event:k,listeners:_}),w?k.data=w:(w=pg(r),w!==null&&(k.data=w)))),(w=Sy?yy(e,r):Ey(e,r))&&(u=Ma(u,"onBeforeInput"),0<u.length&&(d=new jh("onBeforeInput","beforeinput",null,r,d),E.push({event:d,listeners:u}),d.data=w))}Cg(E,t)})}function ss(e,t,r){return{instance:e,listener:t,currentTarget:r}}function Ma(e,t){for(var r=t+"Capture",n=[];e!==null;){var i=e,o=i.stateNode;i.tag===5&&o!==null&&(i=o,o=Zo(e,r),o!=null&&n.unshift(ss(e,o,i)),o=Zo(e,t),o!=null&&n.push(ss(e,o,i))),e=e.return}return n}function Pi(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function Xh(e,t,r,n,i){for(var o=t._reactName,s=[];r!==null&&r!==n;){var a=r,c=a.alternate,u=a.stateNode;if(c!==null&&c===n)break;a.tag===5&&u!==null&&(a=u,i?(c=Zo(r,o),c!=null&&s.unshift(ss(r,c,a))):i||(c=Zo(r,o),c!=null&&s.push(ss(r,c,a)))),r=r.return}s.length!==0&&e.push({event:t,listeners:s})}var Ny=/\r\n?/g,Ly=/\u0000|\uFFFD/g;function Zh(e){return(typeof e=="string"?e:""+e).replace(Ny,`
`).replace(Ly,"")}function Bs(e,t,r){if(t=Zh(t),Zh(e)!==t&&r)throw Error(me(425))}function Na(){}var rl=null,nl=null;function il(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var ol=typeof setTimeout=="function"?setTimeout:void 0,xy=typeof clearTimeout=="function"?clearTimeout:void 0,ep=typeof Promise=="function"?Promise:void 0,Uy=typeof queueMicrotask=="function"?queueMicrotask:typeof ep<"u"?function(e){return ep.resolve(null).then(e).catch(Vy)}:ol;function Vy(e){setTimeout(function(){throw e})}function Xc(e,t){var r=t,n=0;do{var i=r.nextSibling;if(e.removeChild(r),i&&i.nodeType===8)if(r=i.data,r==="/$"){if(n===0){e.removeChild(i),rs(t);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=i}while(r);rs(t)}function Wn(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function tp(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var fo=Math.random().toString(36).slice(2),sn="__reactFiber$"+fo,as="__reactProps$"+fo,Tn="__reactContainer$"+fo,sl="__reactEvents$"+fo,By="__reactListeners$"+fo,jy="__reactHandles$"+fo;function ui(e){var t=e[sn];if(t)return t;for(var r=e.parentNode;r;){if(t=r[Tn]||r[sn]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=tp(e);e!==null;){if(r=e[sn])return r;e=tp(e)}return t}e=r,r=e.parentNode}return null}function bs(e){return e=e[sn]||e[Tn],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Bi(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(me(33))}function uc(e){return e[as]||null}var al=[],ji=-1;function Zn(e){return{current:e}}function dt(e){0>ji||(e.current=al[ji],al[ji]=null,ji--)}function ut(e,t){ji++,al[ji]=e.current,e.current=t}var Qn={},er=Zn(Qn),pr=Zn(!1),vi=Qn;function to(e,t){var r=e.type.contextTypes;if(!r)return Qn;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var i={},o;for(o in r)i[o]=t[o];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function fr(e){return e=e.childContextTypes,e!=null}function La(){dt(pr),dt(er)}function rp(e,t,r){if(er.current!==Qn)throw Error(me(168));ut(er,t),ut(pr,r)}function Ag(e,t,r){var n=e.stateNode;if(t=t.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var i in n)if(!(i in t))throw Error(me(108,TS(e)||"Unknown",i));return St({},r,n)}function xa(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Qn,vi=er.current,ut(er,e),ut(pr,pr.current),!0}function np(e,t,r){var n=e.stateNode;if(!n)throw Error(me(169));r?(e=Ag(e,t,vi),n.__reactInternalMemoizedMergedChildContext=e,dt(pr),dt(er),ut(er,e)):dt(pr),ut(pr,r)}var mn=null,lc=!1,Zc=!1;function kg(e){mn===null?mn=[e]:mn.push(e)}function Fy(e){lc=!0,kg(e)}function ei(){if(!Zc&&mn!==null){Zc=!0;var e=0,t=it;try{var r=mn;for(it=1;e<r.length;e++){var n=r[e];do n=n(!0);while(n!==null)}mn=null,lc=!1}catch(i){throw mn!==null&&(mn=mn.slice(e+1)),Z0(td,ei),i}finally{it=t,Zc=!1}}return null}var Fi=[],Hi=0,Ua=null,Va=0,Mr=[],Nr=0,Si=null,yn=1,En="";function si(e,t){Fi[Hi++]=Va,Fi[Hi++]=Ua,Ua=e,Va=t}function Pg(e,t,r){Mr[Nr++]=yn,Mr[Nr++]=En,Mr[Nr++]=Si,Si=e;var n=yn;e=En;var i=32-Jr(n)-1;n&=~(1<<i),r+=1;var o=32-Jr(t)+i;if(30<o){var s=i-i%5;o=(n&(1<<s)-1).toString(32),n>>=s,i-=s,yn=1<<32-Jr(t)+i|r<<i|n,En=o+e}else yn=1<<o|r<<i|n,En=e}function ld(e){e.return!==null&&(si(e,1),Pg(e,1,0))}function dd(e){for(;e===Ua;)Ua=Fi[--Hi],Fi[Hi]=null,Va=Fi[--Hi],Fi[Hi]=null;for(;e===Si;)Si=Mr[--Nr],Mr[Nr]=null,En=Mr[--Nr],Mr[Nr]=null,yn=Mr[--Nr],Mr[Nr]=null}var wr=null,Cr=null,ft=!1,Gr=null;function Ig(e,t){var r=xr(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function ip(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,wr=e,Cr=Wn(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,wr=e,Cr=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=Si!==null?{id:yn,overflow:En}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=xr(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,wr=e,Cr=null,!0):!1;default:return!1}}function cl(e){return(e.mode&1)!==0&&(e.flags&128)===0}function ul(e){if(ft){var t=Cr;if(t){var r=t;if(!ip(e,t)){if(cl(e))throw Error(me(418));t=Wn(r.nextSibling);var n=wr;t&&ip(e,t)?Ig(n,r):(e.flags=e.flags&-4097|2,ft=!1,wr=e)}}else{if(cl(e))throw Error(me(418));e.flags=e.flags&-4097|2,ft=!1,wr=e}}}function op(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;wr=e}function js(e){if(e!==wr)return!1;if(!ft)return op(e),ft=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!il(e.type,e.memoizedProps)),t&&(t=Cr)){if(cl(e))throw Og(),Error(me(418));for(;t;)Ig(e,t),t=Wn(t.nextSibling)}if(op(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(me(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){Cr=Wn(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}Cr=null}}else Cr=wr?Wn(e.stateNode.nextSibling):null;return!0}function Og(){for(var e=Cr;e;)e=Wn(e.nextSibling)}function ro(){Cr=wr=null,ft=!1}function hd(e){Gr===null?Gr=[e]:Gr.push(e)}var Hy=An.ReactCurrentBatchConfig;function _o(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(me(309));var n=r.stateNode}if(!n)throw Error(me(147,e));var i=n,o=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===o?t.ref:(t=function(s){var a=i.refs;s===null?delete a[o]:a[o]=s},t._stringRef=o,t)}if(typeof e!="string")throw Error(me(284));if(!r._owner)throw Error(me(290,e))}return e}function Fs(e,t){throw e=Object.prototype.toString.call(t),Error(me(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function sp(e){var t=e._init;return t(e._payload)}function Dg(e){function t(h,p){if(e){var v=h.deletions;v===null?(h.deletions=[p],h.flags|=16):v.push(p)}}function r(h,p){if(!e)return null;for(;p!==null;)t(h,p),p=p.sibling;return null}function n(h,p){for(h=new Map;p!==null;)p.key!==null?h.set(p.key,p):h.set(p.index,p),p=p.sibling;return h}function i(h,p){return h=Gn(h,p),h.index=0,h.sibling=null,h}function o(h,p,v){return h.index=v,e?(v=h.alternate,v!==null?(v=v.index,v<p?(h.flags|=2,p):v):(h.flags|=2,p)):(h.flags|=1048576,p)}function s(h){return e&&h.alternate===null&&(h.flags|=2),h}function a(h,p,v,g){return p===null||p.tag!==6?(p=su(v,h.mode,g),p.return=h,p):(p=i(p,v),p.return=h,p)}function c(h,p,v,g){var R=v.type;return R===Li?d(h,p,v.props.children,g,v.key):p!==null&&(p.elementType===R||typeof R=="object"&&R!==null&&R.$$typeof===Dn&&sp(R)===p.type)?(g=i(p,v.props),g.ref=_o(h,p,v),g.return=h,g):(g=ha(v.type,v.key,v.props,null,h.mode,g),g.ref=_o(h,p,v),g.return=h,g)}function u(h,p,v,g){return p===null||p.tag!==4||p.stateNode.containerInfo!==v.containerInfo||p.stateNode.implementation!==v.implementation?(p=au(v,h.mode,g),p.return=h,p):(p=i(p,v.children||[]),p.return=h,p)}function d(h,p,v,g,R){return p===null||p.tag!==7?(p=fi(v,h.mode,g,R),p.return=h,p):(p=i(p,v),p.return=h,p)}function E(h,p,v){if(typeof p=="string"&&p!==""||typeof p=="number")return p=su(""+p,h.mode,v),p.return=h,p;if(typeof p=="object"&&p!==null){switch(p.$$typeof){case Is:return v=ha(p.type,p.key,p.props,null,h.mode,v),v.ref=_o(h,null,p),v.return=h,v;case Ni:return p=au(p,h.mode,v),p.return=h,p;case Dn:var g=p._init;return E(h,g(p._payload),v)}if(Do(p)||So(p))return p=fi(p,h.mode,v,null),p.return=h,p;Fs(h,p)}return null}function m(h,p,v,g){var R=p!==null?p.key:null;if(typeof v=="string"&&v!==""||typeof v=="number")return R!==null?null:a(h,p,""+v,g);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Is:return v.key===R?c(h,p,v,g):null;case Ni:return v.key===R?u(h,p,v,g):null;case Dn:return R=v._init,m(h,p,R(v._payload),g)}if(Do(v)||So(v))return R!==null?null:d(h,p,v,g,null);Fs(h,v)}return null}function f(h,p,v,g,R){if(typeof g=="string"&&g!==""||typeof g=="number")return h=h.get(v)||null,a(p,h,""+g,R);if(typeof g=="object"&&g!==null){switch(g.$$typeof){case Is:return h=h.get(g.key===null?v:g.key)||null,c(p,h,g,R);case Ni:return h=h.get(g.key===null?v:g.key)||null,u(p,h,g,R);case Dn:var _=g._init;return f(h,p,v,_(g._payload),R)}if(Do(g)||So(g))return h=h.get(v)||null,d(p,h,g,R,null);Fs(p,g)}return null}function y(h,p,v,g){for(var R=null,_=null,w=p,k=p=0,O=null;w!==null&&k<v.length;k++){w.index>k?(O=w,w=null):O=w.sibling;var C=m(h,w,v[k],g);if(C===null){w===null&&(w=O);break}e&&w&&C.alternate===null&&t(h,w),p=o(C,p,k),_===null?R=C:_.sibling=C,_=C,w=O}if(k===v.length)return r(h,w),ft&&si(h,k),R;if(w===null){for(;k<v.length;k++)w=E(h,v[k],g),w!==null&&(p=o(w,p,k),_===null?R=w:_.sibling=w,_=w);return ft&&si(h,k),R}for(w=n(h,w);k<v.length;k++)O=f(w,h,k,v[k],g),O!==null&&(e&&O.alternate!==null&&w.delete(O.key===null?k:O.key),p=o(O,p,k),_===null?R=O:_.sibling=O,_=O);return e&&w.forEach(function(b){return t(h,b)}),ft&&si(h,k),R}function S(h,p,v,g){var R=So(v);if(typeof R!="function")throw Error(me(150));if(v=R.call(v),v==null)throw Error(me(151));for(var _=R=null,w=p,k=p=0,O=null,C=v.next();w!==null&&!C.done;k++,C=v.next()){w.index>k?(O=w,w=null):O=w.sibling;var b=m(h,w,C.value,g);if(b===null){w===null&&(w=O);break}e&&w&&b.alternate===null&&t(h,w),p=o(b,p,k),_===null?R=b:_.sibling=b,_=b,w=O}if(C.done)return r(h,w),ft&&si(h,k),R;if(w===null){for(;!C.done;k++,C=v.next())C=E(h,C.value,g),C!==null&&(p=o(C,p,k),_===null?R=C:_.sibling=C,_=C);return ft&&si(h,k),R}for(w=n(h,w);!C.done;k++,C=v.next())C=f(w,h,k,C.value,g),C!==null&&(e&&C.alternate!==null&&w.delete(C.key===null?k:C.key),p=o(C,p,k),_===null?R=C:_.sibling=C,_=C);return e&&w.forEach(function(A){return t(h,A)}),ft&&si(h,k),R}function l(h,p,v,g){if(typeof v=="object"&&v!==null&&v.type===Li&&v.key===null&&(v=v.props.children),typeof v=="object"&&v!==null){switch(v.$$typeof){case Is:e:{for(var R=v.key,_=p;_!==null;){if(_.key===R){if(R=v.type,R===Li){if(_.tag===7){r(h,_.sibling),p=i(_,v.props.children),p.return=h,h=p;break e}}else if(_.elementType===R||typeof R=="object"&&R!==null&&R.$$typeof===Dn&&sp(R)===_.type){r(h,_.sibling),p=i(_,v.props),p.ref=_o(h,_,v),p.return=h,h=p;break e}r(h,_);break}else t(h,_);_=_.sibling}v.type===Li?(p=fi(v.props.children,h.mode,g,v.key),p.return=h,h=p):(g=ha(v.type,v.key,v.props,null,h.mode,g),g.ref=_o(h,p,v),g.return=h,h=g)}return s(h);case Ni:e:{for(_=v.key;p!==null;){if(p.key===_)if(p.tag===4&&p.stateNode.containerInfo===v.containerInfo&&p.stateNode.implementation===v.implementation){r(h,p.sibling),p=i(p,v.children||[]),p.return=h,h=p;break e}else{r(h,p);break}else t(h,p);p=p.sibling}p=au(v,h.mode,g),p.return=h,h=p}return s(h);case Dn:return _=v._init,l(h,p,_(v._payload),g)}if(Do(v))return y(h,p,v,g);if(So(v))return S(h,p,v,g);Fs(h,v)}return typeof v=="string"&&v!==""||typeof v=="number"?(v=""+v,p!==null&&p.tag===6?(r(h,p.sibling),p=i(p,v),p.return=h,h=p):(r(h,p),p=su(v,h.mode,g),p.return=h,h=p),s(h)):r(h,p)}return l}var no=Dg(!0),Mg=Dg(!1),Ba=Zn(null),ja=null,Wi=null,pd=null;function fd(){pd=Wi=ja=null}function md(e){var t=Ba.current;dt(Ba),e._currentValue=t}function ll(e,t,r){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===r)break;e=e.return}}function Qi(e,t){ja=e,pd=Wi=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(hr=!0),e.firstContext=null)}function Br(e){var t=e._currentValue;if(pd!==e)if(e={context:e,memoizedValue:t,next:null},Wi===null){if(ja===null)throw Error(me(308));Wi=e,ja.dependencies={lanes:0,firstContext:e}}else Wi=Wi.next=e;return t}var li=null;function gd(e){li===null?li=[e]:li.push(e)}function Ng(e,t,r,n){var i=t.interleaved;return i===null?(r.next=r,gd(t)):(r.next=i.next,i.next=r),t.interleaved=r,Cn(e,n)}function Cn(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var Mn=!1;function vd(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Lg(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Rn(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function zn(e,t,r){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,Je&2){var i=n.pending;return i===null?t.next=t:(t.next=i.next,i.next=t),n.pending=t,Cn(e,r)}return i=n.interleaved,i===null?(t.next=t,gd(n)):(t.next=i.next,i.next=t),n.interleaved=t,Cn(e,r)}function sa(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,rd(e,r)}}function ap(e,t){var r=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var i=null,o=null;if(r=r.firstBaseUpdate,r!==null){do{var s={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};o===null?i=o=s:o=o.next=s,r=r.next}while(r!==null);o===null?i=o=t:o=o.next=t}else i=o=t;r={baseState:n.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:n.shared,effects:n.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function Fa(e,t,r,n){var i=e.updateQueue;Mn=!1;var o=i.firstBaseUpdate,s=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var c=a,u=c.next;c.next=null,s===null?o=u:s.next=u,s=c;var d=e.alternate;d!==null&&(d=d.updateQueue,a=d.lastBaseUpdate,a!==s&&(a===null?d.firstBaseUpdate=u:a.next=u,d.lastBaseUpdate=c))}if(o!==null){var E=i.baseState;s=0,d=u=c=null,a=o;do{var m=a.lane,f=a.eventTime;if((n&m)===m){d!==null&&(d=d.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var y=e,S=a;switch(m=t,f=r,S.tag){case 1:if(y=S.payload,typeof y=="function"){E=y.call(f,E,m);break e}E=y;break e;case 3:y.flags=y.flags&-65537|128;case 0:if(y=S.payload,m=typeof y=="function"?y.call(f,E,m):y,m==null)break e;E=St({},E,m);break e;case 2:Mn=!0}}a.callback!==null&&a.lane!==0&&(e.flags|=64,m=i.effects,m===null?i.effects=[a]:m.push(a))}else f={eventTime:f,lane:m,tag:a.tag,payload:a.payload,callback:a.callback,next:null},d===null?(u=d=f,c=E):d=d.next=f,s|=m;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;m=a,a=m.next,m.next=null,i.lastBaseUpdate=m,i.shared.pending=null}}while(1);if(d===null&&(c=E),i.baseState=c,i.firstBaseUpdate=u,i.lastBaseUpdate=d,t=i.shared.interleaved,t!==null){i=t;do s|=i.lane,i=i.next;while(i!==t)}else o===null&&(i.shared.lanes=0);Ei|=s,e.lanes=s,e.memoizedState=E}}function cp(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],i=n.callback;if(i!==null){if(n.callback=null,n=r,typeof i!="function")throw Error(me(191,i));i.call(n)}}}var _s={},ln=Zn(_s),cs=Zn(_s),us=Zn(_s);function di(e){if(e===_s)throw Error(me(174));return e}function Sd(e,t){switch(ut(us,t),ut(cs,e),ut(ln,_s),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:zu(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=zu(t,e)}dt(ln),ut(ln,t)}function io(){dt(ln),dt(cs),dt(us)}function xg(e){di(us.current);var t=di(ln.current),r=zu(t,e.type);t!==r&&(ut(cs,e),ut(ln,r))}function yd(e){cs.current===e&&(dt(ln),dt(cs))}var gt=Zn(0);function Ha(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var eu=[];function Ed(){for(var e=0;e<eu.length;e++)eu[e]._workInProgressVersionPrimary=null;eu.length=0}var aa=An.ReactCurrentDispatcher,tu=An.ReactCurrentBatchConfig,yi=0,vt=null,Ot=null,Nt=null,Wa=!1,zo=!1,ls=0,Wy=0;function qt(){throw Error(me(321))}function Rd(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!Qr(e[r],t[r]))return!1;return!0}function bd(e,t,r,n,i,o){if(yi=o,vt=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,aa.current=e===null||e.memoizedState===null?Gy:Jy,e=r(n,i),zo){o=0;do{if(zo=!1,ls=0,25<=o)throw Error(me(301));o+=1,Nt=Ot=null,t.updateQueue=null,aa.current=qy,e=r(n,i)}while(zo)}if(aa.current=za,t=Ot!==null&&Ot.next!==null,yi=0,Nt=Ot=vt=null,Wa=!1,t)throw Error(me(300));return e}function _d(){var e=ls!==0;return ls=0,e}function rn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Nt===null?vt.memoizedState=Nt=e:Nt=Nt.next=e,Nt}function jr(){if(Ot===null){var e=vt.alternate;e=e!==null?e.memoizedState:null}else e=Ot.next;var t=Nt===null?vt.memoizedState:Nt.next;if(t!==null)Nt=t,Ot=e;else{if(e===null)throw Error(me(310));Ot=e,e={memoizedState:Ot.memoizedState,baseState:Ot.baseState,baseQueue:Ot.baseQueue,queue:Ot.queue,next:null},Nt===null?vt.memoizedState=Nt=e:Nt=Nt.next=e}return Nt}function ds(e,t){return typeof t=="function"?t(e):t}function ru(e){var t=jr(),r=t.queue;if(r===null)throw Error(me(311));r.lastRenderedReducer=e;var n=Ot,i=n.baseQueue,o=r.pending;if(o!==null){if(i!==null){var s=i.next;i.next=o.next,o.next=s}n.baseQueue=i=o,r.pending=null}if(i!==null){o=i.next,n=n.baseState;var a=s=null,c=null,u=o;do{var d=u.lane;if((yi&d)===d)c!==null&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),n=u.hasEagerState?u.eagerState:e(n,u.action);else{var E={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};c===null?(a=c=E,s=n):c=c.next=E,vt.lanes|=d,Ei|=d}u=u.next}while(u!==null&&u!==o);c===null?s=n:c.next=a,Qr(n,t.memoizedState)||(hr=!0),t.memoizedState=n,t.baseState=s,t.baseQueue=c,r.lastRenderedState=n}if(e=r.interleaved,e!==null){i=e;do o=i.lane,vt.lanes|=o,Ei|=o,i=i.next;while(i!==e)}else i===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function nu(e){var t=jr(),r=t.queue;if(r===null)throw Error(me(311));r.lastRenderedReducer=e;var n=r.dispatch,i=r.pending,o=t.memoizedState;if(i!==null){r.pending=null;var s=i=i.next;do o=e(o,s.action),s=s.next;while(s!==i);Qr(o,t.memoizedState)||(hr=!0),t.memoizedState=o,t.baseQueue===null&&(t.baseState=o),r.lastRenderedState=o}return[o,n]}function Ug(){}function Vg(e,t){var r=vt,n=jr(),i=t(),o=!Qr(n.memoizedState,i);if(o&&(n.memoizedState=i,hr=!0),n=n.queue,Td(Fg.bind(null,r,n,e),[e]),n.getSnapshot!==t||o||Nt!==null&&Nt.memoizedState.tag&1){if(r.flags|=2048,hs(9,jg.bind(null,r,n,i,t),void 0,null),xt===null)throw Error(me(349));yi&30||Bg(r,t,i)}return i}function Bg(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=vt.updateQueue,t===null?(t={lastEffect:null,stores:null},vt.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function jg(e,t,r,n){t.value=r,t.getSnapshot=n,Hg(t)&&Wg(e)}function Fg(e,t,r){return r(function(){Hg(t)&&Wg(e)})}function Hg(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!Qr(e,r)}catch{return!0}}function Wg(e){var t=Cn(e,1);t!==null&&qr(t,e,1,-1)}function up(e){var t=rn();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ds,lastRenderedState:e},t.queue=e,e=e.dispatch=Ky.bind(null,vt,e),[t.memoizedState,e]}function hs(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},t=vt.updateQueue,t===null?(t={lastEffect:null,stores:null},vt.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e)),e}function zg(){return jr().memoizedState}function ca(e,t,r,n){var i=rn();vt.flags|=e,i.memoizedState=hs(1|t,r,void 0,n===void 0?null:n)}function dc(e,t,r,n){var i=jr();n=n===void 0?null:n;var o=void 0;if(Ot!==null){var s=Ot.memoizedState;if(o=s.destroy,n!==null&&Rd(n,s.deps)){i.memoizedState=hs(t,r,o,n);return}}vt.flags|=e,i.memoizedState=hs(1|t,r,o,n)}function lp(e,t){return ca(8390656,8,e,t)}function Td(e,t){return dc(2048,8,e,t)}function $g(e,t){return dc(4,2,e,t)}function Kg(e,t){return dc(4,4,e,t)}function Gg(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Jg(e,t,r){return r=r!=null?r.concat([e]):null,dc(4,4,Gg.bind(null,t,e),r)}function Cd(){}function qg(e,t){var r=jr();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&Rd(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function Yg(e,t){var r=jr();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&Rd(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function Qg(e,t,r){return yi&21?(Qr(r,t)||(r=rg(),vt.lanes|=r,Ei|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,hr=!0),e.memoizedState=r)}function zy(e,t){var r=it;it=r!==0&&4>r?r:4,e(!0);var n=tu.transition;tu.transition={};try{e(!1),t()}finally{it=r,tu.transition=n}}function Xg(){return jr().memoizedState}function $y(e,t,r){var n=Kn(e);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},Zg(e))ev(t,r);else if(r=Ng(e,t,r,n),r!==null){var i=or();qr(r,e,n,i),tv(r,t,n)}}function Ky(e,t,r){var n=Kn(e),i={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(Zg(e))ev(t,i);else{var o=e.alternate;if(e.lanes===0&&(o===null||o.lanes===0)&&(o=t.lastRenderedReducer,o!==null))try{var s=t.lastRenderedState,a=o(s,r);if(i.hasEagerState=!0,i.eagerState=a,Qr(a,s)){var c=t.interleaved;c===null?(i.next=i,gd(t)):(i.next=c.next,c.next=i),t.interleaved=i;return}}catch{}finally{}r=Ng(e,t,i,n),r!==null&&(i=or(),qr(r,e,n,i),tv(r,t,n))}}function Zg(e){var t=e.alternate;return e===vt||t!==null&&t===vt}function ev(e,t){zo=Wa=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function tv(e,t,r){if(r&4194240){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,rd(e,r)}}var za={readContext:Br,useCallback:qt,useContext:qt,useEffect:qt,useImperativeHandle:qt,useInsertionEffect:qt,useLayoutEffect:qt,useMemo:qt,useReducer:qt,useRef:qt,useState:qt,useDebugValue:qt,useDeferredValue:qt,useTransition:qt,useMutableSource:qt,useSyncExternalStore:qt,useId:qt,unstable_isNewReconciler:!1},Gy={readContext:Br,useCallback:function(e,t){return rn().memoizedState=[e,t===void 0?null:t],e},useContext:Br,useEffect:lp,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,ca(4194308,4,Gg.bind(null,t,e),r)},useLayoutEffect:function(e,t){return ca(4194308,4,e,t)},useInsertionEffect:function(e,t){return ca(4,2,e,t)},useMemo:function(e,t){var r=rn();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=rn();return t=r!==void 0?r(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=$y.bind(null,vt,e),[n.memoizedState,e]},useRef:function(e){var t=rn();return e={current:e},t.memoizedState=e},useState:up,useDebugValue:Cd,useDeferredValue:function(e){return rn().memoizedState=e},useTransition:function(){var e=up(!1),t=e[0];return e=zy.bind(null,e[1]),rn().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var n=vt,i=rn();if(ft){if(r===void 0)throw Error(me(407));r=r()}else{if(r=t(),xt===null)throw Error(me(349));yi&30||Bg(n,t,r)}i.memoizedState=r;var o={value:r,getSnapshot:t};return i.queue=o,lp(Fg.bind(null,n,o,e),[e]),n.flags|=2048,hs(9,jg.bind(null,n,o,r,t),void 0,null),r},useId:function(){var e=rn(),t=xt.identifierPrefix;if(ft){var r=En,n=yn;r=(n&~(1<<32-Jr(n)-1)).toString(32)+r,t=":"+t+"R"+r,r=ls++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=Wy++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Jy={readContext:Br,useCallback:qg,useContext:Br,useEffect:Td,useImperativeHandle:Jg,useInsertionEffect:$g,useLayoutEffect:Kg,useMemo:Yg,useReducer:ru,useRef:zg,useState:function(){return ru(ds)},useDebugValue:Cd,useDeferredValue:function(e){var t=jr();return Qg(t,Ot.memoizedState,e)},useTransition:function(){var e=ru(ds)[0],t=jr().memoizedState;return[e,t]},useMutableSource:Ug,useSyncExternalStore:Vg,useId:Xg,unstable_isNewReconciler:!1},qy={readContext:Br,useCallback:qg,useContext:Br,useEffect:Td,useImperativeHandle:Jg,useInsertionEffect:$g,useLayoutEffect:Kg,useMemo:Yg,useReducer:nu,useRef:zg,useState:function(){return nu(ds)},useDebugValue:Cd,useDeferredValue:function(e){var t=jr();return Ot===null?t.memoizedState=e:Qg(t,Ot.memoizedState,e)},useTransition:function(){var e=nu(ds)[0],t=jr().memoizedState;return[e,t]},useMutableSource:Ug,useSyncExternalStore:Vg,useId:Xg,unstable_isNewReconciler:!1};function zr(e,t){if(e&&e.defaultProps){t=St({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}function dl(e,t,r,n){t=e.memoizedState,r=r(n,t),r=r==null?t:St({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var hc={isMounted:function(e){return(e=e._reactInternals)?wi(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=or(),i=Kn(e),o=Rn(n,i);o.payload=t,r!=null&&(o.callback=r),t=zn(e,o,i),t!==null&&(qr(t,e,i,n),sa(t,e,i))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=or(),i=Kn(e),o=Rn(n,i);o.tag=1,o.payload=t,r!=null&&(o.callback=r),t=zn(e,o,i),t!==null&&(qr(t,e,i,n),sa(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=or(),n=Kn(e),i=Rn(r,n);i.tag=2,t!=null&&(i.callback=t),t=zn(e,i,n),t!==null&&(qr(t,e,n,r),sa(t,e,n))}};function dp(e,t,r,n,i,o,s){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,o,s):t.prototype&&t.prototype.isPureReactComponent?!is(r,n)||!is(i,o):!0}function rv(e,t,r){var n=!1,i=Qn,o=t.contextType;return typeof o=="object"&&o!==null?o=Br(o):(i=fr(t)?vi:er.current,n=t.contextTypes,o=(n=n!=null)?to(e,i):Qn),t=new t(r,o),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=hc,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=o),t}function hp(e,t,r,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&hc.enqueueReplaceState(t,t.state,null)}function hl(e,t,r,n){var i=e.stateNode;i.props=r,i.state=e.memoizedState,i.refs={},vd(e);var o=t.contextType;typeof o=="object"&&o!==null?i.context=Br(o):(o=fr(t)?vi:er.current,i.context=to(e,o)),i.state=e.memoizedState,o=t.getDerivedStateFromProps,typeof o=="function"&&(dl(e,t,o,r),i.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(t=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),t!==i.state&&hc.enqueueReplaceState(i,i.state,null),Fa(e,r,i,n),i.state=e.memoizedState),typeof i.componentDidMount=="function"&&(e.flags|=4194308)}function oo(e,t){try{var r="",n=t;do r+=_S(n),n=n.return;while(n);var i=r}catch(o){i=`
Error generating stack: `+o.message+`
`+o.stack}return{value:e,source:t,stack:i,digest:null}}function iu(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function pl(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var Yy=typeof WeakMap=="function"?WeakMap:Map;function nv(e,t,r){r=Rn(-1,r),r.tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){Ka||(Ka=!0,_l=n),pl(e,t)},r}function iv(e,t,r){r=Rn(-1,r),r.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var i=t.value;r.payload=function(){return n(i)},r.callback=function(){pl(e,t)}}var o=e.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(r.callback=function(){pl(e,t),typeof n!="function"&&($n===null?$n=new Set([this]):$n.add(this));var s=t.stack;this.componentDidCatch(t.value,{componentStack:s!==null?s:""})}),r}function pp(e,t,r){var n=e.pingCache;if(n===null){n=e.pingCache=new Yy;var i=new Set;n.set(t,i)}else i=n.get(t),i===void 0&&(i=new Set,n.set(t,i));i.has(r)||(i.add(r),e=lE.bind(null,e,t,r),t.then(e,e))}function fp(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function mp(e,t,r,n,i){return e.mode&1?(e.flags|=65536,e.lanes=i,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=Rn(-1,1),t.tag=2,zn(r,t,1))),r.lanes|=1),e)}var Qy=An.ReactCurrentOwner,hr=!1;function nr(e,t,r,n){t.child=e===null?Mg(t,null,r,n):no(t,e.child,r,n)}function gp(e,t,r,n,i){r=r.render;var o=t.ref;return Qi(t,i),n=bd(e,t,r,n,o,i),r=_d(),e!==null&&!hr?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,wn(e,t,i)):(ft&&r&&ld(t),t.flags|=1,nr(e,t,n,i),t.child)}function vp(e,t,r,n,i){if(e===null){var o=r.type;return typeof o=="function"&&!Md(o)&&o.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=o,ov(e,t,o,n,i)):(e=ha(r.type,null,n,t,t.mode,i),e.ref=t.ref,e.return=t,t.child=e)}if(o=e.child,!(e.lanes&i)){var s=o.memoizedProps;if(r=r.compare,r=r!==null?r:is,r(s,n)&&e.ref===t.ref)return wn(e,t,i)}return t.flags|=1,e=Gn(o,n),e.ref=t.ref,e.return=t,t.child=e}function ov(e,t,r,n,i){if(e!==null){var o=e.memoizedProps;if(is(o,n)&&e.ref===t.ref)if(hr=!1,t.pendingProps=n=o,(e.lanes&i)!==0)e.flags&131072&&(hr=!0);else return t.lanes=e.lanes,wn(e,t,i)}return fl(e,t,r,n,i)}function sv(e,t,r){var n=t.pendingProps,i=n.children,o=e!==null?e.memoizedState:null;if(n.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},ut($i,_r),_r|=r;else{if(!(r&1073741824))return e=o!==null?o.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,ut($i,_r),_r|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=o!==null?o.baseLanes:r,ut($i,_r),_r|=n}else o!==null?(n=o.baseLanes|r,t.memoizedState=null):n=r,ut($i,_r),_r|=n;return nr(e,t,i,r),t.child}function av(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function fl(e,t,r,n,i){var o=fr(r)?vi:er.current;return o=to(t,o),Qi(t,i),r=bd(e,t,r,n,o,i),n=_d(),e!==null&&!hr?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,wn(e,t,i)):(ft&&n&&ld(t),t.flags|=1,nr(e,t,r,i),t.child)}function Sp(e,t,r,n,i){if(fr(r)){var o=!0;xa(t)}else o=!1;if(Qi(t,i),t.stateNode===null)ua(e,t),rv(t,r,n),hl(t,r,n,i),n=!0;else if(e===null){var s=t.stateNode,a=t.memoizedProps;s.props=a;var c=s.context,u=r.contextType;typeof u=="object"&&u!==null?u=Br(u):(u=fr(r)?vi:er.current,u=to(t,u));var d=r.getDerivedStateFromProps,E=typeof d=="function"||typeof s.getSnapshotBeforeUpdate=="function";E||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==n||c!==u)&&hp(t,s,n,u),Mn=!1;var m=t.memoizedState;s.state=m,Fa(t,n,s,i),c=t.memoizedState,a!==n||m!==c||pr.current||Mn?(typeof d=="function"&&(dl(t,r,d,n),c=t.memoizedState),(a=Mn||dp(t,r,a,n,m,c,u))?(E||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(t.flags|=4194308)):(typeof s.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=c),s.props=n,s.state=c,s.context=u,n=a):(typeof s.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{s=t.stateNode,Lg(e,t),a=t.memoizedProps,u=t.type===t.elementType?a:zr(t.type,a),s.props=u,E=t.pendingProps,m=s.context,c=r.contextType,typeof c=="object"&&c!==null?c=Br(c):(c=fr(r)?vi:er.current,c=to(t,c));var f=r.getDerivedStateFromProps;(d=typeof f=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==E||m!==c)&&hp(t,s,n,c),Mn=!1,m=t.memoizedState,s.state=m,Fa(t,n,s,i);var y=t.memoizedState;a!==E||m!==y||pr.current||Mn?(typeof f=="function"&&(dl(t,r,f,n),y=t.memoizedState),(u=Mn||dp(t,r,u,n,m,y,c)||!1)?(d||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(n,y,c),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(n,y,c)),typeof s.componentDidUpdate=="function"&&(t.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof s.componentDidUpdate!="function"||a===e.memoizedProps&&m===e.memoizedState||(t.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===e.memoizedProps&&m===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=y),s.props=n,s.state=y,s.context=c,n=u):(typeof s.componentDidUpdate!="function"||a===e.memoizedProps&&m===e.memoizedState||(t.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===e.memoizedProps&&m===e.memoizedState||(t.flags|=1024),n=!1)}return ml(e,t,r,n,o,i)}function ml(e,t,r,n,i,o){av(e,t);var s=(t.flags&128)!==0;if(!n&&!s)return i&&np(t,r,!1),wn(e,t,o);n=t.stateNode,Qy.current=t;var a=s&&typeof r.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&s?(t.child=no(t,e.child,null,o),t.child=no(t,null,a,o)):nr(e,t,a,o),t.memoizedState=n.state,i&&np(t,r,!0),t.child}function cv(e){var t=e.stateNode;t.pendingContext?rp(e,t.pendingContext,t.pendingContext!==t.context):t.context&&rp(e,t.context,!1),Sd(e,t.containerInfo)}function yp(e,t,r,n,i){return ro(),hd(i),t.flags|=256,nr(e,t,r,n),t.child}var gl={dehydrated:null,treeContext:null,retryLane:0};function vl(e){return{baseLanes:e,cachePool:null,transitions:null}}function uv(e,t,r){var n=t.pendingProps,i=gt.current,o=!1,s=(t.flags&128)!==0,a;if((a=s)||(a=e!==null&&e.memoizedState===null?!1:(i&2)!==0),a?(o=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(i|=1),ut(gt,i&1),e===null)return ul(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(s=n.children,e=n.fallback,o?(n=t.mode,o=t.child,s={mode:"hidden",children:s},!(n&1)&&o!==null?(o.childLanes=0,o.pendingProps=s):o=mc(s,n,0,null),e=fi(e,n,r,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=vl(r),t.memoizedState=gl,e):wd(t,s));if(i=e.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return Xy(e,t,s,n,a,i,r);if(o){o=n.fallback,s=t.mode,i=e.child,a=i.sibling;var c={mode:"hidden",children:n.children};return!(s&1)&&t.child!==i?(n=t.child,n.childLanes=0,n.pendingProps=c,t.deletions=null):(n=Gn(i,c),n.subtreeFlags=i.subtreeFlags&14680064),a!==null?o=Gn(a,o):(o=fi(o,s,r,null),o.flags|=2),o.return=t,n.return=t,n.sibling=o,t.child=n,n=o,o=t.child,s=e.child.memoizedState,s=s===null?vl(r):{baseLanes:s.baseLanes|r,cachePool:null,transitions:s.transitions},o.memoizedState=s,o.childLanes=e.childLanes&~r,t.memoizedState=gl,n}return o=e.child,e=o.sibling,n=Gn(o,{mode:"visible",children:n.children}),!(t.mode&1)&&(n.lanes=r),n.return=t,n.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n}function wd(e,t){return t=mc({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Hs(e,t,r,n){return n!==null&&hd(n),no(t,e.child,null,r),e=wd(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Xy(e,t,r,n,i,o,s){if(r)return t.flags&256?(t.flags&=-257,n=iu(Error(me(422))),Hs(e,t,s,n)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(o=n.fallback,i=t.mode,n=mc({mode:"visible",children:n.children},i,0,null),o=fi(o,i,s,null),o.flags|=2,n.return=t,o.return=t,n.sibling=o,t.child=n,t.mode&1&&no(t,e.child,null,s),t.child.memoizedState=vl(s),t.memoizedState=gl,o);if(!(t.mode&1))return Hs(e,t,s,null);if(i.data==="$!"){if(n=i.nextSibling&&i.nextSibling.dataset,n)var a=n.dgst;return n=a,o=Error(me(419)),n=iu(o,n,void 0),Hs(e,t,s,n)}if(a=(s&e.childLanes)!==0,hr||a){if(n=xt,n!==null){switch(s&-s){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(n.suspendedLanes|s)?0:i,i!==0&&i!==o.retryLane&&(o.retryLane=i,Cn(e,i),qr(n,e,i,-1))}return Dd(),n=iu(Error(me(421))),Hs(e,t,s,n)}return i.data==="$?"?(t.flags|=128,t.child=e.child,t=dE.bind(null,e),i._reactRetry=t,null):(e=o.treeContext,Cr=Wn(i.nextSibling),wr=t,ft=!0,Gr=null,e!==null&&(Mr[Nr++]=yn,Mr[Nr++]=En,Mr[Nr++]=Si,yn=e.id,En=e.overflow,Si=t),t=wd(t,n.children),t.flags|=4096,t)}function Ep(e,t,r){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),ll(e.return,t,r)}function ou(e,t,r,n,i){var o=e.memoizedState;o===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:i}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=n,o.tail=r,o.tailMode=i)}function lv(e,t,r){var n=t.pendingProps,i=n.revealOrder,o=n.tail;if(nr(e,t,n.children,r),n=gt.current,n&2)n=n&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Ep(e,r,t);else if(e.tag===19)Ep(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(ut(gt,n),!(t.mode&1))t.memoizedState=null;else switch(i){case"forwards":for(r=t.child,i=null;r!==null;)e=r.alternate,e!==null&&Ha(e)===null&&(i=r),r=r.sibling;r=i,r===null?(i=t.child,t.child=null):(i=r.sibling,r.sibling=null),ou(t,!1,i,r,o);break;case"backwards":for(r=null,i=t.child,t.child=null;i!==null;){if(e=i.alternate,e!==null&&Ha(e)===null){t.child=i;break}e=i.sibling,i.sibling=r,r=i,i=e}ou(t,!0,r,null,o);break;case"together":ou(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function ua(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function wn(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),Ei|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(me(153));if(t.child!==null){for(e=t.child,r=Gn(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=Gn(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function Zy(e,t,r){switch(t.tag){case 3:cv(t),ro();break;case 5:xg(t);break;case 1:fr(t.type)&&xa(t);break;case 4:Sd(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,i=t.memoizedProps.value;ut(Ba,n._currentValue),n._currentValue=i;break;case 13:if(n=t.memoizedState,n!==null)return n.dehydrated!==null?(ut(gt,gt.current&1),t.flags|=128,null):r&t.child.childLanes?uv(e,t,r):(ut(gt,gt.current&1),e=wn(e,t,r),e!==null?e.sibling:null);ut(gt,gt.current&1);break;case 19:if(n=(r&t.childLanes)!==0,e.flags&128){if(n)return lv(e,t,r);t.flags|=128}if(i=t.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),ut(gt,gt.current),n)break;return null;case 22:case 23:return t.lanes=0,sv(e,t,r)}return wn(e,t,r)}var dv,Sl,hv,pv;dv=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};Sl=function(){};hv=function(e,t,r,n){var i=e.memoizedProps;if(i!==n){e=t.stateNode,di(ln.current);var o=null;switch(r){case"input":i=ju(e,i),n=ju(e,n),o=[];break;case"select":i=St({},i,{value:void 0}),n=St({},n,{value:void 0}),o=[];break;case"textarea":i=Wu(e,i),n=Wu(e,n),o=[];break;default:typeof i.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=Na)}$u(r,n);var s;r=null;for(u in i)if(!n.hasOwnProperty(u)&&i.hasOwnProperty(u)&&i[u]!=null)if(u==="style"){var a=i[u];for(s in a)a.hasOwnProperty(s)&&(r||(r={}),r[s]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Qo.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in n){var c=n[u];if(a=i!=null?i[u]:void 0,n.hasOwnProperty(u)&&c!==a&&(c!=null||a!=null))if(u==="style")if(a){for(s in a)!a.hasOwnProperty(s)||c&&c.hasOwnProperty(s)||(r||(r={}),r[s]="");for(s in c)c.hasOwnProperty(s)&&a[s]!==c[s]&&(r||(r={}),r[s]=c[s])}else r||(o||(o=[]),o.push(u,r)),r=c;else u==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(o=o||[]).push(u,c)):u==="children"?typeof c!="string"&&typeof c!="number"||(o=o||[]).push(u,""+c):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Qo.hasOwnProperty(u)?(c!=null&&u==="onScroll"&&lt("scroll",e),o||a===c||(o=[])):(o=o||[]).push(u,c))}r&&(o=o||[]).push("style",r);var u=o;(t.updateQueue=u)&&(t.flags|=4)}};pv=function(e,t,r,n){r!==n&&(t.flags|=4)};function To(e,t){if(!ft)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function Yt(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,n=0;if(t)for(var i=e.child;i!==null;)r|=i.lanes|i.childLanes,n|=i.subtreeFlags&14680064,n|=i.flags&14680064,i.return=e,i=i.sibling;else for(i=e.child;i!==null;)r|=i.lanes|i.childLanes,n|=i.subtreeFlags,n|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=n,e.childLanes=r,t}function eE(e,t,r){var n=t.pendingProps;switch(dd(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Yt(t),null;case 1:return fr(t.type)&&La(),Yt(t),null;case 3:return n=t.stateNode,io(),dt(pr),dt(er),Ed(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(js(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Gr!==null&&(wl(Gr),Gr=null))),Sl(e,t),Yt(t),null;case 5:yd(t);var i=di(us.current);if(r=t.type,e!==null&&t.stateNode!=null)hv(e,t,r,n,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(t.stateNode===null)throw Error(me(166));return Yt(t),null}if(e=di(ln.current),js(t)){n=t.stateNode,r=t.type;var o=t.memoizedProps;switch(n[sn]=t,n[as]=o,e=(t.mode&1)!==0,r){case"dialog":lt("cancel",n),lt("close",n);break;case"iframe":case"object":case"embed":lt("load",n);break;case"video":case"audio":for(i=0;i<No.length;i++)lt(No[i],n);break;case"source":lt("error",n);break;case"img":case"image":case"link":lt("error",n),lt("load",n);break;case"details":lt("toggle",n);break;case"input":Ph(n,o),lt("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!o.multiple},lt("invalid",n);break;case"textarea":Oh(n,o),lt("invalid",n)}$u(r,o),i=null;for(var s in o)if(o.hasOwnProperty(s)){var a=o[s];s==="children"?typeof a=="string"?n.textContent!==a&&(o.suppressHydrationWarning!==!0&&Bs(n.textContent,a,e),i=["children",a]):typeof a=="number"&&n.textContent!==""+a&&(o.suppressHydrationWarning!==!0&&Bs(n.textContent,a,e),i=["children",""+a]):Qo.hasOwnProperty(s)&&a!=null&&s==="onScroll"&&lt("scroll",n)}switch(r){case"input":Os(n),Ih(n,o,!0);break;case"textarea":Os(n),Dh(n);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(n.onclick=Na)}n=i,t.updateQueue=n,n!==null&&(t.flags|=4)}else{s=i.nodeType===9?i:i.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=F0(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=s.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=s.createElement(r,{is:n.is}):(e=s.createElement(r),r==="select"&&(s=e,n.multiple?s.multiple=!0:n.size&&(s.size=n.size))):e=s.createElementNS(e,r),e[sn]=t,e[as]=n,dv(e,t,!1,!1),t.stateNode=e;e:{switch(s=Ku(r,n),r){case"dialog":lt("cancel",e),lt("close",e),i=n;break;case"iframe":case"object":case"embed":lt("load",e),i=n;break;case"video":case"audio":for(i=0;i<No.length;i++)lt(No[i],e);i=n;break;case"source":lt("error",e),i=n;break;case"img":case"image":case"link":lt("error",e),lt("load",e),i=n;break;case"details":lt("toggle",e),i=n;break;case"input":Ph(e,n),i=ju(e,n),lt("invalid",e);break;case"option":i=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},i=St({},n,{value:void 0}),lt("invalid",e);break;case"textarea":Oh(e,n),i=Wu(e,n),lt("invalid",e);break;default:i=n}$u(r,i),a=i;for(o in a)if(a.hasOwnProperty(o)){var c=a[o];o==="style"?z0(e,c):o==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&H0(e,c)):o==="children"?typeof c=="string"?(r!=="textarea"||c!=="")&&Xo(e,c):typeof c=="number"&&Xo(e,""+c):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(Qo.hasOwnProperty(o)?c!=null&&o==="onScroll"&&lt("scroll",e):c!=null&&Yl(e,o,c,s))}switch(r){case"input":Os(e),Ih(e,n,!1);break;case"textarea":Os(e),Dh(e);break;case"option":n.value!=null&&e.setAttribute("value",""+Yn(n.value));break;case"select":e.multiple=!!n.multiple,o=n.value,o!=null?Gi(e,!!n.multiple,o,!1):n.defaultValue!=null&&Gi(e,!!n.multiple,n.defaultValue,!0);break;default:typeof i.onClick=="function"&&(e.onclick=Na)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Yt(t),null;case 6:if(e&&t.stateNode!=null)pv(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(me(166));if(r=di(us.current),di(ln.current),js(t)){if(n=t.stateNode,r=t.memoizedProps,n[sn]=t,(o=n.nodeValue!==r)&&(e=wr,e!==null))switch(e.tag){case 3:Bs(n.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Bs(n.nodeValue,r,(e.mode&1)!==0)}o&&(t.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[sn]=t,t.stateNode=n}return Yt(t),null;case 13:if(dt(gt),n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(ft&&Cr!==null&&t.mode&1&&!(t.flags&128))Og(),ro(),t.flags|=98560,o=!1;else if(o=js(t),n!==null&&n.dehydrated!==null){if(e===null){if(!o)throw Error(me(318));if(o=t.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(me(317));o[sn]=t}else ro(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Yt(t),o=!1}else Gr!==null&&(wl(Gr),Gr=null),o=!0;if(!o)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(n=n!==null,n!==(e!==null&&e.memoizedState!==null)&&n&&(t.child.flags|=8192,t.mode&1&&(e===null||gt.current&1?Mt===0&&(Mt=3):Dd())),t.updateQueue!==null&&(t.flags|=4),Yt(t),null);case 4:return io(),Sl(e,t),e===null&&os(t.stateNode.containerInfo),Yt(t),null;case 10:return md(t.type._context),Yt(t),null;case 17:return fr(t.type)&&La(),Yt(t),null;case 19:if(dt(gt),o=t.memoizedState,o===null)return Yt(t),null;if(n=(t.flags&128)!==0,s=o.rendering,s===null)if(n)To(o,!1);else{if(Mt!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(s=Ha(e),s!==null){for(t.flags|=128,To(o,!1),n=s.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=r,r=t.child;r!==null;)o=r,e=n,o.flags&=14680066,s=o.alternate,s===null?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=s.childLanes,o.lanes=s.lanes,o.child=s.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=s.memoizedProps,o.memoizedState=s.memoizedState,o.updateQueue=s.updateQueue,o.type=s.type,e=s.dependencies,o.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return ut(gt,gt.current&1|2),t.child}e=e.sibling}o.tail!==null&&bt()>so&&(t.flags|=128,n=!0,To(o,!1),t.lanes=4194304)}else{if(!n)if(e=Ha(s),e!==null){if(t.flags|=128,n=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),To(o,!0),o.tail===null&&o.tailMode==="hidden"&&!s.alternate&&!ft)return Yt(t),null}else 2*bt()-o.renderingStartTime>so&&r!==1073741824&&(t.flags|=128,n=!0,To(o,!1),t.lanes=4194304);o.isBackwards?(s.sibling=t.child,t.child=s):(r=o.last,r!==null?r.sibling=s:t.child=s,o.last=s)}return o.tail!==null?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=bt(),t.sibling=null,r=gt.current,ut(gt,n?r&1|2:r&1),t):(Yt(t),null);case 22:case 23:return Od(),n=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==n&&(t.flags|=8192),n&&t.mode&1?_r&1073741824&&(Yt(t),t.subtreeFlags&6&&(t.flags|=8192)):Yt(t),null;case 24:return null;case 25:return null}throw Error(me(156,t.tag))}function tE(e,t){switch(dd(t),t.tag){case 1:return fr(t.type)&&La(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return io(),dt(pr),dt(er),Ed(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return yd(t),null;case 13:if(dt(gt),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(me(340));ro()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return dt(gt),null;case 4:return io(),null;case 10:return md(t.type._context),null;case 22:case 23:return Od(),null;case 24:return null;default:return null}}var Ws=!1,Xt=!1,rE=typeof WeakSet=="function"?WeakSet:Set,we=null;function zi(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){yt(e,t,n)}else r.current=null}function yl(e,t,r){try{r()}catch(n){yt(e,t,n)}}var Rp=!1;function nE(e,t){if(rl=Oa,e=Sg(),ud(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var i=n.anchorOffset,o=n.focusNode;n=n.focusOffset;try{r.nodeType,o.nodeType}catch{r=null;break e}var s=0,a=-1,c=-1,u=0,d=0,E=e,m=null;t:for(;;){for(var f;E!==r||i!==0&&E.nodeType!==3||(a=s+i),E!==o||n!==0&&E.nodeType!==3||(c=s+n),E.nodeType===3&&(s+=E.nodeValue.length),(f=E.firstChild)!==null;)m=E,E=f;for(;;){if(E===e)break t;if(m===r&&++u===i&&(a=s),m===o&&++d===n&&(c=s),(f=E.nextSibling)!==null)break;E=m,m=E.parentNode}E=f}r=a===-1||c===-1?null:{start:a,end:c}}else r=null}r=r||{start:0,end:0}}else r=null;for(nl={focusedElem:e,selectionRange:r},Oa=!1,we=t;we!==null;)if(t=we,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,we=e;else for(;we!==null;){t=we;try{var y=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(y!==null){var S=y.memoizedProps,l=y.memoizedState,h=t.stateNode,p=h.getSnapshotBeforeUpdate(t.elementType===t.type?S:zr(t.type,S),l);h.__reactInternalSnapshotBeforeUpdate=p}break;case 3:var v=t.stateNode.containerInfo;v.nodeType===1?v.textContent="":v.nodeType===9&&v.documentElement&&v.removeChild(v.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(me(163))}}catch(g){yt(t,t.return,g)}if(e=t.sibling,e!==null){e.return=t.return,we=e;break}we=t.return}return y=Rp,Rp=!1,y}function $o(e,t,r){var n=t.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var i=n=n.next;do{if((i.tag&e)===e){var o=i.destroy;i.destroy=void 0,o!==void 0&&yl(t,r,o)}i=i.next}while(i!==n)}}function pc(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var n=r.create;r.destroy=n()}r=r.next}while(r!==t)}}function El(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function fv(e){var t=e.alternate;t!==null&&(e.alternate=null,fv(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[sn],delete t[as],delete t[sl],delete t[By],delete t[jy])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function mv(e){return e.tag===5||e.tag===3||e.tag===4}function bp(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||mv(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Rl(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=Na));else if(n!==4&&(e=e.child,e!==null))for(Rl(e,t,r),e=e.sibling;e!==null;)Rl(e,t,r),e=e.sibling}function bl(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(bl(e,t,r),e=e.sibling;e!==null;)bl(e,t,r),e=e.sibling}var zt=null,$r=!1;function Pn(e,t,r){for(r=r.child;r!==null;)gv(e,t,r),r=r.sibling}function gv(e,t,r){if(un&&typeof un.onCommitFiberUnmount=="function")try{un.onCommitFiberUnmount(oc,r)}catch{}switch(r.tag){case 5:Xt||zi(r,t);case 6:var n=zt,i=$r;zt=null,Pn(e,t,r),zt=n,$r=i,zt!==null&&($r?(e=zt,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):zt.removeChild(r.stateNode));break;case 18:zt!==null&&($r?(e=zt,r=r.stateNode,e.nodeType===8?Xc(e.parentNode,r):e.nodeType===1&&Xc(e,r),rs(e)):Xc(zt,r.stateNode));break;case 4:n=zt,i=$r,zt=r.stateNode.containerInfo,$r=!0,Pn(e,t,r),zt=n,$r=i;break;case 0:case 11:case 14:case 15:if(!Xt&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){i=n=n.next;do{var o=i,s=o.destroy;o=o.tag,s!==void 0&&(o&2||o&4)&&yl(r,t,s),i=i.next}while(i!==n)}Pn(e,t,r);break;case 1:if(!Xt&&(zi(r,t),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(a){yt(r,t,a)}Pn(e,t,r);break;case 21:Pn(e,t,r);break;case 22:r.mode&1?(Xt=(n=Xt)||r.memoizedState!==null,Pn(e,t,r),Xt=n):Pn(e,t,r);break;default:Pn(e,t,r)}}function _p(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new rE),t.forEach(function(n){var i=hE.bind(null,e,n);r.has(n)||(r.add(n),n.then(i,i))})}}function Hr(e,t){var r=t.deletions;if(r!==null)for(var n=0;n<r.length;n++){var i=r[n];try{var o=e,s=t,a=s;e:for(;a!==null;){switch(a.tag){case 5:zt=a.stateNode,$r=!1;break e;case 3:zt=a.stateNode.containerInfo,$r=!0;break e;case 4:zt=a.stateNode.containerInfo,$r=!0;break e}a=a.return}if(zt===null)throw Error(me(160));gv(o,s,i),zt=null,$r=!1;var c=i.alternate;c!==null&&(c.return=null),i.return=null}catch(u){yt(i,t,u)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)vv(t,e),t=t.sibling}function vv(e,t){var r=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Hr(t,e),en(e),n&4){try{$o(3,e,e.return),pc(3,e)}catch(S){yt(e,e.return,S)}try{$o(5,e,e.return)}catch(S){yt(e,e.return,S)}}break;case 1:Hr(t,e),en(e),n&512&&r!==null&&zi(r,r.return);break;case 5:if(Hr(t,e),en(e),n&512&&r!==null&&zi(r,r.return),e.flags&32){var i=e.stateNode;try{Xo(i,"")}catch(S){yt(e,e.return,S)}}if(n&4&&(i=e.stateNode,i!=null)){var o=e.memoizedProps,s=r!==null?r.memoizedProps:o,a=e.type,c=e.updateQueue;if(e.updateQueue=null,c!==null)try{a==="input"&&o.type==="radio"&&o.name!=null&&B0(i,o),Ku(a,s);var u=Ku(a,o);for(s=0;s<c.length;s+=2){var d=c[s],E=c[s+1];d==="style"?z0(i,E):d==="dangerouslySetInnerHTML"?H0(i,E):d==="children"?Xo(i,E):Yl(i,d,E,u)}switch(a){case"input":Fu(i,o);break;case"textarea":j0(i,o);break;case"select":var m=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var f=o.value;f!=null?Gi(i,!!o.multiple,f,!1):m!==!!o.multiple&&(o.defaultValue!=null?Gi(i,!!o.multiple,o.defaultValue,!0):Gi(i,!!o.multiple,o.multiple?[]:"",!1))}i[as]=o}catch(S){yt(e,e.return,S)}}break;case 6:if(Hr(t,e),en(e),n&4){if(e.stateNode===null)throw Error(me(162));i=e.stateNode,o=e.memoizedProps;try{i.nodeValue=o}catch(S){yt(e,e.return,S)}}break;case 3:if(Hr(t,e),en(e),n&4&&r!==null&&r.memoizedState.isDehydrated)try{rs(t.containerInfo)}catch(S){yt(e,e.return,S)}break;case 4:Hr(t,e),en(e);break;case 13:Hr(t,e),en(e),i=e.child,i.flags&8192&&(o=i.memoizedState!==null,i.stateNode.isHidden=o,!o||i.alternate!==null&&i.alternate.memoizedState!==null||(Pd=bt())),n&4&&_p(e);break;case 22:if(d=r!==null&&r.memoizedState!==null,e.mode&1?(Xt=(u=Xt)||d,Hr(t,e),Xt=u):Hr(t,e),en(e),n&8192){if(u=e.memoizedState!==null,(e.stateNode.isHidden=u)&&!d&&e.mode&1)for(we=e,d=e.child;d!==null;){for(E=we=d;we!==null;){switch(m=we,f=m.child,m.tag){case 0:case 11:case 14:case 15:$o(4,m,m.return);break;case 1:zi(m,m.return);var y=m.stateNode;if(typeof y.componentWillUnmount=="function"){n=m,r=m.return;try{t=n,y.props=t.memoizedProps,y.state=t.memoizedState,y.componentWillUnmount()}catch(S){yt(n,r,S)}}break;case 5:zi(m,m.return);break;case 22:if(m.memoizedState!==null){Cp(E);continue}}f!==null?(f.return=m,we=f):Cp(E)}d=d.sibling}e:for(d=null,E=e;;){if(E.tag===5){if(d===null){d=E;try{i=E.stateNode,u?(o=i.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(a=E.stateNode,c=E.memoizedProps.style,s=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=W0("display",s))}catch(S){yt(e,e.return,S)}}}else if(E.tag===6){if(d===null)try{E.stateNode.nodeValue=u?"":E.memoizedProps}catch(S){yt(e,e.return,S)}}else if((E.tag!==22&&E.tag!==23||E.memoizedState===null||E===e)&&E.child!==null){E.child.return=E,E=E.child;continue}if(E===e)break e;for(;E.sibling===null;){if(E.return===null||E.return===e)break e;d===E&&(d=null),E=E.return}d===E&&(d=null),E.sibling.return=E.return,E=E.sibling}}break;case 19:Hr(t,e),en(e),n&4&&_p(e);break;case 21:break;default:Hr(t,e),en(e)}}function en(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(mv(r)){var n=r;break e}r=r.return}throw Error(me(160))}switch(n.tag){case 5:var i=n.stateNode;n.flags&32&&(Xo(i,""),n.flags&=-33);var o=bp(e);bl(e,o,i);break;case 3:case 4:var s=n.stateNode.containerInfo,a=bp(e);Rl(e,a,s);break;default:throw Error(me(161))}}catch(c){yt(e,e.return,c)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function iE(e,t,r){we=e,Sv(e)}function Sv(e,t,r){for(var n=(e.mode&1)!==0;we!==null;){var i=we,o=i.child;if(i.tag===22&&n){var s=i.memoizedState!==null||Ws;if(!s){var a=i.alternate,c=a!==null&&a.memoizedState!==null||Xt;a=Ws;var u=Xt;if(Ws=s,(Xt=c)&&!u)for(we=i;we!==null;)s=we,c=s.child,s.tag===22&&s.memoizedState!==null?wp(i):c!==null?(c.return=s,we=c):wp(i);for(;o!==null;)we=o,Sv(o),o=o.sibling;we=i,Ws=a,Xt=u}Tp(e)}else i.subtreeFlags&8772&&o!==null?(o.return=i,we=o):Tp(e)}}function Tp(e){for(;we!==null;){var t=we;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Xt||pc(5,t);break;case 1:var n=t.stateNode;if(t.flags&4&&!Xt)if(r===null)n.componentDidMount();else{var i=t.elementType===t.type?r.memoizedProps:zr(t.type,r.memoizedProps);n.componentDidUpdate(i,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;o!==null&&cp(t,o,n);break;case 3:var s=t.updateQueue;if(s!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}cp(t,s,r)}break;case 5:var a=t.stateNode;if(r===null&&t.flags&4){r=a;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&r.focus();break;case"img":c.src&&(r.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var u=t.alternate;if(u!==null){var d=u.memoizedState;if(d!==null){var E=d.dehydrated;E!==null&&rs(E)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(me(163))}Xt||t.flags&512&&El(t)}catch(m){yt(t,t.return,m)}}if(t===e){we=null;break}if(r=t.sibling,r!==null){r.return=t.return,we=r;break}we=t.return}}function Cp(e){for(;we!==null;){var t=we;if(t===e){we=null;break}var r=t.sibling;if(r!==null){r.return=t.return,we=r;break}we=t.return}}function wp(e){for(;we!==null;){var t=we;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{pc(4,t)}catch(c){yt(t,r,c)}break;case 1:var n=t.stateNode;if(typeof n.componentDidMount=="function"){var i=t.return;try{n.componentDidMount()}catch(c){yt(t,i,c)}}var o=t.return;try{El(t)}catch(c){yt(t,o,c)}break;case 5:var s=t.return;try{El(t)}catch(c){yt(t,s,c)}}}catch(c){yt(t,t.return,c)}if(t===e){we=null;break}var a=t.sibling;if(a!==null){a.return=t.return,we=a;break}we=t.return}}var oE=Math.ceil,$a=An.ReactCurrentDispatcher,Ad=An.ReactCurrentOwner,Vr=An.ReactCurrentBatchConfig,Je=0,xt=null,wt=null,$t=0,_r=0,$i=Zn(0),Mt=0,ps=null,Ei=0,fc=0,kd=0,Ko=null,dr=null,Pd=0,so=1/0,fn=null,Ka=!1,_l=null,$n=null,zs=!1,Vn=null,Ga=0,Go=0,Tl=null,la=-1,da=0;function or(){return Je&6?bt():la!==-1?la:la=bt()}function Kn(e){return e.mode&1?Je&2&&$t!==0?$t&-$t:Hy.transition!==null?(da===0&&(da=rg()),da):(e=it,e!==0||(e=window.event,e=e===void 0?16:ug(e.type)),e):1}function qr(e,t,r,n){if(50<Go)throw Go=0,Tl=null,Error(me(185));Es(e,r,n),(!(Je&2)||e!==xt)&&(e===xt&&(!(Je&2)&&(fc|=r),Mt===4&&Ln(e,$t)),mr(e,n),r===1&&Je===0&&!(t.mode&1)&&(so=bt()+500,lc&&ei()))}function mr(e,t){var r=e.callbackNode;HS(e,t);var n=Ia(e,e===xt?$t:0);if(n===0)r!==null&&Lh(r),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(r!=null&&Lh(r),t===1)e.tag===0?Fy(Ap.bind(null,e)):kg(Ap.bind(null,e)),Uy(function(){!(Je&6)&&ei()}),r=null;else{switch(ng(n)){case 1:r=td;break;case 4:r=eg;break;case 16:r=Pa;break;case 536870912:r=tg;break;default:r=Pa}r=wv(r,yv.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function yv(e,t){if(la=-1,da=0,Je&6)throw Error(me(327));var r=e.callbackNode;if(Xi()&&e.callbackNode!==r)return null;var n=Ia(e,e===xt?$t:0);if(n===0)return null;if(n&30||n&e.expiredLanes||t)t=Ja(e,n);else{t=n;var i=Je;Je|=2;var o=Rv();(xt!==e||$t!==t)&&(fn=null,so=bt()+500,pi(e,t));do try{cE();break}catch(a){Ev(e,a)}while(1);fd(),$a.current=o,Je=i,wt!==null?t=0:(xt=null,$t=0,t=Mt)}if(t!==0){if(t===2&&(i=Qu(e),i!==0&&(n=i,t=Cl(e,i))),t===1)throw r=ps,pi(e,0),Ln(e,n),mr(e,bt()),r;if(t===6)Ln(e,n);else{if(i=e.current.alternate,!(n&30)&&!sE(i)&&(t=Ja(e,n),t===2&&(o=Qu(e),o!==0&&(n=o,t=Cl(e,o))),t===1))throw r=ps,pi(e,0),Ln(e,n),mr(e,bt()),r;switch(e.finishedWork=i,e.finishedLanes=n,t){case 0:case 1:throw Error(me(345));case 2:ai(e,dr,fn);break;case 3:if(Ln(e,n),(n&130023424)===n&&(t=Pd+500-bt(),10<t)){if(Ia(e,0)!==0)break;if(i=e.suspendedLanes,(i&n)!==n){or(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=ol(ai.bind(null,e,dr,fn),t);break}ai(e,dr,fn);break;case 4:if(Ln(e,n),(n&4194240)===n)break;for(t=e.eventTimes,i=-1;0<n;){var s=31-Jr(n);o=1<<s,s=t[s],s>i&&(i=s),n&=~o}if(n=i,n=bt()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*oE(n/1960))-n,10<n){e.timeoutHandle=ol(ai.bind(null,e,dr,fn),n);break}ai(e,dr,fn);break;case 5:ai(e,dr,fn);break;default:throw Error(me(329))}}}return mr(e,bt()),e.callbackNode===r?yv.bind(null,e):null}function Cl(e,t){var r=Ko;return e.current.memoizedState.isDehydrated&&(pi(e,t).flags|=256),e=Ja(e,t),e!==2&&(t=dr,dr=r,t!==null&&wl(t)),e}function wl(e){dr===null?dr=e:dr.push.apply(dr,e)}function sE(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var i=r[n],o=i.getSnapshot;i=i.value;try{if(!Qr(o(),i))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Ln(e,t){for(t&=~kd,t&=~fc,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-Jr(t),n=1<<r;e[r]=-1,t&=~n}}function Ap(e){if(Je&6)throw Error(me(327));Xi();var t=Ia(e,0);if(!(t&1))return mr(e,bt()),null;var r=Ja(e,t);if(e.tag!==0&&r===2){var n=Qu(e);n!==0&&(t=n,r=Cl(e,n))}if(r===1)throw r=ps,pi(e,0),Ln(e,t),mr(e,bt()),r;if(r===6)throw Error(me(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,ai(e,dr,fn),mr(e,bt()),null}function Id(e,t){var r=Je;Je|=1;try{return e(t)}finally{Je=r,Je===0&&(so=bt()+500,lc&&ei())}}function Ri(e){Vn!==null&&Vn.tag===0&&!(Je&6)&&Xi();var t=Je;Je|=1;var r=Vr.transition,n=it;try{if(Vr.transition=null,it=1,e)return e()}finally{it=n,Vr.transition=r,Je=t,!(Je&6)&&ei()}}function Od(){_r=$i.current,dt($i)}function pi(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,xy(r)),wt!==null)for(r=wt.return;r!==null;){var n=r;switch(dd(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&La();break;case 3:io(),dt(pr),dt(er),Ed();break;case 5:yd(n);break;case 4:io();break;case 13:dt(gt);break;case 19:dt(gt);break;case 10:md(n.type._context);break;case 22:case 23:Od()}r=r.return}if(xt=e,wt=e=Gn(e.current,null),$t=_r=t,Mt=0,ps=null,kd=fc=Ei=0,dr=Ko=null,li!==null){for(t=0;t<li.length;t++)if(r=li[t],n=r.interleaved,n!==null){r.interleaved=null;var i=n.next,o=r.pending;if(o!==null){var s=o.next;o.next=i,n.next=s}r.pending=n}li=null}return e}function Ev(e,t){do{var r=wt;try{if(fd(),aa.current=za,Wa){for(var n=vt.memoizedState;n!==null;){var i=n.queue;i!==null&&(i.pending=null),n=n.next}Wa=!1}if(yi=0,Nt=Ot=vt=null,zo=!1,ls=0,Ad.current=null,r===null||r.return===null){Mt=1,ps=t,wt=null;break}e:{var o=e,s=r.return,a=r,c=t;if(t=$t,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var u=c,d=a,E=d.tag;if(!(d.mode&1)&&(E===0||E===11||E===15)){var m=d.alternate;m?(d.updateQueue=m.updateQueue,d.memoizedState=m.memoizedState,d.lanes=m.lanes):(d.updateQueue=null,d.memoizedState=null)}var f=fp(s);if(f!==null){f.flags&=-257,mp(f,s,a,o,t),f.mode&1&&pp(o,u,t),t=f,c=u;var y=t.updateQueue;if(y===null){var S=new Set;S.add(c),t.updateQueue=S}else y.add(c);break e}else{if(!(t&1)){pp(o,u,t),Dd();break e}c=Error(me(426))}}else if(ft&&a.mode&1){var l=fp(s);if(l!==null){!(l.flags&65536)&&(l.flags|=256),mp(l,s,a,o,t),hd(oo(c,a));break e}}o=c=oo(c,a),Mt!==4&&(Mt=2),Ko===null?Ko=[o]:Ko.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t;var h=nv(o,c,t);ap(o,h);break e;case 1:a=c;var p=o.type,v=o.stateNode;if(!(o.flags&128)&&(typeof p.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&($n===null||!$n.has(v)))){o.flags|=65536,t&=-t,o.lanes|=t;var g=iv(o,a,t);ap(o,g);break e}}o=o.return}while(o!==null)}_v(r)}catch(R){t=R,wt===r&&r!==null&&(wt=r=r.return);continue}break}while(1)}function Rv(){var e=$a.current;return $a.current=za,e===null?za:e}function Dd(){(Mt===0||Mt===3||Mt===2)&&(Mt=4),xt===null||!(Ei&268435455)&&!(fc&268435455)||Ln(xt,$t)}function Ja(e,t){var r=Je;Je|=2;var n=Rv();(xt!==e||$t!==t)&&(fn=null,pi(e,t));do try{aE();break}catch(i){Ev(e,i)}while(1);if(fd(),Je=r,$a.current=n,wt!==null)throw Error(me(261));return xt=null,$t=0,Mt}function aE(){for(;wt!==null;)bv(wt)}function cE(){for(;wt!==null&&!MS();)bv(wt)}function bv(e){var t=Cv(e.alternate,e,_r);e.memoizedProps=e.pendingProps,t===null?_v(e):wt=t,Ad.current=null}function _v(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=tE(r,t),r!==null){r.flags&=32767,wt=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Mt=6,wt=null;return}}else if(r=eE(r,t,_r),r!==null){wt=r;return}if(t=t.sibling,t!==null){wt=t;return}wt=t=e}while(t!==null);Mt===0&&(Mt=5)}function ai(e,t,r){var n=it,i=Vr.transition;try{Vr.transition=null,it=1,uE(e,t,r,n)}finally{Vr.transition=i,it=n}return null}function uE(e,t,r,n){do Xi();while(Vn!==null);if(Je&6)throw Error(me(327));r=e.finishedWork;var i=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(me(177));e.callbackNode=null,e.callbackPriority=0;var o=r.lanes|r.childLanes;if(WS(e,o),e===xt&&(wt=xt=null,$t=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||zs||(zs=!0,wv(Pa,function(){return Xi(),null})),o=(r.flags&15990)!==0,r.subtreeFlags&15990||o){o=Vr.transition,Vr.transition=null;var s=it;it=1;var a=Je;Je|=4,Ad.current=null,nE(e,r),vv(r,e),Py(nl),Oa=!!rl,nl=rl=null,e.current=r,iE(r),NS(),Je=a,it=s,Vr.transition=o}else e.current=r;if(zs&&(zs=!1,Vn=e,Ga=i),o=e.pendingLanes,o===0&&($n=null),US(r.stateNode),mr(e,bt()),t!==null)for(n=e.onRecoverableError,r=0;r<t.length;r++)i=t[r],n(i.value,{componentStack:i.stack,digest:i.digest});if(Ka)throw Ka=!1,e=_l,_l=null,e;return Ga&1&&e.tag!==0&&Xi(),o=e.pendingLanes,o&1?e===Tl?Go++:(Go=0,Tl=e):Go=0,ei(),null}function Xi(){if(Vn!==null){var e=ng(Ga),t=Vr.transition,r=it;try{if(Vr.transition=null,it=16>e?16:e,Vn===null)var n=!1;else{if(e=Vn,Vn=null,Ga=0,Je&6)throw Error(me(331));var i=Je;for(Je|=4,we=e.current;we!==null;){var o=we,s=o.child;if(we.flags&16){var a=o.deletions;if(a!==null){for(var c=0;c<a.length;c++){var u=a[c];for(we=u;we!==null;){var d=we;switch(d.tag){case 0:case 11:case 15:$o(8,d,o)}var E=d.child;if(E!==null)E.return=d,we=E;else for(;we!==null;){d=we;var m=d.sibling,f=d.return;if(fv(d),d===u){we=null;break}if(m!==null){m.return=f,we=m;break}we=f}}}var y=o.alternate;if(y!==null){var S=y.child;if(S!==null){y.child=null;do{var l=S.sibling;S.sibling=null,S=l}while(S!==null)}}we=o}}if(o.subtreeFlags&2064&&s!==null)s.return=o,we=s;else e:for(;we!==null;){if(o=we,o.flags&2048)switch(o.tag){case 0:case 11:case 15:$o(9,o,o.return)}var h=o.sibling;if(h!==null){h.return=o.return,we=h;break e}we=o.return}}var p=e.current;for(we=p;we!==null;){s=we;var v=s.child;if(s.subtreeFlags&2064&&v!==null)v.return=s,we=v;else e:for(s=p;we!==null;){if(a=we,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:pc(9,a)}}catch(R){yt(a,a.return,R)}if(a===s){we=null;break e}var g=a.sibling;if(g!==null){g.return=a.return,we=g;break e}we=a.return}}if(Je=i,ei(),un&&typeof un.onPostCommitFiberRoot=="function")try{un.onPostCommitFiberRoot(oc,e)}catch{}n=!0}return n}finally{it=r,Vr.transition=t}}return!1}function kp(e,t,r){t=oo(r,t),t=nv(e,t,1),e=zn(e,t,1),t=or(),e!==null&&(Es(e,1,t),mr(e,t))}function yt(e,t,r){if(e.tag===3)kp(e,e,r);else for(;t!==null;){if(t.tag===3){kp(t,e,r);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&($n===null||!$n.has(n))){e=oo(r,e),e=iv(t,e,1),t=zn(t,e,1),e=or(),t!==null&&(Es(t,1,e),mr(t,e));break}}t=t.return}}function lE(e,t,r){var n=e.pingCache;n!==null&&n.delete(t),t=or(),e.pingedLanes|=e.suspendedLanes&r,xt===e&&($t&r)===r&&(Mt===4||Mt===3&&($t&130023424)===$t&&500>bt()-Pd?pi(e,0):kd|=r),mr(e,t)}function Tv(e,t){t===0&&(e.mode&1?(t=Ns,Ns<<=1,!(Ns&130023424)&&(Ns=4194304)):t=1);var r=or();e=Cn(e,t),e!==null&&(Es(e,t,r),mr(e,r))}function dE(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),Tv(e,r)}function hE(e,t){var r=0;switch(e.tag){case 13:var n=e.stateNode,i=e.memoizedState;i!==null&&(r=i.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(me(314))}n!==null&&n.delete(t),Tv(e,r)}var Cv;Cv=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||pr.current)hr=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return hr=!1,Zy(e,t,r);hr=!!(e.flags&131072)}else hr=!1,ft&&t.flags&1048576&&Pg(t,Va,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;ua(e,t),e=t.pendingProps;var i=to(t,er.current);Qi(t,r),i=bd(null,t,n,e,i,r);var o=_d();return t.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,fr(n)?(o=!0,xa(t)):o=!1,t.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,vd(t),i.updater=hc,t.stateNode=i,i._reactInternals=t,hl(t,n,e,r),t=ml(null,t,n,!0,o,r)):(t.tag=0,ft&&o&&ld(t),nr(null,t,i,r),t=t.child),t;case 16:n=t.elementType;e:{switch(ua(e,t),e=t.pendingProps,i=n._init,n=i(n._payload),t.type=n,i=t.tag=fE(n),e=zr(n,e),i){case 0:t=fl(null,t,n,e,r);break e;case 1:t=Sp(null,t,n,e,r);break e;case 11:t=gp(null,t,n,e,r);break e;case 14:t=vp(null,t,n,zr(n.type,e),r);break e}throw Error(me(306,n,""))}return t;case 0:return n=t.type,i=t.pendingProps,i=t.elementType===n?i:zr(n,i),fl(e,t,n,i,r);case 1:return n=t.type,i=t.pendingProps,i=t.elementType===n?i:zr(n,i),Sp(e,t,n,i,r);case 3:e:{if(cv(t),e===null)throw Error(me(387));n=t.pendingProps,o=t.memoizedState,i=o.element,Lg(e,t),Fa(t,n,null,r);var s=t.memoizedState;if(n=s.element,o.isDehydrated)if(o={element:n,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=o,t.memoizedState=o,t.flags&256){i=oo(Error(me(423)),t),t=yp(e,t,n,r,i);break e}else if(n!==i){i=oo(Error(me(424)),t),t=yp(e,t,n,r,i);break e}else for(Cr=Wn(t.stateNode.containerInfo.firstChild),wr=t,ft=!0,Gr=null,r=Mg(t,null,n,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(ro(),n===i){t=wn(e,t,r);break e}nr(e,t,n,r)}t=t.child}return t;case 5:return xg(t),e===null&&ul(t),n=t.type,i=t.pendingProps,o=e!==null?e.memoizedProps:null,s=i.children,il(n,i)?s=null:o!==null&&il(n,o)&&(t.flags|=32),av(e,t),nr(e,t,s,r),t.child;case 6:return e===null&&ul(t),null;case 13:return uv(e,t,r);case 4:return Sd(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=no(t,null,n,r):nr(e,t,n,r),t.child;case 11:return n=t.type,i=t.pendingProps,i=t.elementType===n?i:zr(n,i),gp(e,t,n,i,r);case 7:return nr(e,t,t.pendingProps,r),t.child;case 8:return nr(e,t,t.pendingProps.children,r),t.child;case 12:return nr(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(n=t.type._context,i=t.pendingProps,o=t.memoizedProps,s=i.value,ut(Ba,n._currentValue),n._currentValue=s,o!==null)if(Qr(o.value,s)){if(o.children===i.children&&!pr.current){t=wn(e,t,r);break e}}else for(o=t.child,o!==null&&(o.return=t);o!==null;){var a=o.dependencies;if(a!==null){s=o.child;for(var c=a.firstContext;c!==null;){if(c.context===n){if(o.tag===1){c=Rn(-1,r&-r),c.tag=2;var u=o.updateQueue;if(u!==null){u=u.shared;var d=u.pending;d===null?c.next=c:(c.next=d.next,d.next=c),u.pending=c}}o.lanes|=r,c=o.alternate,c!==null&&(c.lanes|=r),ll(o.return,r,t),a.lanes|=r;break}c=c.next}}else if(o.tag===10)s=o.type===t.type?null:o.child;else if(o.tag===18){if(s=o.return,s===null)throw Error(me(341));s.lanes|=r,a=s.alternate,a!==null&&(a.lanes|=r),ll(s,r,t),s=o.sibling}else s=o.child;if(s!==null)s.return=o;else for(s=o;s!==null;){if(s===t){s=null;break}if(o=s.sibling,o!==null){o.return=s.return,s=o;break}s=s.return}o=s}nr(e,t,i.children,r),t=t.child}return t;case 9:return i=t.type,n=t.pendingProps.children,Qi(t,r),i=Br(i),n=n(i),t.flags|=1,nr(e,t,n,r),t.child;case 14:return n=t.type,i=zr(n,t.pendingProps),i=zr(n.type,i),vp(e,t,n,i,r);case 15:return ov(e,t,t.type,t.pendingProps,r);case 17:return n=t.type,i=t.pendingProps,i=t.elementType===n?i:zr(n,i),ua(e,t),t.tag=1,fr(n)?(e=!0,xa(t)):e=!1,Qi(t,r),rv(t,n,i),hl(t,n,i,r),ml(null,t,n,!0,e,r);case 19:return lv(e,t,r);case 22:return sv(e,t,r)}throw Error(me(156,t.tag))};function wv(e,t){return Z0(e,t)}function pE(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xr(e,t,r,n){return new pE(e,t,r,n)}function Md(e){return e=e.prototype,!(!e||!e.isReactComponent)}function fE(e){if(typeof e=="function")return Md(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Xl)return 11;if(e===Zl)return 14}return 2}function Gn(e,t){var r=e.alternate;return r===null?(r=xr(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function ha(e,t,r,n,i,o){var s=2;if(n=e,typeof e=="function")Md(e)&&(s=1);else if(typeof e=="string")s=5;else e:switch(e){case Li:return fi(r.children,i,o,t);case Ql:s=8,i|=8;break;case xu:return e=xr(12,r,t,i|2),e.elementType=xu,e.lanes=o,e;case Uu:return e=xr(13,r,t,i),e.elementType=Uu,e.lanes=o,e;case Vu:return e=xr(19,r,t,i),e.elementType=Vu,e.lanes=o,e;case x0:return mc(r,i,o,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case N0:s=10;break e;case L0:s=9;break e;case Xl:s=11;break e;case Zl:s=14;break e;case Dn:s=16,n=null;break e}throw Error(me(130,e==null?e:typeof e,""))}return t=xr(s,r,t,i),t.elementType=e,t.type=n,t.lanes=o,t}function fi(e,t,r,n){return e=xr(7,e,n,t),e.lanes=r,e}function mc(e,t,r,n){return e=xr(22,e,n,t),e.elementType=x0,e.lanes=r,e.stateNode={isHidden:!1},e}function su(e,t,r){return e=xr(6,e,null,t),e.lanes=r,e}function au(e,t,r){return t=xr(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function mE(e,t,r,n,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Fc(0),this.expirationTimes=Fc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Fc(0),this.identifierPrefix=n,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Nd(e,t,r,n,i,o,s,a,c){return e=new mE(e,t,r,a,c),t===1?(t=1,o===!0&&(t|=8)):t=0,o=xr(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},vd(o),e}function gE(e,t,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ni,key:n==null?null:""+n,children:e,containerInfo:t,implementation:r}}function Av(e){if(!e)return Qn;e=e._reactInternals;e:{if(wi(e)!==e||e.tag!==1)throw Error(me(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(fr(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(me(171))}if(e.tag===1){var r=e.type;if(fr(r))return Ag(e,r,t)}return t}function kv(e,t,r,n,i,o,s,a,c){return e=Nd(r,n,!0,e,i,o,s,a,c),e.context=Av(null),r=e.current,n=or(),i=Kn(r),o=Rn(n,i),o.callback=t??null,zn(r,o,i),e.current.lanes=i,Es(e,i,n),mr(e,n),e}function gc(e,t,r,n){var i=t.current,o=or(),s=Kn(i);return r=Av(r),t.context===null?t.context=r:t.pendingContext=r,t=Rn(o,s),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),e=zn(i,t,s),e!==null&&(qr(e,i,s,o),sa(e,i,s)),s}function qa(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function Pp(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function Ld(e,t){Pp(e,t),(e=e.alternate)&&Pp(e,t)}function vE(){return null}var Pv=typeof reportError=="function"?reportError:function(e){console.error(e)};function xd(e){this._internalRoot=e}vc.prototype.render=xd.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(me(409));gc(e,t,null,null)};vc.prototype.unmount=xd.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Ri(function(){gc(null,e,null,null)}),t[Tn]=null}};function vc(e){this._internalRoot=e}vc.prototype.unstable_scheduleHydration=function(e){if(e){var t=sg();e={blockedOn:null,target:e,priority:t};for(var r=0;r<Nn.length&&t!==0&&t<Nn[r].priority;r++);Nn.splice(r,0,e),r===0&&cg(e)}};function Ud(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Sc(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function Ip(){}function SE(e,t,r,n,i){if(i){if(typeof n=="function"){var o=n;n=function(){var u=qa(s);o.call(u)}}var s=kv(t,n,e,0,null,!1,!1,"",Ip);return e._reactRootContainer=s,e[Tn]=s.current,os(e.nodeType===8?e.parentNode:e),Ri(),s}for(;i=e.lastChild;)e.removeChild(i);if(typeof n=="function"){var a=n;n=function(){var u=qa(c);a.call(u)}}var c=Nd(e,0,!1,null,null,!1,!1,"",Ip);return e._reactRootContainer=c,e[Tn]=c.current,os(e.nodeType===8?e.parentNode:e),Ri(function(){gc(t,c,r,n)}),c}function yc(e,t,r,n,i){var o=r._reactRootContainer;if(o){var s=o;if(typeof i=="function"){var a=i;i=function(){var c=qa(s);a.call(c)}}gc(t,s,e,i)}else s=SE(r,t,e,i,n);return qa(s)}ig=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=Mo(t.pendingLanes);r!==0&&(rd(t,r|1),mr(t,bt()),!(Je&6)&&(so=bt()+500,ei()))}break;case 13:Ri(function(){var n=Cn(e,1);if(n!==null){var i=or();qr(n,e,1,i)}}),Ld(e,1)}};nd=function(e){if(e.tag===13){var t=Cn(e,134217728);if(t!==null){var r=or();qr(t,e,134217728,r)}Ld(e,134217728)}};og=function(e){if(e.tag===13){var t=Kn(e),r=Cn(e,t);if(r!==null){var n=or();qr(r,e,t,n)}Ld(e,t)}};sg=function(){return it};ag=function(e,t){var r=it;try{return it=e,t()}finally{it=r}};Ju=function(e,t,r){switch(t){case"input":if(Fu(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var i=uc(n);if(!i)throw Error(me(90));V0(n),Fu(n,i)}}}break;case"textarea":j0(e,r);break;case"select":t=r.value,t!=null&&Gi(e,!!r.multiple,t,!1)}};G0=Id;J0=Ri;var yE={usingClientEntryPoint:!1,Events:[bs,Bi,uc,$0,K0,Id]},Co={findFiberByHostInstance:ui,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},EE={bundleType:Co.bundleType,version:Co.version,rendererPackageName:Co.rendererPackageName,rendererConfig:Co.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:An.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Q0(e),e===null?null:e.stateNode},findFiberByHostInstance:Co.findFiberByHostInstance||vE,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var $s=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!$s.isDisabled&&$s.supportsFiber)try{oc=$s.inject(EE),un=$s}catch{}}kr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=yE;kr.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ud(t))throw Error(me(200));return gE(e,t,null,r)};kr.createRoot=function(e,t){if(!Ud(e))throw Error(me(299));var r=!1,n="",i=Pv;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(i=t.onRecoverableError)),t=Nd(e,1,!1,null,null,r,!1,n,i),e[Tn]=t.current,os(e.nodeType===8?e.parentNode:e),new xd(t)};kr.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(me(188)):(e=Object.keys(e).join(","),Error(me(268,e)));return e=Q0(t),e=e===null?null:e.stateNode,e};kr.flushSync=function(e){return Ri(e)};kr.hydrate=function(e,t,r){if(!Sc(t))throw Error(me(200));return yc(null,e,t,!0,r)};kr.hydrateRoot=function(e,t,r){if(!Ud(e))throw Error(me(405));var n=r!=null&&r.hydratedSources||null,i=!1,o="",s=Pv;if(r!=null&&(r.unstable_strictMode===!0&&(i=!0),r.identifierPrefix!==void 0&&(o=r.identifierPrefix),r.onRecoverableError!==void 0&&(s=r.onRecoverableError)),t=kv(t,null,e,1,r??null,i,!1,o,s),e[Tn]=t.current,os(e),n)for(e=0;e<n.length;e++)r=n[e],i=r._getVersion,i=i(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,i]:t.mutableSourceEagerHydrationData.push(r,i);return new vc(t)};kr.render=function(e,t,r){if(!Sc(t))throw Error(me(200));return yc(null,e,t,!1,r)};kr.unmountComponentAtNode=function(e){if(!Sc(e))throw Error(me(40));return e._reactRootContainer?(Ri(function(){yc(null,null,e,!1,function(){e._reactRootContainer=null,e[Tn]=null})}),!0):!1};kr.unstable_batchedUpdates=Id;kr.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!Sc(r))throw Error(me(200));if(e==null||e._reactInternals===void 0)throw Error(me(38));return yc(e,t,r,!1,n)};kr.version="18.3.1-next-f1338f8080-20240426";function Iv(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Iv)}catch(e){console.error(e)}}Iv(),I0.exports=kr;var RE=I0.exports,Op=RE;Nu.createRoot=Op.createRoot,Nu.hydrateRoot=Op.hydrateRoot;const bE="modulepreload",_E=function(e){return"/"+e},Dp={},TE=function(t,r,n){if(!r||r.length===0)return t();const i=document.getElementsByTagName("link");return Promise.all(r.map(o=>{if(o=_E(o),o in Dp)return;Dp[o]=!0;const s=o.endsWith(".css"),a=s?'[rel="stylesheet"]':"";if(!!n)for(let d=i.length-1;d>=0;d--){const E=i[d];if(E.href===o&&(!s||E.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${a}`))return;const u=document.createElement("link");if(u.rel=s?"stylesheet":bE,s||(u.as="script",u.crossOrigin=""),u.href=o,document.head.appendChild(u),s)return new Promise((d,E)=>{u.addEventListener("load",d),u.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${o}`)))})})).then(()=>t()).catch(o=>{const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=o,window.dispatchEvent(s),!s.defaultPrevented)throw o})};var Ov={exports:{}};/*! aliyun rts sdk - ver2.9.3-beta.0 created:11/27/2024, 4:54:08 PM */(function(e,t){(function(r,n){e.exports=n()})(self,()=>(()=>{var r={2505:(o,s,a)=>{o.exports=a(8015)},5592:(o,s,a)=>{var c=a(9516),u=a(7522),d=a(3948),E=a(9106),m=a(9615),f=a(2012),y=a(4202),S=a(7763);o.exports=function(l){return new Promise(function(h,p){var v=l.data,g=l.headers,R=l.responseType;c.isFormData(v)&&delete g["Content-Type"];var _=new XMLHttpRequest;if(l.auth){var w=l.auth.username||"",k=l.auth.password?unescape(encodeURIComponent(l.auth.password)):"";g.Authorization="Basic "+btoa(w+":"+k)}var O=m(l.baseURL,l.url);function C(){if(_){var A="getAllResponseHeaders"in _?f(_.getAllResponseHeaders()):null,T={data:R&&R!=="text"&&R!=="json"?_.response:_.responseText,status:_.status,statusText:_.statusText,headers:A,config:l,request:_};u(h,p,T),_=null}}if(_.open(l.method.toUpperCase(),E(O,l.params,l.paramsSerializer),!0),_.timeout=l.timeout,"onloadend"in _?_.onloadend=C:_.onreadystatechange=function(){_&&_.readyState===4&&(_.status!==0||_.responseURL&&_.responseURL.indexOf("file:")===0)&&setTimeout(C)},_.onabort=function(){_&&(p(S("Request aborted",l,"ECONNABORTED",_)),_=null)},_.onerror=function(){p(S("Network Error",l,null,_)),_=null},_.ontimeout=function(){var A="timeout of "+l.timeout+"ms exceeded";l.timeoutErrorMessage&&(A=l.timeoutErrorMessage),p(S(A,l,l.transitional&&l.transitional.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",_)),_=null},c.isStandardBrowserEnv()){var b=(l.withCredentials||y(O))&&l.xsrfCookieName?d.read(l.xsrfCookieName):void 0;b&&(g[l.xsrfHeaderName]=b)}"setRequestHeader"in _&&c.forEach(g,function(A,T){v===void 0&&T.toLowerCase()==="content-type"?delete g[T]:_.setRequestHeader(T,A)}),c.isUndefined(l.withCredentials)||(_.withCredentials=!!l.withCredentials),R&&R!=="json"&&(_.responseType=l.responseType),typeof l.onDownloadProgress=="function"&&_.addEventListener("progress",l.onDownloadProgress),typeof l.onUploadProgress=="function"&&_.upload&&_.upload.addEventListener("progress",l.onUploadProgress),l.cancelToken&&l.cancelToken.promise.then(function(A){_&&(_.abort(),p(A),_=null)}),v||(v=null),_.send(v)})}},8015:(o,s,a)=>{var c=a(9516),u=a(9012),d=a(5155),E=a(5343);function m(y){var S=new d(y),l=u(d.prototype.request,S);return c.extend(l,d.prototype,S),c.extend(l,S),l}var f=m(a(6987));f.Axios=d,f.create=function(y){return m(E(f.defaults,y))},f.Cancel=a(1928),f.CancelToken=a(3191),f.isCancel=a(3864),f.all=function(y){return Promise.all(y)},f.spread=a(7980),f.isAxiosError=a(5019),o.exports=f,o.exports.default=f},1928:o=>{function s(a){this.message=a}s.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},s.prototype.__CANCEL__=!0,o.exports=s},3191:(o,s,a)=>{var c=a(1928);function u(d){if(typeof d!="function")throw new TypeError("executor must be a function.");var E;this.promise=new Promise(function(f){E=f});var m=this;d(function(f){m.reason||(m.reason=new c(f),E(m.reason))})}u.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},u.source=function(){var d;return{token:new u(function(E){d=E}),cancel:d}},o.exports=u},3864:o=>{o.exports=function(s){return!(!s||!s.__CANCEL__)}},5155:(o,s,a)=>{var c=a(9516),u=a(9106),d=a(3471),E=a(4490),m=a(5343),f=a(4841),y=f.validators;function S(l){this.defaults=l,this.interceptors={request:new d,response:new d}}S.prototype.request=function(l){typeof l=="string"?(l=arguments[1]||{}).url=arguments[0]:l=l||{},(l=m(this.defaults,l)).method?l.method=l.method.toLowerCase():this.defaults.method?l.method=this.defaults.method.toLowerCase():l.method="get";var h=l.transitional;h!==void 0&&f.assertOptions(h,{silentJSONParsing:y.transitional(y.boolean,"1.0.0"),forcedJSONParsing:y.transitional(y.boolean,"1.0.0"),clarifyTimeoutError:y.transitional(y.boolean,"1.0.0")},!1);var p=[],v=!0;this.interceptors.request.forEach(function(C){typeof C.runWhen=="function"&&C.runWhen(l)===!1||(v=v&&C.synchronous,p.unshift(C.fulfilled,C.rejected))});var g,R=[];if(this.interceptors.response.forEach(function(C){R.push(C.fulfilled,C.rejected)}),!v){var _=[E,void 0];for(Array.prototype.unshift.apply(_,p),_=_.concat(R),g=Promise.resolve(l);_.length;)g=g.then(_.shift(),_.shift());return g}for(var w=l;p.length;){var k=p.shift(),O=p.shift();try{w=k(w)}catch(C){O(C);break}}try{g=E(w)}catch(C){return Promise.reject(C)}for(;R.length;)g=g.then(R.shift(),R.shift());return g},S.prototype.getUri=function(l){return l=m(this.defaults,l),u(l.url,l.params,l.paramsSerializer).replace(/^\?/,"")},c.forEach(["delete","get","head","options"],function(l){S.prototype[l]=function(h,p){return this.request(m(p||{},{method:l,url:h,data:(p||{}).data}))}}),c.forEach(["post","put","patch"],function(l){S.prototype[l]=function(h,p,v){return this.request(m(v||{},{method:l,url:h,data:p}))}}),o.exports=S},3471:(o,s,a)=>{var c=a(9516);function u(){this.handlers=[]}u.prototype.use=function(d,E,m){return this.handlers.push({fulfilled:d,rejected:E,synchronous:!!m&&m.synchronous,runWhen:m?m.runWhen:null}),this.handlers.length-1},u.prototype.eject=function(d){this.handlers[d]&&(this.handlers[d]=null)},u.prototype.forEach=function(d){c.forEach(this.handlers,function(E){E!==null&&d(E)})},o.exports=u},9615:(o,s,a)=>{var c=a(9137),u=a(4680);o.exports=function(d,E){return d&&!c(E)?u(d,E):E}},7763:(o,s,a)=>{var c=a(5449);o.exports=function(u,d,E,m,f){var y=new Error(u);return c(y,d,E,m,f)}},4490:(o,s,a)=>{var c=a(9516),u=a(2881),d=a(3864),E=a(6987);function m(f){f.cancelToken&&f.cancelToken.throwIfRequested()}o.exports=function(f){return m(f),f.headers=f.headers||{},f.data=u.call(f,f.data,f.headers,f.transformRequest),f.headers=c.merge(f.headers.common||{},f.headers[f.method]||{},f.headers),c.forEach(["delete","get","head","post","put","patch","common"],function(y){delete f.headers[y]}),(f.adapter||E.adapter)(f).then(function(y){return m(f),y.data=u.call(f,y.data,y.headers,f.transformResponse),y},function(y){return d(y)||(m(f),y&&y.response&&(y.response.data=u.call(f,y.response.data,y.response.headers,f.transformResponse))),Promise.reject(y)})}},5449:o=>{o.exports=function(s,a,c,u,d){return s.config=a,c&&(s.code=c),s.request=u,s.response=d,s.isAxiosError=!0,s.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},s}},5343:(o,s,a)=>{var c=a(9516);o.exports=function(u,d){d=d||{};var E={},m=["url","method","data"],f=["headers","auth","proxy","params"],y=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],S=["validateStatus"];function l(g,R){return c.isPlainObject(g)&&c.isPlainObject(R)?c.merge(g,R):c.isPlainObject(R)?c.merge({},R):c.isArray(R)?R.slice():R}function h(g){c.isUndefined(d[g])?c.isUndefined(u[g])||(E[g]=l(void 0,u[g])):E[g]=l(u[g],d[g])}c.forEach(m,function(g){c.isUndefined(d[g])||(E[g]=l(void 0,d[g]))}),c.forEach(f,h),c.forEach(y,function(g){c.isUndefined(d[g])?c.isUndefined(u[g])||(E[g]=l(void 0,u[g])):E[g]=l(void 0,d[g])}),c.forEach(S,function(g){g in d?E[g]=l(u[g],d[g]):g in u&&(E[g]=l(void 0,u[g]))});var p=m.concat(f).concat(y).concat(S),v=Object.keys(u).concat(Object.keys(d)).filter(function(g){return p.indexOf(g)===-1});return c.forEach(v,h),E}},7522:(o,s,a)=>{var c=a(7763);o.exports=function(u,d,E){var m=E.config.validateStatus;E.status&&m&&!m(E.status)?d(c("Request failed with status code "+E.status,E.config,null,E.request,E)):u(E)}},2881:(o,s,a)=>{var c=a(9516),u=a(6987);o.exports=function(d,E,m){var f=this||u;return c.forEach(m,function(y){d=y.call(f,d,E)}),d}},6987:(o,s,a)=>{var c=a(9516),u=a(7018),d=a(5449),E={"Content-Type":"application/x-www-form-urlencoded"};function m(S,l){!c.isUndefined(S)&&c.isUndefined(S["Content-Type"])&&(S["Content-Type"]=l)}var f,y={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:((typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(f=a(5592)),f),transformRequest:[function(S,l){return u(l,"Accept"),u(l,"Content-Type"),c.isFormData(S)||c.isArrayBuffer(S)||c.isBuffer(S)||c.isStream(S)||c.isFile(S)||c.isBlob(S)?S:c.isArrayBufferView(S)?S.buffer:c.isURLSearchParams(S)?(m(l,"application/x-www-form-urlencoded;charset=utf-8"),S.toString()):c.isObject(S)||l&&l["Content-Type"]==="application/json"?(m(l,"application/json"),function(h,p,v){if(c.isString(h))try{return(p||JSON.parse)(h),c.trim(h)}catch(g){if(g.name!=="SyntaxError")throw g}return(v||JSON.stringify)(h)}(S)):S}],transformResponse:[function(S){var l=this.transitional,h=l&&l.silentJSONParsing,p=l&&l.forcedJSONParsing,v=!h&&this.responseType==="json";if(v||p&&c.isString(S)&&S.length)try{return JSON.parse(S)}catch(g){if(v)throw g.name==="SyntaxError"?d(g,this,"E_JSON_PARSE"):g}return S}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(S){return S>=200&&S<300}};y.headers={common:{Accept:"application/json, text/plain, */*"}},c.forEach(["delete","get","head"],function(S){y.headers[S]={}}),c.forEach(["post","put","patch"],function(S){y.headers[S]=c.merge(E)}),o.exports=y},9012:o=>{o.exports=function(s,a){return function(){for(var c=new Array(arguments.length),u=0;u<c.length;u++)c[u]=arguments[u];return s.apply(a,c)}}},9106:(o,s,a)=>{var c=a(9516);function u(d){return encodeURIComponent(d).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}o.exports=function(d,E,m){if(!E)return d;var f;if(m)f=m(E);else if(c.isURLSearchParams(E))f=E.toString();else{var y=[];c.forEach(E,function(l,h){l!=null&&(c.isArray(l)?h+="[]":l=[l],c.forEach(l,function(p){c.isDate(p)?p=p.toISOString():c.isObject(p)&&(p=JSON.stringify(p)),y.push(u(h)+"="+u(p))}))}),f=y.join("&")}if(f){var S=d.indexOf("#");S!==-1&&(d=d.slice(0,S)),d+=(d.indexOf("?")===-1?"?":"&")+f}return d}},4680:o=>{o.exports=function(s,a){return a?s.replace(/\/+$/,"")+"/"+a.replace(/^\/+/,""):s}},3948:(o,s,a)=>{var c=a(9516);o.exports=c.isStandardBrowserEnv()?{write:function(u,d,E,m,f,y){var S=[];S.push(u+"="+encodeURIComponent(d)),c.isNumber(E)&&S.push("expires="+new Date(E).toGMTString()),c.isString(m)&&S.push("path="+m),c.isString(f)&&S.push("domain="+f),y===!0&&S.push("secure"),document.cookie=S.join("; ")},read:function(u){var d=document.cookie.match(new RegExp("(^|;\\s*)("+u+")=([^;]*)"));return d?decodeURIComponent(d[3]):null},remove:function(u){this.write(u,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},9137:o=>{o.exports=function(s){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(s)}},5019:o=>{o.exports=function(s){return typeof s=="object"&&s.isAxiosError===!0}},4202:(o,s,a)=>{var c=a(9516);o.exports=c.isStandardBrowserEnv()?function(){var u,d=/(msie|trident)/i.test(navigator.userAgent),E=document.createElement("a");function m(f){var y=f;return d&&(E.setAttribute("href",y),y=E.href),E.setAttribute("href",y),{href:E.href,protocol:E.protocol?E.protocol.replace(/:$/,""):"",host:E.host,search:E.search?E.search.replace(/^\?/,""):"",hash:E.hash?E.hash.replace(/^#/,""):"",hostname:E.hostname,port:E.port,pathname:E.pathname.charAt(0)==="/"?E.pathname:"/"+E.pathname}}return u=m(window.location.href),function(f){var y=c.isString(f)?m(f):f;return y.protocol===u.protocol&&y.host===u.host}}():function(){return!0}},7018:(o,s,a)=>{var c=a(9516);o.exports=function(u,d){c.forEach(u,function(E,m){m!==d&&m.toUpperCase()===d.toUpperCase()&&(u[d]=E,delete u[m])})}},2012:(o,s,a)=>{var c=a(9516),u=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];o.exports=function(d){var E,m,f,y={};return d&&c.forEach(d.split(`
`),function(S){if(f=S.indexOf(":"),E=c.trim(S.substr(0,f)).toLowerCase(),m=c.trim(S.substr(f+1)),E){if(y[E]&&u.indexOf(E)>=0)return;y[E]=E==="set-cookie"?(y[E]?y[E]:[]).concat([m]):y[E]?y[E]+", "+m:m}}),y}},7980:o=>{o.exports=function(s){return function(a){return s.apply(null,a)}}},4841:(o,s,a)=>{var c=a(4198),u={};["object","boolean","number","function","string","symbol"].forEach(function(f,y){u[f]=function(S){return typeof S===f||"a"+(y<1?"n ":" ")+f}});var d={},E=c.version.split(".");function m(f,y){for(var S=y?y.split("."):E,l=f.split("."),h=0;h<3;h++){if(S[h]>l[h])return!0;if(S[h]<l[h])return!1}return!1}u.transitional=function(f,y,S){var l=y&&m(y);function h(p,v){return"[Axios v"+c.version+"] Transitional option '"+p+"'"+v+(S?". "+S:"")}return function(p,v,g){if(f===!1)throw new Error(h(v," has been removed in "+y));return l&&!d[v]&&(d[v]=!0,console.warn(h(v," has been deprecated since v"+y+" and will be removed in the near future"))),!f||f(p,v,g)}},o.exports={isOlderVersion:m,assertOptions:function(f,y,S){if(typeof f!="object")throw new TypeError("options must be an object");for(var l=Object.keys(f),h=l.length;h-- >0;){var p=l[h],v=y[p];if(v){var g=f[p],R=g===void 0||v(g,p,f);if(R!==!0)throw new TypeError("option "+p+" must be "+R)}else if(S!==!0)throw Error("Unknown option "+p)}},validators:u}},9516:(o,s,a)=>{var c=a(9012),u=Object.prototype.toString;function d(l){return u.call(l)==="[object Array]"}function E(l){return l===void 0}function m(l){return l!==null&&typeof l=="object"}function f(l){if(u.call(l)!=="[object Object]")return!1;var h=Object.getPrototypeOf(l);return h===null||h===Object.prototype}function y(l){return u.call(l)==="[object Function]"}function S(l,h){if(l!=null)if(typeof l!="object"&&(l=[l]),d(l))for(var p=0,v=l.length;p<v;p++)h.call(null,l[p],p,l);else for(var g in l)Object.prototype.hasOwnProperty.call(l,g)&&h.call(null,l[g],g,l)}o.exports={isArray:d,isArrayBuffer:function(l){return u.call(l)==="[object ArrayBuffer]"},isBuffer:function(l){return l!==null&&!E(l)&&l.constructor!==null&&!E(l.constructor)&&typeof l.constructor.isBuffer=="function"&&l.constructor.isBuffer(l)},isFormData:function(l){return typeof FormData<"u"&&l instanceof FormData},isArrayBufferView:function(l){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(l):l&&l.buffer&&l.buffer instanceof ArrayBuffer},isString:function(l){return typeof l=="string"},isNumber:function(l){return typeof l=="number"},isObject:m,isPlainObject:f,isUndefined:E,isDate:function(l){return u.call(l)==="[object Date]"},isFile:function(l){return u.call(l)==="[object File]"},isBlob:function(l){return u.call(l)==="[object Blob]"},isFunction:y,isStream:function(l){return m(l)&&y(l.pipe)},isURLSearchParams:function(l){return typeof URLSearchParams<"u"&&l instanceof URLSearchParams},isStandardBrowserEnv:function(){return(typeof navigator>"u"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window<"u"&&typeof document<"u"},forEach:S,merge:function l(){var h={};function p(R,_){f(h[_])&&f(R)?h[_]=l(h[_],R):f(R)?h[_]=l({},R):d(R)?h[_]=R.slice():h[_]=R}for(var v=0,g=arguments.length;v<g;v++)S(arguments[v],p);return h},extend:function(l,h,p){return S(h,function(v,g){l[g]=p&&typeof v=="function"?c(v,p):v}),l},trim:function(l){return l.trim?l.trim():l.replace(/^\s+|\s+$/g,"")},stripBOM:function(l){return l.charCodeAt(0)===65279&&(l=l.slice(1)),l}}},3412:o=>{/*! media-device - ver 1.3.0-beta.0 created:2024/3/20 10:32:34 */o.exports=(()=>{var s={304:(c,u,d)=>{Object.defineProperty(u,"__esModule",{value:!0}),u.BrowserDeviceManager=void 0;var E=d(101),m=d(853),f=d(62),y=d(913),S=d(331),l=d(1),h=d(935),p=d(603),v=function(){function g(){this.systemUtil=new E.SystemUtil,this.deviceManager=this.createDeviceManager()}return g.prototype.getCameraList=function(){return this.deviceManager.getCameraList()},g.prototype.getMicList=function(){return this.deviceManager.getMicList()},g.prototype.getSpeakerList=function(){return this.deviceManager.getSpeakerList()},g.prototype.getAudioTrack=function(R){return this.deviceManager.getAudioTrack(R)},g.prototype.getVideoTrack=function(R){return this.deviceManager.getVideoTrack(R)},g.prototype.getScreenTrack=function(R){return this.deviceManager.getScreenTrack(R)},g.prototype.getAudioStream=function(R){return this.deviceManager.getAudioStream(R)},g.prototype.getVideoStream=function(R){return this.deviceManager.getVideoStream(R)},g.prototype.getScreenStream=function(R){return this.deviceManager.getScreenStream(R)},g.prototype.checkSupportScreenShare=function(){return this.deviceManager.checkSupportScreenShare()},g.prototype.createDeviceManager=function(){return this.systemUtil.isWindows?new h.WindowsDeviceManager:this.systemUtil.isAndroid?new m.AndroidDeviceManager:this.systemUtil.isIos?new y.IosDeviceManager:this.systemUtil.isMacOS?new l.MacDeviceManager:this.systemUtil.isLinux?new S.LinuxDeviceManager:new f.BaseDeviceManager},g.isDeviceManagerError=p.DeviceError.isDeviceManagerError,g}();u.BrowserDeviceManager=v},603:(c,u,d)=>{Object.defineProperty(u,"__esModule",{value:!0}),u.DeviceError=u.DeviceErrorDescription=u.DeviceErrorCode=void 0;var E=d(610);(function(f){f[f.ERROR_DEVICE_UNKNOWNERROR=1e4]="ERROR_DEVICE_UNKNOWNERROR",f[f.ERROR_DEVICE_AUDIODEVICE_NOTFOUND=10001]="ERROR_DEVICE_AUDIODEVICE_NOTFOUND",f[f.ERROR_DEVICE_VIDEODEVICE_NOTFOUND=10002]="ERROR_DEVICE_VIDEODEVICE_NOTFOUND",f[f.ERROR_DEVICE_AUDIODEVICE_NOTALLOWED=10003]="ERROR_DEVICE_AUDIODEVICE_NOTALLOWED",f[f.ERROR_DEVICE_VIDEODEVICE_NOTALLOWED=10004]="ERROR_DEVICE_VIDEODEVICE_NOTALLOWED",f[f.ERROR_DEVICE_AUDIODEVICE_NOTREADABLE=10005]="ERROR_DEVICE_AUDIODEVICE_NOTREADABLE",f[f.ERROR_DEVICE_VIDEODEVICE_NOTREADABLE=10006]="ERROR_DEVICE_VIDEODEVICE_NOTREADABLE",f[f.ERROR_DEIVCE_CONSTRAINEDERROR=10007]="ERROR_DEIVCE_CONSTRAINEDERROR",f[f.ERROR_SCREENSHARE_UNKNOWNERRO=10010]="ERROR_SCREENSHARE_UNKNOWNERRO",f[f.ERROR_SCREENSHARE_NOTALLOWED=10011]="ERROR_SCREENSHARE_NOTALLOWED",f[f.ERROR_SCREENSHARE_ENDED=10012]="ERROR_SCREENSHARE_ENDED",f[f.ERROR_SCREENSHARE_NOPERMISSION=10013]="ERROR_SCREENSHARE_NOPERMISSION",f[f.ERROR_SCREENSHARE_INVALIDACCESS=10014]="ERROR_SCREENSHARE_INVALIDACCESS",f[f.ERROR_SCREENSHARE_NOTSUPPORT=10018]="ERROR_SCREENSHARE_NOTSUPPORT",f[f.ERROR_DEVICE_NOTSUPPORT=10019]="ERROR_DEVICE_NOTSUPPORT"})(u.DeviceErrorCode||(u.DeviceErrorCode={})),function(f){f.ERRORMESSAGE_DEVICENOTFOUND="Requested device not found",f.ERRORMESSAGE_DEVICENOTALLOWED="Permission denied",f.ERRORMESSAGE_MACCHROME_DEVICENOTREADABLE="Permission denied by system",f.ERRORMESSAGE_MACSAFARI_DEVICENOTALLOWED="The request is not allowed by the user agent or the platform in the current context, possibly because the user denied permission.",f.ERRORMESSAGE_MOBILEDEVICE_NOTALLOWED="video device not allowed",f.ERRORMESSAGE_AUDIODEVICENOTREADABLE="Could not start audio source",f.ERRORMESSAGE_VIDEODEVICENOTREADABLE="Could not start video source",f.ERRORNAME_DEVICENOTFOUND="NotFoundError",f.ERRORNAME_DEVICENOTALLOWED="NotAllowedError",f.ERRORNAME_DEVICENOTREADABLE="NotReadableError",f.ERRORNAME_DEVICEOVERCONSTRAINED="OverconstrainedError",f.ERRORNAME_INVALID_ACCESS="InvalidAccessError"}(u.DeviceErrorDescription||(u.DeviceErrorDescription={}));var m=function(){function f(y,S){this.linkUtil=new E.LinkUtil,this.code=y,this.reason=S,this.relatedLink=this.linkUtil.getRelatedLink(y)}return f.isDeviceManagerError=function(y){return!!(y&&typeof y=="object"&&"code"in y&&"reason"in y)},f}();u.DeviceError=m},873:(c,u)=>{Object.defineProperty(u,"__esModule",{value:!0}),u.FacingMode=u.DeviceType=u.MobileCameraType=void 0,function(d){d[d.USER=0]="USER",d[d.ENV=1]="ENV"}(u.MobileCameraType||(u.MobileCameraType={})),function(d){d.Camera="videoinput",d.Mic="audioinput",d.Screen="screen",d.Speaker="audiooutput"}(u.DeviceType||(u.DeviceType={})),function(d){d.USER="user",d.ENVIRONMENT="environment"}(u.FacingMode||(u.FacingMode={}))},853:function(c,u,d){var E,m=this&&this.__extends||(E=function(y,S){return(E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&(l[p]=h[p])})(y,S)},function(y,S){function l(){this.constructor=y}E(y,S),y.prototype=S===null?Object.create(S):(l.prototype=S.prototype,new l)});Object.defineProperty(u,"__esModule",{value:!0}),u.AndroidDeviceManager=void 0;var f=function(y){function S(){return y.call(this)||this}return m(S,y),S}(d(583).MobileDeviceManager);u.AndroidDeviceManager=f},62:function(c,u,d){var E=this&&this.__assign||function(){return(E=Object.assign||function(S){for(var l,h=1,p=arguments.length;h<p;h++)for(var v in l=arguments[h])Object.prototype.hasOwnProperty.call(l,v)&&(S[v]=l[v]);return S}).apply(this,arguments)};Object.defineProperty(u,"__esModule",{value:!0}),u.BaseDeviceManager=void 0;var m=d(603),f=d(873),y=function(){function S(){}return S.prototype.checkSupportScreenShare=function(){return!!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia&&navigator.mediaDevices.getDisplayMedia)},S.prototype.getCameraList=function(){var l=this;return new Promise(function(h,p){l.checkSupport()?l.getDeviceRight(f.DeviceType.Camera).then(function(){l.getDeviceList(f.DeviceType.Camera).then(function(v){h(v)}).catch(function(v){p(l.parseError(f.DeviceType.Camera,v))})}).catch(function(v){p(l.parseError(f.DeviceType.Camera,v))}):p(new m.DeviceError(m.DeviceErrorCode.ERROR_DEVICE_NOTSUPPORT,"not support navigator.mediaDevices"))})},S.prototype.getMicList=function(){var l=this;return new Promise(function(h,p){l.checkSupport()?l.getDeviceRight(f.DeviceType.Mic).then(function(){l.getDeviceList(f.DeviceType.Mic).then(function(v){h(v)}).catch(function(v){p(l.parseError(f.DeviceType.Mic,v))})}).catch(function(v){p(l.parseError(f.DeviceType.Mic,v))}):p(new m.DeviceError(m.DeviceErrorCode.ERROR_DEVICE_NOTSUPPORT,"not support navigator.mediaDevices"))})},S.prototype.getSpeakerList=function(){var l=this;return new Promise(function(h,p){l.checkSupport()?l.getDeviceRight(f.DeviceType.Speaker).then(function(){l.getDeviceList(f.DeviceType.Speaker).then(function(v){h(v)}).catch(function(v){p(l.parseError(f.DeviceType.Speaker,v))})}).catch(function(v){p(l.parseError(f.DeviceType.Speaker,v))}):p(new m.DeviceError(m.DeviceErrorCode.ERROR_DEVICE_NOTSUPPORT,"not support navigator.mediaDevices"))})},S.prototype.getAudioTrack=function(l){return this.getAudioStream(l).then(function(h){return h.getAudioTracks()[0]})},S.prototype.getAudioStream=function(l){var h=this;return new Promise(function(p,v){if(h.checkSupport()){var g=h.createAudioConstraints(l);navigator.mediaDevices.getUserMedia(g).then(function(R){p(R)}).catch(function(R){v(h.parseError(f.DeviceType.Mic,R))})}else v(new m.DeviceError(m.DeviceErrorCode.ERROR_DEVICE_NOTSUPPORT,"not support navigator.mediaDevices"))})},S.prototype.getVideoTrack=function(l){return this.getVideoStream(l).then(function(h){return h.getVideoTracks()[0]})},S.prototype.getVideoStream=function(l){var h=this;return new Promise(function(p,v){if(h.checkSupport()){var g=h.createVideoConstraints(l);navigator.mediaDevices.getUserMedia(g).then(function(R){p(R)}).catch(function(R){v(h.parseError(f.DeviceType.Camera,R))})}else v(new m.DeviceError(m.DeviceErrorCode.ERROR_DEVICE_NOTSUPPORT,"not support navigator.mediaDevices"))})},S.prototype.getScreenTrack=function(l){return this.getScreenStream(l).then(function(h){return h.getTracks()})},S.prototype.getScreenStream=function(l){var h=this;return new Promise(function(p,v){h.checkSupportScreenShare()?navigator.mediaDevices.getDisplayMedia(l).then(function(g){p(g)}).catch(function(g){v(h.parseError(f.DeviceType.Screen,g))}):v(new m.DeviceError(m.DeviceErrorCode.ERROR_SCREENSHARE_NOTSUPPORT,"browser not support screenshare"))})},S.prototype.checkSupport=function(){return!!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&navigator.mediaDevices.getUserMedia)},S.prototype.getDeviceList=function(l){return new Promise(function(h,p){navigator.mediaDevices.enumerateDevices().then(function(v){var g=[];v.forEach(function(R){R.kind===l&&g.push(R)}),h(g)}).catch(function(v){p(v)})})},S.prototype.getDeviceRight=function(l){return new Promise(function(h,p){var v;f.DeviceType.Camera===l?v={video:!0}:f.DeviceType.Mic!==l&&f.DeviceType.Speaker!==l||(v={audio:!0}),navigator.mediaDevices.getUserMedia(v).then(function(g){g.getTracks().forEach(function(R){R.stop()}),h(void 0)}).catch(function(g){h(void 0)})})},S.prototype.parseError=function(l,h){var p=null;return f.DeviceType.Mic===l?p=this.parseAudioError(h):f.DeviceType.Camera===l?p=this.parseVideoError(h):f.DeviceType.Screen===l&&(p=this.parseScreenError(h)),p===null?new m.DeviceError(m.DeviceErrorCode.ERROR_DEVICE_UNKNOWNERROR,""):p},S.prototype.parseAudioError=function(l){return l.message===m.DeviceErrorDescription.ERRORMESSAGE_DEVICENOTFOUND||l.name===m.DeviceErrorDescription.ERRORNAME_DEVICENOTFOUND?new m.DeviceError(m.DeviceErrorCode.ERROR_DEVICE_AUDIODEVICE_NOTFOUND,"audio device not found"):l.message===m.DeviceErrorDescription.ERRORMESSAGE_DEVICENOTALLOWED||l.message===m.DeviceErrorDescription.ERRORMESSAGE_MACSAFARI_DEVICENOTALLOWED?new m.DeviceError(m.DeviceErrorCode.ERROR_DEVICE_AUDIODEVICE_NOTALLOWED,"audio device not allowed"):l.message===m.DeviceErrorDescription.ERRORMESSAGE_MACCHROME_DEVICENOTREADABLE||l.message===m.DeviceErrorDescription.ERRORMESSAGE_AUDIODEVICENOTREADABLE||l.message===m.DeviceErrorDescription.ERRORNAME_DEVICENOTREADABLE?new m.DeviceError(m.DeviceErrorCode.ERROR_DEVICE_AUDIODEVICE_NOTREADABLE,"audio device not readable"):null},S.prototype.parseVideoError=function(l){return l.message===m.DeviceErrorDescription.ERRORMESSAGE_DEVICENOTFOUND||l.name===m.DeviceErrorDescription.ERRORNAME_DEVICENOTFOUND?new m.DeviceError(m.DeviceErrorCode.ERROR_DEVICE_VIDEODEVICE_NOTFOUND,"video device not found"):l.message===m.DeviceErrorDescription.ERRORMESSAGE_DEVICENOTALLOWED||l.message===m.DeviceErrorDescription.ERRORMESSAGE_MOBILEDEVICE_NOTALLOWED||l.message===m.DeviceErrorDescription.ERRORMESSAGE_MACSAFARI_DEVICENOTALLOWED?new m.DeviceError(m.DeviceErrorCode.ERROR_DEVICE_VIDEODEVICE_NOTALLOWED,"video device not allowed"):l.message===m.DeviceErrorDescription.ERRORMESSAGE_MACCHROME_DEVICENOTREADABLE||l.message===m.DeviceErrorDescription.ERRORMESSAGE_VIDEODEVICENOTREADABLE||l.name===m.DeviceErrorDescription.ERRORNAME_DEVICENOTREADABLE?new m.DeviceError(m.DeviceErrorCode.ERROR_DEVICE_VIDEODEVICE_NOTREADABLE,"video device not readable"):null},S.prototype.parseScreenError=function(l){return l.name===m.DeviceErrorDescription.ERRORNAME_DEVICENOTALLOWED?l.message===m.DeviceErrorDescription.ERRORMESSAGE_DEVICENOTALLOWED?new m.DeviceError(m.DeviceErrorCode.ERROR_SCREENSHARE_NOTALLOWED,l.message):new m.DeviceError(m.DeviceErrorCode.ERROR_SCREENSHARE_NOPERMISSION,l.message):l.name===m.DeviceErrorDescription.ERRORNAME_INVALID_ACCESS?new m.DeviceError(m.DeviceErrorCode.ERROR_SCREENSHARE_INVALIDACCESS,l.message):null},S.prototype.createVideoConstraints=function(l){return l.deviceId||l.width||l.height||l.frameRate?{video:{deviceId:{exact:l.deviceId},width:l.width,height:l.height,frameRate:l.frameRate}}:{video:!0}},S.prototype.createAudioConstraints=function(l){var h={audio:l},p=E({},l);return p.deviceId||delete p.deviceId,Object.keys(p).length===0&&(h={audio:!0}),h},S}();u.BaseDeviceManager=y},913:function(c,u,d){var E,m=this&&this.__extends||(E=function(y,S){return(E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&(l[p]=h[p])})(y,S)},function(y,S){function l(){this.constructor=y}E(y,S),y.prototype=S===null?Object.create(S):(l.prototype=S.prototype,new l)});Object.defineProperty(u,"__esModule",{value:!0}),u.IosDeviceManager=void 0;var f=function(y){function S(){return y.call(this)||this}return m(S,y),S}(d(583).MobileDeviceManager);u.IosDeviceManager=f},331:function(c,u,d){var E,m=this&&this.__extends||(E=function(y,S){return(E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&(l[p]=h[p])})(y,S)},function(y,S){function l(){this.constructor=y}E(y,S),y.prototype=S===null?Object.create(S):(l.prototype=S.prototype,new l)});Object.defineProperty(u,"__esModule",{value:!0}),u.LinuxDeviceManager=void 0;var f=function(y){function S(){return y.call(this)||this}return m(S,y),S}(d(62).BaseDeviceManager);u.LinuxDeviceManager=f},1:function(c,u,d){var E,m=this&&this.__extends||(E=function(y,S){return(E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&(l[p]=h[p])})(y,S)},function(y,S){function l(){this.constructor=y}E(y,S),y.prototype=S===null?Object.create(S):(l.prototype=S.prototype,new l)});Object.defineProperty(u,"__esModule",{value:!0}),u.MacDeviceManager=void 0;var f=function(y){function S(){return y.call(this)||this}return m(S,y),S}(d(62).BaseDeviceManager);u.MacDeviceManager=f},583:function(c,u,d){var E,m=this&&this.__extends||(E=function(S,l){return(E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,p){h.__proto__=p}||function(h,p){for(var v in p)Object.prototype.hasOwnProperty.call(p,v)&&(h[v]=p[v])})(S,l)},function(S,l){function h(){this.constructor=S}E(S,l),S.prototype=l===null?Object.create(l):(h.prototype=l.prototype,new h)});Object.defineProperty(u,"__esModule",{value:!0}),u.MobileDeviceManager=void 0;var f=d(603),y=function(S){function l(){return S.call(this)||this}return m(l,S),l.prototype.checkSupportScreenShare=function(){return!1},l.prototype.getScreenTrack=function(h){return new Promise(function(p,v){v(new f.DeviceError(f.DeviceErrorCode.ERROR_SCREENSHARE_NOTSUPPORT,"mobile not support screenshare"))})},l.prototype.getScreenStream=function(h){return new Promise(function(p,v){v(new f.DeviceError(f.DeviceErrorCode.ERROR_SCREENSHARE_NOTSUPPORT,"mobile not support screenshare"))})},l.prototype.createVideoConstraints=function(h){return h.deviceId||h.facingMode||h.width||h.height||h.aspectRatio?{video:{deviceId:h.deviceId,facingMode:h.facingMode,width:h.width,height:h.height,aspectRatio:h.aspectRatio}}:{video:!0}},l}(d(62).BaseDeviceManager);u.MobileDeviceManager=y},935:function(c,u,d){var E,m=this&&this.__extends||(E=function(y,S){return(E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&(l[p]=h[p])})(y,S)},function(y,S){function l(){this.constructor=y}E(y,S),y.prototype=S===null?Object.create(S):(l.prototype=S.prototype,new l)});Object.defineProperty(u,"__esModule",{value:!0}),u.WindowsDeviceManager=void 0;var f=function(y){function S(){return y.call(this)||this}return m(S,y),S}(d(62).BaseDeviceManager);u.WindowsDeviceManager=f},607:function(c,u,d){var E=this&&this.__createBinding||(Object.create?function(y,S,l,h){h===void 0&&(h=l),Object.defineProperty(y,h,{enumerable:!0,get:function(){return S[l]}})}:function(y,S,l,h){h===void 0&&(h=l),y[h]=S[l]}),m=this&&this.__exportStar||function(y,S){for(var l in y)l==="default"||Object.prototype.hasOwnProperty.call(S,l)||E(S,y,l)};Object.defineProperty(u,"__esModule",{value:!0}),u.BrowserDeviceManager=void 0;var f=d(304);Object.defineProperty(u,"BrowserDeviceManager",{enumerable:!0,get:function(){return f.BrowserDeviceManager}}),m(d(873),u),window&&(window.BrowserDeviceManager=f.BrowserDeviceManager)},610:(c,u,d)=>{Object.defineProperty(u,"__esModule",{value:!0}),u.LinkUtil=void 0;var E,m=d(603),f=d(261),y=d(54);(function(v){v[v.Windows=0]="Windows",v[v.MacOS=1]="MacOS",v[v.Other=2]="Other"})(E||(E={}));var S="ms-settings:",l="x-apple.systempreferences:com.apple.preference.security?",h={SYS_MIC:[S+"privacy-microphone",l+"Privacy_Microphone"],SYS_CAMERA:[S+"privacy-webcam",l+"Privacy_Camera"],SYS_SCREENSHARE:["",l+"Privacy_ScreenCapture"]},p=function(){function v(){f||console.error("SystemUtil is not found"),this.systemType=this.getSystemType()}return v.prototype.getRelatedLink=function(g){var R="",_=this.systemType;switch(g){case m.DeviceErrorCode.ERROR_DEVICE_AUDIODEVICE_NOTFOUND:case m.DeviceErrorCode.ERROR_DEVICE_AUDIODEVICE_NOTREADABLE:R=h.SYS_MIC[_];break;case m.DeviceErrorCode.ERROR_DEVICE_VIDEODEVICE_NOTFOUND:case m.DeviceErrorCode.ERROR_DEVICE_VIDEODEVICE_NOTREADABLE:R=h.SYS_CAMERA[_];break;case m.DeviceErrorCode.ERROR_SCREENSHARE_UNKNOWNERRO:case m.DeviceErrorCode.ERROR_SCREENSHARE_NOPERMISSION:R=h.SYS_SCREENSHARE[_];break;case m.DeviceErrorCode.ERROR_DEVICE_AUDIODEVICE_NOTALLOWED:case m.DeviceErrorCode.ERROR_DEVICE_VIDEODEVICE_NOTALLOWED:y.isChrome?R=this.getChromeResetLink():y.isEdge&&(R=this.getEdgeResetLink());break;default:R=""}return R},v.prototype.getSystemType=function(){return f.isWindows?E.Windows:f.isMacOS?E.MacOS:E.Other},v.prototype.getChromeResetLink=function(){return"chrome://settings/content/siteDetails?site="+encodeURIComponent(window.location.origin)},v.prototype.getEdgeResetLink=function(){return"edge://settings/content/siteDetails?site="+encodeURIComponent(window.location.origin)},v}();u.LinkUtil=p},101:(c,u)=>{var d;Object.defineProperty(u,"__esModule",{value:!0}),u.SystemUtil=void 0,function(m){m[m.Unknown=0]="Unknown",m[m.MacOS=1]="MacOS",m[m.Windows=2]="Windows",m[m.Android=3]="Android",m[m.Iphone=4]="Iphone",m[m.Ipad=5]="Ipad",m[m.Linux=6]="Linux"}(d||(d={}));var E=function(){function m(){this.systemType=d.Unknown,this.getSystemInfo()}return Object.defineProperty(m.prototype,"isIos",{get:function(){return this.systemType===d.Ipad||this.systemType===d.Iphone},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"isAndroid",{get:function(){return this.systemType===d.Android},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"isMacOS",{get:function(){return this.systemType===d.MacOS},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"isWindows",{get:function(){return this.systemType===d.Windows},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"isLinux",{get:function(){return this.systemType===d.Linux},enumerable:!1,configurable:!0}),m.prototype.getSystemInfo=function(){if(navigator&&navigator.userAgent){var f=navigator.userAgent.toLocaleLowerCase();f.indexOf("ipad")>-1?this.systemType=d.Ipad:f.indexOf("iphone")>-1?this.systemType=d.Iphone:f.indexOf("android")>-1?this.systemType=d.Android:f.indexOf("win")>-1?this.systemType=d.Windows:f.indexOf("mac")>-1?this.systemType=d.MacOS:f.indexOf("linux")>-1?this.systemType=d.Linux:f.indexOf("")>-1&&(this.systemType=d.Unknown)}},m}();u.SystemUtil=E},54:c=>{c.exports=window.BrowserUtil},261:c=>{c.exports=window.SystemUtil}},a={};return function c(u){if(a[u])return a[u].exports;var d=a[u]={exports:{}};return s[u].call(d.exports,d,d.exports,c),d.exports}(607)})()},6677:(o,s,a)=>{var c=a(7963);function u(y,S,l,h,p){var v=c.writeRtpDescription(y.kind,S);if(v+=c.writeIceParameters(y.iceGatherer.getLocalParameters()),v+=c.writeDtlsParameters(y.dtlsTransport.getLocalParameters(),l==="offer"?"actpass":p||"active"),v+="a=mid:"+y.mid+`\r
`,y.rtpSender&&y.rtpReceiver?v+=`a=sendrecv\r
`:y.rtpSender?v+=`a=sendonly\r
`:y.rtpReceiver?v+=`a=recvonly\r
`:v+=`a=inactive\r
`,y.rtpSender){var g=y.rtpSender._initialTrackId||y.rtpSender.track.id;y.rtpSender._initialTrackId=g;var R="msid:"+(h?h.id:"-")+" "+g+`\r
`;v+="a="+R,v+="a=ssrc:"+y.sendEncodingParameters[0].ssrc+" "+R,y.sendEncodingParameters[0].rtx&&(v+="a=ssrc:"+y.sendEncodingParameters[0].rtx.ssrc+" "+R,v+="a=ssrc-group:FID "+y.sendEncodingParameters[0].ssrc+" "+y.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return v+="a=ssrc:"+y.sendEncodingParameters[0].ssrc+" cname:"+c.localCName+`\r
`,y.rtpSender&&y.sendEncodingParameters[0].rtx&&(v+="a=ssrc:"+y.sendEncodingParameters[0].rtx.ssrc+" cname:"+c.localCName+`\r
`),v}function d(y,S){var l={codecs:[],headerExtensions:[],fecMechanisms:[]},h=function(v,g){v=parseInt(v,10);for(var R=0;R<g.length;R++)if(g[R].payloadType===v||g[R].preferredPayloadType===v)return g[R]},p=function(v,g,R,_){var w=h(v.parameters.apt,R),k=h(g.parameters.apt,_);return w&&k&&w.name.toLowerCase()===k.name.toLowerCase()};return y.codecs.forEach(function(v){for(var g=0;g<S.codecs.length;g++){var R=S.codecs[g];if(v.name.toLowerCase()===R.name.toLowerCase()&&v.clockRate===R.clockRate){if(v.name.toLowerCase()==="rtx"&&v.parameters&&R.parameters.apt&&!p(v,R,y.codecs,S.codecs))continue;(R=JSON.parse(JSON.stringify(R))).numChannels=Math.min(v.numChannels,R.numChannels),l.codecs.push(R),R.rtcpFeedback=R.rtcpFeedback.filter(function(_){for(var w=0;w<v.rtcpFeedback.length;w++)if(v.rtcpFeedback[w].type===_.type&&v.rtcpFeedback[w].parameter===_.parameter)return!0;return!1});break}}}),y.headerExtensions.forEach(function(v){for(var g=0;g<S.headerExtensions.length;g++){var R=S.headerExtensions[g];if(v.uri===R.uri){l.headerExtensions.push(R);break}}}),l}function E(y,S,l){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[S][y].indexOf(l)!==-1}function m(y,S){var l=y.getRemoteCandidates().find(function(h){return S.foundation===h.foundation&&S.ip===h.ip&&S.port===h.port&&S.priority===h.priority&&S.protocol===h.protocol&&S.type===h.type});return l||y.addRemoteCandidate(S),!l}function f(y,S){var l=new Error(S);return l.name=y,l.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[y],l}o.exports=function(y,S){function l(g,R){R.addTrack(g),R.dispatchEvent(new y.MediaStreamTrackEvent("addtrack",{track:g}))}function h(g,R,_,w){var k=new Event("track");k.track=R,k.receiver=_,k.transceiver={receiver:_},k.streams=w,y.setTimeout(function(){g._dispatchEvent("track",k)})}var p=function(g){var R=this,_=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(k){R[k]=_[k].bind(_)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",g=JSON.parse(JSON.stringify(g||{})),this.usingBundle=g.bundlePolicy==="max-bundle",g.rtcpMuxPolicy==="negotiate")throw f("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(g.rtcpMuxPolicy||(g.rtcpMuxPolicy="require"),g.iceTransportPolicy){case"all":case"relay":break;default:g.iceTransportPolicy="all"}switch(g.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:g.bundlePolicy="balanced"}if(g.iceServers=function(k,O){var C=!1;return(k=JSON.parse(JSON.stringify(k))).filter(function(b){if(b&&(b.urls||b.url)){var A=b.urls||b.url;b.url&&!b.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var T=typeof A=="string";return T&&(A=[A]),A=A.filter(function(M){return M.indexOf("turn:")!==0||M.indexOf("transport=udp")===-1||M.indexOf("turn:[")!==-1||C?M.indexOf("stun:")===0&&O>=14393&&M.indexOf("?transport=udp")===-1:(C=!0,!0)}),delete b.url,b.urls=T?A[0]:A,!!A.length}})}(g.iceServers||[],S),this._iceGatherers=[],g.iceCandidatePoolSize)for(var w=g.iceCandidatePoolSize;w>0;w--)this._iceGatherers.push(new y.RTCIceGatherer({iceServers:g.iceServers,gatherPolicy:g.iceTransportPolicy}));else g.iceCandidatePoolSize=0;this._config=g,this.transceivers=[],this._sdpSessionId=c.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(p.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(p.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),p.prototype.onicecandidate=null,p.prototype.onaddstream=null,p.prototype.ontrack=null,p.prototype.onremovestream=null,p.prototype.onsignalingstatechange=null,p.prototype.oniceconnectionstatechange=null,p.prototype.onconnectionstatechange=null,p.prototype.onicegatheringstatechange=null,p.prototype.onnegotiationneeded=null,p.prototype.ondatachannel=null,p.prototype._dispatchEvent=function(g,R){this._isClosed||(this.dispatchEvent(R),typeof this["on"+g]=="function"&&this["on"+g](R))},p.prototype._emitGatheringStateChange=function(){var g=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",g)},p.prototype.getConfiguration=function(){return this._config},p.prototype.getLocalStreams=function(){return this.localStreams},p.prototype.getRemoteStreams=function(){return this.remoteStreams},p.prototype._createTransceiver=function(g,R){var _=this.transceivers.length>0,w={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:g,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&_)w.iceTransport=this.transceivers[0].iceTransport,w.dtlsTransport=this.transceivers[0].dtlsTransport;else{var k=this._createIceAndDtlsTransports();w.iceTransport=k.iceTransport,w.dtlsTransport=k.dtlsTransport}return R||this.transceivers.push(w),w},p.prototype.addTrack=function(g,R){if(this._isClosed)throw f("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var _;if(this.transceivers.find(function(k){return k.track===g}))throw f("InvalidAccessError","Track already exists.");for(var w=0;w<this.transceivers.length;w++)this.transceivers[w].track||this.transceivers[w].kind!==g.kind||(_=this.transceivers[w]);return _||(_=this._createTransceiver(g.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(R)===-1&&this.localStreams.push(R),_.track=g,_.stream=R,_.rtpSender=new y.RTCRtpSender(g,_.dtlsTransport),_.rtpSender},p.prototype.addStream=function(g){var R=this;if(S>=15025)g.getTracks().forEach(function(w){R.addTrack(w,g)});else{var _=g.clone();g.getTracks().forEach(function(w,k){var O=_.getTracks()[k];w.addEventListener("enabled",function(C){O.enabled=C.enabled})}),_.getTracks().forEach(function(w){R.addTrack(w,_)})}},p.prototype.removeTrack=function(g){if(this._isClosed)throw f("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(g instanceof y.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var R=this.transceivers.find(function(w){return w.rtpSender===g});if(!R)throw f("InvalidAccessError","Sender was not created by this connection.");var _=R.stream;R.rtpSender.stop(),R.rtpSender=null,R.track=null,R.stream=null,this.transceivers.map(function(w){return w.stream}).indexOf(_)===-1&&this.localStreams.indexOf(_)>-1&&this.localStreams.splice(this.localStreams.indexOf(_),1),this._maybeFireNegotiationNeeded()},p.prototype.removeStream=function(g){var R=this;g.getTracks().forEach(function(_){var w=R.getSenders().find(function(k){return k.track===_});w&&R.removeTrack(w)})},p.prototype.getSenders=function(){return this.transceivers.filter(function(g){return!!g.rtpSender}).map(function(g){return g.rtpSender})},p.prototype.getReceivers=function(){return this.transceivers.filter(function(g){return!!g.rtpReceiver}).map(function(g){return g.rtpReceiver})},p.prototype._createIceGatherer=function(g,R){var _=this;if(R&&g>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var w=new y.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(w,"state",{value:"new",writable:!0}),this.transceivers[g].bufferedCandidateEvents=[],this.transceivers[g].bufferCandidates=function(k){var O=!k.candidate||Object.keys(k.candidate).length===0;w.state=O?"completed":"gathering",_.transceivers[g].bufferedCandidateEvents!==null&&_.transceivers[g].bufferedCandidateEvents.push(k)},w.addEventListener("localcandidate",this.transceivers[g].bufferCandidates),w},p.prototype._gather=function(g,R){var _=this,w=this.transceivers[R].iceGatherer;if(!w.onlocalcandidate){var k=this.transceivers[R].bufferedCandidateEvents;this.transceivers[R].bufferedCandidateEvents=null,w.removeEventListener("localcandidate",this.transceivers[R].bufferCandidates),w.onlocalcandidate=function(O){if(!(_.usingBundle&&R>0)){var C=new Event("icecandidate");C.candidate={sdpMid:g,sdpMLineIndex:R};var b=O.candidate,A=!b||Object.keys(b).length===0;if(A)w.state!=="new"&&w.state!=="gathering"||(w.state="completed");else{w.state==="new"&&(w.state="gathering"),b.component=1,b.ufrag=w.getLocalParameters().usernameFragment;var T=c.writeCandidate(b);C.candidate=Object.assign(C.candidate,c.parseCandidate(T)),C.candidate.candidate=T,C.candidate.toJSON=function(){return{candidate:C.candidate.candidate,sdpMid:C.candidate.sdpMid,sdpMLineIndex:C.candidate.sdpMLineIndex,usernameFragment:C.candidate.usernameFragment}}}var M=c.getMediaSections(_._localDescription.sdp);M[C.candidate.sdpMLineIndex]+=A?`a=end-of-candidates\r
`:"a="+C.candidate.candidate+`\r
`,_._localDescription.sdp=c.getDescription(_._localDescription.sdp)+M.join("");var D=_.transceivers.every(function(N){return N.iceGatherer&&N.iceGatherer.state==="completed"});_.iceGatheringState!=="gathering"&&(_.iceGatheringState="gathering",_._emitGatheringStateChange()),A||_._dispatchEvent("icecandidate",C),D&&(_._dispatchEvent("icecandidate",new Event("icecandidate")),_.iceGatheringState="complete",_._emitGatheringStateChange())}},y.setTimeout(function(){k.forEach(function(O){w.onlocalcandidate(O)})},0)}},p.prototype._createIceAndDtlsTransports=function(){var g=this,R=new y.RTCIceTransport(null);R.onicestatechange=function(){g._updateIceConnectionState(),g._updateConnectionState()};var _=new y.RTCDtlsTransport(R);return _.ondtlsstatechange=function(){g._updateConnectionState()},_.onerror=function(){Object.defineProperty(_,"state",{value:"failed",writable:!0}),g._updateConnectionState()},{iceTransport:R,dtlsTransport:_}},p.prototype._disposeIceAndDtlsTransports=function(g){var R=this.transceivers[g].iceGatherer;R&&(delete R.onlocalcandidate,delete this.transceivers[g].iceGatherer);var _=this.transceivers[g].iceTransport;_&&(delete _.onicestatechange,delete this.transceivers[g].iceTransport);var w=this.transceivers[g].dtlsTransport;w&&(delete w.ondtlsstatechange,delete w.onerror,delete this.transceivers[g].dtlsTransport)},p.prototype._transceive=function(g,R,_){var w=d(g.localCapabilities,g.remoteCapabilities);R&&g.rtpSender&&(w.encodings=g.sendEncodingParameters,w.rtcp={cname:c.localCName,compound:g.rtcpParameters.compound},g.recvEncodingParameters.length&&(w.rtcp.ssrc=g.recvEncodingParameters[0].ssrc),g.rtpSender.send(w)),_&&g.rtpReceiver&&w.codecs.length>0&&(g.kind==="video"&&g.recvEncodingParameters&&S<15019&&g.recvEncodingParameters.forEach(function(k){delete k.rtx}),g.recvEncodingParameters.length?w.encodings=g.recvEncodingParameters:w.encodings=[{}],w.rtcp={compound:g.rtcpParameters.compound},g.rtcpParameters.cname&&(w.rtcp.cname=g.rtcpParameters.cname),g.sendEncodingParameters.length&&(w.rtcp.ssrc=g.sendEncodingParameters[0].ssrc),g.rtpReceiver.receive(w))},p.prototype.setLocalDescription=function(g){var R,_,w=this;if(["offer","answer"].indexOf(g.type)===-1)return Promise.reject(f("TypeError",'Unsupported type "'+g.type+'"'));if(!E("setLocalDescription",g.type,w.signalingState)||w._isClosed)return Promise.reject(f("InvalidStateError","Can not set local "+g.type+" in state "+w.signalingState));if(g.type==="offer")R=c.splitSections(g.sdp),_=R.shift(),R.forEach(function(O,C){var b=c.parseRtpParameters(O);w.transceivers[C].localCapabilities=b}),w.transceivers.forEach(function(O,C){w._gather(O.mid,C)});else if(g.type==="answer"){R=c.splitSections(w._remoteDescription.sdp),_=R.shift();var k=c.matchPrefix(_,"a=ice-lite").length>0;R.forEach(function(O,C){var b=w.transceivers[C],A=b.iceGatherer,T=b.iceTransport,M=b.dtlsTransport,D=b.localCapabilities,N=b.remoteCapabilities;if(!(c.isRejected(O)&&c.matchPrefix(O,"a=bundle-only").length===0)&&!b.rejected){var P=c.getIceParameters(O,_),I=c.getDtlsParameters(O,_);k&&(I.role="server"),w.usingBundle&&C!==0||(w._gather(b.mid,C),T.state==="new"&&T.start(A,P,k?"controlling":"controlled"),M.state==="new"&&M.start(I));var L=d(D,N);w._transceive(b,L.codecs.length>0,!1)}})}return w._localDescription={type:g.type,sdp:g.sdp},g.type==="offer"?w._updateSignalingState("have-local-offer"):w._updateSignalingState("stable"),Promise.resolve()},p.prototype.setRemoteDescription=function(g){var R=this;if(["offer","answer"].indexOf(g.type)===-1)return Promise.reject(f("TypeError",'Unsupported type "'+g.type+'"'));if(!E("setRemoteDescription",g.type,R.signalingState)||R._isClosed)return Promise.reject(f("InvalidStateError","Can not set remote "+g.type+" in state "+R.signalingState));var _={};R.remoteStreams.forEach(function(T){_[T.id]=T});var w=[],k=c.splitSections(g.sdp),O=k.shift(),C=c.matchPrefix(O,"a=ice-lite").length>0,b=c.matchPrefix(O,"a=group:BUNDLE ").length>0;R.usingBundle=b;var A=c.matchPrefix(O,"a=ice-options:")[0];return R.canTrickleIceCandidates=!!A&&A.substr(14).split(" ").indexOf("trickle")>=0,k.forEach(function(T,M){var D=c.splitLines(T),N=c.getKind(T),P=c.isRejected(T)&&c.matchPrefix(T,"a=bundle-only").length===0,I=D[0].substr(2).split(" ")[2],L=c.getDirection(T,O),W=c.parseMsid(T),U=c.getMid(T)||c.generateIdentifier();if(P||N==="application"&&(I==="DTLS/SCTP"||I==="UDP/DTLS/SCTP"))R.transceivers[M]={mid:U,kind:N,protocol:I,rejected:!0};else{var x,V,j,H,z,K,$,Z,ne;!P&&R.transceivers[M]&&R.transceivers[M].rejected&&(R.transceivers[M]=R._createTransceiver(N,!0));var te,ae,le=c.parseRtpParameters(T);P||(te=c.getIceParameters(T,O),(ae=c.getDtlsParameters(T,O)).role="client"),$=c.parseRtpEncodingParameters(T);var fe=c.parseRtcpParameters(T),ve=c.matchPrefix(T,"a=end-of-candidates",O).length>0,Se=c.matchPrefix(T,"a=candidate:").map(function(_e){return c.parseCandidate(_e)}).filter(function(_e){return _e.component===1});if((g.type==="offer"||g.type==="answer")&&!P&&b&&M>0&&R.transceivers[M]&&(R._disposeIceAndDtlsTransports(M),R.transceivers[M].iceGatherer=R.transceivers[0].iceGatherer,R.transceivers[M].iceTransport=R.transceivers[0].iceTransport,R.transceivers[M].dtlsTransport=R.transceivers[0].dtlsTransport,R.transceivers[M].rtpSender&&R.transceivers[M].rtpSender.setTransport(R.transceivers[0].dtlsTransport),R.transceivers[M].rtpReceiver&&R.transceivers[M].rtpReceiver.setTransport(R.transceivers[0].dtlsTransport)),g.type!=="offer"||P)g.type==="answer"&&!P&&(V=(x=R.transceivers[M]).iceGatherer,j=x.iceTransport,H=x.dtlsTransport,z=x.rtpReceiver,K=x.sendEncodingParameters,Z=x.localCapabilities,R.transceivers[M].recvEncodingParameters=$,R.transceivers[M].remoteCapabilities=le,R.transceivers[M].rtcpParameters=fe,Se.length&&j.state==="new"&&(!C&&!ve||b&&M!==0?Se.forEach(function(_e){m(x.iceTransport,_e)}):j.setRemoteCandidates(Se)),b&&M!==0||(j.state==="new"&&j.start(V,te,"controlling"),H.state==="new"&&H.start(ae)),!d(x.localCapabilities,x.remoteCapabilities).codecs.filter(function(_e){return _e.name.toLowerCase()==="rtx"}).length&&x.sendEncodingParameters[0].rtx&&delete x.sendEncodingParameters[0].rtx,R._transceive(x,L==="sendrecv"||L==="recvonly",L==="sendrecv"||L==="sendonly"),!z||L!=="sendrecv"&&L!=="sendonly"?delete x.rtpReceiver:(ne=z.track,W?(_[W.stream]||(_[W.stream]=new y.MediaStream),l(ne,_[W.stream]),w.push([ne,z,_[W.stream]])):(_.default||(_.default=new y.MediaStream),l(ne,_.default),w.push([ne,z,_.default]))));else{(x=R.transceivers[M]||R._createTransceiver(N)).mid=U,x.iceGatherer||(x.iceGatherer=R._createIceGatherer(M,b)),Se.length&&x.iceTransport.state==="new"&&(!ve||b&&M!==0?Se.forEach(function(_e){m(x.iceTransport,_e)}):x.iceTransport.setRemoteCandidates(Se)),Z=y.RTCRtpReceiver.getCapabilities(N),S<15019&&(Z.codecs=Z.codecs.filter(function(_e){return _e.name!=="rtx"})),K=x.sendEncodingParameters||[{ssrc:1001*(2*M+2)}];var be,Me=!1;L==="sendrecv"||L==="sendonly"?(Me=!x.rtpReceiver,z=x.rtpReceiver||new y.RTCRtpReceiver(x.dtlsTransport,N),Me&&(ne=z.track,W&&W.stream==="-"||(W?(_[W.stream]||(_[W.stream]=new y.MediaStream,Object.defineProperty(_[W.stream],"id",{get:function(){return W.stream}})),Object.defineProperty(ne,"id",{get:function(){return W.track}}),be=_[W.stream]):(_.default||(_.default=new y.MediaStream),be=_.default)),be&&(l(ne,be),x.associatedRemoteMediaStreams.push(be)),w.push([ne,z,be]))):x.rtpReceiver&&x.rtpReceiver.track&&(x.associatedRemoteMediaStreams.forEach(function(_e){var ke=_e.getTracks().find(function(Pe){return Pe.id===x.rtpReceiver.track.id});ke&&function(Pe,Le){Le.removeTrack(Pe),Le.dispatchEvent(new y.MediaStreamTrackEvent("removetrack",{track:Pe}))}(ke,_e)}),x.associatedRemoteMediaStreams=[]),x.localCapabilities=Z,x.remoteCapabilities=le,x.rtpReceiver=z,x.rtcpParameters=fe,x.sendEncodingParameters=K,x.recvEncodingParameters=$,R._transceive(R.transceivers[M],!1,Me)}}}),R._dtlsRole===void 0&&(R._dtlsRole=g.type==="offer"?"active":"passive"),R._remoteDescription={type:g.type,sdp:g.sdp},g.type==="offer"?R._updateSignalingState("have-remote-offer"):R._updateSignalingState("stable"),Object.keys(_).forEach(function(T){var M=_[T];if(M.getTracks().length){if(R.remoteStreams.indexOf(M)===-1){R.remoteStreams.push(M);var D=new Event("addstream");D.stream=M,y.setTimeout(function(){R._dispatchEvent("addstream",D)})}w.forEach(function(N){var P=N[0],I=N[1];M.id===N[2].id&&h(R,P,I,[M])})}}),w.forEach(function(T){T[2]||h(R,T[0],T[1],[])}),y.setTimeout(function(){R&&R.transceivers&&R.transceivers.forEach(function(T){T.iceTransport&&T.iceTransport.state==="new"&&T.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),T.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},p.prototype.close=function(){this.transceivers.forEach(function(g){g.iceTransport&&g.iceTransport.stop(),g.dtlsTransport&&g.dtlsTransport.stop(),g.rtpSender&&g.rtpSender.stop(),g.rtpReceiver&&g.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},p.prototype._updateSignalingState=function(g){this.signalingState=g;var R=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",R)},p.prototype._maybeFireNegotiationNeeded=function(){var g=this;this.signalingState==="stable"&&this.needNegotiation!==!0&&(this.needNegotiation=!0,y.setTimeout(function(){if(g.needNegotiation){g.needNegotiation=!1;var R=new Event("negotiationneeded");g._dispatchEvent("negotiationneeded",R)}},0))},p.prototype._updateIceConnectionState=function(){var g,R={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(w){w.iceTransport&&!w.rejected&&R[w.iceTransport.state]++}),g="new",R.failed>0?g="failed":R.checking>0?g="checking":R.disconnected>0?g="disconnected":R.new>0?g="new":R.connected>0?g="connected":R.completed>0&&(g="completed"),g!==this.iceConnectionState){this.iceConnectionState=g;var _=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",_)}},p.prototype._updateConnectionState=function(){var g,R={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(w){w.iceTransport&&w.dtlsTransport&&!w.rejected&&(R[w.iceTransport.state]++,R[w.dtlsTransport.state]++)}),R.connected+=R.completed,g="new",R.failed>0?g="failed":R.connecting>0?g="connecting":R.disconnected>0?g="disconnected":R.new>0?g="new":R.connected>0&&(g="connected"),g!==this.connectionState){this.connectionState=g;var _=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",_)}},p.prototype.createOffer=function(){var g=this;if(g._isClosed)return Promise.reject(f("InvalidStateError","Can not call createOffer after close"));var R=g.transceivers.filter(function(C){return C.kind==="audio"}).length,_=g.transceivers.filter(function(C){return C.kind==="video"}).length,w=arguments[0];if(w){if(w.mandatory||w.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");w.offerToReceiveAudio!==void 0&&(R=w.offerToReceiveAudio===!0?1:w.offerToReceiveAudio===!1?0:w.offerToReceiveAudio),w.offerToReceiveVideo!==void 0&&(_=w.offerToReceiveVideo===!0?1:w.offerToReceiveVideo===!1?0:w.offerToReceiveVideo)}for(g.transceivers.forEach(function(C){C.kind==="audio"?--R<0&&(C.wantReceive=!1):C.kind==="video"&&--_<0&&(C.wantReceive=!1)});R>0||_>0;)R>0&&(g._createTransceiver("audio"),R--),_>0&&(g._createTransceiver("video"),_--);var k=c.writeSessionBoilerplate(g._sdpSessionId,g._sdpSessionVersion++);g.transceivers.forEach(function(C,b){var A=C.track,T=C.kind,M=C.mid||c.generateIdentifier();C.mid=M,C.iceGatherer||(C.iceGatherer=g._createIceGatherer(b,g.usingBundle));var D=y.RTCRtpSender.getCapabilities(T);S<15019&&(D.codecs=D.codecs.filter(function(P){return P.name!=="rtx"})),D.codecs.forEach(function(P){P.name==="H264"&&P.parameters["level-asymmetry-allowed"]===void 0&&(P.parameters["level-asymmetry-allowed"]="1"),C.remoteCapabilities&&C.remoteCapabilities.codecs&&C.remoteCapabilities.codecs.forEach(function(I){P.name.toLowerCase()===I.name.toLowerCase()&&P.clockRate===I.clockRate&&(P.preferredPayloadType=I.payloadType)})}),D.headerExtensions.forEach(function(P){(C.remoteCapabilities&&C.remoteCapabilities.headerExtensions||[]).forEach(function(I){P.uri===I.uri&&(P.id=I.id)})});var N=C.sendEncodingParameters||[{ssrc:1001*(2*b+1)}];A&&S>=15019&&T==="video"&&!N[0].rtx&&(N[0].rtx={ssrc:N[0].ssrc+1}),C.wantReceive&&(C.rtpReceiver=new y.RTCRtpReceiver(C.dtlsTransport,T)),C.localCapabilities=D,C.sendEncodingParameters=N}),g._config.bundlePolicy!=="max-compat"&&(k+="a=group:BUNDLE "+g.transceivers.map(function(C){return C.mid}).join(" ")+`\r
`),k+=`a=ice-options:trickle\r
`,g.transceivers.forEach(function(C,b){k+=u(C,C.localCapabilities,"offer",C.stream,g._dtlsRole),k+=`a=rtcp-rsize\r
`,!C.iceGatherer||g.iceGatheringState==="new"||b!==0&&g.usingBundle||(C.iceGatherer.getLocalCandidates().forEach(function(A){A.component=1,k+="a="+c.writeCandidate(A)+`\r
`}),C.iceGatherer.state==="completed"&&(k+=`a=end-of-candidates\r
`))});var O=new y.RTCSessionDescription({type:"offer",sdp:k});return Promise.resolve(O)},p.prototype.createAnswer=function(){var g=this;if(g._isClosed)return Promise.reject(f("InvalidStateError","Can not call createAnswer after close"));if(g.signalingState!=="have-remote-offer"&&g.signalingState!=="have-local-pranswer")return Promise.reject(f("InvalidStateError","Can not call createAnswer in signalingState "+g.signalingState));var R=c.writeSessionBoilerplate(g._sdpSessionId,g._sdpSessionVersion++);g.usingBundle&&(R+="a=group:BUNDLE "+g.transceivers.map(function(k){return k.mid}).join(" ")+`\r
`),R+=`a=ice-options:trickle\r
`;var _=c.getMediaSections(g._remoteDescription.sdp).length;g.transceivers.forEach(function(k,O){if(!(O+1>_)){if(k.rejected)return k.kind==="application"?k.protocol==="DTLS/SCTP"?R+=`m=application 0 DTLS/SCTP 5000\r
`:R+="m=application 0 "+k.protocol+` webrtc-datachannel\r
`:k.kind==="audio"?R+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:k.kind==="video"&&(R+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),void(R+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+k.mid+`\r
`);var C;k.stream&&(k.kind==="audio"?C=k.stream.getAudioTracks()[0]:k.kind==="video"&&(C=k.stream.getVideoTracks()[0]),C&&S>=15019&&k.kind==="video"&&!k.sendEncodingParameters[0].rtx&&(k.sendEncodingParameters[0].rtx={ssrc:k.sendEncodingParameters[0].ssrc+1}));var b=d(k.localCapabilities,k.remoteCapabilities);!b.codecs.filter(function(A){return A.name.toLowerCase()==="rtx"}).length&&k.sendEncodingParameters[0].rtx&&delete k.sendEncodingParameters[0].rtx,R+=u(k,b,"answer",k.stream,g._dtlsRole),k.rtcpParameters&&k.rtcpParameters.reducedSize&&(R+=`a=rtcp-rsize\r
`)}});var w=new y.RTCSessionDescription({type:"answer",sdp:R});return Promise.resolve(w)},p.prototype.addIceCandidate=function(g){var R,_=this;return g&&g.sdpMLineIndex===void 0&&!g.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(w,k){if(!_._remoteDescription)return k(f("InvalidStateError","Can not add ICE candidate without a remote description"));if(g&&g.candidate!==""){var O=g.sdpMLineIndex;if(g.sdpMid){for(var C=0;C<_.transceivers.length;C++)if(_.transceivers[C].mid===g.sdpMid){O=C;break}}var b=_.transceivers[O];if(!b)return k(f("OperationError","Can not add ICE candidate"));if(b.rejected)return w();var A=Object.keys(g.candidate).length>0?c.parseCandidate(g.candidate):{};if(A.protocol==="tcp"&&(A.port===0||A.port===9)||A.component&&A.component!==1)return w();if((O===0||O>0&&b.iceTransport!==_.transceivers[0].iceTransport)&&!m(b.iceTransport,A))return k(f("OperationError","Can not add ICE candidate"));var T=g.candidate.trim();T.indexOf("a=")===0&&(T=T.substr(2)),(R=c.getMediaSections(_._remoteDescription.sdp))[O]+="a="+(A.type?T:"end-of-candidates")+`\r
`,_._remoteDescription.sdp=c.getDescription(_._remoteDescription.sdp)+R.join("")}else for(var M=0;M<_.transceivers.length&&(_.transceivers[M].rejected||(_.transceivers[M].iceTransport.addRemoteCandidate({}),(R=c.getMediaSections(_._remoteDescription.sdp))[M]+=`a=end-of-candidates\r
`,_._remoteDescription.sdp=c.getDescription(_._remoteDescription.sdp)+R.join(""),!_.usingBundle));M++);w()})},p.prototype.getStats=function(g){if(g&&g instanceof y.MediaStreamTrack){var R=null;if(this.transceivers.forEach(function(w){w.rtpSender&&w.rtpSender.track===g?R=w.rtpSender:w.rtpReceiver&&w.rtpReceiver.track===g&&(R=w.rtpReceiver)}),!R)throw f("InvalidAccessError","Invalid selector.");return R.getStats()}var _=[];return this.transceivers.forEach(function(w){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(k){w[k]&&_.push(w[k].getStats())})}),Promise.all(_).then(function(w){var k=new Map;return w.forEach(function(O){O.forEach(function(C){k.set(C.id,C)})}),k})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(g){var R=y[g];if(R&&R.prototype&&R.prototype.getStats){var _=R.prototype.getStats;R.prototype.getStats=function(){return _.apply(this).then(function(w){var k=new Map;return Object.keys(w).forEach(function(O){var C;w[O].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(C=w[O]).type]||C.type,k.set(O,w[O])}),k})}}});var v=["createOffer","createAnswer"];return v.forEach(function(g){var R=p.prototype[g];p.prototype[g]=function(){var _=arguments;return typeof _[0]=="function"||typeof _[1]=="function"?R.apply(this,[arguments[2]]).then(function(w){typeof _[0]=="function"&&_[0].apply(null,[w])},function(w){typeof _[1]=="function"&&_[1].apply(null,[w])}):R.apply(this,arguments)}}),(v=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(g){var R=p.prototype[g];p.prototype[g]=function(){var _=arguments;return typeof _[1]=="function"||typeof _[2]=="function"?R.apply(this,arguments).then(function(){typeof _[1]=="function"&&_[1].apply(null)},function(w){typeof _[2]=="function"&&_[2].apply(null,[w])}):R.apply(this,arguments)}}),["getStats"].forEach(function(g){var R=p.prototype[g];p.prototype[g]=function(){var _=arguments;return typeof _[1]=="function"?R.apply(this,arguments).then(function(){typeof _[1]=="function"&&_[1].apply(null)}):R.apply(this,arguments)}}),p}},7963:o=>{var s={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};s.localCName=s.generateIdentifier(),s.splitLines=function(a){return a.trim().split(`
`).map(function(c){return c.trim()})},s.splitSections=function(a){return a.split(`
m=`).map(function(c,u){return(u>0?"m="+c:c).trim()+`\r
`})},s.getDescription=function(a){var c=s.splitSections(a);return c&&c[0]},s.getMediaSections=function(a){var c=s.splitSections(a);return c.shift(),c},s.matchPrefix=function(a,c){return s.splitLines(a).filter(function(u){return u.indexOf(c)===0})},s.parseCandidate=function(a){for(var c,u={foundation:(c=a.indexOf("a=candidate:")===0?a.substring(12).split(" "):a.substring(10).split(" "))[0],component:parseInt(c[1],10),protocol:c[2].toLowerCase(),priority:parseInt(c[3],10),ip:c[4],address:c[4],port:parseInt(c[5],10),type:c[7]},d=8;d<c.length;d+=2)switch(c[d]){case"raddr":u.relatedAddress=c[d+1];break;case"rport":u.relatedPort=parseInt(c[d+1],10);break;case"tcptype":u.tcpType=c[d+1];break;case"ufrag":u.ufrag=c[d+1],u.usernameFragment=c[d+1];break;default:u[c[d]]=c[d+1]}return u},s.writeCandidate=function(a){var c=[];c.push(a.foundation),c.push(a.component),c.push(a.protocol.toUpperCase()),c.push(a.priority),c.push(a.address||a.ip),c.push(a.port);var u=a.type;return c.push("typ"),c.push(u),u!=="host"&&a.relatedAddress&&a.relatedPort&&(c.push("raddr"),c.push(a.relatedAddress),c.push("rport"),c.push(a.relatedPort)),a.tcpType&&a.protocol.toLowerCase()==="tcp"&&(c.push("tcptype"),c.push(a.tcpType)),(a.usernameFragment||a.ufrag)&&(c.push("ufrag"),c.push(a.usernameFragment||a.ufrag)),"candidate:"+c.join(" ")},s.parseIceOptions=function(a){return a.substr(14).split(" ")},s.parseRtpMap=function(a){var c=a.substr(9).split(" "),u={payloadType:parseInt(c.shift(),10)};return c=c[0].split("/"),u.name=c[0],u.clockRate=parseInt(c[1],10),u.channels=c.length===3?parseInt(c[2],10):1,u.numChannels=u.channels,u},s.writeRtpMap=function(a){var c=a.payloadType;a.preferredPayloadType!==void 0&&(c=a.preferredPayloadType);var u=a.channels||a.numChannels||1;return"a=rtpmap:"+c+" "+a.name+"/"+a.clockRate+(u!==1?"/"+u:"")+`\r
`},s.parseExtmap=function(a){var c=a.substr(9).split(" ");return{id:parseInt(c[0],10),direction:c[0].indexOf("/")>0?c[0].split("/")[1]:"sendrecv",uri:c[1]}},s.writeExtmap=function(a){return"a=extmap:"+(a.id||a.preferredId)+(a.direction&&a.direction!=="sendrecv"?"/"+a.direction:"")+" "+a.uri+`\r
`},s.parseFmtp=function(a){for(var c,u={},d=a.substr(a.indexOf(" ")+1).split(";"),E=0;E<d.length;E++)u[(c=d[E].trim().split("="))[0].trim()]=c[1];return u},s.writeFmtp=function(a){var c="",u=a.payloadType;if(a.preferredPayloadType!==void 0&&(u=a.preferredPayloadType),a.parameters&&Object.keys(a.parameters).length){var d=[];Object.keys(a.parameters).forEach(function(E){a.parameters[E]?d.push(E+"="+a.parameters[E]):d.push(E)}),c+="a=fmtp:"+u+" "+d.join(";")+`\r
`}return c},s.parseRtcpFb=function(a){var c=a.substr(a.indexOf(" ")+1).split(" ");return{type:c.shift(),parameter:c.join(" ")}},s.writeRtcpFb=function(a){var c="",u=a.payloadType;return a.preferredPayloadType!==void 0&&(u=a.preferredPayloadType),a.rtcpFeedback&&a.rtcpFeedback.length&&a.rtcpFeedback.forEach(function(d){c+="a=rtcp-fb:"+u+" "+d.type+(d.parameter&&d.parameter.length?" "+d.parameter:"")+`\r
`}),c},s.parseSsrcMedia=function(a){var c=a.indexOf(" "),u={ssrc:parseInt(a.substr(7,c-7),10)},d=a.indexOf(":",c);return d>-1?(u.attribute=a.substr(c+1,d-c-1),u.value=a.substr(d+1)):u.attribute=a.substr(c+1),u},s.parseSsrcGroup=function(a){var c=a.substr(13).split(" ");return{semantics:c.shift(),ssrcs:c.map(function(u){return parseInt(u,10)})}},s.getMid=function(a){var c=s.matchPrefix(a,"a=mid:")[0];if(c)return c.substr(6)},s.parseFingerprint=function(a){var c=a.substr(14).split(" ");return{algorithm:c[0].toLowerCase(),value:c[1]}},s.getDtlsParameters=function(a,c){return{role:"auto",fingerprints:s.matchPrefix(a+c,"a=fingerprint:").map(s.parseFingerprint)}},s.writeDtlsParameters=function(a,c){var u="a=setup:"+c+`\r
`;return a.fingerprints.forEach(function(d){u+="a=fingerprint:"+d.algorithm+" "+d.value+`\r
`}),u},s.parseCryptoLine=function(a){var c=a.substr(9).split(" ");return{tag:parseInt(c[0],10),cryptoSuite:c[1],keyParams:c[2],sessionParams:c.slice(3)}},s.writeCryptoLine=function(a){return"a=crypto:"+a.tag+" "+a.cryptoSuite+" "+(typeof a.keyParams=="object"?s.writeCryptoKeyParams(a.keyParams):a.keyParams)+(a.sessionParams?" "+a.sessionParams.join(" "):"")+`\r
`},s.parseCryptoKeyParams=function(a){if(a.indexOf("inline:")!==0)return null;var c=a.substr(7).split("|");return{keyMethod:"inline",keySalt:c[0],lifeTime:c[1],mkiValue:c[2]?c[2].split(":")[0]:void 0,mkiLength:c[2]?c[2].split(":")[1]:void 0}},s.writeCryptoKeyParams=function(a){return a.keyMethod+":"+a.keySalt+(a.lifeTime?"|"+a.lifeTime:"")+(a.mkiValue&&a.mkiLength?"|"+a.mkiValue+":"+a.mkiLength:"")},s.getCryptoParameters=function(a,c){return s.matchPrefix(a+c,"a=crypto:").map(s.parseCryptoLine)},s.getIceParameters=function(a,c){var u=s.matchPrefix(a+c,"a=ice-ufrag:")[0],d=s.matchPrefix(a+c,"a=ice-pwd:")[0];return u&&d?{usernameFragment:u.substr(12),password:d.substr(10)}:null},s.writeIceParameters=function(a){return"a=ice-ufrag:"+a.usernameFragment+`\r
a=ice-pwd:`+a.password+`\r
`},s.parseRtpParameters=function(a){for(var c={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},u=s.splitLines(a)[0].split(" "),d=3;d<u.length;d++){var E=u[d],m=s.matchPrefix(a,"a=rtpmap:"+E+" ")[0];if(m){var f=s.parseRtpMap(m),y=s.matchPrefix(a,"a=fmtp:"+E+" ");switch(f.parameters=y.length?s.parseFmtp(y[0]):{},f.rtcpFeedback=s.matchPrefix(a,"a=rtcp-fb:"+E+" ").map(s.parseRtcpFb),c.codecs.push(f),f.name.toUpperCase()){case"RED":case"ULPFEC":c.fecMechanisms.push(f.name.toUpperCase())}}}return s.matchPrefix(a,"a=extmap:").forEach(function(S){c.headerExtensions.push(s.parseExtmap(S))}),c},s.writeRtpDescription=function(a,c){var u="";u+="m="+a+" ",u+=c.codecs.length>0?"9":"0",u+=" UDP/TLS/RTP/SAVPF ",u+=c.codecs.map(function(E){return E.preferredPayloadType!==void 0?E.preferredPayloadType:E.payloadType}).join(" ")+`\r
`,u+=`c=IN IP4 0.0.0.0\r
`,u+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,c.codecs.forEach(function(E){u+=s.writeRtpMap(E),u+=s.writeFmtp(E),u+=s.writeRtcpFb(E)});var d=0;return c.codecs.forEach(function(E){E.maxptime>d&&(d=E.maxptime)}),d>0&&(u+="a=maxptime:"+d+`\r
`),u+=`a=rtcp-mux\r
`,c.headerExtensions&&c.headerExtensions.forEach(function(E){u+=s.writeExtmap(E)}),u},s.parseRtpEncodingParameters=function(a){var c,u=[],d=s.parseRtpParameters(a),E=d.fecMechanisms.indexOf("RED")!==-1,m=d.fecMechanisms.indexOf("ULPFEC")!==-1,f=s.matchPrefix(a,"a=ssrc:").map(function(h){return s.parseSsrcMedia(h)}).filter(function(h){return h.attribute==="cname"}),y=f.length>0&&f[0].ssrc,S=s.matchPrefix(a,"a=ssrc-group:FID").map(function(h){return h.substr(17).split(" ").map(function(p){return parseInt(p,10)})});S.length>0&&S[0].length>1&&S[0][0]===y&&(c=S[0][1]),d.codecs.forEach(function(h){if(h.name.toUpperCase()==="RTX"&&h.parameters.apt){var p={ssrc:y,codecPayloadType:parseInt(h.parameters.apt,10)};y&&c&&(p.rtx={ssrc:c}),u.push(p),E&&((p=JSON.parse(JSON.stringify(p))).fec={ssrc:y,mechanism:m?"red+ulpfec":"red"},u.push(p))}}),u.length===0&&y&&u.push({ssrc:y});var l=s.matchPrefix(a,"b=");return l.length&&(l=l[0].indexOf("b=TIAS:")===0?parseInt(l[0].substr(7),10):l[0].indexOf("b=AS:")===0?1e3*parseInt(l[0].substr(5),10)*.95-16e3:void 0,u.forEach(function(h){h.maxBitrate=l})),u},s.parseRtcpParameters=function(a){var c={},u=s.matchPrefix(a,"a=ssrc:").map(function(m){return s.parseSsrcMedia(m)}).filter(function(m){return m.attribute==="cname"})[0];u&&(c.cname=u.value,c.ssrc=u.ssrc);var d=s.matchPrefix(a,"a=rtcp-rsize");c.reducedSize=d.length>0,c.compound=d.length===0;var E=s.matchPrefix(a,"a=rtcp-mux");return c.mux=E.length>0,c},s.parseMsid=function(a){var c,u=s.matchPrefix(a,"a=msid:");if(u.length===1)return{stream:(c=u[0].substr(7).split(" "))[0],track:c[1]};var d=s.matchPrefix(a,"a=ssrc:").map(function(E){return s.parseSsrcMedia(E)}).filter(function(E){return E.attribute==="msid"});return d.length>0?{stream:(c=d[0].value.split(" "))[0],track:c[1]}:void 0},s.parseSctpDescription=function(a){var c,u=s.parseMLine(a),d=s.matchPrefix(a,"a=max-message-size:");d.length>0&&(c=parseInt(d[0].substr(19),10)),isNaN(c)&&(c=65536);var E=s.matchPrefix(a,"a=sctp-port:");if(E.length>0)return{port:parseInt(E[0].substr(12),10),protocol:u.fmt,maxMessageSize:c};if(s.matchPrefix(a,"a=sctpmap:").length>0){var m=s.matchPrefix(a,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(m[0],10),protocol:m[1],maxMessageSize:c}}},s.writeSctpDescription=function(a,c){var u=[];return u=a.protocol!=="DTLS/SCTP"?["m="+a.kind+" 9 "+a.protocol+" "+c.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+c.port+`\r
`]:["m="+a.kind+" 9 "+a.protocol+" "+c.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+c.port+" "+c.protocol+` 65535\r
`],c.maxMessageSize!==void 0&&u.push("a=max-message-size:"+c.maxMessageSize+`\r
`),u.join("")},s.generateSessionId=function(){return Math.random().toString().substr(2,21)},s.writeSessionBoilerplate=function(a,c,u){var d=c!==void 0?c:2;return`v=0\r
o=`+(u||"thisisadapterortc")+" "+(a||s.generateSessionId())+" "+d+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},s.writeMediaSection=function(a,c,u,d){var E=s.writeRtpDescription(a.kind,c);if(E+=s.writeIceParameters(a.iceGatherer.getLocalParameters()),E+=s.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),u==="offer"?"actpass":"active"),E+="a=mid:"+a.mid+`\r
`,a.direction?E+="a="+a.direction+`\r
`:a.rtpSender&&a.rtpReceiver?E+=`a=sendrecv\r
`:a.rtpSender?E+=`a=sendonly\r
`:a.rtpReceiver?E+=`a=recvonly\r
`:E+=`a=inactive\r
`,a.rtpSender){var m="msid:"+d.id+" "+a.rtpSender.track.id+`\r
`;E+="a="+m,E+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" "+m,a.sendEncodingParameters[0].rtx&&(E+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" "+m,E+="a=ssrc-group:FID "+a.sendEncodingParameters[0].ssrc+" "+a.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return E+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" cname:"+s.localCName+`\r
`,a.rtpSender&&a.sendEncodingParameters[0].rtx&&(E+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" cname:"+s.localCName+`\r
`),E},s.getDirection=function(a,c){for(var u=s.splitLines(a),d=0;d<u.length;d++)switch(u[d]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return u[d].substr(2)}return c?s.getDirection(c):"sendrecv"},s.getKind=function(a){return s.splitLines(a)[0].split(" ")[0].substr(2)},s.isRejected=function(a){return a.split(" ",2)[1]==="0"},s.parseMLine=function(a){var c=s.splitLines(a)[0].substr(2).split(" ");return{kind:c[0],port:parseInt(c[1],10),protocol:c[2],fmt:c.slice(3).join(" ")}},s.parseOLine=function(a){var c=s.matchPrefix(a,"o=")[0].substr(2).split(" ");return{username:c[0],sessionId:c[1],sessionVersion:parseInt(c[2],10),netType:c[3],addressType:c[4],address:c[5]}},s.isValidSDP=function(a){if(typeof a!="string"||a.length===0)return!1;for(var c=s.splitLines(a),u=0;u<c.length;u++)if(c[u].length<2||c[u].charAt(1)!=="=")return!1;return!0},o.exports=s},4845:function(o,s,a){var c=this&&this.__assign||function(){return c=Object.assign||function(v){for(var g,R=1,_=arguments.length;R<_;R++)for(var w in g=arguments[R])Object.prototype.hasOwnProperty.call(g,w)&&(v[w]=g[w]);return v},c.apply(this,arguments)},u=this&&this.__importDefault||function(v){return v&&v.__esModule?v:{default:v}};Object.defineProperty(s,"__esModule",{value:!0}),s.AliRTS=void 0;var d=a(2550),E=a(9428),m=a(3412),f=a(7668),y=a(233),S=u(a(2818)),l=a(5259),h=a(7989),p=function(){function v(){}return v.createClient=function(g){var R=g||{};return R.customReporter||(R.customReporter=v.customReporter),R.trackLog===void 0&&(R.trackLog=v.trackLog),new f.RtsClient(R)},v.getMicList=function(){var g=this;return new Promise(function(R,_){g.deviceManager.getMicList().then(function(w){R(w)}).catch(function(w){_(w)})})},v.getCameraList=function(){var g=this;return new Promise(function(R,_){g.deviceManager.getCameraList().then(function(w){R(w)}).catch(function(w){_(w)})})},v.getSpeakerList=function(){var g=this;return new Promise(function(R,_){g.deviceManager.getSpeakerList().then(function(w){R(w)}).catch(function(w){_(w)})})},v.createStream=function(g){return new Promise(function(R,_){var w=new d.LocalStream,k=new S.default({customReporter:v.customReporter,trackLog:v.trackLog});w.init(g).then(function(){R(w),k.reportStreamCreated(g,{videoTrack:!!w.videoTrack,audioTrack:!!w.audioTrack,screenAudio:!!w.screenAudioTrack,surface:w.screenSurfaceType})}).catch(function(O){var C=c(c({},O),{relatedLink:O.extraInfo});delete C.extraInfo,_(C),k.reportErrorInfo(E.ErrorCode.ERROR_INIT_LOCAL_FAIL,O.message,O.traceId,{config:g,originErr:O})})})},v.deviceManager=new m.BrowserDeviceManager,v.BrowserUtil=y.BrowserUtil,v.SystenUtil=y.SystemUtil,v.SupportUtil=h.SupportUtil,v.VideoProfileMap=l.VideoProfileMap,v.ScreenProfileMap=l.ScreenProfileMap,v.AudioProfileMap=l.AudioProfileMap,v.ErrorCode=E.ErrorCode,v.customReporter=function(){},v.trackLog=!0,v}();s.AliRTS=p},7028:(o,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.default={version:"2.9.3-beta.0",protocol_version:2,sdk_version:"0.0.1"}},9428:(o,s)=>{var a,c;Object.defineProperty(s,"__esModule",{value:!0}),s.PUB_RECONNECT_ERROR_LIST=s.RECONNECT_ERROR_EXCLUDE_LIST=s.SUB_RECONNECT_ERROR_LIST=s.DeviceErrorCode=s.ErrorCode=void 0,function(u){u[u.ERROR_DEVICE_UNKNOWNERROR=1e4]="ERROR_DEVICE_UNKNOWNERROR",u[u.ERROR_DEVICE_AUDIODEVICE_NOTFOUND=10001]="ERROR_DEVICE_AUDIODEVICE_NOTFOUND",u[u.ERROR_DEVICE_VIDEODEVICE_NOTFOUND=10002]="ERROR_DEVICE_VIDEODEVICE_NOTFOUND",u[u.ERROR_DEVICE_AUDIODEVICE_NOTALLOWED=10003]="ERROR_DEVICE_AUDIODEVICE_NOTALLOWED",u[u.ERROR_DEVICE_VIDEODEVICE_NOTALLOWED=10004]="ERROR_DEVICE_VIDEODEVICE_NOTALLOWED",u[u.ERROR_DEVICE_AUDIODEVICE_NOTREADABLE=10005]="ERROR_DEVICE_AUDIODEVICE_NOTREADABLE",u[u.ERROR_DEVICE_VIDEODEVICE_NOTREADABLE=10006]="ERROR_DEVICE_VIDEODEVICE_NOTREADABLE",u[u.ERROR_DEIVCE_CONSTRAINEDERROR=10007]="ERROR_DEIVCE_CONSTRAINEDERROR",u[u.ERROR_SCREENSHARE_UNKNOWNERRO=10010]="ERROR_SCREENSHARE_UNKNOWNERRO",u[u.ERROR_SCREENSHARE_NOTALLOWED=10011]="ERROR_SCREENSHARE_NOTALLOWED",u[u.ERROR_SCREENSHARE_ENDED=10012]="ERROR_SCREENSHARE_ENDED",u[u.ERROR_SCREENSHARE_NOPERMISSION=10013]="ERROR_SCREENSHARE_NOPERMISSION",u[u.ERROR_SCREENSHARE_INVALIDACCESS=10014]="ERROR_SCREENSHARE_INVALIDACCESS",u[u.ERROR_SCREENSHARE_NOTSUPPORT=10018]="ERROR_SCREENSHARE_NOTSUPPORT",u[u.ERROR_DEVICE_NOTSUPPORT=10019]="ERROR_DEVICE_NOTSUPPORT",u[u.ERROR_SIGNAL_ERROR=10101]="ERROR_SIGNAL_ERROR",u[u.ERROR_PLAY_FAILED=10102]="ERROR_PLAY_FAILED",u[u.ERROR_NOTSUPPORT_WEBRTC=10110]="ERROR_NOTSUPPORT_WEBRTC",u[u.ERROR_BROWSER_NOTSUPPORT=10111]="ERROR_BROWSER_NOTSUPPORT",u[u.ERROR_BROWSER_VERSIONLOW=10112]="ERROR_BROWSER_VERSIONLOW",u[u.ERROR_NOTSUPPORT_H264=10113]="ERROR_NOTSUPPORT_H264",u[u.ERROR_CREATEOFFER=10114]="ERROR_CREATEOFFER",u[u.ERROR_NO_DATACHANNEL=10115]="ERROR_NO_DATACHANNEL",u[u.ERROR_INIT_LOCAL_FAIL=10116]="ERROR_INIT_LOCAL_FAIL",u[u.ERROR_HEMLELEMENT_NOTMATCH=10125]="ERROR_HEMLELEMENT_NOTMATCH",u[u.ERROR_AUTOPLAY_ERROR=10201]="ERROR_AUTOPLAY_ERROR",u[u.ERROR_PLAY_URL=10202]="ERROR_PLAY_URL",u[u.ERROR_SUBSCRIBE_NOTHING=10203]="ERROR_SUBSCRIBE_NOTHING",u[u.ERROR_HTMLELEMENT_ERROR=10204]="ERROR_HTMLELEMENT_ERROR",u[u.ERROR_HTTPREQUEST_ERROR=10205]="ERROR_HTTPREQUEST_ERROR",u[u.ERROR_ANSWER_ERROR=10206]="ERROR_ANSWER_ERROR",u[u.ERROR_INBOUND_TIMEOUT=10207]="ERROR_INBOUND_TIMEOUT",u[u.ERROR_STREAM_ENDED=10208]="ERROR_STREAM_ENDED",u[u.ERROR_PC_DISCONNECTED=10209]="ERROR_PC_DISCONNECTED",u[u.ERROR_TRANSPORT_CLOSED=10210]="ERROR_TRANSPORT_CLOSED",u[u.ERROR_SIGNAL_URL=10211]="ERROR_SIGNAL_URL",u[u.ERROR_PUBLISH_URL=10300]="ERROR_PUBLISH_URL",u[u.ERROR_PUBLISH_NOAUDIO=10301]="ERROR_PUBLISH_NOAUDIO",u[u.ERROR_PUBLISH_NOSTREAM=10302]="ERROR_PUBLISH_NOSTREAM",u[u.ERROR_DATACHANNEL_PARAM=10500]="ERROR_DATACHANNEL_PARAM",u[u.ERROR_DATACHANNEL_OPEN=10501]="ERROR_DATACHANNEL_OPEN",u[u.ERROR_MEDIASTREAMTRACK_TYPE_ERROR=11e3]="ERROR_MEDIASTREAMTRACK_TYPE_ERROR",u[u.ERROR_MEDIASTREAMTRACK_KIND_ERROR=11001]="ERROR_MEDIASTREAMTRACK_KIND_ERROR",u[u.ERROR_MEDIASTREAMTRACK_AUDIO_NONE=11002]="ERROR_MEDIASTREAMTRACK_AUDIO_NONE",u[u.ERROR_CUSTOMSTREAM_NONE=11003]="ERROR_CUSTOMSTREAM_NONE",u[u.ERROR_CUSTOMSTREAM_INVALID=11004]="ERROR_CUSTOMSTREAM_INVALID",u[u.ERROR_CUSTOMSTREAM_TRACK_NONE=11005]="ERROR_CUSTOMSTREAM_TRACK_NONE",u[u.ERROR_PREERCONNECTION_UNKNOWN=12e3]="ERROR_PREERCONNECTION_UNKNOWN",u[u.ERROR_SUBADD_NO_RESULT=13e3]="ERROR_SUBADD_NO_RESULT",u[u.ERROR_PUBADD_NO_RESULT=13001]="ERROR_PUBADD_NO_RESULT"}(a||(s.ErrorCode=a={})),function(u){u[u.ERROR_DEVICE_UNKNOWNERROR=1e4]="ERROR_DEVICE_UNKNOWNERROR",u[u.ERROR_DEVICE_AUDIODEVICE_NOTFOUND=10001]="ERROR_DEVICE_AUDIODEVICE_NOTFOUND",u[u.ERROR_DEVICE_VIDEODEVICE_NOTFOUND=10002]="ERROR_DEVICE_VIDEODEVICE_NOTFOUND",u[u.ERROR_DEVICE_AUDIODEVICE_NOTALLOWED=10003]="ERROR_DEVICE_AUDIODEVICE_NOTALLOWED",u[u.ERROR_DEVICE_VIDEODEVICE_NOTALLOWED=10004]="ERROR_DEVICE_VIDEODEVICE_NOTALLOWED",u[u.ERROR_DEVICE_AUDIODEVICE_NOTREADABLE=10005]="ERROR_DEVICE_AUDIODEVICE_NOTREADABLE",u[u.ERROR_DEVICE_VIDEODEVICE_NOTREADABLE=10006]="ERROR_DEVICE_VIDEODEVICE_NOTREADABLE",u[u.ERROR_SCREENSHARE_NOTSUPPORT=10010]="ERROR_SCREENSHARE_NOTSUPPORT",u[u.ERROR_SCREENSHARE_NOTALLOWED=10011]="ERROR_SCREENSHARE_NOTALLOWED",u[u.ERROR_SCREENSHARE_ENDED=10012]="ERROR_SCREENSHARE_ENDED",u[u.ERROR_SCREENSHARE_NOPERMISSION=10013]="ERROR_SCREENSHARE_NOPERMISSION",u[u.ERROR_SCREENSHARE_SAFARI_INVALIDACCESS=10014]="ERROR_SCREENSHARE_SAFARI_INVALIDACCESS",u[u.ERROR_SCREENSHARE_UNKNOWNERRO=10019]="ERROR_SCREENSHARE_UNKNOWNERRO",u[u.ERROR_DEVICE_NOTSUPPORT=2e4]="ERROR_DEVICE_NOTSUPPORT"}(c||(s.DeviceErrorCode=c={})),s.SUB_RECONNECT_ERROR_LIST=[a.ERROR_INBOUND_TIMEOUT,a.ERROR_STREAM_ENDED,a.ERROR_PC_DISCONNECTED],s.RECONNECT_ERROR_EXCLUDE_LIST=[a.ERROR_AUTOPLAY_ERROR,a.ERROR_PLAY_URL,a.ERROR_SUBSCRIBE_NOTHING,a.ERROR_HTMLELEMENT_ERROR,a.ERROR_HEMLELEMENT_NOTMATCH,a.ERROR_PUBLISH_URL,a.ERROR_PUBLISH_NOAUDIO,a.ERROR_PUBLISH_NOSTREAM],s.PUB_RECONNECT_ERROR_LIST=[a.ERROR_PC_DISCONNECTED,a.ERROR_TRANSPORT_CLOSED]},5044:(o,s,a)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.RtsError=void 0;var c=a(9428),u=function(){function d(E,m,f,y){this.errorCode=E,this.errorCodeName=c.ErrorCode[E],this.message=m,this.traceId=f,y&&(this.extraInfo=y)}return d.prototype.renameCode=function(E){this.errorCode=E,this.errorCodeName=c.ErrorCode[E]},d}();s.RtsError=u},6091:(o,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.PlayEvent=s.PlayType=void 0,s.PlayType={PLAY_CANPLAY:"canplay",PLAY_WAITING:"waiting",PLAY_PLAYING:"playing",PLAY_MEDIA:"media",PLAY_ENDED:"ended",PLAY_TIMEOUT:"timeout"};var a=function(c){this.event=c};s.PlayEvent=a},5917:(o,s)=>{var a,c,u,d;Object.defineProperty(s,"__esModule",{value:!0}),s.DEFAULT_RETRY_PUBLISH_INTERVAL=s.DEFAULT_RETRY_SUBSCRIBE_INTERVAL=s.DEFAULT_RETRY_PUBLISH_LIMIT=s.DEFAULT_RETRY_SUBSCRIBE_LIMIT=s.EWorkerAction=s.EWorkerSource=s.EConnectStatus=s.TrackType=void 0,function(E){E.AUDIO="audio",E.VIDEO="video"}(a||(s.TrackType=a={})),function(E){E[E.CONNECT_STATUS_DISCONNECTED=0]="CONNECT_STATUS_DISCONNECTED",E[E.CONNECT_STATUS_CONNECTING=1]="CONNECT_STATUS_CONNECTING",E[E.CONNECT_STATUS_CONNECTED=2]="CONNECT_STATUS_CONNECTED",E[E.CONNECT_STATUS_RECONNECTING=3]="CONNECT_STATUS_RECONNECTING"}(c||(s.EConnectStatus=c={})),function(E){E.Sender="sender",E.Receiver="receiver"}(u||(s.EWorkerSource=u={})),function(E){E.Setup="setup",E.InserSEI="insertSEI"}(d||(s.EWorkerAction=d={})),s.DEFAULT_RETRY_SUBSCRIBE_LIMIT=5,s.DEFAULT_RETRY_PUBLISH_LIMIT=5,s.DEFAULT_RETRY_SUBSCRIBE_INTERVAL=2e3,s.DEFAULT_RETRY_PUBLISH_INTERVAL=2e3},6600:function(o,s,a){var c,u=this&&this.__extends||(c=function(O,C){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,A){b.__proto__=A}||function(b,A){for(var T in A)Object.prototype.hasOwnProperty.call(A,T)&&(b[T]=A[T])},c(O,C)},function(O,C){if(typeof C!="function"&&C!==null)throw new TypeError("Class extends value "+String(C)+" is not a constructor or null");function b(){this.constructor=O}c(O,C),O.prototype=C===null?Object.create(C):(b.prototype=C.prototype,new b)}),d=this&&this.__assign||function(){return d=Object.assign||function(O){for(var C,b=1,A=arguments.length;b<A;b++)for(var T in C=arguments[b])Object.prototype.hasOwnProperty.call(C,T)&&(O[T]=C[T]);return O},d.apply(this,arguments)},E=this&&this.__awaiter||function(O,C,b,A){return new(b||(b=Promise))(function(T,M){function D(I){try{P(A.next(I))}catch(L){M(L)}}function N(I){try{P(A.throw(I))}catch(L){M(L)}}function P(I){var L;I.done?T(I.value):(L=I.value,L instanceof b?L:new b(function(W){W(L)})).then(D,N)}P((A=A.apply(O,C||[])).next())})},m=this&&this.__generator||function(O,C){var b,A,T,M,D={label:0,sent:function(){if(1&T[0])throw T[1];return T[1]},trys:[],ops:[]};return M={next:N(0),throw:N(1),return:N(2)},typeof Symbol=="function"&&(M[Symbol.iterator]=function(){return this}),M;function N(P){return function(I){return function(L){if(b)throw new TypeError("Generator is already executing.");for(;M&&(M=0,L[0]&&(D=0)),D;)try{if(b=1,A&&(T=2&L[0]?A.return:L[0]?A.throw||((T=A.return)&&T.call(A),0):A.next)&&!(T=T.call(A,L[1])).done)return T;switch(A=0,T&&(L=[2&L[0],T.value]),L[0]){case 0:case 1:T=L;break;case 4:return D.label++,{value:L[1],done:!1};case 5:D.label++,A=L[1],L=[0];continue;case 7:L=D.ops.pop(),D.trys.pop();continue;default:if(T=D.trys,!((T=T.length>0&&T[T.length-1])||L[0]!==6&&L[0]!==2)){D=0;continue}if(L[0]===3&&(!T||L[1]>T[0]&&L[1]<T[3])){D.label=L[1];break}if(L[0]===6&&D.label<T[1]){D.label=T[1],T=L;break}if(T&&D.label<T[2]){D.label=T[2],D.ops.push(L);break}T[2]&&D.ops.pop(),D.trys.pop();continue}L=C.call(O,D)}catch(W){L=[6,W],A=0}finally{b=T=0}if(5&L[0])throw L[1];return{value:L[0]?L[1]:void 0,done:!0}}([P,I])}}},f=this&&this.__importDefault||function(O){return O&&O.__esModule?O:{default:O}};Object.defineProperty(s,"__esModule",{value:!0}),s.CommonController=void 0;var y=a(771),S=a(5917),l=f(a(102)),h=a(9594),p=a(5044),v=a(9428),g=a(6091),R=a(5788),_=a(4450),w=function(O){function C(b){var A=O.call(this)||this;return A.datachannelList=new k,A.receiverCodecPreferences={},A.senderCodecPreferences={},A.reporter=b,A.signalChannel=new R.SignalChannel({reporter:b}),A.proxySignalChannelEvents(),A}return u(C,O),C.prototype.setPeerconnection=function(b){var A=this;b!==this.peerconnection&&(this.peerconnection&&this.peerconnection.removeAllListeners(),this.peerconnection=b,this.signalChannel.isOpen||(this.waitForOpenPms=new Promise(function(T,M){A.peerconnection.on("datachannelStatusChange",function(D){A.emit("datachannelStatusChange",D),D.status===_.EDatachannelStatus.DATACHANNEL_STATUS_OPEN&&(A.signalChannel.setPeerConnection(b),T())})})),this.peerconnection.on("innerSubscribeDeleteTracks",function(T){A.handleWorkerSubDelete(T)}),this.peerconnection.on("encodedFrame",function(T){var M;A.emit("encodedFrame",T),T.kind==="video"&&(0,h.parseSei)((M=T.frame)===null||M===void 0?void 0:M.data).forEach(function(D){A.emit("receivedSEI",{url:T.url,vMsid:T.vMsid,sei:D})})}),(this.receiverCodecPreferences.video||this.receiverCodecPreferences.audio)&&this.peerconnection.setReceiverCodecPreferences(this.receiverCodecPreferences),(this.senderCodecPreferences.video||this.senderCodecPreferences.audio)&&this.peerconnection.setSenderCodecPreferences(this.senderCodecPreferences))},Object.defineProperty(C.prototype,"peerCore",{get:function(){var b;return(b=this.peerconnection)===null||b===void 0?void 0:b.getPeerCore()},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"streamManager",{get:function(){var b;return(b=this.peerCore)===null||b===void 0?void 0:b.getStreamManager()},enumerable:!1,configurable:!0}),C.prototype.subscribeAdd=function(b){return E(this,void 0,void 0,function(){var A,T,M,D,N,P,I,L,W=this;return m(this,function(U){switch(U.label){case 0:if(b.forEach(function(x){var V;(V=W.reporter)===null||V===void 0||V.reportSubscribeStart(x.url,"",x.vMsid,x.aMsid,!0)}),!this.peerconnection)throw this.makeRtsError("subscribeAdd");this.peerconnection.isReused=!0,A=new Date().getTime(),U.label=1;case 1:return U.trys.push([1,3,,4]),[4,this.peerconnection.subAdd(b)];case 2:if(!(T=U.sent()).streamList)throw new p.RtsError(v.ErrorCode.ERROR_SUBADD_NO_RESULT,"subAdd streamList not found","",{api:"subscribeAdd",configList:b,response:T});return[3,4];case 3:throw M=U.sent(),D=M,(L=this.reporter)===null||L===void 0||L.reportErrorInfo(D.errorCode,D.message,D.traceId,D.extraInfo),D;case 4:return N=T.deleteRspTime-A,P=T.subAddRspTime-T.deleteRspTime,I=T.activeRspTime-T.subAddRspTime,T.streamList.forEach(function(x,V){var j,H,z;(j=W.reporter)===null||j===void 0||j.reportSubscribeOk({vurl:x.url||void 0,isSubAdd:!0});var K,$=b[V]||{},Z=$.targetStream,ne=$.vMsid,te=$.aMsid,ae=x.stream;if(Z)return Z.mergeStream(ae),void(x.stream=Z);var le=(H=W.streamManager)===null||H===void 0?void 0:H.getStreamByMsid({url:x.url,vMsid:ne==null?void 0:ne[0],aMsid:te==null?void 0:te[0]});if(le)le.mergeStream(ae),K=le;else{(K=new y.RemoteStream).updateMediaStream(ae),(z=W.streamManager)===null||z===void 0||z.update(x.url,{stream:K,vMsid:ne==null?void 0:ne[0],aMsid:te==null?void 0:te[0]}),K.on("onCanPlay",function(){var ve,Se,be=new Date().getTime();(ve=W.reporter)===null||ve===void 0||ve.reportFirstFrameTime(x.url,x.traceId,-1,-1,be-A,0,-1,{},N,P,I,ne,te,!0),(Se=W.peerconnection)===null||Se===void 0||Se.playStart()});var fe=new g.PlayEvent(g.PlayType.PLAY_CANPLAY);fe.data={url:x.url,vMsid:(ne==null?void 0:ne[0])||"vMsid unknown",aMsid:(te==null?void 0:te[0])||"aMsid unknown"},W.emit("onPlayEvent",fe)}x.stream=K}),[2,T.streamList]}})})},C.prototype.subscribeActive=function(b){return E(this,void 0,void 0,function(){var A;return m(this,function(T){if(!this.peerconnection)throw this.makeRtsError("subscribeActive");return[2,(A=this.peerconnection)===null||A===void 0?void 0:A.subActive(b)]})})},C.prototype.subscribeStop=function(b){return E(this,void 0,void 0,function(){var A,T,M,D,N;return m(this,function(P){switch(P.label){case 0:if(!this.peerconnection)throw this.makeRtsError("subscribeStop");P.label=1;case 1:return P.trys.push([1,3,,4]),[4,this.peerconnection.subStop(b)];case 2:return A=P.sent(),this.peerconnection.getSubMonitor().updateTranceiversController(),T=this.peerconnection.getWorkerManager(),b.forEach(function(I){T.removeByUrl({url:I.url,source:S.EWorkerSource.Receiver})}),[3,4];case 3:throw M=P.sent(),D=M,(N=this.reporter)===null||N===void 0||N.reportErrorInfo(D.errorCode,D.message,D.traceId,D.extraInfo),M;case 4:return[2,A]}})})},C.prototype.subscribeDeleteTracks=function(b){return E(this,void 0,void 0,function(){var A,T,M,D;return m(this,function(N){switch(N.label){case 0:if(!this.peerconnection)throw this.makeRtsError("subscribeDeleteTracks");N.label=1;case 1:return N.trys.push([1,3,,4]),[4,this.peerconnection.subDeleteTracks(b)];case 2:if(!(A=N.sent()))throw this.makeRtsError("subscribeDeleteTracks");return this.peerconnection.getSubMonitor().updateTranceiversController(),this.handleWorkerSubDelete(b),[3,4];case 3:throw T=N.sent(),M=T,(D=this.reporter)===null||D===void 0||D.reportErrorInfo(M.errorCode,M.message,M.traceId,M.extraInfo),T;case 4:return[2,A]}})})},C.prototype.handleWorkerSubDelete=function(b){if(this.peerconnection){var A=this.peerconnection.getWorkerManager();b.forEach(function(T){var M,D;!((M=T.vMsid)===null||M===void 0)&&M.length&&A.removeByMsid({url:T.url,source:S.EWorkerSource.Receiver,kind:"video",msid:T.vMsid[0]}),!((D=T.aMsid)===null||D===void 0)&&D.length&&A.removeByMsid({url:T.url,source:S.EWorkerSource.Receiver,kind:"audio",msid:T.aMsid[0]})})}},C.prototype.publishAdd=function(b){return E(this,void 0,void 0,function(){var A,T,M,D,N,P,I,L,W,U,x,V=this;return m(this,function(j){switch(j.label){case 0:if(b.forEach(function(H){var z;(z=V.reporter)===null||z===void 0||z.reportStartPublish(H.url,"",!0)}),A=new Date().getTime(),!this.peerconnection)throw this.makeRtsError("publishAdd");j.label=1;case 1:return j.trys.push([1,3,,4]),[4,(L=this.peerconnection)===null||L===void 0?void 0:L.pubAdd(b)];case 2:if(!(T=j.sent()))throw new p.RtsError(v.ErrorCode.ERROR_PUBADD_NO_RESULT,"pubAdd streamList not found","",{api:"publishAdd",publishInfoList:b});return[3,4];case 3:throw M=j.sent(),D=M,(W=this.reporter)===null||W===void 0||W.reportErrorInfo(D.errorCode,D.message,D.traceId,D.extraInfo),D;case 4:return this.peerconnection.isReused=!0,N=new Date().getTime(),P=N-A,T.forEach(function(H){var z;(z=V.reporter)===null||z===void 0||z.reportPublishOk(H.url||"","",-1,-1,-1,H.traceId||"",P,!0)}),(I=(U=this.peerconnection)===null||U===void 0?void 0:U.getPc())&&(b.forEach(function(H){V.peerconnection&&H.stream.setEncodeParam(I)}),this.peerCore&&((x=this.peerconnection)===null||x===void 0||x.getPubMonitor().startHeartbeat(I,this.peerCore)),I.getSenders().forEach(function(H){var z;H.track&&((z=V.peerconnection)===null||z===void 0||z.handleEncodedInsertableStreams({sender:H}))})),[2,T]}})})},C.prototype.publishDeleteTracks=function(b){return E(this,void 0,void 0,function(){var A,T,M,D,N;return m(this,function(P){switch(P.label){case 0:if(!this.peerconnection)throw this.makeRtsError("publishDeleteTracks");P.label=1;case 1:return P.trys.push([1,3,,4]),[4,this.peerconnection.pubDeleteTracks(b)];case 2:if(!(A=P.sent()))throw this.makeRtsError("publishDeleteTracks");return this.peerconnection.getPubMonitor().updateSenders(),T=this.peerconnection.getWorkerManager(),b.forEach(function(I){var L,W;!((L=I.vMsid)===null||L===void 0)&&L.length&&T.removeByMsid({url:I.url,source:S.EWorkerSource.Sender,kind:"video",msid:I.vMsid[0]}),!((W=I.aMsid)===null||W===void 0)&&W.length&&T.removeByMsid({url:I.url,source:S.EWorkerSource.Sender,kind:"audio",msid:I.aMsid[0]})}),[3,4];case 3:throw M=P.sent(),D=M,(N=this.reporter)===null||N===void 0||N.reportErrorInfo(D.errorCode,D.message,D.traceId,D.extraInfo),M;case 4:return[2,A]}})})},C.prototype.publishReplaceTracks=function(b){return E(this,void 0,void 0,function(){var A,T,M,D;return m(this,function(N){switch(N.label){case 0:if(!this.peerconnection)throw this.makeRtsError("publishReplaceTracks");N.label=1;case 1:return N.trys.push([1,3,,4]),[4,this.peerconnection.pubReplaceTracks(b)];case 2:if(!(A=N.sent()))throw this.makeRtsError("publishReplaceTracks");return this.peerconnection.getPubMonitor().updateSenders(),[3,4];case 3:throw T=N.sent(),M=T,(D=this.reporter)===null||D===void 0||D.reportErrorInfo(M.errorCode,M.message,M.traceId,M.extraInfo),T;case 4:return[2,A]}})})},C.prototype.publishStop=function(b){return E(this,void 0,void 0,function(){var A,T,M,D,N,P=this;return m(this,function(I){switch(I.label){case 0:if(b.forEach(function(L){var W;(W=P.reporter)===null||W===void 0||W.reportStopPublish(L.url,!0)}),!this.peerconnection)throw this.makeRtsError("publishStop");I.label=1;case 1:return I.trys.push([1,3,,4]),[4,this.peerconnection.pubStop(b)];case 2:return A=I.sent(),this.peerconnection.getPubMonitor().updateSenders(),T=this.peerconnection.getWorkerManager(),b.forEach(function(L){T.removeByUrl({url:L.url,source:S.EWorkerSource.Sender})}),[3,4];case 3:throw M=I.sent(),D=M,(N=this.reporter)===null||N===void 0||N.reportErrorInfo(D.errorCode,D.message,D.traceId,D.extraInfo),M;case 4:return[2,A]}})})},C.prototype.handleAddDatachannel=function(b){return E(this,void 0,void 0,function(){var A,T,M,D,N,P,I,L,W,U,x,V=this;return m(this,function(j){switch(j.label){case 0:if(!b.url||!b.signalUrl||!b.msid)throw T=new p.RtsError(v.ErrorCode.ERROR_DATACHANNEL_PARAM,"url, signalUrl, msid is required by subscribe(publish)AddDatachannel",""),(I=this.reporter)===null||I===void 0||I.reportErrorInfo(T.errorCode,T.message,T.traceId,T.extraInfo),T;return A=b.type==="sub",this.waitForOpenPms?[4,this.waitForOpenPms]:[3,2];case 1:j.sent(),this.waitForOpenPms=void 0,j.label=2;case 2:if(this.signalChannel.isOpen)return[3,4];if(console.warn("Creating a new signal channel"),!b.signalUrl)throw T=new p.RtsError(v.ErrorCode.ERROR_SIGNAL_URL,"signal url is required",""),(L=this.reporter)===null||L===void 0||L.reportErrorInfo(T.errorCode,T.message,T.traceId,T.extraInfo),T;return[4,this.initSignalChannel(b)];case 3:j.sent(),this.setPeerconnection(this.signalChannel.getPeerConnection()),j.label=4;case 4:if(M=performance.now(),D={url:b.url,label:b.label,surl:b.signalUrl,msid:b.msid},A?(W=this.reporter)===null||W===void 0||W.reportDatachannelSubAdd(D):(U=this.reporter)===null||U===void 0||U.reportDatachannelPubAdd(D),!(N=(x=this.peerconnection)===null||x===void 0?void 0:x.getPc()))throw new Error("No avaliable peerconnection");return P=new _.DataChannelCore({pc:N,label:b.label,datachannelList:this.datachannelList.list}),this.datachannelList.update(P),[2,new Promise(function(H,z){return E(V,void 0,void 0,function(){var K,$,Z,ne,te,ae,le,fe,ve,Se,be,Me,_e,ke,Pe,Le,Qe=this;return m(this,function(Ge){switch(Ge.label){case 0:K="",$=!1,Z=!1,P.on("statusChange",function(rt){var Xe;(Xe=Qe.reporter)===null||Xe===void 0||Xe.reportDatachannelStatusChange({state:_.EDatachannelStatus[rt],url:b.url,label:P.label,id:P.id,msid:b.msid}),rt===_.EDatachannelStatus.DATACHANNEL_STATUS_OPEN&&($=!0,Z&&H({datachannel:P,traceId:K}))}),P.on("dispose",function(){var rt;(rt=Qe.reporter)===null||rt===void 0||rt.reportDatachannelDispose({url:b.url,label:P.label,id:P.id,msid:b.msid})}),Ge.label=1;case 1:return Ge.trys.push([1,6,,7]),ne=[{url:b.url,msid:b.msid,datachannelId:P.id}],A?[4,(Se=this.peerCore)===null||Se===void 0?void 0:Se.subscribeAddDatachannel(ne)]:[3,3];case 2:return ae=Ge.sent(),[3,5];case 3:return[4,(be=this.peerCore)===null||be===void 0?void 0:be.publishAddDatachannel(ne)];case 4:ae=Ge.sent(),Ge.label=5;case 5:return K=(_e=(Me=(te=ae)==null?void 0:te.streams)===null||Me===void 0?void 0:Me[0])===null||_e===void 0?void 0:_e.traceid,[3,7];case 6:return le=Ge.sent(),fe=le,(ke=this.reporter)===null||ke===void 0||ke.reportErrorInfo(fe.errorCode,fe.message||"datachannel ".concat(A?"sub":"pub"," add error"),fe.traceId,fe.extraInfo),[2,z(le)];case 7:return ve={url:b.url,drct:Math.floor(performance.now()-M),tcid:K,label:P.label,id:P.id,msid:b.msid},A?(Pe=this.reporter)===null||Pe===void 0||Pe.reportDatachannelSubAddOk(ve):(Le=this.reporter)===null||Le===void 0||Le.reportDatachannelPubAddOk(ve),Z=!0,$&&H({datachannel:P,traceId:K}),[2]}})})})]}})})},C.prototype.handleStopDatachannel=function(b){return E(this,void 0,void 0,function(){var A,T,M,D,N,P,I,L,W,U,x,V;return m(this,function(j){switch(j.label){case 0:if(!b.url||!b.datachannel)throw A=new p.RtsError(v.ErrorCode.ERROR_DATACHANNEL_PARAM,"url, datachannel is required by subscribe(publish)StopDatachannel",""),(N=this.reporter)===null||N===void 0||N.reportErrorInfo(A.errorCode,A.message,A.traceId,A.extraInfo),A;if(!this.signalChannel.isOpen)throw A=new p.RtsError(v.ErrorCode.ERROR_NO_DATACHANNEL,"Signal channel is closed",""),(P=this.reporter)===null||P===void 0||P.reportErrorInfo(A.errorCode,A.message,A.traceId,A.extraInfo),A;T=b.type==="sub",M=[{url:b.url}],D={url:b.url,label:b.datachannel.label,id:b.datachannel.id},T?(I=this.reporter)===null||I===void 0||I.reportDatachannelSubStop(D):(L=this.reporter)===null||L===void 0||L.reportDatachannelPubStop(D),j.label=1;case 1:return j.trys.push([1,6,,7]),T?[4,(W=this.peerCore)===null||W===void 0?void 0:W.subscribeStopDatachannel(M)]:[3,3];case 2:return j.sent(),[3,5];case 3:return[4,(U=this.peerCore)===null||U===void 0?void 0:U.publishStopDatachannel(M)];case 4:j.sent(),j.label=5;case 5:return[3,7];case 6:throw j.sent();case 7:return T?(x=this.reporter)===null||x===void 0||x.reportDatachannelSubStopOk(D):(V=this.reporter)===null||V===void 0||V.reportDatachannelPubStopOk(D),b.datachannel.dispose(),[2]}})})},C.prototype.subscribeAddDatachannel=function(b){return E(this,void 0,void 0,function(){return m(this,function(A){return[2,this.handleAddDatachannel(d(d({},b),{type:"sub"}))]})})},C.prototype.publishAddDatachannel=function(b){return E(this,void 0,void 0,function(){return m(this,function(A){return[2,this.handleAddDatachannel(d(d({},b),{type:"pub"}))]})})},C.prototype.subscribeStopDatachannel=function(b){return E(this,void 0,void 0,function(){return m(this,function(A){return[2,this.handleStopDatachannel(d(d({},b),{type:"sub"}))]})})},C.prototype.publishStopDatachannel=function(b){return E(this,void 0,void 0,function(){return m(this,function(A){return[2,this.handleStopDatachannel(d(d({},b),{type:"pub"}))]})})},C.prototype.getSubscribeVideoStats=function(b,A){return this.getSubscribeMediaStats(b,"video",A)},C.prototype.getSubscribeAudioStats=function(b,A){return this.getSubscribeMediaStats(b,"audio",A)},C.prototype.getPublishVideoStats=function(b,A){return this.getPublishMediaStats(b,"video",A)},C.prototype.getPublishAudioStats=function(b,A){return this.getPublishMediaStats(b,"audio",A)},C.prototype.sendSEI=function(b){var A,T;if(!((A=this.peerconnection)===null||A===void 0)&&A.isReused)return(T=this.peerconnection)===null||T===void 0?void 0:T.sendSEI(b)},C.prototype.setReceiverCodecPreferences=function(b){this.receiverCodecPreferences=d({},b)},C.prototype.setSenderCodecPreferences=function(b){this.senderCodecPreferences=d({},b)},C.prototype.getSubscribeMediaStats=function(b,A,T){var M=this;return new Promise(function(D){return E(M,void 0,void 0,function(){var N,P,I,L;return m(this,function(W){switch(W.label){case 0:return this.streamManager?(N=void 0,P=this.streamManager.getAllMediaInfoList(b,!0),T?P.forEach(function(U){var x,V,j,H=(V=(x=U.transceiver)===null||x===void 0?void 0:x.receiver)===null||V===void 0?void 0:V.track;(H==null?void 0:H.kind)===A&&U.msid===T&&(N=(j=U.transceiver)===null||j===void 0?void 0:j.receiver)}):N=(L=(I=P==null?void 0:P.find(function(U){var x,V,j;return((j=(V=(x=U.transceiver)===null||x===void 0?void 0:x.receiver)===null||V===void 0?void 0:V.track)===null||j===void 0?void 0:j.kind)===A}))===null||I===void 0?void 0:I.transceiver)===null||L===void 0?void 0:L.receiver,N?[4,N.getStats()]:[2,D({})]):[2,D({})];case 1:return W.sent().forEach(function(U){U.type==="inbound-rtp"&&D(U)}),[2]}})})})},C.prototype.getPublishMediaStats=function(b,A,T){var M=this;return new Promise(function(D){return E(M,void 0,void 0,function(){var N,P,I,L;return m(this,function(W){switch(W.label){case 0:return this.streamManager?(N=void 0,P=this.streamManager.getAllMediaInfoList(b,!0),T?P.forEach(function(U){var x,V,j,H=(V=(x=U.transceiver)===null||x===void 0?void 0:x.sender)===null||V===void 0?void 0:V.track;(H==null?void 0:H.kind)===A&&U.msid===T&&(N=(j=U.transceiver)===null||j===void 0?void 0:j.sender)}):N=(L=(I=P==null?void 0:P.find(function(U){var x,V,j;return((j=(V=(x=U.transceiver)===null||x===void 0?void 0:x.sender)===null||V===void 0?void 0:V.track)===null||j===void 0?void 0:j.kind)===A}))===null||I===void 0?void 0:I.transceiver)===null||L===void 0?void 0:L.sender,N?[4,N.getStats()]:[2,D({})]):[2,D({})];case 1:return W.sent().forEach(function(U){U.type==="outbound-rtp"&&D(U)}),[2]}})})})},C.prototype.proxySignalChannelEvents=function(){var b=this;this.signalChannel.on("connectStatusChange",function(A){b.emit("connectStatusChange",A)}),this.signalChannel.on("onError",function(A){b.emit("onError",A)})},C.prototype.initSignalChannel=function(b){return this.signalChannel.createDatachannel(b)},C.prototype.makeRtsError=function(b){var A,T=new p.RtsError(v.ErrorCode.ERROR_NO_DATACHANNEL,"No avaliable datachannel, you should subscribe/publish first.","",{api:b});return(A=this.reporter)===null||A===void 0||A.reportErrorInfo(T.errorCode,T.message,T.traceId,T.extraInfo),T},C}(l.default);s.CommonController=w;var k=function(){function O(){this._list=[]}return Object.defineProperty(O.prototype,"list",{get:function(){return this._list},enumerable:!1,configurable:!0}),O.prototype.update=function(C){var b=this._list.findIndex(function(A){return A.id===C.id});b!==-1?this._list.splice(b,1,C):this._list.push(C)},O}()},9796:function(o,s,a){var c,u=this&&this.__extends||(c=function(k,O){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(C,b){C.__proto__=b}||function(C,b){for(var A in b)Object.prototype.hasOwnProperty.call(b,A)&&(C[A]=b[A])},c(k,O)},function(k,O){if(typeof O!="function"&&O!==null)throw new TypeError("Class extends value "+String(O)+" is not a constructor or null");function C(){this.constructor=k}c(k,O),k.prototype=O===null?Object.create(O):(C.prototype=O.prototype,new C)}),d=this&&this.__assign||function(){return d=Object.assign||function(k){for(var O,C=1,b=arguments.length;C<b;C++)for(var A in O=arguments[C])Object.prototype.hasOwnProperty.call(O,A)&&(k[A]=O[A]);return k},d.apply(this,arguments)},E=this&&this.__awaiter||function(k,O,C,b){return new(C||(C=Promise))(function(A,T){function M(P){try{N(b.next(P))}catch(I){T(I)}}function D(P){try{N(b.throw(P))}catch(I){T(I)}}function N(P){var I;P.done?A(P.value):(I=P.value,I instanceof C?I:new C(function(L){L(I)})).then(M,D)}N((b=b.apply(k,O||[])).next())})},m=this&&this.__generator||function(k,O){var C,b,A,T,M={label:0,sent:function(){if(1&A[0])throw A[1];return A[1]},trys:[],ops:[]};return T={next:D(0),throw:D(1),return:D(2)},typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function D(N){return function(P){return function(I){if(C)throw new TypeError("Generator is already executing.");for(;T&&(T=0,I[0]&&(M=0)),M;)try{if(C=1,b&&(A=2&I[0]?b.return:I[0]?b.throw||((A=b.return)&&A.call(b),0):b.next)&&!(A=A.call(b,I[1])).done)return A;switch(b=0,A&&(I=[2&I[0],A.value]),I[0]){case 0:case 1:A=I;break;case 4:return M.label++,{value:I[1],done:!1};case 5:M.label++,b=I[1],I=[0];continue;case 7:I=M.ops.pop(),M.trys.pop();continue;default:if(A=M.trys,!((A=A.length>0&&A[A.length-1])||I[0]!==6&&I[0]!==2)){M=0;continue}if(I[0]===3&&(!A||I[1]>A[0]&&I[1]<A[3])){M.label=I[1];break}if(I[0]===6&&M.label<A[1]){M.label=A[1],A=I;break}if(A&&M.label<A[2]){M.label=A[2],M.ops.push(I);break}A[2]&&M.ops.pop(),M.trys.pop();continue}I=O.call(k,M)}catch(L){I=[6,L],b=0}finally{C=A=0}if(5&I[0])throw I[1];return{value:I[0]?I[1]:void 0,done:!0}}([N,P])}}},f=this&&this.__importDefault||function(k){return k&&k.__esModule?k:{default:k}};Object.defineProperty(s,"__esModule",{value:!0}),s.Publisher=void 0;var y=a(5917),S=a(4865),l=f(a(7028)),h=a(9428),p=a(5044),v=a(7989),g=f(a(102)),R=f(a(8219)),_=a(2718),w=function(k){function O(C){var b=k.call(this)||this;return b.publishStartTimeStamp=0,b.pubReconnectTimes=0,b.isConnecting=!1,b.reconnectTimerHandle=null,b.reportMonitorTimes=0,b.reportSubFlag=!1,b.reporter=C,b.peerconnection=new S.RtsPeerconnection,b.peerconnection.on("connectStatusChange",function(A){A.status!==y.EConnectStatus.CONNECT_STATUS_DISCONNECTED&&A.status!==y.EConnectStatus.CONNECT_STATUS_RECONNECTING||!b.hasRetries()?b.emit("connectStatusChange",A):b.emit("onError",new p.RtsError(h.ErrorCode.ERROR_PC_DISCONNECTED,"PC disconnected",""))}),b.peerconnection.on("onMonitorEvent",function(A){var T=A.eventList;A.type==="pub"?(b.reportMonitorTimes++,b.reportMonitorTimes%4==0&&(T.forEach(function(M){b.reporter.reportPushStats(M)}),b.reportSubFlag=!0,b.reportMonitorTimes=0)):A.type==="sub"&&b.reportSubFlag&&(b.handleSubMonitorEvent(T),b.reportSubFlag=!1)}),b.peerconnection.on("onTransportStateEvent",function(A){var T;b.peerconnection.isReused||((T=b.peerconnection.getPc())===null||T===void 0?void 0:T.connectionState)!=="closed"&&A.state==="closed"&&b.hasRetries()&&b.emit("onError",new p.RtsError(h.ErrorCode.ERROR_TRANSPORT_CLOSED,"Transport has been closed. ".concat(A.kind,"|").concat(A.type,"|").concat(A.url),"",{protocol:A.protocol}))}),b.signalingUrl="",b.publishUrl="",b.publishConfig={},b}return u(O,k),O.prototype.publish=function(C,b,A){var T=this;return new Promise(function(M,D){if(T.unpublish(),T.localStream=b,T.publishUrl=C,T.publishConfig=A||{},T.checkPublishUrl())if(b)if(b.audioTrack===null)D(new p.RtsError(h.ErrorCode.ERROR_PUBLISH_NOAUDIO,"publish need audiotrack",""));else{var N=A==null?void 0:A.signalUrl;T.signalingUrl=N||T.signalingUrl,T.publishStartTimeStamp=new Date().getTime(),b.setReporter(T.reporter),T.peerconnection.createOffer(b.hasAudio,b.hasVideo||b.hasScreen,b,d(d({},A),{publishUrl:C})).then(function(P){var I=P.desp,L=P.publishTrackInfoList;T.publishTrackInfoList=L;var W=new Date().getTime();T.reporter.reportStartPublish(T.publishUrl,T.signalingUrl),T.excuteSignal(I).then(function(U){var x=new Date().getTime();T.peerconnection.recvAnswer(U.data,{answerSdpHook:A==null?void 0:A.answerSdpHook,tcpOnly:A==null?void 0:A.tcpOnly}).then(function(){T.reporter.reportPublishOk(T.publishUrl,T.signalingUrl,W-T.publishStartTimeStamp,x-W,new Date().getTime()-x,U.data.trace_id),M(U.data.trace_id),T.pubReconnectTimes=0,T.peerconnection.pushStart()}).catch(function(V){V.traceid=U.data?U.data.trace_id:"";var j=new p.RtsError(V.errorCode||h.ErrorCode.ERROR_ANSWER_ERROR,V.message||"set answer error",V.traceid,{sdp:V.sdp});D(j)})}).catch(function(U){var x=new p.RtsError(U.errorCode||h.ErrorCode.ERROR_HTTPREQUEST_ERROR,U.message||"","",{response:U.response,sdp:U.sdp});D(x)})}).catch(function(P){var I=new p.RtsError(P.errorCode||h.ErrorCode.ERROR_CREATEOFFER,P.message||"","");D(I)})}else D(new p.RtsError(h.ErrorCode.ERROR_PUBLISH_NOSTREAM,"publish stream not found",""));else D(new p.RtsError(h.ErrorCode.ERROR_PUBLISH_URL,"url need artc://",""))})},O.prototype.unpublish=function(){this.peerconnection.dispose(),this.reporter.reportStopPublish(),this.signalingUrl="",this.publishUrl="",this.publishTrackInfoList=null},O.prototype.getTrackInfoList=function(){return this.publishTrackInfoList||[]},O.prototype.getPeerConnection=function(){return this.peerconnection},O.prototype.replaceTrack=function(C,b){return this.peerconnection.replaceTrack(this.publishUrl,C,b)},O.prototype.excuteSignal=function(C){var b=this,A={type:C.type,sdp:C.sdp};return this.isSingleMsid()&&(A.sdp=A.sdp.replace(/msid\:-? /g,"msid:")),new Promise(function(T,M){R.default.post(b.signalingUrl,{version:l.default.protocol_version,sdk_version:l.default.sdk_version,mode:"rtc",push_stream:b.publishUrl,jsep:A}).then(function(D){D&&D.status===200?T(D):M({message:D?"response status:"+D.status:"response is null",sdp:A.sdp})}).catch(function(D){return E(b,void 0,void 0,function(){var N,P;return m(this,function(I){switch(I.label){case 0:if(![400,500].includes((P=D.response)===null||P===void 0?void 0:P.status))return[3,4];D.sdp=C.sdp,I.label=1;case 1:return I.trys.push([1,3,,4]),[4,new v.SupportUtil().isSupport({isReceiveVideo:!0})];case 2:return I.sent(),[3,4];case 3:return N=I.sent(),D.errorCode=N==null?void 0:N.errorCode,D.message=N==null?void 0:N.message,this.pubReconnectTimes=1/0,[3,4];case 4:return M(D),[2]}})})})})},O.prototype.checkPublishUrl=function(){if(!this.publishUrl||this.publishUrl.indexOf("artc://")!==0)return!1;var C=window.location.protocol,b=(["http:","https:"].indexOf(C)>-1?C:"https:")+"//";return this.signalingUrl=this.publishUrl.replace("artc://",b),!0},O.prototype.isSingleMsid=function(){if(!this.publishConfig)return!1;var C=this.publishConfig,b=C.vMsid,A=C.aMsid;return!(!b||!b[0]||b[0].indexOf(" ")!==-1)||!(!A||!A[0]||A[0].indexOf(" ")!==-1)},O.prototype.retryPublish=function(C,b){return E(this,void 0,void 0,function(){var A,T,M,D,N,P,I;return m(this,function(L){switch(L.label){case 0:if(C.extraInfo=d(d({},C.extraInfo),{retryTimes:this.pubReconnectTimes}),!this.hasRetries())return[2,!1];if(typeof(A=this.publishConfig).beforeRetry!="function")return[3,4];L.label=1;case 1:return L.trys.push([1,3,,4]),[4,A.beforeRetry({url:this.publishUrl,stream:this.localStream,vMsid:A.vMsid,aMsid:A.aMsid,useTcp:b})];case 2:return(T=L.sent())?(M=T.url,D=T.stream,N=T.vMsid,P=T.aMsid,D||(console.error("Stream is not returned by beforeRetry function."),this.pubReconnectTimes=1/0),this.reporter.reportReconnectParams("pub",M,N,P,T.useTcp,D==null?void 0:D.id),this.publishUrl=M,this.localStream=D,this.publishConfig.vMsid=N,this.publishConfig.aMsid=P,typeof T.useTcp=="boolean"&&(b=T.useTcp),console.log(`Retry with: 
[URL] `.concat(M,`
[STREAM] `).concat(D==null?void 0:D.id,`
[VMSID]`).concat(N," [AMSID]").concat(P,`
[PROTOCOL] `).concat(b?"TCP":"UDP"))):(this.reporter.reportReconnectParams("pub"),this.pubReconnectTimes=1/0),[3,4];case 3:return I=L.sent(),console.error("Error in beforeRetry",I),[3,4];case 4:return this.hasRetries()&&this.localStream?(this.emit("connectStatusChange",{status:y.EConnectStatus.CONNECT_STATUS_RECONNECTING}),this.pubReconnectTimes++,C.extraInfo.retryTimes=this.pubReconnectTimes,C.extraInfo.tcpOnly=!!b,this.publishWithReconnect(this.publishUrl,this.localStream,d(d({},this.publishConfig),{tcpOnly:!!b})).catch(function(W){}),[2,!0]):(C.extraInfo.retryTimes=this.pubReconnectTimes,[2,!1])}})})},O.prototype.publishWithReconnect=function(C,b,A,T,M){var D=this;return new Promise(function(N,P){N=T||N,P=M||P,D.isConnecting=!0,D.publish(C,b,A).then(function(I){D.isConnecting=!1,N(I)}).catch(function(I){var L;if(!D.isConnecting)return P(I);if(!h.RECONNECT_ERROR_EXCLUDE_LIST.includes(I.errorCode)&&D.hasRetries(!0)){var W=((L=D.publishConfig)===null||L===void 0?void 0:L.retryInterval)||y.DEFAULT_RETRY_PUBLISH_INTERVAL;D.reconnectTimerHandle=setTimeout(function(){I.extraInfo=d(d({},I.extraInfo),{retryTimes:D.pubReconnectTimes}),D.emit("reconnect",I),D.publishWithReconnect(C,b,A,N,P)},W)}else P(I),I.extraInfo=d(d({},I.extraInfo),{retryTimes:D.pubReconnectTimes}),D.isConnecting=!1,D.emit("onError",I)})})},O.prototype.sendSEI=function(C){var b;(b=this.peerconnection)===null||b===void 0||b.sendSEI(C)},O.prototype.hasRetries=function(C){var b,A,T=y.DEFAULT_RETRY_PUBLISH_LIMIT;typeof((b=this.publishConfig)===null||b===void 0?void 0:b.retryTimes)=="number"&&(T=Math.floor((A=this.publishConfig)===null||A===void 0?void 0:A.retryTimes));var M=this.pubReconnectTimes<T;return C&&M&&this.pubReconnectTimes++,M},O.prototype.resetRepublishStatus=function(){this.pubReconnectTimes=0,this.isConnecting=!1,this.reporter.updateTid(),this.reconnectTimerHandle!==null&&(clearTimeout(this.reconnectTimerHandle),this.reconnectTimerHandle=null)},O.prototype.handleSubMonitorEvent=function(C){var b=this;C.forEach(function(A){var T={ct:0,tt:4e3,url:A.url},M=A.video,D=A.audio;if(M){var N=M.transportStats,P=M.inboundRtpStats,I=M.inboundRtpStatsPerSec,L=M.localCandidate,W=M.remoteCandidate;T=d(d({},T),{rtt:(N==null?void 0:N.rtt)!==-1?1e3*((N==null?void 0:N.rtt)||0):-1,cand_re_prot:W.protocol,cand_lo_prot:L.protocol,cand_re_addr:"".concat(W.ip||W.address,":").concat(W.port),cand_lo_addr:"".concat(L.ip||L.address,":").concat(L.port),w:P==null?void 0:P.frameWidth,h:P==null?void 0:P.frameHeight,vbps:Math.floor(8*I.bytesReceivedPerSecond),fps:P==null?void 0:P.framesPerSecond,dfps:Math.floor(I==null?void 0:I.framesDecodedPerSecond),vjb:Math.floor((0,_.getJitterBufferDelayAvg)(P==null?void 0:P.jitterBufferDelay,P==null?void 0:P.jitterBufferEmittedCount)),vMsid:A.vMsid})}D&&(N=D.transportStats,P=D.inboundRtpStats,I=D.inboundRtpStatsPerSec,L=D.localCandidate,W=D.remoteCandidate,T=d(d({},T),{rtt:(N==null?void 0:N.rtt)!==-1?1e3*((N==null?void 0:N.rtt)||0):-1,cand_re_prot:W.protocol,cand_lo_prot:L.protocol,cand_re_addr:"".concat(W.ip||W.address,":").concat(W.port),cand_lo_addr:"".concat(L.ip||L.address,":").concat(L.port),abps:Math.floor(8*I.bytesReceivedPerSecond),ajb:Math.floor((0,_.getJitterBufferDelayAvg)(P==null?void 0:P.jitterBufferDelay,P.jitterBufferEmittedCount)),aMsid:A.aMsid})),b.reporter.reportPullStats(T)})},O}(g.default);s.Publisher=w},5788:function(o,s,a){var c,u=this&&this.__extends||(c=function(R,_){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,k){w.__proto__=k}||function(w,k){for(var O in k)Object.prototype.hasOwnProperty.call(k,O)&&(w[O]=k[O])},c(R,_)},function(R,_){if(typeof _!="function"&&_!==null)throw new TypeError("Class extends value "+String(_)+" is not a constructor or null");function w(){this.constructor=R}c(R,_),R.prototype=_===null?Object.create(_):(w.prototype=_.prototype,new w)}),d=this&&this.__awaiter||function(R,_,w,k){return new(w||(w=Promise))(function(O,C){function b(M){try{T(k.next(M))}catch(D){C(D)}}function A(M){try{T(k.throw(M))}catch(D){C(D)}}function T(M){var D;M.done?O(M.value):(D=M.value,D instanceof w?D:new w(function(N){N(D)})).then(b,A)}T((k=k.apply(R,_||[])).next())})},E=this&&this.__generator||function(R,_){var w,k,O,C,b={label:0,sent:function(){if(1&O[0])throw O[1];return O[1]},trys:[],ops:[]};return C={next:A(0),throw:A(1),return:A(2)},typeof Symbol=="function"&&(C[Symbol.iterator]=function(){return this}),C;function A(T){return function(M){return function(D){if(w)throw new TypeError("Generator is already executing.");for(;C&&(C=0,D[0]&&(b=0)),b;)try{if(w=1,k&&(O=2&D[0]?k.return:D[0]?k.throw||((O=k.return)&&O.call(k),0):k.next)&&!(O=O.call(k,D[1])).done)return O;switch(k=0,O&&(D=[2&D[0],O.value]),D[0]){case 0:case 1:O=D;break;case 4:return b.label++,{value:D[1],done:!1};case 5:b.label++,k=D[1],D=[0];continue;case 7:D=b.ops.pop(),b.trys.pop();continue;default:if(O=b.trys,!((O=O.length>0&&O[O.length-1])||D[0]!==6&&D[0]!==2)){b=0;continue}if(D[0]===3&&(!O||D[1]>O[0]&&D[1]<O[3])){b.label=D[1];break}if(D[0]===6&&b.label<O[1]){b.label=O[1],O=D;break}if(O&&b.label<O[2]){b.label=O[2],b.ops.push(D);break}O[2]&&b.ops.pop(),b.trys.pop();continue}D=_.call(R,b)}catch(N){D=[6,N],k=0}finally{w=O=0}if(5&D[0])throw D[1];return{value:D[0]?D[1]:void 0,done:!0}}([T,M])}}},m=this&&this.__importDefault||function(R){return R&&R.__esModule?R:{default:R}};Object.defineProperty(s,"__esModule",{value:!0}),s.SignalChannel=void 0;var f=m(a(7028)),y=a(4865),S=m(a(102)),l=m(a(8219)),h=a(9428),p=a(5044),v=a(4450),g=function(R){function _(w){var k=R.call(this)||this;return k.reporter=w.reporter,k}return u(_,R),Object.defineProperty(_.prototype,"isOpen",{get:function(){return this.readyState==="open"},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"readyState",{get:function(){var w,k,O;return((w=this.peerconnection)===null||w===void 0?void 0:w.isConnected)&&((O=(k=this.peerconnection.getPeerCore())===null||k===void 0?void 0:k.getSignal())===null||O===void 0?void 0:O.getDatachannelCore().readyState)},enumerable:!1,configurable:!0}),_.prototype.getPeerConnection=function(){return this.peerconnection},_.prototype.setPeerConnection=function(w){this.peerconnection=w},_.prototype.createDatachannel=function(w){return d(this,void 0,void 0,function(){var k,O,C,b,A,T,M,D,N,P,I,L;return E(this,function(W){switch(W.label){case 0:if(k=w.signalUrl,!this.checkUrl(k))throw new p.RtsError(h.ErrorCode.ERROR_DATACHANNEL_PARAM,"url need artc://","");this.closeDatachannel(),this.createPC(),this.reporter.updateUrl(k),this.reporter.reportDatachannelHttpConnect(k),O=performance.now(),W.label=1;case 1:return W.trys.push([1,3,,4]),[4,(P=this.peerconnection)===null||P===void 0?void 0:P.createOffer(!1,!1,void 0,w)];case 2:return C=W.sent(),[3,4];case 3:return b=W.sent(),this.throwRtsError(new p.RtsError(b.errorCode||h.ErrorCode.ERROR_CREATEOFFER,b.message||"","")),[3,4];case 4:T="",W.label=5;case 5:return W.trys.push([5,7,,8]),[4,this.excuteSignal(C.desp)];case 6:return A=W.sent(),T=((I=A==null?void 0:A.data)===null||I===void 0?void 0:I.trace_id)||"",this.reporter.reportDatachannelHttpConnectOk({url:k,hrct:Math.floor(performance.now()-O),tcid:T}),[3,8];case 7:return M=W.sent(),this.throwRtsError(new p.RtsError(M.errorCode||h.ErrorCode.ERROR_HTTPREQUEST_ERROR,M.message||"",T)),[3,8];case 8:return W.trys.push([8,10,,11]),[4,(L=this.peerconnection)===null||L===void 0?void 0:L.recvAnswer(A==null?void 0:A.data,{answerSdpHook:w.answerSdpHook})];case 9:return W.sent(),[3,11];case 10:return D=W.sent(),this.throwRtsError(new p.RtsError(D.errorCode||h.ErrorCode.ERROR_ANSWER_ERROR,D.message||"set answer error",T)),[3,11];case 11:return W.trys.push([11,13,,14]),[4,this.waitForOpen()];case 12:return W.sent(),[3,14];case 13:return N=W.sent(),this.throwRtsError(new p.RtsError(h.ErrorCode.ERROR_DATACHANNEL_OPEN,"datachannel open failed: ".concat(N),T)),[3,14];case 14:return[2,T]}})})},_.prototype.waitForOpen=function(){var w,k=this;return new Promise(function(O,C){var b;w=window.setTimeout(function(){var T;(T=k.peerconnection)===null||T===void 0||T.off("datachannelStatusChange",A),w=void 0,C("timeout")},5e3);var A=function(T){w&&(clearTimeout(w),w=void 0),T.status===v.EDatachannelStatus.DATACHANNEL_STATUS_OPEN?O(!0):C("status is ".concat(T.status))};(b=k.peerconnection)===null||b===void 0||b.once("datachannelStatusChange",A)})},_.prototype.excuteSignal=function(w){return d(this,void 0,void 0,function(){var k;return E(this,function(O){switch(O.label){case 0:return[4,l.default.post(this.signalUrl,{version:f.default.protocol_version,sdk_version:f.default.sdk_version,mode:"live",jsep:w})];case 1:if(((k=O.sent())==null?void 0:k.status)!==200)throw new p.RtsError(h.ErrorCode.ERROR_SIGNAL_ERROR,k?"response status:"+k.status:"response is null","");return[2,k]}})})},_.prototype.closeDatachannel=function(){var w;(w=this.peerconnection)===null||w===void 0||w.dispose()},_.prototype.checkUrl=function(w){var k="artc://";if(w&&w.indexOf(k)===0){var O=window.location.protocol,C=(["http:","https:"].indexOf(O)>-1?O:"https:")+"//";return this.signalUrl=w.replace(k,C),!0}},_.prototype.throwRtsError=function(w){throw this.emit("onError",w),w},_.prototype.createPC=function(){var w=this;this.peerconnection=new y.RtsPeerconnection,this.peerconnection.on("connectStatusChange",function(k){w.emit("connectStatusChange",k)})},_}(S.default);s.SignalChannel=g},2550:function(o,s,a){var c,u=this&&this.__extends||(c=function(O,C){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,A){b.__proto__=A}||function(b,A){for(var T in A)Object.prototype.hasOwnProperty.call(A,T)&&(b[T]=A[T])},c(O,C)},function(O,C){if(typeof C!="function"&&C!==null)throw new TypeError("Class extends value "+String(C)+" is not a constructor or null");function b(){this.constructor=O}c(O,C),O.prototype=C===null?Object.create(C):(b.prototype=C.prototype,new b)}),d=this&&this.__assign||function(){return d=Object.assign||function(O){for(var C,b=1,A=arguments.length;b<A;b++)for(var T in C=arguments[b])Object.prototype.hasOwnProperty.call(C,T)&&(O[T]=C[T]);return O},d.apply(this,arguments)},E=this&&this.__awaiter||function(O,C,b,A){return new(b||(b=Promise))(function(T,M){function D(I){try{P(A.next(I))}catch(L){M(L)}}function N(I){try{P(A.throw(I))}catch(L){M(L)}}function P(I){var L;I.done?T(I.value):(L=I.value,L instanceof b?L:new b(function(W){W(L)})).then(D,N)}P((A=A.apply(O,C||[])).next())})},m=this&&this.__generator||function(O,C){var b,A,T,M,D={label:0,sent:function(){if(1&T[0])throw T[1];return T[1]},trys:[],ops:[]};return M={next:N(0),throw:N(1),return:N(2)},typeof Symbol=="function"&&(M[Symbol.iterator]=function(){return this}),M;function N(P){return function(I){return function(L){if(b)throw new TypeError("Generator is already executing.");for(;M&&(M=0,L[0]&&(D=0)),D;)try{if(b=1,A&&(T=2&L[0]?A.return:L[0]?A.throw||((T=A.return)&&T.call(A),0):A.next)&&!(T=T.call(A,L[1])).done)return T;switch(A=0,T&&(L=[2&L[0],T.value]),L[0]){case 0:case 1:T=L;break;case 4:return D.label++,{value:L[1],done:!1};case 5:D.label++,A=L[1],L=[0];continue;case 7:L=D.ops.pop(),D.trys.pop();continue;default:if(T=D.trys,!((T=T.length>0&&T[T.length-1])||L[0]!==6&&L[0]!==2)){D=0;continue}if(L[0]===3&&(!T||L[1]>T[0]&&L[1]<T[3])){D.label=L[1];break}if(L[0]===6&&D.label<T[1]){D.label=T[1],T=L;break}if(T&&D.label<T[2]){D.label=T[2],D.ops.push(L);break}T[2]&&D.ops.pop(),D.trys.pop();continue}L=C.call(O,D)}catch(W){L=[6,W],A=0}finally{b=T=0}if(5&L[0])throw L[1];return{value:L[0]?L[1]:void 0,done:!0}}([P,I])}}},f=this&&this.__rest||function(O,C){var b={};for(var A in O)Object.prototype.hasOwnProperty.call(O,A)&&C.indexOf(A)<0&&(b[A]=O[A]);if(O!=null&&typeof Object.getOwnPropertySymbols=="function"){var T=0;for(A=Object.getOwnPropertySymbols(O);T<A.length;T++)C.indexOf(A[T])<0&&Object.prototype.propertyIsEnumerable.call(O,A[T])&&(b[A[T]]=O[A[T]])}return b},y=this&&this.__importDefault||function(O){return O&&O.__esModule?O:{default:O}};Object.defineProperty(s,"__esModule",{value:!0}),s.LocalStream=void 0;var S=a(5805),l=a(3412),h=a(5044),p=a(9428),v=a(5259),g=a(233),R=y(a(335)),_=a(6295),w=a(2718),k=function(O){function C(){var b=O.call(this)||this;return b.screenSurfaceType="",b.VideoProfileMap=new Map(v.VideoProfileMap),b.ScreenProfileMap=new Map(v.ScreenProfileMap),b.AudioProfileMap=new Map(v.AudioProfileMap),b.deviceManager=new l.BrowserDeviceManager,b.mediastream=new MediaStream,b.hasVideo=!1,b.hasScreen=!1,b.videoProfile="360p_1",b.screenProfile="720p_1",b.audioProfile="standard",b.isCustomStream=!1,b.handleVideoTrackEnded=b.handleVideoTrackEnded.bind(b),b.handleAudioTrackEnded=b.handleAudioTrackEnded.bind(b),b}return u(C,O),Object.defineProperty(C.prototype,"mediaStream",{get:function(){return this.mediastream},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"audioTrack",{get:function(){return this.audiotrack},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"videoTrack",{get:function(){return this.videotrack},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"hasAudio",{get:function(){return!!this.audioTrack},enumerable:!1,configurable:!0}),C.prototype.getVideoProfile=function(){if(this.hasVideo)return this.videoProfile},C.prototype.getScreenProfile=function(){if(this.hasScreen)return this.screenProfile},C.prototype.getAudioProfile=function(){if(this.hasAudio)return this.audioProfile},C.prototype.init=function(b){return b.custom?this.createCustomStream(b.mediaStream):this.initWithRetry(b)},C.prototype.initWithRetry=function(b,A,T){var M=this;return new Promise(function(D,N){D=A||D,N=T||N;var P=[];P.push(M.initMicAudio(b)),b.video?P.push(M.initCameraVideo(b)):b.screen&&P.push(M.initScreenVideoAudio(b)),Promise.all(P).then(function(){M.tryMixMicAndScreenAudio(b),M.initTracks(b),b.skipProfile?D():M.tryToSetProfile(b).then(function(){D()}).catch(function(I){console.log(I),M.resetLocalStream(),M.initWithRetry(d(d({},b),{skipProfile:!0}),D,N)})}).catch(function(I){M.stopAllTracks(),N(I)})})},C.prototype.initMicAudio=function(b){var A=this;return new Promise(function(T,M){if(!b||!b.audio)return T();var D={deviceId:b.audio===!0?"":String(b.audio.deviceId)};A.deviceManager.getAudioTrack(D).then(function(N){A.micAudioTrack=N,A.audiotrack=N,T()}).catch(function(N){M(new h.RtsError(N.code,N.reason,"",N.relatedLink))})})},C.prototype.initCameraVideo=function(b){var A=this;return new Promise(function(T,M){if(!b||!b.video)return T();var D={};b.video===!0?D.deviceId="":D=b.video,A.deviceManager.getVideoTrack(D).then(function(N){A.videotrack=N,A.hasVideo=!0,T()}).catch(function(N){M(new h.RtsError(N.code,N.reason,"",N.relatedLink))})})},C.prototype.initScreenVideoAudio=function(b){var A=this;return new Promise(function(T,M){if(b.screen){var D=!0,N=!1,P={};if(typeof b.screen!="boolean"){var I=b.screen,L=I.video,W=I.audio;P=f(I,["video","audio"]),D=typeof L!="object"||L,typeof W!="boolean"&&typeof W!="object"||(N=W)}g.SystemUtil.isMacOS&&g.BrowserUtil.isSafari&&["16.1","16.2","16.3"].indexOf(g.BrowserUtil.browserVersion)>-1&&typeof D=="object"&&(typeof D.width=="number"&&(D.width={max:D.width}),typeof D.height=="number"&&(D.height={max:D.height})),A.deviceManager.getScreenStream(d({video:D,audio:N},P)).then(function(U){A.videotrack=U.getVideoTracks()[0],A.videotrack&&A.videotrack.getSettings&&(A.screenSurfaceType=A.videotrack.getSettings().displaySurface),A.hasScreen=!0;var x=U.getAudioTracks()[0];x&&(A.screenAudioTrack=x),T()}).catch(function(U){M(new h.RtsError(U.code,U.reason,"",U.relatedLink))})}})},C.prototype.tryMixMicAndScreenAudio=function(b){b.audio&&this.micAudioTrack&&this.hasScreenAudioConfig(b)&&this.screenAudioTrack?(this.audioMixer||(this.audioMixer=new R.default({useGainNode:!1,trackList:[]})),this.audioMixer.updateTrackList([this.screenAudioTrack,this.micAudioTrack]),this.audiotrack=this.audioMixer.getMixedAudioTrack()):b.audio&&this.micAudioTrack?this.audiotrack=this.micAudioTrack:this.hasScreenAudioConfig(b)&&this.screenAudioTrack&&(this.audiotrack=this.screenAudioTrack)},C.prototype.initTracks=function(b){this.hasAudioTrackReady(b)&&this.audiotrack&&this.mediastream.addTrack(this.audiotrack),this.hasVideoTrackReady(b)&&this.videotrack&&this.mediastream.addTrack(this.videotrack),this.addTrackListener()},C.prototype.tryToSetProfile=function(b){var A=this;return new Promise(function(T,M){return E(A,void 0,void 0,function(){var D;return m(this,function(N){switch(N.label){case 0:return N.trys.push([0,4,,5]),b.video?[4,this.setVideoProfile(this.videoProfile)]:[3,2];case 1:return N.sent(),[3,3];case 2:b.screen&&this.setScreenProfile(this.screenProfile).catch(function(P){console.log(P)}),N.label=3;case 3:return T(),[3,5];case 4:return D=N.sent(),M(new h.RtsError(p.ErrorCode.ERROR_DEIVCE_CONSTRAINEDERROR,"apply constraint failed","",{originErr:D,config:b})),[3,5];case 5:return[2]}})})})},C.prototype.stopAllTracks=function(){this.screenAudioTrack&&(this.screenAudioTrack.stop(),this.screenAudioTrack=void 0),this.micAudioTrack&&(this.micAudioTrack.stop(),this.micAudioTrack=void 0),this.audioTrack&&(this.audioTrack.stop(),this.audiotrack=void 0),this.videoTrack&&(this.videoTrack.stop(),this.videotrack=void 0)},C.prototype.resetLocalStream=function(){this.deviceManager=new l.BrowserDeviceManager,this.mediastream=new MediaStream,this.hasVideo=!1,this.hasScreen=!1,this.videoProfile="360p_1",this.screenProfile="720p_1",this.isCustomStream=!1,this.stopAllTracks(),this.audioMixer=void 0,this.screenSurfaceType=""},C.prototype.setEncodeParam=function(b,A){var T=this;this.pc=b;var M=!1,D=!1;A?A==="video"?M=!0:A==="audio"&&(D=!0):M=D=!0,b.getSenders().forEach(function(N){var P=N.track;!P||P.kind!=="video"&&P.kind!=="audio"||(P.kind==="video"&&M&&T.setVideoEncodeParams(N),P.kind==="audio"&&D&&T.setAudioEncodeParams(N))})},C.prototype.setVideoEncodeParams=function(b){var A,T,M;if(((A=b.track)===null||A===void 0?void 0:A.id)===((T=this.videoTrack)===null||T===void 0?void 0:T.id)&&(this.hasVideo?M=this.VideoProfileMap.get(this.videoProfile):this.hasScreen&&(M=this.ScreenProfileMap.get(this.screenProfile)),M&&b.setParameters&&b.getParameters)){var D=b.getParameters();D.degradationPreference="maintain-resolution",D.encodings.forEach(function(N){M!=null&&M.maxBitrate&&(N.maxBitrate=1024*M.maxBitrate),M!=null&&M.frameRate&&(N.maxFramerate=M.frameRate)}),b.setParameters(D)}},C.prototype.setAudioEncodeParams=function(b){var A,T;if(((A=b.track)===null||A===void 0?void 0:A.id)===((T=this.audioTrack)===null||T===void 0?void 0:T.id)){var M=this.AudioProfileMap.get(this.audioProfile);if(M&&b.setParameters&&b.getParameters){var D=b.getParameters();D.encodings.forEach(function(N){M.maxBitrate&&(N.maxBitrate=1024*M.maxBitrate)}),b.setParameters(D)}}},C.prototype.play=function(b,A){var T,M=this;if((T=this.reporter)===null||T===void 0||T.reportPlay(b?b.nodeName:String(b)),b&&(this.element=b,this.mediastream)){if(this.element.srcObject=this.mediastream,(g.SystemUtil.isIos&&g.SystemUtil.systemVersion.indexOf("15.1")===0&&(g.BrowserUtil.isSafari||g.BrowserUtil.isChrome||g.BrowserUtil.isMicroMessenger)||(A==null?void 0:A.canvasStream))&&this.hasVideo){if(this.canvasRenderer)return;this.canvasRenderer=new _.CanvasRenderer({video:this.element});var D=this;this.element.addEventListener("loadeddata",function N(){if(D.element&&(D.element.removeEventListener("loadeddata",N),D.canvasRenderer)){D.canvasRenderer.start();var P=D.canvasRenderer.mediaStream;P&&(D.mediastream=P,D.videotrack=P.getVideoTracks()[0])}}),this.element.addEventListener("resize",function(){var N;if(M){var P=M.element;P&&((N=M.canvasRenderer)===null||N===void 0||N.resize(P.videoWidth,P.videoHeight))}})}if(A&&A.autoplay===!1)return;this.element.play()}},C.prototype.setVideoProfile=function(b){var A=this;return new Promise(function(T,M){return E(A,void 0,void 0,function(){var D,N,P;return m(this,function(I){switch(I.label){case 0:if((P=this.reporter)===null||P===void 0||P.reportVideoProfile(b),!(D=this.VideoProfileMap.get(b)))return[3,5];if(this.isCustomStream||!this.hasVideo||!this.videotrack||!this.videotrack.applyConstraints)return[3,4];I.label=1;case 1:return I.trys.push([1,3,,4]),[4,this.videotrack.applyConstraints(D)];case 2:return I.sent(),[3,4];case 3:return N=I.sent(),[2,M(N)];case 4:return this.videoProfile=b,this.pc&&this.setEncodeParam(this.pc,"video"),T(this.videoProfile),[3,6];case 5:M("Profile not found"),I.label=6;case 6:return[2]}})})})},C.prototype.setScreenProfile=function(b){var A=this;return new Promise(function(T,M){return E(A,void 0,void 0,function(){var D,N,P;return m(this,function(I){switch(I.label){case 0:if((P=this.reporter)===null||P===void 0||P.reportScreenProfile(b),!(D=this.ScreenProfileMap.get(b)))return[3,5];if(!(this.hasScreen&&this.videotrack&&this.videotrack.applyConstraints))return[3,4];I.label=1;case 1:return I.trys.push([1,3,,4]),[4,this.videotrack.applyConstraints(D)];case 2:return I.sent(),[3,4];case 3:return N=I.sent(),[2,M(N)];case 4:return this.screenProfile=b,this.pc&&this.setEncodeParam(this.pc,"video"),T(this.screenProfile),[3,6];case 5:M("Profile not found"),I.label=6;case 6:return[2]}})})})},C.prototype.setAudioProfile=function(b){var A=this;return new Promise(function(T,M){return E(A,void 0,void 0,function(){var D,N,P;return m(this,function(I){switch(I.label){case 0:if((P=this.reporter)===null||P===void 0||P.reportAudioProfile(b),!(D=this.AudioProfileMap.get(b)))return[3,5];if(this.isCustomStream||!this.hasAudio||!this.audioTrack||!this.audioTrack.applyConstraints)return[3,4];I.label=1;case 1:return I.trys.push([1,3,,4]),[4,this.audioTrack.applyConstraints(D)];case 2:return I.sent(),[3,4];case 3:return N=I.sent(),[2,M(N)];case 4:return this.audioProfile=b,this.pc&&this.setEncodeParam(this.pc,"audio"),T(this.audioProfile),[3,6];case 5:M("Profile not found"),I.label=6;case 6:return[2]}})})})},C.prototype.enableAudio=function(){var b;return(b=this.reporter)===null||b===void 0||b.reportEnableAudio(),!!this.audiotrack&&(this.audiotrack.enabled=!0,!0)},C.prototype.disableAudio=function(){var b;return(b=this.reporter)===null||b===void 0||b.reportDisableAudio(),!!this.audiotrack&&(this.audiotrack.enabled=!1,!0)},C.prototype.enableVideo=function(){var b;return(b=this.reporter)===null||b===void 0||b.reportEnableVideo(),!!this.videotrack&&(this.videotrack.enabled=!0,!0)},C.prototype.disableVideo=function(){var b;return(b=this.reporter)===null||b===void 0||b.reportDisableVideo(),!!this.videotrack&&(this.videotrack.enabled=!1,!0)},C.prototype.stop=function(){var b;O.prototype.stop.call(this),this.hasVideo=!1,this.hasScreen=!1,this.isCustomStream=!1,this.canvasRenderer&&(this.canvasRenderer.stop(),this.canvasRenderer=void 0),this.audiotrack&&(this.audiotrack.stop(),this.audiotrack=void 0),this.videotrack&&(this.videotrack.stop(),this.videotrack=void 0),this.micAudioTrack&&(this.micAudioTrack.stop(),this.micAudioTrack=void 0),this.screenAudioTrack&&(this.screenAudioTrack.stop(),this.screenAudioTrack=void 0),(b=this.reporter)===null||b===void 0||b.reportStop(0)},C.prototype.mergeStream=function(b){var A=b.videoTrack,T=b.audioTrack;A&&(this.videoTrack&&(this.videoTrack.removeEventListener("ended",this.handleVideoTrackEnded),this.mediaStream.removeTrack(this.videoTrack)),this.mediaStream.addTrack(A),this.videotrack=A,this.listenVideoEnded(),this.hasVideo=b.hasVideo,this.hasScreen=b.hasScreen,this.isCustomStream=b.isCustomStream,this.hasVideo&&(this.videoProfile=b.videoProfile),this.hasScreen&&(this.screenProfile=b.screenProfile)),T&&(this.audioTrack&&(this.audioTrack.removeEventListener("ended",this.handleAudioTrackEnded),this.mediaStream.removeTrack(this.audioTrack)),this.mediaStream.addTrack(T),this.audiotrack=T,this.listenAudioEnded())},C.prototype.deleteTracks=function(b){b.audio&&this.audioTrack&&(this.mediaStream.removeTrack(this.audioTrack),this.audiotrack=void 0),b.video&&this.videoTrack&&(this.mediaStream.removeTrack(this.videoTrack),this.videotrack=void 0,this.hasScreen=!1,this.hasVideo=!1)},C.prototype.createCustomStream=function(b){var A=this;return new Promise(function(T,M){if(!b)return M(new h.RtsError(p.ErrorCode.ERROR_CUSTOMSTREAM_NONE,"MediaStream is required.",""));if(!(b instanceof MediaStream))return M(new h.RtsError(p.ErrorCode.ERROR_CUSTOMSTREAM_INVALID,"MediaStream is invalid.",""));if(b.getTracks().length===0)return M(new h.RtsError(p.ErrorCode.ERROR_CUSTOMSTREAM_TRACK_NONE,"MediaStream has no track.",""));var D=(0,w.getVideoTrack)(b),N=(0,w.getAudioTrack)(b);D&&(A.hasVideo=!0,A.videotrack=D,A.mediastream.addTrack(D)),N&&(A.audiotrack=N,A.mediastream.addTrack(N)),A.isCustomStream=!0,A.setVideoProfile(A.videoProfile),A.addTrackListener(),T()})},C.prototype.releaseMediaStream=function(){var b=this;this.mediastream.getTracks().forEach(function(A){A.stop(),b.mediastream.removeTrack(A)})},C.prototype.hasVideoTrackReady=function(b){return!(!b.video&&!b.screen||!this.videotrack)||!b.video&&!b.screen},C.prototype.hasScreenAudioConfig=function(b){return typeof b.screen=="object"&&b.screen.audio},C.prototype.hasAudioTrackReady=function(b){return!(b.audio&&(!this.hasMicAudioAndReady(b)&&!this.hasScreenAudioAndReady(b)||!this.audiotrack))},C.prototype.hasMicAudioAndReady=function(b){return b.audio&&this.micAudioTrack},C.prototype.hasScreenAudioAndReady=function(b){return this.hasScreenAudioConfig(b)&&this.screenAudioTrack},C.prototype.addTrackListener=function(){this.listenVideoEnded(),this.listenAudioEnded()},C.prototype.listenVideoEnded=function(){var b=this;this.videotrack&&this.videotrack.addEventListener("ended",this.handleVideoTrackEnded),this.micAudioTrack&&this.micAudioTrack.addEventListener("ended",function(){var A;b.emit("micAudioTrackEnded"),b.screenAudioTrack&&b.screenAudioTrack.readyState==="ended"&&((A=b.audioMixer)===null||A===void 0||A.destroy(),b.emit("audioTrackEnded"))}),this.screenAudioTrack&&this.screenAudioTrack.addEventListener("ended",function(){var A;b.emit("screenAudioTrackEnded"),b.micAudioTrack&&b.micAudioTrack.readyState==="ended"&&((A=b.audioMixer)===null||A===void 0||A.destroy(),b.emit("audioTrackEnded"))})},C.prototype.listenAudioEnded=function(){this.audiotrack&&this.audiotrack.addEventListener("ended",this.handleAudioTrackEnded)},C.prototype.handleVideoTrackEnded=function(){this.hasScreen=!1,this.hasVideo=!1,this.emit("videoTrackEnded")},C.prototype.handleAudioTrackEnded=function(){this.emit("audioTrackEnded")},C}(S.Stream);s.LocalStream=k},771:function(o,s,a){var c,u=this&&this.__extends||(c=function(S,l){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,p){h.__proto__=p}||function(h,p){for(var v in p)Object.prototype.hasOwnProperty.call(p,v)&&(h[v]=p[v])},c(S,l)},function(S,l){if(typeof l!="function"&&l!==null)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");function h(){this.constructor=S}c(S,l),S.prototype=l===null?Object.create(l):(h.prototype=l.prototype,new h)});Object.defineProperty(s,"__esModule",{value:!0}),s.RemoteStream=void 0;var d=a(5805),E=a(233),m=a(5044),f=a(9428),y=function(S){function l(){var h=S.call(this)||this;return h.recvCanPlay=!1,h.autoplay=!0,h.onCanPlay=h.onCanPlay.bind(h),h}return u(l,S),Object.defineProperty(l.prototype,"muted",{get:function(){return!!this.element&&this.element.muted},set:function(h){this.element&&(this.element.muted=h)},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"audioTrack",{get:function(){var h;return(h=this.mediastream)===null||h===void 0?void 0:h.getAudioTracks()[0]},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"videoTrack",{get:function(){var h;return(h=this.mediastream)===null||h===void 0?void 0:h.getVideoTracks()[0]},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"hasVideo",{get:function(){return!!this.videoTrack},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"hasAudio",{get:function(){return!!this.audioTrack},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"mediaStream",{get:function(){return this.mediastream},enumerable:!1,configurable:!0}),l.prototype.updateMediaStream=function(h){var p=this.mediastream||new MediaStream;h.getTracks().forEach(function(v){return p.addTrack(v)}),this.mediastream=p,this.element&&this.play(this.element)},l.prototype.getMediaStream=function(){return this.mediastream},l.prototype.mergeStream=function(h){if(this.mediaStream){var p=h.getVideoTracks()[0],v=h.getAudioTracks()[0];p&&(this.videoTrack&&this.mediaStream.removeTrack(this.videoTrack),this.mediaStream.addTrack(p),this.videotrack=p),v&&(this.audioTrack&&this.mediaStream.removeTrack(this.audioTrack),this.mediaStream.addTrack(v),this.audiotrack=v)}},l.prototype.play=function(h,p){if(this.autoplay=!!(!p||p.autoplay),h){if(!(h instanceof HTMLMediaElement))throw new m.RtsError(f.ErrorCode.ERROR_HTMLELEMENT_ERROR,"Param is not a HTMLMediaElement","",{element:h});this.recvCanPlay=!1,this.emit("mediaElementBinded"),this.element=h,this.element.addEventListener("canplay",this.onCanPlay);var v=this.mediaStream;this.element.addEventListener("playing",function g(){h.removeEventListener("playing",g),E.SystemUtil.isIos&&parseInt(E.SystemUtil.systemVersion)<=13&&!h.muted&&(v!=null&&v.getAudioTracks().length)&&(h.pause(),h.play())}),this.element.nodeName==="VIDEO"&&(this.element.setAttribute("playsinline",""),E.BrowserUtil.isMicroMessenger&&(this.element.setAttribute("x5-video-player-type","h5-page"),this.element.setAttribute("x5-playsinline",""),E.SystemUtil.isAndroid||E.SystemUtil.isIos&&this.element.setAttribute("x-webkit-airplay","allow"))),this.autoplay&&E.BrowserUtil.isSafari&&this.element.setAttribute("autoplay",""),this.mediastream&&this.bindMediaStream(this.mediastream)}else this.release()},l.prototype.disableVideo=function(){var h=this.getMediaStream();h&&h.getVideoTracks().forEach(function(p){p.enabled&&(p.enabled=!1)})},l.prototype.enableVideo=function(){var h=this.getMediaStream();h&&h.getVideoTracks().forEach(function(p){p.enabled||(p.enabled=!0)})},l.prototype.disableAudio=function(){var h=this.getMediaStream();h&&h.getAudioTracks().forEach(function(p){p.enabled&&(p.enabled=!1)})},l.prototype.enableAudio=function(){var h=this.getMediaStream();h&&h.getAudioTracks().forEach(function(p){p.enabled||(p.enabled=!0)})},l.prototype.stop=function(){S.prototype.stop.call(this),this.release()},l.prototype.onCanPlay=function(){var h=this;if(!this.recvCanPlay&&(this.emit("onCanPlay"),this.recvCanPlay=!0,this.autoplay))if(this.element)if(E.BrowserUtil.isMicroMessenger){var p=window.top!==window.self,v=window.WeixinJSBridge||window.top.WeixinJSBridge;v?v.invoke("getNetworkType",{},function(){h.tryToPlay()}):(p?window.top.document:document).addEventListener("WeixinJSBridgeReady",function(){v.invoke("getNetworkType",{},function(){h.tryToPlay()})})}else this.tryToPlay();else this.tryToPlay()},l.prototype.release=function(){this.element&&(this.element.pause(),this.element.srcObject=null,this.element.load(),this.element.removeEventListener("canplay",this.onCanPlay)),this.recvCanPlay=!1,this.mediastream=void 0},l.prototype.bindMediaStream=function(h){this.element&&(this.element.nodeName==="AUDIO"&&h.getVideoTracks()[0]&&h.removeTrack(h.getVideoTracks()[0]),this.element.srcObject=h),this.mediastream=h},l.prototype.tryToPlay=function(){var h=this;if(this.element){var p=this.element.play();p!==void 0&&p.then(function(){}).catch(function(v){console.log("playPromise err",v),h.element&&h.element.srcObject&&h.emit("onAutoPlayError")})}},l}(d.Stream);s.RemoteStream=y},5805:function(o,s,a){var c,u=this&&this.__extends||(c=function(f,y){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,l){S.__proto__=l}||function(S,l){for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(S[h]=l[h])},c(f,y)},function(f,y){if(typeof y!="function"&&y!==null)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");function S(){this.constructor=f}c(f,y),f.prototype=y===null?Object.create(y):(S.prototype=y.prototype,new S)}),d=this&&this.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(s,"__esModule",{value:!0}),s.Stream=void 0;var E=a(233),m=function(f){function y(){var S=f.call(this)||this;return S.traceid="",S.id=E.Guid.create(32),S}return u(y,f),Object.defineProperty(y.prototype,"traceId",{get:function(){return this.traceid},set:function(S){this.traceid=S},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"mediaElement",{get:function(){return this.element},enumerable:!1,configurable:!0}),y.prototype.setReporter=function(S){this.reporter=S},y.prototype.play=function(S){},y.prototype.stop=function(){this.traceid="",this.reporter=void 0},y}(d(a(102)).default);s.Stream=m},5676:function(o,s,a){var c,u=this&&this.__extends||(c=function(T,M){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(D,N){D.__proto__=N}||function(D,N){for(var P in N)Object.prototype.hasOwnProperty.call(N,P)&&(D[P]=N[P])},c(T,M)},function(T,M){if(typeof M!="function"&&M!==null)throw new TypeError("Class extends value "+String(M)+" is not a constructor or null");function D(){this.constructor=T}c(T,M),T.prototype=M===null?Object.create(M):(D.prototype=M.prototype,new D)}),d=this&&this.__assign||function(){return d=Object.assign||function(T){for(var M,D=1,N=arguments.length;D<N;D++)for(var P in M=arguments[D])Object.prototype.hasOwnProperty.call(M,P)&&(T[P]=M[P]);return T},d.apply(this,arguments)},E=this&&this.__awaiter||function(T,M,D,N){return new(D||(D=Promise))(function(P,I){function L(x){try{U(N.next(x))}catch(V){I(V)}}function W(x){try{U(N.throw(x))}catch(V){I(V)}}function U(x){var V;x.done?P(x.value):(V=x.value,V instanceof D?V:new D(function(j){j(V)})).then(L,W)}U((N=N.apply(T,M||[])).next())})},m=this&&this.__generator||function(T,M){var D,N,P,I,L={label:0,sent:function(){if(1&P[0])throw P[1];return P[1]},trys:[],ops:[]};return I={next:W(0),throw:W(1),return:W(2)},typeof Symbol=="function"&&(I[Symbol.iterator]=function(){return this}),I;function W(U){return function(x){return function(V){if(D)throw new TypeError("Generator is already executing.");for(;I&&(I=0,V[0]&&(L=0)),L;)try{if(D=1,N&&(P=2&V[0]?N.return:V[0]?N.throw||((P=N.return)&&P.call(N),0):N.next)&&!(P=P.call(N,V[1])).done)return P;switch(N=0,P&&(V=[2&V[0],P.value]),V[0]){case 0:case 1:P=V;break;case 4:return L.label++,{value:V[1],done:!1};case 5:L.label++,N=V[1],V=[0];continue;case 7:V=L.ops.pop(),L.trys.pop();continue;default:if(P=L.trys,!((P=P.length>0&&P[P.length-1])||V[0]!==6&&V[0]!==2)){L=0;continue}if(V[0]===3&&(!P||V[1]>P[0]&&V[1]<P[3])){L.label=V[1];break}if(V[0]===6&&L.label<P[1]){L.label=P[1],P=V;break}if(P&&L.label<P[2]){L.label=P[2],L.ops.push(V);break}P[2]&&L.ops.pop(),L.trys.pop();continue}V=M.call(T,L)}catch(j){V=[6,j],N=0}finally{D=P=0}if(5&V[0])throw V[1];return{value:V[0]?V[1]:void 0,done:!0}}([U,x])}}},f=this&&this.__importDefault||function(T){return T&&T.__esModule?T:{default:T}};Object.defineProperty(s,"__esModule",{value:!0}),s.Subscriber=void 0;var y,S=a(4865),l=a(5917),h=a(9428),p=f(a(8219)),v=f(a(102)),g=a(5044),R=a(7989),_=a(492),w=f(a(2818)),k=f(a(7028)),O=a(6091),C=a(771),b=a(2718);(function(T){T[T.Init=0]="Init",T[T.Requesting=1]="Requesting",T[T.Playing=2]="Playing",T[T.Waiting=3]="Waiting"})(y||(y={}));var A=function(T){function M(D,N){var P=T.call(this)||this;return P.monitorStatsHistory=[],P.playTimeIndex=0,P.playCatonIndex=0,P.reportPubFlag=!1,P.state=y.Init,P.subscribeAudio=!0,P.subscribeVideo=!0,P.signalingUrl="",P.pullStreamUrl="",P.noParsePullStreamUrl="",P.subReconnectTimes=0,P.isConnecting=!1,P.reconnectTimerHandle=null,P.reporter=D,P.playTimer=0,P.config=N||{playTimeOut:5e3},P.remoteStream=new C.RemoteStream,P.remoteStream.on("onAutoPlayError",function(){P.emit("onError",new g.RtsError(h.ErrorCode.ERROR_AUTOPLAY_ERROR,"auto play failed",""))}),P.remoteStream.on("onCanPlay",function(){return E(P,void 0,void 0,function(){var I,L,W,U,x,V,j,H,z,K,$;return m(this,function(Z){switch(Z.label){case 0:return I=new Date().getTime(),[4,this.peerconnection.sample()];case 1:return Z.sent(),L=-1,W=[],U=-1,this.monitorStatsHistory&&this.monitorStatsHistory.length&&(x=this.monitorStatsHistory[this.monitorStatsHistory.length-1],this.monitorStatsHistory.forEach(function(ne){var te=ne.rtt;te&&te>0&&W.push(te)}),L=Number((W.reduce(function(ne,te){return ne+te},0)/W.length).toFixed(3)),U=x.packetsLost,this.monitorStatsHistory=null),this.stopPlayTimer(),this.peerconnection.playStart(),this.subReconnectTimes=0,V=this._cnend||I,this.reporter.reportFirstFrameTime(this.noParsePullStreamUrl,this.remoteStream.traceId,this._cpend-this._cpstart,this._hrend-this._cpend,I-this._cpstart,0,V-this._hrend,{rttAvg:L,packetsLost:U},-1,-1,-1,(H=this.subscribeConfig)===null||H===void 0?void 0:H.vMsid,(z=this.subscribeConfig)===null||z===void 0?void 0:z.aMsid),(j=new O.PlayEvent(O.PlayType.PLAY_CANPLAY)).data={url:this.noParsePullStreamUrl,vMsid:(K=this.subscribeConfig)===null||K===void 0?void 0:K.vMsid,aMsid:($=this.subscribeConfig)===null||$===void 0?void 0:$.aMsid},this.emit("onPlayEvent",j),[2]}})})}),P.peerconnection=new S.RtsPeerconnection,P.peerconnection.on("onConnected",function(){P._cnend=new Date().getTime()}),P.peerconnection.on("streamEnded",function(I){var L=new O.PlayEvent(O.PlayType.PLAY_ENDED);L.data=d({},I),P.emit("onPlayEvent",L),P.emit("onError",new g.RtsError(h.ErrorCode.ERROR_STREAM_ENDED,"Stream Receiver Transport is Closed",P.remoteStream.traceId))}),P.peerconnection.on("onTrackEvent",function(I){I.streams&&I.streams.length&&(P.remoteStream.updateMediaStream(I.streams[0]),P.onTrackFunction&&P.onTrackFunction())}),P.peerconnection.on("connectStatusChange",function(I){I.status!==l.EConnectStatus.CONNECT_STATUS_DISCONNECTED&&I.status!==l.EConnectStatus.CONNECT_STATUS_RECONNECTING||!P.hasRetries()?P.emit("connectStatusChange",I):P.emit("onError",new g.RtsError(h.ErrorCode.ERROR_PC_DISCONNECTED,"PC disconnected",P.remoteStream.traceId))}),P.mediaObserver=new _.MediaObserver({handler:function(I,L,W){var U,x=new O.PlayEvent(O.PlayType.PLAY_TIMEOUT),V={url:I};L&&(V.vMsid=L),W&&(V.aMsid=W),x.data=V,P.emit("onPlayEvent",x);var j=new g.RtsError(h.ErrorCode.ERROR_INBOUND_TIMEOUT,"Media data timeout after ".concat((U=P.mediaObserver)===null||U===void 0?void 0:U.actTimeout," ms."),P.remoteStream.traceId);P.emit("onError",j)}}),P.peerconnection.on("onMonitorEvent",function(I){var L=I.eventList;if(I.type!=="pub"){if(L.length){for(var W=void 0,U=0;U<L.length;U++)if(L[U].url===(0,b.pruneSubUrl)(P.noParsePullStreamUrl,!0)){W=L[U];break}if(W){P.lastMeidaEventData=W;var x=W.video,V=W.audio;x&&P.monitorStatsHistory?P.monitorStatsHistory.push({rtt:x.transportStats.rtt,packetsLost:x.inboundRtpStats.packetsLost}):V&&P.monitorStatsHistory&&P.monitorStatsHistory.push({rtt:V.transportStats.rtt,packetsLost:V.inboundRtpStats.packetsLost}),y.Requesting===P.state?W.video?W.video.inboundRtpStatsPerSec.framesDecodedPerSecond>5&&(P.state=y.Playing):W.audio&&W.audio.inboundRtpStatsPerSec.bytesReceivedPerSecond>0&&(P.state=y.Playing):P.state!==y.Playing&&P.state!==y.Waiting||(++P.playTimeIndex,W.video&&(W.video.inboundRtpStatsPerSec.framesDecodedPerSecond<=5?(++P.playCatonIndex,y.Waiting!==P.state&&(P.state=y.Waiting,P.emit("onPlayEvent",new O.PlayEvent(O.PlayType.PLAY_WAITING)))):y.Waiting===P.state&&(P.state=y.Playing,P.emit("onPlayEvent",new O.PlayEvent(O.PlayType.PLAY_PLAYING)))),w.default.HEARTHEAT_INTERVAL===P.playTimeIndex&&(P.reportPubFlag=!0,L.forEach(function(H){P.doReportPullStats(H)}),P.playTimeIndex=0,P.playCatonIndex=0))}var j=new O.PlayEvent(O.PlayType.PLAY_MEDIA);j.data=[],L.forEach(function(H){var z={};z.url=H.url;var K=P.calcStreamPullStats(H);if(H.audio&&(z.audio={bytesReceivedPerSecond:H.audio.inboundRtpStatsPerSec.bytesReceivedPerSecond,rtt:H.audio.transportStats.rtt,lossRate:K.aloss},z.aMsid=H.aMsid),H.video){var $=H.video,Z=$.inboundRtpStats,ne=$.inboundRtpStatsPerSec,te=$.transportStats;z.video={bytesReceivedPerSecond:ne.bytesReceivedPerSecond,fps:Z.framesPerSecond||ne.framesDecodedPerSecond,framesDecodedPerSecond:ne.framesDecodedPerSecond,rtt:te.rtt,width:Z.frameWidth,height:Z.frameHeight,lossRate:K.vloss},z.vMsid=H.vMsid}z.networkQuality=K.net_qual||0,j.data.push(z)}),j.data&&j.data.length&&(j.data.forEach(function(H){var z;(z=P.mediaObserver)===null||z===void 0||z.check({audio:H.audio,video:H.video},H.url,H.vMsid,H.aMsid)}),j.data.length===1&&(j.data[0].audio||j.data[0].video)&&(j.data=d({},j.data[0])),P.emit("onPlayEvent",j))}}else P.reportPubFlag&&(P.handlePubMonitorEvent(L),P.reportPubFlag=!1)}),P.playTimer=0,P._cpstart=0,P._cpend=0,P._hrend=0,P._cnend=0,P.subscribeConfig={},P}return u(M,T),M.prototype.getPeerConnection=function(){return this.peerconnection},M.prototype.subscribe=function(D,N,P){var I=this;return new Promise(function(L,W){return E(I,void 0,void 0,function(){var U,x,V=this;return m(this,function(j){switch(j.label){case 0:return this.monitorStatsHistory=[],this.unsubscribe(),this.subscribeConfig=N||{},this.state=y.Requesting,this.noParsePullStreamUrl=D,this.parseUrl(D),(x=this.mediaObserver)===null||x===void 0||x.updateConfig({timeout:N==null?void 0:N.mediaTimeout}),U=N==null?void 0:N.signalUrl,this.signalingUrl=U||this.signalingUrl,this.checkPullUrl()?[3,1]:(W(new g.RtsError(h.ErrorCode.ERROR_PLAY_URL,"url need artc://","")),[3,8]);case 1:return this.subscribeAudio||this.subscribeVideo?[3,2]:(W(new g.RtsError(h.ErrorCode.ERROR_SUBSCRIBE_NOTHING,"subscribe nothing","")),[3,8]);case 2:if(this._cpstart=new Date().getTime(),!this.subscribeVideo||(N==null?void 0:N.isH264Checked))return[3,7];j.label=3;case 3:return j.trys.push([3,5,,6]),[4,new R.SupportUtil().loadH264(3)];case 4:return j.sent(),[3,6];case 5:return j.sent(),[3,6];case 6:j.label=7;case 7:this.peerconnection.createOffer(this.subscribeAudio,this.subscribeVideo,void 0,{offerSdpHook:N==null?void 0:N.offerSdpHook,answerSdpHook:N==null?void 0:N.answerSdpHook,encodedInsertableStreams:N==null?void 0:N.encodedInsertableStreams,disableStereo:N==null?void 0:N.disableStereo}).then(function(H){var z=H.desp;V._cpend=new Date().getTime(),V.reporter.reportSubscribeStart(V.noParsePullStreamUrl,V.signalingUrl,N==null?void 0:N.vMsid,N==null?void 0:N.aMsid),V.excuteSignal(z,{innerTcpOnly:!!(P!=null&&P.innerTcpOnly)}).then(function(K){var $;V.remoteStream.traceId=K,L(V.remoteStream);try{($=V.peerconnection.getPeerCore())===null||$===void 0||$.patchSubscribeStreamManagerRecord(V.noParsePullStreamUrl,d(d({},V.subscribeConfig),{stream:V.remoteStream}))}catch(Z){console.log(Z)}V.peerconnection.getSubMonitor().updateTranceiversController()}).catch(function(K){V._hrend=new Date().getTime();var $=new g.RtsError(K.errorCode?K.errorCode:h.ErrorCode.ERROR_HTTPREQUEST_ERROR,K.message,K?K.traceid:"",{response:K.response,sdp:K.sdp});W($)})}).catch(function(H){V._cpend=new Date().getTime();var z=new g.RtsError(h.ErrorCode.ERROR_CREATEOFFER,H.message,"");W(z)}),j.label=8;case 8:return[2]}})})})},M.prototype.unsubscribe=function(){var D;this.lastMeidaEventData&&this.doReportPullStats(this.lastMeidaEventData),this.stopPlayTimer(),this.peerconnection.dispose(),this.remoteStream.stop(),this.subscribeVideo=!0,this.subscribeAudio=!0,this.subscribeConfig={},this.state=y.Init,this.signalingUrl="",this.pullStreamUrl="",this.noParsePullStreamUrl="",this.onTrackFunction=void 0,this.playTimer=0,this._cpstart=0,this._cpend=0,this._hrend=0,this._cnend=0,this.monitorStatsHistory=[],(D=this.mediaObserver)===null||D===void 0||D.reset()},M.prototype.startLiveStream=function(D,N,P){var I=this;return console.error("APIsubscribe"),new Promise(function(L,W){I.unsubscribe(),I.state=y.Requesting,I.noParsePullStreamUrl=D,I.parseUrl(D);var U=P==null?void 0:P.signalUrl;I.signalingUrl=U||I.signalingUrl,I.pullStreamUrl===""?W(new g.RtsError(h.ErrorCode.ERROR_PLAY_URL,"url need artc://","")):I.subscribeAudio||I.subscribeVideo?!N||N.nodeName!=="AUDIO"&&N.nodeName!=="VIDEO"?W(new g.RtsError(h.ErrorCode.ERROR_HTMLELEMENT_ERROR,"need htmlaudioelement or htmlvideoelement","")):(I.subscribeAudio&&I.subscribeVideo?N.nodeName!=="VIDEO"&&I.emit("onError",new g.RtsError(h.ErrorCode.ERROR_HEMLELEMENT_NOTMATCH,"need htmlvideoelement","")):I.subscribeAudio?N.nodeName!=="AUDIO"&&I.emit("onError",new g.RtsError(h.ErrorCode.ERROR_HEMLELEMENT_NOTMATCH,"need htmlaudioelement","")):N.nodeName!=="VIDEO"&&I.emit("onError",new g.RtsError(h.ErrorCode.ERROR_HEMLELEMENT_NOTMATCH,"need htmlvieoelement","")),I._cpstart=new Date().getTime(),I.reporter.updateTid(),I.peerconnection.createOffer(I.subscribeAudio,I.subscribeVideo).then(function(x){var V=x.desp;I._cpend=new Date().getTime(),I.excuteSignal(V).then(function(j){I.remoteStream.traceId=j,I._hrend=new Date().getTime(),I.remoteStream.play(N),L(j)}).catch(function(j){I._hrend=new Date().getTime(),I.reporter.reportFirstFrameTime(I.noParsePullStreamUrl,j?j.traceid:"",I._cpend-I._cpstart,I._hrend-I._cpend,-1,-1,I._cnend-I._hrend),W(new g.RtsError(j.errorCode?j.errorCode:h.ErrorCode.ERROR_HTTPREQUEST_ERROR,j.message,""))})}).catch(function(x){I._cpend=new Date().getTime(),I.reporter.reportFirstFrameTime(I.noParsePullStreamUrl,x?x.traceid:"",I._cpend-I._cpstart,-1,-1,-1,I._cnend-I._hrend),W(new g.RtsError(h.ErrorCode.ERROR_CREATEOFFER,x.message,""))})):W(new g.RtsError(h.ErrorCode.ERROR_SUBSCRIBE_NOTHING,"subscribe nothing",""))})},M.prototype.stopLiveStream=function(){this.unsubscribe()},M.prototype.muteLiveStream=function(D){return this.remoteStream.muted=D,!0},M.prototype.excuteSignal=function(D,N){var P=this;return new Promise(function(I,L){var W,U,x,V,j={url:P.pullStreamUrl,amsid:((W=P.subscribeConfig)===null||W===void 0?void 0:W.aMsid)||["rts audio"],vmsid:((U=P.subscribeConfig)===null||U===void 0?void 0:U.vMsid)||["rts video"]};P.subscribeAudio||delete j.amsid,P.subscribeVideo||delete j.vmsid,p.default.post(P.signalingUrl,{version:((x=P.subscribeConfig)===null||x===void 0?void 0:x.signalVersion)||k.default.protocol_version,sdk_version:k.default.sdk_version,mode:((V=P.subscribeConfig)===null||V===void 0?void 0:V.signalMode)||"live",pull_streams:[j],jsep:D}).then(function(H){var z,K,$,Z,ne;if(H&&H.status===200){P._hrend=new Date().getTime();var te=(z=H.data)===null||z===void 0?void 0:z.trace_id;P.reporter.reportSubscribeOk({vurl:P.noParsePullStreamUrl,surl:P.signalingUrl,traceId:te,hrct:P._hrend-P._cpend,rslt:(K=H.data)===null||K===void 0?void 0:K.code});var ae=typeof(($=P.subscribeConfig)===null||$===void 0?void 0:$.tcpOnly)=="boolean"?P.subscribeConfig.tcpOnly:N==null?void 0:N.innerTcpOnly;P.peerconnection.recvAnswer(H.data,{answerSdpHook:(Z=P.subscribeConfig)===null||Z===void 0?void 0:Z.answerSdpHook,tcpOnly:ae}).then(function(){I(te)}).catch(function(le){le.traceid=H.data?H.data.trace_id:"",L({errorCode:h.ErrorCode.ERROR_ANSWER_ERROR,message:le.message?le.message:"set answer error",traceid:le.traceid,sdp:le.sdp})})}else L({message:H?"response status:"+H.status:"response is null",traceid:(ne=H==null?void 0:H.data)===null||ne===void 0?void 0:ne.trace_id,sdp:D.sdp})}).catch(function(H){return E(P,void 0,void 0,function(){var z,K;return m(this,function($){switch($.label){case 0:if(![400,500].includes((K=H.response)===null||K===void 0?void 0:K.status))return[3,4];H.sdp=D.sdp,$.label=1;case 1:return $.trys.push([1,3,,4]),[4,new R.SupportUtil().isSupport({isReceiveVideo:!0})];case 2:return $.sent(),[3,4];case 3:return z=$.sent(),H.errorCode=z==null?void 0:z.errorCode,H.message=z==null?void 0:z.message,this.subReconnectTimes=1/0,[3,4];case 4:return L(H),[2]}})})})})},M.prototype.checkPullUrl=function(){return!!this.noParsePullStreamUrl&&this.noParsePullStreamUrl.indexOf("artc://")===0},M.prototype.parseUrl=function(D){if(D===void 0&&(D=""),(D==null?void 0:D.indexOf("artc://"))===0){var N=D.indexOf("@");if(N>-1){var P=D.substring(N+1,D.length);this.pullStreamUrl=D.substring(0,N);for(var I=P.split("&"),L=0;L<I.length;++L)I[L]==="subaudio=no"&&(this.subscribeAudio=!1),I[L]==="subvideo=no"&&(this.subscribeVideo=!1)}else this.pullStreamUrl=D;var W=window.location.protocol,U=(["http:","https:"].indexOf(W)>-1?W:"https:")+"//";this.signalingUrl=this.pullStreamUrl.replace("artc://",U)}},M.prototype.stopPlayTimer=function(){this.playTimer&&clearTimeout(this.playTimer),this.playTimer=0},M.prototype.calcStreamPullStats=function(D){var N={},P=D.video,I=D.audio;if(P){var L=P.transportStats,W=P.inboundRtpStats,U=P.inboundRtpStatsPerSec,x=P.localCandidate,V=P.remoteCandidate;N=d(d({},N),{rtt:(L==null?void 0:L.rtt)!==-1?1e3*((L==null?void 0:L.rtt)||0):-1,cand_re_prot:V.protocol,cand_lo_prot:x.protocol,cand_re_addr:"".concat(V.ip||V.address,":").concat(V.port),cand_lo_addr:"".concat(x.ip||x.address,":").concat(x.port),w:W==null?void 0:W.frameWidth,h:W==null?void 0:W.frameHeight,vbps:Math.floor(8*U.bytesReceivedPerSecond),fps:W==null?void 0:W.framesPerSecond,dfps:Math.floor(U==null?void 0:U.framesDecodedPerSecond),vjb:Math.floor((0,b.getJitterBufferDelayAvg)(W==null?void 0:W.jitterBufferDelay,W==null?void 0:W.jitterBufferEmittedCount)),vMsid:D.vMsid,vloss:U.packetsLostRate})}return I&&(L=I.transportStats,W=I.inboundRtpStats,U=I.inboundRtpStatsPerSec,x=I.localCandidate,V=I.remoteCandidate,N=d(d({},N),{rtt:(L==null?void 0:L.rtt)!==-1?1e3*((L==null?void 0:L.rtt)||0):-1,cand_re_prot:V.protocol,cand_lo_prot:x.protocol,cand_re_addr:"".concat(V.ip||V.address,":").concat(V.port),cand_lo_addr:"".concat(x.ip||x.address,":").concat(x.port),abps:Math.floor(8*U.bytesReceivedPerSecond),ajb:Math.floor((0,b.getJitterBufferDelayAvg)(W==null?void 0:W.jitterBufferDelay,W.jitterBufferEmittedCount)),aMsid:D.aMsid,aloss:U.packetsLostRate})),N=d(d({},N),{net_qual:(0,b.evaluateNetworkCondition)(N.rtt,N.aloss,N.vloss,N.ajb,N.vjb)})},M.prototype.doReportPullStats=function(D){var N=this.calcStreamPullStats(D),P={ct:1e3*this.playCatonIndex,tt:1e3*this.playTimeIndex,url:D.url};P.tt&&(P=d(d({},P),N),this.reporter.reportPullStats(P),this.lastMeidaEventData=void 0)},M.prototype.retrySubscribe=function(D,N){return E(this,void 0,void 0,function(){var P,I,L,W,U,x,V;return m(this,function(j){switch(j.label){case 0:if(D.extraInfo=d(d({},D.extraInfo),{retryTimes:this.subReconnectTimes}),!this.hasRetries())return[2,!1];if(typeof((P=this.subscribeConfig)==null?void 0:P.beforeRetry)!="function")return[3,4];j.label=1;case 1:return j.trys.push([1,3,,4]),[4,P.beforeRetry({url:this.noParsePullStreamUrl,vMsid:P.vMsid,aMsid:P.aMsid,useTcp:N==null?void 0:N.innerTcpOnly})];case 2:return(I=j.sent())?(L=I.url,W=I.vMsid,U=I.aMsid,x=I.useTcp,this.reporter.reportReconnectParams("sub",L,W,U,x),this.noParsePullStreamUrl=L,this.subscribeConfig.vMsid=W,this.subscribeConfig.aMsid=U,typeof x=="boolean"&&(N=d(d({},N),{innerTcpOnly:x})),console.log(`retry with: 
[URL] `.concat(L,`
[VMSID]`).concat(W," [AMSID]").concat(U,`
[PROTOCOL] `).concat(x?"TCP":"UDP"))):(this.reporter.reportReconnectParams("sub"),this.subReconnectTimes=1/0),[3,4];case 3:return V=j.sent(),console.error("Error in beforeRetry",V),[3,4];case 4:return this.hasRetries()?(this.emit("connectStatusChange",{status:l.EConnectStatus.CONNECT_STATUS_RECONNECTING}),this.subReconnectTimes++,D.extraInfo.retryTimes=this.subReconnectTimes,D.extraInfo.tcpOnly=N==null?void 0:N.innerTcpOnly,this.subscribeWithReconnect(this.noParsePullStreamUrl,d({innerTcpOnly:N==null?void 0:N.innerTcpOnly},this.subscribeConfig)).catch(function(H){}),[2,!0]):(D.extraInfo.retryTimes=this.subReconnectTimes,[2,!1])}})})},M.prototype.subscribeWithReconnect=function(D,N,P,I){var L=this;return new Promise(function(W,U){W=P||W,U=I||U,L.isConnecting=!0;var x=(N||{}).innerTcpOnly;N==null||delete N.innerTcpOnly,L.subscribe(D,N,{innerTcpOnly:x}).then(function(V){L.isConnecting=!1,W(V)}).catch(function(V){var j;if(!L.isConnecting)return U(V);if(!h.RECONNECT_ERROR_EXCLUDE_LIST.includes(V.errorCode)&&L.hasRetries(!0)){var H=((j=L.subscribeConfig)===null||j===void 0?void 0:j.retryInterval)||l.DEFAULT_RETRY_SUBSCRIBE_INTERVAL;L.reconnectTimerHandle=setTimeout(function(){V.extraInfo=d(d({},V.extraInfo),{retryTimes:L.subReconnectTimes}),L.emit("reconnect",V),L.subscribeWithReconnect(D,N,W,U)},H)}else U(V),V.extraInfo=d(d({},V.extraInfo),{retryTimes:L.subReconnectTimes}),L.isConnecting=!1,L.emit("onError",V)})})},M.prototype.hasRetries=function(D){var N,P,I=l.DEFAULT_RETRY_SUBSCRIBE_LIMIT;typeof((N=this.subscribeConfig)===null||N===void 0?void 0:N.retryTimes)=="number"&&(I=Math.floor((P=this.subscribeConfig)===null||P===void 0?void 0:P.retryTimes));var L=this.subReconnectTimes<I;return D&&L&&this.subReconnectTimes++,L},M.prototype.resetResubscribeStatus=function(){this.subReconnectTimes=0,this.isConnecting=!1,this.reporter.updateTid(),this.reconnectTimerHandle!==null&&(clearTimeout(this.reconnectTimerHandle),this.reconnectTimerHandle=null)},M.prototype.handlePubMonitorEvent=function(D){var N=this;D.forEach(function(P){N.reporter.reportPushStats(P)})},M}(v.default);s.Subscriber=A},6901:function(o,s,a){var c,u=this&&this.__extends||(c=function(m,f){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(y,S){y.__proto__=S}||function(y,S){for(var l in S)Object.prototype.hasOwnProperty.call(S,l)&&(y[l]=S[l])},c(m,f)},function(m,f){if(typeof f!="function"&&f!==null)throw new TypeError("Class extends value "+String(f)+" is not a constructor or null");function y(){this.constructor=m}c(m,f),m.prototype=f===null?Object.create(f):(y.prototype=f.prototype,new y)});Object.defineProperty(s,"__esModule",{value:!0}),s.AudioReceiverMonitorData=void 0;var d=a(1353),E=function(m){function f(){return m.call(this,d.ReceiverMonitorType.AUDIO)||this}return u(f,m),f}(d.ReceiverMonitorData);s.AudioReceiverMonitorData=E},1353:function(o,s,a){var c,u=this&&this.__extends||(c=function(l,h){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,v){p.__proto__=v}||function(p,v){for(var g in v)Object.prototype.hasOwnProperty.call(v,g)&&(p[g]=v[g])},c(l,h)},function(l,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");function p(){this.constructor=l}c(l,h),l.prototype=h===null?Object.create(h):(p.prototype=h.prototype,new p)}),d=this&&this.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(s,"__esModule",{value:!0}),s.ReceiverMonitorData=s.ReceiverMonitorType=void 0;var E,m=a(233),f=d(a(102)),y=a(2688);(function(l){l.AUDIO="audio",l.VIDEO="video"})(E||(s.ReceiverMonitorType=E={}));var S=function(l){function h(p){var v=l.call(this)||this;return v.streamEnded=!1,v.currentTimeGap=0,v.lastTimeStamp=0,v.transportStats={},v.remoteCandidate={},v.localCandidate={},v.inboundRtpStreamStats={},v.inboundRtpStreamStatsDiff={},v.receiver=null,v.pc=null,v.canplay=!1,v.type=p,v}return u(h,l),Object.defineProperty(h.prototype,"rtpReceiver",{set:function(p){this.receiver=p},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"RTCPeerconnection",{set:function(p){this.pc=p},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"isExist",{get:function(){return this.receiver!=null},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"isPlaying",{get:function(){return this.canplay},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"isStreamEnded",{get:function(){return this.streamEnded},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"monitorData",{get:function(){var p=this.inboundRtpStreamStatsDiff||{},v=(this.inboundRtpStreamStats,this.currentTimeGap),g=0;return p.nackCount!==void 0&&p.packetsReceived!==void 0&&(g=Math.round(p.nackCount/(p.packetsReceived+p.nackCount)*1e3)/1e3),{inboundRtpStats:this.inboundRtpStreamStats,inboundRtpStatsPerSec:{bytesReceivedPerSecond:p.bytesReceived/v||0,framesDecodedPerSecond:p.framesDecoded/v||0,packetsLostRate:g>0?g:0},transportStats:this.transportStats,remoteCandidate:this.remoteCandidate,localCandidate:this.localCandidate}},enumerable:!1,configurable:!0}),h.prototype.getInfo=function(){var p=this;if(this.receiver&&this.receiver.transport&&this.receiver.transport.state==="closed"&&this.canplay&&(this.streamEnded=!0,this.emit("streamEnded"),this.canplay=!1),this.receiver&&"getStats"in this.receiver||this.pc&&"getStats"in this.pc)return new Promise(function(v,g){var R=null,_=!1;p.receiver&&"getStats"in p.receiver?R=p.receiver.getStats():p.pc&&"getStats"in p.pc&&(R=p.pc.getStats(),_=!0),R==null||R.then(function(w){w.forEach(function(k){var O,C;if(k)switch(k.type){case y.RTCStatsType.CandidatePair:p.onCandidatePair(k);break;case y.RTCStatsType.InboundRtp:m.SystemUtil.isIos&&_?!((O=k.id)===null||O===void 0)&&O.toLowerCase().includes(p.type)&&p.onInBoundRtp(k):m.BrowserUtil.isFirefox?k.kind===p.type&&p.onInBoundRtp(k):p.onInBoundRtp(k);break;case y.RTCStatsType.RemoteCandidate:p.onRemoteCandidate(k);break;case y.RTCStatsType.LocalCandidate:p.onLocalCandidate(k);break;case y.RTCStatsType.Track:if(p.type!==E.VIDEO)break;m.SystemUtil.isIos&&_?(!((C=k.id)===null||C===void 0)&&C.toLowerCase().includes(p.type)||k.trackIdentifier.toLowerCase()===p.type)&&p.onTrack(k):p.onTrack(k)}}),v("")}).catch(function(w){g(w)})})},h.prototype.dispose=function(){this.reset()},h.prototype.onCandidatePair=function(p){(p.state==="succeeded"||p.bytesReceived)&&(this.transportStats={timestamp:Math.floor(p.timestamp),rtt:p.currentRoundTripTime||-1,bytesReceived:p.bytesReceived,bytesSent:p.bytesSent})},h.prototype.onInBoundRtp=function(p){this.currentTimeGap=(p.timestamp-this.lastTimeStamp)/1e3,this.lastTimeStamp=p.timestamp,this.inboundRtpStreamStatsDiff=this.calcDiff(p,this.inboundRtpStreamStats,["bytesReceived","framesDecoded","packetsReceived","nackCount"]),this.inboundRtpStreamStats=p,!this.canplay&&Number(p.bytesReceived)>0&&(this.canplay=!0,this.emit("canPlay"))},h.prototype.calcDiff=function(p,v,g){var R={};return g.forEach(function(_){R[_]=Number(p[_]||0)-Number(v[_]||0)}),R},h.prototype.onRemoteCandidate=function(p){this.remoteCandidate=p||{}},h.prototype.onLocalCandidate=function(p){this.localCandidate=p||{}},h.prototype.onTrack=function(p){p.frameWidth&&(this.inboundRtpStreamStats.frameWidth=p.frameWidth,this.inboundRtpStreamStats.frameHeight=p.frameHeight)},h.prototype.reset=function(){this.currentTimeGap=0,this.lastTimeStamp=0,this.transportStats={},this.remoteCandidate={},this.localCandidate={},this.inboundRtpStreamStats={},this.inboundRtpStreamStatsDiff={},this.receiver=null,this.canplay=!1,this.streamEnded=!1},h}(f.default);s.ReceiverMonitorData=S},5250:function(o,s,a){var c,u=this&&this.__extends||(c=function(m,f){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(y,S){y.__proto__=S}||function(y,S){for(var l in S)Object.prototype.hasOwnProperty.call(S,l)&&(y[l]=S[l])},c(m,f)},function(m,f){if(typeof f!="function"&&f!==null)throw new TypeError("Class extends value "+String(f)+" is not a constructor or null");function y(){this.constructor=m}c(m,f),m.prototype=f===null?Object.create(f):(y.prototype=f.prototype,new y)});Object.defineProperty(s,"__esModule",{value:!0}),s.VideoReceiverMonitorData=void 0;var d=a(1353),E=function(m){function f(){return m.call(this,d.ReceiverMonitorType.VIDEO)||this}return u(f,m),f}(d.ReceiverMonitorData);s.VideoReceiverMonitorData=E},2688:(o,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.RTCStatsType=void 0;var a=function(){function c(){}return c.CandidatePair="candidate-pair",c.Certificate="certificate",c.Codec="codec",c.Csrc="csrc",c.DataCahnnel="data-channel",c.InboundRtp="inbound-rtp",c.LocalCandidate="local-candidate",c.OutboundRtp="outbound-rtp",c.PeerConnection="peer-connection",c.Receiver="receiver",c.RemoteCandidate="remote-candidate",c.RemoteInboundRtp="remote-inbound-rtp",c.RemoteOutboundRtp="remote-outbound-rtp",c.Sender="sender",c.Stream="stream",c.Track="track",c.Transport="transport",c.MediaSource="media-source",c}();s.RTCStatsType=a},5657:(o,s,a)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.SenderMonitorData=void 0;var c=a(2688),u=function(){function d(){this._audiosender=null,this._videosender=null,this.timeStamp=0,this.curTimeStamp=0,this.audioBytesSent=0,this.curAudioBytesSent=0,this.videoBytesSent=0,this.curVideoBytesSent=0,this.audioRetransmittedBytesSent=0,this.curAudioRetransmittedBytesSent=0,this.videoRetransmiitedBytesSent=0,this.curVideoRetransmiitedBytesSent=0,this.framesSent=0,this.curFramesSent=0,this.framesEncoded=0,this.curFramesEncoded=0,this.rtt=0,this.localProtocol="",this.remoteProtocol="",this.localTransportAddr="",this.remoteTransportAddr="",this.frameHeight=0,this.frameWidth=0,this.efps=0,this.sfps=0,this.timeGap=0,this.abps=0,this.vbps=0,this.rt_abps=0,this.rt_vbps=0,this.stashedData={}}return Object.defineProperty(d.prototype,"videoSender",{set:function(E){this._videosender=E},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"audioSender",{set:function(E){this._audiosender=E},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"monitorData",{get:function(){return this.doCalc(),{tt:parseFloat(this.timeGap.toFixed(0)),rtt:this.rtt,cand_re_prot:this.remoteProtocol,cand_lo_prot:this.localProtocol,cand_re_addr:this.remoteTransportAddr,cand_lo_addr:this.localTransportAddr,w:this.frameWidth,h:this.frameHeight,efps:parseFloat(this.efps.toFixed(0)),fps:parseFloat(this.sfps.toFixed(0)),abps:parseFloat(this.abps.toFixed(0)),vbps:parseFloat(this.vbps.toFixed(0)),rt_abps:parseFloat(this.rt_abps.toFixed(0)),rt_vbps:parseFloat(this.rt_vbps.toFixed(0))}},enumerable:!1,configurable:!0}),d.prototype.doCalc=function(){this.timeStamp!==0&&(this.timeGap=this.curTimeStamp-this.timeStamp,this.timeGap>0&&(this.efps=1e3*(this.curFramesEncoded-this.framesEncoded)/this.timeGap,this.sfps=1e3*(this.curFramesSent-this.framesSent)/this.timeGap,this.abps=1e3*(this.curAudioBytesSent-this.audioBytesSent)/this.timeGap,this.vbps=1e3*(this.curVideoBytesSent-this.videoBytesSent)/this.timeGap,this.rt_abps=1e3*(this.curAudioRetransmittedBytesSent-this.audioRetransmittedBytesSent)/this.timeGap,this.rt_vbps=1e3*(this.curVideoRetransmiitedBytesSent-this.videoRetransmiitedBytesSent)/this.timeGap)),this.timeStamp=this.curTimeStamp,this.audioBytesSent=this.curAudioBytesSent,this.videoBytesSent=this.curVideoBytesSent,this.audioRetransmittedBytesSent=this.curAudioRetransmittedBytesSent,this.videoRetransmiitedBytesSent=this.curVideoRetransmiitedBytesSent,this.framesSent=this.curFramesSent,this.framesEncoded=this.curFramesEncoded},d.prototype.getInfo=function(){var E=this,m=new Promise(function(y,S){E._videosender&&E._videosender.getStats?E._videosender.getStats().then(function(l){l.forEach(function(h){if(h)switch(h.type){case c.RTCStatsType.CandidatePair:E.onCandidatePair(h);break;case c.RTCStatsType.OutboundRtp:E.onOutBoundRtp(h,"video");break;case c.RTCStatsType.RemoteCandidate:E.onRemoteCandidate(h);break;case c.RTCStatsType.LocalCandidate:E.onLocalCandidate(h)}}),y()}).catch(function(l){S(l)}):S("no video sender")}),f=new Promise(function(y,S){E._audiosender&&E._audiosender.getStats?E._audiosender.getStats().then(function(l){l.forEach(function(h){if(h)switch(h.type){case c.RTCStatsType.CandidatePair:E.onCandidatePair(h);break;case c.RTCStatsType.OutboundRtp:E.onOutBoundRtp(h,"audio");break;case c.RTCStatsType.RemoteCandidate:E.onRemoteCandidate(h);break;case c.RTCStatsType.LocalCandidate:E.onLocalCandidate(h)}}),y()}).catch(function(l){S(l)}):S("no audio sender")});return Promise.all([m,f])},d.prototype.onCandidatePair=function(E){this.curTimeStamp=E.timestamp,this.rtt=E.currentRoundTripTime},d.prototype.onOutBoundRtp=function(E,m){this.curTimeStamp=E.timestamp,m==="video"?(this.curVideoBytesSent=E.bytesSent,this.curVideoRetransmiitedBytesSent=E.retransmittedBytesSent,this.curFramesEncoded=E.framesEncoded,this.curFramesSent=E.framesSent,this.frameWidth=E.frameWidth,this.frameHeight=E.frameHeight):m==="audio"&&(this.curAudioBytesSent=E.bytesSent,this.curAudioRetransmittedBytesSent=E.retransmittedBytesSent)},d.prototype.onRemoteCandidate=function(E){this.curTimeStamp=E.timestamp,this.remoteProtocol=E.protocol,this.remoteTransportAddr=(E.ip||E.address)+(E.port?":"+E.port.toFixed(0):"")},d.prototype.onLocalCandidate=function(E){this.curTimeStamp=E.timestamp,this.localProtocol=E.protocol,this.localTransportAddr=(E.ip||E.address)+(E.port?":"+E.port.toFixed(0):"")},d}();s.SenderMonitorData=u},9752:function(o,s,a){var c,u=this&&this.__extends||(c=function(l,h){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,v){p.__proto__=v}||function(p,v){for(var g in v)Object.prototype.hasOwnProperty.call(v,g)&&(p[g]=v[g])},c(l,h)},function(l,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");function p(){this.constructor=l}c(l,h),l.prototype=h===null?Object.create(h):(p.prototype=h.prototype,new p)}),d=this&&this.__assign||function(){return d=Object.assign||function(l){for(var h,p=1,v=arguments.length;p<v;p++)for(var g in h=arguments[p])Object.prototype.hasOwnProperty.call(h,g)&&(l[g]=h[g]);return l},d.apply(this,arguments)},E=this&&this.__spreadArray||function(l,h,p){if(p||arguments.length===2)for(var v,g=0,R=h.length;g<R;g++)!v&&g in h||(v||(v=Array.prototype.slice.call(h,0,g)),v[g]=h[g]);return l.concat(v||Array.prototype.slice.call(h))},m=this&&this.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(s,"__esModule",{value:!0}),s.PubMonitor=void 0;var f=m(a(102)),y=a(5657),S=function(l){function h(){var p=l.call(this)||this;return p.heartbeatHandle=null,p.pc=null,p.pcCore=null,p.senderMonitorDataList=[],p}return u(h,l),h.prototype.startHeartbeat=function(p,v,g){var R=this;this.pc=p,this.pcCore=v,this.updateSenders(),this.stopHeartbeat(),this.heartbeatHandle=setInterval(function(){R.emitHeartBeat()},g||1e3)},h.prototype.stopHeartbeat=function(){this.heartbeatHandle!==null&&clearInterval(this.heartbeatHandle),this.heartbeatHandle=null},h.prototype.addTrackPair=function(p,v,g,R,_){var w=this;if(p){var k=new y.SenderMonitorData;if(v){k.videoSender=v;var O=v.transport;O&&(O.onstatechange=function(){var b,A,T,M;w.emit("onTransportStateEvent",{url:p,type:"pub",kind:"video",state:O.state,protocol:(M=(T=(A=(b=O.iceTransport)===null||b===void 0?void 0:b.getSelectedCandidatePair)===null||A===void 0?void 0:A.call(b))===null||T===void 0?void 0:T.local)===null||M===void 0?void 0:M.protocol})})}if(g){k.audioSender=g;var C=g.transport;C&&(C.onstatechange=function(){var b,A,T,M;w.emit("onTransportStateEvent",{url:p,type:"pub",kind:"audio",state:C.state,protocol:(M=(T=(A=(b=C.iceTransport)===null||b===void 0?void 0:b.getSelectedCandidatePair)===null||A===void 0?void 0:A.call(b))===null||T===void 0?void 0:T.local)===null||M===void 0?void 0:M.protocol})})}this.senderMonitorDataList.push({url:p,vMsid:R,aMsid:_,senderData:k})}},h.prototype.updateSenders=function(){var p,v=this,g=(p=this.pcCore)===null||p===void 0?void 0:p.getStreamManager().getAllTrackPairList("pub");this.senderMonitorDataList=[],g==null||g.forEach(function(R){v.addTrackPair(R.url,R.vTransceiver,R.aTransceiver,R.vMsid,R.aMsid)})},h.prototype.emitHeartBeat=function(){var p=this;Promise.all(this.senderMonitorDataList.reduce(function(v,g){return E(E([],v,!0),[g.senderData.getInfo()],!1)},[])).then(function(){}).catch(function(v){}).finally(function(){var v=p.senderMonitorDataList.map(function(g){return d(d({},g.senderData.monitorData),{url:g.url,vMsid:g.vMsid,aMsid:g.aMsid})});p.emit("onMonitorEvent",{eventList:v,type:"pub"})})},h}(f.default);s.PubMonitor=S},4699:function(o,s,a){var c,u=this&&this.__extends||(c=function(v,g){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,_){R.__proto__=_}||function(R,_){for(var w in _)Object.prototype.hasOwnProperty.call(_,w)&&(R[w]=_[w])},c(v,g)},function(v,g){if(typeof g!="function"&&g!==null)throw new TypeError("Class extends value "+String(g)+" is not a constructor or null");function R(){this.constructor=v}c(v,g),v.prototype=g===null?Object.create(g):(R.prototype=g.prototype,new R)}),d=this&&this.__awaiter||function(v,g,R,_){return new(R||(R=Promise))(function(w,k){function O(A){try{b(_.next(A))}catch(T){k(T)}}function C(A){try{b(_.throw(A))}catch(T){k(T)}}function b(A){var T;A.done?w(A.value):(T=A.value,T instanceof R?T:new R(function(M){M(T)})).then(O,C)}b((_=_.apply(v,g||[])).next())})},E=this&&this.__generator||function(v,g){var R,_,w,k,O={label:0,sent:function(){if(1&w[0])throw w[1];return w[1]},trys:[],ops:[]};return k={next:C(0),throw:C(1),return:C(2)},typeof Symbol=="function"&&(k[Symbol.iterator]=function(){return this}),k;function C(b){return function(A){return function(T){if(R)throw new TypeError("Generator is already executing.");for(;k&&(k=0,T[0]&&(O=0)),O;)try{if(R=1,_&&(w=2&T[0]?_.return:T[0]?_.throw||((w=_.return)&&w.call(_),0):_.next)&&!(w=w.call(_,T[1])).done)return w;switch(_=0,w&&(T=[2&T[0],w.value]),T[0]){case 0:case 1:w=T;break;case 4:return O.label++,{value:T[1],done:!1};case 5:O.label++,_=T[1],T=[0];continue;case 7:T=O.ops.pop(),O.trys.pop();continue;default:if(w=O.trys,!((w=w.length>0&&w[w.length-1])||T[0]!==6&&T[0]!==2)){O=0;continue}if(T[0]===3&&(!w||T[1]>w[0]&&T[1]<w[3])){O.label=T[1];break}if(T[0]===6&&O.label<w[1]){O.label=w[1],w=T;break}if(w&&O.label<w[2]){O.label=w[2],O.ops.push(T);break}w[2]&&O.ops.pop(),O.trys.pop();continue}T=g.call(v,O)}catch(M){T=[6,M],_=0}finally{R=w=0}if(5&T[0])throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}([b,A])}}},m=this&&this.__spreadArray||function(v,g,R){if(R||arguments.length===2)for(var _,w=0,k=g.length;w<k;w++)!_&&w in g||(_||(_=Array.prototype.slice.call(g,0,w)),_[w]=g[w]);return v.concat(_||Array.prototype.slice.call(g))},f=this&&this.__importDefault||function(v){return v&&v.__esModule?v:{default:v}};Object.defineProperty(s,"__esModule",{value:!0}),s.SubMonitor=void 0;var y=a(6901),S=a(5250),l=f(a(102)),h=function(){function v(){this.trackPairDataList=[]}return v.prototype.reset=function(){this.trackPairDataList=[]},v.prototype.addTrackPair=function(g,R,_,w,k,O){var C=new y.AudioReceiverMonitorData,b=new S.VideoReceiverMonitorData;w&&(b.rtpReceiver=w),k&&(C.rtpReceiver=k),O&&(b.RTCPeerconnection=O,C.RTCPeerconnection=O),this.trackPairDataList.push({url:g,vMsid:R,aMsid:_,audioReceiverMonitorData:C,videoReceiverMonitorData:b})},v}(),p=function(v){function g(){var R=v.call(this)||this;return R.canplay=!1,R.pc=null,R.pcCore=null,R.monitorTimerId=null,R.audioReceiverMonitorData=new y.AudioReceiverMonitorData,R.videoReceiverMonitorData=new S.VideoReceiverMonitorData,R.receiverMonitorController=new h,R}return u(g,v),g.prototype.start=function(R,_){this.pc=R,this.pcCore=_,this.updateTranceiversController(),this.startMonitorTimer(200)},g.prototype.updateTranceiversController=function(){var R=this;if(this.pc&&this.pcCore){var _=this.pcCore.getStreamManager().getAllTrackPairList("sub");this.receiverMonitorController.reset(),_.forEach(function(w){w.url&&R.receiverMonitorController.addTrackPair(w.url,w.vMsid,w.aMsid,w.vTransceiver,w.aTransceiver,R.pc)}),this.receiverMonitorController.trackPairDataList.forEach(function(w){R.initEvent(w)})}},g.prototype.resetTimer=function(R){this.updateTranceiversController(),this.stopMonitorTimer(),this.startMonitorTimer(R)},g.prototype.stop=function(){this.canplay=!1,this.stopMonitorTimer(),this.audioReceiverMonitorData.dispose(),this.videoReceiverMonitorData.dispose()},g.prototype.startMonitorTimer=function(R){var _=this;this.monitorTimerId||(this.monitorTimerId=window.setInterval(function(){_.onMonitorTimer()},R))},g.prototype.stopMonitorTimer=function(){this.monitorTimerId&&clearInterval(this.monitorTimerId),this.monitorTimerId=null},g.prototype.onMonitorTimer=function(){return d(this,void 0,void 0,function(){var R;return E(this,function(_){switch(_.label){case 0:return[4,this.updateMonitorData()];case 1:return _.sent(),R=[],this.receiverMonitorController.trackPairDataList.forEach(function(w){var k,O;if(w.url){var C={url:w.url};w.audioReceiverMonitorData.isExist&&(C.audio=(k=w.audioReceiverMonitorData)===null||k===void 0?void 0:k.monitorData,C.aMsid=w.aMsid),w.videoReceiverMonitorData.isExist&&(C.video=(O=w.videoReceiverMonitorData)===null||O===void 0?void 0:O.monitorData,C.vMsid=w.vMsid),R.push(C)}}),this.emit("onMonitorEvent",{eventList:R,type:"sub"}),[2]}})})},g.prototype.initEvent=function(R){var _=this,w={url:R.url||"url unknown",vMsid:R.vMsid||"vMsid unknown",aMsid:R.aMsid||"aMsid unknown"};R.audioReceiverMonitorData.isExist&&(R.audioReceiverMonitorData.on("streamEnded",function(){R.videoReceiverMonitorData&&!R.videoReceiverMonitorData.isStreamEnded||(_.emit("streamEnded",w),_.stopMonitorTimer())}),R.audioReceiverMonitorData.on("canPlay",function(){_.emitCanPlay()})),R.videoReceiverMonitorData.isExist&&(R.videoReceiverMonitorData.on("streamEnded",function(){R.audioReceiverMonitorData&&!R.audioReceiverMonitorData.isStreamEnded||(_.emit("streamEnded",w),_.stopMonitorTimer())}),R.videoReceiverMonitorData.on("canPlay",function(){_.emitCanPlay()}))},g.prototype.updateMonitorData=function(){return Promise.all(this.receiverMonitorController.trackPairDataList.reduce(function(R,_){var w,k;return m(m([],R,!0),[(w=_.audioReceiverMonitorData)===null||w===void 0?void 0:w.getInfo(),(k=_.videoReceiverMonitorData)===null||k===void 0?void 0:k.getInfo()],!1)},[]))},g.prototype.emitCanPlay=function(){this.canplay||(this.canplay=!0,this.emit("canPlay"))},g.prototype.copyMonitorData=function(){var R,_;!((_=(R=this.receiverMonitorController)===null||R===void 0?void 0:R.trackPairDataList)===null||_===void 0)&&_.length&&(this.audioReceiverMonitorData=this.receiverMonitorController.trackPairDataList[0].audioReceiverMonitorData,this.videoReceiverMonitorData=this.receiverMonitorController.trackPairDataList[0].videoReceiverMonitorData)},g.prototype.getTransportStats=function(){return d(this,void 0,void 0,function(){var R;return E(this,function(_){switch(_.label){case 0:return[4,this.updateMonitorData()];case 1:return _.sent(),this.copyMonitorData(),R={},this.videoReceiverMonitorData.isExist?R=this.videoReceiverMonitorData.monitorData.transportStats:this.audioReceiverMonitorData.isExist&&(R=this.audioReceiverMonitorData.monitorData.transportStats),[2,R]}})})},g.prototype.getRemoteVideoStats=function(){return d(this,void 0,void 0,function(){var R,_;return E(this,function(w){switch(w.label){case 0:return[4,this.updateMonitorData()];case 1:return w.sent(),this.copyMonitorData(),R={},this.videoReceiverMonitorData.isExist&&(_=this.videoReceiverMonitorData.monitorData.inboundRtpStats,R={timestamp:Math.floor(_.timestamp||0),framesDecodedPerSecond:_.framesPerSecond,framesDecoded:_.framesDecoded,frameWidth:_.frameWidth,frameHeight:_.frameHeight,bytesReceived:_.bytesReceived,jitter:_.jitter,jitterBufferDelayAvg:Number(_.jitterBufferDelay)/Number(_.jitterBufferEmittedCount),packetsLost:_.packetsLost,packetsReceived:_.packetsReceived}),[2,R]}})})},g.prototype.getRemoteAudioStats=function(){return d(this,void 0,void 0,function(){var R,_;return E(this,function(w){switch(w.label){case 0:return[4,this.updateMonitorData()];case 1:return w.sent(),this.copyMonitorData(),R={},this.audioReceiverMonitorData.isExist&&(_=this.audioReceiverMonitorData.monitorData.inboundRtpStats,R={timestamp:Math.floor(_.timestamp||0),bytesReceived:_.bytesReceived,jitter:_.jitter,jitterBufferDelayAvg:Number(_.jitterBufferDelay)/Number(_.jitterBufferEmittedCount),packetsLost:_.packetsLost,packetsReceived:_.packetsReceived}),[2,R]}})})},g}(l.default);s.SubMonitor=p},5259:(o,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.AudioProfileMap=s.VideoProfileMap=s.ScreenProfileMap=void 0,s.ScreenProfileMap=new Map,s.ScreenProfileMap.set("480p_1",{width:640,height:480,frameRate:5,maxBitrate:300}),s.ScreenProfileMap.set("480p_2",{width:640,height:480,frameRate:30,maxBitrate:1e3}),s.ScreenProfileMap.set("720p_1",{width:1280,height:720,frameRate:5,maxBitrate:800}),s.ScreenProfileMap.set("720p_2",{width:1280,height:720,frameRate:30,maxBitrate:2e3}),s.ScreenProfileMap.set("1080p_1",{width:1920,height:1080,frameRate:5,maxBitrate:1e3}),s.ScreenProfileMap.set("1080p_2",{width:1920,height:1080,frameRate:30,maxBitrate:3e3}),s.VideoProfileMap=new Map,s.VideoProfileMap.set("120p_1",{width:160,height:120,frameRate:15,maxBitrate:65}),s.VideoProfileMap.set("120p_3",{width:120,height:120,frameRate:15,maxBitrate:50}),s.VideoProfileMap.set("180p_1",{width:320,height:180,frameRate:15,maxBitrate:140}),s.VideoProfileMap.set("180p_3",{width:180,height:180,frameRate:15,maxBitrate:100}),s.VideoProfileMap.set("180p_4",{width:240,height:180,frameRate:15,maxBitrate:120}),s.VideoProfileMap.set("240p_1",{width:320,height:240,frameRate:15,maxBitrate:200}),s.VideoProfileMap.set("240p_3",{width:240,height:240,frameRate:15,maxBitrate:140}),s.VideoProfileMap.set("240p_4",{width:424,height:240,frameRate:15,maxBitrate:220}),s.VideoProfileMap.set("360p_1",{width:640,height:360,frameRate:15,maxBitrate:400}),s.VideoProfileMap.set("360p_3",{width:360,height:360,frameRate:15,maxBitrate:260}),s.VideoProfileMap.set("360p_4",{width:640,height:360,frameRate:30,maxBitrate:600}),s.VideoProfileMap.set("360p_6",{width:360,height:360,frameRate:30,maxBitrate:400}),s.VideoProfileMap.set("360p_7",{width:480,height:360,frameRate:15,maxBitrate:320}),s.VideoProfileMap.set("360p_8",{width:480,height:360,frameRate:30,maxBitrate:490}),s.VideoProfileMap.set("360p_9",{width:640,height:360,frameRate:15,maxBitrate:800}),s.VideoProfileMap.set("360p_10",{width:640,height:360,frameRate:24,maxBitrate:800}),s.VideoProfileMap.set("360p_11",{width:640,height:360,frameRate:24,maxBitrate:1e3}),s.VideoProfileMap.set("480p_1",{width:640,height:480,frameRate:15,maxBitrate:500}),s.VideoProfileMap.set("480p_2",{width:640,height:480,frameRate:30,maxBitrate:1e3}),s.VideoProfileMap.set("480p_3",{width:480,height:480,frameRate:15,maxBitrate:400}),s.VideoProfileMap.set("480p_4",{width:640,height:480,frameRate:30,maxBitrate:750}),s.VideoProfileMap.set("480p_6",{width:480,height:480,frameRate:30,maxBitrate:600}),s.VideoProfileMap.set("480p_8",{width:848,height:480,frameRate:15,maxBitrate:610}),s.VideoProfileMap.set("480p_9",{width:848,height:480,frameRate:30,maxBitrate:930}),s.VideoProfileMap.set("480p_10",{width:640,height:480,frameRate:10,maxBitrate:400}),s.VideoProfileMap.set("720p_1",{width:1280,height:720,frameRate:15,maxBitrate:1130}),s.VideoProfileMap.set("720p_2",{width:1280,height:720,frameRate:30,maxBitrate:2e3}),s.VideoProfileMap.set("720p_3",{width:1280,height:720,frameRate:30,maxBitrate:1710}),s.VideoProfileMap.set("720p_5",{width:960,height:720,frameRate:15,maxBitrate:910}),s.VideoProfileMap.set("720p_6",{width:960,height:720,frameRate:30,maxBitrate:1380}),s.VideoProfileMap.set("1080p_1",{width:1920,height:1080,frameRate:15,maxBitrate:2080}),s.VideoProfileMap.set("1080p_2",{width:1920,height:1080,frameRate:30,maxBitrate:3e3}),s.VideoProfileMap.set("1080p_3",{width:1920,height:1080,frameRate:30,maxBitrate:3150}),s.VideoProfileMap.set("1080p_5",{width:1920,height:1080,frameRate:60,maxBitrate:4780}),s.VideoProfileMap.set("1440p_1",{width:2560,height:1440,frameRate:30,maxBitrate:4850}),s.VideoProfileMap.set("1440p_2",{width:2560,height:1440,frameRate:60,maxBitrate:7350}),s.VideoProfileMap.set("4K_1",{width:3840,height:2160,frameRate:30,maxBitrate:8910}),s.VideoProfileMap.set("4K_3",{width:3840,height:2160,frameRate:60,maxBitrate:13500}),s.AudioProfileMap=new Map,s.AudioProfileMap.set("standard",{sampleRate:48e3,channelCount:1,maxBitrate:64}),s.AudioProfileMap.set("high",{sampleRate:48e3,channelCount:1,maxBitrate:128}),s.AudioProfileMap.set("standard-stereo",{sampleRate:48e3,channelCount:2,maxBitrate:80}),s.AudioProfileMap.set("high-stereo",{sampleRate:48e3,channelCount:2,maxBitrate:192})},5553:(o,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.Datachannel=void 0;var a=function(){function c(u){this.pc=u,this.messageId=1,this.dataChannel=this.pc.createDataChannel("GRTNDataChannel"),this.dataChannel.onopen=function(d){},this.dataChannel.onmessage=function(d){d.data},this.dataChannel.onclose=function(d){},this.dataChannel.onerror=function(d){}}return c.prototype.addTrack=function(u,d){return new Promise(function(E,m){})},c.prototype.removeTrack=function(u,d){return new Promise(function(E,m){})},c.prototype.createPublishPacket=function(){var u={type:"pub",version:1,msg_id:this.messageId,streams:[]};return++this.messageId,u},c}();s.Datachannel=a},4865:function(o,s,a){var c,u=this&&this.__extends||(c=function(D,N){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(P,I){P.__proto__=I}||function(P,I){for(var L in I)Object.prototype.hasOwnProperty.call(I,L)&&(P[L]=I[L])},c(D,N)},function(D,N){if(typeof N!="function"&&N!==null)throw new TypeError("Class extends value "+String(N)+" is not a constructor or null");function P(){this.constructor=D}c(D,N),D.prototype=N===null?Object.create(N):(P.prototype=N.prototype,new P)}),d=this&&this.__assign||function(){return d=Object.assign||function(D){for(var N,P=1,I=arguments.length;P<I;P++)for(var L in N=arguments[P])Object.prototype.hasOwnProperty.call(N,L)&&(D[L]=N[L]);return D},d.apply(this,arguments)},E=this&&this.__awaiter||function(D,N,P,I){return new(P||(P=Promise))(function(L,W){function U(j){try{V(I.next(j))}catch(H){W(H)}}function x(j){try{V(I.throw(j))}catch(H){W(H)}}function V(j){var H;j.done?L(j.value):(H=j.value,H instanceof P?H:new P(function(z){z(H)})).then(U,x)}V((I=I.apply(D,N||[])).next())})},m=this&&this.__generator||function(D,N){var P,I,L,W,U={label:0,sent:function(){if(1&L[0])throw L[1];return L[1]},trys:[],ops:[]};return W={next:x(0),throw:x(1),return:x(2)},typeof Symbol=="function"&&(W[Symbol.iterator]=function(){return this}),W;function x(V){return function(j){return function(H){if(P)throw new TypeError("Generator is already executing.");for(;W&&(W=0,H[0]&&(U=0)),U;)try{if(P=1,I&&(L=2&H[0]?I.return:H[0]?I.throw||((L=I.return)&&L.call(I),0):I.next)&&!(L=L.call(I,H[1])).done)return L;switch(I=0,L&&(H=[2&H[0],L.value]),H[0]){case 0:case 1:L=H;break;case 4:return U.label++,{value:H[1],done:!1};case 5:U.label++,I=H[1],H=[0];continue;case 7:H=U.ops.pop(),U.trys.pop();continue;default:if(L=U.trys,!((L=L.length>0&&L[L.length-1])||H[0]!==6&&H[0]!==2)){U=0;continue}if(H[0]===3&&(!L||H[1]>L[0]&&H[1]<L[3])){U.label=H[1];break}if(H[0]===6&&U.label<L[1]){U.label=L[1],L=H;break}if(L&&U.label<L[2]){U.label=L[2],U.ops.push(H);break}L[2]&&U.ops.pop(),U.trys.pop();continue}H=N.call(D,U)}catch(z){H=[6,z],I=0}finally{P=L=0}if(5&H[0])throw H[1];return{value:H[0]?H[1]:void 0,done:!0}}([V,j])}}},f=this&&this.__importDefault||function(D){return D&&D.__esModule?D:{default:D}};Object.defineProperty(s,"__esModule",{value:!0}),s.RtsPeerconnection=void 0;var y,S=a(4450),l=a(233),h=a(4315),p=a(2718),v=f(a(102)),g=a(5917),R=a(4699),_=a(9752),w=a(5553),k=a(9428),O=a(5044),C=f(a(6834));(function(D){D.Subscribe="sub",D.Publish="pub"})(y||(y={}));var b=window.RTCRtpReceiver&&"createEncodedStreams"in RTCRtpReceiver.prototype,A=window.RTCRtpReceiver&&"transform"in RTCRtpReceiver.prototype&&"RTCRtpScriptTransform"in window,T=function(D){function N(){var P=D.call(this)||this;return P.connectingEventSent=!1,P.reused=!1,P.transformWorkerList=new M,P.receiverCodecPreferences={},P.senderCodecPreferences={},P.subMonitor=new R.SubMonitor,P.subMonitor.on("onMonitorEvent",function(I){P.emit("onMonitorEvent",I)}),P.subMonitor.on("streamEnded",function(){P.emit("streamEnded")}),P.subMonitor.on("canPlay",function(){}),P.pubMonitor=new _.PubMonitor,P.pubMonitor.on("onMonitorEvent",function(I){P.emit("onMonitorEvent",I)}),P.pubMonitor.on("onTransportStateEvent",function(I){P.emit("onTransportStateEvent",I)}),P}return u(N,D),Object.defineProperty(N.prototype,"isConnected",{get:function(){var P;return((P=this.pc)===null||P===void 0?void 0:P.connectionState)==="connected"},enumerable:!1,configurable:!0}),Object.defineProperty(N.prototype,"isReused",{get:function(){return this.reused},set:function(P){this.reused=!!P},enumerable:!1,configurable:!0}),N.prototype.getWorkerManager=function(){return this.transformWorkerList},N.prototype.getPc=function(){return this.pc},N.prototype.getPeerCore=function(){return this.peerCore},N.prototype.getSubMonitor=function(){return this.subMonitor},N.prototype.getPubMonitor=function(){return this.pubMonitor},N.prototype.playStart=function(){this.subMonitor.resetTimer(1e3)},N.prototype.pushStart=function(){this.pc&&this.peerCore&&this.pubMonitor.startHeartbeat(this.pc,this.peerCore)},N.prototype.sample=function(){return E(this,void 0,void 0,function(){return m(this,function(P){switch(P.label){case 0:return[4,this.subMonitor.onMonitorTimer()];case 1:return P.sent(),[2]}})})},N.prototype.subAdd=function(P){var I;return(I=this.peerCore)===null||I===void 0?void 0:I.subscribeAdd(P)},N.prototype.subActive=function(P){var I;return(I=this.peerCore)===null||I===void 0?void 0:I.subscribeActive(P)},N.prototype.subStop=function(P){var I;return(I=this.peerCore)===null||I===void 0?void 0:I.subscribeStop(P)},N.prototype.subDeleteTracks=function(P){var I;return(I=this.peerCore)===null||I===void 0?void 0:I.subscribeDeleteTracks(P)},N.prototype.pubAdd=function(P){var I;return(I=this.peerCore)===null||I===void 0?void 0:I.publishAdd(P)},N.prototype.pubDeleteTracks=function(P){var I;return(I=this.peerCore)===null||I===void 0?void 0:I.publishDeleteTracks(P)},N.prototype.pubReplaceTracks=function(P){var I;return(I=this.peerCore)===null||I===void 0?void 0:I.publishReplaceTracks(P)},N.prototype.pubStop=function(P){var I;return(I=this.peerCore)===null||I===void 0?void 0:I.publishStop(P)},N.prototype.createOffer=function(P,I,L,W){var U=this;return W===void 0&&(W={publishUrl:""}),new Promise(function(x,V){var j;(j=U.cancelable)===null||j===void 0||j.cancel();var H={googCpuOveruseDetection:!1,sdpSemantics:"unified-plan",encodedInsertableStreams:W.encodedInsertableStreams,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"};if(l.BrowserUtil.isChrome&&Number(l.BrowserUtil.browserMainVersion)<=55&&(H.iceServers=[]),U.pc=new RTCPeerConnection(H),U.encodedInsertableStreams=W.encodedInsertableStreams,U.peerCore=new S.PeerConnectionCore({pc:U.pc,onDatachannelEvent:function(Z){U.emit("datachannelStatusChange",{status:Z})},onInnerSubscribeDelete:function(Z){U.emit("innerSubscribeDeleteTracks",Z)},offerSdpHook:W.offerSdpHook,answerSdpHook:W.answerSdpHook}),U.peerCore.setReceiverCodecPreferences(U.receiverCodecPreferences),U.peerCore.setSenderCodecPreferences(U.senderCodecPreferences),U.pc.onconnectionstatechange=function(){var Z=(U.pc||{}).connectionState;switch(U.connectingEventSent||(U.connectingEventSent=!0,U.emit("connectStatusChange",{status:g.EConnectStatus.CONNECT_STATUS_CONNECTING})),Z!=="connecting"&&U.clearStatusTimer(),Z){case"connected":U.emit("onConnected"),U.emit("connectStatusChange",{status:g.EConnectStatus.CONNECT_STATUS_CONNECTED});break;case"disconnected":U.emit("connectStatusChange",{status:g.EConnectStatus.CONNECT_STATUS_RECONNECTING});break;case"failed":case"closed":U.handleClosed()}},U.clearStatusTimer(),U.statusTimer=window.setTimeout(function(){U.handleClosed()},N.CONNECT_TIMEOUT),L){U.localStream=L,U.sdpUtil=new h.SdpUtil(U.localStream);var z=U.addStream();if(z!==0)return U.pc=void 0,void V(new O.RtsError(z,z===k.ErrorCode.ERROR_MEDIASTREAMTRACK_AUDIO_NONE?"need audio track":"",""))}else U.sdpUtil=new h.SdpUtil;var K={};L||(K=U.handleSubTransceiver(P,I).added?{}:{offerToReceiveAudio:P,offerToReceiveVideo:I});var $=U.pc.createOffer(K);U.cancelable=(0,p.makeCancelable)($),U.cancelable.promise.then(function(Z){var ne,te,ae,le,fe,ve,Se;if(U.cancelable=void 0,U.sdpUtil){if(U.sdpUtil.init(String(Z.sdp)),U.sdpUtil.addNack(),U.sdpUtil.addSps(),W.disableStereo||U.sdpUtil.addStereo(),L&&U.sdpUtil.modifyTrackName({vMsid:W.vMsid&&W.vMsid[0],aMsid:W.aMsid&&W.aMsid[0]}),U.pc){Z.sdp=U.sdpUtil.sdp,L&&L.sdpHook&&typeof L.sdpHook=="function"&&(Z.sdp=L.sdpHook(Z.sdp)),(ne=U.peerCore)===null||ne===void 0||ne.setPrevOfferSdp(Z.sdp||"");var be=[];if(L)try{(te=U.peerCore)===null||te===void 0||te.patchPublishStreamManagerRecord(W.publishUrl||"",d(d({},W),{stream:L}));var Me=(ae=U.peerCore)===null||ae===void 0?void 0:ae.parseSdp(Z.sdp||"");be=(le=U.peerCore)===null||le===void 0?void 0:le.updateTrackInfoList({url:W.publishUrl||"",stream:L,vMsid:(fe=U.peerCore)===null||fe===void 0?void 0:fe.unifyMsid(W.vMsid,"video"),aMsid:(ve=U.peerCore)===null||ve===void 0?void 0:ve.unifyMsid(W.aMsid,"audio"),sdpMediaList:(Se=Me==null?void 0:Me.detail)===null||Se===void 0?void 0:Se.media})}catch(_e){console.log(_e)}W.offerSdpHook&&typeof W.offerSdpHook=="function"&&(Z.sdp=W.offerSdpHook(Z.sdp||"")),U.pc.setLocalDescription(Z).then(function(){U.pc?x({desp:U.pc.localDescription,publishTrackInfoList:be}):V(new O.RtsError(k.ErrorCode.ERROR_CREATEOFFER,"no pc",""))}).catch(function(_e){V(new O.RtsError(k.ErrorCode.ERROR_CREATEOFFER,"setLocalDescription error "+_e.message,""))})}}else V(new O.RtsError(k.ErrorCode.ERROR_CREATEOFFER,"no sdp",""))}).catch(function(Z){Z.isCanceled||V(new O.RtsError(k.ErrorCode.ERROR_CREATEOFFER,Z.message?Z.message:"create offer error",""))})})},N.prototype.recvAnswer=function(P,I){var L,W,U=this;return I===void 0&&(I={}),(L=this.peerCore)===null||L===void 0||L.setPrevAnswerSdp((W=P==null?void 0:P.jsep)===null||W===void 0?void 0:W.sdp),new Promise(function(x,V){var j,H,z,K,$,Z;if(U.pc){if(U.pc.ontrack=function(te){U.pc&&U.peerCore&&U.subMonitor.start(U.pc,U.peerCore),setTimeout(function(){U.handleEncodedInsertableStreams({receiver:te.receiver})}),U.isReused||U.emit("onTrackEvent",te)},U.pc.signalingState==="closed")return void V({message:"PeerConnection signalingState is closed"});if(!((j=P.jsep)===null||j===void 0)&&j.sdp){var ne=new h.SdpUtil;ne.init(String((H=P.jsep)===null||H===void 0?void 0:H.sdp)),U.localStream&&(U.localStream.audioTrack&&!U.localStream.videoTrack&&(ne.removeTwccRtcpFb(),(z=U.peerCore)===null||z===void 0||z.setRemoveTwcc(!0)),ne.setDirection()),I.tcpOnly&&ne.hasTcpCandidate&&ne.removeUdpCandidate(),P.jsep.sdp=ne.sdp,(K=U.peerCore)===null||K===void 0||K.setPrevAnswerSdp(($=P==null?void 0:P.jsep)===null||$===void 0?void 0:$.sdp)}!((Z=P.jsep)===null||Z===void 0)&&Z.sdp&&I.answerSdpHook&&typeof I.answerSdpHook=="function"&&(P.jsep.sdp=I.answerSdpHook(P.jsep.sdp)),U.pc.setRemoteDescription(new RTCSessionDescription(P.jsep)).then(function(te){var ae;U.pc&&U.localStream&&(U.localStream.setEncodeParam(U.pc),(ae=U.pc)===null||ae===void 0||ae.getSenders().forEach(function(le){U.handleEncodedInsertableStreams({sender:le})})),x(te)}).catch(function(te){te.sdp=P.jsep.sdp,V(te)})}else V({message:"no PeerConnection"})})},N.prototype.setReceiverCodecPreferences=function(P){var I;this.receiverCodecPreferences=d({},P),(I=this.peerCore)===null||I===void 0||I.setReceiverCodecPreferences(this.receiverCodecPreferences)},N.prototype.setSenderCodecPreferences=function(P){var I;this.senderCodecPreferences=d({},P),(I=this.peerCore)===null||I===void 0||I.setSenderCodecPreferences(this.senderCodecPreferences)},N.prototype.removeTrack=function(P,I){var L=this;return new Promise(function(W,U){L.pc&&L.dataChannel&&L.dataChannel.removeTrack(P,I).then(function(){}).catch(function(x){U(x)})})},N.prototype.replaceTrack=function(P,I,L){var W=this;return new Promise(function(U,x){L||W.pc&&W.dataChannel&&W.dataChannel.removeTrack(P,I).then(function(){}).catch(function(V){x(V)})})},N.prototype.sendSEI=function(P){var I;if(!P.data)throw new Error("No data to send, please check your params.");if(!(P.data instanceof ArrayBuffer))throw new Error("data should be ArrayBuffer, please check your params.");if(!P.url)throw new Error("url is required, please check your params.");if(!P.vMsid)throw new Error("vMsid is required, please check your params.");if(b||A){var L=this.transformWorkerList.findByMsid({url:P.url,kind:g.TrackType.VIDEO,source:g.EWorkerSource.Sender,msid:P.vMsid});if(!L)throw new Error("No published stream found, please check your url: "+P.url);(I=L==null?void 0:L.worker)===null||I===void 0||I.postMessage({operation:g.EWorkerAction.InserSEI,payloadType:P.payloadType,repeatCount:P.repeatCount,sei:P.data})}},N.prototype.dispose=function(){this.cancelable&&(this.cancelable.cancel(),this.cancelable=void 0),this.peerCore&&(this.peerCore.dispose(),this.peerCore=void 0),this.pc&&(this.pc.onconnectionstatechange=function(){},this.pc.ontrack=function(){},this.pc.close(),this.pc=void 0,this.clearStatusTimer()),this.sdpUtil&&(this.sdpUtil.dispose(),this.sdpUtil=void 0),this.localStream&&(this.localStream=void 0),this.transformWorkerList.dispose(),this.subMonitor.stop(),this.pubMonitor.stopHeartbeat(),this.isReused=!1,this.encodedInsertableStreams=void 0},N.prototype.addStream=function(){if(this.localStream){if(this.pc){if(this.localStream.audioTrack){var P=this.pc.addTransceiver(this.localStream.audioTrack,{direction:"sendonly",streams:[this.localStream.mediaStream]});if(this.senderCodecPreferences.audio)try{P.setCodecPreferences(this.senderCodecPreferences.audio)}catch(L){console.warn("setCodecPreferences error",L)}}if(this.localStream.videoTrack){var I=this.pc.addTransceiver(this.localStream.videoTrack,{direction:"sendonly",streams:[this.localStream.mediaStream]});if(this.senderCodecPreferences.video)try{I.setCodecPreferences(this.senderCodecPreferences.video)}catch(L){console.warn("setCodecPreferences error",L)}}return 0}return k.ErrorCode.ERROR_PREERCONNECTION_UNKNOWN}return k.ErrorCode.ERROR_MEDIASTREAMTRACK_AUDIO_NONE},N.prototype.handleEncodedInsertableStreams=function(P){var I,L,W=this;if(this.encodedInsertableStreams){var U=P.receiver,x=P.sender,V=U?g.EWorkerSource.Receiver:g.EWorkerSource.Sender,j=U||x,H=j.track;if(!H)return console.warn("no track in senderReceiver!");var z=H.kind,K=(L=(I=this.peerCore)===null||I===void 0?void 0:I.getStreamManager())===null||L===void 0?void 0:L.getAllTrackPairList(V===g.EWorkerSource.Receiver?y.Subscribe:y.Publish),$=K==null?void 0:K.find(function(fe){var ve,Se;return((Se=(ve=fe[z===g.TrackType.VIDEO?"vTransceiver":"aTransceiver"])===null||ve===void 0?void 0:ve.track)===null||Se===void 0?void 0:Se.id)===H.id});if(!$)return console.warn("no existing stream info found");var Z=new C.default;if(!this.transformWorkerList.add({worker:Z,kind:z,source:V,info:$,receiver:U,sender:x}))return console.log("worker existing, skip.");var ne=g.EWorkerAction.Setup;if(b){var te=j.createEncodedStreams(),ae=te.readable,le=te.writable;Z.postMessage({source:V,readable:ae,writable:le,operation:ne},[ae,le])}else A&&(j.transform=new RTCRtpScriptTransform(Z,{source:V,operation:ne}));Z.onmessage=function(fe){var ve=fe.data,Se=ve.type,be=ve.data,Me=ve.frameInfo;Se==="encodedFrame"&&W.emit("encodedFrame",{kind:z,url:$.originUrl,vMsid:z==="video"?$==null?void 0:$.vMsid:void 0,aMsid:z==="audio"?$==null?void 0:$.aMsid:void 0,frame:d({data:be},Me)})}}},N.prototype.handleSubTransceiver=function(P,I){var L,W,U,x=!1;if(!((L=this.pc)===null||L===void 0)&&L.addTransceiver){if(P&&(W=this.pc.addTransceiver("audio",{direction:"recvonly"}),this.receiverCodecPreferences.audio))try{W.setCodecPreferences(this.receiverCodecPreferences.audio)}catch(V){console.warn("setCodecPreferences error",V)}if(I&&(U=this.pc.addTransceiver("video",{direction:"recvonly"}),this.receiverCodecPreferences.video))try{U.setCodecPreferences(this.receiverCodecPreferences.video)}catch(V){console.warn("setCodecPreferences error",V)}x=!0}return{added:x,aTransceiver:W,vTransceiver:U}},N.prototype.initDataChannel=function(){!this.dataChannel&&this.pc&&(this.dataChannel=new w.Datachannel(this.pc))},N.prototype.handleClosed=function(){this.subMonitor.stop(),this.emit("connectStatusChange",{status:g.EConnectStatus.CONNECT_STATUS_DISCONNECTED}),this.emit("onEnd")},N.prototype.clearStatusTimer=function(){this.statusTimer&&clearTimeout(this.statusTimer),this.statusTimer=void 0},N.CONNECT_TIMEOUT=1e4,N}(v.default);s.RtsPeerconnection=T;var M=function(){function D(){this.workerList=[]}return D.prototype.add=function(N){return!this.findByMsid({url:N.info.url,source:N.source,kind:N.kind,msid:N.kind===g.TrackType.VIDEO?N.info.vMsid:N.info.aMsid})&&(this.workerList.push(N),!0)},D.prototype.removeByUrl=function(N){var P=this;this.workerList.filter(function(I){return I.info.url.split("?")[0]===N.url.split("?")[0]&&I.source===N.source}).forEach(function(I){I.worker.terminate(),P.workerList=P.workerList.filter(function(L){return L!==I})})},D.prototype.removeByMsid=function(N){var P=this.findByMsid(N);P?(P.worker.terminate(),this.workerList=this.workerList.filter(function(I){return I!==P})):console.warn("no worker to remove")},D.prototype.findByUrl=function(N,P){return this.workerList.find(function(I){return I.info.url.split("?")[0]===N.split("?")[0]&&I.kind===P})},D.prototype.findByMsid=function(N){var P=N.url,I=N.kind,L=N.source,W=N.msid,U=I===g.TrackType.VIDEO?"vMsid":"aMsid";return this.workerList.find(function(x){return x.info.url.split("?")[0]===P.split("?")[0]&&x.source===L&&x.kind===I&&x.info[U]===W})},D.prototype.dispose=function(){this.workerList.forEach(function(N){N.worker.terminate()}),this.workerList=[]},D}()},2825:(o,s)=>{Object.defineProperty(s,"__esModule",{value:!0})},8156:function(o,s,a){var c=this&&this.__createBinding||(Object.create?function(f,y,S,l){l===void 0&&(l=S);var h=Object.getOwnPropertyDescriptor(y,S);h&&!("get"in h?!y.__esModule:h.writable||h.configurable)||(h={enumerable:!0,get:function(){return y[S]}}),Object.defineProperty(f,l,h)}:function(f,y,S,l){l===void 0&&(l=S),f[l]=y[S]}),u=this&&this.__exportStar||function(f,y){for(var S in f)S==="default"||Object.prototype.hasOwnProperty.call(y,S)||c(y,f,S)};Object.defineProperty(s,"__esModule",{value:!0}),s.EDatachannelStatus=s.EConnectStatus=s.AliRTS=void 0,a(9543);var d=a(4845);Object.defineProperty(s,"AliRTS",{enumerable:!0,get:function(){return d.AliRTS}}),window&&(window.AliRTS=d.AliRTS);var E=a(5917);Object.defineProperty(s,"EConnectStatus",{enumerable:!0,get:function(){return E.EConnectStatus}});var m=a(4450);Object.defineProperty(s,"EDatachannelStatus",{enumerable:!0,get:function(){return m.EDatachannelStatus}}),u(a(2825),s)},2672:(o,s)=>{var a;Object.defineProperty(s,"__esModule",{value:!0}),s.EN=void 0,function(c){c.MESSAGE_NOTSUPPORT_WEBRTC="not support webrtc",c.MESSAGE_BROWSER_NOTSUPPORT="browser not support",c.MESSAGE_BROWSER_VERSIONLOW="browser version too low",c.MESSAGE_NOTSUPPORT_H264="not support h264",c.MESSAGE_CREATEOFFER="create offer error"}(a||(s.EN=a={}))},2818:function(o,s,a){var c=this&&this.__assign||function(){return c=Object.assign||function(l){for(var h,p=1,v=arguments.length;p<v;p++)for(var g in h=arguments[p])Object.prototype.hasOwnProperty.call(h,g)&&(l[g]=h[g]);return l},c.apply(this,arguments)},u=this&&this.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(s,"__esModule",{value:!0});var d,E=a(233),m=u(a(7028)),f=a(9428),y=u(a(2632));(function(l){l[l.UA=101]="UA",l[l.SUB_STATS=107]="SUB_STATS",l[l.PUB_STATS=108]="PUB_STATS",l[l.CONNECT_STATE_CHANGE=109]="CONNECT_STATE_CHANGE",l[l.START_PLAY=120]="START_PLAY",l[l.STOP_PLAY=121]="STOP_PLAY",l[l.SUBSCRIBE_START=125]="SUBSCRIBE_START",l[l.SUBSCRIBE_OK=126]="SUBSCRIBE_OK",l[l.FIRST_FRAME_TIME=137]="FIRST_FRAME_TIME",l[l.DC_HTTP_CONNECT=140]="DC_HTTP_CONNECT",l[l.DC_HTTP_CONNECT_OK=141]="DC_HTTP_CONNECT_OK",l[l.DC_SUB_ADD=142]="DC_SUB_ADD",l[l.DC_SUB_ADD_OK=143]="DC_SUB_ADD_OK",l[l.DC_CONNECT_STATE_CHANGE=144]="DC_CONNECT_STATE_CHANGE",l[l.DC_SUB_STOP=145]="DC_SUB_STOP",l[l.DC_SUB_STOP_OK=146]="DC_SUB_STOP_OK",l[l.DC_DISPOSE=147]="DC_DISPOSE",l[l.ERROR_INFO=150]="ERROR_INFO",l[l.DC_PUB_ADD=152]="DC_PUB_ADD",l[l.DC_PUB_ADD_OK=153]="DC_PUB_ADD_OK",l[l.DC_PUB_STOP=155]="DC_PUB_STOP",l[l.DC_PUB_STOP_OK=156]="DC_PUB_STOP_OK",l[l.RECONNECT=160]="RECONNECT",l[l.RECONNECT_PARAMS=161]="RECONNECT_PARAMS",l[l.CREATE_CLIENT=200]="CREATE_CLIENT",l[l.LOCALSTREAM_INITED=201]="LOCALSTREAM_INITED",l[l.START_PUBLISH=220]="START_PUBLISH",l[l.STOP_PUBLISH=221]="STOP_PUBLISH",l[l.PUBLISH_OK=222]="PUBLISH_OK",l[l.SET_VIDEOPROFILE=230]="SET_VIDEOPROFILE",l[l.SET_SCREENPROFILE=231]="SET_SCREENPROFILE",l[l.SET_AUDIOPROFILE=238]="SET_AUDIOPROFILE",l[l.ENABLE_AUDIO=232]="ENABLE_AUDIO",l[l.DISABLE_AUDIO=233]="DISABLE_AUDIO",l[l.ENABLE_VIDEO=234]="ENABLE_VIDEO",l[l.DISABLE_VIDEO=235]="DISABLE_VIDEO",l[l.STOP=236]="STOP",l[l.PLAY=237]="PLAY"})(d||(d={}));var S=function(){function l(h){this.customReporter=h==null?void 0:h.customReporter,this.ct=h&&h.customTag?h.customTag:"",this.enableLog=!h||h.trackLog!=0,this._initParam(),this.slsTracker=new y.default({host:"cn-hangzhou.log.aliyuncs.com",project:"videocloud",logstore:"live-client-log",time:10,count:10})}return l.prototype.updateTid=function(){this.param?this.param.tid=E.Guid.create(32):this._initParam()},l.prototype.updateUrl=function(h){this.param&&(this.param.pu=h)},l.prototype.reportUA=function(h){this.reporter({msgid:d.UA,args:JSON.stringify({ua:h})})},l.prototype.reportPullStats=function(h){this.reporter({msgid:d.SUB_STATS,args:JSON.stringify(c({},h))})},l.prototype.reportPushStats=function(h){this.reporter({msgid:d.PUB_STATS,args:JSON.stringify(c({},h))})},l.prototype.reportStartPlay=function(h){this.reporter({msgid:d.START_PLAY,args:JSON.stringify({vurl:h})})},l.prototype.reportStopPlay=function(){this.reporter({msgid:d.STOP_PLAY})},l.prototype.reportSubscribeStart=function(h,p,v,g,R){this.reporter({msgid:d.SUBSCRIBE_START,args:JSON.stringify({vurl:h,surl:p,vMsid:v?v.join(", "):"",aMsid:g?g.join(", "):"",isSubAdd:!!R})})},l.prototype.reportSubscribeOk=function(h){h===void 0&&(h={}),this.reporter({msgid:d.SUBSCRIBE_OK,args:JSON.stringify({vurl:h.vurl||"",surl:h.surl||"",hrct:h.hrct,tcid:h.traceId,rslt:h.rslt,isSubAdd:!!h.isSubAdd})})},l.prototype.reportFirstFrameTime=function(h,p,v,g,R,_,w,k,O,C,b,A,T,M){this.reporter({msgid:d.FIRST_FRAME_TIME,args:JSON.stringify({vurl:h,cpct:v,hrct:g,tcid:p,ffct:R,rslt:_,cnct:w,stats:k,delct:O,addct:C,actct:b,vMsid:A?A.join(", "):"",aMsid:T?T.join(", "):"",isSubAdd:!!M})})},l.prototype.reportErrorInfo=function(h,p,v,g){h!==f.ErrorCode.ERROR_AUTOPLAY_ERROR&&this.reporter({msgid:d.ERROR_INFO,args:JSON.stringify({errorCode:h,message:p,tcid:v,extraInfo:g})})},l.prototype.reportReconnect=function(h,p,v,g,R){this.reporter({msgid:d.RECONNECT,args:JSON.stringify({errorCode:h,message:p,tcid:v,retryTimes:g,useTcp:R})})},l.prototype.reportReconnectParams=function(h,p,v,g,R,_){this.reporter({msgid:d.RECONNECT_PARAMS,args:JSON.stringify({type:h,url:p,vMsid:(v||[]).join(","),aMsid:(g||[]).join(","),useTcp:R,streamId:_})})},l.prototype.reportCreateClient=function(){this.reporter({msgid:d.CREATE_CLIENT})},l.prototype.reportStartPublish=function(h,p,v){this.reporter({msgid:d.START_PUBLISH,args:JSON.stringify({purl:h,surl:p,isPubAdd:!!v})})},l.prototype.reportPublishOk=function(h,p,v,g,R,_,w,k){this.reporter({msgid:d.PUBLISH_OK,args:JSON.stringify({purl:h,surl:p,coct:v,hrct:g,act:R,tcid:_,totalct:w||v+g+R,isPubAdd:!!k})})},l.prototype.reportStopPublish=function(h,p){this.reporter({msgid:d.STOP_PUBLISH,args:JSON.stringify({url:h,isPubStop:!!p})})},l.prototype.reportVideoProfile=function(h){this.reporter({msgid:d.SET_VIDEOPROFILE,args:JSON.stringify({vp:h})})},l.prototype.reportScreenProfile=function(h){this.reporter({msgid:d.SET_SCREENPROFILE,args:JSON.stringify({sp:h})})},l.prototype.reportAudioProfile=function(h){this.reporter({msgid:d.SET_AUDIOPROFILE,args:JSON.stringify({vp:h})})},l.prototype.reportEnableAudio=function(){this.reporter({msgid:d.ENABLE_AUDIO})},l.prototype.reportDisableAudio=function(){this.reporter({msgid:d.DISABLE_AUDIO})},l.prototype.reportEnableVideo=function(){this.reporter({msgid:d.ENABLE_VIDEO})},l.prototype.reportDisableVideo=function(){this.reporter({msgid:d.DISABLE_VIDEO})},l.prototype.reportStop=function(h){this.reporter({msgid:d.STOP,args:JSON.stringify({tp:h})})},l.prototype.reportPlay=function(h){this.reporter({msgid:d.PLAY,args:JSON.stringify({tp:h})})},l.prototype.reportStreamCreated=function(h,p){this.reporter({msgid:d.LOCALSTREAM_INITED,args:JSON.stringify({userConfig:h,localStreamInfo:p})})},l.prototype.reportConnectionChange=function(h,p){this.reporter({msgid:d.CONNECT_STATE_CHANGE,args:JSON.stringify({connectionState:h,direction:p})})},l.prototype.reportDatachannelHttpConnect=function(h){this.reporter({msgid:d.DC_HTTP_CONNECT,args:JSON.stringify({url:h})})},l.prototype.reportDatachannelHttpConnectOk=function(h){this.reporter({msgid:d.DC_HTTP_CONNECT_OK,args:JSON.stringify(c({},h))})},l.prototype.reportDatachannelSubAdd=function(h){this.reporter({msgid:d.DC_SUB_ADD,args:JSON.stringify(c({},h))})},l.prototype.reportDatachannelPubAdd=function(h){this.reporter({msgid:d.DC_PUB_ADD,args:JSON.stringify(c({},h))})},l.prototype.reportDatachannelSubAddOk=function(h){this.reporter({msgid:d.DC_SUB_ADD_OK,args:JSON.stringify(c({},h))})},l.prototype.reportDatachannelPubAddOk=function(h){this.reporter({msgid:d.DC_PUB_ADD_OK,args:JSON.stringify(c({},h))})},l.prototype.reportDatachannelStatusChange=function(h){this.reporter({msgid:d.DC_CONNECT_STATE_CHANGE,args:JSON.stringify(c({},h))})},l.prototype.reportDatachannelSubStop=function(h){this.reporter({msgid:d.DC_SUB_STOP,args:JSON.stringify(c({},h))})},l.prototype.reportDatachannelPubStop=function(h){this.reporter({msgid:d.DC_PUB_STOP,args:JSON.stringify(c({},h))})},l.prototype.reportDatachannelSubStopOk=function(h){this.reporter({msgid:d.DC_SUB_STOP_OK,args:JSON.stringify(c({},h))})},l.prototype.reportDatachannelPubStopOk=function(h){this.reporter({msgid:d.DC_PUB_STOP_OK,args:JSON.stringify(c({},h))})},l.prototype.reportDatachannelDispose=function(h){this.reporter({msgid:d.DC_DISPOSE,args:JSON.stringify(c({},h))})},l.prototype._initParam=function(){this.param||(this.param={APIVersion:"0.6.0",os:E.SystemUtil.platform,osv:E.SystemUtil.systemVersion,bt:E.BrowserUtil.browserName,bv:E.BrowserUtil.browserVersion,host:window.location.origin,page:window.location.href,uid:E.LocalStorage.uuid,tid:E.Guid.create(32),ver:m.default.version,ct:this.ct,dt:"",lv:"1.0.0",ua:navigator&&navigator.userAgent||"",pu:""})},l.prototype.reporter=function(h){var p=c(c(c(c({},this.param||{}),{tm:new Date().getTime()}),h||{}),{msgname:d[h.msgid]});if(this.customReporter&&typeof this.customReporter=="function")try{this.customReporter(p)}catch(v){console.error("[Error in customReporter] ",v)}this.enableLog&&this.slsTracker.send(p)},l.prototype.data2String=function(h){var p="";for(var v in h)h.hasOwnProperty(v)&&(p.length&&(p+="&"),p+=v+"="+h[v]);return p},l.HEARTHEAT_INTERVAL=4,l}();s.default=S},7668:function(o,s,a){var c,u=this&&this.__extends||(c=function(O,C){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,A){b.__proto__=A}||function(b,A){for(var T in A)Object.prototype.hasOwnProperty.call(A,T)&&(b[T]=A[T])},c(O,C)},function(O,C){if(typeof C!="function"&&C!==null)throw new TypeError("Class extends value "+String(C)+" is not a constructor or null");function b(){this.constructor=O}c(O,C),O.prototype=C===null?Object.create(C):(b.prototype=C.prototype,new b)}),d=this&&this.__assign||function(){return d=Object.assign||function(O){for(var C,b=1,A=arguments.length;b<A;b++)for(var T in C=arguments[b])Object.prototype.hasOwnProperty.call(C,T)&&(O[T]=C[T]);return O},d.apply(this,arguments)},E=this&&this.__awaiter||function(O,C,b,A){return new(b||(b=Promise))(function(T,M){function D(I){try{P(A.next(I))}catch(L){M(L)}}function N(I){try{P(A.throw(I))}catch(L){M(L)}}function P(I){var L;I.done?T(I.value):(L=I.value,L instanceof b?L:new b(function(W){W(L)})).then(D,N)}P((A=A.apply(O,C||[])).next())})},m=this&&this.__generator||function(O,C){var b,A,T,M,D={label:0,sent:function(){if(1&T[0])throw T[1];return T[1]},trys:[],ops:[]};return M={next:N(0),throw:N(1),return:N(2)},typeof Symbol=="function"&&(M[Symbol.iterator]=function(){return this}),M;function N(P){return function(I){return function(L){if(b)throw new TypeError("Generator is already executing.");for(;M&&(M=0,L[0]&&(D=0)),D;)try{if(b=1,A&&(T=2&L[0]?A.return:L[0]?A.throw||((T=A.return)&&T.call(A),0):A.next)&&!(T=T.call(A,L[1])).done)return T;switch(A=0,T&&(L=[2&L[0],T.value]),L[0]){case 0:case 1:T=L;break;case 4:return D.label++,{value:L[1],done:!1};case 5:D.label++,A=L[1],L=[0];continue;case 7:L=D.ops.pop(),D.trys.pop();continue;default:if(T=D.trys,!((T=T.length>0&&T[T.length-1])||L[0]!==6&&L[0]!==2)){D=0;continue}if(L[0]===3&&(!T||L[1]>T[0]&&L[1]<T[3])){D.label=L[1];break}if(L[0]===6&&D.label<T[1]){D.label=T[1],T=L;break}if(T&&D.label<T[2]){D.label=T[2],D.ops.push(L);break}T[2]&&D.ops.pop(),D.trys.pop();continue}L=C.call(O,D)}catch(W){L=[6,W],A=0}finally{b=T=0}if(5&L[0])throw L[1];return{value:L[0]?L[1]:void 0,done:!0}}([P,I])}}},f=this&&this.__rest||function(O,C){var b={};for(var A in O)Object.prototype.hasOwnProperty.call(O,A)&&C.indexOf(A)<0&&(b[A]=O[A]);if(O!=null&&typeof Object.getOwnPropertySymbols=="function"){var T=0;for(A=Object.getOwnPropertySymbols(O);T<A.length;T++)C.indexOf(A[T])<0&&Object.prototype.propertyIsEnumerable.call(O,A[T])&&(b[A[T]]=O[A[T]])}return b},y=this&&this.__importDefault||function(O){return O&&O.__esModule?O:{default:O}};Object.defineProperty(s,"__esModule",{value:!0}),s.RtsClient=void 0;var S=y(a(102)),l=a(5917),h=a(5676),p=a(9796),v=a(6600),g=y(a(2818)),R=y(a(7028)),_=a(7989),w=a(9428),k=function(O){function C(b){var A=O.call(this)||this;return A.pullH264Checked=!1,A.lastProtocol="udp",A.reporter=new g.default(b),A.subscriber=new h.Subscriber(A.reporter,b?b.playConfig:void 0),A.publisher=new p.Publisher(A.reporter),A.commonController=new v.CommonController(A.reporter),A.subscriber.on("onError",function(T){return E(A,void 0,void 0,function(){var M,D,N,P,I;return m(this,function(L){switch(L.label){case 0:return M=(N=T.extraInfo)===null||N===void 0?void 0:N.response,this.reporter.reportErrorInfo(T.errorCode,T.message,T.traceId,{sdp:(P=T.extraInfo)===null||P===void 0?void 0:P.sdp,response:{status:M==null?void 0:M.status,data:M==null?void 0:M.data}}),w.SUB_RECONNECT_ERROR_LIST.includes(T.errorCode)?this.subscriber.isConnecting?[3,2]:(D=this.lastProtocol==="udp",this.lastProtocol=D?"tcp":"udp",console.log("retrying with",this.lastProtocol),[4,this.subscriber.retrySubscribe(T,{innerTcpOnly:D})]):[3,3];case 1:L.sent()?(this.reporter.reportReconnect(T.errorCode,T.message,T.traceId,(I=T.extraInfo)===null||I===void 0?void 0:I.retryTimes,D),this.emit("reconnect",this.makeReconnectEvent("sub",T))):this.emit("onError",T),L.label=2;case 2:return[3,4];case 3:this.emit("onError",T),L.label=4;case 4:return[2]}})})}),A.subscriber.on("reconnect",function(T){var M;A.reporter.reportReconnect(T.errorCode,T.message,T.traceId,(M=T.extraInfo)===null||M===void 0?void 0:M.retryTimes),A.emit("reconnect",A.makeReconnectEvent("sub",T))}),A.subscriber.on("onPlayEvent",function(T){A.emit("onPlayEvent",T)}),A.subscriber.on("connectStatusChange",function(T){A.emit("connectStatusChange",T),A.reporter.reportConnectionChange(l.EConnectStatus[T.status],"sub")}),A.publisher.on("connectStatusChange",function(T){A.emit("connectStatusChange",T),A.reporter.reportConnectionChange(l.EConnectStatus[T.status],"pub")}),A.publisher.on("onError",function(T){return E(A,void 0,void 0,function(){var M,D,N,P,I,L;return m(this,function(W){switch(W.label){case 0:return M=(N=T.extraInfo)===null||N===void 0?void 0:N.response,this.reporter.reportErrorInfo(T.errorCode,T.message,T.traceId,{sdp:(P=T.extraInfo)===null||P===void 0?void 0:P.sdp,response:{status:M==null?void 0:M.status,data:M==null?void 0:M.data}}),w.PUB_RECONNECT_ERROR_LIST.includes(T.errorCode)?this.publisher.isConnecting?[3,2]:(D=T.errorCode===w.ErrorCode.ERROR_TRANSPORT_CLOSED&&((I=T.extraInfo)===null||I===void 0?void 0:I.protocol)!=="tcp",console.log("Retrying with ",D?"TCP":"UDP"),[4,this.publisher.retryPublish(T,D)]):[3,3];case 1:W.sent()?(this.reporter.reportReconnect(T.errorCode,T.message,T.traceId,(L=T.extraInfo)===null||L===void 0?void 0:L.retryTimes,D),this.emit("reconnect",this.makeReconnectEvent("pub",T))):this.emit("onError",T),W.label=2;case 2:return[3,4];case 3:this.emit("onError",T),W.label=4;case 4:return[2]}})})}),A.publisher.on("reconnect",function(T){var M;A.reporter.reportReconnect(T.errorCode,T.message,T.traceId,(M=T.extraInfo)===null||M===void 0?void 0:M.retryTimes),A.emit("reconnect",A.makeReconnectEvent("pub",T))}),A.commonController.on("connectStatusChange",function(T){A.emit("connectStatusChange",T),A.reporter.reportConnectionChange(l.EConnectStatus[T.status],"signalChannel")}),A.commonController.on("onError",function(T){A.reporter.reportErrorInfo(T.errorCode,T.message,T.traceId),A.emit("onError",T)}),A.commonController.on("datachannelStatusChange",function(T){A.emit("datachannelStatusChange",T)}),A.commonController.on("encodedFrame",function(T){A.emit("encodedFrame",T)}),A.commonController.on("receivedSEI",function(T){A.emit("receivedSEI",T)}),A.commonController.on("onPlayEvent",function(T){A.emit("onPlayEvent",T)}),A.reporter.reportCreateClient(),A}return u(C,O),C.prototype.getVersion=function(){return R.default.version},C.prototype.isSupport=function(b){var A=new _.SupportUtil;return this.pullH264Checked=!0,A.isSupport(b)},C.prototype.checkPublishSupport=function(){return new _.SupportUtil().checkPublishSupport()},C.prototype.checkEncodedTransformSupport=function(){return new _.SupportUtil().checkEncodedTransformSupport()},C.prototype.subscribe=function(b,A){return this.reporter.updateUrl(b),this.commonController.setPeerconnection(this.subscriber.getPeerConnection()),this.subscriber.resetResubscribeStatus(),this.subscriber.subscribeWithReconnect(b,d(d({},A),{isH264Checked:this.pullH264Checked}))},C.prototype.subscribeAdd=function(b){return this.commonController.subscribeAdd(b)},C.prototype.subscribeActive=function(b){return this.commonController.subscribeActive(b)},C.prototype.subscribeDeleteTracks=function(b){return this.commonController.subscribeDeleteTracks(b)},C.prototype.subscribeStop=function(b){return this.commonController.subscribeStop(b)},C.prototype.publishAdd=function(b){return this.commonController.publishAdd(b)},C.prototype.publishDeleteTracks=function(b){return this.commonController.publishDeleteTracks(b)},C.prototype.publishReplaceTracks=function(b){return this.commonController.publishReplaceTracks(b)},C.prototype.publishStop=function(b){return this.commonController.publishStop(b)},C.prototype.subscribeAddDatachannel=function(b){return this.commonController.subscribeAddDatachannel(b)},C.prototype.subscribeStopDatachannel=function(b){return this.commonController.subscribeStopDatachannel(b)},C.prototype.publishAddDatachannel=function(b){return this.commonController.publishAddDatachannel(b)},C.prototype.publishStopDatachannel=function(b){return this.commonController.publishStopDatachannel(b)},C.prototype.unsubscribe=function(){this.subscriber.resetResubscribeStatus(),this.subscriber.unsubscribe()},C.prototype.startLiveStream=function(b,A,T){return this.reporter.reportStartPlay(b),this.subscriber.startLiveStream(b,A,T)},C.prototype.stopLiveStream=function(){this.reporter.reportStopPlay(),this.subscriber.stopLiveStream()},C.prototype.muteLiveStream=function(b){this.subscriber.muteLiveStream(b)},C.prototype.publish=function(b,A,T){return E(this,void 0,void 0,function(){return m(this,function(M){return this.reporter.updateUrl(b),this.commonController.setPeerconnection(this.publisher.getPeerConnection()),this.publisher.resetRepublishStatus(),[2,this.publisher.publishWithReconnect(b,A,T)]})})},C.prototype.unpublish=function(){return this.publisher.resetRepublishStatus(),this.publisher.unpublish()},C.prototype.sendSEI=function(b){this.publisher.sendSEI(b),this.commonController.sendSEI(b)},C.prototype.getPublishTrackInfoList=function(){return this.publisher.getTrackInfoList()},C.prototype.getTransportStats=function(){return this.subscriber.getPeerConnection().getSubMonitor().getTransportStats()},C.prototype.getRemoteVideoStats=function(){return this.subscriber.getPeerConnection().getSubMonitor().getRemoteVideoStats()},C.prototype.getRemoteAudioStats=function(){return this.subscriber.getPeerConnection().getSubMonitor().getRemoteAudioStats()},C.prototype.getSubscribeVideoStats=function(b,A){return this.commonController.getSubscribeVideoStats(b,A)},C.prototype.getSubscribeAudioStats=function(b,A){return this.commonController.getSubscribeAudioStats(b,A)},C.prototype.getPublishVideoStats=function(b,A){return this.commonController.getPublishVideoStats(b,A)},C.prototype.getPublishAudioStats=function(b,A){return this.commonController.getPublishAudioStats(b,A)},C.prototype.setReceiverCodecPreferences=function(b){return this.commonController.setReceiverCodecPreferences(b)},C.prototype.setSenderCodecPreferences=function(b){return this.commonController.setSenderCodecPreferences(b)},C.prototype.makeReconnectEvent=function(b,A){var T=A||{},M=T.extraInfo||{};return{type:b,reason:f(T,["extraInfo"]),retryTimes:M.retryTimes,extraInfo:f(M,["retryTimes"])}},C}(S.default);s.RtsClient=k},335:(o,s)=>{Object.defineProperty(s,"__esModule",{value:!0});var a=function(){function c(u){this.useGainNode=!0,this.audioContext=new AudioContext,this.audioDestination=this.audioContext.createMediaStreamDestination(),this.audioSource=[],this.gainNode=null,this.audioTrack=null,this.audioTrackArr=u.trackList||[],this.useGainNode=typeof u.useGainNode!="boolean"||u.useGainNode,this.useGainNode&&(this.gainNode=this.audioContext.createGain(),this.gainNode.connect(this.audioContext.destination),this.gainNode.gain.value=0),this.getMixedAudioTrack()}return c.prototype.destroy=function(){var u;(u=this.getMixedAudioTrack())===null||u===void 0||u.stop(),this.disconnectSourceNode(),this.audioContext.close(),this.audioTrackArr=[]},c.prototype.updateTrackList=function(u){u.length&&(this.disconnectSourceNode(),this.audioTrackArr=u,this.connectNode())},c.prototype.getMixedAudioTrack=function(){return this.audioTrack||(this.connectNode(),this.audioTrack=this.audioDestination.stream.getAudioTracks()[0]),this.audioTrack},c.prototype.connectNode=function(){var u=this;this.audioTrackArr.forEach(function(d){var E=new MediaStream;E.addTrack(d);var m=u.audioContext.createMediaStreamSource(E);u.gainNode&&m.connect(u.gainNode),u.audioSource.push(m)}),this.audioSource.forEach(function(d){d.connect(u.audioDestination)})},c.prototype.disconnectSourceNode=function(){var u=this;this.audioSource.forEach(function(d){u.gainNode&&d.disconnect(u.gainNode),d.disconnect(u.audioDestination)}),this.audioSource=[]},c}();s.default=a},1893:(o,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.TwoDRenderer=void 0;var a=function(){function c(u){this.video=u.video,this.canvas=u.canvas,this.ctx=this.canvas.getContext("2d")}return c.prototype.render=function(){var u,d,E=this.video,m=this.canvas;E&&m&&((u=this.ctx)===null||u===void 0||u.clearRect(0,0,m.width,m.height),(d=this.ctx)===null||d===void 0||d.drawImage(E,0,0,1*E.videoWidth,1*E.videoHeight),this.requestId=requestAnimationFrame(this.render.bind(this)))},c.prototype.stop=function(){this.requestId&&cancelAnimationFrame(this.requestId)},c}();s.TwoDRenderer=a},6295:(o,s,a)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.CanvasRenderer=void 0;var c=a(1893),u=function(){function d(E){this.video=E.video,this.canvas=this.initCanvas(),this.activeRenderer=this.initRenderer()}return Object.defineProperty(d.prototype,"mediaStream",{get:function(){var E;return this.ms||(this.ms=((E=this.canvas)===null||E===void 0?void 0:E.captureStream())||void 0),this.ms},enumerable:!1,configurable:!0}),d.prototype.start=function(){this.render()},d.prototype.stop=function(){this.activeRenderer.stop()},d.prototype.initCanvas=function(){var E=document.createElement("canvas"),m=this.video;return E.width=1*m.videoWidth,E.height=1*m.videoHeight,E},d.prototype.initRenderer=function(){return new c.TwoDRenderer({video:this.video,canvas:this.canvas})},d.prototype.render=function(){this.activeRenderer.render()},d.prototype.resize=function(E,m){this.canvas&&(this.canvas.width=E,this.canvas.height=m)},d}();s.CanvasRenderer=u},102:(o,s)=>{Object.defineProperty(s,"__esModule",{value:!0});var a=function(){function c(){this._eventMap={}}return c.prototype.listeners=function(u){return this._eventMap[u]||[]},c.prototype.emit=function(u){for(var d=this,E=[],m=1;m<arguments.length;m++)E[m-1]=arguments[m];var f=this._eventMap[u];return!!Array.isArray(f)&&(f.forEach(function(y){return y.apply(d,E)}),!0)},c.prototype.off=function(u,d){var E=this._eventMap[u];return Array.isArray(E)&&(this._eventMap[u]=E.filter(function(m){return m!==d})),this},c.prototype.removeAllListeners=function(u){return u===void 0?this._eventMap={}:this._eventMap[u]&&(this._eventMap[u]=[]),this},c.prototype.on=function(u,d){return this._eventMap[u]?this._eventMap[u].push(d):this._eventMap[u]=[d],this},c.prototype.once=function(u,d){var E=this,m=function(){for(var f=[],y=0;y<arguments.length;y++)f[y]=arguments[y];E.off(u,m),d.apply(E,f)};return this.on(u,m),this},c}();s.default=a},492:(o,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.MediaObserver=void 0;var a=function(){function c(u){this.timeout=u.timeout||c.DEFAULT_TIMEOUT,this.handler=u.handler||function(){},this.watchTimer=null}return Object.defineProperty(c.prototype,"actTimeout",{get:function(){return this.timeout},enumerable:!1,configurable:!0}),c.prototype.check=function(u,d,E,m){var f=this;this.hasNoData(u)?this.watchTimer||(this.watchTimer=window.setTimeout(function(){f.handler(d,E,m)},this.timeout)):this.watchTimer&&(clearTimeout(this.watchTimer),this.watchTimer=null)},c.prototype.hasNoData=function(u){return!u||(u.video?!(Number(u.video.bytesReceivedPerSecond)>0):!u.audio||!(Number(u.audio.bytesReceivedPerSecond)>0))},c.prototype.updateConfig=function(u){this.timeout=u.timeout||this.timeout,this.handler=u.handler||this.handler},c.prototype.reset=function(){this.watchTimer&&(clearTimeout(this.watchTimer),this.watchTimer=null)},c.prototype.dispose=function(){this.timeout=c.DEFAULT_TIMEOUT,this.handler=function(){},this.watchTimer&&(clearTimeout(this.watchTimer),this.watchTimer=null)},c.DEFAULT_TIMEOUT=6e3,c}();s.MediaObserver=a},9594:(o,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.readUUID=s.discardEPB=s.insertEPB=s.SODBtoRBSP=s.convertPayloadSize=s.NALU=s.SEI=s.parseSei=s.insertSei=void 0,s.insertSei=function(u,d,E,m){E===void 0&&(E=5);for(var f=u.data,y=new DataView(f),S=0;;){if(y.getUint32(S)===1){y.getUint8(S+4);var l=new a(d,E,m).buffer,h=new c(l).buffer,p=new ArrayBuffer(h.byteLength+f.byteLength),v=new Uint8Array(p),g=new Uint8Array(h);v.set(g);var R=new Uint8Array(f);v.set(R,h.byteLength),u.data=p,S+=1;break}if((S+=1)+4>=y.byteLength)break}},s.parseSei=function(u){for(var d=[],E=new DataView(u),m=0;;){var f=m,y=E.getUint32(f);if(f+=4,y===1){if((31&E.getUint8(f++))===6){for(var S=E.getUint8(f++),l=S===5?16:0,h=0;E.getUint8(f)==255;)f++,h+=255;if((h+=E.getUint8(f++))>0&&E.byteLength>f+h){var p=new Uint8Array(E.buffer),v="";if(S===5){var g=p.slice(f,f+l);v=(0,s.readUUID)((0,s.discardEPB)(g))}var R=p.slice(f+l,f+h);f+=h,d.push({payloadType:S,uuid:v,data:R.buffer})}}m=f}else m+=1;if(m+4>=E.byteLength)break}return d};var a=function(u,d,E){d===void 0&&(d=5);var m=d===5?16:0,f=u.byteLength+m,y=(0,s.convertPayloadSize)(f),S=y.buffer.byteLength,l=new ArrayBuffer(1+S+m+u.byteLength),h=new Uint8Array(l),p=0;if(h[p++]=d,h.set(y,p),p+=y.byteLength,d===5){E=(E||"00000000-0000-0000-0000-000000000000").replace(/-/g,"");for(var v=0;v<16;v++)h[p+v]=parseInt(E.substr(2*v,2),16);p+=16}var g=new Uint8Array(u);h.set(g,p);var R=(0,s.SODBtoRBSP)(h);this.buffer=R.buffer};s.SEI=a;var c=function(u){var d=new Uint8Array([0,0,0,1]),E=new Uint8Array([6]),m=new ArrayBuffer(d.byteLength+E.byteLength+u.byteLength),f=new Uint8Array(m);f.set(d),f.set(E,d.byteLength),f.set(new Uint8Array(u),d.byteLength+E.byteLength),this.buffer=m};s.NALU=c,s.convertPayloadSize=function(u){if(u<=0)throw new Error("payloadSize must be a positive integer.");for(var d=Math.ceil(u/255),E=new ArrayBuffer(d),m=new DataView(E),f=0;f<d-1;f++)m.setUint8(f,255);return m.setUint8(d-1,u%255&255),new Uint8Array(E)},s.SODBtoRBSP=function(u){for(var d=new Uint8Array(u),E="",m=0;m<d.length;m++)E+=d[m].toString(2).padStart(8,"0");for(E+="1";E.length%8!=0;)E+="0";var f=E.length/8,y=new Uint8Array(f);for(m=0;m<f;m++)y[m]=parseInt(E.slice(8*m,8*m+8),2);return(0,s.insertEPB)(y)},s.insertEPB=function(u){for(var d=[],E=0,m=0;m<u.length;m++)d.push(u[m]),u[m]===0?++E===2&&m<u.length-1&&u[m+1]<=3&&(d.push(3),E=0):E=0;return new Uint8Array(d)},s.discardEPB=function(u){for(var d=u.byteLength,E=[],m=1;m<d-2;)u[m]===0&&u[m+1]===0&&u[m+2]===3?(E.push(m+2),m+=2):m++;if(E.length===0)return u;var f=d-E.length,y=new Uint8Array(f),S=0;for(m=0;m<f;S++,m++)S===E[0]&&(S++,E.shift()),y[m]=u[S];return y},s.readUUID=function(u){if(u.length!==16)throw new Error("UUID must be 16 bytes long.");var d=u.reduce(function(E,m){return E+m.toString(16).padStart(2,"0")},"");return"".concat(d.slice(0,8),"-").concat(d.slice(8,12),"-").concat(d.slice(12,16),"-").concat(d.slice(16,20),"-").concat(d.slice(20))}},8219:function(o,s,a){var c=this&&this.__importDefault||function(d){return d&&d.__esModule?d:{default:d}};Object.defineProperty(s,"__esModule",{value:!0});var u=c(a(2505));s.default=u.default.create({baseURL:"",timeout:5e3,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}})},4315:function(o,s,a){var c=this&&this.__spreadArray||function(m,f,y){if(y||arguments.length===2)for(var S,l=0,h=f.length;l<h;l++)!S&&l in f||(S||(S=Array.prototype.slice.call(f,0,l)),S[l]=f[l]);return m.concat(S||Array.prototype.slice.call(f))};Object.defineProperty(s,"__esModule",{value:!0}),s.SdpUtil=void 0;var u=a(233),d=function(){this.stramId="",this.audioTrackId="",this.videoTrackId="",this.screenTrackId="",this.customTrackId=""},E=function(){function m(f){this.sdpLines=new Array,this.localStream=f,this.publishStreamInfo=new d}return Object.defineProperty(m.prototype,"sdp",{get:function(){return this.sdpLines.join(`\r
`)},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"videoTrackId",{get:function(){return this.publishStreamInfo.videoTrackId},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"screenTrackId",{get:function(){return this.publishStreamInfo.videoTrackId},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"videoName",{get:function(){return"rts video"},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"screenName",{get:function(){return"rts screen"},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"hasTcpCandidate",{get:function(){return this.sdpLines.some(function(f){return f.indexOf("tcptype")!==-1})},enumerable:!1,configurable:!0}),m.prototype.init=function(f){this.sdpLines=f.split(`\r
`)},m.prototype.addNack=function(){for(var f=0;f<this.sdpLines.length;++f)if(this.sdpLines[f].indexOf("opus")!=-1&&this.sdpLines[f+1].indexOf("rtcp-fb")!=-1){var y=this.sdpLines[f+1].split(" ");y.length==2&&(this.sdpLines[f+2].indexOf("rtcp-fb")!=-1?this.sdpLines.splice(f+3,0,y[0]+" nack"):this.sdpLines.splice(f+2,0,y[0]+" nack"))}},m.prototype.parseCustomMsid=function(f){var y={stream:"",track:""};if(!f)return y;var S=f.trim().split(" ");return S.length==2?(y.stream=S[0],y.track=S[1]):y.track=S[0],y},m.prototype.modifyTrackName=function(f){f===void 0&&(f={});var y=f.vMsid,S=f.aMsid,l=y?this.parseCustomMsid(y):{stream:"rts",track:"video"},h=S?this.parseCustomMsid(S):{stream:"rts",track:"audio"},p="";if(this.localStream){this.publishStreamInfo.stramId=this.localStream.mediaStream.id,this.localStream.audioTrack&&(this.publishStreamInfo.audioTrackId=this.localStream.audioTrack.id,p=h.stream||"-"),this.localStream.videoTrack&&(this.publishStreamInfo.videoTrackId=this.localStream.videoTrack.id,p=l.stream||"-");for(var v=!1,g=!1,R=0;R<this.sdpLines.length;++R){var _=this.sdpLines[R],w=_.indexOf(this.publishStreamInfo.stramId);this.publishStreamInfo.stramId&&w!=-1&&(this.sdpLines[R]=this.sdpLines[R].replace(this.publishStreamInfo.stramId,p),u.BrowserUtil.isFirefox&&(v?this.sdpLines[R]=this.sdpLines[R].substring(0,w+p.length+1)+h.track:g&&(this.sdpLines[R]=this.sdpLines[R].substring(0,w+p.length+1)+l.track))),this.publishStreamInfo.audioTrackId&&_.indexOf(this.publishStreamInfo.audioTrackId)!=-1?this.sdpLines[R]=this.sdpLines[R].replace(this.publishStreamInfo.audioTrackId,h.track):this.publishStreamInfo.videoTrackId&&_.indexOf(this.publishStreamInfo.videoTrackId)!=-1&&(this.sdpLines[R]=this.sdpLines[R].replace(this.publishStreamInfo.videoTrackId,l.track)),_.indexOf("m=audio")!=-1?(v=!0,g=!1):_.indexOf("m=video")!=-1&&(g=!0,v=!1),_.indexOf("a=ssrc")!=-1&&(w=_.indexOf("cname:"))!==-1&&(v?this.sdpLines[R]=_.substr(0,w+6)+h.track:g&&(this.sdpLines[R]=_.substr(0,w+6)+l.track))}}},m.prototype.getPublishVideoSdp=function(){for(var f=-1,y=-1,S=!1,l=0;l<this.sdpLines.length;++l){if(S&&this.sdpLines[l].indexOf("m=application")>-1){y=l-1;break}if(this.sdpLines[l].indexOf("m=video")>-1){if(S){y=l-1;break}f=l}this.sdpLines[l].indexOf("rts video")>-1&&(S=!0)}return S?(y===-1&&(y=this.sdpLines.length-1),this.sdpLines.splice(f,y-f).join(`\r
`)):""},m.prototype.removeVideoTrack=function(f){for(var y="rts "+f,S=-1,l=-1,h=!1,p=0;p<this.sdpLines.length;++p){if(h&&this.sdpLines[p].indexOf("m=application")>-1){l=p-1;break}if(this.sdpLines[p].indexOf("m=video")>-1){if(h){l=p-1;break}S=p}this.sdpLines[p].indexOf(y)>-1&&(h=!0)}return!!h&&(l===-1&&(l=this.sdpLines.length-1),this.sdpLines.splice(S,l-S),!0)},m.prototype.ios15PushHack=function(){var f=!1,y=-1;if(this.sdpLines.forEach(function(h,p){h.includes("m=video")&&(f=!0),f&&y===-1&&h.includes("a=")&&(y=p)}),y!==-1){var S=this.getExtmapIds(),l=Math.max.apply(Math,S)+1;this.sdpLines.splice(y,0,"a=extmap:".concat(l," urn:3gpp:video-orientation"))}},m.prototype.addSps=function(){this.sdpLines=this.sdpLines.map(function(f){return f.includes("a=fmtp:")&&f.includes("level-asymmetry-allowed")?f+=";sps-pps-idr-in-keyframe=1":f})},m.prototype.removeTwccRtcpFb=function(){this.sdpLines=this.sdpLines.filter(function(f){return!f.includes("http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")})},m.prototype.removeUdpCandidate=function(){this.sdpLines=this.sdpLines.filter(function(f){return!f.includes("a=candidate:")||!f.includes("UDP")}),console.log("removed udp candidate")},m.prototype.setDirection=function(f){f===void 0&&(f={direction:"recvonly"});var y=["sendonly","recvonly","sendrecv"].filter(function(h){return h!==f.direction}),S=!1,l=!1;this.sdpLines=this.sdpLines.map(function(h,p){if(h.includes("m=video"))S=!0,l=!1;else if(h.includes("m=audio"))l=!0,S=!1;else if(h.includes("m=application"))S=!1,l=!1;else if(S||l){var v;if(y.some(function(g){if(h.includes(g))return v=g,!0})&&v)return h.replace(v,f.direction)}return h})},m.prototype.removeSDES=function(){var f=["urn:ietf:params:rtp-hdrext:sdes:mid","urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id","urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id"];this.sdpLines=this.sdpLines.filter(function(y){return!f.some(function(S){return y.includes(S)})})},m.prototype.addStereo=function(){var f=this;this.getPayloadType("opus").map(this.getFmtpIndex.bind(this)).filter(function(y){return y!==void 0}).forEach(function(y){f.sdpLines[y].indexOf("stereo=1")>-1||(f.sdpLines[y]=f.sdpLines[y]+";stereo=1")})},m.prototype.dispose=function(){this.localStream&&(this.localStream=void 0),this.sdpLines=new Array,this.publishStreamInfo=new d},m.prototype.getExtmapIds=function(){return this.sdpLines.reduce(function(f,y){if(y.includes("a=extmap")){var S=Number(y.replace("a=extmap:","").split(" ")[0]);return c(c([],f,!0),[S],!1)}return f},[]).filter(function(f){return f})},m.prototype.getPayloadType=function(f){for(var y=[],S=new RegExp("a\\=rtpmap\\:(\\d+) ".concat(f,".*"),"i"),l=0;l<this.sdpLines.length;l++){var h=this.sdpLines[l],p=S.exec(h);p!=null&&p.length&&y.push(p[1])}return y},m.prototype.getFmtpIndex=function(f){for(var y=new RegExp("a\\=fmtp\\:".concat(f," .*"),"i"),S=0;S<this.sdpLines.length;S++){var l=this.sdpLines[S];if(y.test(l))return S}},m}();s.SdpUtil=E},7989:function(o,s,a){var c=this&&this.__awaiter||function(l,h,p,v){return new(p||(p=Promise))(function(g,R){function _(O){try{k(v.next(O))}catch(C){R(C)}}function w(O){try{k(v.throw(O))}catch(C){R(C)}}function k(O){var C;O.done?g(O.value):(C=O.value,C instanceof p?C:new p(function(b){b(C)})).then(_,w)}k((v=v.apply(l,h||[])).next())})},u=this&&this.__generator||function(l,h){var p,v,g,R,_={label:0,sent:function(){if(1&g[0])throw g[1];return g[1]},trys:[],ops:[]};return R={next:w(0),throw:w(1),return:w(2)},typeof Symbol=="function"&&(R[Symbol.iterator]=function(){return this}),R;function w(k){return function(O){return function(C){if(p)throw new TypeError("Generator is already executing.");for(;R&&(R=0,C[0]&&(_=0)),_;)try{if(p=1,v&&(g=2&C[0]?v.return:C[0]?v.throw||((g=v.return)&&g.call(v),0):v.next)&&!(g=g.call(v,C[1])).done)return g;switch(v=0,g&&(C=[2&C[0],g.value]),C[0]){case 0:case 1:g=C;break;case 4:return _.label++,{value:C[1],done:!1};case 5:_.label++,v=C[1],C=[0];continue;case 7:C=_.ops.pop(),_.trys.pop();continue;default:if(g=_.trys,!((g=g.length>0&&g[g.length-1])||C[0]!==6&&C[0]!==2)){_=0;continue}if(C[0]===3&&(!g||C[1]>g[0]&&C[1]<g[3])){_.label=C[1];break}if(C[0]===6&&_.label<g[1]){_.label=g[1],g=C;break}if(g&&_.label<g[2]){_.label=g[2],_.ops.push(C);break}g[2]&&_.ops.pop(),_.trys.pop();continue}C=h.call(l,_)}catch(b){C=[6,b],v=0}finally{p=g=0}if(5&C[0])throw C[1];return{value:C[0]?C[1]:void 0,done:!0}}([k,O])}}};Object.defineProperty(s,"__esModule",{value:!0}),s.SupportUtil=void 0;var d=a(233),E=a(3412),m=a(9428),f=a(2672),y=function(){this.errorCode=0,this.message=""},S=function(){function l(){this.deviceManager=new E.BrowserDeviceManager}return l.prototype.isSupport=function(h){var p=this;return new Promise(function(v,g){return c(p,void 0,void 0,function(){var R,_,w,k;return u(this,function(O){switch(O.label){case 0:return R=new y,this.checkWebRtcSupport()?h.onlyCheckUA?this.checkBrowser(R)?[3,3]:[2,g(R)]:[3,1]:(R.errorCode=m.ErrorCode.ERROR_NOTSUPPORT_WEBRTC,R.message=f.EN.MESSAGE_NOTSUPPORT_WEBRTC,[2,g(R)]);case 1:return[4,this.checkWebrtcAbilities()];case 2:if(_=O.sent(),w=_[0],_[1],_[2],k=_[3],!w)return R.errorCode=m.ErrorCode.ERROR_NOTSUPPORT_WEBRTC,R.message=f.EN.MESSAGE_NOTSUPPORT_WEBRTC,[2,g(R)];if(k)return R.errorCode=m.ErrorCode.ERROR_BROWSER_NOTSUPPORT,R.message=f.EN.MESSAGE_BROWSER_NOTSUPPORT,[2,g(R)];O.label=3;case 3:return h.isReceiveVideo?this.checkH264Decode(R).then(function(){v(R)}).catch(function(){g(R)}):v(R),[2]}})})})},l.prototype.checkEncodedTransformSupport=function(){var h=window.RTCRtpReceiver&&"createEncodedStreams"in RTCRtpReceiver.prototype,p=window.RTCRtpReceiver&&"transform"in RTCRtpReceiver.prototype&&"RTCRtpScriptTransform"in window;return h||p},l.prototype.checkWebrtcAbilities=function(h){return c(this,void 0,void 0,function(){var p,v,g,R,_,w,k,O,C;return u(this,function(b){switch(b.label){case 0:p=window.RTCPeerConnection,v=!1,g=!1,R=null,_=!1,b.label=1;case 1:return b.trys.push([1,4,,5]),p?(w=new p,g="createDataChannel"in w,h&&(k=this.createBlankStream()).getTracks().forEach(function(A){w==null||w.addTrack(A,k)}),[4,w.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0,iceRestart:!0})]):[3,3];case 2:O=b.sent(),C=(O||{}).sdp,R=h?!!(C&&C.indexOf("a=sendrecv")>-1):null,w.close(),w=void 0,v=!0,b.label=3;case 3:return[3,5];case 4:return b.sent(),v=!1,g=!1,R=!1,[3,5];case 5:return _=this.checkBlackList(),[2,[v,g,R,_]]}})})},l.prototype.checkPublishSupport=function(){return c(this,void 0,void 0,function(){var h,p,v,g,R,_,w,k;return u(this,function(O){switch(O.label){case 0:return h={isWebRTCSupported:!1,isH264EncodeSupported:!1,isMediaDevicesSupported:!1,isScreenCaptureSupported:!1,isAudioMixSupported:!1,cameraList:[],micList:[],speakerList:[]},this.checkWebRtcSupport()?[3,1]:(h.isWebRTCSupported=!1,h.isH264EncodeSupported=!1,[3,5]);case 1:return[4,this.checkWebrtcAbilities(!0)];case 2:return p=O.sent(),v=p[0],p[1],g=p[2],h.isWebRTCSupported=!(!v||!g),h.isWebRTCSupported?[3,3]:(h.isH264EncodeSupported=!1,[3,5]);case 3:return R=h,[4,this.checkH264Encode()];case 4:R.isH264EncodeSupported=O.sent(),O.label=5;case 5:if(h.isMediaDevicesSupported=this.checkMediaDevices(),h.isScreenCaptureSupported=this.checkScreenCapture(),h.isAudioMixSupported=this.checkAudioMix(),!h.isMediaDevicesSupported)return[3,11];O.label=6;case 6:return O.trys.push([6,10,,11]),_=h,[4,this.deviceManager.getCameraList()];case 7:return _.cameraList=O.sent().filter(function(C){return C.deviceId}),w=h,[4,this.deviceManager.getMicList()];case 8:return w.micList=O.sent().filter(function(C){return C.deviceId}),k=h,[4,this.deviceManager.getSpeakerList()];case 9:return k.speakerList=O.sent().filter(function(C){return C.deviceId}),[3,11];case 10:return O.sent(),[3,11];case 11:return[2,h]}})})},l.prototype.checkWebRtcSupport=function(){return!!window.RTCPeerConnection},l.prototype.checkMediaDevices=function(){return!(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)},l.prototype.checkScreenCapture=function(){return!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia)},l.prototype.checkAudioMix=function(){if(!window.AudioContext)return!1;var h=new AudioContext;return!!h.createMediaStreamDestination&&!!h.createMediaStreamSource},l.prototype.checkBlackList=function(){var h=!1;if(d.BrowserUtil.isOppoBrowser&&d.SystemUtil.isAndroid){var p=(this.getUa().toLowerCase().match(/heytapbrowser\/([\d.]+)/)||[])[1]||"";h=!this.compareVersion(p,"40.7.39.1")}else(d.BrowserUtil.isUCBrowser||d.BrowserUtil.isQuarkBrowser)&&d.SystemUtil.isIos?h=!0:d.BrowserUtil.isWebView&&d.SystemUtil.isAndroid&&(h=!(d.BrowserUtil.browserMainVersion>=79));return h},l.prototype.checkBrowser=function(h){if(d.SystemUtil.isIos){if(d.BrowserUtil.isUCBrowser||d.BrowserUtil.isQuarkBrowser)return h.errorCode=m.ErrorCode.ERROR_BROWSER_NOTSUPPORT,h.message=f.EN.MESSAGE_BROWSER_NOTSUPPORT,!1;if(d.BrowserUtil.isSafari||d.BrowserUtil.isQQBrowser)return d.BrowserUtil.browserMainVersion>=11||(h.errorCode=m.ErrorCode.ERROR_BROWSER_VERSIONLOW,h.message=f.EN.MESSAGE_BROWSER_VERSIONLOW,!1);if(d.BrowserUtil.isEdge||d.BrowserUtil.isChrome)return d.BrowserUtil.browserMainVersion>=79||(h.errorCode=m.ErrorCode.ERROR_BROWSER_VERSIONLOW,h.message=f.EN.MESSAGE_BROWSER_VERSIONLOW,!1);if(d.BrowserUtil.isMicroMessenger)return!!this.compareVersion(d.SystemUtil.systemVersion,"12.1.4")||(h.errorCode=m.ErrorCode.ERROR_BROWSER_VERSIONLOW,h.message=f.EN.MESSAGE_BROWSER_VERSIONLOW,!1);if(d.BrowserUtil.isDingTalk)return!!d.SystemUtil.compareVersion("11.2.5")||(h.errorCode=m.ErrorCode.ERROR_BROWSER_VERSIONLOW,h.message=f.EN.MESSAGE_BROWSER_VERSIONLOW,!1);if(d.BrowserUtil.isWebView)return!!this.compareVersion(d.SystemUtil.systemVersion,"14.3")||(h.errorCode=m.ErrorCode.ERROR_BROWSER_VERSIONLOW,h.message=f.EN.MESSAGE_BROWSER_VERSIONLOW,!1)}else if(d.SystemUtil.isAndroid){if(this.checkPrivateUcWebview())return!0;if(d.BrowserUtil.isChrome||d.BrowserUtil.isQQBrowser||d.BrowserUtil.isHuaweiBrowser||d.BrowserUtil.isSamsungBrowser)return d.BrowserUtil.browserMainVersion>=63||(h.errorCode=m.ErrorCode.ERROR_BROWSER_VERSIONLOW,h.message=f.EN.MESSAGE_BROWSER_VERSIONLOW,!1);if(d.BrowserUtil.isEdge)return d.BrowserUtil.browserMainVersion>=79||(h.errorCode=m.ErrorCode.ERROR_BROWSER_VERSIONLOW,h.message=f.EN.MESSAGE_BROWSER_VERSIONLOW,!1);if(d.BrowserUtil.isMicroMessenger)return!!this.compareVersion(this.getChromeCoreVersion(),"63")||(h.errorCode=m.ErrorCode.ERROR_BROWSER_VERSIONLOW,h.message=f.EN.MESSAGE_BROWSER_VERSIONLOW,!1);if(d.BrowserUtil.isDingTalk)return!!this.compareVersion(this.getChromeCoreVersion(),"69")||(h.errorCode=m.ErrorCode.ERROR_BROWSER_VERSIONLOW,h.message=f.EN.MESSAGE_BROWSER_VERSIONLOW,!1);if(d.BrowserUtil.isOppoBrowser){var p=(this.getUa().toLowerCase().match(/heytapbrowser\/([\d.]+)/)||[])[1]||"";return!!this.compareVersion(p,"40.7.39.1")||(h.errorCode=m.ErrorCode.ERROR_BROWSER_VERSIONLOW,h.message=f.EN.MESSAGE_BROWSER_VERSIONLOW,!1)}if(d.BrowserUtil.isX5Core)return!0;if(d.BrowserUtil.isWebView)return d.BrowserUtil.browserMainVersion>=79||(h.errorCode=m.ErrorCode.ERROR_BROWSER_VERSIONLOW,h.message=f.EN.MESSAGE_BROWSER_VERSIONLOW,!1)}else if(d.SystemUtil.isMacOS){if(d.BrowserUtil.isElectron)return!0;if(d.BrowserUtil.isSafari)return d.BrowserUtil.browserMainVersion>=11||(h.errorCode=m.ErrorCode.ERROR_BROWSER_VERSIONLOW,h.message=f.EN.MESSAGE_BROWSER_VERSIONLOW,!1);if(d.BrowserUtil.isChrome)return d.BrowserUtil.browserMainVersion>=63||(h.errorCode=m.ErrorCode.ERROR_BROWSER_VERSIONLOW,h.message=f.EN.MESSAGE_BROWSER_VERSIONLOW,!1);if(d.BrowserUtil.isEdge)return d.BrowserUtil.browserMainVersion>=79||(h.errorCode=m.ErrorCode.ERROR_BROWSER_VERSIONLOW,h.message=f.EN.MESSAGE_BROWSER_VERSIONLOW,!1);if(d.BrowserUtil.isFirefox)return d.BrowserUtil.browserMainVersion>=62||(h.errorCode=m.ErrorCode.ERROR_BROWSER_VERSIONLOW,h.message=f.EN.MESSAGE_BROWSER_VERSIONLOW,!1);if(d.BrowserUtil.isOpera)return d.BrowserUtil.browserMainVersion>=15||(h.errorCode=m.ErrorCode.ERROR_BROWSER_VERSIONLOW,h.message=f.EN.MESSAGE_BROWSER_VERSIONLOW,!1)}else if(d.SystemUtil.isWindows){if(d.BrowserUtil.isElectron||d.BrowserUtil.isMicroMessenger)return!0;if(d.BrowserUtil.isChrome||d.BrowserUtil.isQQBrowser)return d.BrowserUtil.browserMainVersion>=63||(h.errorCode=m.ErrorCode.ERROR_BROWSER_VERSIONLOW,h.message=f.EN.MESSAGE_BROWSER_VERSIONLOW,!1);if(d.BrowserUtil.isEdge)return d.BrowserUtil.browserMainVersion>=79||(h.errorCode=m.ErrorCode.ERROR_BROWSER_VERSIONLOW,h.message=f.EN.MESSAGE_BROWSER_VERSIONLOW,!1);if(d.BrowserUtil.isFirefox)return d.BrowserUtil.browserMainVersion>=62||(h.errorCode=m.ErrorCode.ERROR_BROWSER_VERSIONLOW,h.message=f.EN.MESSAGE_BROWSER_VERSIONLOW,!1);if(d.BrowserUtil.isOpera)return d.BrowserUtil.browserMainVersion>=15||(h.errorCode=m.ErrorCode.ERROR_BROWSER_VERSIONLOW,h.message=f.EN.MESSAGE_BROWSER_VERSIONLOW,!1)}else if(d.SystemUtil.isLinux){if(d.BrowserUtil.isChrome)return d.BrowserUtil.browserMainVersion>=63||(h.errorCode=m.ErrorCode.ERROR_BROWSER_VERSIONLOW,h.message=f.EN.MESSAGE_BROWSER_VERSIONLOW,!1);if(d.BrowserUtil.isEdge)return d.BrowserUtil.browserMainVersion>=79||(h.errorCode=m.ErrorCode.ERROR_BROWSER_VERSIONLOW,h.message=f.EN.MESSAGE_BROWSER_VERSIONLOW,!1);if(d.BrowserUtil.isFirefox)return d.BrowserUtil.browserMainVersion>=62||(h.errorCode=m.ErrorCode.ERROR_BROWSER_VERSIONLOW,h.message=f.EN.MESSAGE_BROWSER_VERSIONLOW,!1)}return h.errorCode===0&&(h.errorCode=m.ErrorCode.ERROR_BROWSER_NOTSUPPORT,h.message=f.EN.MESSAGE_BROWSER_NOTSUPPORT),!1},l.prototype.checkH264Decode=function(h){var p=this;return new Promise(function(v,g){return c(p,void 0,void 0,function(){var R;return u(this,function(_){switch(_.label){case 0:return[4,this.tryFindH264FromSdp(h)];case 1:if(R=_.sent())return v(!0),[2];_.label=2;case 2:return _.trys.push([2,4,,5]),[4,this.loadH264(3)];case 3:return R=_.sent(),[3,5];case 4:return _.sent(),[3,5];case 5:return R?v(!0):(h&&h.errorCode===0&&(h.errorCode=m.ErrorCode.ERROR_NOTSUPPORT_H264,h.message=f.EN.MESSAGE_NOTSUPPORT_H264),g(!1)),[2]}})})})},l.prototype.checkSDPSupportH264=function(h){return h.indexOf("H264")>0||h.indexOf("h264")>0||h.indexOf("H.264")>0||h.indexOf("h.264")>0},l.prototype.checkPrivateUcWebview=function(){return this.getUa().indexOf("UniqueCode")>0},l.prototype.getUa=function(){return navigator&&navigator.userAgent||""},l.prototype.getChromeCoreVersion=function(){return(this.getUa().toLowerCase().match(/chrome\/([\d.]+)/)||[])[1]||""},l.prototype.compareVersion=function(h,p){h===void 0&&(h=""),p===void 0&&(p="");for(var v=(h||"").split("."),g=(p||"").split("."),R=0,_=0,w=0;w<v.length&&w<g.length;++w){if((R=isNaN(parseInt(v[w],10))?0:parseInt(v[w],10))<(_=isNaN(parseInt(g[w],10))?0:parseInt(g[w],10)))return!1;if(R>_)return!0}return!0},l.prototype.tryFindH264FromSdp=function(h){return c(this,void 0,void 0,function(){var p,v,g;return u(this,function(R){switch(R.label){case 0:if(p=!1,!RTCPeerConnection)return[2,p];v=new RTCPeerConnection,g=void 0,R.label=1;case 1:return R.trys.push([1,3,,4]),[4,v.createOffer({offerToReceiveVideo:!0,offerToReceiveAudio:!0})];case 2:return(g=R.sent())&&g.sdp&&(p=this.checkSDPSupportH264(g.sdp)),[3,4];case 3:return R.sent(),p=!1,h&&(h.errorCode=m.ErrorCode.ERROR_CREATEOFFER,h.message=f.EN.MESSAGE_CREATEOFFER),[3,4];case 4:return v.close(),v=void 0,[2,p]}})})},l.prototype.loadH264=function(h){var p=this;return new Promise(function(v,g){return c(p,void 0,void 0,function(){var R,_,w,k,O=this;return u(this,function(C){if(!d.SystemUtil.isAndroid||!d.BrowserUtil.isChrome&&!d.BrowserUtil.isWebView)return v(!1),[2];for(R=0,_=[],w=0;R<h;)k=setTimeout(function(){return c(O,void 0,void 0,function(){return u(this,function(b){switch(b.label){case 0:return w++,[4,this.tryFindH264FromSdp()];case 1:return b.sent()?(_.forEach(function(A){clearTimeout(A)}),_=[],v(!0),[2]):(w===h&&v(!1),[2])}})})},1e3*R),_.push(k),R++;return[2]})})})},l.prototype.checkH264Encode=function(){return c(this,void 0,void 0,function(){var h,p,v;return u(this,function(g){switch(g.label){case 0:return[4,this.loadH264(3)];case 1:return!(h=g.sent())&&RTCRtpSender&&RTCRtpSender.getCapabilities&&(p=JSON.stringify((v=RTCRtpSender.getCapabilities("video"))===null||v===void 0?void 0:v.codecs),h=p.toLowerCase().includes("video/h264")),[2,!!h]}})})},l.prototype.createBlankStream=function(){var h,p,v,g=(h=new AudioContext,p=h.createOscillator(),v=p.connect(h.createMediaStreamDestination()),p.start(),Object.assign(v.stream.getAudioTracks()[0],{enabled:!1}));g.stop();var R=function(_){var w,k=_===void 0?{}:_,O=k.width,C=O===void 0?160:O,b=k.height,A=b===void 0?90:b,T=document.createElement("canvas");T.width=C,T.height=A,(w=T.getContext("2d"))===null||w===void 0||w.fillRect(0,0,C,A);var M=T.captureStream();return Object.assign(M.getVideoTracks()[0],{enabled:!1})}();return R.stop(),new MediaStream([g,R])},l}();s.SupportUtil=S},2718:(o,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.createUUID=s.evaluateNetworkCondition=s.makeCancelable=s.hasVideoTrack=s.hasAudioTrack=s.getVideoTrack=s.getAudioTrack=s.pruneSubUrl=s.getJitterBufferDelayAvg=void 0,s.getJitterBufferDelayAvg=function(a,c){return a&&c?Number(a)/Number(c)*1e3:-1},s.pruneSubUrl=function(a,c){var u=a||"";return u=u.replace("@subaudio=no","").replace("@subvideo=no",""),c&&(u=u.split("?")[0]),u},s.getAudioTrack=function(a){return a.getAudioTracks()[0]},s.getVideoTrack=function(a){return a.getVideoTracks()[0]},s.hasAudioTrack=function(a){return a.getAudioTracks().length>0},s.hasVideoTrack=function(a){return a.getVideoTracks().length>0},s.makeCancelable=function(a){var c=!1;return{promise:new Promise(function(u,d){a.then(function(E){return c?d({isCanceled:!0}):u(E)}),a.catch(function(E){return d(c?{isCanceled:!0}:E)})}),cancel:function(){c=!0}}},s.evaluateNetworkCondition=function(a,c,u,d,E){var m=0;if(!navigator.onLine)return m=6;var f=[{loss:0,rtt:0,jbd:1},{loss:0,rtt:1,jbd:0},{loss:0,rtt:.5,jbd:.5},{loss:1,rtt:0,jbd:0},{loss:.8,rtt:0,jbd:.2},{loss:.8,rtt:.2,jbd:0},{loss:.6,rtt:.2,jbd:.2}],y=-1,S=-1,l=-1;if(typeof c=="number"&&c>=0||typeof u=="number"&&u>=0){y=0;var h=!1,p=!1;typeof c=="number"&&c>=0&&(y+=c,h=!0),typeof u=="number"&&u>=0&&(y+=u,p=!0),h&&!p&&(y*=2),p&&!h&&(y*=1.8)}typeof a=="number"&&a>=0&&(l=a),(typeof d=="number"&&d>=0||typeof E=="number"&&E>=0)&&(S=0,typeof d=="number"&&d>=0&&(S+=d),typeof E=="number"&&E>=0&&(S+=E));var v;if((v=4*(y!==-1?1:0)+2*(l!==-1?1:0)+(S!==-1?1:0))>0){var g=1.2*y*f[v-1].loss+l/1500*f[v-1].rtt+S/3e3*f[v-1].jbd;m=g<=.1?1:g<=.23?2:g<=.36?3:g<=.49?4:5}else m=0;return m},s.createUUID=function(a,c){var u,d="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),E=[];if(c=c||d.length,a)for(u=0;u<a;u++)E[u]=d[0|Math.random()*c];else{var m=void 0;for(E[8]=E[13]=E[18]=E[23]="-",E[14]="4",u=0;u<36;u++)E[u]||(m=0|16*Math.random(),E[u]=d[u==19?3&m|8:m])}return E.join("")}},233:o=>{/*! useragent-util - ver 1.3.1 created:9/4/2024, 4:31:28 PM */o.exports=(()=>{var s={622:(d,E,m)=>{Object.defineProperty(E,"__esModule",{value:!0}),E.BrowserUtil=E.BrowserType=void 0;var f,y=m(101);(function(l){l.IE="IE",l.Chrome="Chrome",l.Safari="Safari",l.Firefox="Firefox",l.Opera="Opera",l.Edge="Edge",l.MicroMessenger="MicroMessenger",l.X5Core="X5Core",l.Quark="Quark",l.QQ="QQ",l.QQBrowser="QQBrowser",l.DingTalk="DingTalk",l.Electron="Electron",l.Sogou="Sogou",l.Vivo="VivoBrowser",l.Oppo="OppoBrowser",l.UC="UCBrowser",l.MI="MiBrowser",l.Lenovo="SLBrowser",l.Maxthon="Maxthon",l.Liebao="Liebao",l.Huawei="Huawei",l.Meizu="MZBrowser",l.Finger="FingerBrowser",l.Samsung="SamsungBrowser",l.WebVeiw="WebVeiw",l.Unknown="unknown"})(f=E.BrowserType||(E.BrowserType={}));var S=function(){function l(){}return Object.defineProperty(l,"isBrowser",{get:function(){return typeof document<"u"},enumerable:!1,configurable:!0}),Object.defineProperty(l,"domain",{get:function(){return window.location.protocol+window.location.host},enumerable:!1,configurable:!0}),Object.defineProperty(l,"isHttps",{get:function(){return this.isBrowser&&document.location&&(document.location.protocol=="https:"||document.location.host.indexOf("127.0.0.1:")===0||document.location.host.indexOf("localhost:")===0)},enumerable:!1,configurable:!0}),Object.defineProperty(l,"isSupportScreenShare",{get:function(){return!!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)},enumerable:!1,configurable:!0}),Object.defineProperty(l,"isChrome",{get:function(){return l._getBrowserInfo(),f.Chrome===l._browserName},enumerable:!1,configurable:!0}),Object.defineProperty(l,"isSafari",{get:function(){return l._getBrowserInfo(),f.Safari===l._browserName},enumerable:!1,configurable:!0}),Object.defineProperty(l,"isIE",{get:function(){return l._getBrowserInfo(),f.IE===l._browserName},enumerable:!1,configurable:!0}),Object.defineProperty(l,"isFirefox",{get:function(){return l._getBrowserInfo(),f.Firefox===l._browserName},enumerable:!1,configurable:!0}),Object.defineProperty(l,"isEdge",{get:function(){return l._getBrowserInfo(),f.Edge===l.browserName},enumerable:!1,configurable:!0}),Object.defineProperty(l,"isSogou",{get:function(){return l._getBrowserInfo(),f.Sogou===l.browserName},enumerable:!1,configurable:!0}),Object.defineProperty(l,"isVivoBroswer",{get:function(){return l._getBrowserInfo(),f.Vivo===l.browserName},enumerable:!1,configurable:!0}),Object.defineProperty(l,"isOppoBrowser",{get:function(){return l._getBrowserInfo(),f.Oppo===l.browserName},enumerable:!1,configurable:!0}),Object.defineProperty(l,"isMiBrowser",{get:function(){return l._getBrowserInfo(),f.MI===l.browserName},enumerable:!1,configurable:!0}),Object.defineProperty(l,"isLenovoBrowser",{get:function(){return l._getBrowserInfo(),f.Lenovo===l.browserName},enumerable:!1,configurable:!0}),Object.defineProperty(l,"isMaxthonBrowser",{get:function(){return l._getBrowserInfo(),f.Maxthon===l.browserName},enumerable:!1,configurable:!0}),Object.defineProperty(l,"isLiebaoBrowser",{get:function(){return l._getBrowserInfo(),f.Liebao===l.browserName},enumerable:!1,configurable:!0}),Object.defineProperty(l,"isHuaweiBrowser",{get:function(){return l._getBrowserInfo(),f.Huawei===l.browserName},enumerable:!1,configurable:!0}),Object.defineProperty(l,"isMZBrowser",{get:function(){return l._getBrowserInfo(),f.Meizu===l._browserName},enumerable:!1,configurable:!0}),Object.defineProperty(l,"isSamsungBrowser",{get:function(){return l._getBrowserInfo(),f.Samsung===l._browserName},enumerable:!1,configurable:!0}),Object.defineProperty(l,"isOpera",{get:function(){return l._getBrowserInfo(),f.Opera===l._browserName},enumerable:!1,configurable:!0}),Object.defineProperty(l,"isMicroMessenger",{get:function(){return l._getBrowserInfo(),l._browserName===f.MicroMessenger},enumerable:!1,configurable:!0}),Object.defineProperty(l,"isQQ",{get:function(){return l._getBrowserInfo(),f.QQ===l.browserName},enumerable:!1,configurable:!0}),Object.defineProperty(l,"isQQBrowser",{get:function(){return l._getBrowserInfo(),f.QQBrowser===l.browserName},enumerable:!1,configurable:!0}),Object.defineProperty(l,"isX5Core",{get:function(){return l._getBrowserInfo(),l._browserName===f.X5Core},enumerable:!1,configurable:!0}),Object.defineProperty(l,"isUCBrowser",{get:function(){return l._getBrowserInfo(),l._browserName===f.UC},enumerable:!1,configurable:!0}),Object.defineProperty(l,"isQuarkBrowser",{get:function(){return l._getBrowserInfo(),l._browserName===f.Quark},enumerable:!1,configurable:!0}),Object.defineProperty(l,"isFingerBrowser",{get:function(){return l._getBrowserInfo(),l._browserName===f.Finger},enumerable:!1,configurable:!0}),Object.defineProperty(l,"isChromeCore",{get:function(){return l._getBrowserInfo(),l._core==="Chrome"},enumerable:!1,configurable:!0}),Object.defineProperty(l,"isWebView",{get:function(){return l._getBrowserInfo(),l._browserName===f.WebVeiw},enumerable:!1,configurable:!0}),Object.defineProperty(l,"isDingTalk",{get:function(){return l._getBrowserInfo(),l._browserName===f.DingTalk},enumerable:!1,configurable:!0}),Object.defineProperty(l,"isUnknown",{get:function(){return l._getBrowserInfo(),f.Unknown===l.browserName},enumerable:!1,configurable:!0}),Object.defineProperty(l,"browserName",{get:function(){return l._getBrowserInfo(),l._browserName},enumerable:!1,configurable:!0}),Object.defineProperty(l,"browserVersion",{get:function(){return l._getBrowserInfo(),l._browserVersion},enumerable:!1,configurable:!0}),Object.defineProperty(l,"browserMainVersion",{get:function(){return l._getBrowserInfo(),l._browserVersion?parseInt(l._browserVersion.split(".")[0],10):0},enumerable:!1,configurable:!0}),Object.defineProperty(l,"browserCoreVersion",{get:function(){return navigator.userAgent.toLowerCase(),y.SystemUtil.isIos||y.SystemUtil.isMacOS,l.browserMainVersion},enumerable:!1,configurable:!0}),Object.defineProperty(l,"isElectron",{get:function(){return l._getBrowserInfo(),f.Electron===l.browserName},enumerable:!1,configurable:!0}),Object.defineProperty(l,"userAgent",{get:function(){var h=navigator.userAgent.toLowerCase(),p=h.indexOf("gecko");if(p>-1){p=h.indexOf(" ",p);var v=(h=h.substring(p+1,h.length)).split(" ");h="";for(var g=0;g<v.length;++g){var R=v[g].split("/");R&&R.length&&(h+=R[0]+" ")}}return h},enumerable:!1,configurable:!0}),l.compareVersion=function(h){if(l._getBrowserInfo(),l._browserVersion){for(var p=l._browserVersion.split("."),v=h.split("."),g=0,R=0,_=0;_<p.length&&_<v.length;++_){if((g=isNaN(parseInt(p[_],10))?0:parseInt(p[_],10))<(R=isNaN(parseInt(v[_],10))?0:parseInt(v[_],10)))return!1;if(g>R)return!0}return!0}return!0},l._getBrowserInfo=function(){if(!l._browserName||!l._browserVersion)if(navigator&&navigator.userAgent){var h=navigator.userAgent.toLowerCase(),p=void 0;(p=h.match(/edg[e|a]?\/([\d.]+)/))||(p=h.match(/edgios\/([\d.]+)/))?l._updateBrowserInfo(f.Edge,h,p[1]):(p=h.match(/rv:([\d.]+)\) like gecko/))||(p=h.match(/msie ([\d.]+)/))?l._updateBrowserInfo(f.IE,h,p[1]):(p=h.match(/vivobrowser\/([\d.]+)/))?l._updateBrowserInfo(f.Vivo,h,p[1]):(p=h.match(/miuibrowser\/([\d.]+)/))?l._updateBrowserInfo(f.MI,h,p[1]):(p=h.match(/samsungbrowser\/([\d.]+)/))?l._updateBrowserInfo(f.Samsung,h,p[1]):(p=h.match(/heytapbrowser\/([\d.]+)/))?l._updateBrowserInfo(f.Oppo,h,p[1]):(p=h.match(/mzbrowser\/([\d.]+)/))?l._updateBrowserInfo(f.Meizu,h,p[1]):(p=h.match(/ucbrowser\/([\d.]+)/))?l._updateBrowserInfo(f.UC,h,p[1]):(p=h.match(/quark\/([\d.]+)/))?l._updateBrowserInfo(f.Quark,h,p[1]):(p=h.match(/slbrowser\/([\d.]+)/))?l._updateBrowserInfo(f.Lenovo,h,p[1]):(p=h.match(/lbbrowser\/([\d.]+)/))?l._updateBrowserInfo(f.Liebao,h,p[1]):(p=h.match(/fingerbrowser\/([\d.]+)/))?l._updateBrowserInfo(f.Finger,h,p[1]):(p=h.match(/huaweibrowser\/([\d.]+)/))?l._updateBrowserInfo(f.Huawei,h,p[1]):(p=h.match(/maxthon\/([\d.]+)/))?l._updateBrowserInfo(f.Maxthon,h,p[1]):(p=h.match(/firefox\/([\d.]+)/))?l._updateBrowserInfo(f.Firefox,h,p[1]):(p=h.match(/electron\/([\d.]+)/))?l._updateBrowserInfo(f.Electron,h,p[1]):(p=h.match(/chrome\/([\d.]+)/))&&this._isChrome(h)||(p=h.match(/crios\/([\d.]+)/))&&this._isChrome(h)?l._updateBrowserInfo(f.Chrome,h,p[1]):(p=h.match(/metasr\s([\d.]+)/))||(p=h.match(/sogoumobilebrowser\/([\d.]+)/))?l._updateBrowserInfo(f.Sogou,h,p[1]):(p=h.match(/opr.([\d.]+)/))?l._updateBrowserInfo(f.Opera,h,p[1]):(p=h.match(/micromessenger.([\d.]+)/))?l._updateBrowserInfo(f.MicroMessenger,h,p[1]):(p=h.match(/qq\/([\d.]+)/))?l._updateBrowserInfo(f.QQ,h,p[1]):(p=h.match(/m?qqbrowser\/([\d.]+)/))||(p=h.match(/qqbrowserlite\/([\d.]+)/))?l._updateBrowserInfo(f.QQBrowser,h,p[1]):(p=h.match(/dingtalk.([\d.]+)/))?l._updateBrowserInfo(f.DingTalk,h,p[1]):(p=h.match(/tbs\/([\d.]+)/))?l._updateBrowserInfo(f.X5Core,h,p[1]):(p=h.match(/version\/([\d.]+).*safari/))&&this._isSafari(h)&&l._updateBrowserInfo(f.Safari,h,p[1]),l._browserName===f.Unknown&&l._isWebview(h)&&l._updateBrowserInfo(f.WebVeiw,h,"")}else l._browserName=f.Unknown,l._browserVersion="0.0"},l._isChrome=function(h){var p=h.split(/\(|\)/);if(l._core="Chrome",p.length===5){var v=p[4].trim().split(" ");if(v.length===2){if(v[0].indexOf("chrome")>-1&&v[1].indexOf("safari")>-1)return!0}else if(v.length===3){if(v[1].indexOf("mobile")>-1&&v[2].indexOf("safari")>-1&&(v[0].indexOf("chrome")>-1||v[0].indexOf("crios")>-1))return!0}else if(h.indexOf("qianniu")>-1)return!0}return!1},l._isSafari=function(h){var p=h.split(/\(|\)/);if(p.length===5){var v=p[4].trim().split(" ");if(v.length===2){if(v[0].indexOf("version")>-1&&v[1].indexOf("safari")>-1)return!0}else if(v.length===3&&v[0].indexOf("version")>-1&&v[1].indexOf("mobile")>-1&&v[2].indexOf("safari")>-1)return!0}return!1},l._isWebview=function(h){if(h){var p=new RegExp("("+["WebView","(iPhone|iPod|iPad)(?!.*Safari)","Android.*(wv|.0.0.0)","Linux; U; Android"].join("|")+")","ig"),v=new RegExp("("+["VivoBrowser","MZBrowser","MiuiBrowser"].join("|")+")","ig");return!!h.match(p)&&!h.match(v)}},l._updateBrowserInfo=function(h,p,v){l._browserName=h;var g=null;switch(h){case f.QQBrowser:y.SystemUtil.isIos||y.SystemUtil.isMacOS?(g=p.match(/version\/([\d.]+).*safari/),l._browserVersion=g?g[1]:"0.0"):(g=p.match(/chrome\/([\d.]+)/),l._browserVersion=g?g[1]:"0.0");break;case f.Vivo:case f.Oppo:case f.Meizu:case f.Huawei:case f.Sogou:case f.Samsung:g=p.match(/chrome\/([\d.]+)/),l._browserVersion=g?g[1]:"0.0";break;case f.WebVeiw:y.SystemUtil.isAndroid?(g=p.match(/chrome\/([\d.]+)/),l._browserVersion=g?g[1]:"0.0"):y.SystemUtil.isIos&&(l._browserVersion=y.SystemUtil.systemVersion);break;default:l._browserVersion=v}},l._browserName=f.Unknown,l._browserVersion="",l._core="",l}();E.BrowserUtil=S},864:(d,E)=>{Object.defineProperty(E,"__esModule",{value:!0}),E.Guid=void 0;var m=function(){function f(){}return f.create=function(y,S){S===void 0&&(S=16);var l,h,p="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),v=[];if(S=S||p.length,y)for(l=0;l<y;l++)v[l]=p[0|Math.random()*S];else for(v[8]=v[13]=v[18]=v[23]="-",v[14]="4",l=0;l<36;l++)v[l]||(h=0|16*Math.random(),v[l]=p[l==19?3&h|8:h]);return v.join("")},f}();E.Guid=m},442:(d,E,m)=>{Object.defineProperty(E,"__esModule",{value:!0}),E.LocalStorage=void 0;var f=m(864),y=function(){function S(){}return Object.defineProperty(S,"uuid",{get:function(){var l="alirtc_uuid",h=S.get(l);return h||(h=f.Guid.create(32),S.set(l,h)),h},enumerable:!1,configurable:!0}),S.get=function(l){var h="";return window&&window.localStorage&&(h=window.localStorage.getItem(l)||""),h},S.set=function(l,h){l&&window&&window.localStorage&&window.localStorage.setItem(l,h)},S}();E.LocalStorage=y},72:(d,E)=>{Object.defineProperty(E,"__esModule",{value:!0}),E.ApiRequest=void 0;var m=function(){function f(){}return f.postBody=function(y,S,l){y=f._getUrl(y,S);var h,p={};return p.headers||(p.headers={}),p.headers.Accept="application/json",p.headers["Content-Type"]="application/json",new Promise(function(v,g){f.requestBody("POST",y,l).then(function(R){return h=R,R.ok?R.json():R.text()}).then(function(R){h.ok?R.code?(R=f._intercept(R),g(R)):v(R.data):g(f._httpErrorMessage(h,R))}).catch(function(R){R=f._httpErrorMessage(R),g(R)})})},f.get=function(y,S,l){var h;return l===void 0&&(l={}),y=f._getUrl(y,S),l.headers||(l.headers={}),l.headers["Content-Type"]="application/json",new Promise(function(p,v){f.request("GET",y,l).then(function(g){return h=g,g.ok?g.json():g.text()}).then(function(g){h.ok?g.code?(g=f._intercept(g),v(g)):p(g.data):v(f._httpErrorMessage(h,g))}).catch(function(g){g=f._httpErrorMessage(g),v(g)})})},f.post=function(y,S,l,h){var p;return h===void 0&&(h={}),y=f._getUrl(y,S),h.headers||(h.headers={}),h.body=l,h.headers.Accept="application/json",h.headers["Content-Type"]="application/json",new Promise(function(v,g){f.request("POST",y,h).then(function(R){return p=R,R.ok?R.json():R.text()}).then(function(R){p.ok?R.code?(R=f._intercept(R),g(R)):v(R.data):g(f._httpErrorMessage(p,R))}).catch(function(R){R=f._httpErrorMessage(R),g(R)})})},f.request=function(y,S,l){y===void 0&&(y="GET");var h=new Headers(l.headers),p=new Request(S,{method:y,headers:h});return fetch(p)},f.requestBody=function(y,S,l){return y===void 0&&(y="GET"),fetch(S,{method:y,body:l,headers:new Headers({"Content-Type":"application/json"})})},f.ajaxPost=function(y,S,l,h){return h===void 0&&(h={}),y=f._getUrl(y,S),h.headers||(h.headers={}),h.headers.Accept="application/json",h.headers["Content-Type"]="application/json",f.ajax("POST",y,l,h)},f.ajax=function(y,S,l,h){y===void 0&&(y="GET"),h===void 0&&(h={});var p=new XMLHttpRequest;return new Promise(function(v,g){p.onreadystatechange=function(){if(p.readyState===4)if(p.status===200){var _=JSON.parse(p.responseText);_.code?(_=f._intercept(_),g(_)):v(_)}else g({message:p.responseText||":"+S})},p.open(y,S,!0);try{if(h.withCredentials&&(p.withCredentials=!0),h.headers)for(var R in h.headers)p.setRequestHeader(R,h.headers[R])}catch(_){return void g(_)}try{p.send(l)}catch(_){g(_)}})},f._getUrl=function(y,S){var l=[];if(S)for(var h in S)l.push(h+"="+S[h]);var p=l.join("&");return(y.indexOf("?")!=-1?y:y+"?")+p},f._httpErrorMessage=function(y,S){return y.message||(y.message="HTTP "+y.status+"("+y.statusText+") : "+S),y},f._intercept=function(y){var S=y.data;return y.code&&((S=S||{}).data=y.data,S.code=y.code,S.description=y.description,S.message="0x"+Number(y.code).toString(16)+", "+y.description,S.tid&&(S.message+=", tid="+S.tid)),S},f}();E.ApiRequest=m},101:(d,E)=>{var m,f;Object.defineProperty(E,"__esModule",{value:!0}),E.SystemUtil=E.WindowsType=E.SystemType=void 0,function(S){S.Unknown="Unknown",S.MacOS="Mac",S.Windows="Windows",S.Android="Android",S.Iphone="iphone",S.Ipad="ipad",S.iOS="iOS",S.Linux="Linux",S.ChromeOS="ChromeOS"}(m=E.SystemType||(E.SystemType={})),function(S){S.Windows10="Windows 10",S.Windows7="Windows 7",S.WindowsVista="Windows vista",S.WindowsXP="Windows xp"}(f=E.WindowsType||(E.WindowsType={}));var y=function(){function S(){}return Object.defineProperty(S,"isMacOS",{get:function(){return m.MacOS===S.systemName},enumerable:!1,configurable:!0}),Object.defineProperty(S,"isWindows",{get:function(){return S.systemName.indexOf(m.Windows)>-1},enumerable:!1,configurable:!0}),Object.defineProperty(S,"isIos",{get:function(){return m.Iphone===S.systemName||m.Ipad===S.systemName},enumerable:!1,configurable:!0}),Object.defineProperty(S,"isAndroid",{get:function(){return m.Android===S.systemName},enumerable:!1,configurable:!0}),Object.defineProperty(S,"isLinux",{get:function(){return m.Linux===S.systemName||m.Linux===S._platform},enumerable:!1,configurable:!0}),Object.defineProperty(S,"systemName",{get:function(){return S._getSystemInfo(),S._systemName},enumerable:!1,configurable:!0}),Object.defineProperty(S,"systemVersion",{get:function(){return S._getSystemInfo(),S._systemVersion},enumerable:!1,configurable:!0}),Object.defineProperty(S,"platform",{get:function(){return S._getSystemInfo(),S._platform},enumerable:!1,configurable:!0}),Object.defineProperty(S,"isUnknown",{get:function(){return!S.platform||S.platform===m.Unknown},enumerable:!1,configurable:!0}),S.compareVersion=function(l){if(S._getSystemInfo(),S._systemVersion){for(var h=S._systemVersion.split("."),p=l.split("."),v=0,g=0,R=0;R<h.length&&R<p.length;++R){if((v=isNaN(parseInt(h[R],10))?0:parseInt(h[R],10))<(g=isNaN(parseInt(p[R],10))?0:parseInt(p[R],10)))return!1;if(v>g)return!0}return!0}return!0},S._getSystemInfo=function(){if(!S._systemName||!S._systemVersion||!S._platform)if(navigator&&navigator.userAgent){var l=navigator.userAgent.toLowerCase();l.indexOf("ipad")>-1?(S._systemName=m.Ipad,S._platform=m.iOS,S._systemVersion=S._getIosSystemVersion(l)):l.indexOf("iphone")>-1?(S._systemName=m.Iphone,S._platform=m.iOS,S._systemVersion=S._getIosSystemVersion(l)):l.indexOf("android")>-1?(S._platform=m.Android,S._systemName=m.Android,S._systemVersion=S._getAndroidSystemVersion(l)):l.indexOf("win")>-1?l.indexOf("windwos nt 10")>-1||l.indexOf("windows 10")?(S._systemName=f.Windows10,S._platform=m.Windows,S._systemVersion="10"):l.indexOf("windows nt 6.1")>-1||l.indexOf("windows 7")>-1?(S._systemName=f.Windows7,S._platform=m.Windows,S._systemVersion="7"):l.indexOf("windows nt 6.0")>-1||l.indexOf("windows vista")>-1?(S._systemName=f.WindowsVista,S._platform=m.Windows,S._systemVersion="vista"):l.indexOf("widows nt 5.1")>-1||l.indexOf("windows xp")>-1?(S._systemName=f.WindowsXP,S._platform=m.Windows,S._systemVersion="xp"):(S._platform=m.Windows,S._systemName=m.Windows,S._systemVersion="0.0"):l.indexOf("mac")>-1?navigator&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0?(S._systemName=m.Ipad,S._platform=m.iOS,S._systemVersion=S._getIosSystemVersion(l)):(S._platform=m.MacOS,S._systemName=m.MacOS,S._systemVersion=S._getMacSystemVersion(l)):l.indexOf("linux")>-1?(S._platform=m.Linux,S._systemName=m.Linux,S._systemVersion="0.0"):l.indexOf("cros")>-1?(S._platform=m.Linux,S._systemName=m.ChromeOS,S._systemVersion="0.0"):(S._systemName=m.Unknown,S._platform=m.Windows,S._systemVersion="0.0")}else S._systemName=m.Unknown,S._platform=m.Unknown,S._systemVersion="0.0"},S._getIosSystemVersion=function(l){return(l.match(/OS [\d._]*/gi)+"").replace(/[^0-9|_.]/gi,"").replace(/_/gi,".")},S._getMacSystemVersion=function(l){return(l.match(/OS X [\d._]*/gi)+"").replace(/[^0-9|_.]/gi,"").replace(/_/gi,".")},S._getAndroidSystemVersion=function(l){return l.substr(l.indexOf("android")+8,l.indexOf(";",l.indexOf("android"))-l.indexOf("android")-8)},S._systemName="",S._systemVersion="",S._platform=m.Unknown,S}();E.SystemUtil=y}},a={};function c(d){if(a[d])return a[d].exports;var E=a[d]={exports:{}};return s[d](E,E.exports,c),E.exports}var u={};return(()=>{var d=u;Object.defineProperty(d,"__esModule",{value:!0}),d.ApiRequest=d.LocalStorage=d.Guid=d.BrowserUtil=d.SystemUtil=void 0;var E=c(101);Object.defineProperty(d,"SystemUtil",{enumerable:!0,get:function(){return E.SystemUtil}});var m=c(622);Object.defineProperty(d,"BrowserUtil",{enumerable:!0,get:function(){return m.BrowserUtil}});var f=c(864);Object.defineProperty(d,"Guid",{enumerable:!0,get:function(){return f.Guid}});var y=c(442);Object.defineProperty(d,"LocalStorage",{enumerable:!0,get:function(){return y.LocalStorage}});var S=c(72);Object.defineProperty(d,"ApiRequest",{enumerable:!0,get:function(){return S.ApiRequest}}),window&&(window.SystemUtil=E.SystemUtil,window.BrowserUtil=m.BrowserUtil,window.Guid=f.Guid,window.LocalStorage=y.LocalStorage,window.ApiRequest=S.ApiRequest)})(),u})()},9543:(o,s,a)=>{a.r(s),a.d(s,{default:()=>Rt});var c={};a.r(c),a.d(c,{fixNegotiationNeeded:()=>W,shimAddTrackRemoveTrack:()=>I,shimAddTrackRemoveTrackWithNative:()=>P,shimGetDisplayMedia:()=>b,shimGetSendersWithDtmf:()=>M,shimGetStats:()=>D,shimGetUserMedia:()=>C,shimMediaStream:()=>A,shimOnTrack:()=>T,shimPeerConnection:()=>L,shimSenderReceiverGetStats:()=>N});var u={};a.r(u),a.d(u,{shimGetDisplayMedia:()=>j,shimGetUserMedia:()=>V,shimPeerConnection:()=>H,shimReplaceTrack:()=>z});var d={};a.r(d),a.d(d,{shimAddTransceiver:()=>ve,shimCreateAnswer:()=>Me,shimCreateOffer:()=>be,shimGetDisplayMedia:()=>$,shimGetParameters:()=>Se,shimGetUserMedia:()=>K,shimOnTrack:()=>Z,shimPeerConnection:()=>ne,shimRTCDataChannel:()=>fe,shimReceiverGetStats:()=>ae,shimRemoveStream:()=>le,shimSenderGetStats:()=>te});var E={};a.r(E),a.d(E,{shimAudioContext:()=>at,shimCallbacksAPI:()=>Pe,shimConstraints:()=>Qe,shimCreateOfferLegacy:()=>Xe,shimGetUserMedia:()=>Le,shimLocalStreamsAPI:()=>_e,shimRTCIceServerUrls:()=>Ge,shimRemoteStreamsAPI:()=>ke,shimTrackEventTransceiver:()=>rt});var m={};a.r(m),a.d(m,{removeExtmapAllowMixed:()=>Ie,shimAddIceCandidateNullOrEmpty:()=>Te,shimConnectionState:()=>nt,shimMaxMessageSize:()=>ot,shimRTCIceCandidate:()=>It,shimSendThrowTypeError:()=>Et});let f=!0,y=!0;function S(F,q,G){const J=F.match(q);return J&&J.length>=G&&parseInt(J[G],10)}function l(F,q,G){if(!F.RTCPeerConnection)return;const J=F.RTCPeerConnection.prototype,X=J.addEventListener;J.addEventListener=function(Y,ce){if(Y!==q)return X.apply(this,arguments);const oe=de=>{const Ee=G(de);Ee&&(ce.handleEvent?ce.handleEvent(Ee):ce(Ee))};return this._eventMap=this._eventMap||{},this._eventMap[q]||(this._eventMap[q]=new Map),this._eventMap[q].set(ce,oe),X.apply(this,[Y,oe])};const re=J.removeEventListener;J.removeEventListener=function(Y,ce){if(Y!==q||!this._eventMap||!this._eventMap[q])return re.apply(this,arguments);if(!this._eventMap[q].has(ce))return re.apply(this,arguments);const oe=this._eventMap[q].get(ce);return this._eventMap[q].delete(ce),this._eventMap[q].size===0&&delete this._eventMap[q],Object.keys(this._eventMap).length===0&&delete this._eventMap,re.apply(this,[Y,oe])},Object.defineProperty(J,"on"+q,{get(){return this["_on"+q]},set(Y){this["_on"+q]&&(this.removeEventListener(q,this["_on"+q]),delete this["_on"+q]),Y&&this.addEventListener(q,this["_on"+q]=Y)},enumerable:!0,configurable:!0})}function h(F){return typeof F!="boolean"?new Error("Argument type: "+typeof F+". Please use a boolean."):(f=F,F?"adapter.js logging disabled":"adapter.js logging enabled")}function p(F){return typeof F!="boolean"?new Error("Argument type: "+typeof F+". Please use a boolean."):(y=!F,"adapter.js deprecation warnings "+(F?"disabled":"enabled"))}function v(){if(typeof window=="object"){if(f)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function g(F,q){y&&console.warn(F+" is deprecated, please use "+q+" instead.")}function R(F){return Object.prototype.toString.call(F)==="[object Object]"}function _(F){return R(F)?Object.keys(F).reduce(function(q,G){const J=R(F[G]),X=J?_(F[G]):F[G],re=J&&!Object.keys(X).length;return X===void 0||re?q:Object.assign(q,{[G]:X})},{}):F}function w(F,q,G){q&&!G.has(q.id)&&(G.set(q.id,q),Object.keys(q).forEach(J=>{J.endsWith("Id")?w(F,F.get(q[J]),G):J.endsWith("Ids")&&q[J].forEach(X=>{w(F,F.get(X),G)})}))}function k(F,q,G){const J=G?"outbound-rtp":"inbound-rtp",X=new Map;if(q===null)return X;const re=[];return F.forEach(Y=>{Y.type==="track"&&Y.trackIdentifier===q.id&&re.push(Y)}),re.forEach(Y=>{F.forEach(ce=>{ce.type===J&&ce.trackId===Y.id&&w(F,ce,X)})}),X}const O=v;function C(F,q){const G=F&&F.navigator;if(!G.mediaDevices)return;const J=function(Y){if(typeof Y!="object"||Y.mandatory||Y.optional)return Y;const ce={};return Object.keys(Y).forEach(oe=>{if(oe==="require"||oe==="advanced"||oe==="mediaSource")return;const de=typeof Y[oe]=="object"?Y[oe]:{ideal:Y[oe]};de.exact!==void 0&&typeof de.exact=="number"&&(de.min=de.max=de.exact);const Ee=function(Ae,Ke){return Ae?Ae+Ke.charAt(0).toUpperCase()+Ke.slice(1):Ke==="deviceId"?"sourceId":Ke};if(de.ideal!==void 0){ce.optional=ce.optional||[];let Ae={};typeof de.ideal=="number"?(Ae[Ee("min",oe)]=de.ideal,ce.optional.push(Ae),Ae={},Ae[Ee("max",oe)]=de.ideal,ce.optional.push(Ae)):(Ae[Ee("",oe)]=de.ideal,ce.optional.push(Ae))}de.exact!==void 0&&typeof de.exact!="number"?(ce.mandatory=ce.mandatory||{},ce.mandatory[Ee("",oe)]=de.exact):["min","max"].forEach(Ae=>{de[Ae]!==void 0&&(ce.mandatory=ce.mandatory||{},ce.mandatory[Ee(Ae,oe)]=de[Ae])})}),Y.advanced&&(ce.optional=(ce.optional||[]).concat(Y.advanced)),ce},X=function(Y,ce){if(q.version>=61)return ce(Y);if((Y=JSON.parse(JSON.stringify(Y)))&&typeof Y.audio=="object"){const oe=function(de,Ee,Ae){Ee in de&&!(Ae in de)&&(de[Ae]=de[Ee],delete de[Ee])};oe((Y=JSON.parse(JSON.stringify(Y))).audio,"autoGainControl","googAutoGainControl"),oe(Y.audio,"noiseSuppression","googNoiseSuppression"),Y.audio=J(Y.audio)}if(Y&&typeof Y.video=="object"){let oe=Y.video.facingMode;oe=oe&&(typeof oe=="object"?oe:{ideal:oe});const de=q.version<66;if(oe&&(oe.exact==="user"||oe.exact==="environment"||oe.ideal==="user"||oe.ideal==="environment")&&(!G.mediaDevices.getSupportedConstraints||!G.mediaDevices.getSupportedConstraints().facingMode||de)){let Ee;if(delete Y.video.facingMode,oe.exact==="environment"||oe.ideal==="environment"?Ee=["back","rear"]:oe.exact!=="user"&&oe.ideal!=="user"||(Ee=["front"]),Ee)return G.mediaDevices.enumerateDevices().then(Ae=>{let Ke=(Ae=Ae.filter(Ir=>Ir.kind==="videoinput")).find(Ir=>Ee.some(rr=>Ir.label.toLowerCase().includes(rr)));return!Ke&&Ae.length&&Ee.includes("back")&&(Ke=Ae[Ae.length-1]),Ke&&(Y.video.deviceId=oe.exact?{exact:Ke.deviceId}:{ideal:Ke.deviceId}),Y.video=J(Y.video),O("chrome: "+JSON.stringify(Y)),ce(Y)})}Y.video=J(Y.video)}return O("chrome: "+JSON.stringify(Y)),ce(Y)},re=function(Y){return q.version>=64?Y:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[Y.name]||Y.name,message:Y.message,constraint:Y.constraint||Y.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(G.getUserMedia=(function(Y,ce,oe){X(Y,de=>{G.webkitGetUserMedia(de,ce,Ee=>{oe&&oe(re(Ee))})})}).bind(G),G.mediaDevices.getUserMedia){const Y=G.mediaDevices.getUserMedia.bind(G.mediaDevices);G.mediaDevices.getUserMedia=function(ce){return X(ce,oe=>Y(oe).then(de=>{if(oe.audio&&!de.getAudioTracks().length||oe.video&&!de.getVideoTracks().length)throw de.getTracks().forEach(Ee=>{Ee.stop()}),new DOMException("","NotFoundError");return de},de=>Promise.reject(re(de))))}}}function b(F,q){F.navigator.mediaDevices&&"getDisplayMedia"in F.navigator.mediaDevices||F.navigator.mediaDevices&&(typeof q=="function"?F.navigator.mediaDevices.getDisplayMedia=function(G){return q(G).then(J=>{const X=G.video&&G.video.width,re=G.video&&G.video.height,Y=G.video&&G.video.frameRate;return G.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:J,maxFrameRate:Y||3}},X&&(G.video.mandatory.maxWidth=X),re&&(G.video.mandatory.maxHeight=re),F.navigator.mediaDevices.getUserMedia(G)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function A(F){F.MediaStream=F.MediaStream||F.webkitMediaStream}function T(F){if(typeof F=="object"&&F.RTCPeerConnection&&!("ontrack"in F.RTCPeerConnection.prototype)){Object.defineProperty(F.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(G){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=G)},enumerable:!0,configurable:!0});const q=F.RTCPeerConnection.prototype.setRemoteDescription;F.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=G=>{G.stream.addEventListener("addtrack",J=>{let X;X=F.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(Y=>Y.track&&Y.track.id===J.track.id):{track:J.track};const re=new Event("track");re.track=J.track,re.receiver=X,re.transceiver={receiver:X},re.streams=[G.stream],this.dispatchEvent(re)}),G.stream.getTracks().forEach(J=>{let X;X=F.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(Y=>Y.track&&Y.track.id===J.id):{track:J};const re=new Event("track");re.track=J,re.receiver=X,re.transceiver={receiver:X},re.streams=[G.stream],this.dispatchEvent(re)})},this.addEventListener("addstream",this._ontrackpoly)),q.apply(this,arguments)}}else l(F,"track",q=>(q.transceiver||Object.defineProperty(q,"transceiver",{value:{receiver:q.receiver}}),q))}function M(F){if(typeof F=="object"&&F.RTCPeerConnection&&!("getSenders"in F.RTCPeerConnection.prototype)&&"createDTMFSender"in F.RTCPeerConnection.prototype){const q=function(X,re){return{track:re,get dtmf(){return this._dtmf===void 0&&(re.kind==="audio"?this._dtmf=X.createDTMFSender(re):this._dtmf=null),this._dtmf},_pc:X}};if(!F.RTCPeerConnection.prototype.getSenders){F.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const X=F.RTCPeerConnection.prototype.addTrack;F.RTCPeerConnection.prototype.addTrack=function(Y,ce){let oe=X.apply(this,arguments);return oe||(oe=q(this,Y),this._senders.push(oe)),oe};const re=F.RTCPeerConnection.prototype.removeTrack;F.RTCPeerConnection.prototype.removeTrack=function(Y){re.apply(this,arguments);const ce=this._senders.indexOf(Y);ce!==-1&&this._senders.splice(ce,1)}}const G=F.RTCPeerConnection.prototype.addStream;F.RTCPeerConnection.prototype.addStream=function(X){this._senders=this._senders||[],G.apply(this,[X]),X.getTracks().forEach(re=>{this._senders.push(q(this,re))})};const J=F.RTCPeerConnection.prototype.removeStream;F.RTCPeerConnection.prototype.removeStream=function(X){this._senders=this._senders||[],J.apply(this,[X]),X.getTracks().forEach(re=>{const Y=this._senders.find(ce=>ce.track===re);Y&&this._senders.splice(this._senders.indexOf(Y),1)})}}else if(typeof F=="object"&&F.RTCPeerConnection&&"getSenders"in F.RTCPeerConnection.prototype&&"createDTMFSender"in F.RTCPeerConnection.prototype&&F.RTCRtpSender&&!("dtmf"in F.RTCRtpSender.prototype)){const q=F.RTCPeerConnection.prototype.getSenders;F.RTCPeerConnection.prototype.getSenders=function(){const G=q.apply(this,[]);return G.forEach(J=>J._pc=this),G},Object.defineProperty(F.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function D(F){if(!F.RTCPeerConnection)return;const q=F.RTCPeerConnection.prototype.getStats;F.RTCPeerConnection.prototype.getStats=function(){const[G,J,X]=arguments;if(arguments.length>0&&typeof G=="function")return q.apply(this,arguments);if(q.length===0&&(arguments.length===0||typeof G!="function"))return q.apply(this,[]);const re=function(ce){const oe={};return ce.result().forEach(de=>{const Ee={id:de.id,timestamp:de.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[de.type]||de.type};de.names().forEach(Ae=>{Ee[Ae]=de.stat(Ae)}),oe[Ee.id]=Ee}),oe},Y=function(ce){return new Map(Object.keys(ce).map(oe=>[oe,ce[oe]]))};if(arguments.length>=2){const ce=function(oe){J(Y(re(oe)))};return q.apply(this,[ce,G])}return new Promise((ce,oe)=>{q.apply(this,[function(de){ce(Y(re(de)))},oe])}).then(J,X)}}function N(F){if(!(typeof F=="object"&&F.RTCPeerConnection&&F.RTCRtpSender&&F.RTCRtpReceiver))return;if(!("getStats"in F.RTCRtpSender.prototype)){const G=F.RTCPeerConnection.prototype.getSenders;G&&(F.RTCPeerConnection.prototype.getSenders=function(){const X=G.apply(this,[]);return X.forEach(re=>re._pc=this),X});const J=F.RTCPeerConnection.prototype.addTrack;J&&(F.RTCPeerConnection.prototype.addTrack=function(){const X=J.apply(this,arguments);return X._pc=this,X}),F.RTCRtpSender.prototype.getStats=function(){const X=this;return this._pc.getStats().then(re=>k(re,X.track,!0))}}if(!("getStats"in F.RTCRtpReceiver.prototype)){const G=F.RTCPeerConnection.prototype.getReceivers;G&&(F.RTCPeerConnection.prototype.getReceivers=function(){const J=G.apply(this,[]);return J.forEach(X=>X._pc=this),J}),l(F,"track",J=>(J.receiver._pc=J.srcElement,J)),F.RTCRtpReceiver.prototype.getStats=function(){const J=this;return this._pc.getStats().then(X=>k(X,J.track,!1))}}if(!("getStats"in F.RTCRtpSender.prototype)||!("getStats"in F.RTCRtpReceiver.prototype))return;const q=F.RTCPeerConnection.prototype.getStats;F.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof F.MediaStreamTrack){const G=arguments[0];let J,X,re;return this.getSenders().forEach(Y=>{Y.track===G&&(J?re=!0:J=Y)}),this.getReceivers().forEach(Y=>(Y.track===G&&(X?re=!0:X=Y),Y.track===G)),re||J&&X?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):J?J.getStats():X?X.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return q.apply(this,arguments)}}function P(F){F.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(re=>this._shimmedLocalStreams[re][0])};const q=F.RTCPeerConnection.prototype.addTrack;F.RTCPeerConnection.prototype.addTrack=function(re,Y){if(!Y)return q.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const ce=q.apply(this,arguments);return this._shimmedLocalStreams[Y.id]?this._shimmedLocalStreams[Y.id].indexOf(ce)===-1&&this._shimmedLocalStreams[Y.id].push(ce):this._shimmedLocalStreams[Y.id]=[Y,ce],ce};const G=F.RTCPeerConnection.prototype.addStream;F.RTCPeerConnection.prototype.addStream=function(re){this._shimmedLocalStreams=this._shimmedLocalStreams||{},re.getTracks().forEach(oe=>{if(this.getSenders().find(de=>de.track===oe))throw new DOMException("Track already exists.","InvalidAccessError")});const Y=this.getSenders();G.apply(this,arguments);const ce=this.getSenders().filter(oe=>Y.indexOf(oe)===-1);this._shimmedLocalStreams[re.id]=[re].concat(ce)};const J=F.RTCPeerConnection.prototype.removeStream;F.RTCPeerConnection.prototype.removeStream=function(re){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[re.id],J.apply(this,arguments)};const X=F.RTCPeerConnection.prototype.removeTrack;F.RTCPeerConnection.prototype.removeTrack=function(re){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},re&&Object.keys(this._shimmedLocalStreams).forEach(Y=>{const ce=this._shimmedLocalStreams[Y].indexOf(re);ce!==-1&&this._shimmedLocalStreams[Y].splice(ce,1),this._shimmedLocalStreams[Y].length===1&&delete this._shimmedLocalStreams[Y]}),X.apply(this,arguments)}}function I(F,q){if(!F.RTCPeerConnection)return;if(F.RTCPeerConnection.prototype.addTrack&&q.version>=65)return P(F);const G=F.RTCPeerConnection.prototype.getLocalStreams;F.RTCPeerConnection.prototype.getLocalStreams=function(){const oe=G.apply(this);return this._reverseStreams=this._reverseStreams||{},oe.map(de=>this._reverseStreams[de.id])};const J=F.RTCPeerConnection.prototype.addStream;F.RTCPeerConnection.prototype.addStream=function(oe){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},oe.getTracks().forEach(de=>{if(this.getSenders().find(Ee=>Ee.track===de))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[oe.id]){const de=new F.MediaStream(oe.getTracks());this._streams[oe.id]=de,this._reverseStreams[de.id]=oe,oe=de}J.apply(this,[oe])};const X=F.RTCPeerConnection.prototype.removeStream;function re(oe,de){let Ee=de.sdp;return Object.keys(oe._reverseStreams||[]).forEach(Ae=>{const Ke=oe._reverseStreams[Ae],Ir=oe._streams[Ke.id];Ee=Ee.replace(new RegExp(Ir.id,"g"),Ke.id)}),new RTCSessionDescription({type:de.type,sdp:Ee})}F.RTCPeerConnection.prototype.removeStream=function(oe){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},X.apply(this,[this._streams[oe.id]||oe]),delete this._reverseStreams[this._streams[oe.id]?this._streams[oe.id].id:oe.id],delete this._streams[oe.id]},F.RTCPeerConnection.prototype.addTrack=function(oe,de){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const Ee=[].slice.call(arguments,1);if(Ee.length!==1||!Ee[0].getTracks().find(Ke=>Ke===oe))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(Ke=>Ke.track===oe))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const Ae=this._streams[de.id];if(Ae)Ae.addTrack(oe),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const Ke=new F.MediaStream([oe]);this._streams[de.id]=Ke,this._reverseStreams[Ke.id]=de,this.addStream(Ke)}return this.getSenders().find(Ke=>Ke.track===oe)},["createOffer","createAnswer"].forEach(function(oe){const de=F.RTCPeerConnection.prototype[oe],Ee={[oe](){const Ae=arguments;return arguments.length&&typeof arguments[0]=="function"?de.apply(this,[Ke=>{const Ir=re(this,Ke);Ae[0].apply(null,[Ir])},Ke=>{Ae[1]&&Ae[1].apply(null,Ke)},arguments[2]]):de.apply(this,arguments).then(Ke=>re(this,Ke))}};F.RTCPeerConnection.prototype[oe]=Ee[oe]});const Y=F.RTCPeerConnection.prototype.setLocalDescription;F.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(oe,de){let Ee=de.sdp;return Object.keys(oe._reverseStreams||[]).forEach(Ae=>{const Ke=oe._reverseStreams[Ae],Ir=oe._streams[Ke.id];Ee=Ee.replace(new RegExp(Ke.id,"g"),Ir.id)}),new RTCSessionDescription({type:de.type,sdp:Ee})}(this,arguments[0]),Y.apply(this,arguments)):Y.apply(this,arguments)};const ce=Object.getOwnPropertyDescriptor(F.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(F.RTCPeerConnection.prototype,"localDescription",{get(){const oe=ce.get.apply(this);return oe.type===""?oe:re(this,oe)}}),F.RTCPeerConnection.prototype.removeTrack=function(oe){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!oe._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(oe._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let de;this._streams=this._streams||{},Object.keys(this._streams).forEach(Ee=>{this._streams[Ee].getTracks().find(Ae=>oe.track===Ae)&&(de=this._streams[Ee])}),de&&(de.getTracks().length===1?this.removeStream(this._reverseStreams[de.id]):de.removeTrack(oe.track),this.dispatchEvent(new Event("negotiationneeded")))}}function L(F,q){!F.RTCPeerConnection&&F.webkitRTCPeerConnection&&(F.RTCPeerConnection=F.webkitRTCPeerConnection),F.RTCPeerConnection&&q.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(G){const J=F.RTCPeerConnection.prototype[G],X={[G](){return arguments[0]=new(G==="addIceCandidate"?F.RTCIceCandidate:F.RTCSessionDescription)(arguments[0]),J.apply(this,arguments)}};F.RTCPeerConnection.prototype[G]=X[G]})}function W(F,q){l(F,"negotiationneeded",G=>{const J=G.target;if(!(q.version<72||J.getConfiguration&&J.getConfiguration().sdpSemantics==="plan-b")||J.signalingState==="stable")return G})}var U=a(6677),x=a.n(U);function V(F){const q=F&&F.navigator,G=q.mediaDevices.getUserMedia.bind(q.mediaDevices);q.mediaDevices.getUserMedia=function(J){return G(J).catch(X=>Promise.reject(function(re){return{name:{PermissionDeniedError:"NotAllowedError"}[re.name]||re.name,message:re.message,constraint:re.constraint,toString(){return this.name}}}(X)))}}function j(F){"getDisplayMedia"in F.navigator&&F.navigator.mediaDevices&&(F.navigator.mediaDevices&&"getDisplayMedia"in F.navigator.mediaDevices||(F.navigator.mediaDevices.getDisplayMedia=F.navigator.getDisplayMedia.bind(F.navigator)))}function H(F,q){if(F.RTCIceGatherer&&(F.RTCIceCandidate||(F.RTCIceCandidate=function(J){return J}),F.RTCSessionDescription||(F.RTCSessionDescription=function(J){return J}),q.version<15025)){const J=Object.getOwnPropertyDescriptor(F.MediaStreamTrack.prototype,"enabled");Object.defineProperty(F.MediaStreamTrack.prototype,"enabled",{set(X){J.set.call(this,X);const re=new Event("enabled");re.enabled=X,this.dispatchEvent(re)}})}F.RTCRtpSender&&!("dtmf"in F.RTCRtpSender.prototype)&&Object.defineProperty(F.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new F.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),F.RTCDtmfSender&&!F.RTCDTMFSender&&(F.RTCDTMFSender=F.RTCDtmfSender);const G=x()(F,q.version);F.RTCPeerConnection=function(J){return J&&J.iceServers&&(J.iceServers=function(X){let re=!1;return(X=JSON.parse(JSON.stringify(X))).filter(Y=>{if(Y&&(Y.urls||Y.url)){let ce=Y.urls||Y.url;Y.url&&!Y.urls&&g("RTCIceServer.url","RTCIceServer.urls");const oe=typeof ce=="string";return oe&&(ce=[ce]),ce=ce.filter(de=>{if(de.indexOf("stun:")===0)return!1;const Ee=de.startsWith("turn")&&!de.startsWith("turn:[")&&de.includes("transport=udp");return Ee&&!re?(re=!0,!0):Ee&&!re}),delete Y.url,Y.urls=oe?ce[0]:ce,!!ce.length}})}(J.iceServers,q.version),v("ICE servers after filtering:",J.iceServers)),new G(J)},F.RTCPeerConnection.prototype=G.prototype}function z(F){F.RTCRtpSender&&!("replaceTrack"in F.RTCRtpSender.prototype)&&(F.RTCRtpSender.prototype.replaceTrack=F.RTCRtpSender.prototype.setTrack)}function K(F,q){const G=F&&F.navigator,J=F&&F.MediaStreamTrack;if(G.getUserMedia=function(X,re,Y){g("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),G.mediaDevices.getUserMedia(X).then(re,Y)},!(q.version>55&&"autoGainControl"in G.mediaDevices.getSupportedConstraints())){const X=function(Y,ce,oe){ce in Y&&!(oe in Y)&&(Y[oe]=Y[ce],delete Y[ce])},re=G.mediaDevices.getUserMedia.bind(G.mediaDevices);if(G.mediaDevices.getUserMedia=function(Y){return typeof Y=="object"&&typeof Y.audio=="object"&&(Y=JSON.parse(JSON.stringify(Y)),X(Y.audio,"autoGainControl","mozAutoGainControl"),X(Y.audio,"noiseSuppression","mozNoiseSuppression")),re(Y)},J&&J.prototype.getSettings){const Y=J.prototype.getSettings;J.prototype.getSettings=function(){const ce=Y.apply(this,arguments);return X(ce,"mozAutoGainControl","autoGainControl"),X(ce,"mozNoiseSuppression","noiseSuppression"),ce}}if(J&&J.prototype.applyConstraints){const Y=J.prototype.applyConstraints;J.prototype.applyConstraints=function(ce){return this.kind==="audio"&&typeof ce=="object"&&(ce=JSON.parse(JSON.stringify(ce)),X(ce,"autoGainControl","mozAutoGainControl"),X(ce,"noiseSuppression","mozNoiseSuppression")),Y.apply(this,[ce])}}}}function $(F,q){F.navigator.mediaDevices&&"getDisplayMedia"in F.navigator.mediaDevices||F.navigator.mediaDevices&&(F.navigator.mediaDevices.getDisplayMedia=function(G){if(!G||!G.video){const J=new DOMException("getDisplayMedia without video constraints is undefined");return J.name="NotFoundError",J.code=8,Promise.reject(J)}return G.video===!0?G.video={mediaSource:q}:G.video.mediaSource=q,F.navigator.mediaDevices.getUserMedia(G)})}function Z(F){typeof F=="object"&&F.RTCTrackEvent&&"receiver"in F.RTCTrackEvent.prototype&&!("transceiver"in F.RTCTrackEvent.prototype)&&Object.defineProperty(F.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ne(F,q){if(typeof F!="object"||!F.RTCPeerConnection&&!F.mozRTCPeerConnection)return;!F.RTCPeerConnection&&F.mozRTCPeerConnection&&(F.RTCPeerConnection=F.mozRTCPeerConnection),q.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(X){const re=F.RTCPeerConnection.prototype[X],Y={[X](){return arguments[0]=new(X==="addIceCandidate"?F.RTCIceCandidate:F.RTCSessionDescription)(arguments[0]),re.apply(this,arguments)}};F.RTCPeerConnection.prototype[X]=Y[X]});const G={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},J=F.RTCPeerConnection.prototype.getStats;F.RTCPeerConnection.prototype.getStats=function(){const[X,re,Y]=arguments;return J.apply(this,[X||null]).then(ce=>{if(q.version<53&&!re)try{ce.forEach(oe=>{oe.type=G[oe.type]||oe.type})}catch(oe){if(oe.name!=="TypeError")throw oe;ce.forEach((de,Ee)=>{ce.set(Ee,Object.assign({},de,{type:G[de.type]||de.type}))})}return ce}).then(re,Y)}}function te(F){if(typeof F!="object"||!F.RTCPeerConnection||!F.RTCRtpSender||F.RTCRtpSender&&"getStats"in F.RTCRtpSender.prototype)return;const q=F.RTCPeerConnection.prototype.getSenders;q&&(F.RTCPeerConnection.prototype.getSenders=function(){const J=q.apply(this,[]);return J.forEach(X=>X._pc=this),J});const G=F.RTCPeerConnection.prototype.addTrack;G&&(F.RTCPeerConnection.prototype.addTrack=function(){const J=G.apply(this,arguments);return J._pc=this,J}),F.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function ae(F){if(typeof F!="object"||!F.RTCPeerConnection||!F.RTCRtpSender||F.RTCRtpSender&&"getStats"in F.RTCRtpReceiver.prototype)return;const q=F.RTCPeerConnection.prototype.getReceivers;q&&(F.RTCPeerConnection.prototype.getReceivers=function(){const G=q.apply(this,[]);return G.forEach(J=>J._pc=this),G}),l(F,"track",G=>(G.receiver._pc=G.srcElement,G)),F.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function le(F){F.RTCPeerConnection&&!("removeStream"in F.RTCPeerConnection.prototype)&&(F.RTCPeerConnection.prototype.removeStream=function(q){g("removeStream","removeTrack"),this.getSenders().forEach(G=>{G.track&&q.getTracks().includes(G.track)&&this.removeTrack(G)})})}function fe(F){F.DataChannel&&!F.RTCDataChannel&&(F.RTCDataChannel=F.DataChannel)}function ve(F){if(typeof F!="object"||!F.RTCPeerConnection)return;const q=F.RTCPeerConnection.prototype.addTransceiver;q&&(F.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const G=arguments[1],J=G&&"sendEncodings"in G;J&&G.sendEncodings.forEach(re=>{if("rid"in re&&!/^[a-z0-9]{0,16}$/i.test(re.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in re&&!(parseFloat(re.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in re&&!(parseFloat(re.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const X=q.apply(this,arguments);if(J){const{sender:re}=X,Y=re.getParameters();(!("encodings"in Y)||Y.encodings.length===1&&Object.keys(Y.encodings[0]).length===0)&&(Y.encodings=G.sendEncodings,re.sendEncodings=G.sendEncodings,this.setParametersPromises.push(re.setParameters(Y).then(()=>{delete re.sendEncodings}).catch(()=>{delete re.sendEncodings})))}return X})}function Se(F){if(typeof F!="object"||!F.RTCRtpSender)return;const q=F.RTCRtpSender.prototype.getParameters;q&&(F.RTCRtpSender.prototype.getParameters=function(){const G=q.apply(this,arguments);return"encodings"in G||(G.encodings=[].concat(this.sendEncodings||[{}])),G})}function be(F){if(typeof F!="object"||!F.RTCPeerConnection)return;const q=F.RTCPeerConnection.prototype.createOffer;F.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>q.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):q.apply(this,arguments)}}function Me(F){if(typeof F!="object"||!F.RTCPeerConnection)return;const q=F.RTCPeerConnection.prototype.createAnswer;F.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>q.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):q.apply(this,arguments)}}function _e(F){if(typeof F=="object"&&F.RTCPeerConnection){if("getLocalStreams"in F.RTCPeerConnection.prototype||(F.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in F.RTCPeerConnection.prototype)){const q=F.RTCPeerConnection.prototype.addTrack;F.RTCPeerConnection.prototype.addStream=function(G){this._localStreams||(this._localStreams=[]),this._localStreams.includes(G)||this._localStreams.push(G),G.getAudioTracks().forEach(J=>q.call(this,J,G)),G.getVideoTracks().forEach(J=>q.call(this,J,G))},F.RTCPeerConnection.prototype.addTrack=function(G,...J){return J&&J.forEach(X=>{this._localStreams?this._localStreams.includes(X)||this._localStreams.push(X):this._localStreams=[X]}),q.apply(this,arguments)}}"removeStream"in F.RTCPeerConnection.prototype||(F.RTCPeerConnection.prototype.removeStream=function(q){this._localStreams||(this._localStreams=[]);const G=this._localStreams.indexOf(q);if(G===-1)return;this._localStreams.splice(G,1);const J=q.getTracks();this.getSenders().forEach(X=>{J.includes(X.track)&&this.removeTrack(X)})})}}function ke(F){if(typeof F=="object"&&F.RTCPeerConnection&&("getRemoteStreams"in F.RTCPeerConnection.prototype||(F.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in F.RTCPeerConnection.prototype))){Object.defineProperty(F.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(G){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=G),this.addEventListener("track",this._onaddstreampoly=J=>{J.streams.forEach(X=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(X))return;this._remoteStreams.push(X);const re=new Event("addstream");re.stream=X,this.dispatchEvent(re)})})}});const q=F.RTCPeerConnection.prototype.setRemoteDescription;F.RTCPeerConnection.prototype.setRemoteDescription=function(){const G=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(J){J.streams.forEach(X=>{if(G._remoteStreams||(G._remoteStreams=[]),G._remoteStreams.indexOf(X)>=0)return;G._remoteStreams.push(X);const re=new Event("addstream");re.stream=X,G.dispatchEvent(re)})}),q.apply(G,arguments)}}}function Pe(F){if(typeof F!="object"||!F.RTCPeerConnection)return;const q=F.RTCPeerConnection.prototype,G=q.createOffer,J=q.createAnswer,X=q.setLocalDescription,re=q.setRemoteDescription,Y=q.addIceCandidate;q.createOffer=function(oe,de){const Ee=arguments.length>=2?arguments[2]:arguments[0],Ae=G.apply(this,[Ee]);return de?(Ae.then(oe,de),Promise.resolve()):Ae},q.createAnswer=function(oe,de){const Ee=arguments.length>=2?arguments[2]:arguments[0],Ae=J.apply(this,[Ee]);return de?(Ae.then(oe,de),Promise.resolve()):Ae};let ce=function(oe,de,Ee){const Ae=X.apply(this,[oe]);return Ee?(Ae.then(de,Ee),Promise.resolve()):Ae};q.setLocalDescription=ce,ce=function(oe,de,Ee){const Ae=re.apply(this,[oe]);return Ee?(Ae.then(de,Ee),Promise.resolve()):Ae},q.setRemoteDescription=ce,ce=function(oe,de,Ee){const Ae=Y.apply(this,[oe]);return Ee?(Ae.then(de,Ee),Promise.resolve()):Ae},q.addIceCandidate=ce}function Le(F){const q=F&&F.navigator;if(q.mediaDevices&&q.mediaDevices.getUserMedia){const G=q.mediaDevices,J=G.getUserMedia.bind(G);q.mediaDevices.getUserMedia=X=>J(Qe(X))}!q.getUserMedia&&q.mediaDevices&&q.mediaDevices.getUserMedia&&(q.getUserMedia=(function(G,J,X){q.mediaDevices.getUserMedia(G).then(J,X)}).bind(q))}function Qe(F){return F&&F.video!==void 0?Object.assign({},F,{video:_(F.video)}):F}function Ge(F){if(!F.RTCPeerConnection)return;const q=F.RTCPeerConnection;F.RTCPeerConnection=function(G,J){if(G&&G.iceServers){const X=[];for(let re=0;re<G.iceServers.length;re++){let Y=G.iceServers[re];!Y.hasOwnProperty("urls")&&Y.hasOwnProperty("url")?(g("RTCIceServer.url","RTCIceServer.urls"),Y=JSON.parse(JSON.stringify(Y)),Y.urls=Y.url,delete Y.url,X.push(Y)):X.push(G.iceServers[re])}G.iceServers=X}return new q(G,J)},F.RTCPeerConnection.prototype=q.prototype,"generateCertificate"in q&&Object.defineProperty(F.RTCPeerConnection,"generateCertificate",{get:()=>q.generateCertificate})}function rt(F){typeof F=="object"&&F.RTCTrackEvent&&"receiver"in F.RTCTrackEvent.prototype&&!("transceiver"in F.RTCTrackEvent.prototype)&&Object.defineProperty(F.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Xe(F){const q=F.RTCPeerConnection.prototype.createOffer;F.RTCPeerConnection.prototype.createOffer=function(G){if(G){G.offerToReceiveAudio!==void 0&&(G.offerToReceiveAudio=!!G.offerToReceiveAudio);const J=this.getTransceivers().find(re=>re.receiver.track.kind==="audio");G.offerToReceiveAudio===!1&&J?J.direction==="sendrecv"?J.setDirection?J.setDirection("sendonly"):J.direction="sendonly":J.direction==="recvonly"&&(J.setDirection?J.setDirection("inactive"):J.direction="inactive"):G.offerToReceiveAudio!==!0||J||this.addTransceiver("audio"),G.offerToReceiveVideo!==void 0&&(G.offerToReceiveVideo=!!G.offerToReceiveVideo);const X=this.getTransceivers().find(re=>re.receiver.track.kind==="video");G.offerToReceiveVideo===!1&&X?X.direction==="sendrecv"?X.setDirection?X.setDirection("sendonly"):X.direction="sendonly":X.direction==="recvonly"&&(X.setDirection?X.setDirection("inactive"):X.direction="inactive"):G.offerToReceiveVideo!==!0||X||this.addTransceiver("video")}return q.apply(this,arguments)}}function at(F){typeof F!="object"||F.AudioContext||(F.AudioContext=F.webkitAudioContext)}var Jt=a(7963),jt=a.n(Jt);function It(F){if(!F.RTCIceCandidate||F.RTCIceCandidate&&"foundation"in F.RTCIceCandidate.prototype)return;const q=F.RTCIceCandidate;F.RTCIceCandidate=function(G){if(typeof G=="object"&&G.candidate&&G.candidate.indexOf("a=")===0&&((G=JSON.parse(JSON.stringify(G))).candidate=G.candidate.substr(2)),G.candidate&&G.candidate.length){const J=new q(G),X=jt().parseCandidate(G.candidate),re=Object.assign(J,X);return re.toJSON=function(){return{candidate:re.candidate,sdpMid:re.sdpMid,sdpMLineIndex:re.sdpMLineIndex,usernameFragment:re.usernameFragment}},re}return new q(G)},F.RTCIceCandidate.prototype=q.prototype,l(F,"icecandidate",G=>(G.candidate&&Object.defineProperty(G,"candidate",{value:new F.RTCIceCandidate(G.candidate),writable:"false"}),G))}function ot(F,q){if(!F.RTCPeerConnection)return;"sctp"in F.RTCPeerConnection.prototype||Object.defineProperty(F.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const G=F.RTCPeerConnection.prototype.setRemoteDescription;F.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,q.browser==="chrome"&&q.version>=76){const{sdpSemantics:J}=this.getConfiguration();J==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(function(J){if(!J||!J.sdp)return!1;const X=jt().splitSections(J.sdp);return X.shift(),X.some(re=>{const Y=jt().parseMLine(re);return Y&&Y.kind==="application"&&Y.protocol.indexOf("SCTP")!==-1})}(arguments[0])){const J=function(oe){const de=oe.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(de===null||de.length<2)return-1;const Ee=parseInt(de[1],10);return Ee!=Ee?-1:Ee}(arguments[0]),X=function(oe){let de=65536;return q.browser==="firefox"&&(de=q.version<57?oe===-1?16384:2147483637:q.version<60?q.version===57?65535:65536:2147483637),de}(J),re=function(oe,de){let Ee=65536;q.browser==="firefox"&&q.version===57&&(Ee=65535);const Ae=jt().matchPrefix(oe.sdp,"a=max-message-size:");return Ae.length>0?Ee=parseInt(Ae[0].substr(19),10):q.browser==="firefox"&&de!==-1&&(Ee=2147483637),Ee}(arguments[0],J);let Y;Y=X===0&&re===0?Number.POSITIVE_INFINITY:X===0||re===0?Math.max(X,re):Math.min(X,re);const ce={};Object.defineProperty(ce,"maxMessageSize",{get:()=>Y}),this._sctp=ce}return G.apply(this,arguments)}}function Et(F){if(!F.RTCPeerConnection||!("createDataChannel"in F.RTCPeerConnection.prototype))return;function q(J,X){const re=J.send;J.send=function(){const Y=arguments[0],ce=Y.length||Y.size||Y.byteLength;if(J.readyState==="open"&&X.sctp&&ce>X.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+X.sctp.maxMessageSize+" bytes)");return re.apply(J,arguments)}}const G=F.RTCPeerConnection.prototype.createDataChannel;F.RTCPeerConnection.prototype.createDataChannel=function(){const J=G.apply(this,arguments);return q(J,this),J},l(F,"datachannel",J=>(q(J.channel,J.target),J))}function nt(F){if(!F.RTCPeerConnection||"connectionState"in F.RTCPeerConnection.prototype)return;const q=F.RTCPeerConnection.prototype;Object.defineProperty(q,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(q,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(G){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),G&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=G)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(G=>{const J=q[G];q[G]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=X=>{const re=X.target;if(re._lastConnectionState!==re.connectionState){re._lastConnectionState=re.connectionState;const Y=new Event("connectionstatechange",X);re.dispatchEvent(Y)}return X},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),J.apply(this,arguments)}})}function Ie(F,q){if(!F.RTCPeerConnection||q.browser==="chrome"&&q.version>=71||q.browser==="safari"&&q.version>=605)return;const G=F.RTCPeerConnection.prototype.setRemoteDescription;F.RTCPeerConnection.prototype.setRemoteDescription=function(J){if(J&&J.sdp&&J.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const X=J.sdp.split(`
`).filter(re=>re.trim()!=="a=extmap-allow-mixed").join(`
`);F.RTCSessionDescription&&J instanceof F.RTCSessionDescription?arguments[0]=new F.RTCSessionDescription({type:J.type,sdp:X}):J.sdp=X}return G.apply(this,arguments)}}function Te(F,q){if(!F.RTCPeerConnection||!F.RTCPeerConnection.prototype)return;const G=F.RTCPeerConnection.prototype.addIceCandidate;G&&G.length!==0&&(F.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(q.browser==="chrome"&&q.version<78||q.browser==="firefox"&&q.version<68||q.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():G.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}const $e=function({window:F}={},q={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const G=v,J=function(re){const Y={browser:null,version:null};if(re===void 0||!re.navigator)return Y.browser="Not a browser.",Y;const{navigator:ce}=re;if(ce.mozGetUserMedia)Y.browser="firefox",Y.version=S(ce.userAgent,/Firefox\/(\d+)\./,1);else if(ce.webkitGetUserMedia||re.isSecureContext===!1&&re.webkitRTCPeerConnection&&!re.RTCIceGatherer)Y.browser="chrome",Y.version=S(ce.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(ce.mediaDevices&&ce.userAgent.match(/Edge\/(\d+).(\d+)$/))Y.browser="edge",Y.version=S(ce.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!re.RTCPeerConnection||!ce.userAgent.match(/AppleWebKit\/(\d+)\./))return Y.browser="Not a supported browser.",Y;Y.browser="safari",Y.version=S(ce.userAgent,/AppleWebKit\/(\d+)\./,1),Y.supportsUnifiedPlan=re.RTCRtpTransceiver&&"currentDirection"in re.RTCRtpTransceiver.prototype}return Y}(F),X={browserDetails:J,commonShim:m,extractVersion:S,disableLog:h,disableWarnings:p};switch(J.browser){case"chrome":if(!c||!L||!q.shimChrome)return G("Chrome shim is not included in this adapter release."),X;if(J.version===null)return G("Chrome shim can not determine version, not shimming."),X;G("adapter.js shimming chrome."),X.browserShim=c,Te(F,J),C(F,J),A(F),L(F,J),T(F),I(F,J),M(F),D(F),N(F),W(F,J),It(F),nt(F),ot(F,J),Et(F),Ie(F,J);break;case"firefox":if(!d||!ne||!q.shimFirefox)return G("Firefox shim is not included in this adapter release."),X;G("adapter.js shimming firefox."),X.browserShim=d,Te(F,J),K(F,J),ne(F,J),Z(F),le(F),te(F),ae(F),fe(F),ve(F),Se(F),be(F),Me(F),It(F),nt(F),ot(F,J),Et(F);break;case"edge":if(!u||!H||!q.shimEdge)return G("MS edge shim is not included in this adapter release."),X;G("adapter.js shimming edge."),X.browserShim=u,V(F),j(F),H(F,J),z(F),ot(F,J),Et(F);break;case"safari":if(!E||!q.shimSafari)return G("Safari shim is not included in this adapter release."),X;G("adapter.js shimming safari."),X.browserShim=E,Te(F,J),Ge(F),Xe(F),Pe(F),_e(F),ke(F),rt(F),Le(F),at(F),It(F),ot(F,J),Et(F),Ie(F,J);break;default:G("Unsupported browser!")}return X}({window:typeof window>"u"?void 0:window}),Rt=$e},6834:(o,s,a)=>{a.r(s),a.d(s,{default:()=>d});var c=a(5512),u=a.n(c);function d(){return u()('/*! aliyun rts sdk - ver2.9.3-beta.0 created:11/27/2024, 4:54:08 PM */(()=>{"use strict";var e={917:(e,r)=>{var t,n,a,o;Object.defineProperty(r,"__esModule",{value:!0}),r.DEFAULT_RETRY_PUBLISH_INTERVAL=r.DEFAULT_RETRY_SUBSCRIBE_INTERVAL=r.DEFAULT_RETRY_PUBLISH_LIMIT=r.DEFAULT_RETRY_SUBSCRIBE_LIMIT=r.EWorkerAction=r.EWorkerSource=r.EConnectStatus=r.TrackType=void 0,function(e){e.AUDIO="audio",e.VIDEO="video"}(t||(r.TrackType=t={})),function(e){e[e.CONNECT_STATUS_DISCONNECTED=0]="CONNECT_STATUS_DISCONNECTED",e[e.CONNECT_STATUS_CONNECTING=1]="CONNECT_STATUS_CONNECTING",e[e.CONNECT_STATUS_CONNECTED=2]="CONNECT_STATUS_CONNECTED",e[e.CONNECT_STATUS_RECONNECTING=3]="CONNECT_STATUS_RECONNECTING"}(n||(r.EConnectStatus=n={})),function(e){e.Sender="sender",e.Receiver="receiver"}(a||(r.EWorkerSource=a={})),function(e){e.Setup="setup",e.InserSEI="insertSEI"}(o||(r.EWorkerAction=o={})),r.DEFAULT_RETRY_SUBSCRIBE_LIMIT=5,r.DEFAULT_RETRY_PUBLISH_LIMIT=5,r.DEFAULT_RETRY_SUBSCRIBE_INTERVAL=2e3,r.DEFAULT_RETRY_PUBLISH_INTERVAL=2e3},594:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.readUUID=r.discardEPB=r.insertEPB=r.SODBtoRBSP=r.convertPayloadSize=r.NALU=r.SEI=r.parseSei=r.insertSei=void 0;r.insertSei=function(e,r,a,o){void 0===a&&(a=5);for(var i=e.data,u=new DataView(i),c=0;;){if(1===u.getUint32(c)){u.getUint8(c+4);var f=new t(r,a,o).buffer,s=new n(f).buffer,T=new ArrayBuffer(s.byteLength+i.byteLength),d=new Uint8Array(T),l=new Uint8Array(s);d.set(l);var E=new Uint8Array(i);d.set(E,s.byteLength),e.data=T,c+=1;break}if((c+=1)+4>=u.byteLength)break}};r.parseSei=function(e){for(var t=[],n=new DataView(e),a=0;;){var o=a,i=n.getUint32(o);if(o+=4,1===i){if(6===(31&n.getUint8(o++))){for(var u=n.getUint8(o++),c=5===u?16:0,f=0;255==n.getUint8(o);)o++,f+=255;if((f+=n.getUint8(o++))>0&&n.byteLength>o+f){var s=new Uint8Array(n.buffer),T="";if(5===u){var d=s.slice(o,o+c);T=(0,r.readUUID)((0,r.discardEPB)(d))}var l=s.slice(o+c,o+f);o+=f,t.push({payloadType:u,uuid:T,data:l.buffer})}}a=o}else a+=1;if(a+4>=n.byteLength)break}return t};var t=function(e,t,n){void 0===t&&(t=5);var a=5===t?16:0,o=e.byteLength+a,i=(0,r.convertPayloadSize)(o),u=i.buffer.byteLength,c=new ArrayBuffer(1+u+a+e.byteLength),f=new Uint8Array(c),s=0;if(f[s++]=t,f.set(i,s),s+=i.byteLength,5===t){n=(n||"00000000-0000-0000-0000-000000000000").replace(/-/g,"");for(var T=0;T<16;T++)f[s+T]=parseInt(n.substr(2*T,2),16);s+=16}var d=new Uint8Array(e);f.set(d,s);var l=(0,r.SODBtoRBSP)(f);this.buffer=l.buffer};r.SEI=t;var n=function(e){var r=new Uint8Array([0,0,0,1]),t=new Uint8Array([6]),n=new ArrayBuffer(r.byteLength+t.byteLength+e.byteLength),a=new Uint8Array(n);a.set(r),a.set(t,r.byteLength),a.set(new Uint8Array(e),r.byteLength+t.byteLength),this.buffer=n};r.NALU=n;r.convertPayloadSize=function(e){if(e<=0)throw new Error("payloadSize must be a positive integer.");for(var r=Math.ceil(e/255),t=new ArrayBuffer(r),n=new DataView(t),a=0;a<r-1;a++)n.setUint8(a,255);return n.setUint8(r-1,e%255&255),new Uint8Array(t)};r.SODBtoRBSP=function(e){for(var t=new Uint8Array(e),n="",a=0;a<t.length;a++)n+=t[a].toString(2).padStart(8,"0");for(n+="1";n.length%8!=0;)n+="0";var o=n.length/8,i=new Uint8Array(o);for(a=0;a<o;a++)i[a]=parseInt(n.slice(8*a,8*a+8),2);return(0,r.insertEPB)(i)};r.insertEPB=function(e){for(var r=[],t=0,n=0;n<e.length;n++)r.push(e[n]),0===e[n]?2===++t&&n<e.length-1&&e[n+1]<=3&&(r.push(3),t=0):t=0;return new Uint8Array(r)};r.discardEPB=function(e){for(var r=e.byteLength,t=[],n=1;n<r-2;)0===e[n]&&0===e[n+1]&&3===e[n+2]?(t.push(n+2),n+=2):n++;if(0===t.length)return e;var a=r-t.length,o=new Uint8Array(a),i=0;for(n=0;n<a;i++,n++)i===t[0]&&(i++,t.shift()),o[n]=e[i];return o};r.readUUID=function(e){if(16!==e.length)throw new Error("UUID must be 16 bytes long.");var r=e.reduce((function(e,r){return e+r.toString(16).padStart(2,"0")}),"");return"".concat(r.slice(0,8),"-").concat(r.slice(8,12),"-").concat(r.slice(12,16),"-").concat(r.slice(16,20),"-").concat(r.slice(20))}},718:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.createUUID=r.evaluateNetworkCondition=r.makeCancelable=r.hasVideoTrack=r.hasAudioTrack=r.getVideoTrack=r.getAudioTrack=r.pruneSubUrl=r.getJitterBufferDelayAvg=void 0;r.getJitterBufferDelayAvg=function(e,r){return e&&r?Number(e)/Number(r)*1e3:-1};r.pruneSubUrl=function(e,r){var t=e||"";return t=t.replace("@subaudio=no","").replace("@subvideo=no",""),r&&(t=t.split("?")[0]),t};r.getAudioTrack=function(e){return e.getAudioTracks()[0]};r.getVideoTrack=function(e){return e.getVideoTracks()[0]};r.hasAudioTrack=function(e){return e.getAudioTracks().length>0};r.hasVideoTrack=function(e){return e.getVideoTracks().length>0};r.makeCancelable=function(e){var r=!1;return{promise:new Promise((function(t,n){e.then((function(e){return r?n({isCanceled:!0}):t(e)})),e.catch((function(e){return n(r?{isCanceled:!0}:e)}))})),cancel:function(){r=!0}}};r.evaluateNetworkCondition=function(e,r,t,n,a){var o=0;if(!navigator.onLine)return o=6;var i=[{loss:0,rtt:0,jbd:1},{loss:0,rtt:1,jbd:0},{loss:0,rtt:.5,jbd:.5},{loss:1,rtt:0,jbd:0},{loss:.8,rtt:0,jbd:.2},{loss:.8,rtt:.2,jbd:0},{loss:.6,rtt:.2,jbd:.2}],u=-1,c=-1,f=-1;if("number"==typeof r&&r>=0||"number"==typeof t&&t>=0){u=0;var s=!1,T=!1;"number"==typeof r&&r>=0&&(u+=r,s=!0),"number"==typeof t&&t>=0&&(u+=t,T=!0),s&&!T&&(u*=2),T&&!s&&(u*=1.8)}if("number"==typeof e&&e>=0&&(f=e),"number"==typeof n&&n>=0||"number"==typeof a&&a>=0){c=0;"number"==typeof n&&n>=0&&(c+=n),"number"==typeof a&&a>=0&&(c+=a)}var d;if((d=4*(-1!==u?1:0)+2*(-1!==f?1:0)+(-1!==c?1:0))>0){var l=1.2*u*i[d-1].loss+f/1500*i[d-1].rtt+c/3e3*i[d-1].jbd;o=l<=.1?1:l<=.23?2:l<=.36?3:l<=.49?4:5}else o=0;return o};r.createUUID=function(e,r){var t,n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),a=[];if(r=r||n.length,e)for(t=0;t<e;t++)a[t]=n[0|Math.random()*r];else{var o=void 0;for(a[8]=a[13]=a[18]=a[23]="-",a[14]="4",t=0;t<36;t++)a[t]||(o=0|16*Math.random(),a[t]=n[19==t?3&o|8:o])}return a.join("")}}},r={};function t(n){var a=r[n];if(void 0!==a)return a.exports;var o=r[n]={exports:{}};return e[n](o,o.exports,t),o.exports}var n,a,o,i,u,c,f;a=t(594),o=t(718),i=t(917),u=self,c=function(e,r,t,o){if(e===i.EWorkerSource.Sender){var u=new TransformStream({transform:function(e,r){e.type&&(n&&((0,a.insertSei)(e,n.sei,n.payloadType,n.uuid),void 0===n.repeatCount?n=null:-1!==n.repeatCount&&(n.repeatCount--,n.repeatCount<0&&(n=null))),o&&o(e)),r.enqueue(e)}});r.pipeThrough(u).pipeTo(t)}else e===i.EWorkerSource.Receiver&&(u=new TransformStream({transform:function(e,r){e.type&&o&&o(e),r.enqueue(e)}}),r.pipeThrough(u).pipeTo(t))},f=function(e){var r=e.data.slice(0);u.postMessage({type:"encodedFrame",data:r,frameInfo:{type:e.type,timestamp:e.timestamp}},[r]),r=null},u.RTCTransformEvent&&(u.onrtctransform=function(e){var r=e.transformer,t=r.options.source,n=r.readable,a=r.writable;c(t,n,a,(function(e){t===i.EWorkerSource.Receiver&&f(e)}))}),onmessage=function(e){switch(e.data.operation){case i.EWorkerAction.Setup:r=e.data,t=r.source,a=r.readable,u=r.writable,c(t,a,u,(function(e){t===i.EWorkerSource.Receiver&&f(e)}));break;case i.EWorkerAction.InserSEI:!function(e){(n=e)&&(n.uuid=(0,o.createUUID)().toLowerCase(),n.repeatCount=n.repeatCount||0)}(e.data)}var r,t,a,u}})();',"Worker",void 0,void 0)}},5512:o=>{o.exports=function(s,a,c,u){var d=self||window;try{try{var E;try{E=new d.Blob([s])}catch{(E=new(d.BlobBuilder||d.WebKitBlobBuilder||d.MozBlobBuilder||d.MSBlobBuilder)).append(s),E=E.getBlob()}var m=d.URL||d.webkitURL,f=m.createObjectURL(E),y=new d[a](f,c);return m.revokeObjectURL(f),y}catch{return new d[a]("data:application/javascript,".concat(encodeURIComponent(s)),c)}}catch{if(!u)throw Error("Inline worker is not supported");return new d[a](u,c)}}},4450:o=>{var s;s=()=>(()=>{var a={692:E=>{var m=E.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(f){return f.encoding?"rtpmap:%d %s/%s/%s":f.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(f){return f.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(f){return f.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(f){return"extmap:%d"+(f.direction?"/%s":"%v")+(f["encrypt-uri"]?" %s":"%v")+" %s"+(f.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(f){return f.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(f){var y="candidate:%s %d %s %d %s %d typ %s";return y+=f.raddr!=null?" raddr %s rport %d":"%v%v",y+=f.tcptype!=null?" tcptype %s":"%v",f.generation!=null&&(y+=" generation %d"),(y+=f["network-id"]!=null?" network-id %d":"%v")+(f["network-cost"]!=null?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(f){var y="ssrc:%d";return f.attribute!=null&&(y+=" %s",f.value!=null&&(y+=":%s")),y}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(f){return f.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(f){return f.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(f){return"imageattr:%s %s %s"+(f.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(f){return"simulcast:%s %s"+(f.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(f){return"ts-refclk:%s"+(f.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(f){var y="mediaclk:";return y+=f.id!=null?"id=%s %s":"%v%s",y+=f.mediaClockValue!=null?"=%s":"",(y+=f.rateNumerator!=null?" rate=%s":"")+(f.rateDenominator!=null?"/%s":"")}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(m).forEach(function(f){m[f].forEach(function(y){y.reg||(y.reg=/(.*)/),y.format||(y.format="%s")})})},766:(E,m,f)=>{var y=f(962),S=f(627);m.write=S,m.parse=y.parse,m.parseParams=y.parseParams,m.parseFmtpConfig=y.parseFmtpConfig,m.parsePayloads=y.parsePayloads,m.parseRemoteCandidates=y.parseRemoteCandidates,m.parseImageAttributes=y.parseImageAttributes,m.parseSimulcastStreamList=y.parseSimulcastStreamList},962:(E,m,f)=>{var y=function(v){return String(Number(v))===v?Number(v):v},S=function(v,g,R){var _=v.name&&v.names;v.push&&!g[v.push]?g[v.push]=[]:_&&!g[v.name]&&(g[v.name]={});var w=v.push?{}:_?g[v.name]:g;(function(k,O,C,b){if(b&&!C)O[b]=y(k[1]);else for(var A=0;A<C.length;A+=1)k[A+1]!=null&&(O[C[A]]=y(k[A+1]))})(R.match(v.reg),w,v.names,v.name),v.push&&g[v.push].push(w)},l=f(692),h=RegExp.prototype.test.bind(/^([a-z])=(.*)/);m.parse=function(v){var g={},R=[],_=g;return v.split(/(\r\n|\r|\n)/).filter(h).forEach(function(w){var k=w[0],O=w.slice(2);k==="m"&&(R.push({rtp:[],fmtp:[]}),_=R[R.length-1]);for(var C=0;C<(l[k]||[]).length;C+=1){var b=l[k][C];if(b.reg.test(O))return S(b,_,O)}}),g.media=R,g};var p=function(v,g){var R=g.split(/=(.+)/,2);return R.length===2?v[R[0]]=y(R[1]):R.length===1&&g.length>1&&(v[R[0]]=void 0),v};m.parseParams=function(v){return v.split(/;\s?/).reduce(p,{})},m.parseFmtpConfig=m.parseParams,m.parsePayloads=function(v){return v.toString().split(" ").map(Number)},m.parseRemoteCandidates=function(v){for(var g=[],R=v.split(" ").map(y),_=0;_<R.length;_+=3)g.push({component:R[_],ip:R[_+1],port:R[_+2]});return g},m.parseImageAttributes=function(v){return v.split(" ").map(function(g){return g.substring(1,g.length-1).split(",").reduce(p,{})})},m.parseSimulcastStreamList=function(v){return v.split(";").map(function(g){return g.split(",").map(function(R){var _,w=!1;return R[0]!=="~"?_=y(R):(_=y(R.substring(1,R.length)),w=!0),{scid:_,paused:w}})})}},627:(E,m,f)=>{var y=f(692),S=/%[sdv%]/g,l=function(g){var R=1,_=arguments,w=_.length;return g.replace(S,function(k){if(R>=w)return k;var O=_[R];switch(R+=1,k){case"%%":return"%";case"%s":return String(O);case"%d":return Number(O);case"%v":return""}})},h=function(g,R,_){var w=[g+"="+(R.format instanceof Function?R.format(R.push?_:_[R.name]):R.format)];if(R.names)for(var k=0;k<R.names.length;k+=1){var O=R.names[k];R.name?w.push(_[R.name][O]):w.push(_[R.names[k]])}else w.push(_[R.name]);return l.apply(null,w)},p=["v","o","s","i","u","e","p","c","b","t","r","z","a"],v=["i","c","b","a"];E.exports=function(g,R){R=R||{},g.version==null&&(g.version=0),g.name==null&&(g.name=" "),g.media.forEach(function(O){O.payloads==null&&(O.payloads="")});var _=R.outerOrder||p,w=R.innerOrder||v,k=[];return _.forEach(function(O){y[O].forEach(function(C){C.name in g&&g[C.name]!=null?k.push(h(O,C,g)):C.push in g&&g[C.push]!=null&&g[C.push].forEach(function(b){k.push(h(O,C,b))})})}),g.media.forEach(function(O){k.push(h("m",y.m[0],O)),w.forEach(function(C){y[C].forEach(function(b){b.name in O&&O[b.name]!=null?k.push(h(C,b,O)):b.push in O&&O[b.push]!=null&&O[b.push].forEach(function(A){k.push(h(C,b,A))})})})}),k.join(`\r
`)+`\r
`}},776:function(E,m,f){var y,S=this&&this.__extends||(y=function(U,x){return y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(V,j){V.__proto__=j}||function(V,j){for(var H in j)Object.prototype.hasOwnProperty.call(j,H)&&(V[H]=j[H])},y(U,x)},function(U,x){if(typeof x!="function"&&x!==null)throw new TypeError("Class extends value "+String(x)+" is not a constructor or null");function V(){this.constructor=U}y(U,x),U.prototype=x===null?Object.create(x):(V.prototype=x.prototype,new V)}),l=this&&this.__assign||function(){return l=Object.assign||function(U){for(var x,V=1,j=arguments.length;V<j;V++)for(var H in x=arguments[V])Object.prototype.hasOwnProperty.call(x,H)&&(U[H]=x[H]);return U},l.apply(this,arguments)},h=this&&this.__awaiter||function(U,x,V,j){return new(V||(V=Promise))(function(H,z){function K(ne){try{Z(j.next(ne))}catch(te){z(te)}}function $(ne){try{Z(j.throw(ne))}catch(te){z(te)}}function Z(ne){var te;ne.done?H(ne.value):(te=ne.value,te instanceof V?te:new V(function(ae){ae(te)})).then(K,$)}Z((j=j.apply(U,x||[])).next())})},p=this&&this.__generator||function(U,x){var V,j,H,z,K={label:0,sent:function(){if(1&H[0])throw H[1];return H[1]},trys:[],ops:[]};return z={next:$(0),throw:$(1),return:$(2)},typeof Symbol=="function"&&(z[Symbol.iterator]=function(){return this}),z;function $(Z){return function(ne){return function(te){if(V)throw new TypeError("Generator is already executing.");for(;z&&(z=0,te[0]&&(K=0)),K;)try{if(V=1,j&&(H=2&te[0]?j.return:te[0]?j.throw||((H=j.return)&&H.call(j),0):j.next)&&!(H=H.call(j,te[1])).done)return H;switch(j=0,H&&(te=[2&te[0],H.value]),te[0]){case 0:case 1:H=te;break;case 4:return K.label++,{value:te[1],done:!1};case 5:K.label++,j=te[1],te=[0];continue;case 7:te=K.ops.pop(),K.trys.pop();continue;default:if(!((H=(H=K.trys).length>0&&H[H.length-1])||te[0]!==6&&te[0]!==2)){K=0;continue}if(te[0]===3&&(!H||te[1]>H[0]&&te[1]<H[3])){K.label=te[1];break}if(te[0]===6&&K.label<H[1]){K.label=H[1],H=te;break}if(H&&K.label<H[2]){K.label=H[2],K.ops.push(te);break}H[2]&&K.ops.pop(),K.trys.pop();continue}te=x.call(U,K)}catch(ae){te=[6,ae],j=0}finally{V=H=0}if(5&te[0])throw te[1];return{value:te[0]?te[1]:void 0,done:!0}}([Z,ne])}}},v=this&&this.__spreadArray||function(U,x,V){if(V||arguments.length===2)for(var j,H=0,z=x.length;H<z;H++)!j&&H in x||(j||(j=Array.prototype.slice.call(x,0,H)),j[H]=x[H]);return U.concat(j||Array.prototype.slice.call(x))},g=this&&this.__importDefault||function(U){return U&&U.__esModule?U:{default:U}};Object.defineProperty(m,"__esModule",{value:!0}),m.PeerConnectionCore=m.EDatachannelStatus=void 0;var R=f(887),_=f(248),w=f(237),k=f(619),O=f(628),C=f(961),b=f(844),A=f(651);Object.defineProperty(m,"EDatachannelStatus",{enumerable:!0,get:function(){return A.EDatachannelStatus}});var T,M=f(854),D=g(f(885)),N=f(132),P="rts video",I="rts audio";(function(U){U.SUB_ADD="subsribe add",U.SUB_DELETE="subscribe delete",U.SUB_ACTIVE="subscribe active",U.SUB_STOP="subscribe stop",U.PUB_ADD="publish add",U.PUB_DELETE="publish delete",U.PUB_REPLACE="publish replace",U.PUB_STOP="publish stop",U.DATACHANNEL_SUB_ADD="sub add datachannel",U.DATACHANNEL_SUB_ACTIVE="sub active datachannel",U.DATACHANNEL_SUB_STOP="sub delete datachannel",U.DATACHANNEL_PUB_ADD="pub add datachannel",U.DATACHANNEL_PUB_STOP="pub delete datachannel"})(T||(T={}));var L=function(U){function x(V){var j=U.call(this)||this;return j.PCCore=V,j}return S(x,U),x.prototype.excuteSignal=function(V,j,H,z){var K=this;switch(V){case T.SUB_ADD:this.PCCore.proceedSubscribeAdd(z.configList).then(function($){j($)}).catch(function($){H($)}).finally(function(){K.emit("onSignalDone")});break;case T.SUB_DELETE:this.PCCore.proceedSubscribeDeleteTracks(z.configList,z.skipError).then(function($){j($)}).catch(function($){H($)}).finally(function(){K.emit("onSignalDone")});break;case T.SUB_ACTIVE:break;case T.SUB_STOP:this.PCCore.proceedSubscribeStop(z.configList).then(function($){j($)}).catch(function($){H($)}).finally(function(){K.emit("onSignalDone")});break;case T.PUB_ADD:this.PCCore.proceedPublishAdd(z.configList).then(function($){j($)}).catch(function($){H($)}).finally(function(){K.emit("onSignalDone")});break;case T.PUB_REPLACE:this.PCCore.proceedPublishReplaceTracks(z.configList).then(function($){j($)}).catch(function($){H($)}).finally(function(){K.emit("onSignalDone")});break;case T.PUB_DELETE:this.PCCore.proceedPublishDeleteTracks(z.configList).then(function($){j($)}).catch(function($){H($)}).finally(function(){K.emit("onSignalDone")});break;case T.PUB_STOP:this.PCCore.proceedPublishStop(z.configList).then(function($){j($)}).catch(function($){H($)}).finally(function(){K.emit("onSignalDone")});break;case T.DATACHANNEL_SUB_ADD:this.PCCore.proceedSubscribeAddDatachannel(z.configList).then(function($){j($)}).catch(function($){H($)}).finally(function(){K.emit("onSignalDone")});break;case T.DATACHANNEL_SUB_STOP:this.PCCore.proceedSubscribeStopDatachannel(z.configList).then(function($){j($)}).catch(function($){H($)}).finally(function(){K.emit("onSignalDone")});break;case T.DATACHANNEL_PUB_ADD:this.PCCore.proceedPublishAddDatachannel(z.configList).then(function($){j($)}).catch(function($){H($)}).finally(function(){K.emit("onSignalDone")});break;case T.DATACHANNEL_PUB_STOP:this.PCCore.proceedPublishStopDatachannel(z.configList).then(function($){j($)}).catch(function($){H($)}).finally(function(){K.emit("onSignalDone")})}},x}(D.default),W=function(){function U(x){this.removeTwcc=!1,this.mutex=!1,this.eventQueue=new M.CacheBuffer("signal queue"),this.signalTimer=null,this.rollbackController=new N.PeerConnectionRollbackController(this),this.onInnerSubscribeDelete=function(){},this.receiverCodecPreferences={},this.senderCodecPreferences={},this.removeTrackListener=function(){},this.streamManager=new O.StreamManager,x.pc?(this.pc=x.pc,this.signal=new k.Signal({pc:x.pc,onDatachannelEvent:x.onDatachannelEvent}),this.onInnerSubscribeDelete=x.onInnerSubscribeDelete||function(){},this.offerSdpHook=x.offerSdpHook,this.answerSdpHook=x.answerSdpHook):console.error("peerconnetion is required")}return U.prototype.getStreamManager=function(){return this.streamManager},U.prototype.getSignal=function(){return this.signal},U.prototype.setPrevOfferSdp=function(x){this.prevOfferSdp=x},U.prototype.setPrevAnswerSdp=function(x){this.prevAnswerSdp=x},U.prototype.setStreamManager=function(x){this.streamManager=x},U.prototype.getTrackIds=function(x){return x.reduce(function(V,j){return v(v([],V,!0),[j.id],!1)},[])},U.prototype.setRemoveTwcc=function(x){this.removeTwcc=x},U.prototype.setReceiverCodecPreferences=function(x){this.receiverCodecPreferences=l({},x)},U.prototype.setSenderCodecPreferences=function(x){this.senderCodecPreferences=l({},x)},U.prototype.subscribeAdd=function(x){var V=this;return new Promise(function(j,H){var z=new L(V);if(V.mutex){var K={type:T.SUB_ADD,excuter:z,res:j,rej:H,data:{configList:x}};V.eventQueue.cache(K)}else V.atomSignalExec(T.SUB_ADD,z,j,H,{configList:x})})},U.prototype.subscribeDeleteTracks=function(x,V){var j=this;return new Promise(function(H,z){var K=new L(j);if(j.mutex){var $={type:T.SUB_DELETE,excuter:K,res:H,rej:z,data:{configList:x,skipError:V}};j.eventQueue.cache($)}else j.atomSignalExec(T.SUB_DELETE,K,H,z,{configList:x,skipError:V})})},U.prototype.subscribeStop=function(x){var V=this;return new Promise(function(j,H){var z=new L(V);if(V.mutex){var K={type:T.SUB_STOP,excuter:z,res:j,rej:H,data:{configList:x}};V.eventQueue.cache(K)}else V.atomSignalExec(T.SUB_STOP,z,j,H,{configList:x})})},U.prototype.publishAdd=function(x){var V=this;return new Promise(function(j,H){var z=new L(V);if(V.mutex){var K={type:T.PUB_ADD,excuter:z,res:j,rej:H,data:{configList:x}};V.eventQueue.cache(K)}else V.atomSignalExec(T.PUB_ADD,z,j,H,{configList:x})})},U.prototype.publishReplaceTracks=function(x){var V=this;return new Promise(function(j,H){var z=new L(V);if(V.mutex){var K={type:T.PUB_REPLACE,excuter:z,res:j,rej:H,data:{configList:x}};V.eventQueue.cache(K)}else V.atomSignalExec(T.PUB_REPLACE,z,j,H,{configList:x})})},U.prototype.publishDeleteTracks=function(x){var V=this;return new Promise(function(j,H){var z=new L(V);if(V.mutex){var K={type:T.PUB_DELETE,excuter:z,res:j,rej:H,data:{configList:x}};V.eventQueue.cache(K)}else V.atomSignalExec(T.PUB_DELETE,z,j,H,{configList:x})})},U.prototype.publishStop=function(x){var V=this;return new Promise(function(j,H){var z=new L(V);if(V.mutex){var K={type:T.PUB_STOP,excuter:z,res:j,rej:H,data:{configList:x}};V.eventQueue.cache(K)}else V.atomSignalExec(T.PUB_STOP,z,j,H,{configList:x})})},U.prototype.subscribeAddDatachannel=function(x){var V=this;return new Promise(function(j,H){var z=new L(V);if(V.mutex){var K={type:T.DATACHANNEL_SUB_ADD,excuter:z,res:j,rej:H,data:{configList:x}};V.eventQueue.cache(K)}else V.atomSignalExec(T.DATACHANNEL_SUB_ADD,z,j,H,{configList:x})})},U.prototype.subscribeStopDatachannel=function(x){var V=this;return new Promise(function(j,H){var z=new L(V);if(V.mutex){var K={type:T.DATACHANNEL_SUB_STOP,excuter:z,res:j,rej:H,data:{configList:x}};V.eventQueue.cache(K)}else V.atomSignalExec(T.DATACHANNEL_SUB_STOP,z,j,H,{configList:x})})},U.prototype.publishAddDatachannel=function(x){var V=this;return new Promise(function(j,H){var z=new L(V);if(V.mutex){var K={type:T.DATACHANNEL_PUB_ADD,excuter:z,res:j,rej:H,data:{configList:x}};V.eventQueue.cache(K)}else V.atomSignalExec(T.DATACHANNEL_PUB_ADD,z,j,H,{configList:x})})},U.prototype.publishStopDatachannel=function(x){var V=this;return new Promise(function(j,H){var z=new L(V);if(V.mutex){var K={type:T.DATACHANNEL_PUB_STOP,excuter:z,res:j,rej:H,data:{configList:x}};V.eventQueue.cache(K)}else V.atomSignalExec(T.DATACHANNEL_PUB_STOP,z,j,H,{configList:x})})},U.prototype.atomSignalExec=function(x,V,j,H,z){var K=this;this.mutex=!0,V.once("onSignalDone",function(){K.eventQueue.isEmpty()?K.mutex=!1:setTimeout(function(){var $=K.eventQueue.getFirst();K.atomSignalExec($.type,$.excuter,$.res,$.rej,$.data)})}),V.excuteSignal(x,j,H,z)},U.prototype.proceedSubscribeAdd=function(x){return h(this,void 0,void 0,function(){var V,j,H,z,K,$,Z,ne,te=this;return p(this,function(ae){switch(ae.label){case 0:if(this.log("SUB LIST: ",x),V=new Date().getTime(),j=new Date().getTime(),H=new Date().getTime(),z=this,K=this.extendUrl(x),$=K.map(function(le){var fe=le.urlData,ve=le.vMsid,Se=le.aMsid;if(te.streamManager.has(fe.url)){var be=te.streamManager.get(fe.url),Me=be.videoInfoList.map(function(Le){return Le.msid}),_e=be.audioInfoList.map(function(Le){return Le.msid}),ke=(0,R.intersection)(Me,ve),Pe=(0,R.intersection)(_e,Se);if(Pe.length||ke.length)return{url:fe.url,vMsid:ke,aMsid:Pe}}}).filter(function(le){return le}),this.log("DELETE LIST: ",$),!($!=null&&$.length))return[3,4];ae.label=1;case 1:return ae.trys.push([1,3,,4]),[4,this.proceedSubscribeDeleteTracks($,!0)];case 2:return ae.sent(),this.onInnerSubscribeDelete&&this.onInnerSubscribeDelete($),[3,4];case 3:throw Z=ae.sent(),(ne=Z).extraInfo=l(l({},ne.extraInfo),{api:"subscribeAdd",signal_api:"subscribeDeleteTracks",configList:x}),ne;case 4:return V=new Date().getTime(),[2,new Promise(function(le,fe){return h(te,void 0,void 0,function(){function ve(){return h(this,void 0,void 0,function(){var Ie,Te;return p(this,function($e){switch($e.label){case 0:z.removeTrackListener(),Ie=z.buildUrlStreamMap(K),$e.label=1;case 1:return $e.trys.push([1,3,,4]),[4,z.subscribeActive(x)];case 2:return $e.sent(),[3,4];case 3:return(Te=$e.sent()).extraInfo=l(l({},Te.extraInfo),{api:"subscribeAdd",signal_api:"subscribeActive"}),z.rollbackController.rollback({pcTransceiversRollback:!0,streamManagerRollback:!0}),[2,fe(Te)];case 4:return j=new Date().getTime(),le({deleteRspTime:V,subAddRspTime:H,activeRspTime:j,streamList:Ie}),[2]}})})}var Se,be,Me,_e,ke,Pe,Le,Qe,Ge,rt,Xe,at,Jt,jt,It,ot,Et,nt=this;return p(this,function(Ie){switch(Ie.label){case 0:if(!this.pc)return[2,fe(new C.RtsError(b.ErrorCode.CORE_NO_PC_ERROR,"subscribeAdd: no peerconnection",""))];this.pc.addEventListener("track",ve),this.removeTrackListener=function(){var Te;(Te=nt.pc)===null||Te===void 0||Te.removeEventListener("track",ve)},this.rollbackController.saveStreamManager(this.streamManager),Se=[],K.forEach(function(Te){var $e=Te.urlData,Rt=Te.vMsid,F=Te.aMsid;if(nt.pc){if(nt.streamManager.init($e.url),$e.subVideo&&!nt.streamManager.isMsidSubPubDone($e.url,{vMsid:Rt[0]})){var q=nt.pc.addTransceiver("video",{direction:"recvonly"});Se.push({type:"video",msid:Rt[0],trans:q}),nt.streamManager.update($e.url,{vMsid:Rt[0],vTransceiver:q}),nt.setCodecPreferences(q,nt.receiverCodecPreferences.video)}if($e.subAudio&&!nt.streamManager.isMsidSubPubDone($e.url,{aMsid:F[0]})){var G=nt.pc.addTransceiver("audio",{direction:"recvonly"});Se.push({type:"audio",msid:F[0],trans:G}),nt.streamManager.update($e.url,{aMsid:F[0],aTransceiver:G}),nt.setCodecPreferences(G,nt.receiverCodecPreferences.audio)}}}),this.rollbackController.setFakeSdpMedias(Se,"sub"),Ie.label=1;case 1:return Ie.trys.push([1,3,,4]),[4,this.pc.createOffer()];case 2:return be=Ie.sent(),[3,4];case 3:return Me=Ie.sent(),[2,fe(new C.RtsError(b.ErrorCode.DATACHANNEL_CREATE_OFFER_ERROR,"CreateOffer Error: ".concat(Me),"",{api:"subscribeAdd",err:Me}))];case 4:if(_e=new _.SdpUtil({sdp:be.sdp||""}),this.restorePublishedSsrc(_e),_e.addNack(),_e.updateBundle(),be=new RTCSessionDescription({type:"offer",sdp:_e.generate()}),ke=this.findNewSubPubMids((be==null?void 0:be.sdp)||"",this.prevOfferSdp||""),this.setPrevOfferSdp(be.sdp||""),this.rollbackController.setFakeSdpMids(ke),Pe=this.avoidMsidConflict(be.sdp),this.offerSdpHook)try{Pe=this.offerSdpHook(Pe)}catch(Te){console.log("offerSdpHook error: ",Te)}Ie.label=5;case 5:return Ie.trys.push([5,7,,9]),[4,this.pc.setLocalDescription(new RTCSessionDescription({type:"offer",sdp:Pe}))];case 6:return Ie.sent(),[3,9];case 7:return Le=Ie.sent(),[4,this.rollbackController.rollback({trackListnerRollback:!0,pcTransceiversRollback:!0,streamManagerRollback:!0,runSimulateSignal:!0})];case 8:return Ie.sent(),[2,fe(new C.RtsError(b.ErrorCode.DATACHANNEL_SET_OFFER_ERROR,"SetLocalDescription error: ".concat(Le),"",{api:"subscribeAdd",sdp:be}))];case 9:if(Qe=[],Ge=[],K.forEach(function(Te){var $e=new _.SdpUtil({sdp:(be==null?void 0:be.sdp)||""}),Rt=[],F=Te.vMsid.length!==0,q=Te.aMsid.length!==0,G=!1,J=!1;$e.detail.media.forEach(function(X){var re=String(X.mid);ke.includes(re)&&(Ge.includes(re)||(X.type==="video"&&F&&!G?(Rt.push(String(X.mid)),G=!0):X.type==="audio"&&q&&!J&&(Rt.push(String(X.mid)),J=!0)))}),Ge=v(v([],Ge,!0),Rt,!0),$e.keepMedia(Rt),Qe.push($e.generate())}),this.log("ADD LIST: ",K),this.offerSdpHook)try{Qe=Qe.map(function(Te){return nt.offerSdpHook(Te)})}catch(Te){console.log("offerSdpHook error: ",Te)}Ie.label=10;case 10:return Ie.trys.push([10,12,,14]),[4,(Et=this.signal)===null||Et===void 0?void 0:Et.subscribeAdd(K,Qe,this.streamManager)];case 11:return rt=Ie.sent(),[3,14];case 12:return Xe=Ie.sent(),[4,this.rollbackController.rollback({trackListnerRollback:!0,pcTransceiversRollback:!0,streamManagerRollback:!0,runSimulateSignal:!0})];case 13:return Ie.sent(),Xe.extraInfo=l({api:"subscribeAdd",signal_api:"subscribeAdd"},Xe.extraInfo),[2,fe(Xe)];case 14:if(at=[],rt.streams.forEach(function(Te,$e){nt.log("Sub TraceId[".concat($e,"]: "),Te.traceid);var Rt=new _.SdpUtil({sdp:Te.sdp});at=v(v([],at,!0),Rt.detail.media,!0);var F=K.find(function(q){return q.urlData.url===Te.url});F&&(F.traceId=Te.traceid)}),(Jt=new _.SdpUtil({sdp:this.prevAnswerSdp||""})).addOrUpdateMedia(at),this.alignAnswerMidsWithOffer(Jt),jt=Jt.generate(),this.setPrevAnswerSdp(jt),It=this.avoidMsidConflict(jt),this.answerSdpHook)try{It=this.answerSdpHook(It)}catch(Te){console.log("answerSdpHook error: ",Te)}Ie.label=15;case 15:return Ie.trys.push([15,17,,19]),[4,this.pc.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:It}))];case 16:return Ie.sent(),K.forEach(function(Te){nt.streamManager.markAlreadySubPub(Te.urlData.url,{vMsid:Te.vMsid[0],aMsid:Te.aMsid[0]})}),[3,19];case 17:return ot=Ie.sent(),[4,this.rollbackController.rollback({trackListnerRollback:!0,pcTransceiversRollback:!0,streamManagerRollback:!0})];case 18:return Ie.sent(),[2,fe(new C.RtsError(b.ErrorCode.DATACHANNEL_SET_ANSWER_ERROR,"SetRemoteDescription error: ".concat(ot),"",{api:"subscribeAdd",sdp:jt}))];case 19:return H=new Date().getTime(),[2]}})})})]}})})},U.prototype.subscribeActive=function(x){var V;return h(this,void 0,void 0,function(){return p(this,function(j){return[2,(V=this.signal)===null||V===void 0?void 0:V.subscribeActive(this.extendUrl(x))]})})},U.prototype.proceedSubscribeDeleteTracks=function(x,V){var j,H,z,K;return h(this,void 0,void 0,function(){var $,Z,ne,te,ae=this;return p(this,function(le){switch(le.label){case 0:x.forEach(function(fe){fe.rawUrl=fe.url,fe.url=ae.streamManager.getOriginUrl(fe.url)}),le.label=1;case 1:return le.trys.push([1,3,,4]),[4,(j=this.signal)===null||j===void 0?void 0:j.subscribeDelete(x)];case 2:return le.sent(),[3,4];case 3:if($=le.sent(),Z=$,!V||Z.errorCode!==b.ErrorCode.DATACHANNEL_RESPONSE_ERROR||!(!((z=(H=Z.extraInfo)===null||H===void 0?void 0:H.parsedData)===null||z===void 0)&&z.streams)||((K=Z.extraInfo.parsedData.streams[0])===null||K===void 0?void 0:K.res_code)!==404)throw Z.extraInfo=l({api:"subscribeDeleteTracks"},Z.extraInfo),Z;return[3,4];case 4:return ne=[],te=x.map(function(fe){var ve=fe.url,Se=fe.vMsid,be=fe.aMsid,Me=fe.rawUrl;return h(ae,void 0,void 0,function(){var _e,ke,Pe,Le,Qe,Ge,rt,Xe;return p(this,function(at){switch(at.label){case 0:ve=(0,R.pruneSubUrl)(ve),this.streamManager.has(ve)&&(Se&&(Pe=this.streamManager.getTransceiver(ve,{vMsid:Se[0]}))&&(ke=Pe.receiver.track).stop(),be&&(Le=this.streamManager.getTransceiver(ve,{aMsid:be[0]}))&&(_e=Le.receiver.track).stop()),at.label=1;case 1:return at.trys.push([1,3,,4]),[4,this.simulateOfferAnswer()];case 2:return at.sent(),[3,4];case 3:throw(Qe=at.sent()).extraInfo=l({api:"subscribeDeleteTracks"},Qe.extraInfo),Qe;case 4:return(Ge=this.streamManager.getStreamByMsid({url:ve,vMsid:Se==null?void 0:Se[0],aMsid:be==null?void 0:be[0]}))&&(_e&&((rt=Ge.mediastream)===null||rt===void 0||rt.removeTrack(_e)),ke&&((Xe=Ge.mediastream)===null||Xe===void 0||Xe.removeTrack(ke))),this.streamManager.pruneStreamList(ve),this.streamManager.removeMsid(ve,{vMsid:Se!=null&&Se.length?this.unifyMsid(Se,"video"):void 0,aMsid:be!=null&&be.length?this.unifyMsid(be,"audio"):void 0}),ne.push({url:Me||"",stream:Ge}),[2]}})})}),[4,Promise.all(te)];case 5:return le.sent(),[2,ne]}})})},U.prototype.proceedSubscribeStop=function(x){var V;return h(this,void 0,void 0,function(){var j,H,z=this;return p(this,function(K){switch(K.label){case 0:return K.trys.push([0,2,,3]),[4,(V=this.signal)===null||V===void 0?void 0:V.subscribeStop(this.extendUrl(x))];case 1:return K.sent(),[3,3];case 2:throw(j=K.sent()).extraInfo=l({api:"subscribeStop"},j.extraInfo),j;case 3:return x.forEach(function($){$.rawUrl=$.url,$.url=z.streamManager.getOriginUrl($.url)}),H=x.map(function($){var Z=$.url;return $.rawUrl,$.targetStreams,h(z,void 0,void 0,function(){var ne;return p(this,function(te){switch(te.label){case 0:Z=(0,R.pruneSubUrl)(Z),this.streamManager.getAllTransceivers(Z).forEach(function(ae){var le;(le=ae==null?void 0:ae.receiver.track)===null||le===void 0||le.stop()}),this.streamManager.get(Z).streamList.forEach(function(ae){return ae.release()}),this.streamManager.remove(Z),te.label=1;case 1:return te.trys.push([1,3,,4]),[4,this.simulateOfferAnswer()];case 2:return te.sent(),[3,4];case 3:throw(ne=te.sent()).extraInfo=l({api:"subscribeStop"},ne.extraInfo),ne;case 4:return[2]}})})}),[4,Promise.all(H)];case 4:return K.sent(),[2]}})})},U.prototype.proceedPublishAdd=function(x){var V;return h(this,void 0,void 0,function(){var j,H,z,K,$,Z,ne,te,ae,le,fe,ve,Se,be,Me,_e,ke,Pe,Le,Qe,Ge,rt,Xe,at,Jt,jt,It,ot,Et,nt=this;return p(this,function(Ie){switch(Ie.label){case 0:if(x.length>1)throw console.error("Only one stream is supported."),new C.RtsError(b.ErrorCode.CORE_PUBLIST_EXCEED_ERROR,"publishAdd: publishList exceed limit","",{api:"publishAdd"});if(!this.pc)throw new C.RtsError(b.ErrorCode.CORE_NO_PC_ERROR,"publishAdd: no peerconnection","",{api:"publishAdd"});j=x[0],H=j.stream,z=this.unifyMsid(j.aMsid,"audio"),K=this.unifyMsid(j.vMsid,"video"),j.rawUrl=j.url,j.url=this.streamManager.getOriginUrl(j.url),typeof j.updateSourceStream!="boolean"&&(j.updateSourceStream=!0),$=H.videoTrack,Z=H.audioTrack,this.rollbackController.saveStreamManager(this.streamManager),ne=[],te=this.streamManager.getStreamByMsid({url:j.url,vMsid:K,aMsid:z}),this.streamManager.init(j.url,O.EStreamType.Publish),$&&(ae=this.pc.addTransceiver(H.videoTrack,{direction:"sendonly"}),this.streamManager.update(j.url,{vMsid:K,vTransceiver:ae,stream:H}),ne.push({type:"video",trans:ae,msid:K}),this.setCodecPreferences(ae,this.senderCodecPreferences.video)),Z&&(ae=this.pc.addTransceiver(H.audioTrack,{direction:"sendonly"}),this.streamManager.update(j.url,{aMsid:z,aTransceiver:ae,stream:H}),ne.push({type:"audio",trans:ae,msid:z}),this.setCodecPreferences(ae,this.senderCodecPreferences.audio)),this.rollbackController.setFakeSdpMedias(ne,"pub"),Ie.label=1;case 1:return Ie.trys.push([1,3,,4]),[4,this.pc.createOffer()];case 2:return le=Ie.sent(),[3,4];case 3:throw fe=Ie.sent(),new C.RtsError(b.ErrorCode.DATACHANNEL_CREATE_OFFER_ERROR,"CreateOffer Error: ".concat(fe),"",{api:"publishAdd",err:fe});case 4:if(ve=new _.SdpUtil({sdp:le.sdp||""}),Se=this.parseMsidString(K),be=this.parseMsidString(z),Me=this.findNewSubPubMids(le.sdp||"",this.prevOfferSdp||""),this.rollbackController.setFakeSdpMids(Me),Se.stream&&ve.detail.msidSemantic&&(ve.detail.msidSemantic.token=Se.stream),_e=ve.detail.media.reduce(function(Te,$e){return $e.direction==="inactive"?v(v([],Te,!0),[String($e.mid)],!1):Te},[]),ve.detail.media.forEach(function(Te){var $e;if(Te.direction!=="recvonly"&&Te.type!=="application"&&Me.includes(String(Te.mid))){var Rt=Te.type==="video"?Se:be,F=nt.parseMsidString(Te.msid);F.stream=Rt.stream||F.stream,F.track=Rt.track||F.track;var q=nt.stringifyMsid(F);Te.msid=q,($e=Te.ssrcs)===null||$e===void 0||$e.forEach(function(G){switch(G.attribute){case"cname":case"label":G.value=Rt.track||G.value;break;case"msid":G.value=q;break;case"mslabel":G.value=Rt.stream||G.value}})}}),this.restorePublishedSsrc(ve),this.restorePublishMsid(ve),ve.addNack(),ke=ve.generate(),this.setPrevOfferSdp(ke),Pe=this.avoidMsidConflict(ke),this.offerSdpHook)try{Pe=this.offerSdpHook(Pe)}catch(Te){console.log("offerSdoHook error: ",Te)}Ie.label=5;case 5:return Ie.trys.push([5,7,,8]),[4,this.pc.setLocalDescription(new RTCSessionDescription({type:"offer",sdp:Pe}))];case 6:return Ie.sent(),[3,8];case 7:throw Le=Ie.sent(),this.rollbackController.rollback({streamManagerRollback:!0,runSimulateSignal:!0}),new C.RtsError(b.ErrorCode.DATACHANNEL_SET_OFFER_ERROR,"SetLocalDescription error: ".concat(Le),"",{api:"publishAdd",sdp:ke});case 8:if(ve.keepMedia(Me),this.updateTrackInfoList({url:j.rawUrl,stream:j.stream,vMsid:K,aMsid:z,sdpMediaList:ve.detail.media}),Pe=ve.generate(),this.offerSdpHook)try{Pe=this.offerSdpHook(Pe)}catch(Te){console.log("offerSdpHook error: ",Te)}Ie.label=9;case 9:return Ie.trys.push([9,11,,12]),[4,(V=this.signal)===null||V===void 0?void 0:V.publishAdd([j.url],[Pe],[$?[this.stringifyMsid(Se)]:[]],[Z?[this.stringifyMsid(be)]:[]])];case 10:return Qe=Ie.sent(),[3,12];case 11:throw Ge=Ie.sent(),(rt=Ge).extraInfo=l({api:"publishAdd"},rt.extraInfo),this.rollbackController.rollback({streamManagerRollback:!0,runSimulateSignal:!0}),rt;case 12:if(Xe=Qe.streams[0],j.traceId=Xe.traceid,this.log("Pub TraceId: ",j.traceId),(at=new _.SdpUtil({sdp:Xe.sdp})).detail.media.forEach(function(Te){Te.type!=="application"&&Te.direction==="sendrecv"&&(Te.direction="recvonly")}),(Jt=new _.SdpUtil({sdp:this.prevAnswerSdp||""})).detail.media.forEach(function(Te){Te.type==="application"&&(delete Te.candidates,delete Te.endOfCandidates)}),Jt.setMediaInactive(_e),Jt.addOrUpdateMedia(at.detail.media,{isPublish:!0}),this.alignAnswerMidsWithOffer(Jt),this.removeTwcc&&(jt=["http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"],Jt.detail.media.forEach(function(Te){var $e;Te.ext=($e=Te.ext)===null||$e===void 0?void 0:$e.filter(function(Rt){return!jt.includes(Rt.uri)})})),It=Jt.generate(),this.setPrevAnswerSdp(It),ot=this.avoidMsidConflict(It),this.answerSdpHook)try{ot=this.answerSdpHook(ot)}catch(Te){console.log("answerSdpHook error: ",Te)}Ie.label=13;case 13:return Ie.trys.push([13,15,,16]),[4,this.pc.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:ot}))];case 14:return Ie.sent(),this.streamManager.markAlreadySubPub(j.url,{vMsid:K,aMsid:z,isPub:!0}),[3,16];case 15:throw Et=Ie.sent(),this.rollbackController.rollback({streamManagerRollback:!0}),new C.RtsError(b.ErrorCode.DATACHANNEL_SET_ANSWER_ERROR,"SetRemoteDescription error: ".concat(Et),"",{api:"publishAdd",sdp:It});case 16:return te&&j.updateSourceStream&&te.mergeStream(H),[2,x.map(function(Te){return{url:Te.rawUrl,trackInfoList:nt.streamManager.getAllMediaInfoList(j.url),traceId:Te.traceId}})]}})})},U.prototype.proceedPublishDeleteTracks=function(x){var V,j,H,z,K,$,Z;return h(this,void 0,void 0,function(){var ne,te,ae,le,fe,ve,Se,be,Me,_e,ke=this;return p(this,function(Pe){switch(Pe.label){case 0:x.forEach(function(Le){Le.rawUrl=Le.url,Le.url=ke.streamManager.getOriginUrl(Le.url)}),Pe.label=1;case 1:return Pe.trys.push([1,3,,4]),[4,(V=this.signal)===null||V===void 0?void 0:V.publishDelete(x)];case 2:return Pe.sent(),[3,4];case 3:throw(ne=Pe.sent()).extraInfo=l({api:"publishDeleteTracks"},ne.extraInfo),ne;case 4:if(te=x[0],ae=(0,R.pruneSubUrl)(te.url),typeof te.updateSourceStream!="boolean"&&(te.updateSourceStream=!0),le=!1,fe=!1,!this.streamManager.has(ae))return[3,9];!((j=te.vMsid)===null||j===void 0)&&j.length&&((ve=this.streamManager.getTransceiver(ae,{vMsid:te.vMsid[0]}))!=null&&ve.sender&&((H=this.pc)===null||H===void 0||H.removeTrack(ve==null?void 0:ve.sender)),le=!0),!((z=te.aMsid)===null||z===void 0)&&z.length&&((Se=this.streamManager.getTransceiver(ae,{aMsid:te.aMsid[0]}))!=null&&Se.sender&&((K=this.pc)===null||K===void 0||K.removeTrack(Se==null?void 0:Se.sender)),fe=!0),Pe.label=5;case 5:return Pe.trys.push([5,7,,8]),[4,this.simulateOfferAnswer()];case 6:return Pe.sent(),[3,8];case 7:throw(be=Pe.sent()).extraInfo=l({api:"publishDeleteTracks"},be.extraInfo),be;case 8:return(Me=this.streamManager.getStreamByMsid({url:ae,vMsid:($=te.vMsid)===null||$===void 0?void 0:$[0],aMsid:(Z=te.aMsid)===null||Z===void 0?void 0:Z[0]}))&&te.updateSourceStream&&Me.deleteTracks({video:le,audio:fe}),this.streamManager.removeMsid(ae,{vMsid:le?this.unifyMsid(te.vMsid,"video"):void 0,aMsid:fe?this.unifyMsid(te.aMsid,"audio"):void 0}),this.streamManager.pruneStreamList(ae),_e=this.streamManager.getAllMediaInfoList(te.url),[2,x.map(function(Le){return{url:Le.rawUrl,trackInfoList:_e}})];case 9:return[2]}})})},U.prototype.proceedPublishReplaceTracks=function(x){var V,j,H,z,K;return h(this,void 0,void 0,function(){var $,Z,ne,te,ae,le,fe,ve,Se,be,Me=this;return p(this,function(_e){switch(_e.label){case 0:if($=x[0],Z=$.stream,ne=$.vMsid,te=$.aMsid,$.rawUrl=$.url,$.url=this.streamManager.getOriginUrl($.url),!this.streamManager.has($.url))throw new C.RtsError(b.ErrorCode.CORE_PUB_REPLACE_URL_NOT_FOUND,"No stream found for this url: ".concat($.url),"",{api:"publishReplaceTracks",configList:x});return typeof $.updateSourceStream!="boolean"&&($.updateSourceStream=!0),ae=Z.audioTrack,le=Z.videoTrack,fe=this.streamManager.getAllMediaInfoList($.url,!0),ae&&(Se=(V=fe.find(function(ke){return ke.type==="audio"&&(!te||ke.msid===te)}))===null||V===void 0?void 0:V.transceiver)&&ae.id!==((H=(j=Se.sender)===null||j===void 0?void 0:j.track)===null||H===void 0?void 0:H.id)?[4,Se.sender.replaceTrack(ae)]:[3,2];case 1:_e.sent(),_e.label=2;case 2:return le?(ve=fe.find(function(ke){return ke.type==="video"&&(!ne||ke.msid===ne)}),(Se=ve==null?void 0:ve.transceiver)&&le.id!==((K=(z=Se.sender)===null||z===void 0?void 0:z.track)===null||K===void 0?void 0:K.id)?[4,Se.sender.replaceTrack(le)]:[3,4]):[3,4];case 3:_e.sent(),Z.isCustomStream||(ve.from=Z.hasScreen?"screen":"camera"),_e.label=4;case 4:return(be=this.streamManager.getStreamByMsid({url:$.url,vMsid:ne,aMsid:te}))&&$.updateSourceStream&&be.mergeStream(Z),[2,x.map(function(ke){return{url:ke.rawUrl,trackInfoList:Me.streamManager.getAllMediaInfoList($.url)}})]}})})},U.prototype.proceedPublishStop=function(x){var V;return h(this,void 0,void 0,function(){var j,H,z=this;return p(this,function(K){switch(K.label){case 0:return K.trys.push([0,2,,3]),[4,(V=this.signal)===null||V===void 0?void 0:V.publishStop(x.map(function($){return z.streamManager.getOriginUrl($.url)}))];case 1:return K.sent(),[3,3];case 2:throw(j=K.sent()).extraInfo=l({api:"publishStop"},j.extraInfo),j;case 3:return H=x.map(function($){var Z=$.url;return h(z,void 0,void 0,function(){var ne,te=this;return p(this,function(ae){switch(ae.label){case 0:Z=(0,R.pruneSubUrl)(Z),this.streamManager.getAllTransceivers(Z).forEach(function(le){var fe;le!=null&&le.sender&&((fe=te.pc)===null||fe===void 0||fe.removeTrack(le==null?void 0:le.sender))}),this.streamManager.get(Z).streamList.forEach(function(le){return le.deleteTracks({video:!0,audio:!0})}),this.streamManager.remove(Z),ae.label=1;case 1:return ae.trys.push([1,3,,4]),[4,this.simulateOfferAnswer()];case 2:return ae.sent(),[3,4];case 3:throw(ne=ae.sent()).extraInfo=l({api:"publishStop"},ne.extraInfo),ne;case 4:return[2]}})})}),[4,Promise.all(H)];case 4:return K.sent(),[2]}})})},U.prototype.proceedSubscribeAddDatachannel=function(x){return h(this,void 0,void 0,function(){var V=this;return p(this,function(j){return[2,new Promise(function(H,z){return h(V,void 0,void 0,function(){var K,$,Z,ne,te;return p(this,function(ae){switch(ae.label){case 0:return ae.trys.push([0,2,,3]),[4,(ne=this.signal)===null||ne===void 0?void 0:ne.subscribeAddDatachannel(x)];case 1:return ae.sent(),[3,3];case 2:return(K=ae.sent()).extraInfo=l({api:"subscribeAddDatachannel",signal_api:"subscribeAddDatachannel"},K.extraInfo),[2,z(K)];case 3:$={},ae.label=4;case 4:return ae.trys.push([4,6,,7]),[4,(te=this.signal)===null||te===void 0?void 0:te.subscribeActiveDatachannel(x)];case 5:return $=ae.sent(),[3,7];case 6:return(Z=ae.sent()).extraInfo=l({api:"subscribeAddDatachannel",signal_api:"subscribeActiveDatachannel"},Z.extraInfo),[2,z(Z)];case 7:return H($),[2]}})})})]})})},U.prototype.proceedSubscribeStopDatachannel=function(x){return h(this,void 0,void 0,function(){var V=this;return p(this,function(j){return[2,new Promise(function(H,z){return h(V,void 0,void 0,function(){var K,$,Z,ne,te;return p(this,function(ae){switch(ae.label){case 0:return ae.trys.push([0,2,,3]),[4,(Z=this.signal)===null||Z===void 0?void 0:Z.subscribeStopDatachannel(x)];case 1:return ae.sent(),[3,3];case 2:return K=ae.sent(),((te=(ne=($=K).extraInfo.parsedData.streams)===null||ne===void 0?void 0:ne[0])===null||te===void 0?void 0:te.res_code)===404?[3,3]:($.extraInfo=l({api:"subscribeStopDatachannel",signal_api:"subscribeStopDatachannel"},$.extraInfo),[2,z(K)]);case 3:return H(),[2]}})})})]})})},U.prototype.proceedPublishAddDatachannel=function(x){return h(this,void 0,void 0,function(){var V=this;return p(this,function(j){return[2,new Promise(function(H,z){return h(V,void 0,void 0,function(){var K,$,Z;return p(this,function(ne){switch(ne.label){case 0:K={},ne.label=1;case 1:return ne.trys.push([1,3,,4]),[4,(Z=this.signal)===null||Z===void 0?void 0:Z.publishAddDatachannel(x)];case 2:return K=ne.sent(),[3,4];case 3:return($=ne.sent()).extraInfo=l({api:"publishAddDatachannel",signal_api:"publishAddDatachannel"},$.extraInfo),[2,z($)];case 4:return H(K),[2]}})})})]})})},U.prototype.proceedPublishStopDatachannel=function(x){return h(this,void 0,void 0,function(){var V=this;return p(this,function(j){return[2,new Promise(function(H,z){return h(V,void 0,void 0,function(){var K,$;return p(this,function(Z){switch(Z.label){case 0:return Z.trys.push([0,2,,3]),[4,($=this.signal)===null||$===void 0?void 0:$.publishStopDatachannel(x)];case 1:return Z.sent(),[3,3];case 2:return(K=Z.sent()).extraInfo=l({api:"publishStopDatachannel",signal_api:"publishStopDatachannel"},K.extraInfo),[2,z(K)];case 3:return H(),[2]}})})})]})})},U.prototype.buildUrlStreamMap=function(x){var V=this,j=[];return x.forEach(function(H){var z=H.urlData,K=H.traceId,$=H.url,Z=H.vMsid,ne=H.aMsid,te=z.url,ae=new MediaStream;V.streamManager.getAllMediaInfoList(te,!0).forEach(function(le){var fe,ve;if(le.type==="video"&&le.msid===Z[0]||le.type==="audio"&&le.msid===ne[0]){var Se=(ve=(fe=le.transceiver)===null||fe===void 0?void 0:fe.receiver)===null||ve===void 0?void 0:ve.track;Se&&ae.addTrack(Se)}}),j.push({url:$,stream:ae,traceId:K})}),j},U.prototype.extendUrl=function(x){var V=this;return x.map(function(j){var H=j.url,z=j.subAudio,K=j.subVideo,$=j.aMsid,Z=j.vMsid,ne=V.streamManager.getOriginUrl(H),te=new w.UrlData({url:ne,subAudio:z,subVideo:K});return l(l({},j),{urlData:te,aMsid:te.subAudio?$||[I]:[],vMsid:te.subVideo?Z||[P]:[]})})},U.prototype.parseSdp=function(x){return new _.SdpUtil({sdp:x})},U.prototype.getTrackInfoList=function(x,V,j){x===void 0&&(x=[]);var H=[];return x.forEach(function(z){var K,$,Z,ne;if(z.type!=="application"){var te,ae=Number(z.ssrcs&&((K=z.ssrcs[0])===null||K===void 0?void 0:K.id))||-1,le=z.rtp.find(function(_e){var ke;return["opus","h264"].includes((ke=_e.codec)===null||ke===void 0?void 0:ke.toLowerCase())}),fe=(le==null?void 0:le.codec)||"",ve=(le==null?void 0:le.payload)||0;V.isCustomStream||z.type==="video"&&(te=V.hasScreen?"screen":"camera");var Se=z.msid;if(j!=null&&j.aMsid||j!=null&&j.vMsid){var be=(z.type==="video"?j.vMsid:j.aMsid)||"";be!=null&&be.trim().includes(" ")||(Se=($=z.msid)===null||$===void 0?void 0:$.split(" ")[1])}var Me=z.type==="video"?(Z=V.videoTrack)===null||Z===void 0?void 0:Z.id:(ne=V.audioTrack)===null||ne===void 0?void 0:ne.id;H.push({ssrc:ae,codec:fe,type:z.type,pt:ve,msid:Se,from:te,trackId:Me})}}),H},U.prototype.patchSubscribeStreamManagerRecord=function(x,V){var j=this;this.extendUrl([{url:x,vMsid:V.vMsid,aMsid:V.aMsid}]).forEach(function(H){var z=H.urlData,K=H.vMsid,$=H.aMsid;if(j.pc&&(j.streamManager.remove(z.url),j.streamManager.init(z.url),j.pc.getTransceivers)){var Z=j.pc.getTransceivers()||[];if(z.subVideo){var ne=Z.find(function(ae){return ae.receiver.track.kind==="video"});j.streamManager.update(z.url,{vMsid:K[0],vTransceiver:ne,stream:V.stream})}if(z.subAudio){var te=Z.find(function(ae){return ae.receiver.track.kind==="audio"});j.streamManager.update(z.url,{aMsid:$[0],aTransceiver:te,stream:V.stream})}}})},U.prototype.patchPublishStreamManagerRecord=function(x,V){if(this.pc){var j=V.stream,H=j.videoTrack,z=j.audioTrack,K=this.unifyMsid(V.aMsid,"audio"),$=this.unifyMsid(V.vMsid,"video");if(this.streamManager.init(x,O.EStreamType.Publish),this.pc.getTransceivers){var Z=this.pc.getTransceivers()||[];if(H){var ne=Z.find(function(ae){var le,fe;return((fe=(le=ae.sender)===null||le===void 0?void 0:le.track)===null||fe===void 0?void 0:fe.id)===H.id});ne&&this.streamManager.update(x,{vMsid:$,vTransceiver:ne,stream:V.stream})}if(z){var te=Z.find(function(ae){var le,fe;return((fe=(le=ae.sender)===null||le===void 0?void 0:le.track)===null||fe===void 0?void 0:fe.id)===z.id});te&&this.streamManager.update(x,{aMsid:K,aTransceiver:te,stream:V.stream})}}}},U.prototype.updateTrackInfoList=function(x){var V=x.url,j=x.stream,H=x.vMsid,z=x.aMsid,K=x.sdpMediaList;V||console.error("[updateTrackInfoList] url is required");var $=this.getTrackInfoList(K,j,{vMsid:H,aMsid:z}),Z=$.find(function(te){return te.type==="video"}),ne=$.find(function(te){return te.type==="audio"});return H&&Z&&this.streamManager.updateSdpInfo(V,l({vMsid:H},Z)),z&&ne&&this.streamManager.updateSdpInfo(V,l({aMsid:z},ne)),$},U.prototype.unifyMsid=function(x,V){var j=V==="video"?P:I;return(x==null?void 0:x[0])||j},U.prototype.dispose=function(){var x,V;this.pc=void 0,this.prevOfferSdp=void 0,this.prevAnswerSdp=void 0,(x=this.signal)===null||x===void 0||x.dispose(),(V=this.streamManager)===null||V===void 0||V.dispose()},U.prototype.findNewSubPubMids=function(x,V){var j=new _.SdpUtil({sdp:x}),H=new _.SdpUtil({sdp:V}),z=j.detail.media.filter(function($){return $.direction!=="inactive"}).map(function($){return $.mid}),K=H.detail.media.map(function($){return $.mid});return this.findDiff(z,K).map(function($){return String($)})},U.prototype.findDiff=function(x,V){return Array.from(new Set(v([],x,!0).filter(function(j){return!V.includes(j)})))},U.prototype.parseMsidString=function(x){var V={stream:"",track:""};if(!x)return V;var j=x.trim().split(" "),H=j[0],z=j[1];return z?(V.stream=H,V.track=z):V.track=H,V},U.prototype.stringifyMsid=function(x){var V=x.stream,j=x.track;return"".concat(V).concat(V?" ":"").concat(j)},U.prototype.restorePublishedSsrc=function(x){var V=new _.SdpUtil({sdp:this.prevOfferSdp||""}).getPublishSsrcs();x.detail.media.forEach(function(j){var H;j.direction!=="recvonly"&&((H=j.ssrcs)===null||H===void 0||H.forEach(function(z){var K,$=(K=V.find(function(Z){return Z.mid===String(j.mid)}))===null||K===void 0?void 0:K.ssrc;$&&(z.id=String($))}))})},U.prototype.restorePublishMsid=function(x){var V=this,j=new _.SdpUtil({sdp:this.prevOfferSdp||""}).getPublishMsids();j!=null&&j.length&&x.detail.media.forEach(function(H){var z,K;if(H.direction!=="recvonly"){var $=(z=j.find(function(ne){return ne.mid===String(H.mid)}))===null||z===void 0?void 0:z.msid;if(!$)return;var Z=V.parseMsidString($);H.msid=$||H.msid,(K=H.ssrcs)===null||K===void 0||K.forEach(function(ne){switch(ne.attribute){case"cname":ne.value=Z.track||ne.value;break;case"msid":ne.value=$||ne.value}})}})},U.prototype.alignAnswerMidsWithOffer=function(x){var V=new _.SdpUtil({sdp:this.prevOfferSdp||""}).detail.media.map(function(K){return String(K.mid)}),j=x.detail.media.map(function(K){return String(K.mid)}),H=this.findDiff(j,V);x.removeMedia(H);var z=[];V.forEach(function(K){var $=x.detail.media.find(function(Z){return String(Z.mid)===K});$&&z.push($)}),x.detail.media=z.filter(function(K){return K})},U.prototype.simulateOfferAnswer=function(x){var V,j,H;return h(this,void 0,void 0,function(){var z,K,$,Z,ne,te,ae,le,fe,ve,Se,be,Me;return p(this,function(_e){switch(_e.label){case 0:return _e.trys.push([0,2,,3]),[4,(V=this.pc)===null||V===void 0?void 0:V.createOffer()];case 1:return z=_e.sent(),K=new _.SdpUtil({sdp:(z==null?void 0:z.sdp)||""}),$=K.detail.media.filter(function(ke){return ke.direction==="inactive"}).map(function(ke){return String(ke.mid)}),this.restorePublishedSsrc(K),this.restorePublishMsid(K),this.prevOfferSdp=K.generate(),(Z=new _.SdpUtil({sdp:this.prevAnswerSdp||""})).setMediaInactive($),x&&(ne=(0,_.generateFakeMediaSdpAnswer)(x))&&(te=new _.SdpUtil({sdp:ne}),ae=v([],te.detail.media,!0),Z.addOrUpdateMedia(ae),this.alignAnswerMidsWithOffer(Z)),le=Z.generate(),this.setPrevAnswerSdp(le),[3,3];case 2:throw fe=_e.sent(),new C.RtsError(b.ErrorCode.DATACHANNEL_CREATE_OFFER_ERROR,"CreateOffer error: ".concat(fe),"",{pc:this.pc});case 3:if(ve=this.avoidMsidConflict(this.prevOfferSdp),this.offerSdpHook)try{ve=this.offerSdpHook(ve)}catch(ke){console.log("offerSdoHook error: ",ke)}_e.label=4;case 4:return _e.trys.push([4,6,,7]),[4,(j=this.pc)===null||j===void 0?void 0:j.setLocalDescription(new RTCSessionDescription({type:"offer",sdp:ve}))];case 5:return _e.sent(),[3,7];case 6:throw Se=_e.sent(),new C.RtsError(b.ErrorCode.DATACHANNEL_SET_OFFER_ERROR,"SetLocalDescription error: ".concat(Se),"",{sdp:this.prevOfferSdp});case 7:if(_e.trys.push([7,10,,11]),!this.prevAnswerSdp)return[3,9];if(be=this.avoidMsidConflict(this.prevAnswerSdp),this.answerSdpHook)try{be=this.answerSdpHook(be)}catch(ke){console.log("answerSdpHook error: ",ke)}return[4,(H=this.pc)===null||H===void 0?void 0:H.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:be}))];case 8:_e.sent(),_e.label=9;case 9:return[3,11];case 10:throw Me=_e.sent(),new C.RtsError(b.ErrorCode.DATACHANNEL_SET_ANSWER_ERROR,"SetRemoteDescription error: ".concat(Me),"",{sdp:this.prevAnswerSdp});case 11:return[2]}})})},U.prototype.avoidMsidConflict=function(x){var V=new _.SdpUtil({sdp:x});return V.mungleMsid(),V.generate()},U.prototype.setCodecPreferences=function(x,V){if(V)try{x.setCodecPreferences(V)}catch(j){console.warn("setCodecPreferences error",j)}},U.prototype.log=function(){for(var x=[],V=0;V<arguments.length;V++)x[V]=arguments[V];window.RTS_DATACHANNEL_DEBUG&&console.log.apply(console,v(["[PC-Core]"],x,!1))},U}();m.PeerConnectionCore=W},651:function(E,m,f){var y,S=this&&this.__extends||(y=function(b,A){return y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,M){T.__proto__=M}||function(T,M){for(var D in M)Object.prototype.hasOwnProperty.call(M,D)&&(T[D]=M[D])},y(b,A)},function(b,A){if(typeof A!="function"&&A!==null)throw new TypeError("Class extends value "+String(A)+" is not a constructor or null");function T(){this.constructor=b}y(b,A),b.prototype=A===null?Object.create(A):(T.prototype=A.prototype,new T)}),l=this&&this.__importDefault||function(b){return b&&b.__esModule?b:{default:b}};Object.defineProperty(m,"__esModule",{value:!0}),m.DataChannelCore=m.EDatachannelStatus=void 0;var h,p=f(844),v=f(961),g=f(854),R=l(f(885)),_=l(f(973)),w=l(f(985)),k=l(f(372));function O(){}(function(b){b[b.DATACHANNEL_STATUS_CLOSE=0]="DATACHANNEL_STATUS_CLOSE",b[b.DATACHANNEL_STATUS_OPEN=1]="DATACHANNEL_STATUS_OPEN"})(h=m.EDatachannelStatus||(m.EDatachannelStatus={}));var C=function(b){function A(T){var M=b.call(this)||this;return M.pendingPromiseMap=new Map,M.mutexSendData=!1,M.timerSendData=null,M.eventQueue=new g.CacheBuffer("send tasks"),M.datachannelList=[],M.pc=T.pc,M.eventHandler=T.onDatachannelEvent||O,M.datachannelList=T.datachannelList||[],M.createDatachannel(T.label),M}return S(A,b),A.prototype.getNextId=function(){var T=0,M=this.datachannelList.reduce(function(D,N){return N.readyState==="open"?D+1:(T||(T=N.id),D)},0);return T||2*(M+1)},A.prototype.createDatachannel=function(T){var M=this,D={ordered:!0};(w.default.isIos||k.default.isSafari)&&this.pc.connectionState==="connected"&&(D.id=this.getNextId()),this.datachannel=this.pc.createDataChannel(T||"GRTN_RTC_DATACHANNEL"+"_".concat(Date.now()),D),this.datachannel.addEventListener("open",function(){setTimeout(function(){M.eventHandler(h.DATACHANNEL_STATUS_OPEN),M.emit("statusChange",h.DATACHANNEL_STATUS_OPEN)},200)}),this.datachannel.addEventListener("close",function(){M.eventHandler(h.DATACHANNEL_STATUS_CLOSE),M.emit("statusChange",h.DATACHANNEL_STATUS_CLOSE)}),this.datachannel.addEventListener("closing",function(){}),this.datachannel.addEventListener("error",function(N){console.log(">> error",N),M.emit("error",N)}),this.datachannel.addEventListener("bufferedamountlow",function(){}),this.datachannel.addEventListener("message",function(N){M.emit("message",N.data)})},Object.defineProperty(A.prototype,"id",{get:function(){return this.datachannel.id},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"label",{get:function(){return this.datachannel.label},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"readyState",{get:function(){return this.datachannel.readyState},enumerable:!1,configurable:!0}),A.prototype.send=function(T){if(this.datachannel.readyState!=="open")throw new Error("Datachannel(label:".concat(this.datachannel.label,",id:").concat(this.datachannel.id,") is closed."));return this.datachannel.send(T)},A.prototype.sendData=function(T){var M=this;return new Promise(function(D,N){var P=new _.default(M.datachannel);if(M.mutexSendData){var I={sender:P,res:D,rej:N,data:T};M.eventQueue.cache(I)}else M.atomSend(P,D,N,T)})},A.prototype.dispose=function(){var T;this.emit("dispose"),this.mutexSendData=!1,this.timerSendData!==null&&clearTimeout(this.timerSendData),this.timerSendData=null,this.eventQueue=new g.CacheBuffer("send tasks"),(T=this.datachannel)===null||T===void 0||T.close()},A.prototype.atomSend=function(T,M,D,N){var P=this;this.mutexSendData=!0,T.on("onSendDataDone",function(){if(P.timerSendData!==null&&clearTimeout(P.timerSendData),P.timerSendData=null,P.mutexSendData=!1,!P.eventQueue.isEmpty()){var I=P.eventQueue.getFirst();P.atomSend(I.sender,I.res,I.rej,I.data)}}),this.timerSendData=setTimeout(function(){D(new v.RtsError(p.ErrorCode.DATACHANNEL_TIMEOUT_ERROR,"request timeout after ".concat(A.REQUEST_TIMEOUT,"ms"),"",N)),P.timerSendData=null,P.mutexSendData=!1,T.emit("onSendDataDone")},A.REQUEST_TIMEOUT),T.sendingProcess(M,D,N)},A.REQUEST_TIMEOUT=5e3,A}(R.default);m.DataChannelCore=C},973:function(E,m,f){var y,S=this&&this.__extends||(y=function(w,k){return y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(O,C){O.__proto__=C}||function(O,C){for(var b in C)Object.prototype.hasOwnProperty.call(C,b)&&(O[b]=C[b])},y(w,k)},function(w,k){if(typeof k!="function"&&k!==null)throw new TypeError("Class extends value "+String(k)+" is not a constructor or null");function O(){this.constructor=w}y(w,k),w.prototype=k===null?Object.create(k):(O.prototype=k.prototype,new O)}),l=this&&this.__spreadArray||function(w,k,O){if(O||arguments.length===2)for(var C,b=0,A=k.length;b<A;b++)!C&&b in k||(C||(C=Array.prototype.slice.call(k,0,b)),C[b]=k[b]);return w.concat(C||Array.prototype.slice.call(k))},h=this&&this.__importDefault||function(w){return w&&w.__esModule?w:{default:w}};Object.defineProperty(m,"__esModule",{value:!0}),m.EDatachannelSignalResCode=void 0;var p,v=f(844),g=f(961),R=h(f(885));(function(w){w[w.NGX_RTC_PUBLISH_ALREADY=402]="NGX_RTC_PUBLISH_ALREADY",w[w.NGX_RTC_REQUEST_FORBIDDEN=403]="NGX_RTC_REQUEST_FORBIDDEN",w[w.NGX_RTC_STREAM_NO_FOUND=404]="NGX_RTC_STREAM_NO_FOUND",w[w.NGX_RTC_SUBSCRIBE_ALREADY=410]="NGX_RTC_SUBSCRIBE_ALREADY",w[w.NGX_RTC_NORMAL_CLOSED=200]="NGX_RTC_NORMAL_CLOSED",w[w.NGX_RTC_LIMITED=508]="NGX_RTC_LIMITED",w[w.NGX_RTC_INTERNAL_SERVER_ERROR=500]="NGX_RTC_INTERNAL_SERVER_ERROR",w[w.NGX_RTC_BAD_REQUEST=400]="NGX_RTC_BAD_REQUEST",w[w.NGX_RTC_NEED_RETRY=213]="NGX_RTC_NEED_RETRY"})(p=m.EDatachannelSignalResCode||(m.EDatachannelSignalResCode={}));var _=function(w){function k(O){var C=w.call(this)||this;return C.datachannel=O,C}return S(k,w),k.prototype.sendingProcess=function(O,C,b){var A,T=this,M=performance.now();this.datachannel.onmessage=function(D){try{var N=JSON.parse(D.data),P=T.checkResponse(N);if(T.log("<<< Received:","".concat(Math.ceil(performance.now()-M),"ms"),N),P.pass)O(N);else{if(P.code===p.NGX_RTC_NEED_RETRY)return void setTimeout(function(){T.log(">>> Send:",b),T.datachannel.send(JSON.stringify(b))},200);C(new g.RtsError(v.ErrorCode.DATACHANNEL_RESPONSE_ERROR,"[code]".concat(P.code,"; [msg]").concat(P.msg),P.traceId,{parsedData:N}))}}catch(I){C(new g.RtsError(v.ErrorCode.DATACHANNEL_PARSE_ERROR,"datachannel message parse error","",{data:D.data,err:I}))}T.emit("onSendDataDone")};try{this.log(">>> Sent:","".concat(b.type,"-").concat(!((A=b.streams)===null||A===void 0)&&A.length?b.streams[0].method:"-"),b)}catch{}this.datachannel.send(JSON.stringify(b))},k.prototype.checkResponse=function(O){var C={pass:!0,code:0,msg:"",traceId:""};O.recode!==0&&(C.pass=!1,C.code=O.recode,C.msg=O.msg);var b=O.streams;return b&&b.length>0&&b.forEach(function(A){A.res_code!==200&&(C.pass=!1,C.code=A.res_code,C.msg=A.res_msg,C.traceId=A.traceid)}),C},k.prototype.log=function(){for(var O=[],C=0;C<arguments.length;C++)O[C]=arguments[C];window.RTS_DATACHANNEL_DEBUG&&console.log.apply(console,l(["".concat(this.now()," [datachannel|").concat(this.datachannel.label,"|").concat(this.datachannel.id,"]")],O,!1))},k.prototype.now=function(){var O=new Date;return"".concat(O.getHours(),":").concat(O.getMinutes(),":").concat(O.getSeconds(),".").concat(String(O.getMilliseconds()).padStart(3,"0"))},k}(R.default);m.default=_},844:(E,m)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.ErrorCode=void 0,function(f){f[f.DATACHANNEL_SIGNAL_ERROR=15e3]="DATACHANNEL_SIGNAL_ERROR",f[f.DATACHANNEL_SET_OFFER_ERROR=15001]="DATACHANNEL_SET_OFFER_ERROR",f[f.DATACHANNEL_SET_ANSWER_ERROR=15002]="DATACHANNEL_SET_ANSWER_ERROR",f[f.DATACHANNEL_CREATE_OFFER_ERROR=15003]="DATACHANNEL_CREATE_OFFER_ERROR",f[f.DATACHANNEL_RESPONSE_ERROR=15004]="DATACHANNEL_RESPONSE_ERROR",f[f.DATACHANNEL_PARSE_ERROR=15005]="DATACHANNEL_PARSE_ERROR",f[f.DATACHANNEL_TIMEOUT_ERROR=15006]="DATACHANNEL_TIMEOUT_ERROR",f[f.CORE_NO_PC_ERROR=15007]="CORE_NO_PC_ERROR",f[f.CORE_PUBLIST_EXCEED_ERROR=15008]="CORE_PUBLIST_EXCEED_ERROR",f[f.CORE_PUB_REPLACE_URL_NOT_FOUND=15009]="CORE_PUB_REPLACE_URL_NOT_FOUND",f[f.CORE_TRANSCEIVERS_NOT_FOUND=15010]="CORE_TRANSCEIVERS_NOT_FOUND"}(m.ErrorCode||(m.ErrorCode={}))},961:(E,m,f)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.RtsError=void 0;var y=f(844);m.RtsError=function(S,l,h,p){this.errorCode=S,this.errorCodeName=y.ErrorCode[S],this.message=l,this.traceId=h,p&&(this.extraInfo=p)}},854:(E,m)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.CacheBuffer=void 0;var f=function(){function y(S){this.data=[],this.tag=S||"unknown",this.maxBufferLength=90}return y.prototype.setMaxCapacity=function(S){this.maxBufferLength=90,S>=0&&(this.maxBufferLength=S),this.maxBufferLength>200&&(this.maxBufferLength=200)},y.prototype.cache=function(S){this.data.length>this.maxBufferLength&&(this.data.shift(),console.log(this.tag+" CACHE: Reach Max Capacity")),this.data.push(S)},y.prototype.getFirst=function(){return this.data.shift()},y.prototype.isEmpty=function(){return this.data.length<=0},y}();m.CacheBuffer=f},885:(E,m)=>{Object.defineProperty(m,"__esModule",{value:!0});var f=function(){function y(){this._eventMap={}}return y.prototype.listeners=function(S){return this._eventMap[S]||[]},y.prototype.emit=function(S){for(var l=this,h=[],p=1;p<arguments.length;p++)h[p-1]=arguments[p];var v=this._eventMap[S];return!!Array.isArray(v)&&(v.forEach(function(g){return g.apply(l,h)}),!0)},y.prototype.off=function(S,l){var h=this._eventMap[S];return Array.isArray(h)&&(this._eventMap[S]=h.filter(function(p){return p!==l})),this},y.prototype.removeAllListeners=function(S){return S===void 0?this._eventMap={}:this._eventMap[S]&&(this._eventMap[S]=[]),this},y.prototype.on=function(S,l){return this._eventMap[S]?this._eventMap[S].push(l):this._eventMap[S]=[l],this},y.prototype.once=function(S,l){var h=this,p=function(){for(var v=[],g=0;g<arguments.length;g++)v[g]=arguments[g];h.off(S,p),l.apply(h,v)};return this.on(S,p),this},y}();m.default=f},887:(E,m)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.intersection=m.pruneSubUrl=m.parseUrlSubParams=void 0,m.parseUrlSubParams=function(f){var y={subVideo:!0,subAudio:!0};return f&&(f.includes("@subvideo=no")&&(y.subVideo=!1),f.includes("@subaudio=no")&&(y.subAudio=!1)),y},m.pruneSubUrl=function(f,y){var S=f||"";return S=S.replace("@subaudio=no","").replace("@subvideo=no",""),y&&(S=S.split("?")[0]),S},m.intersection=function(f,y){return f.filter(function(S){return y.includes(S)})}},248:function(E,m,f){var y=this&&this.__assign||function(){return y=Object.assign||function(p){for(var v,g=1,R=arguments.length;g<R;g++)for(var _ in v=arguments[g])Object.prototype.hasOwnProperty.call(v,_)&&(p[_]=v[_]);return p},y.apply(this,arguments)},S=this&&this.__spreadArray||function(p,v,g){if(g||arguments.length===2)for(var R,_=0,w=v.length;_<w;_++)!R&&_ in v||(R||(R=Array.prototype.slice.call(v,0,_)),R[_]=v[_]);return p.concat(R||Array.prototype.slice.call(v))};Object.defineProperty(m,"__esModule",{value:!0}),m.generateFakeMediaSdpAnswer=m.SdpUtil=void 0;var l=f(766),h=function(){function p(v){if(this.rawSdp=v.sdp,!v.sdp)throw new Error("No sdp to parse");this.sdpDetail=this.parse()}return Object.defineProperty(p.prototype,"detail",{get:function(){return this.sdpDetail},enumerable:!1,configurable:!0}),p.prototype.removeMedia=function(v){return this.removeMediaInner(v)},p.prototype.keepMedia=function(v){return this.removeMediaInner(v,{revert:!0})},p.prototype.removeMediaInner=function(v,g){g===void 0&&(g={revert:!1}),v.length&&this.sdpDetail.media&&this.sdpDetail.media.length&&(g.revert?this.sdpDetail.media=this.sdpDetail.media.filter(function(R){return v.includes(String(R.mid)||"")}):this.sdpDetail.media=this.sdpDetail.media.filter(function(R){return!v.includes(String(R.mid)||"")}),this.updateBundle())},p.prototype.addOrUpdateMedia=function(v,g){g===void 0&&(g={}),v=v.map(function(_){return y(y({},_),{setup:"passive"})});var R=[];this.sdpDetail.media=this.sdpDetail.media.map(function(_){var w=v.find(function(C){return C.mid===_.mid});if(w){R.push(_.mid);var k=w,O=_;return g.isPublish&&(k.ssrcs=O.ssrcs,k.ssrcGroups=O.ssrcGroups),w}return _}),this.sdpDetail.media=S(S([],this.sdpDetail.media,!0),v.filter(function(_){return!R.includes(_.mid)}),!0),this.updateBundle()},p.prototype.mungleMsid=function(){this.sdpDetail.media.forEach(function(v){if(v.msid){var g="";v.msid=v.msid.split(" ").map(function(R,_){return _===1?(g=R,R+"_"+v.mid):R}).join(" "),g&&v.ssrcs&&v.ssrcs.forEach(function(R){R.value&&(R.value=R.value.replace(g,g+"_"+v.mid))})}})},p.prototype.addMedia=function(v){var g;v=v.map(function(w){return y(y({},w),{setup:"passive"})}),this.sdpDetail.media=S(S([],this.sdpDetail.media,!0),v,!0);var R=v.reduce(function(w,k){return w+" "+k.mid},""),_=(g=this.sdpDetail.groups)===null||g===void 0?void 0:g.find(function(w){return w.type==="BUNDLE"});_&&(_.mids+="".concat(R))},p.prototype.setMediaInactive=function(v){this.sdpDetail.media.forEach(function(g){v.includes(String(g.mid))&&(g.direction="inactive")}),this.updateBundle()},p.prototype.getPublishSsrcs=function(){var v=[];return this.sdpDetail.media.forEach(function(g){g.direction!=="recvonly"&&g.ssrcs&&v.push({type:g.type,ssrc:g.ssrcs[0].id||"ERR_NOT_FOUND",mid:String(g.mid)})}),v},p.prototype.getPublishMsids=function(){var v=[];return this.sdpDetail.media.forEach(function(g){g.direction!=="recvonly"&&g.msid&&v.push({type:g.type,msid:g.msid,mid:String(g.mid)})}),v},p.prototype.generate=function(){return(0,l.write)(this.sdpDetail)},p.prototype.updateBundle=function(){var v,g=(v=this.sdpDetail.groups)===null||v===void 0?void 0:v.find(function(R){return R.type==="BUNDLE"});g&&(g.mids=this.sdpDetail.media.reduce(function(R,_){return R+_.mid+" "},"").trim())},p.prototype.addNack=function(){this.sdpDetail.media.forEach(function(v){var g,R,_;if(v.type==="audio"){if(!((g=v.rtcpFb)===null||g===void 0)&&g.some(function(k){return k.type==="nack"}))return;var w=(R=v.rtp.find(function(k){return k.codec==="opus"}))===null||R===void 0?void 0:R.payload;w&&((_=v.rtcpFb)===null||_===void 0||_.push({payload:w,type:"nack"}))}})},p.prototype.parse=function(){var v=(0,l.parse)(this.rawSdp);return this.patchMsid(v)},p.prototype.getMids=function(v){return v!=null&&v.length?v.reduce(function(g,R){return S(S([],g,!0),[String(R.mid)],!1)},[]):[]},p.prototype.patchMsid=function(v){return v.media.forEach(function(g){var R,_;g.type==="application"||g.msid||(g.msid=(_=(R=g.ssrcs)===null||R===void 0?void 0:R.find(function(w){return w.attribute==="msid"}))===null||_===void 0?void 0:_.value)}),v},p}();m.SdpUtil=h,m.generateFakeMediaSdpAnswer=function(p){if(!p.mids.length||!p.medias.length||p.mids.length!==p.medias.length)return"";var v=`v=0
o=- 1710852399 2 IN IP4 127.0.0.1
s=-
t=0 0
a=group:BUNDLE`,g=`
a=end-of-candidates`;p.mids.forEach(function(_){v+=" ".concat(_)});var R=function(){for(var _="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",w="",k=0;k<24;k++)w+=_.charAt(Math.floor(62*Math.random()));return w}();return p.medias.forEach(function(_,w){if(_.type==="video"){var k=(1e4*Math.random()).toFixed(0),O=_.msid||"rts video";v+=`
m=video 9 UDP/TLS/RTP/SAVPF 106 107
c=IN IP4 0.0.0.0
a=rtcp:9 IN IP4 0.0.0.0
a=ice-ufrag:ZmFrZV90b2tlbg==
a=ice-pwd:`.concat(R,`
a=ice-options:ice-lite
a=fingerprint:SHA-256 C3:E2:CD:1F:B8:E4:DA:77:D1:D2:36:F3:72:EA:83:CA:7A:F2:3B:26:07:C6:E0:3D:96:44:57:59:14:DE:F0:A4
a=setup:passive
a=sendonly
a=mid:`).concat(p.mids[w],`
a=rtcp-mux
a=rtpmap:106 H264/90000
a=fmtp:106 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f;sps-pps-idr-in-keyframe=1
a=rtcp-fb:106 goog-remb
a=rtcp-fb:106 transport-cc
a=rtcp-fb:106 ccm fir
a=rtcp-fb:106 nack
a=rtcp-fb:106 nack pli
a=rtpmap:107 rtx/90000
a=fmtp:107 apt=106
a=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01
a=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time
a=extmap:5 http://www.webrtc.org/experiments/rtp-hdrext/playout-delay`);var C=`
a=ssrc:`.concat(k,` cname:defaultcname
a=ssrc:`).concat(k," msid:").concat(O,`
a=ssrc:`).concat(k,` mslabel:rts
a=ssrc:`).concat(k," label:video");p.direction==="sub"&&(v+=C),v+=g}else _.type==="audio"&&(k=(1e4*Math.random()).toFixed(0),O=_.msid||"rts audio",v+=`
m=audio 9 UDP/TLS/RTP/SAVPF 111
c=IN IP4 0.0.0.0
a=rtcp:9 IN IP4 0.0.0.0
a=ice-ufrag:ZmFrZV90b2tlbg==
a=ice-pwd:`.concat(R,`
a=ice-options:ice-lite
a=fingerprint:SHA-256 C3:E2:CD:1F:B8:E4:DA:77:D1:D2:36:F3:72:EA:83:CA:7A:F2:3B:26:07:C6:E0:3D:96:44:57:59:14:DE:F0:A4
a=setup:passive
a=sendonly
a=mid:`).concat(p.mids[w],`
a=rtcp-mux
a=rtpmap:111 opus/48000/2
a=fmtp:111 minptime=10;stereo=1;useinbandfec=1
a=rtcp-fb:111 transport-cc
a=rtcp-fb:111 nack
a=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01
a=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time`),C=`
a=ssrc:`.concat(k,` cname:defaultcname
a=ssrc:`).concat(k," msid:").concat(O,`
a=ssrc:`).concat(k,` mslabel:rts
a=ssrc:`).concat(k," label:audio"),p.direction==="sub"&&(v+=C),v+=g)}),v}},237:(E,m,f)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.UrlData=void 0;var y=f(887),S=function(){function l(h){var p=(0,y.parseUrlSubParams)(h.url);this.data={url:h.url,subAudio:p.subAudio,subVideo:p.subVideo},typeof h.subAudio=="boolean"&&(this.data.subAudio=h.subAudio),typeof h.subVideo=="boolean"&&(this.data.subVideo=h.subVideo)}return Object.defineProperty(l.prototype,"subVideo",{get:function(){return this.data.subVideo},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"subAudio",{get:function(){return this.data.subAudio},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"url",{get:function(){return(0,y.pruneSubUrl)(this.data.url)},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"originalUrl",{get:function(){return this.data.url},enumerable:!1,configurable:!0}),l}();m.UrlData=S},619:function(E,m,f){var y=this&&this.__assign||function(){return y=Object.assign||function(k){for(var O,C=1,b=arguments.length;C<b;C++)for(var A in O=arguments[C])Object.prototype.hasOwnProperty.call(O,A)&&(k[A]=O[A]);return k},y.apply(this,arguments)},S=this&&this.__awaiter||function(k,O,C,b){return new(C||(C=Promise))(function(A,T){function M(P){try{N(b.next(P))}catch(I){T(I)}}function D(P){try{N(b.throw(P))}catch(I){T(I)}}function N(P){var I;P.done?A(P.value):(I=P.value,I instanceof C?I:new C(function(L){L(I)})).then(M,D)}N((b=b.apply(k,O||[])).next())})},l=this&&this.__generator||function(k,O){var C,b,A,T,M={label:0,sent:function(){if(1&A[0])throw A[1];return A[1]},trys:[],ops:[]};return T={next:D(0),throw:D(1),return:D(2)},typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function D(N){return function(P){return function(I){if(C)throw new TypeError("Generator is already executing.");for(;T&&(T=0,I[0]&&(M=0)),M;)try{if(C=1,b&&(A=2&I[0]?b.return:I[0]?b.throw||((A=b.return)&&A.call(b),0):b.next)&&!(A=A.call(b,I[1])).done)return A;switch(b=0,A&&(I=[2&I[0],A.value]),I[0]){case 0:case 1:A=I;break;case 4:return M.label++,{value:I[1],done:!1};case 5:M.label++,b=I[1],I=[0];continue;case 7:I=M.ops.pop(),M.trys.pop();continue;default:if(!((A=(A=M.trys).length>0&&A[A.length-1])||I[0]!==6&&I[0]!==2)){M=0;continue}if(I[0]===3&&(!A||I[1]>A[0]&&I[1]<A[3])){M.label=I[1];break}if(I[0]===6&&M.label<A[1]){M.label=A[1],A=I;break}if(A&&M.label<A[2]){M.label=A[2],M.ops.push(I);break}A[2]&&M.ops.pop(),M.trys.pop();continue}I=O.call(k,M)}catch(L){I=[6,L],b=0}finally{C=A=0}if(5&I[0])throw I[1];return{value:I[0]?I[1]:void 0,done:!0}}([N,P])}}},h=this&&this.__spreadArray||function(k,O,C){if(C||arguments.length===2)for(var b,A=0,T=O.length;A<T;A++)!b&&A in O||(b||(b=Array.prototype.slice.call(O,0,A)),b[A]=O[A]);return k.concat(b||Array.prototype.slice.call(O))};Object.defineProperty(m,"__esModule",{value:!0}),m.Signal=void 0;var p,v,g,R=f(651),_=f(887);(function(k){k.Sub="sub",k.Pub="pub"})(p||(p={})),function(k){k.Add="add",k.Active="active",k.Stop="stop",k.Delete="delete"}(v||(v={})),function(k){k.Audio="audio",k.Video="video",k.Data="data"}(g||(g={}));var w=function(){function k(O){this.latestMsgId=0,this.latestSubAddMsgId=0,this.pc=O.pc,this.datachannel=new R.DataChannelCore({pc:this.pc,onDatachannelEvent:O.onDatachannelEvent})}return k.prototype.getDatachannelCore=function(){return this.datachannel},k.prototype.subscribeAdd=function(O,C,b){var A;return S(this,void 0,void 0,function(){var T;return l(this,function(M){switch(M.label){case 0:return T=y(y({},this.baseParams({type:p.Sub,method:v.Add})),{streams:O.map(function(D,N){var P=D.urlData,I=[];return P.subAudio&&!b.isMsidSubPubDone(P.url,{aMsid:D.aMsid[0]})&&I.push({type:g.Audio,name:D.aMsid[0]}),P.subVideo&&!b.isMsidSubPubDone(P.url,{vMsid:D.vMsid[0]})&&I.push({type:g.Video,name:D.vMsid[0]}),{method:v.Add,url:P.url,msid:I,sdp:C[N],ttl:300}})}),[4,(A=this.datachannel)===null||A===void 0?void 0:A.sendData(T)];case 1:return[2,M.sent()]}})})},k.prototype.subscribeActive=function(O){var C;return S(this,void 0,void 0,function(){var b;return l(this,function(A){switch(A.label){case 0:return b=y(y({},this.baseParams({type:p.Sub,method:v.Active})),{streams:O.map(function(T){var M=T.urlData;return{method:v.Active,url:M.url}})}),[4,(C=this.datachannel)===null||C===void 0?void 0:C.sendData(b)];case 1:return A.sent(),[2]}})})},k.prototype.subscribeDelete=function(O){var C;return S(this,void 0,void 0,function(){var b;return l(this,function(A){switch(A.label){case 0:return b=y(y({},this.baseParams()),{streams:O.map(function(T){var M=T.url,D=T.aMsid,N=T.vMsid,P=[];return D!=null&&D.length&&(P=h(h([],P,!0),D.map(function(I){return{name:I}}),!0)),N!=null&&N.length&&(P=h(h([],P,!0),N.map(function(I){return{name:I}}),!0)),{method:v.Delete,url:(0,_.pruneSubUrl)(M),msid:P}})}),[4,(C=this.datachannel)===null||C===void 0?void 0:C.sendData(b)];case 1:return[2,A.sent()]}})})},k.prototype.subscribeStop=function(O){var C;return S(this,void 0,void 0,function(){var b;return l(this,function(A){switch(A.label){case 0:return b=y(y({},this.baseParams()),{streams:O.map(function(T){var M=T.urlData;return{method:v.Stop,url:M.url}})}),[4,(C=this.datachannel)===null||C===void 0?void 0:C.sendData(b)];case 1:return[2,A.sent()]}})})},k.prototype.subscribeAddDatachannel=function(O){var C;return S(this,void 0,void 0,function(){var b;return l(this,function(A){switch(A.label){case 0:return b=y(y({},this.baseParams({type:p.Sub,method:v.Add})),{streams:O.map(function(T){var M=T.url,D=T.msid;return{method:v.Add,url:M,msid:[{type:g.Data,name:D}]}})}),[4,(C=this.datachannel)===null||C===void 0?void 0:C.sendData(b)];case 1:return[2,A.sent()]}})})},k.prototype.subscribeActiveDatachannel=function(O){var C;return S(this,void 0,void 0,function(){var b;return l(this,function(A){switch(A.label){case 0:return b=y(y({},this.baseParams({type:p.Sub,method:v.Active})),{streams:O.map(function(T){var M=T.url,D=T.datachannelId,N=T.msid;return{method:v.Active,url:M,msid:[{type:g.Data,name:N,channel:D}]}})}),[4,(C=this.datachannel)===null||C===void 0?void 0:C.sendData(b)];case 1:return[2,A.sent()]}})})},k.prototype.subscribeStopDatachannel=function(O){var C;return S(this,void 0,void 0,function(){var b;return l(this,function(A){switch(A.label){case 0:return b=y(y({},this.baseParams()),{streams:O.map(function(T){var M=T.url;return{method:v.Stop,url:M}})}),[4,(C=this.datachannel)===null||C===void 0?void 0:C.sendData(b)];case 1:return[2,A.sent()]}})})},k.prototype.publishAdd=function(O,C,b,A){var T;return S(this,void 0,void 0,function(){var M;return l(this,function(D){return M=y(y({},this.baseParams({type:p.Pub})),{streams:O.map(function(N,P){var I=b[P],L=A[P],W=[];return I.length&&W.push({type:"video",name:I[0].trim()}),L.length&&W.push({type:"audio",name:L[0].trim()}),{method:v.Add,url:N,msid:W,sdp:C[P]}})}),[2,(T=this.datachannel)===null||T===void 0?void 0:T.sendData(M)]})})},k.prototype.publishDelete=function(O){var C;return S(this,void 0,void 0,function(){var b;return l(this,function(A){return b=y(y({},this.baseParams({type:p.Pub})),{streams:O.map(function(T){var M=T.url,D=T.aMsid,N=T.vMsid,P=[];return D!=null&&D.length&&(P=h(h([],P,!0),D.map(function(I){return{name:I}}),!0)),N!=null&&N.length&&(P=h(h([],P,!0),N.map(function(I){return{name:I}}),!0)),{method:v.Delete,url:(0,_.pruneSubUrl)(M),msid:P}})}),[2,(C=this.datachannel)===null||C===void 0?void 0:C.sendData(b)]})})},k.prototype.publishStop=function(O){var C;return S(this,void 0,void 0,function(){var b;return l(this,function(A){return b=y(y({},this.baseParams({type:p.Pub})),{streams:O.map(function(T){return{method:v.Stop,url:T}})}),[2,(C=this.datachannel)===null||C===void 0?void 0:C.sendData(b)]})})},k.prototype.publishAddDatachannel=function(O){var C;return S(this,void 0,void 0,function(){var b;return l(this,function(A){switch(A.label){case 0:return b=y(y({},this.baseParams({type:p.Pub,method:v.Add})),{streams:O.map(function(T){var M=T.url,D=T.datachannelId,N=T.msid;return{method:v.Add,url:M,msid:[{type:g.Data,name:N,channel:D}]}})}),[4,(C=this.datachannel)===null||C===void 0?void 0:C.sendData(b)];case 1:return[2,A.sent()]}})})},k.prototype.publishStopDatachannel=function(O){var C;return S(this,void 0,void 0,function(){var b;return l(this,function(A){switch(A.label){case 0:return b=y(y({},this.baseParams({type:p.Pub})),{streams:O.map(function(T){var M=T.url;return{method:v.Stop,url:M}})}),[4,(C=this.datachannel)===null||C===void 0?void 0:C.sendData(b)];case 1:return[2,A.sent()]}})})},k.prototype.dispose=function(){this.datachannel.dispose()},k.prototype.baseParams=function(O){O===void 0&&(O={type:p.Sub});var C=0;return O.type===p.Sub&&O.method===v.Add?(C=++this.latestMsgId,this.latestSubAddMsgId=this.latestMsgId):C=O.type===p.Sub&&O.method===v.Active?this.latestSubAddMsgId:++this.latestMsgId,{msg_id:C,version:2,type:O.type}},k}();m.Signal=w},132:function(E,m){var f=this&&this.__awaiter||function(h,p,v,g){return new(v||(v=Promise))(function(R,_){function w(C){try{O(g.next(C))}catch(b){_(b)}}function k(C){try{O(g.throw(C))}catch(b){_(b)}}function O(C){var b;C.done?R(C.value):(b=C.value,b instanceof v?b:new v(function(A){A(b)})).then(w,k)}O((g=g.apply(h,p||[])).next())})},y=this&&this.__generator||function(h,p){var v,g,R,_,w={label:0,sent:function(){if(1&R[0])throw R[1];return R[1]},trys:[],ops:[]};return _={next:k(0),throw:k(1),return:k(2)},typeof Symbol=="function"&&(_[Symbol.iterator]=function(){return this}),_;function k(O){return function(C){return function(b){if(v)throw new TypeError("Generator is already executing.");for(;_&&(_=0,b[0]&&(w=0)),w;)try{if(v=1,g&&(R=2&b[0]?g.return:b[0]?g.throw||((R=g.return)&&R.call(g),0):g.next)&&!(R=R.call(g,b[1])).done)return R;switch(g=0,R&&(b=[2&b[0],R.value]),b[0]){case 0:case 1:R=b;break;case 4:return w.label++,{value:b[1],done:!1};case 5:w.label++,g=b[1],b=[0];continue;case 7:b=w.ops.pop(),w.trys.pop();continue;default:if(!((R=(R=w.trys).length>0&&R[R.length-1])||b[0]!==6&&b[0]!==2)){w=0;continue}if(b[0]===3&&(!R||b[1]>R[0]&&b[1]<R[3])){w.label=b[1];break}if(b[0]===6&&w.label<R[1]){w.label=R[1],R=b;break}if(R&&w.label<R[2]){w.label=R[2],w.ops.push(b);break}R[2]&&w.ops.pop(),w.trys.pop();continue}b=p.call(h,w)}catch(A){b=[6,A],g=0}finally{v=R=0}if(5&b[0])throw b[1];return{value:b[0]?b[1]:void 0,done:!0}}([O,C])}}},S=this&&this.__spreadArray||function(h,p,v){if(v||arguments.length===2)for(var g,R=0,_=p.length;R<_;R++)!g&&R in p||(g||(g=Array.prototype.slice.call(p,0,R)),g[R]=p[R]);return h.concat(g||Array.prototype.slice.call(p))};Object.defineProperty(m,"__esModule",{value:!0}),m.PeerConnectionRollbackController=void 0;var l=function(){function h(p){this.fakeSdpParams={direction:"sub",mids:[],medias:[]},this.pcCore=p}return h.prototype.setFakeSdpMids=function(p){this.fakeSdpParams.mids=p},h.prototype.setFakeSdpMedias=function(p,v){this.fakeSdpParams.medias=p,this.fakeSdpParams.direction=v},h.prototype.saveStreamManager=function(p){this.streamManager=p,this.streamManagerBackup=this.streamManager.doBackup()},h.prototype.rollback=function(p){return f(this,void 0,void 0,function(){var v;return y(this,function(g){switch(g.label){case 0:if(p!=null&&p.trackListnerRollback&&(this.pcCore.removeTrackListener(),this.log("Sub Track Listener Removed")),(p==null?void 0:p.streamManagerRollback)&&this.streamManagerBackup){this.pcCore.setStreamManager(this.streamManagerBackup);try{this.log("Stream Manager Restored",JSON.parse(JSON.stringify(this.streamManager)))}catch{}}if(p!=null&&p.pcTransceiversRollback&&(this.fakeSdpParams.medias.forEach(function(R){var _;(_=R.trans)===null||_===void 0||_.receiver.track.stop()}),this.log("Sub Track(s) Stopped",this.fakeSdpParams.medias)),!(p!=null&&p.runSimulateSignal))return[3,4];this.log("SDP Simulating...",this.fakeSdpParams),g.label=1;case 1:return g.trys.push([1,3,,4]),[4,this.pcCore.simulateOfferAnswer(this.fakeSdpParams)];case 2:return g.sent(),this.log("SDP Simulation Done"),[3,4];case 3:return v=g.sent(),this.log("SDP Simulation Failed",v),[3,4];case 4:return[2]}})})},h.prototype.log=function(){for(var p=[],v=0;v<arguments.length;v++)p[v]=arguments[v];window.RTS_DATACHANNEL_DEBUG&&console.log.apply(console,S(["[PC-Core-Rollback]"],p,!1))},h}();m.PeerConnectionRollbackController=l},628:function(E,m,f){var y=this&&this.__assign||function(){return y=Object.assign||function(v){for(var g,R=1,_=arguments.length;R<_;R++)for(var w in g=arguments[R])Object.prototype.hasOwnProperty.call(g,w)&&(v[w]=g[w]);return v},y.apply(this,arguments)},S=this&&this.__spreadArray||function(v,g,R){if(R||arguments.length===2)for(var _,w=0,k=g.length;w<k;w++)!_&&w in g||(_||(_=Array.prototype.slice.call(g,0,w)),_[w]=g[w]);return v.concat(_||Array.prototype.slice.call(g))};Object.defineProperty(m,"__esModule",{value:!0}),m.StreamManager=m.EStreamType=void 0;var l,h=f(887);(function(v){v.Subscribe="sub",v.Publish="pub"})(l=m.EStreamType||(m.EStreamType={}));var p=function(){function v(g){this.streamMap={}}return v.prototype.doBackup=function(){var g,R,_,w=new v;w.streamMap={};var k=function(b){var A=O.streamMap[b];if(A){var T=[],M=[],D=[];(g=A.streamList)===null||g===void 0||g.forEach(function(P){T.push(P)}),(R=A.videoInfoList)===null||R===void 0||R.forEach(function(P){var I={msid:P.msid,ssrc:P.ssrc,transceiver:P.transceiver,subDone:P.subDone,pubDone:P.pubDone,streamId:P.streamId,codec:P.codec,pt:P.pt,from:P.from,type:P.type};M.push(I)}),(_=A.audioInfoList)===null||_===void 0||_.forEach(function(P){P.msid,P.ssrc,P.transceiver,P.subDone,P.pubDone,P.streamId,P.codec,P.pt,P.from,P.type,D.push(P)});var N={type:A.type,streamList:T,videoInfoList:M,audioInfoList:D,originUrl:A.originUrl};w.streamMap[b]=N}},O=this;for(var C in this.streamMap)k(C);return w},v.prototype.init=function(g,R){R===void 0&&(R=l.Subscribe);var _=(0,h.pruneSubUrl)(g);g=(0,h.pruneSubUrl)(g,!0),this.has(g)||(this.streamMap[g]={type:R,videoInfoList:[],audioInfoList:[],streamList:[],originUrl:_})},v.prototype.remove=function(g){delete this.streamMap[(0,h.pruneSubUrl)(g,!0)]},v.prototype.update=function(g,R){var _=this.get(g);if(!_)throw new Error("No url found");if(R.aMsid){var w=_.audioInfoList.find(function(O){return O.msid===R.aMsid})||this.createMediaItem(R.aMsid,"audio");R.aTransceiver&&(w.transceiver=R.aTransceiver),R.stream&&(w.streamId=R.stream.id),this.updateMediaInfoList(w,_.audioInfoList)}if(R.vMsid){var k=_.videoInfoList.find(function(O){return O.msid===R.vMsid})||this.createMediaItem(R.vMsid,"video");R.vTransceiver&&(k.transceiver=R.vTransceiver),R.stream&&(k.streamId=R.stream.id),this.updateMediaInfoList(k,_.videoInfoList)}R.stream&&(_.streamList.some(function(O){return O.id===R.stream.id})||(_.streamList=S(S([],_.streamList,!0),[R.stream],!1)))},v.prototype.pruneStreamList=function(g){var R=this.get(g);R&&(R.streamList=R.streamList.filter(function(_){var w;return((w=_.mediaStream)===null||w===void 0?void 0:w.getTracks().length)>0}))},v.prototype.updateSdpInfo=function(g,R){var _,w=this.get(g);if(!w)throw new Error("No url found");if(R.aMsid?_=w.audioInfoList.find(function(k){return k.msid===R.aMsid}):R.vMsid&&(_=w.videoInfoList.find(function(k){return k.msid===R.vMsid})),!_)throw new Error("No target media found");_.ssrc=R.ssrc,_.codec=R.codec,_.pt=R.pt,_.from=R.from},v.prototype.get=function(g){return this.streamMap[(0,h.pruneSubUrl)(g,!0)]},v.prototype.has=function(g){return!!this.get(g)},v.prototype.removeMsid=function(g,R){g=(0,h.pruneSubUrl)(g,!0);var _=this.get(g);_&&(R.vMsid&&(_.videoInfoList=_.videoInfoList.filter(function(w){return w.msid!==R.vMsid})),R.aMsid&&(_.audioInfoList=_.audioInfoList.filter(function(w){return w.msid!==R.aMsid})))},v.prototype.getMids=function(g,R){R===void 0&&(R={filterSubDone:!1}),g=(0,h.pruneSubUrl)(g,!0);var _=this.streamMap[g];return _?S(S([],_.audioInfoList.reduce(function(w,k){return k.transceiver&&(!R.filterSubDone||R.filterSubDone&&!k.subDone)?S(S([],w,!0),[String(k.transceiver.mid)],!1):w},[]),!0),_.videoInfoList.reduce(function(w,k){return k.transceiver&&(!R.filterSubDone||R.filterSubDone&&!k.subDone)?S(S([],w,!0),[String(k.transceiver.mid)],!1):w},[]),!0):[]},v.prototype.getAllTransceivers=function(g){if(!g)return[];g=(0,h.pruneSubUrl)(g,!0);var R=this.get(g);return R?S(S([],R.videoInfoList.map(function(_){return _.transceiver}),!0),R.audioInfoList.map(function(_){return _.transceiver}),!0):[]},v.prototype.getTransceiver=function(g,R){if(R===void 0&&(R={}),g){g=(0,h.pruneSubUrl)(g,!0);var _=R.vMsid,w=R.aMsid,k=this.get(g);if(k){var O;if(_)return(O=k.videoInfoList.find(function(C){return C.msid===_}))==null?void 0:O.transceiver;if(w)return(O=k.audioInfoList.find(function(C){return C.msid===w}))==null?void 0:O.transceiver}}},v.prototype.getStreamByMsid=function(g){var R,_,w=this.get(g.url);if(w){if(g.vMsid){var k=(R=w.videoInfoList.find(function(C){return C.msid===g.vMsid}))===null||R===void 0?void 0:R.streamId;return w.streamList.find(function(C){return C.id===k})}if(g.aMsid){var O=(_=w.audioInfoList.find(function(C){return C.msid===g.aMsid}))===null||_===void 0?void 0:_.streamId;return w.streamList.find(function(C){return C.id===O})}return w.streamList[0]}},v.prototype.hasTransceiver=function(g,R){return R===void 0&&(R={}),!!this.getTransceiver(g,R)},v.prototype.removeTransceiver=function(g,R){g=(0,h.pruneSubUrl)(g,!0);var _,w=this.get(g);w&&(R.vMsid&&(_=w.videoInfoList.find(function(k){return k.msid===R.vMsid}))&&(_.transceiver=void 0),R.aMsid&&(_=w.audioInfoList.find(function(k){return k.msid===R.aMsid}))&&(_.transceiver=void 0))},v.prototype.markAlreadySubPub=function(g,R){R===void 0&&(R={}),g=(0,h.pruneSubUrl)(g,!0);var _,w=this.streamMap[g];w&&(R.vMsid&&(_=w.videoInfoList.find(function(k){return k.msid===R.vMsid}))&&(_[R.isPub?"pubDone":"subDone"]=!R.reset),R.aMsid&&(_=w.audioInfoList.find(function(k){return k.msid===R.aMsid}))&&(_[R.isPub?"pubDone":"subDone"]=!R.reset))},v.prototype.isMsidSubPubDone=function(g,R){R===void 0&&(R={}),g=(0,h.pruneSubUrl)(g,!0);var _=this.streamMap[g];if(!_)return!1;if(R.vMsid){var w=_.videoInfoList.find(function(k){return k.msid===R.vMsid});return R.isPub?w==null?void 0:w.pubDone:w==null?void 0:w.subDone}return R.aMsid?(w=_.audioInfoList.find(function(k){return k.msid===R.aMsid}),R.isPub?w==null?void 0:w.pubDone:w==null?void 0:w.subDone):void 0},v.prototype.getAllMediaInfoList=function(g,R){var _=this.get(g);return _?S(S([],_.audioInfoList.map(function(w){var k,O,C,b,A=w.type,T=w.msid,M=w.ssrc,D=w.pt,N=w.codec,P=w.from,I=w.transceiver,L={type:A,msid:T,ssrc:M,pt:D,codec:N,from:P,trackId:_.type===l.Subscribe?(O=(k=I==null?void 0:I.receiver)===null||k===void 0?void 0:k.track)===null||O===void 0?void 0:O.id:(b=(C=I==null?void 0:I.sender)===null||C===void 0?void 0:C.track)===null||b===void 0?void 0:b.id};return R?y(y({},L),{transceiver:I}):L}),!0),_.videoInfoList.map(function(w){var k,O,C,b,A=w.type,T=w.msid,M=w.ssrc,D=w.pt,N=w.codec,P=w.from,I=w.transceiver,L={type:A,msid:T,ssrc:M,pt:D,codec:N,from:P,trackId:_.type===l.Subscribe?(O=(k=I==null?void 0:I.receiver)===null||k===void 0?void 0:k.track)===null||O===void 0?void 0:O.id:(b=(C=I==null?void 0:I.sender)===null||C===void 0?void 0:C.track)===null||b===void 0?void 0:b.id};return R?y(y({},L),{transceiver:I}):L}),!0):[]},v.prototype.getOriginUrl=function(g){var R=(0,h.pruneSubUrl)(g,!0),_=this.get(R);return _?_.originUrl:g},v.prototype.getAllTrackPairList=function(g){var R,_,w,k,O=[];for(var C in this.streamMap){var b=this.streamMap[C];if(b.type===g)for(var A=Math.max(b.audioInfoList.length,b.videoInfoList.length),T=0;T<A;T++){var M={url:C,originUrl:b.originUrl};T<b.audioInfoList.length&&(M.aTransceiver=g===l.Subscribe?(R=b.audioInfoList[T].transceiver)===null||R===void 0?void 0:R.receiver:(_=b.audioInfoList[T].transceiver)===null||_===void 0?void 0:_.sender,M.aMsid=b.audioInfoList[T].msid),T<b.videoInfoList.length&&(M.vTransceiver=g===l.Subscribe?(w=b.videoInfoList[T].transceiver)===null||w===void 0?void 0:w.receiver:(k=b.videoInfoList[T].transceiver)===null||k===void 0?void 0:k.sender,M.vMsid=b.videoInfoList[T].msid),O.push(M)}}return O},v.prototype.getSender=function(g,R,_){var w,k,O=void 0,C=this.getAllMediaInfoList(g,!0);return _?C.forEach(function(b){var A,T,M,D=(T=(A=b.transceiver)===null||A===void 0?void 0:A.sender)===null||T===void 0?void 0:T.track;(D==null?void 0:D.kind)===R&&b.msid===_&&(O=(M=b.transceiver)===null||M===void 0?void 0:M.sender)}):O=(k=(w=C==null?void 0:C.find(function(b){var A,T,M;return((M=(T=(A=b.transceiver)===null||A===void 0?void 0:A.sender)===null||T===void 0?void 0:T.track)===null||M===void 0?void 0:M.kind)===R}))===null||w===void 0?void 0:w.transceiver)===null||k===void 0?void 0:k.sender,O},v.prototype.getReceiver=function(g,R,_){var w,k,O=void 0,C=this.getAllMediaInfoList(g,!0);return _?C.forEach(function(b){var A,T,M,D=(T=(A=b.transceiver)===null||A===void 0?void 0:A.receiver)===null||T===void 0?void 0:T.track;(D==null?void 0:D.kind)===R&&b.msid===_&&(O=(M=b.transceiver)===null||M===void 0?void 0:M.receiver)}):O=(k=(w=C==null?void 0:C.find(function(b){var A,T,M;return((M=(T=(A=b.transceiver)===null||A===void 0?void 0:A.receiver)===null||T===void 0?void 0:T.track)===null||M===void 0?void 0:M.kind)===R}))===null||w===void 0?void 0:w.transceiver)===null||k===void 0?void 0:k.receiver,O},v.prototype.dispose=function(){this.streamMap={}},v.prototype.updateMediaInfoList=function(g,R){var _=R.findIndex(function(w){return w.msid===g.msid});_!==-1?R.splice(_,1,g):R.push(g)},v.prototype.findMediaItemByMsid=function(g,R){return R.find(function(_){return _.msid===g})},v.prototype.createMediaItem=function(g,R){return{msid:g,ssrc:void 0,transceiver:void 0,subDone:!1,pubDone:!1,type:R,streamId:void 0}},v}();m.StreamManager=p},372:E=>{E.exports=window.BrowserUtil},985:E=>{E.exports=window.SystemUtil}},c={};function u(E){var m=c[E];if(m!==void 0)return m.exports;var f=c[E]={exports:{}};return a[E].call(f.exports,f,f.exports,u),f.exports}var d={};return(()=>{var E=d;Object.defineProperty(E,"__esModule",{value:!0}),E.DataChannelCore=E.EDatachannelStatus=E.PeerConnectionCore=void 0;var m=u(776);Object.defineProperty(E,"PeerConnectionCore",{enumerable:!0,get:function(){return m.PeerConnectionCore}}),Object.defineProperty(E,"EDatachannelStatus",{enumerable:!0,get:function(){return m.EDatachannelStatus}});var f=u(651);Object.defineProperty(E,"DataChannelCore",{enumerable:!0,get:function(){return f.DataChannelCore}})})(),d})(),o.exports=s()},2632:(o,s,a)=>{a.r(s),a.d(s,{default:()=>S});function c(l,h,p){Object.defineProperty(l,h,{writable:!0,enumerable:!0,configurable:!0,value:p})}Array(32);var u,d,E;class m{constructor(h){var p,v;this.timer=null,this.time=10,this.count=10,this.arr=[],this.time=(p=h.time)!=null?p:10,this.count=(v=h.count)!=null?v:10,h.host.startsWith("http://")||h.host.startsWith("https://")?this.url=h.host+"/logstores/"+h.logstore+"/track":this.url="https://"+h.project+"."+h.host+"/logstores/"+h.logstore+"/track",this.opt=h,h.installUnloadHook&&typeof h.installUnloadHook=="function"&&h.installUnloadHook(()=>{this.sendImmediateInner()})}assemblePayload(h=this.arr){const p={__logs__:h};return this.opt.tags&&(p.__tags__=this.opt.tags),this.opt.topic&&(p.__topic__=this.opt.topic),this.opt.source&&(p.__source__=this.opt.source),JSON.stringify(p)}platformSend(){if(this.opt.sendPayload&&typeof this.opt.sendPayload=="function"){const h=this.assemblePayload();this.opt.sendPayload(this.url,h)}}transString(h){let p={};for(let v in h)typeof h[v]=="object"?p[v]=JSON.stringify(h[v]):p[v]=String(h[v]);return p}sendImmediateInner(){this.arr&&this.arr.length>0&&(this.platformSend(),this.timer!=null&&(clearTimeout(this.timer),this.timer=null),this.arr=[])}sendInner(){if(this.timer)this.arr.length>=this.count&&(clearTimeout(this.timer),this.timer=null,this.sendImmediateInner());else{const h=this;this.arr.length>=this.count||this.time<=0?this.sendImmediateInner():this.timer=setTimeout(function(){h.sendImmediateInner()},1e3*this.time)}}send(h){const p=this.transString(h);this.arr.push(p),this.sendInner()}sendImmediate(h){const p=this.transString(h);this.arr.push(p),this.sendImmediateInner()}sendBatchLogs(h){const p=h.map(v=>this.transString(v));this.arr.push(...p),this.sendInner()}sendBatchLogsImmediate(h){const p=h.map(v=>this.transString(v));this.arr.push(...p),this.sendImmediateInner()}}function f(l,h){const p=new window.XMLHttpRequest;p.open("POST",`${l}?APIVersion=0.6.0`,!0),p.send(h)}function y(l,h){try{if(h.length>=32768)return void f(l,h);(function(p,v){return!(!navigator||!navigator.sendBeacon)&&navigator.sendBeacon(`${p}?APIVersion=0.6.0`,v)})(l,h)||f(l,h)}catch(p){window&&window.console&&typeof window.console.error=="function"&&(console.error(`Failed to log to ali log service because of this exception:
`+p),console.error("Failed log data:",l))}}class S extends m{constructor(h){super(Object.assign({},h,{installUnloadHook:p=>{window.addEventListener("beforeunload",()=>{p()})},sendPayload:(p,v)=>{y(p,v)}}))}}u=window,d="SLS_Tracker",E=S,c(u,d,E)},4198:o=>{o.exports=JSON.parse('{"name":"axios","version":"0.21.4","description":"Promise based HTTP client for the browser and node.js","main":"index.js","scripts":{"test":"grunt test","start":"node ./sandbox/server.js","build":"NODE_ENV=production grunt build","preversion":"npm test","version":"npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json","postversion":"git push && git push --tags","examples":"node ./examples/server.js","coveralls":"cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js","fix":"eslint --fix lib/**/*.js"},"repository":{"type":"git","url":"https://github.com/axios/axios.git"},"keywords":["xhr","http","ajax","promise","node"],"author":"Matt Zabriskie","license":"MIT","bugs":{"url":"https://github.com/axios/axios/issues"},"homepage":"https://axios-http.com","devDependencies":{"coveralls":"^3.0.0","es6-promise":"^4.2.4","grunt":"^1.3.0","grunt-banner":"^0.6.0","grunt-cli":"^1.2.0","grunt-contrib-clean":"^1.1.0","grunt-contrib-watch":"^1.0.0","grunt-eslint":"^23.0.0","grunt-karma":"^4.0.0","grunt-mocha-test":"^0.13.3","grunt-ts":"^6.0.0-beta.19","grunt-webpack":"^4.0.2","istanbul-instrumenter-loader":"^1.0.0","jasmine-core":"^2.4.1","karma":"^6.3.2","karma-chrome-launcher":"^3.1.0","karma-firefox-launcher":"^2.1.0","karma-jasmine":"^1.1.1","karma-jasmine-ajax":"^0.1.13","karma-safari-launcher":"^1.0.0","karma-sauce-launcher":"^4.3.6","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","load-grunt-tasks":"^3.5.2","minimist":"^1.2.0","mocha":"^8.2.1","sinon":"^4.5.0","terser-webpack-plugin":"^4.2.3","typescript":"^4.0.5","url-search-params":"^0.10.0","webpack":"^4.44.2","webpack-dev-server":"^3.11.0"},"browser":{"./lib/adapters/http.js":"./lib/adapters/xhr.js"},"jsdelivr":"dist/axios.min.js","unpkg":"dist/axios.min.js","typings":"./index.d.ts","dependencies":{"follow-redirects":"^1.14.0"},"bundlesize":[{"path":"./dist/axios.min.js","threshold":"5kB"}]}')}},n={};function i(o){var s=n[o];if(s!==void 0)return s.exports;var a=n[o]={exports:{}};return r[o].call(a.exports,a,a.exports,i),a.exports}return i.n=o=>{var s=o&&o.__esModule?()=>o.default:()=>o;return i.d(s,{a:s}),s},i.d=(o,s)=>{for(var a in s)i.o(s,a)&&!i.o(o,a)&&Object.defineProperty(o,a,{enumerable:!0,get:s[a]})},i.o=(o,s)=>Object.prototype.hasOwnProperty.call(o,s),i.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},i(8156)})())})(Ov);var We=Ov.exports,Dv={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function i(c,u,d){this.fn=c,this.context=u,this.once=d||!1}function o(c,u,d,E,m){if(typeof d!="function")throw new TypeError("The listener must be a function");var f=new i(d,E||c,m),y=r?r+u:u;return c._events[y]?c._events[y].fn?c._events[y]=[c._events[y],f]:c._events[y].push(f):(c._events[y]=f,c._eventsCount++),c}function s(c,u){--c._eventsCount===0?c._events=new n:delete c._events[u]}function a(){this._events=new n,this._eventsCount=0}a.prototype.eventNames=function(){var u=[],d,E;if(this._eventsCount===0)return u;for(E in d=this._events)t.call(d,E)&&u.push(r?E.slice(1):E);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(d)):u},a.prototype.listeners=function(u){var d=r?r+u:u,E=this._events[d];if(!E)return[];if(E.fn)return[E.fn];for(var m=0,f=E.length,y=new Array(f);m<f;m++)y[m]=E[m].fn;return y},a.prototype.listenerCount=function(u){var d=r?r+u:u,E=this._events[d];return E?E.fn?1:E.length:0},a.prototype.emit=function(u,d,E,m,f,y){var S=r?r+u:u;if(!this._events[S])return!1;var l=this._events[S],h=arguments.length,p,v;if(l.fn){switch(l.once&&this.removeListener(u,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,d),!0;case 3:return l.fn.call(l.context,d,E),!0;case 4:return l.fn.call(l.context,d,E,m),!0;case 5:return l.fn.call(l.context,d,E,m,f),!0;case 6:return l.fn.call(l.context,d,E,m,f,y),!0}for(v=1,p=new Array(h-1);v<h;v++)p[v-1]=arguments[v];l.fn.apply(l.context,p)}else{var g=l.length,R;for(v=0;v<g;v++)switch(l[v].once&&this.removeListener(u,l[v].fn,void 0,!0),h){case 1:l[v].fn.call(l[v].context);break;case 2:l[v].fn.call(l[v].context,d);break;case 3:l[v].fn.call(l[v].context,d,E);break;case 4:l[v].fn.call(l[v].context,d,E,m);break;default:if(!p)for(R=1,p=new Array(h-1);R<h;R++)p[R-1]=arguments[R];l[v].fn.apply(l[v].context,p)}}return!0},a.prototype.on=function(u,d,E){return o(this,u,d,E,!1)},a.prototype.once=function(u,d,E){return o(this,u,d,E,!0)},a.prototype.removeListener=function(u,d,E,m){var f=r?r+u:u;if(!this._events[f])return this;if(!d)return s(this,f),this;var y=this._events[f];if(y.fn)y.fn===d&&(!m||y.once)&&(!E||y.context===E)&&s(this,f);else{for(var S=0,l=[],h=y.length;S<h;S++)(y[S].fn!==d||m&&!y[S].once||E&&y[S].context!==E)&&l.push(y[S]);l.length?this._events[f]=l.length===1?l[0]:l:s(this,f)}return this},a.prototype.removeAllListeners=function(u){var d;return u?(d=r?r+u:u,this._events[d]&&s(this,d)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,e.exports=a})(Dv);var CE=Dv.exports;const Ut=S0(CE);var wE=Object.defineProperty,AE=Object.defineProperties,kE=Object.getOwnPropertyDescriptors,Ya=Object.getOwnPropertySymbols,PE=Object.getPrototypeOf,Mv=Object.prototype.hasOwnProperty,Nv=Object.prototype.propertyIsEnumerable,IE=Reflect.get,Al=(e,t,r)=>t in e?wE(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Ne=(e,t)=>{for(var r in t||(t={}))Mv.call(t,r)&&Al(e,r,t[r]);if(Ya)for(var r of Ya(t))Nv.call(t,r)&&Al(e,r,t[r]);return e},bi=(e,t)=>AE(e,kE(t)),Jo=(e,t)=>{var r={};for(var n in e)Mv.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&Ya)for(var n of Ya(e))t.indexOf(n)<0&&Nv.call(e,n)&&(r[n]=e[n]);return r},B=(e,t,r)=>(Al(e,typeof t!="symbol"?t+"":t,r),r),Lv=(e,t,r)=>IE(PE(e),r,t),Q=(e,t,r)=>new Promise((n,i)=>{var o=c=>{try{a(r.next(c))}catch(u){i(u)}},s=c=>{try{a(r.throw(c))}catch(u){i(u)}},a=c=>c.done?n(c.value):Promise.resolve(c.value).then(o,s);a((r=r.apply(e,t)).next())}),OE=Object.defineProperty,DE=(e,t,r)=>t in e?OE(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Ii=(e,t,r)=>(DE(e,typeof t!="symbol"?t+"":t,r),r),cu={exports:{}},uu={exports:{}},lu,Mp;function cr(){if(Mp)return lu;Mp=1,Date.now=Date.now||function(){return new Date().getTime()};var e=Date.now(),t=function(){},r=function(){var i=typeof console=="object"?console.warn:t;try{var o={warn:i};o.warn.call(o)}catch{return t}return i},n={noop:t,warn:r(),key:"__bl",selfErrKey:"ARMS_SDK_ERROR",selfErrPage:"ARMSSDK",win:typeof window=="object"&&window.document?window:void 0,regionMap:{cn:"https://arms-retcode.aliyuncs.com/r.png?",sg:"https://arms-retcode-sg.aliyuncs.com/r.png?",sg_2:"https://retcode-sg-lazada.arms.aliyuncs.com/r.png?",daily:"http://arms-retcode-daily.alibaba.net/r.png?",daily_2:"https://arms-retcode-daily.alibaba.net/r.png?",daily_3:"http://arms-retcode-daily.aliyun.test/r.png?",us:"https://retcode-us-west-1.arms.aliyuncs.com/r.png?",tw:"https://arms-retcode.orientalgame.com.tw/r.png?",tw_sg:"https://arms-retcode-sg.orientalgame.com.tw/r.png?",hz_finance:"https://arms-retcode-hz-finance.aliyuncs.com/r.png?"},defaultImgUrl:"https://arms-retcode.aliyuncs.com/r.png?",createObject:function(i){if(Object.create)return Object.create(i);var o=function(){};return o.prototype=i,new o},each:function(i,o){var s=0,a=i.length;if(this.T(i,"Array"))for(;s<a&&o.call(i[s],i[s],s)!==!1;s++);else for(s in i)if(o.call(i[s],i[s],s)===!1)break;return i},safetyCall:function(i,o,s){if(typeof i!="function")return s;try{return i.apply(this,o)}catch{return s}},T:function(i,o){var s=Object.prototype.toString.call(i).substring(8).replace("]","");return o?s===o:s},duration:function(){var i=Date;try{performance&&this.T(performance.now,"Function")&&(i=performance)}catch{i=Date}var o=i.now();return function(){return Math.round(i.now()-o)}},filterByRule:function(){var i=[].slice.call(arguments),o=i.length;if(o<2)return i[0];var s=i[o-1],a=i[0];if(!a)return"";if(!s)return a;var c=this,u=c.T(s),d=i.slice(0,o-1);return u==="Function"?c.safetyCall(s,d,a):u==="Array"?(this.each(s,function(E){d[0]=a=c.filterByRule.apply(c,[].concat(d,E))}),a):u==="Object"?a.replace(s.rule,s.target||""):a.replace(s,"")},ignoreByRule:function(i,o){if(!i||!o)return!1;if((this.isString(o)||o.source||this.T(o)==="Function")&&(o=[o]),!this.isArray(o))return this.warn("[arms] invalid rules of ignore config, (list of) String/RegExp/Funcitons are available"),!1;for(var s,a=[],c=0,u=o.length;c<u;c++)if(s=o[c],this.isString(s))a.push(s.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"));else if(s&&s.source)a.push(s.source);else if(s&&this.T(s)==="Function"&&this.safetyCall(s,[i],!1)===!0)return!0;var d=new RegExp(a.join("|"),"i");return!!(a.length&&d.test&&d.test(i))},J:function(i){if(!i||typeof i!="string")return i;var o=null;try{o=JSON.parse(i)}catch{}return o},pick:function(i){return i===1||Math.ceil(Math.random()*i)===1},verifyConfig:function(i){if("sample"in i){var o=i.sample,s=o;o&&/^\d+(\.\d+)?%$/.test(o)&&(s=parseInt(100/parseFloat(o))),0<s&&1>s&&(s=parseInt(1/s)),s>=1&&s<=100?i.sample=s:delete i.sample}return i},on:function(i,o,s,a,c){return i.addEventListener?(c=c||!1,i.addEventListener(o,function u(d){a&&i.removeEventListener(o,u,c),s.call(this,d)},c)):i.attachEvent&&i.attachEvent("on"+o,function u(d){a&&i.detachEvent("on"+o,u),s.call(this,d)}),this},off:function(i,o,s){return s?(i.removeEventListener?i.removeEventListener(o,s):i.detachEvent&&i.detachEvent(o,s),this):this},delay:function(i,o){return o===-1?(i(),null):setTimeout(i,o||0)},ext:function(i){for(var o=1,s=arguments.length;o<s;o++){var a=arguments[o];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(i[c]=a[c])}return i},sub:function(i,o){var s={};return this.each(i,function(a,c){o.indexOf(c)!==-1&&(s[c]=a)}),s},uu:function(){for(var i,o,s=20,a=new Array(s),c=Date.now().toString(36).split("");s-- >0;)o=(i=36*Math.random()|0).toString(36),a[s]=i%3?o:o.toUpperCase();for(var u=0;u<8;u++)a.splice(3*u+2,0,c[u]);return a.join("")},guid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){var o=16*Math.random()|0;return(i==="x"?o:3&o|8).toString(16)})},seq:function(){return(e++).toString(36)},decode:function(i){try{i=decodeURIComponent(i)}catch{}return i},encode:function(i,o){try{i=o?encodeURIComponent(i).replace(/\(/g,"%28").replace(/\)/g,"%29"):encodeURIComponent(i)}catch{}return i},serialize:function(i){i=i||{};var o=[];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&i[s]!==void 0&&o.push(s+"="+this.encode(i[s],s==="msg"));return o.join("&")},checkAPI:function(i,o){if(!i||typeof i!="string")return!1;var s=/arms-retcode[\w-]*\.aliyuncs/.test(i);return!s&&o&&(s=/(alicdn\.com)|(mmstat\.com)/.test(i)),!s},checkAutoError:function(i){return!(!i||!i.message)&&!/failed[\w\s]+fetch/i.test(i.message)},cutUrlSearch:function(i){return i&&typeof i=="string"?i.replace(/^(https?:)?\/\//,"").replace(/\?.*$/,""):""},removeUrlSearch:function(i){return i&&typeof i=="string"?i.replace(/\?.*$/,""):""},createFakeToString:function(i){return function(){return i+"() { [native code] }"}},checkSameOrigin:function(i,o){if(!o||!i)return!1;var s="//"+o.split("/")[2];return i===o||i.slice(0,o.length+1)===o+"/"||i===s||i.slice(0,s.length+1)===s+"/"||!/^(\/\/|http:|https:).*/.test(i)},getRandIP:function(){for(var i=[],o=0;o<4;o++){var s=Math.floor(256*Math.random());i[o]=(s>15?"":"0")+s.toString(16)}return i.join("").replace(/^0/,"1")},getSortNum:function(i){return i?(i+=1)>=1e3&&i<=9999?i:i<1e3?i+1e3:i%1e4+1e3:1e3},getRandNum:function(i){return i&&typeof i=="string"?i.length<5?this.getNum(5):i.substring(i.length-5):this.getNum(5)},getNum:function(i){for(var o=[],s=0;s<i;s++){var a=Math.floor(16*Math.random());o[s]=a.toString(16)}return o.join("")},getCurDomain:function(){return location&&location.hostname||""},getSrcType:function(i,o){var s=location&&location.host||"";if(!s)return"";var a=new URL(i).host;if(a===s)return"self";for(var c=0;c<o.length;c+=1)if(a.includes(o[c]))return"cdn";return"others"},parseFetchHeaders:function(i){if(!i)return{};var o={};try{if(typeof i.keys=="function")for(var s=i.keys(),a=s.next();!a.done;){var c=a.value;o[c]=i.get(c),a=s.next()}else o=i}catch{o={}}return o},parseXhrHeaders:function(i){if(!i&&typeof i!="string")return{};var o={};try{var s=i.split(`\r
`);o=s.reduce(function(a,c){var u=c.split(": ");return a[u[0]]=u[1],a},{})}catch{o={}}return o},getQuerys:function(i){if(!i)return"";var o={},s=[],a="",c="";try{var u=[];if(i.indexOf("?")>=0&&(u=i.substring(i.indexOf("?")+1,i.length).split("&")),u.length>0)for(var d in u)a=(s=u[d].split("="))[0],c=s[1],o[a]=c}catch{o={}}return o},getURL:function(i){if(!i)return null;var o={},s=i.length,a=i.indexOf("://");if(a<0)return null;o.protocol=i.substring(0,a+1);var c=i.indexOf("#"),u=i.indexOf("?");c<0&&(c=s),u<0&&(u=c),o.search=i.substring(u,c).substring(0,1e3);var d=i.substring(a+3,u),E=d.indexOf("/");return E<0&&(E=d.length),o.domain=d.substring(0,E).split(":")[0],o.path=d.substring(E,d.length).substring(0,1e3),o},getResType:function(i,o){if(["script","img","other"].indexOf(i)>-1)return i;if(["video"].indexOf(i)>-1)return"media";if(["document","iframe"].indexOf(i)>-1)return"doc";var s=o?this.getURL(o):null,a=s&&s.path?s.path.lastIndexOf("."):-1,c=(a>0?s.path.substr(a+1):"").toLowerCase();if(c){if(["eot","woff","woff2","ttf"].indexOf(c)>-1)return"font";if(c==="css")return"css";if(c==="js")return"script"}return["fetch","xmlhttprequest","beacon"].indexOf(i)>-1?"api":"others"},areInOrder:function(){for(var i=1;i<arguments.length;i+=1)if(arguments[i-1]>arguments[i])return!1;return!0},getFetchSnapshot:function(i,o,s){var a,c;try{var u=(i&&typeof i[0]!="string"?i[0].url:i[0])||"",d=(i&&typeof i[0]!="string"?i[0]:i[1])||{},E=d.method.toUpperCase()==="POST"?d.body:this.getQuerys(u);a={originApi:u,method:d.method||"unknown",params:E,response:o||"",reqHeaders:this.parseFetchHeaders(d.headers||null),resHeaders:this.parseFetchHeaders(s)},c=JSON&&JSON.stringify(a)||"{}"}catch{c="{}"}return c},getXhrSnapshot:function(i,o,s){if(!i||!o||!s)return{};var a,c;try{var u="";s.responseType===""||s.responseType==="text"?u=s.responseText:s.responseType==="document"&&(u=s.responseXML),a={originApi:i,method:o,params:this.getQuerys(i),response:u,reqHeaders:{},resHeaders:this.parseXhrHeaders(typeof s.getAllResponseHeaders=="function"&&s.getAllResponseHeaders()||"")},c=JSON&&JSON.stringify(a)||"{}"}catch{c="{}"}return c},isRobot:function(){var i=["nuhk","googlebot/","googlebot-image","yammybot","openbot","slurp","msnbot","ask jeeves/teoma","ia_archiver","baiduspider","bingbot/","adsbot"];if(!navigator||typeof navigator.userAgent!="string")return!1;try{for(var o=navigator.userAgent.toLowerCase(),s=0;s<i.length;s++){var a=i[s];if(o.lastIndexOf(a)>=0)return!0}}catch{this.warn("[arms] useragent parse error")}return!1},isFunction:function(i){return typeof i=="function"},isPlainObject:function(i){return Object.prototype.toString.call(i)==="[object Object]"},isString:function(i){return Object.prototype.toString.call(i)==="[object String]"},isArray:function(i){return Object.prototype.toString.call(i)==="[object Array]"},joinRegExp:function(i){for(var o,s=[],a=0,c=i.length;a<c;a++)o=i[a],this.isString(o)?s.push(o.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")):o&&o.source&&s.push(o.source);return new RegExp(s.join("|"),"i")},reWriteMethod:function(i,o,s){if(i!==null){var a=i[o];i[o]=s(a)}},checkSDKError:function(i,o){return!i&&!o?!1:new RegExp(this.selfErrKey,"i").test(i)?!0:!!this.ignoreByRule(o,[/retcode.alicdn.com\/retcode\/bl.js/,/g.alicdn.com\/retcode\/cloud-sdk\/bl.js/,/laz-g-cdn.alicdn.com\/retcode\/cloud-sdk\/bl.js/,/local.taobao.com:8880\/build\/bl/])},sdkError:function(i){return{msg:i,message:this.selfErrKey}},dealParam:function(i,o,s){var a={};try{a=this.isPlainObject(i)?this.ext({key:i.key||"default",val:i.val||i.value||s},i,{begin:Date.now()}):{key:i||"default",val:o||s,begin:Date.now()}}catch(c){this.warn("[retcode] baseLog error: "+c)}return a}};return lu=n,lu}var du={exports:{}},hu={exports:{}},pu,Np;function ME(){if(Np)return pu;Np=1;var e=cr();return pu=function(t,r,n){typeof t=="object"&&(t=e.serialize(t));var i=r+t+(n?"&post_res=":"");window&&window.navigator&&typeof window.navigator.sendBeacon=="function"?window.navigator.sendBeacon(i,n||"&post_res="):e.warn("[arms] navigator.sendBeacon not surported")},pu}var Lp;function NE(){if(Lp)return hu.exports;Lp=1;var e=cr(),t=ME(),r="aokcdqn3ly@e629dabd48a9933",n=function(o,s){var a;if(s.t==="error"&&(a=o.requestQueue[0])&&a.t==="error"&&s.msg===a.msg)return s.times=a.times+1,void(o.requestQueue[0]=s);if(s.t==="behavior"){var c=o.requestQueue&&o.requestQueue.length;if(c>0&&o.requestQueue[c-1].t==="behavior"){var u=s.behavior||[];o.requestQueue[c-1].behavior.concat(u)}else o.requestQueue.push(s)}else o.requestQueue.unshift(s);return o.onReady(function(){o.requestTimmer=e.delay(function(){o.clear()},o.requestQueue[0]&&o.requestQueue[0].t==="error"?3e3:-1)}),!0},i=function(o){return this.ver="1.8.36-beta.12",this._conf=e.ext({},i.dftCon),this.sampleCache={},this.requestQueue=[],this.selfQueue=[],this.sdkFlag=!0,this.hash=e.seq(),this.resetPageview(),this.setConfig(o),this.rip=e.getRandIP(),this.record=999,this["EagleEye-TraceID"]=this.getTraceId()["EagleEye-TraceID"],this._common={},this};return i.dftCon={sample:1,pvSample:1,tag:"",imgUrl:"https://arms-retcode.aliyuncs.com/r.png?",region:null,ignore:{ignoreUrls:[],ignoreApis:[],ignoreErrors:[/^Script error\.?$/],ignoreResErrors:[],ignoreResources:[/\/(bl|wl)(.debug)?.js$/]},release:void 0,environment:"prod",beforeReport:null,parseTraceId:null},i.prototype={constructor:i,onReady:function(o){return o()},getPage:function(){var o=this._conf.page;return e.safetyCall(o,[],o+"")},setPage:function(){},setConfig:function(o){o&&typeof o=="object"&&(e.verifyConfig(o),o=this.setImgUrl(o),this._conf=e.ext({},this._conf,o))},setImgUrl:function(o){var s=o.region,a=o.imgUrl;if(s){var c=e.regionMap[s];return o.imgUrl=c||e.defaultImgUrl,o}return a&&(o.imgUrl=a),o},checkImgUrl:function(){return!0},sendRequest:function(){},sendBeacon:function(o,s,a){t(o,s||this.getConfig("imgUrl"),a)},postData:function(){},commonInfo:function(){return{}},setCommonInfo:function(o){o&&typeof o=="object"&&(this._common=e.ext({},this._common,o))},resetPageview:function(){this.pageview=e.uu(),this.sBegin=Date.now()},getUsername:function(){if(this.username)return this.username;var o=this._conf,s=o&&o.setUsername;if(typeof s=="function")try{var a=s();typeof a=="string"&&(a=a.substr(0,40),this.username=a)}catch(c){e.warn("[arms] setUsername fail",c)}return this.username},getTraceId:function(){var o=this.rip,s=Date.now(),a=e.getSortNum(this.record),c=o+s+a+e.getRandNum(this._conf.pid);return this["EagleEye-TraceID"]=c,this.record=a,{"EagleEye-TraceID":c}},getUberTraceId:function(o){var s=this.rip,a=Date.now(),c=e.getSortNum(this.record),u=e.getRandNum(this._conf.pid),d=s+a+c+e.getNum(2)+u,E=d.substring(0,16);return o=o?"1":"0",d[0]==="0"&&(d[0]="1"),d[16]==="0"&&(d[16]="1"),{"uber-trace-id":d+":"+E+":0:"+o,traceId:d}},getB3TraceId:function(o){var s=this.rip,a=Date.now(),c=e.getSortNum(this.record),u=e.getRandNum(this._conf.pid),d=s+a+c+e.getNum(2)+u,E=d.substring(0,16);return o=o?"1":"0",d[0]==="0"&&(d[0]="1"),d[16]==="0"&&(d[16]="1"),{b3:d+"-"+E+"-"+o+"-0","X-B3-TraceId":d,"X-B3-ParentSpanId":"0","X-B3-SpanId":E,"X-B3-Sampled":o}},getPageviewId:function(){return{"EagleEye-SessionID":this.pageview}},getConfig:function(o){return o?this._conf[o]:e.ext({},this._conf)},sampling:function(o){return o===1||(typeof this.sampleCache[o]=="boolean"?this.sampleCache[o]:(this.sampleCache[o]=e.pick(o),this.sampleCache[o]))},clear:function(o){var s;clearTimeout(this.requestTimmer),this.requestTimmer=null;for(var a=this._conf&&typeof this._conf.sendRequest=="function";s=this.requestQueue.pop();)if(s.t==="res")this.postData(s,"res");else if(s.t==="error")this.postData(s,"err");else if(s.t==="api")this.postData(s,"apiSnapshot");else if(s.t==="behavior")this.postData(s,"behavior");else if(s.t==="health"&&!a&&window&&window.navigator&&typeof window.navigator.sendBeacon=="function")this.sendBeacon(s);else if(s.t==="resource"&&!a&&window&&window.navigator&&typeof window.navigator.sendBeacon=="function"){var c=JSON.stringify({resource:s.resource});delete s.resource,this.sendBeacon(s,null,c)}else s.t==="resource"?this.postData(s,"resource"):this.sendRequest(s);return o&&this.clearSelf(),this},clearSelf:function(){var o;for(clearTimeout(this.Timmer),this.Timmer=null;o=this.selfQueue.pop();)this.postData(o,"err");return this},_lg:function(o,s,a,c){var u=this,d=u._conf,E=u.getPage(),m=d.ignore||{},f=m.ignoreErrors,y=m.ignoreResErrors,S=m.ignoreUrls,l=m.ignoreApis;if(u._isRobot||e.ignoreByRule(E,S)||e.ignoreByRule(e.decode(E),S)||o==="error"&&(e.ignoreByRule(s.msg,f)||e.ignoreByRule(e.decode(s.msg),f))||o==="resourceError"&&(e.ignoreByRule(s.src,y)||e.ignoreByRule(e.decode(s.src),y))||o==="api"&&(e.ignoreByRule(s.api,l)||e.ignoreByRule(e.decode(s.api),l))||!u.checkImgUrl(d.imgUrl)||!s||d.disabled||!d.pid||c===0)return u;var h=s.dl;if(delete s.dl,s=e.ext({t:o,times:1,page:E,tag:d.tag||"",release:d.release||"",environment:d.environment,begin:Date.now(),c1:d.c1,c2:d.c2,c3:d.c3},s,u.commonInfo(),u._common,{pid:d.pid,_v:u.ver,pv_id:u.pageview,username:u.getUsername(),sampling:a||1,dl:h,z:e.seq()}),e.T(d.beforeReport)==="Function")try{if(!(s=d.beforeReport(s)))return u}catch{return u}return c===1?n(u,s):a&&!u.sampling(a)?u:n(u,s)},_self:function(o,s,a){var c=this,u=c._conf;if(o!=="error"||!c.checkImgUrl(u.imgUrl)||!s||u.disabled||!u.pid||!r||a&&!c.sampling(a))return c;s=e.ext({t:o,times:1,page:e.selfErrPage,tag:u.pid,begin:Date.now()},s,{pid:r,_v:c.ver,sampling:a||1,z:e.seq()});var d=c.selfQueue[0];if(d){d.times++;try{d.err&&s.err&&d.err.msg_raw&&s.err.msg_raw&&d.err.msg_raw.split("&").indexOf(s.err.msg_raw)<0&&d.err.msg_raw.length<1e3&&(d.err.msg_raw+="&"+s.err.msg_raw)}catch{}}else c.selfQueue.unshift(s),c.onReady(function(){c.sdkFlag&&(c.sdkFlag=!1,c.Timmer=e.delay(function(){c.clearSelf()},1e4))})},custom:function(o,s){if(!o||typeof o!="object")return this;var a=!1,c={begin:Date.now()};return e.each(o,function(u,d){return!(a=d&&d.length<=20)&&e.warn("[retcode] invalid key: "+d),c["x-"+d]=u,a}),a?this._lg("custom",c,s||1):this}},hu.exports=i,hu.exports}var xp;function LE(){if(xp)return du.exports;xp=1;var e=cr(),t=NE(),r=["api","success","time","code","msg","trace","traceId","begin","pv_id","sid","seq","domain","flag","apiSnapshot","tag","c1","c2","c3"],n=function(o){var s=(o.key||"default").split("::");return s.length>1?e.ext(o,{group:s[0],key:s[1]}):e.ext(o,{group:"default_group",key:s[0]})},i=function(o){t.call(this,o);var s;try{s=typeof performance=="object"?performance.timing.fetchStart:Date.now()}catch{s=Date.now()}return this._startTime=s,this};return i.prototype=e.createObject(t.prototype),e.ext(t.dftCon,{startTime:null}),e.ext(i.prototype,{constructor:i,_super:t,sum:function(o,s,a){try{var c=e.dealParam(o,s,1);return this._lg("sum",n(c),a)}catch(u){e.warn("[retcode] can not get parseStatData: "+u)}},avg:function(o,s,a){try{var c=e.dealParam(o,s,0);return this._lg("avg",n(c),a)}catch(u){e.warn("[retcode] can not get parseStatData: "+u)}},percent:function(o,s,a,c){try{return this._lg("percent",n({key:o,subkey:s,val:a||0,begin:Date.now()}),c)}catch(u){e.warn("[retcode] can not get parseStatData: "+u)}},msg:function(o,s){if(o&&!(o.length>180))return this.custom({msg:o},s)},error:function(o,s){if(!o)return e.warn("[retcode] invalid param e: "+o),this;arguments.length===1?(typeof o=="string"&&(o={message:o},s={}),typeof o=="object"&&(s=o=o.error||o)):(typeof o=="string"&&(o={message:o}),typeof s!="object"&&(s={}));var a=o.name||"CustomError",c=o.message||"",u=o.stack||"";s=s||{};var d=typeof location=="object"&&typeof location.href=="string"&&location.href.substring(0,500)||"";if(e.checkSDKError(c,s.filename)){var E=/^Script error\.?$/,m=o.msg||o.message;if(e.ignoreByRule(m,E)||e.ignoreByRule(e.decode(m),E))return this;var f={msg:e.selfErrKey,err:{msg_raw:e.encode(o.msg||o.message)}};return this._self("error",f,1)}for(var y={begin:Date.now(),cate:a,msg:c&&c.substring(0,1e3),stack:u&&u.substring(0,1e3),file:e.removeUrlSearch(s.filename||""),line:s.lineno||"",col:s.colno||"",err:{msg_raw:e.encode(c),stack_raw:e.encode(u)},dl:d},S=["tag","c1","c2","c3"],l=0;l<S.length;l++){var h=S[l];s[h]&&(y[h]=s[h])}var p=(this.getConfig("ignore")||{}).ignoreErrors;return e.ignoreByRule(y.msg,p)||e.ignoreByRule(e.decode(y.msg),p)?this:(this.beforeSend&&this.beforeSend("error",y),this._lg("error",y,1))},behavior:function(o){if(o){var s=typeof o=="object"&&o.behavior?o:{behavior:o};return this.beforeSend&&this.beforeSend("behavior",s),this._lg("behavior",s,1)}},api:function(o,s,a,c,u,d,E,m,f,y,S,l,h,p,v,g){if(!o)return e.warn("[retcode] api is null"),this;if(o=typeof o=="string"?{api:o,success:s,time:a,code:c,msg:u,begin:d,traceId:E,pv_id:m,apiSnapshot:f,domain:y,flag:l,tag:h,c1:p,c2:v,c3:g}:e.sub(o,r),!e.checkAPI(o.api,!0))return this;o.code=o.code||"";var R=o.msg||"";if(R=typeof R=="string"?R.substring(0,1e3):R,o.msg=R,o.success=o.success?1:0,o.time=+o.time,o.begin=o.begin,o.traceId=o.traceId||"",o.pv_id=o.pv_id||"",o.domain=o.domain||"",o.flag=o.flag,o.dl=typeof location=="object"&&typeof location.href=="string"&&location.href.substring(0,500)||"",o.apiSnapshot&&(typeof o.apiSnapshot=="object"&&(o.apiSnapshot=JSON.stringify(o.apiSnapshot)),typeof o.apiSnapshot!="string"&&delete o.apiSnapshot,o.apiSnapshot.length>2e3&&(o.apiSnapshot=o.apiSnapshot.substring(0,2e3))),S&&(o.traceOrigin=S),!o.api||isNaN(o.time))return e.warn("[retcode] invalid time or api"),this;var _=(this.getConfig("ignore")||{}).ignoreApis;return e.ignoreByRule(o.api,_)||e.ignoreByRule(e.decode(o.api),_)?this:o.time<0?this:(this.beforeSend&&this.beforeSend("api",o),this._lg("api",o,o.success&&this.getConfig("sample"),o.flag))},speed:function(o,s,a){var c=this,u=this.getConfig("startTime")||this._startTime;return/^s(\d|1[0])$/.test(o)?(s=typeof s!="number"?Date.now()-u:s>=u?s-u:s,c.speedCache=c.speedCache||{},c.speedCache[o]=s,c.speedCache.begin=u,clearTimeout(c.speedTimmer),c.speedTimmer=setTimeout(function(){a||(c.speedCache.page=c.getPage(!0)),c._lg("speed",c.speedCache),c.speedCache=null},5e3),c):(e.warn("[retcode] invalid point: "+o),c)},performance:function(o){if(o&&typeof o=="object"&&!this.hasSendPerf){var s={},a={},c=this.getConfig("autoSendPerf");if(o.autoSend&&c)return a=e.ext(this.perfData||{},o),this.hasSendPerf=!0,this._lg("perf",a,this.getConfig("sample"));if(o.autoSend&&!c)return delete o.autoSend,this.perfData?(a=e.ext(this.perfData||{},o),this.hasSendPerf=!0,this._lg("perf",a,this.getConfig("sample"))):void(this.perfData=o);for(var u in o)(/^t([1-9]|1[0])$/.test(u)||u==="ctti"||u==="cfpt")&&(s[u]=o[u]);if(o.autoSend===!0||!c&&(c||this.perfData))return o.autoSend!==!0&&c===!1&&this.perfData?(s=e.ext(this.perfData||{},s),this.hasSendPerf=!0,this._lg("perf",s,this.getConfig("sample"))):void 0;this.perfData=e.ext(this.perfData||{},s)}},resource:function(o,s){if(!o||!e.isPlainObject(o))return e.warn("[arms] invalid param data: "+o),this;var a=Object.keys(o),c=["begin","dom","load","res","dl"],u=!1;for(var d in c)if(a.indexOf(c[d])<0){u=!0;break}if(u)return e.warn("[arms] lack param data: "+o),this;var E={begin:o.begin||Date.now(),dom:o.dom||"",load:o.load||"",res:e.isArray(o.res)?JSON.stringify(o.res):JSON.stringify([]),dl:o.dl||""};return this._lg("res",E,s)},event:function(o,s){if(typeof o=="object"&&o&&o.key){var a={},c=["key","success","time","c1","c2","c3"];for(var u in o)c.indexOf(u)>-1&&(a[u]=o[u]);a.success=o.success===!1?0:1,this._lg("event",a,s)}}}),i._super=t,i._root=t,t.Reporter=i,du.exports=i,du.exports}var fu={exports:{}},Up;function xE(){if(Up)return fu.exports;Up=1;var e=cr(),t=typeof window=="object"?window:{},r="catch",n=t.__oFetch_||t.fetch;return n=typeof n=="function"?n:void 0,fu.exports=function(i,o){var s=-1;typeof i=="object"&&(s=i.z,i=e.serialize(i));var a=o+i;if(n)return n(a,{method:"HEAD",mode:"no-cors"})[r](e.noop);if(t.document&&t.document.createElement){var c="__request_hold_"+s,u=t[c]=new Image;u.onload=u.onerror=function(){t[c]=void 0},u.src=a,u=null}},fu.exports}var mu={exports:{}},Vp;function UE(){if(Vp)return mu.exports;Vp=1;var e=cr(),t=typeof window=="object"?window:{},r=t.__oXMLHttpRequest_||t.XMLHttpRequest;return r=typeof r=="function"?r:void 0,mu.exports=function(n,i){try{var o=new r;o.open("POST",i,!0),o.setRequestHeader("Content-Type","text/plain"),o.send(JSON.stringify(n))}catch(s){e.warn(`[retcode] Failed to log, exception is :
`+s)}},mu.exports}var gu,Bp;function VE(){if(Bp)return gu;Bp=1;var e=cr();return gu=function(t,r){var n=[],i=null,o=r&&r.location&&r.location.href,s=void 0,a=null,c=function(m,f,y){if(m!==null){var S=m[f];m[f]=y(S)}},u=function(m){var f,y,S,l,h,p=[];if(!m||typeof m.tagName!="string")return"";if(p.push(m.tagName.toLowerCase()),typeof m.id=="string"&&p.push("#".concat(m.id)),typeof(f=m.className)=="string")for(y=f.split(/\s+/),h=0;h<y.length;h++)p.push(".".concat(y[h]));var v=["type","name","title","alt","data-arms-attr"];for(h=0;h<v.length;h++)S=v[h],typeof(l=m.getAttribute(S))=="string"&&p.push("[".concat(S,'="').concat(l,'"]'));return p.join("")},d=function(m,f){return function(y){if(y&&y!==a){a=y;var S;try{S=y.target}catch{S="<unknown>"}if(S.length!==0){var l={type:"ui.".concat(m),data:{message:function(h){if(!h||h.nodeType!==1)return"";for(var p=h||null,v=[],g=0,R=0,_=3,w="";p&&g++<5&&!((w=u(p))==="html"||g>1&&R+v.length*_+w.length>=80);)v.push(w),R+=w.length,p=p.parentNode;return v.reverse().join(" > ")}(S)},timestamp:Date.now()};m==="click"?i&&i.addBehavior(l):m==="keypress"&&(s||i&&i.addBehavior(l),clearTimeout(s),s=setTimeout(function(){s=void 0},100))}}}},E=function(){if(function(){var S=r&&r.chrome,l=S&&S.app&&S.app.runtime,h="history"in r&&!!r.history.pushState&&!!r.history.replaceState;return!l&&h}()){var m=function(S,l){var h={type:"navigation",data:{from:S,to:l}};i&&i.addBehavior(h),o=l},f=r.onpopstate;r.onpopstate=function(){for(var S=arguments.length,l=new Array(S),h=0;h<S;h++)l[h]=arguments[h];var p=r.location.href;if(m(o,p),f)return f.apply(this,l)};var y=function(S){return function(){for(var l=arguments.length,h=new Array(l),p=0;p<l;p++)h[p]=arguments[p];var v=h.length>2?h[2]:void 0;return v&&m(o,String(v)),S.apply(this,h)}};c(r.history,"pushState",y),c(r.history,"replaceState",y)}};e.ext(t.prototype,{addBehavior:function(m){if(this.getConfig("behavior")&&m&&typeof m=="object"){var f={},y=m.data||{};if(m.type)f=y;else{if(typeof y.name!="string"||typeof y.message!="string")return;f.name=y.name.substr(0,20),f.message=y.message.substr(0,200)}f.message&&(f.message=e.encode(f.message));var S={type:m.type||"custom",data:f||{},timestamp:m.timestamp||Date.now(),page:m.page||r&&r.location&&r.location.pathname};return n.push(S),n=n.slice(-100)}},getBehavior:function(){return n||[]},setBehavior:function(m){return m&&(n=m),n},reportBehavior:function(m){var f=this;f.getConfig("behavior")&&(f.sendBhTimer&&(clearTimeout(f.sendBhTimer),f.sendBhTimer=void 0),f.sendBhTimer=setTimeout(function(){n&&n.length>0&&(f.behavior(n),n=[],f.sendBhTimer=void 0,m&&typeof m=="function"&&m())},0))},initBehavior:function(){if(!this.hasInitBehavior&&!i){try{(function(){if(document&&document.referrer&&document.location){var f=document.referrer,y=document.location.href;if(f!==""){var S={type:"navigation",data:{from:f,to:y}};o=y,i&&i.addBehavior(S)}}})(),r&&r.document&&r.document.addEventListener&&(r.document.addEventListener("click",d("click"),!1),r.document.addEventListener("keypress",d("keypress"),!1)),E();var m=this.getConfig("enableConsole");m&&function(f){if(r&&r.console){var y=["debug","info","warn","log","error","assert"];e.isArray(f)&&(y=f);for(var S=0;S<y.length;S++){var l=y[S];l&&e.isString(l)&&r.console[l]&&typeof r.console[l]=="function"&&c(r.console,l,function(h){var p=l;return function(){for(var v=arguments.length,g=new Array(v),R=0;R<v;R++)g[R]=arguments[R];var _={type:"console",data:{level:p,message:g}};if(i&&i.addBehavior(_),p==="error")for(var w=0;w<g.length;w++){var k=g[w];k&&k.message&&k.stack&&i&&i.errorHandler(new ErrorEvent("error",{error:k,message:k.message}))}h&&Function.prototype.apply.call(h,r.console,g)}})}}}(m)}catch(f){e.warn("[arms] error in initBehavior",f)}i=this,this.hasInitBehavior=!0}return this}})},gu}var jp={},Fp;function Vd(){return Fp||(Fp=1,jp.TIMING_KEYS=["startTime","fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","requestStart","responseStart","responseEnd","","domInteractive","","domContentLoadedEventEnd","","loadEventStart","","msFirstPaint","secureConnectionStart","redirectStart","redirectEnd"]),jp}var vu,Hp;function BE(){if(Hp)return vu;Hp=1;var e=cr(),t=Vd(),r=t.TIMING_KEYS;return vu=function(){var n=e.win||{},i=n.performance;if(!i||typeof i!="object"||typeof i.getEntriesByType!="function")return null;var o={},s=i.timing||{},a=i.getEntriesByType("resource")||[];if(o.begin=s[r[1]]||Date.now(),typeof n.PerformanceNavigationTiming=="function"){var c=i.getEntriesByType("navigation")[0];c&&(s=c)}return e.each({dom:[10,8],load:[14,1]},function(u,d){var E=s[r[u[1]]],m=s[r[u[0]]];if(E>0&&m>0){var f=Math.round(m-E);f>=0&&f<6e5&&(o[d]=f)}}),o.res=JSON.stringify(a),o},vu}var Su,Wp;function jE(){if(Wp)return Su;Wp=1;var e=cr(),t=Vd(),r=t.TIMING_KEYS;return Su=function(){var n=e.win||{},i=n.performance;if(!i||typeof i!="object")return null;var o={},s=i.timing||{},a=Date.now(),c=1;if(typeof n.PerformanceNavigationTiming=="function"){var u=i.getEntriesByType("navigation")[0];u&&(s=u,c=2)}e.each({dns:[3,2],tcp:[5,4],ssl:[5,17],ttfb:[7,6],trans:[8,7],dom:[10,8],res:[14,12],firstbyte:[7,2],fpt:[8,1],tti:[10,1],ready:[12,1],load:[14,1]},function(y,S){var l=s[r[y[1]]],h=s[r[y[0]]];if(c===2||l>0&&h>0){var p=Math.round(h-l);p>=0&&p<6e5&&(o[S]=p)}});var d=n.navigator.connection,E=i.navigation||{};o.ct=d?d.effectiveType||d.type:"";var m=d&&(d.downlink||d.downlinkMax||d.bandwidth)||null;if((m=m>999?999:m)&&(o.bandwidth=m),o.navtype=E.type===1?"Reload":"Other",c===1&&s[r[16]]>0&&s[r[1]]>0){var f=s[r[16]]-s[r[1]];f>=0&&f<36e5&&(o.fpt=f)}return c===1&&s[r[1]]>0?o.begin=s[r[1]]:c===2&&o.load>0?o.begin=a-o.load:o.begin=a,o},Su}var zp,$p;function FE(){return $p||($p=1,zp=function(e,t,r){var n=cr(),i=BE(),o=jE(),s=null,a=r.documentElement,c=t.innerWidth||a.clientWidth||r.body.clientWidth,u=t.innerHeight||a.clientHeight||r.body.clientHeight,d=t.navigator.connection,E={sr:screen.width+"x"+screen.height,vp:c+"x"+u,ct:d?d.effectiveType||d.type:""},m={},f=function(S,l,h,p,v){if(l===void 0){var g,R;if(!m[S]){g=new RegExp(S+"=([^;]+)");try{R=g.exec(r.cookie)}catch(w){return n.warn("[retcode] can not get cookie:",w),null}R&&(m[S]=R[1])}return m[S]}var _=S+"="+l;_+="; path=/",h&&(_+="; max-age="+h);try{return r.cookie=_,!!r.cookie}catch(w){return n.warn("[retcode] can not set cookie: ",w),!1}},y=function(S){var l=S._conf.uid||f("_nk_")||f("_bl_uid");return!l&&(l=n.uu(),!f("_bl_uid",l,15552e3))?null:l};return n.ext(e.prototype,{activeErrHandler:function(S){return s&&!S?this:(s=this,this)},errorHandler:function(S){if(!S)return this;var l=S.type;if(l==="error"){var h=S.target||S.srcElement;!h||!h.tagName||S.message||S.filename||S.lineno||S.colno?this.error(S.error||{message:S.message},S):this.resourceErrorHandler(S)}else l==="unhandledrejection"&&n.T(S.reason,"Error")&&n.checkAutoError(S.reason)&&this.error(S.reason);try{this.getConfig("behavior")&&this.reportBehavior&&this.reportBehavior()}catch{}return this},resourceErrorHandler:function(S){var l=this,h=S.target||S.srcElement;try{var p=l.getSrc(h),v=typeof h.tagName=="string"?h.tagName.toLowerCase():"",g=l.getXPath(h,5),R=n.getURL(p),_={src:p&&p.substring(0,1e3),node_name:v,xpath:g,res_type:n.getResType(v,p),res_name:R.path,domain:R.domain};return l._conf.enableResource&&l.fixResourceStatus&&S.timeStamp&&l.fixResourceStatus({src:p,node_name:v,res_type:n.getResType(v,p),timeStamp:S.timeStamp,domain:R.domain}),l._lg("resourceError",_),l}catch(w){return n.warn("[ARMS] resourceErrorHandler error :",w),l}},getSrc:function(S){var l=S.src||S.href;try{if(!l){var h=(typeof S.tagName=="string"?S.tagName.toLowerCase():"")==="object",p=S.getAttribute("classid")&&S.getAttribute("classid").toLowerCase()==="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"||S.getAttribute("type")==="application/x-shockwave-flash";h&&p&&(l=S.getAttribute("data")||S.getAttribute("codebase")),l||(l=S.outerHTML||S.innerHTML)}}catch{l=""}return l},getXPath:function(S,l){var h=S.id?"#"+S.id:"",p=typeof S.className=="string"?"."+S.className.split(" ").join("."):"",v=(typeof S.tagName=="string"?S.tagName.toLowerCase():"")+h+p;return S.parentNode&&S.parentNode.tagName&&l-1!=0?this.getXPath(S.parentNode,l-1)+" > "+v:v},sendPerformance:function(S){var l=this;l.onReady(function(){var h=o();h&&h.load&&h.load>0&&(h.page=l.getPage(!0),S&&(h=n.ext(h,S)),h.autoSend=!0,l.performance(h))})},sendResources:function(S){var l=this;l.onReady(function(){var h=i();h&&h.load&&h.load>0&&(h.load&&h.load<=2e3||h.load&&h.load<=8e3&&Math.random()>.05||(h.page=l.getPage(!0),h.dl=location.href,S&&(h=n.ext(h,S)),l._lg("res",h,l.getConfig("sample"))))})},sendPV:function(){var S=this;S.onReady(function(){var l=function(h){var p=y(h),v=t.devicePixelRatio||1;return{uid:p,dt:r.title,dl:location.href,dr:r.referrer,dpr:v.toFixed(2),de:(r.characterSet||r.defaultCharset||"").toLowerCase(),ul:a.lang,begin:Date.now()}}(S);l&&l.uid&&S._lg("pv",l,S.getConfig("pvSample"))})},commonInfo:function(){return E.uid=y(this),E.sid=function(S){if(S.session)return S.session;var l;try{if(typeof window=="object"&&typeof sessionStorage=="object"&&typeof sessionStorage.getItem=="function")return typeof(l=sessionStorage.getItem("_bl_sid"))=="string"?(S.session=l,l):(l=n.uu(),S.session=l,typeof sessionStorage.setItem=="function"&&sessionStorage.setItem("_bl_sid",l),l)}catch(h){n.warn("[ARMS] getSid error :",h)}return S.session=l=n.uu(),l}(this),E},handleUnload:function(S){var l=Date.now();if(l-this._lastUnload<200)return this;this._lastUnload=l,this.sendHealth(S),this.speedCache&&(this._lg("speed",this.speedCache),this.speedCache=null,clearTimeout(this.speedTimmer)),this._conf&&this._conf.enableResource&&this.resourceComboReport(),this.clear(!0)},bindHashChange:function(S){var l=this;if(!S^l.hashChangeHandler)return l;S?(l.hackHistoryState(),l.hashChangeHandler=function(h){var p=l._conf.parseHash(location.hash);p&&l.setPage(p,h!==!1)},l.stateChangeHandler=function(h){var p=l._conf.parseHash(h.detail);p&&l.setPage(p)},n.on(t,"hashchange",l.hashChangeHandler),n.on(t,"historystatechange",l.stateChangeHandler),l.hashChangeHandler(!1)):(n.off(t,"hashchange",l.hashChangeHandler),n.off(t,"historystatechange",l.stateChangeHandler),l.hashChangeHandler=null,l.stateChangeHandler=null)},initHandler:function(){var S=this;if(S.hasInitHandler)return S;var l=S._conf;return n.on(t,"beforeunload",function(){S.handleUnload(0)}),S.bindHashChange(l.enableSPA),S.activeErrHandler(!1),S.hasInitHandler=!0,S}}),n.on(t,"error",function(S){s&&s.errorHandler(S)},!1,!0).on(t,"unhandledrejection",function(S){s&&s.errorHandler(S)}),e}),zp}var yu,Kp;function HE(){if(Kp)return yu;Kp=1;var e=cr(),t=500;return yu=function(r,n,i){function o(E,m,f){var y=0,S=E.tagName;if(S!=="SCRIPT"&&S!=="STYLE"&&S!=="META"&&S!=="HEAD"){var l=E.children?E.children.length:0;if(l>0)for(var h=E.children,p=l-1;p>=0;p--)y+=o(h[p],m+1,y>0);if(y<=0&&!f&&!(E.getBoundingClientRect&&E.getBoundingClientRect().top<a))return 0;y+=1+.5*m}return y}function s(E){for(var m=1;m<E.length;m++)if(E[m].score<E[m-1].score)return E.splice(m,1),s(E);return E}var a=n.innerHeight||0,c=[],u=null,d=0;e.ext(r.prototype,{initFmpObserver:function(E){var m=this;if(!m._conf||!m._conf.useFmp)return null;if(!n.MutationObserver)return e.warn("[retcode] first meaningful paint can not be retrieved"),m.sendPerformance(),null;e.on(n,"beforeunload",function(){m.endObserving(0,!0)});var f=n.MutationObserver;return(u=new f(function(){(function(y){var S=Date.now()-y,l=i.querySelector("body");if(l){var h=0;h+=o(l,1,!1),c.push({score:h,t:S})}else c.push({score:0,t:S})})(m._startTime)})).observe(document,{childList:!0,subtree:!0}),d=1,m.onReady(function(){m.endObserving(E)}),u},endObserving:function(E,m){var f=this;if(u&&d)if(f.fmpTimmer&&(clearTimeout(f.fmpTimmer),f.fmpTimmer=null),m||!function(h,p){var v=Date.now()-h;return!(v>p||v-(c&&c.length&&c[c.length-1].t||0)>2*t)}(f._startTime,E)){u.disconnect(),d=0,c=s(c);for(var y=null,S=1;S<c.length;S++)if(c[S].t>=c[S-1].t){var l=c[S].score-c[S-1].score;(!y||y.rate<=l)&&(y={t:c[S].t,rate:l})}y&&y.t>0&&y.t<36e5?f.sendPerformance({fmp:y.t}):f.sendPerformance()}else f.fmpTimmer=e.delay(function(){f.endObserving(E)},t)}})},yu}var Gp,Jp;function WE(){return Jp||(Jp=1,Gp=function(e,t){var r=cr(),n=null,i=r.getCurDomain(),o=function(d,E,m,f,y,S,l,h,p,v,g,R,_){var w=r.J(y)||null,k=r.safetyCall(E,[w,f],null);if(!k)return!1;var O=k.code||S,C=!("success"in k)||k.success;d.api(m,C,l,O,k.msg,h,p,v,C?{}:g,i,R,_)},s="fetch",a="__oFetch_",c="__oXMLHttpRequest_",u="XMLHttpRequest";return r.ext(e.prototype,{removeHook:function(d,E){return n&&(E||this===n)?(t[a]&&(t[s]=t[a],delete t[a]),t[c]&&(t[u]=t[c],delete t[c]),n=null,this):this},addHook:function(d){return!d&&n?this:(n||(function(){if(typeof t[s]=="function"){var E=t[s];t[a]=E,t[s]=function(m,f){var y=arguments.length===1?[arguments[0]]:Array.apply(null,arguments),S=n;if(!S||!S.api||f&&(f.method==="HEAD"||f.mode==="no-cors"))return E.apply(t,y);f||(f={});var l=Date.now(),h=S._conf,p=r.duration(),v=(m&&typeof m!="string"?m.url:m)||"",g=v;v=r.cutUrlSearch(v);var R=(h.ignore||{}).ignoreApis,_=h.parseTraceId;if(!r.checkAPI(v,!0)||r.ignoreByRule(v,R))return E.apply(t,y);v=r.filterByRule(v,g,h.ignoreApiPath?h.ignoreApiPath:h.apiHelper);var w=h.enableLinkTrace,k="",O="",C=S.getConfig("pid"),b=null,A=S.getConfig("sample"),T=S.getConfig("linkType"),M=1;if(A&&!S.sampling(A)&&(M=0),w){var D="";try{D=location.origin?location.origin:location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")}catch{D=""}var N=r.checkSameOrigin(g,D);if(S.getConfig("enableApiCors")||N)if(m&&typeof m!="string")try{if(y[0].headers&&typeof y[0].headers.get=="function"&&typeof y[0].headers.append=="function")switch(T){case"arms":var P=y[0].headers.get("EagleEye-TraceID"),I=y[0].headers.get("EagleEye-SessionID"),L=y[0].headers.get("EagleEye-pAppName");P?k=P:(k=S.getTraceId()["EagleEye-TraceID"],y[0].headers.append("EagleEye-TraceID",k)),I?O=I:(O=S.getPageviewId()["EagleEye-SessionID"],y[0].headers.append("EagleEye-SessionID",O)),L||y[0].headers.append("EagleEye-pAppName",C);break;case"b3":var W=y[0].headers.get("X-B3-TraceId");if(W)k=W;else{var U=S.getB3TraceId(M);y[0].headers.append("X-B3-TraceId",U["X-B3-TraceId"]),y[0].headers.append("X-B3-ParentSpanId",U["X-B3-ParentSpanId"]),y[0].headers.append("X-B3-SpanId",U["X-B3-SpanId"]),y[0].headers.append("X-B3-Sampled",U["X-B3-Sampled"]),y[0].headers.append("X-Request-ID",r.guid()),k=U["X-B3-TraceId"]}O=S.pageview;break;case"tracing":default:var x=y[0].headers.get("uber-trace-id");x?k=x.split(":")[0]:(x=S.getUberTraceId(M),y[0].headers.append("uber-trace-id",x["uber-trace-id"]),k=x.traceId),O=S.pageview}}catch(H){r.warn(`[retcode] fetch failed to set header, exception is :
`+H)}else switch(f.headers=f.headers?f.headers:{},T){case"arms":f.headers["EagleEye-TraceID"]?k=f.headers["EagleEye-TraceID"]:(k=S.getTraceId()["EagleEye-TraceID"],f.headers["EagleEye-TraceID"]=k),f.headers["EagleEye-SessionID"]?O=f.headers["EagleEye-SessionID"]:(O=S.getPageviewId()["EagleEye-SessionID"],f.headers["EagleEye-SessionID"]=O),f.headers["EagleEye-pAppName"]||(f.headers["EagleEye-pAppName"]=C);break;case"b3":if(f.headers["X-B3-TraceId"])k=f.headers["X-B3-TraceId"];else{var V=S.getB3TraceId(M);f.headers["X-B3-TraceId"]=V["X-B3-TraceId"],f.headers["X-B3-ParentSpanId"]=V["X-B3-ParentSpanId"],f.headers["X-B3-SpanId"]=V["X-B3-SpanId"],f.headers["X-B3-Sampled"]=V["X-B3-Sampled"],f.headers["X-Request-ID"]=r.guid(),k=V["X-B3-TraceId"]}O=S.getPageviewId()["EagleEye-SessionID"];break;case"tracing":default:if(f.headers["uber-trace-id"])k=f.headers["uber-trace-id"].split(":")[0];else{var j=S.getUberTraceId(M);f.headers["uber-trace-id"]=j["uber-trace-id"],k=j.traceId}O=S.getPageviewId()["EagleEye-SessionID"]}}return E.apply(t,y).then(function(H){if(!S||!S.api)return H;try{if(!H||typeof H.clone!="function")return H;var z=H.clone(),K=z.headers;if(K&&typeof K.get=="function"){var $=K.get("content-type");if($&&!/(text)|(json)/.test($))return H;if(!k){var Z=r.parseFetchHeaders(K);typeof Z=="object"&&Z["eagleeye-traceid"]&&(k=Z["eagleeye-traceid"],b="response")}}var ne=p();return z.text().then(function(te){if(!k&&r.isFunction(_)){var ae=_(z,te);ae&&r.isString(ae)&&(k=ae)}var le=r.getFetchSnapshot(y,te,K);z.ok?o(S,h.parseResponse,v,g,te,z.status||200,ne,l,k,O,le,b,M):(S.api(v,!1,ne,z.status||404,z.statusText,l,k,O,le,i,b,M),h.enableResource&&n.fixResourceStatus&&n.fixResourceStatus({src:z.url,res_type:"api"}))}),H}catch(te){return r.warn("[ARMS] fetch response error :",te),H}}).catch(function(H){if(!S||!S.api)throw H;var z=p();throw S.api(v,!1,z,H.name||"Error",H.message,l,k,O,{},i),h.enableResource&&n.fixResourceStatus&&n.fixResourceStatus({src:g,res_type:"api"}),H})},t[s].toString=r.createFakeToString(s)}}(),function(){if(typeof t[u]=="function"){var E,m=t[u];t[c]=m;var f=function(y){var S=new m(y),l=n;if(!l||!l.api||!S.addEventListener)return S;var h,p,v,g,R=S.send,_=S.open,w=S.setRequestHeader,k=l._conf,O=(k.ignore||{}).ignoreApis,C=k.parseTraceId,b=l.getConfig("enableLinkTrace"),A="",T="",M="",D=null,N=l.getConfig("sample"),P=l.getConfig("linkType"),I=1;return N&&!l.sampling(N)&&(I=0),S.open=function(L,W){E=L;var U=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);_.apply(S,U),g=W||"",v=r.cutUrlSearch(g);var x=!r.checkAPI(v,!0)||r.ignoreByRule(v,O);if(v=v?r.filterByRule(v,g,k.ignoreApiPath?k.ignoreApiPath:k.apiHelper):"",!x&&b){var V="";try{V=location.origin?location.origin:location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")}catch{V=""}var j=r.checkSameOrigin(g,V);if((l.getConfig("enableApiCors")||j)&&w&&typeof w=="function")switch(P){case"arms":A=l.getTraceId()["EagleEye-TraceID"],w.apply(S,["EagleEye-TraceID",A]),T=l.getPageviewId()["EagleEye-SessionID"],w.apply(S,["EagleEye-SessionID",T]),M=l.getConfig("pid"),w.apply(S,["EagleEye-pAppName",M]);break;case"b3":var H=l.getB3TraceId(I);w.apply(S,["X-B3-TraceId",H["X-B3-TraceId"]]),w.apply(S,["X-B3-ParentSpanId",H["X-B3-ParentSpanId"]]),w.apply(S,["X-B3-SpanId",H["X-B3-SpanId"]]),w.apply(S,["X-B3-Sampled",H["X-B3-Sampled"]]),w.apply(S,["X-Request-ID",r.guid()]),A=H["X-B3-TraceId"],T=l.getPageviewId()["EagleEye-SessionID"];break;case"tracing":default:var z=l.getUberTraceId(I);w.apply(S,["uber-trace-id",z["uber-trace-id"]]),A=z.traceId,T=l.getPageviewId()["EagleEye-SessionID"]}}},S.send=function(){h=Date.now(),p=r.duration();var L=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);R.apply(S,L)},r.on(S,"readystatechange",function(){if(v&&S.readyState===4){var L=p(),W=r.getXhrSnapshot(g,E,S);if(!A){var U=r.parseXhrHeaders(typeof S.getAllResponseHeaders=="function"&&S.getAllResponseHeaders()||"");typeof U=="object"&&U["eagleeye-traceid"]&&(A=U["eagleeye-traceid"],D="response")}if(!A&&r.isFunction(C)){var x=C(S);x&&r.isString(x)&&(A=x)}if(S.status>=200&&S.status<=299){var V=S.status||200;if(typeof S.getResponseHeader=="function"){var j=S.getResponseHeader("Content-Type");if(j&&!/(text)|(json)/.test(j))return}S.responseType&&S.responseType!=="text"?l.api(v,!0,L,V,"",h,A,T,{},i,D,I):o(l,k.parseResponse,v,g,S.responseText,V,L,h,A,T,W,D,I)}else l.api(v,!1,L,S.status||"FAILED",S.statusText,h,A,T,W,i,D,I),k.enableResource&&n.fixResourceStatus&&n.fixResourceStatus({src:S.responseURL||g,res_type:"api"})}}),S};f.prototype=m.prototype,r.each(Object.keys(m),function(y){f[y]=m[y]}),t[u]=f,t[u].toString=r.createFakeToString(u)}}()),n=this,this)},initHook:function(){return this.hasInitHook?this:(this.getConfig("disableHook")||this.addHook(),this.hasInitHook=!0,this)}}),e}),Gp}var qp,Yp;function zE(){return Yp||(Yp=1,qp=function(e,t){var r=cr(),n=t.history||{},i=t.document,o=function(a,c){var u;t.CustomEvent?u=new CustomEvent(a,{detail:c}):((u=i.createEvent("HTMLEvents")).initEvent(a,!1,!0),u.detail=c),t.dispatchEvent(u)},s=function(a){var c=n[a];typeof c=="function"&&(n[a]=function(u,d,E){var m=arguments.length===1?[arguments[0]]:Array.apply(null,arguments),f=location.href,y=c.apply(n,m);if(!E||typeof E!="string"||E===f)return y;try{var S=f.split("#"),l=E.split("#"),h=r.cutUrlSearch(S[0]),p=r.cutUrlSearch(l[0]),v=S[1]&&S[1].replace(/^\/?(.*)/,"$1"),g=l[1]&&l[1].replace(/^\/?(.*)/,"$1");v!==g?o("historystatechange",g):h!==p&&o("historystatechange",p)}catch(R){r.warn("[retcode] error in "+a+": "+R)}return y},n[a].toString=r.createFakeToString(a))};r.ext(e.prototype,{hackHistoryState:function(){return this.hasHackedHistoryState?this:(s("pushState"),s("replaceState"),this.hasHackedHistoryState=!0,this)}})}),qp}var Eu,Qp;function $E(){if(Qp)return Eu;Qp=1;var e=cr(),t=Vd(),r=t.TIMING_KEYS;return Eu=function(n,i){function o(c,u,d){if(c instanceof i.PerformanceResourceTiming&&c.initiatorType){var E=e.getResType(c.initiatorType,c.name),m=u.resourceTypes||[],f=(u.ignore||{}).ignoreResources;if(E&&m.includes(E)&&!e.ignoreByRule(c.name,f)&&!e.ignoreByRule(e.decode(c.name),f)){var y=c[r[0]],S=c[r[1]],l=c[r[2]],h=c[r[3]],p=c[r[4]],v=c[r[5]],g=c[r[6]],R=c[r[7]],_=c[r[8]],w=c[r[18]],k=c[r[19]];if(!d.has(c)&&(!e.areInOrder(y,S,l,h,p,v,g,R,_)||y>R))return;if(w<y&&(w=y),k<y&&(k=S),e.areInOrder(y,w,k,S))return{domain:e.getURL(c.name).domain,res_type:E,src_type:e.getSrcType(c.name,u.cdnHostList),success:1,size:Math.round(c.decodedBodySize),duration:Math.round(c.duration),timeStamp:c.responseEnd,timing:c}}}}var s="_resource-"+Date.now(),a="_resource_error-"+Date.now();e.ext(n.prototype,{initResource:function(){var c=this,u=i.performance,d=i.PerformanceObserver;if(c[a]||(c[a]=new WeakMap),!u||!d||typeof u!="object"||typeof u.getEntriesByType!="function")return null;var E=u.getEntriesByType("resource")||[];return setTimeout(function(){c.setResource(E)},10),new d(function(m){setTimeout(function(){c.setResource(m.getEntries())},10)}).observe({entryTypes:["resource"]}),this.onReady(function(){setTimeout(c.resourceComboReport.bind(c),5e3)}),c},setResource:function(c){var u=this._conf,d=this[a];if(e.isArray(c)&&c.length){this[s]||(this[s]={});for(var E=this[s],m=0,f=c.length;m<f;m+=1){var y=c[m];if(e.checkAPI(y.name,!1)){var S=o(y,u,d);if(S){var l=S.res_type+"-"+S.domain;l in E||(E[l]=[]),E[l].push(S)}}}return this}},fixResourceStatus:function(c){var u=i.performance;if(!u||typeof u.getEntriesByName!="function")return null;var d=this[a];if(!c.src||!e.checkAPI(c.src,!1))return this;var E=c.timeStamp||u.now(),m=u.getEntriesByName(c.src,"resource");return e.each(m,function(f){d.has(f)||E-f.responseEnd<100&&d.set(f,{success:0})}),this},resourceComboReport:function(){var c=this[s]||{},u=this._conf.resourceSlow||2e3,d=this[a];this[s]={};var E=Object.keys(c);if(E.length!==0){var m=[];e.each(E,function(l){var h=c[l],p={domain:"",res_type:"",src_type:"",size:0,duration:0,count:0,err_count:0,err_duration:0,slow_count:0,slow_duration:0,timings:[]};e.each(h,function(v){var g=v.timing||{},R=d.get(v.timing),_=R?R.success:1,w=v.duration>u?1:0;p.domain=v.domain,p.res_type=v.res_type,p.src_type=v.src_type,p.count+=1,p.duration+=v.duration,p.size+=v.size,_||(p.err_count+=1,p.err_duration+=v.duration),w&&(p.slow_count+=1,p.slow_duration+=v.duration);try{var k=JSON.parse(JSON.stringify(g));k.success=_,k.resourceSlow=u,k.isSlow=w,p.timings.push(k)}catch{}}),p.count&&(p.size=Math.round(p.size/p.count),p.duration=Math.round(p.duration/p.count)),p.slow_count&&(p.slow_duration=Math.round(p.slow_duration/p.slow_count)),p.err_count&&(p.err_duration=Math.round(p.err_duration/p.err_count)),p.timings.length>20&&(p.timings.sort(function(v,g){return g.duration-v.duration}),p.timings.length=20),p.timings=encodeURIComponent(JSON.stringify(p.timings)),m.push(p)});var f={_combo:1,resource:JSON.stringify(m)},y=i.navigator.connection;f.ct=y?y.effectiveType||y.type:"";var S=y&&(y.downlink||y.downlinkMax||y.bandwidth)||null;(S=S>999?999:S)&&(f.bandwidth=S),this._lg("resource",f,this.getConfig("sample"))}}})},Eu}var Xp;function KE(){if(Xp)return uu.exports;Xp=1;var e=cr(),t=LE(),r=xE(),n=UE(),i=e.win,o=i.document,s=/^(error|api|speed|sum|avg|percent|custom|msg|setPage|setConfig|behavior|performance)$/,a=function(c){var u=this;return t.call(u,c),u._initialPage=c.page&&e.safetyCall(c.page,[],c.page+"")||null,u._isRobot=e.isRobot(),u._health={errcount:0,apisucc:0,apifail:0},u.beforeSend=function(d,E){d==="error"?u._health.errcount++:d==="api"&&u._health[E.success?"apisucc":"apifail"]++},c.enableInstanceAutoSend!==!1&&(u.initHandler(),u.initHook(),u.initFmpObserver(1e4),u._conf&&u._conf.behavior&&typeof u.initBehavior=="function"&&u.initBehavior(),u._conf&&u._conf.enableResource&&typeof u.initResource=="function"&&u.initResource()),Object.defineProperty&&i.addEventListener&&Object.defineProperty(u,"pipe",{set:u.sendPipe}),u};return a.prototype=e.createObject(t.prototype),e.ext(t._root.dftCon,{uid:null,setUsername:null,ignoreUrlPath:null,ignoreApiPath:null,urlHelper:[{rule:/\/([a-z\-_]+)?\d{2,20}/g,target:"/$1**"},/\/$/],resourceHelper:[],apiHelper:{rule:/\/([a-z\-_]+)?\d{2,20}/g,target:"/$1**"},ignoreUrlCase:!0,imgUrl:"https://arms-retcode.aliyuncs.com/r.png?",cdnHostList:[],resourceTypes:["css","script","img","font"],resourceSlow:2e3,disableHook:!1,autoSendPv:!0,autoSendPerf:!0,enableSPA:!1,enableLinkTrace:!1,linkType:"arms",enableApiCors:!1,sendResource:!0,behavior:!0,enableConsole:!1,parseHash:function(c){return(c?e.cutUrlSearch(c.replace(/^#\/?/,"")):"")||"[index]"},parseResponse:function(c){if(!c||typeof c!="object")return{};var u=c.code,d=c.msg||c.message||c.subMsg||c.errorMsg||c.ret||c.errorResponse||"";return typeof d=="object"&&(u=u||d.code,d=d.msg||d.message||d.info||d.ret||JSON.stringify(d)),{msg:d,code:u,success:!0}}}),e.ext(a.prototype,{constructor:a,_super:t,onReady:function(c){var u=this;if(u.hasReady)return c();o.readyState==="complete"?(u.hasReady=!0,c()):e.on(i,"load",function(){u.hasReady=!0,c()},!0)},getPage:function(c){var u=this._conf,d=u.page,E=location,m=E.host+E.pathname;return d&&!c?e.safetyCall(d,[],d+""):this._initialPage||e.filterByRule(u.ignoreUrlCase?m.toLowerCase():m,E.href,u.ignoreUrlPath?u.ignoreUrlPath:u.urlHelper)},setPage:function(c,u){var d=this,E=d.prevPage;if(u!==!1){if(!c||c===E)return d;d.prevPage=c,clearTimeout(d.sendPVTimmer),d.handleUnload(1),d.resetPageview(),d.sendPVTimmer=setTimeout(function(){d.sendPV()},10)}else d.prevPage=c;return d._conf.page=c,d},setConfig:function(c,u){if(c&&typeof c=="object"){e.verifyConfig(c),c=this.setImgUrl(c);var d=this._conf;if(this._conf=e.ext({},d,c),!u){var E="disableHook";E in c&&d[E]!==c[E]&&(c[E]?this.removeHook():this.addHook()),(E="enableSPA")in c&&d[E]!==c[E]&&this.bindHashChange(c[E])}}},sendRequest:function(c){r(c,this.getConfig("imgUrl"))},postData:function(c,u){var d={};d[u]=c[u],delete c[u];var E="";typeof c=="object"&&(E=e.serialize(c)),n(d,this.getConfig("imgUrl")+E+"&post_res=")},sendPipe:function(c){var u=this;if(!c||!c.length)return u;try{if(e.T(c[0])==="Array")return e.each(c,function(E){return u.sendPipe(E)});if(e.T(c)!=="Array")return u;var d=c.shift();if(!s.test(d))return u;u[d].apply(u,c)}catch(E){return e.warn("[retcode] error in sendPipe",E),u}},sendHealth:function(){var c=e.ext({},this._health);c.healthy=c.errcount>0?0:1,c.begin=Date.now();var u=c.begin-this.sBegin;c.stay=u,this._lg("health",c,1),this._health={errcount:0,apisucc:0,apifail:0}},createInstance:function(c){c=e.ext({pid:this._conf.pid},c);var u=this.__proto__.constructor(c);return c.page&&u.sendPV(),u}}),VE()(a,i),FE()(a,i,o),HE()(a,i,o),WE()(a,i),zE()(a,i),$E()(a,i),a._super=t,a._root=t._root,t.Browser=a,uu.exports=a,uu.exports}var Zp;function GE(){if(Zp)return cu.exports;Zp=1;function e(a,c){var u=r[i]=new n(a);u.sendPipe(c);var d=u._conf;return d.autoSendPv!==!1&&u.sendPV(),d&&d.useFmp||u.sendPerformance(),d&&d.sendResource&&u.sendResources(),r[o]=!0,u}function t(){if(r[o])return r[i];var a={},c=[];return i in r&&(a=r[i].config||{},c=r[i].pipe||[]),e(a,c)}var r=window,n=r.BrowserLogger=KE(),i=cr().key,o="__hasInitBlSdk";n.singleton=function(a,c){return r[o]?r[i]:e(a,c)},n.createExtraInstance=function(a){a&&typeof a=="object"&&a.enableInstanceAutoSend!==!0&&(a.enableInstanceAutoSend=!1);var c=new n(a),u=c._conf;return u.enableInstanceAutoSend&&(u.autoSendPv!==!1&&c.sendPV(),u&&u.useFmp||c.sendPerformance(),u&&u.sendResource&&c.sendResources()),c};var s=typeof window=="object"&&!!window.navigator;return s&&r[i]&&(n.bl=t()),cu.exports=n,cu.exports}function JE(){return GE()}var qE={getArmsLogger:JE};const ef="https://arms-retcode.aliyuncs.com/r.png?",tf="https://arms-retcode-sg.aliyuncs.com/r.png?",rf="https://retcode-us-west-1.arms.aliyuncs.com/r.png?",nf="e1iftji1w7@7ec1cef2cc88733",of="e1iftji1w7@10a06d1ec260adc",sf="e1iftji1w7@10a06d1ec260adc",Ru={cn:{reportUrl:ef,pid:nf},"cn-hangzhou":{reportUrl:ef,pid:nf},sg:{reportUrl:tf,pid:of},"ap-southeast-1":{reportUrl:tf,pid:of},usw:{reportUrl:rf,pid:sf},"us-west-1":{reportUrl:rf,pid:sf}},xv=e=>e!==null&&typeof e=="object",YE=e=>Object.prototype.toString.call(e).slice(8,-1),Uv=e=>Object.isExtensible(e)?YE(e)==="Object":!1;function QE(e,t,r){const n=[],i=typeof Object.getOwnPropertyDescriptors=="function"?Object.getOwnPropertyDescriptors(Object.getPrototypeOf(e)):{};for(const s of Object.keys(i))i[s].get&&n.push(s);const o={MediaboxWrapperObjectGetter(s,a){if(typeof a=="string"&&n.indexOf(a)>-1){let d;try{d=s[a]}catch(E){throw r(E),E}return an(d,t+1,r)}let c=()=>{};typeof s[a]=="function"&&(c=s[a].bind(s));const u={MediaboxWrapperObjectMethod(...d){let E;try{E=c(...d)}catch(m){throw r(m),m}return an(E,t+1,r)}};return typeof s[a]=="function"?u.MediaboxWrapperObjectMethod:t>10?s[a]:an(s[a],t+1,r)},MediaboxWrapperObjectSetter(s,a,c){return s[a]=an(c,t+1,r),!0}};return new Proxy(e,{get:o.MediaboxWrapperObjectGetter,set:o.MediaboxWrapperObjectSetter})}function XE(e,t,r){const n={MediaboxWrapperFunctionApply(i,o,s){let a;try{a=i.apply(o,s),xv(a)&&Uv(a)&&(a.__v_skip=!0)}catch(c){throw r(c),c}return an(a,t+1,r)},MediaboxWrapperFunctionGet(i,o){const s=Object.getOwnPropertyDescriptor(i,o);return s&&!s.writable&&!s.configurable?i[o]:an(i[o],t+1,r)},MediaboxWrapperClassConstructor(i,o){let s;try{s=new i(...o),s.__v_skip=!0}catch(a){throw r(a),a}return an(s,t+1,r)}};return new Proxy(e,{apply:n.MediaboxWrapperFunctionApply,get:n.MediaboxWrapperFunctionGet,construct:n.MediaboxWrapperClassConstructor})}const mi="-c-";function ZE(e){if(typeof e!="string")return mi;if(Bd(e))return e;const t=e.indexOf(`
`);return t<0?`${e}${mi}`:`${e.slice(0,t)}${mi}${e.slice(t)}`}function eR(e){return typeof e!="string"?"":Bd(e)?e.replace(mi,""):e}function Bd(e){if(typeof e!="string")return!1;const t=e.indexOf(mi);if(t<0)return!1;const r=e.indexOf(`
`);return r<0?t===e.length-mi.length:t===r-mi.length}function an(e,t,r){return typeof e=="function"?XE(e,t+1,r):e instanceof Promise?e.then(n=>an(n,t+1,r)).catch(n=>(r(n),Promise.reject(n))):Array.isArray(e)?e.map(n=>an(n,t+1,r)):xv(e)&&Uv(e)?QE(e,t+1,r):e}function tR(e){return typeof e!="string"?!1:e.indexOf("g.alicdn.com/apsara-media-")>-1||e.indexOf("g.alicdn.com/thor-server")>-1}function af(e){return typeof e!="string"?!1:e.indexOf("g.alicdn.com/apsara-media-")>-1||e.indexOf("g.alicdn.com/thor-server")>-1||e.indexOf("MediaboxWrapper")>-1}class cf extends Error{constructor(t){super(t),this.name="MQTError"}}class jd{constructor(t){Ii(this,"armsLogger"),Ii(this,"isReady",!1),Ii(this,"isDestroyed",!1),Ii(this,"options"),Ii(this,"queue",[]),Ii(this,"helper",{MediaboxWrapperQueue(s){return new cf(s)},MediaboxWrapperInitiative(s){return new cf(s)}}),this.options=t;const{region:r="cn",env:n="prod"}=t;if(!Ru[r])throw new Error(`region ${r} is not supported`);const i=s=>{var a;if(this.isDestroyed||Bd(s.stack)||s.t!=="pv"&&s.t!=="error")return!1;if(s.c1=(a=this.options.cid)!=null?a:window.location.host,s.c2=jd.version,this.options.customData&&(s.c3=new URLSearchParams(this.options.customData).toString()),s.t==="error"){if(tR(s.file)||af(s.stack)){let c=s;return this.options.beforeSend&&(c=this.options.beforeSend(s)),this.isReady?c:(c&&this.queue.push(c),!1)}return!1}return s},o=qE.getArmsLogger();this.armsLogger=o.createExtraInstance({enableInstanceAutoSend:!0,pid:Ru[r].pid,tag:t.businessName,release:`${t.businessName}_${t.version}`,imgUrl:Ru[r].reportUrl,behavior:!0,sample:1,disableHook:!0,environment:n,beforeReport:i})}static get version(){return"0.19.0"}wrap(t){return this.options.disabled||typeof Proxy>"u"?t:an(t,0,r=>{r instanceof Error&&typeof r.stack=="string"&&af(r.stack)&&(r.stack=eR(r.stack),this.armsLogger.error(r),r.stack=ZE(r.stack))})}updateOptions(t){this.options=Ne(Ne({},this.options),t)}setReady(){this.isReady=!0,this.queue.length&&this.queue.forEach(t=>{this.armsLogger.error(this.helper.MediaboxWrapperQueue(t.msg),{filename:t.file,lineno:t.line,colno:t.col})})}report(t,r){this.armsLogger.error(this.helper.MediaboxWrapperInitiative(t),r)}destroy(){this.isDestroyed=!0}}var Ye=(e=>(e.PullStreamStats="remoteStat",e.RtsSubscribeExceeds="rtsSubscribeExceeds",e.UserJoined="userJoined",e.UserLeft="userLeft",e.Bye="bye",e.MuteAudio="muteAudio",e.UnmuteAudio="unmuteAudio",e.MuteVideo="muteVideo",e.UnmuteVideo="unmuteVideo",e.MuteScreen="muteScreen",e.UnmuteScreen="unmuteScreen",e.Error="error",e))(Ye||{}),ir=(e=>(e.Local="local-device-status-change",e.Remote="remote-device-status-change",e))(ir||{}),se=(e=>(e.Audio="sophon_audio",e.VideoLarge="sophon_video_camera_large",e.VideoSmall="sophon_video_camera_small",e.Screen="sophon_video_screen_share",e.Data="sophon_data",e))(se||{}),Fd=(e=>(e.Audio="rts audio",e.VideoLarge="rts video",e))(Fd||{}),In=(e=>(e.Add="add",e.Delete="delete",e.Replace="replace",e.Stop="stop",e.UnPublish="unpublish",e))(In||{}),ao=(e=>(e[e.Camera=0]="Camera",e[e.Screen=1]="Screen",e[e.Image=2]="Image",e))(ao||{}),Qa=(e=>(e[e.Microphone=0]="Microphone",e[e.Screen=1]="Screen",e[e.Mixed=2]="Mixed",e))(Qa||{}),tt=(e=>(e.InRoom="inRoom",e.Join="join",e.Publish="publish",e.User="user",e.Resume="resume",e.Retry="retry",e.Reconnect="reconnect",e))(tt||{}),dn=(e=>(e[e.MANUAL=0]="MANUAL",e[e.JOIN_CHANNEL=1]="JOIN_CHANNEL",e[e.ROLE_CHANGE=2]="ROLE_CHANGE",e[e.RECONNECT=3]="RECONNECT",e))(dn||{}),Ft=[];for(var bu=0;bu<256;++bu)Ft.push((bu+256).toString(16).slice(1));function rR(e,t=0){return(Ft[e[t+0]]+Ft[e[t+1]]+Ft[e[t+2]]+Ft[e[t+3]]+"-"+Ft[e[t+4]]+Ft[e[t+5]]+"-"+Ft[e[t+6]]+Ft[e[t+7]]+"-"+Ft[e[t+8]]+Ft[e[t+9]]+"-"+Ft[e[t+10]]+Ft[e[t+11]]+Ft[e[t+12]]+Ft[e[t+13]]+Ft[e[t+14]]+Ft[e[t+15]]).toLowerCase()}var Ks,nR=new Uint8Array(16);function iR(){if(!Ks&&(Ks=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Ks))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ks(nR)}var oR=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const uf={randomUUID:oR};function hn(e,t,r){if(uf.randomUUID&&!t&&!e)return uf.randomUUID();e=e||{};var n=e.random||(e.rng||iR)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){r=r||0;for(var i=0;i<16;++i)t[r+i]=n[i];return t}return rR(n)}var Xa=(e=>(e.prod="rs.rtn.aliyuncs.com",e.pre="prs.rtn.aliyuncs.com",e))(Xa||{});const Ec="6.13.8-beta.0",lf="web";class vr{static getVersionNumber(){let t=Ec.split("."),r="";return t.forEach(n=>{n.length===1?r+="0"+n:r+=n}),parseInt(r)}static queryingParam(t){let r=[];if(t)for(let n in t)r.push(n+"="+t[n]);return r.join("&")}static getQueryParams(t){const r=window.location.search.substring(1).split("&");for(let n=0;n<r.length;n++){const i=r[n].split("=");if(decodeURIComponent(i[0])===t)return decodeURIComponent(i[1])}}static createCallid(t=""){const r=hn();return t&&r&&r.length>t.length?`${t}${r.substring(t.length)}`:r}static checkSubOptionsValid(t){if(t){const{audio:r,video:n,screen:i}=t;if(r===!1&&n===!1&&i===!1)return!1}return!0}static isNetworkAvailable(){return Q(this,null,function*(){const t=Xa.prod,{onLine:r}=navigator;if(!r)return!1;try{return yield fetch(`https://${t}/roomserver/v1/ws/version`),!0}catch{return!1}})}static toString(t){let r;if(t instanceof Error)r=t.message;else if(typeof t=="string")r=t;else try{r=JSON.stringify(t)}catch{r="undefined"}return r}static paramArrayToString(t){let r="";for(let n=0;n<t.length;n++){r!==""&&(r+=" ");let i=vr.toString(t[n]);r+=i}return r}}function df(e,t,r){Object.defineProperty(e,t,{writable:!0,enumerable:!0,configurable:!0,value:r})}function Vv(e,t,r,n){n?n(()=>{df(e,t,r)}):df(e,t,r)}Array(32);class sR{constructor(t){this.timer=null,this.time=10,this.count=10,this.arr=[];var r,n;this.time=(r=t.time)!=null?r:10,this.count=(n=t.count)!=null?n:10,t.host.startsWith("http://")||t.host.startsWith("https://")?this.url=t.host+"/logstores/"+t.logstore+"/track":this.url="https://"+t.project+"."+t.host+"/logstores/"+t.logstore+"/track",this.opt=t,t.installUnloadHook&&typeof t.installUnloadHook=="function"&&t.installUnloadHook(()=>{this.sendImmediateInner()})}assemblePayload(t){const r={__logs__:t};return this.opt.tags&&(r.__tags__=this.opt.tags),this.opt.topic&&(r.__topic__=this.opt.topic),this.opt.source&&(r.__source__=this.opt.source),JSON.stringify(r)}platformSend(){if(this.opt.sendPayload&&typeof this.opt.sendPayload=="function"){const t=this.assemblePayload(this.arr);this.opt.sendPayload(this.url,t)}}transString(t){let r={};for(let n in t)typeof t[n]=="object"?r[n]=JSON.stringify(t[n]):r[n]=String(t[n]);return r}sendImmediateInner(){this.arr&&this.arr.length>0&&(this.platformSend(),this.timer!=null&&(clearTimeout(this.timer),this.timer=null),this.arr=[])}sendInner(){if(this.timer)this.arr.length>=this.count&&(clearTimeout(this.timer),this.timer=null,this.sendImmediateInner());else{const t=this;this.arr.length>=this.count||this.time<=0?this.sendImmediateInner():this.timer=setTimeout(function(){t.sendImmediateInner()},this.time*1e3)}}send(t){const r=this.transString(t);this.arr.push(r),this.sendInner()}sendImmediate(t){const r=this.transString(t);this.arr.push(r),this.sendImmediateInner()}sendBatchLogs(t){const r=t.map(n=>this.transString(n));this.arr.push(...r),this.sendInner()}sendBatchLogsImmediate(t){const r=t.map(n=>this.transString(n));this.arr.push(...r),this.sendImmediateInner()}overwriteTransString(t){this.transString=t.transString}getOpt(){return this.opt}}var aR=(e,t,r)=>new Promise((n,i)=>{var o=c=>{try{a(r.next(c))}catch(u){i(u)}},s=c=>{try{a(r.throw(c))}catch(u){i(u)}},a=c=>c.done?n(c.value):Promise.resolve(c.value).then(o,s);a((r=r.apply(e,t)).next())});function cR(e,t){return navigator&&navigator.sendBeacon?navigator.sendBeacon(`${e}?APIVersion=0.6.0`,t):!1}function hf(e,t){const r=new window.XMLHttpRequest;r.open("POST",`${e}?APIVersion=0.6.0`,!0),r.send(t)}function uR(e,t){try{if(t.length>=32768){hf(e,t);return}cR(e,t)||hf(e,t)}catch(r){window&&window.console&&typeof window.console.error=="function"&&(console.error(`Failed to log to ali log service because of this exception:
`+r),console.error("Failed log data:",e))}}function lR(e,t,r){return aR(this,null,function*(){try{e=e.slice(0,-6);const{data:n,header:i}=yield r.process(e,t),o=new window.XMLHttpRequest;o.open("POST",e,!0);for(let s in i)o.setRequestHeader(s,i[s]);o.send(n)}catch(n){window&&window.console&&typeof window.console.error=="function"&&(console.error(`Failed to log to ali log service because of this exception:
`+n),console.error("Failed log data:",e))}})}class Hd extends sR{constructor(t){const r=Object.assign({},t,{installUnloadHook:n=>{window.addEventListener("beforeunload",()=>{n()})},sendPayload:(n,i)=>{uR(n,i)}});super(r)}useStsPlugin(t){this.getOpt().sendPayload=(r,n)=>{lR(r,n,t)},this.overwriteTransString(t)}}Vv(window,"SLS_Tracker",Hd);var Be=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function dR(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function hR(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}),r}var Bv={exports:{}};function pR(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var pf={exports:{}};const fR={},mR=Object.freeze(Object.defineProperty({__proto__:null,default:fR},Symbol.toStringTag,{value:"Module"})),gR=hR(mR);var ff;function ze(){return ff||(ff=1,function(e,t){(function(r,n){e.exports=n()})(Be,function(){var r=r||function(n,i){var o;if(typeof window<"u"&&window.crypto&&(o=window.crypto),typeof self<"u"&&self.crypto&&(o=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(o=globalThis.crypto),!o&&typeof window<"u"&&window.msCrypto&&(o=window.msCrypto),!o&&typeof Be<"u"&&Be.crypto&&(o=Be.crypto),!o&&typeof pR=="function")try{o=gR}catch{}var s=function(){if(o){if(typeof o.getRandomValues=="function")try{return o.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof o.randomBytes=="function")try{return o.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},a=Object.create||function(){function p(){}return function(v){var g;return p.prototype=v,g=new p,p.prototype=null,g}}(),c={},u=c.lib={},d=u.Base=function(){return{extend:function(p){var v=a(this);return p&&v.mixIn(p),(!v.hasOwnProperty("init")||this.init===v.init)&&(v.init=function(){v.$super.init.apply(this,arguments)}),v.init.prototype=v,v.$super=this,v},create:function(){var p=this.extend();return p.init.apply(p,arguments),p},init:function(){},mixIn:function(p){for(var v in p)p.hasOwnProperty(v)&&(this[v]=p[v]);p.hasOwnProperty("toString")&&(this.toString=p.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),E=u.WordArray=d.extend({init:function(p,v){p=this.words=p||[],v!=i?this.sigBytes=v:this.sigBytes=p.length*4},toString:function(p){return(p||f).stringify(this)},concat:function(p){var v=this.words,g=p.words,R=this.sigBytes,_=p.sigBytes;if(this.clamp(),R%4)for(var w=0;w<_;w++){var k=g[w>>>2]>>>24-w%4*8&255;v[R+w>>>2]|=k<<24-(R+w)%4*8}else for(var O=0;O<_;O+=4)v[R+O>>>2]=g[O>>>2];return this.sigBytes+=_,this},clamp:function(){var p=this.words,v=this.sigBytes;p[v>>>2]&=4294967295<<32-v%4*8,p.length=n.ceil(v/4)},clone:function(){var p=d.clone.call(this);return p.words=this.words.slice(0),p},random:function(p){for(var v=[],g=0;g<p;g+=4)v.push(s());return new E.init(v,p)}}),m=c.enc={},f=m.Hex={stringify:function(p){for(var v=p.words,g=p.sigBytes,R=[],_=0;_<g;_++){var w=v[_>>>2]>>>24-_%4*8&255;R.push((w>>>4).toString(16)),R.push((w&15).toString(16))}return R.join("")},parse:function(p){for(var v=p.length,g=[],R=0;R<v;R+=2)g[R>>>3]|=parseInt(p.substr(R,2),16)<<24-R%8*4;return new E.init(g,v/2)}},y=m.Latin1={stringify:function(p){for(var v=p.words,g=p.sigBytes,R=[],_=0;_<g;_++){var w=v[_>>>2]>>>24-_%4*8&255;R.push(String.fromCharCode(w))}return R.join("")},parse:function(p){for(var v=p.length,g=[],R=0;R<v;R++)g[R>>>2]|=(p.charCodeAt(R)&255)<<24-R%4*8;return new E.init(g,v)}},S=m.Utf8={stringify:function(p){try{return decodeURIComponent(escape(y.stringify(p)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(p){return y.parse(unescape(encodeURIComponent(p)))}},l=u.BufferedBlockAlgorithm=d.extend({reset:function(){this._data=new E.init,this._nDataBytes=0},_append:function(p){typeof p=="string"&&(p=S.parse(p)),this._data.concat(p),this._nDataBytes+=p.sigBytes},_process:function(p){var v,g=this._data,R=g.words,_=g.sigBytes,w=this.blockSize,k=w*4,O=_/k;p?O=n.ceil(O):O=n.max((O|0)-this._minBufferSize,0);var C=O*w,b=n.min(C*4,_);if(C){for(var A=0;A<C;A+=w)this._doProcessBlock(R,A);v=R.splice(0,C),g.sigBytes-=b}return new E.init(v,b)},clone:function(){var p=d.clone.call(this);return p._data=this._data.clone(),p},_minBufferSize:0});u.Hasher=l.extend({cfg:d.extend(),init:function(p){this.cfg=this.cfg.extend(p),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(p){return this._append(p),this._process(),this},finalize:function(p){p&&this._append(p);var v=this._doFinalize();return v},blockSize:16,_createHelper:function(p){return function(v,g){return new p.init(g).finalize(v)}},_createHmacHelper:function(p){return function(v,g){return new h.HMAC.init(p,g).finalize(v)}}});var h=c.algo={};return c}(Math);return r})}(pf)),pf.exports}var mf={exports:{}},gf;function Rc(){return gf||(gf=1,function(e,t){(function(r,n){e.exports=n(ze())})(Be,function(r){return function(n){var i=r,o=i.lib,s=o.Base,a=o.WordArray,c=i.x64={};c.Word=s.extend({init:function(u,d){this.high=u,this.low=d}}),c.WordArray=s.extend({init:function(u,d){u=this.words=u||[],d!=n?this.sigBytes=d:this.sigBytes=u.length*8},toX32:function(){for(var u=this.words,d=u.length,E=[],m=0;m<d;m++){var f=u[m];E.push(f.high),E.push(f.low)}return a.create(E,this.sigBytes)},clone:function(){for(var u=s.clone.call(this),d=u.words=this.words.slice(0),E=d.length,m=0;m<E;m++)d[m]=d[m].clone();return u}})}(),r})}(mf)),mf.exports}var vf={exports:{}},Sf;function vR(){return Sf||(Sf=1,function(e,t){(function(r,n){e.exports=n(ze())})(Be,function(r){return function(){if(typeof ArrayBuffer=="function"){var n=r,i=n.lib,o=i.WordArray,s=o.init,a=o.init=function(c){if(c instanceof ArrayBuffer&&(c=new Uint8Array(c)),(c instanceof Int8Array||typeof Uint8ClampedArray<"u"&&c instanceof Uint8ClampedArray||c instanceof Int16Array||c instanceof Uint16Array||c instanceof Int32Array||c instanceof Uint32Array||c instanceof Float32Array||c instanceof Float64Array)&&(c=new Uint8Array(c.buffer,c.byteOffset,c.byteLength)),c instanceof Uint8Array){for(var u=c.byteLength,d=[],E=0;E<u;E++)d[E>>>2]|=c[E]<<24-E%4*8;s.call(this,d,u)}else s.apply(this,arguments)};a.prototype=o}}(),r.lib.WordArray})}(vf)),vf.exports}var yf={exports:{}},Ef;function SR(){return Ef||(Ef=1,function(e,t){(function(r,n){e.exports=n(ze())})(Be,function(r){return function(){var n=r,i=n.lib,o=i.WordArray,s=n.enc;s.Utf16=s.Utf16BE={stringify:function(c){for(var u=c.words,d=c.sigBytes,E=[],m=0;m<d;m+=2){var f=u[m>>>2]>>>16-m%4*8&65535;E.push(String.fromCharCode(f))}return E.join("")},parse:function(c){for(var u=c.length,d=[],E=0;E<u;E++)d[E>>>1]|=c.charCodeAt(E)<<16-E%2*16;return o.create(d,u*2)}},s.Utf16LE={stringify:function(c){for(var u=c.words,d=c.sigBytes,E=[],m=0;m<d;m+=2){var f=a(u[m>>>2]>>>16-m%4*8&65535);E.push(String.fromCharCode(f))}return E.join("")},parse:function(c){for(var u=c.length,d=[],E=0;E<u;E++)d[E>>>1]|=a(c.charCodeAt(E)<<16-E%2*16);return o.create(d,u*2)}};function a(c){return c<<8&4278255360|c>>>8&16711935}}(),r.enc.Utf16})}(yf)),yf.exports}var Rf={exports:{}},bf;function Ai(){return bf||(bf=1,function(e,t){(function(r,n){e.exports=n(ze())})(Be,function(r){return function(){var n=r,i=n.lib,o=i.WordArray,s=n.enc;s.Base64={stringify:function(c){var u=c.words,d=c.sigBytes,E=this._map;c.clamp();for(var m=[],f=0;f<d;f+=3)for(var y=u[f>>>2]>>>24-f%4*8&255,S=u[f+1>>>2]>>>24-(f+1)%4*8&255,l=u[f+2>>>2]>>>24-(f+2)%4*8&255,h=y<<16|S<<8|l,p=0;p<4&&f+p*.75<d;p++)m.push(E.charAt(h>>>6*(3-p)&63));var v=E.charAt(64);if(v)for(;m.length%4;)m.push(v);return m.join("")},parse:function(c){var u=c.length,d=this._map,E=this._reverseMap;if(!E){E=this._reverseMap=[];for(var m=0;m<d.length;m++)E[d.charCodeAt(m)]=m}var f=d.charAt(64);if(f){var y=c.indexOf(f);y!==-1&&(u=y)}return a(c,u,E)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function a(c,u,d){for(var E=[],m=0,f=0;f<u;f++)if(f%4){var y=d[c.charCodeAt(f-1)]<<f%4*2,S=d[c.charCodeAt(f)]>>>6-f%4*2,l=y|S;E[m>>>2]|=l<<24-m%4*8,m++}return o.create(E,m)}}(),r.enc.Base64})}(Rf)),Rf.exports}var _f={exports:{}},Tf;function yR(){return Tf||(Tf=1,function(e,t){(function(r,n){e.exports=n(ze())})(Be,function(r){return function(){var n=r,i=n.lib,o=i.WordArray,s=n.enc;s.Base64url={stringify:function(c,u){u===void 0&&(u=!0);var d=c.words,E=c.sigBytes,m=u?this._safe_map:this._map;c.clamp();for(var f=[],y=0;y<E;y+=3)for(var S=d[y>>>2]>>>24-y%4*8&255,l=d[y+1>>>2]>>>24-(y+1)%4*8&255,h=d[y+2>>>2]>>>24-(y+2)%4*8&255,p=S<<16|l<<8|h,v=0;v<4&&y+v*.75<E;v++)f.push(m.charAt(p>>>6*(3-v)&63));var g=m.charAt(64);if(g)for(;f.length%4;)f.push(g);return f.join("")},parse:function(c,u){u===void 0&&(u=!0);var d=c.length,E=u?this._safe_map:this._map,m=this._reverseMap;if(!m){m=this._reverseMap=[];for(var f=0;f<E.length;f++)m[E.charCodeAt(f)]=f}var y=E.charAt(64);if(y){var S=c.indexOf(y);S!==-1&&(d=S)}return a(c,d,m)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"};function a(c,u,d){for(var E=[],m=0,f=0;f<u;f++)if(f%4){var y=d[c.charCodeAt(f-1)]<<f%4*2,S=d[c.charCodeAt(f)]>>>6-f%4*2,l=y|S;E[m>>>2]|=l<<24-m%4*8,m++}return o.create(E,m)}}(),r.enc.Base64url})}(_f)),_f.exports}var Cf={exports:{}},wf;function ki(){return wf||(wf=1,function(e,t){(function(r,n){e.exports=n(ze())})(Be,function(r){return function(n){var i=r,o=i.lib,s=o.WordArray,a=o.Hasher,c=i.algo,u=[];(function(){for(var S=0;S<64;S++)u[S]=n.abs(n.sin(S+1))*4294967296|0})();var d=c.MD5=a.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(S,l){for(var h=0;h<16;h++){var p=l+h,v=S[p];S[p]=(v<<8|v>>>24)&16711935|(v<<24|v>>>8)&4278255360}var g=this._hash.words,R=S[l+0],_=S[l+1],w=S[l+2],k=S[l+3],O=S[l+4],C=S[l+5],b=S[l+6],A=S[l+7],T=S[l+8],M=S[l+9],D=S[l+10],N=S[l+11],P=S[l+12],I=S[l+13],L=S[l+14],W=S[l+15],U=g[0],x=g[1],V=g[2],j=g[3];U=E(U,x,V,j,R,7,u[0]),j=E(j,U,x,V,_,12,u[1]),V=E(V,j,U,x,w,17,u[2]),x=E(x,V,j,U,k,22,u[3]),U=E(U,x,V,j,O,7,u[4]),j=E(j,U,x,V,C,12,u[5]),V=E(V,j,U,x,b,17,u[6]),x=E(x,V,j,U,A,22,u[7]),U=E(U,x,V,j,T,7,u[8]),j=E(j,U,x,V,M,12,u[9]),V=E(V,j,U,x,D,17,u[10]),x=E(x,V,j,U,N,22,u[11]),U=E(U,x,V,j,P,7,u[12]),j=E(j,U,x,V,I,12,u[13]),V=E(V,j,U,x,L,17,u[14]),x=E(x,V,j,U,W,22,u[15]),U=m(U,x,V,j,_,5,u[16]),j=m(j,U,x,V,b,9,u[17]),V=m(V,j,U,x,N,14,u[18]),x=m(x,V,j,U,R,20,u[19]),U=m(U,x,V,j,C,5,u[20]),j=m(j,U,x,V,D,9,u[21]),V=m(V,j,U,x,W,14,u[22]),x=m(x,V,j,U,O,20,u[23]),U=m(U,x,V,j,M,5,u[24]),j=m(j,U,x,V,L,9,u[25]),V=m(V,j,U,x,k,14,u[26]),x=m(x,V,j,U,T,20,u[27]),U=m(U,x,V,j,I,5,u[28]),j=m(j,U,x,V,w,9,u[29]),V=m(V,j,U,x,A,14,u[30]),x=m(x,V,j,U,P,20,u[31]),U=f(U,x,V,j,C,4,u[32]),j=f(j,U,x,V,T,11,u[33]),V=f(V,j,U,x,N,16,u[34]),x=f(x,V,j,U,L,23,u[35]),U=f(U,x,V,j,_,4,u[36]),j=f(j,U,x,V,O,11,u[37]),V=f(V,j,U,x,A,16,u[38]),x=f(x,V,j,U,D,23,u[39]),U=f(U,x,V,j,I,4,u[40]),j=f(j,U,x,V,R,11,u[41]),V=f(V,j,U,x,k,16,u[42]),x=f(x,V,j,U,b,23,u[43]),U=f(U,x,V,j,M,4,u[44]),j=f(j,U,x,V,P,11,u[45]),V=f(V,j,U,x,W,16,u[46]),x=f(x,V,j,U,w,23,u[47]),U=y(U,x,V,j,R,6,u[48]),j=y(j,U,x,V,A,10,u[49]),V=y(V,j,U,x,L,15,u[50]),x=y(x,V,j,U,C,21,u[51]),U=y(U,x,V,j,P,6,u[52]),j=y(j,U,x,V,k,10,u[53]),V=y(V,j,U,x,D,15,u[54]),x=y(x,V,j,U,_,21,u[55]),U=y(U,x,V,j,T,6,u[56]),j=y(j,U,x,V,W,10,u[57]),V=y(V,j,U,x,b,15,u[58]),x=y(x,V,j,U,I,21,u[59]),U=y(U,x,V,j,O,6,u[60]),j=y(j,U,x,V,N,10,u[61]),V=y(V,j,U,x,w,15,u[62]),x=y(x,V,j,U,M,21,u[63]),g[0]=g[0]+U|0,g[1]=g[1]+x|0,g[2]=g[2]+V|0,g[3]=g[3]+j|0},_doFinalize:function(){var S=this._data,l=S.words,h=this._nDataBytes*8,p=S.sigBytes*8;l[p>>>5]|=128<<24-p%32;var v=n.floor(h/4294967296),g=h;l[(p+64>>>9<<4)+15]=(v<<8|v>>>24)&16711935|(v<<24|v>>>8)&4278255360,l[(p+64>>>9<<4)+14]=(g<<8|g>>>24)&16711935|(g<<24|g>>>8)&4278255360,S.sigBytes=(l.length+1)*4,this._process();for(var R=this._hash,_=R.words,w=0;w<4;w++){var k=_[w];_[w]=(k<<8|k>>>24)&16711935|(k<<24|k>>>8)&4278255360}return R},clone:function(){var S=a.clone.call(this);return S._hash=this._hash.clone(),S}});function E(S,l,h,p,v,g,R){var _=S+(l&h|~l&p)+v+R;return(_<<g|_>>>32-g)+l}function m(S,l,h,p,v,g,R){var _=S+(l&p|h&~p)+v+R;return(_<<g|_>>>32-g)+l}function f(S,l,h,p,v,g,R){var _=S+(l^h^p)+v+R;return(_<<g|_>>>32-g)+l}function y(S,l,h,p,v,g,R){var _=S+(h^(l|~p))+v+R;return(_<<g|_>>>32-g)+l}i.MD5=a._createHelper(d),i.HmacMD5=a._createHmacHelper(d)}(Math),r.MD5})}(Cf)),Cf.exports}var Af={exports:{}},kf;function jv(){return kf||(kf=1,function(e,t){(function(r,n){e.exports=n(ze())})(Be,function(r){return function(){var n=r,i=n.lib,o=i.WordArray,s=i.Hasher,a=n.algo,c=[],u=a.SHA1=s.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(d,E){for(var m=this._hash.words,f=m[0],y=m[1],S=m[2],l=m[3],h=m[4],p=0;p<80;p++){if(p<16)c[p]=d[E+p]|0;else{var v=c[p-3]^c[p-8]^c[p-14]^c[p-16];c[p]=v<<1|v>>>31}var g=(f<<5|f>>>27)+h+c[p];p<20?g+=(y&S|~y&l)+1518500249:p<40?g+=(y^S^l)+1859775393:p<60?g+=(y&S|y&l|S&l)-1894007588:g+=(y^S^l)-899497514,h=l,l=S,S=y<<30|y>>>2,y=f,f=g}m[0]=m[0]+f|0,m[1]=m[1]+y|0,m[2]=m[2]+S|0,m[3]=m[3]+l|0,m[4]=m[4]+h|0},_doFinalize:function(){var d=this._data,E=d.words,m=this._nDataBytes*8,f=d.sigBytes*8;return E[f>>>5]|=128<<24-f%32,E[(f+64>>>9<<4)+14]=Math.floor(m/4294967296),E[(f+64>>>9<<4)+15]=m,d.sigBytes=E.length*4,this._process(),this._hash},clone:function(){var d=s.clone.call(this);return d._hash=this._hash.clone(),d}});n.SHA1=s._createHelper(u),n.HmacSHA1=s._createHmacHelper(u)}(),r.SHA1})}(Af)),Af.exports}var Pf={exports:{}},If;function Wd(){return If||(If=1,function(e,t){(function(r,n){e.exports=n(ze())})(Be,function(r){return function(n){var i=r,o=i.lib,s=o.WordArray,a=o.Hasher,c=i.algo,u=[],d=[];(function(){function f(h){for(var p=n.sqrt(h),v=2;v<=p;v++)if(!(h%v))return!1;return!0}function y(h){return(h-(h|0))*4294967296|0}for(var S=2,l=0;l<64;)f(S)&&(l<8&&(u[l]=y(n.pow(S,1/2))),d[l]=y(n.pow(S,1/3)),l++),S++})();var E=[],m=c.SHA256=a.extend({_doReset:function(){this._hash=new s.init(u.slice(0))},_doProcessBlock:function(f,y){for(var S=this._hash.words,l=S[0],h=S[1],p=S[2],v=S[3],g=S[4],R=S[5],_=S[6],w=S[7],k=0;k<64;k++){if(k<16)E[k]=f[y+k]|0;else{var O=E[k-15],C=(O<<25|O>>>7)^(O<<14|O>>>18)^O>>>3,b=E[k-2],A=(b<<15|b>>>17)^(b<<13|b>>>19)^b>>>10;E[k]=C+E[k-7]+A+E[k-16]}var T=g&R^~g&_,M=l&h^l&p^h&p,D=(l<<30|l>>>2)^(l<<19|l>>>13)^(l<<10|l>>>22),N=(g<<26|g>>>6)^(g<<21|g>>>11)^(g<<7|g>>>25),P=w+N+T+d[k]+E[k],I=D+M;w=_,_=R,R=g,g=v+P|0,v=p,p=h,h=l,l=P+I|0}S[0]=S[0]+l|0,S[1]=S[1]+h|0,S[2]=S[2]+p|0,S[3]=S[3]+v|0,S[4]=S[4]+g|0,S[5]=S[5]+R|0,S[6]=S[6]+_|0,S[7]=S[7]+w|0},_doFinalize:function(){var f=this._data,y=f.words,S=this._nDataBytes*8,l=f.sigBytes*8;return y[l>>>5]|=128<<24-l%32,y[(l+64>>>9<<4)+14]=n.floor(S/4294967296),y[(l+64>>>9<<4)+15]=S,f.sigBytes=y.length*4,this._process(),this._hash},clone:function(){var f=a.clone.call(this);return f._hash=this._hash.clone(),f}});i.SHA256=a._createHelper(m),i.HmacSHA256=a._createHmacHelper(m)}(Math),r.SHA256})}(Pf)),Pf.exports}var Of={exports:{}},Df;function ER(){return Df||(Df=1,function(e,t){(function(r,n,i){e.exports=n(ze(),Wd())})(Be,function(r){return function(){var n=r,i=n.lib,o=i.WordArray,s=n.algo,a=s.SHA256,c=s.SHA224=a.extend({_doReset:function(){this._hash=new o.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var u=a._doFinalize.call(this);return u.sigBytes-=4,u}});n.SHA224=a._createHelper(c),n.HmacSHA224=a._createHmacHelper(c)}(),r.SHA224})}(Of)),Of.exports}var Mf={exports:{}},Nf;function Fv(){return Nf||(Nf=1,function(e,t){(function(r,n,i){e.exports=n(ze(),Rc())})(Be,function(r){return function(){var n=r,i=n.lib,o=i.Hasher,s=n.x64,a=s.Word,c=s.WordArray,u=n.algo;function d(){return a.create.apply(a,arguments)}var E=[d(1116352408,3609767458),d(1899447441,602891725),d(3049323471,3964484399),d(3921009573,2173295548),d(961987163,4081628472),d(1508970993,3053834265),d(2453635748,2937671579),d(2870763221,3664609560),d(3624381080,2734883394),d(310598401,1164996542),d(607225278,1323610764),d(1426881987,3590304994),d(1925078388,4068182383),d(2162078206,991336113),d(2614888103,633803317),d(3248222580,3479774868),d(3835390401,2666613458),d(4022224774,944711139),d(264347078,2341262773),d(604807628,2007800933),d(770255983,1495990901),d(1249150122,1856431235),d(1555081692,3175218132),d(1996064986,2198950837),d(2554220882,3999719339),d(2821834349,766784016),d(2952996808,2566594879),d(3210313671,3203337956),d(3336571891,1034457026),d(3584528711,2466948901),d(113926993,3758326383),d(338241895,168717936),d(666307205,1188179964),d(773529912,1546045734),d(1294757372,1522805485),d(1396182291,2643833823),d(1695183700,2343527390),d(1986661051,1014477480),d(2177026350,1206759142),d(2456956037,344077627),d(2730485921,1290863460),d(2820302411,3158454273),d(3259730800,3505952657),d(3345764771,106217008),d(3516065817,3606008344),d(3600352804,1432725776),d(4094571909,1467031594),d(275423344,851169720),d(430227734,3100823752),d(506948616,1363258195),d(659060556,3750685593),d(883997877,3785050280),d(958139571,3318307427),d(1322822218,3812723403),d(1537002063,2003034995),d(1747873779,3602036899),d(1955562222,1575990012),d(2024104815,1125592928),d(2227730452,2716904306),d(2361852424,442776044),d(2428436474,593698344),d(2756734187,3733110249),d(3204031479,2999351573),d(3329325298,3815920427),d(3391569614,3928383900),d(3515267271,566280711),d(3940187606,3454069534),d(4118630271,4000239992),d(116418474,1914138554),d(174292421,2731055270),d(289380356,3203993006),d(460393269,320620315),d(685471733,587496836),d(852142971,1086792851),d(1017036298,365543100),d(1126000580,2618297676),d(1288033470,3409855158),d(1501505948,4234509866),d(1607167915,987167468),d(1816402316,1246189591)],m=[];(function(){for(var y=0;y<80;y++)m[y]=d()})();var f=u.SHA512=o.extend({_doReset:function(){this._hash=new c.init([new a.init(1779033703,4089235720),new a.init(3144134277,2227873595),new a.init(1013904242,4271175723),new a.init(2773480762,1595750129),new a.init(1359893119,2917565137),new a.init(2600822924,725511199),new a.init(528734635,4215389547),new a.init(1541459225,327033209)])},_doProcessBlock:function(y,S){for(var l=this._hash.words,h=l[0],p=l[1],v=l[2],g=l[3],R=l[4],_=l[5],w=l[6],k=l[7],O=h.high,C=h.low,b=p.high,A=p.low,T=v.high,M=v.low,D=g.high,N=g.low,P=R.high,I=R.low,L=_.high,W=_.low,U=w.high,x=w.low,V=k.high,j=k.low,H=O,z=C,K=b,$=A,Z=T,ne=M,te=D,ae=N,le=P,fe=I,ve=L,Se=W,be=U,Me=x,_e=V,ke=j,Pe=0;Pe<80;Pe++){var Le,Qe,Ge=m[Pe];if(Pe<16)Qe=Ge.high=y[S+Pe*2]|0,Le=Ge.low=y[S+Pe*2+1]|0;else{var rt=m[Pe-15],Xe=rt.high,at=rt.low,Jt=(Xe>>>1|at<<31)^(Xe>>>8|at<<24)^Xe>>>7,jt=(at>>>1|Xe<<31)^(at>>>8|Xe<<24)^(at>>>7|Xe<<25),It=m[Pe-2],ot=It.high,Et=It.low,nt=(ot>>>19|Et<<13)^(ot<<3|Et>>>29)^ot>>>6,Ie=(Et>>>19|ot<<13)^(Et<<3|ot>>>29)^(Et>>>6|ot<<26),Te=m[Pe-7],$e=Te.high,Rt=Te.low,F=m[Pe-16],q=F.high,G=F.low;Le=jt+Rt,Qe=Jt+$e+(Le>>>0<jt>>>0?1:0),Le=Le+Ie,Qe=Qe+nt+(Le>>>0<Ie>>>0?1:0),Le=Le+G,Qe=Qe+q+(Le>>>0<G>>>0?1:0),Ge.high=Qe,Ge.low=Le}var J=le&ve^~le&be,X=fe&Se^~fe&Me,re=H&K^H&Z^K&Z,Y=z&$^z&ne^$&ne,ce=(H>>>28|z<<4)^(H<<30|z>>>2)^(H<<25|z>>>7),oe=(z>>>28|H<<4)^(z<<30|H>>>2)^(z<<25|H>>>7),de=(le>>>14|fe<<18)^(le>>>18|fe<<14)^(le<<23|fe>>>9),Ee=(fe>>>14|le<<18)^(fe>>>18|le<<14)^(fe<<23|le>>>9),Ae=E[Pe],Ke=Ae.high,Ir=Ae.low,rr=ke+Ee,kn=_e+de+(rr>>>0<ke>>>0?1:0),rr=rr+X,kn=kn+J+(rr>>>0<X>>>0?1:0),rr=rr+Ir,kn=kn+Ke+(rr>>>0<Ir>>>0?1:0),rr=rr+Le,kn=kn+Qe+(rr>>>0<Le>>>0?1:0),bh=oe+Y,J1=ce+re+(bh>>>0<oe>>>0?1:0);_e=be,ke=Me,be=ve,Me=Se,ve=le,Se=fe,fe=ae+rr|0,le=te+kn+(fe>>>0<ae>>>0?1:0)|0,te=Z,ae=ne,Z=K,ne=$,K=H,$=z,z=rr+bh|0,H=kn+J1+(z>>>0<rr>>>0?1:0)|0}C=h.low=C+z,h.high=O+H+(C>>>0<z>>>0?1:0),A=p.low=A+$,p.high=b+K+(A>>>0<$>>>0?1:0),M=v.low=M+ne,v.high=T+Z+(M>>>0<ne>>>0?1:0),N=g.low=N+ae,g.high=D+te+(N>>>0<ae>>>0?1:0),I=R.low=I+fe,R.high=P+le+(I>>>0<fe>>>0?1:0),W=_.low=W+Se,_.high=L+ve+(W>>>0<Se>>>0?1:0),x=w.low=x+Me,w.high=U+be+(x>>>0<Me>>>0?1:0),j=k.low=j+ke,k.high=V+_e+(j>>>0<ke>>>0?1:0)},_doFinalize:function(){var y=this._data,S=y.words,l=this._nDataBytes*8,h=y.sigBytes*8;S[h>>>5]|=128<<24-h%32,S[(h+128>>>10<<5)+30]=Math.floor(l/4294967296),S[(h+128>>>10<<5)+31]=l,y.sigBytes=S.length*4,this._process();var p=this._hash.toX32();return p},clone:function(){var y=o.clone.call(this);return y._hash=this._hash.clone(),y},blockSize:1024/32});n.SHA512=o._createHelper(f),n.HmacSHA512=o._createHmacHelper(f)}(),r.SHA512})}(Mf)),Mf.exports}var Lf={exports:{}},xf;function RR(){return xf||(xf=1,function(e,t){(function(r,n,i){e.exports=n(ze(),Rc(),Fv())})(Be,function(r){return function(){var n=r,i=n.x64,o=i.Word,s=i.WordArray,a=n.algo,c=a.SHA512,u=a.SHA384=c.extend({_doReset:function(){this._hash=new s.init([new o.init(3418070365,3238371032),new o.init(1654270250,914150663),new o.init(2438529370,812702999),new o.init(355462360,4144912697),new o.init(1731405415,4290775857),new o.init(2394180231,1750603025),new o.init(3675008525,1694076839),new o.init(1203062813,3204075428)])},_doFinalize:function(){var d=c._doFinalize.call(this);return d.sigBytes-=16,d}});n.SHA384=c._createHelper(u),n.HmacSHA384=c._createHmacHelper(u)}(),r.SHA384})}(Lf)),Lf.exports}var Uf={exports:{}},Vf;function bR(){return Vf||(Vf=1,function(e,t){(function(r,n,i){e.exports=n(ze(),Rc())})(Be,function(r){return function(n){var i=r,o=i.lib,s=o.WordArray,a=o.Hasher,c=i.x64,u=c.Word,d=i.algo,E=[],m=[],f=[];(function(){for(var l=1,h=0,p=0;p<24;p++){E[l+5*h]=(p+1)*(p+2)/2%64;var v=h%5,g=(2*l+3*h)%5;l=v,h=g}for(var l=0;l<5;l++)for(var h=0;h<5;h++)m[l+5*h]=h+(2*l+3*h)%5*5;for(var R=1,_=0;_<24;_++){for(var w=0,k=0,O=0;O<7;O++){if(R&1){var C=(1<<O)-1;C<32?k^=1<<C:w^=1<<C-32}R&128?R=R<<1^113:R<<=1}f[_]=u.create(w,k)}})();var y=[];(function(){for(var l=0;l<25;l++)y[l]=u.create()})();var S=d.SHA3=a.extend({cfg:a.cfg.extend({outputLength:512}),_doReset:function(){for(var l=this._state=[],h=0;h<25;h++)l[h]=new u.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(l,h){for(var p=this._state,v=this.blockSize/2,g=0;g<v;g++){var R=l[h+2*g],_=l[h+2*g+1];R=(R<<8|R>>>24)&16711935|(R<<24|R>>>8)&4278255360,_=(_<<8|_>>>24)&16711935|(_<<24|_>>>8)&4278255360;var w=p[g];w.high^=_,w.low^=R}for(var k=0;k<24;k++){for(var O=0;O<5;O++){for(var C=0,b=0,A=0;A<5;A++){var w=p[O+5*A];C^=w.high,b^=w.low}var T=y[O];T.high=C,T.low=b}for(var O=0;O<5;O++)for(var M=y[(O+4)%5],D=y[(O+1)%5],N=D.high,P=D.low,C=M.high^(N<<1|P>>>31),b=M.low^(P<<1|N>>>31),A=0;A<5;A++){var w=p[O+5*A];w.high^=C,w.low^=b}for(var I=1;I<25;I++){var C,b,w=p[I],L=w.high,W=w.low,U=E[I];U<32?(C=L<<U|W>>>32-U,b=W<<U|L>>>32-U):(C=W<<U-32|L>>>64-U,b=L<<U-32|W>>>64-U);var x=y[m[I]];x.high=C,x.low=b}var V=y[0],j=p[0];V.high=j.high,V.low=j.low;for(var O=0;O<5;O++)for(var A=0;A<5;A++){var I=O+5*A,w=p[I],H=y[I],z=y[(O+1)%5+5*A],K=y[(O+2)%5+5*A];w.high=H.high^~z.high&K.high,w.low=H.low^~z.low&K.low}var w=p[0],$=f[k];w.high^=$.high,w.low^=$.low}},_doFinalize:function(){var l=this._data,h=l.words;this._nDataBytes*8;var p=l.sigBytes*8,v=this.blockSize*32;h[p>>>5]|=1<<24-p%32,h[(n.ceil((p+1)/v)*v>>>5)-1]|=128,l.sigBytes=h.length*4,this._process();for(var g=this._state,R=this.cfg.outputLength/8,_=R/8,w=[],k=0;k<_;k++){var O=g[k],C=O.high,b=O.low;C=(C<<8|C>>>24)&16711935|(C<<24|C>>>8)&4278255360,b=(b<<8|b>>>24)&16711935|(b<<24|b>>>8)&4278255360,w.push(b),w.push(C)}return new s.init(w,R)},clone:function(){for(var l=a.clone.call(this),h=l._state=this._state.slice(0),p=0;p<25;p++)h[p]=h[p].clone();return l}});i.SHA3=a._createHelper(S),i.HmacSHA3=a._createHmacHelper(S)}(Math),r.SHA3})}(Uf)),Uf.exports}var Bf={exports:{}},jf;function _R(){return jf||(jf=1,function(e,t){(function(r,n){e.exports=n(ze())})(Be,function(r){/** @preserve
			(c) 2012 by Cdric Mesnil. All rights reserved.

			Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

			    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
			    - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.

			THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
			*/return function(n){var i=r,o=i.lib,s=o.WordArray,a=o.Hasher,c=i.algo,u=s.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),d=s.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),E=s.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),m=s.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),f=s.create([0,1518500249,1859775393,2400959708,2840853838]),y=s.create([1352829926,1548603684,1836072691,2053994217,0]),S=c.RIPEMD160=a.extend({_doReset:function(){this._hash=s.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(_,w){for(var k=0;k<16;k++){var O=w+k,C=_[O];_[O]=(C<<8|C>>>24)&16711935|(C<<24|C>>>8)&4278255360}var b=this._hash.words,A=f.words,T=y.words,M=u.words,D=d.words,N=E.words,P=m.words,I,L,W,U,x,V,j,H,z,K;V=I=b[0],j=L=b[1],H=W=b[2],z=U=b[3],K=x=b[4];for(var $,k=0;k<80;k+=1)$=I+_[w+M[k]]|0,k<16?$+=l(L,W,U)+A[0]:k<32?$+=h(L,W,U)+A[1]:k<48?$+=p(L,W,U)+A[2]:k<64?$+=v(L,W,U)+A[3]:$+=g(L,W,U)+A[4],$=$|0,$=R($,N[k]),$=$+x|0,I=x,x=U,U=R(W,10),W=L,L=$,$=V+_[w+D[k]]|0,k<16?$+=g(j,H,z)+T[0]:k<32?$+=v(j,H,z)+T[1]:k<48?$+=p(j,H,z)+T[2]:k<64?$+=h(j,H,z)+T[3]:$+=l(j,H,z)+T[4],$=$|0,$=R($,P[k]),$=$+K|0,V=K,K=z,z=R(H,10),H=j,j=$;$=b[1]+W+z|0,b[1]=b[2]+U+K|0,b[2]=b[3]+x+V|0,b[3]=b[4]+I+j|0,b[4]=b[0]+L+H|0,b[0]=$},_doFinalize:function(){var _=this._data,w=_.words,k=this._nDataBytes*8,O=_.sigBytes*8;w[O>>>5]|=128<<24-O%32,w[(O+64>>>9<<4)+14]=(k<<8|k>>>24)&16711935|(k<<24|k>>>8)&4278255360,_.sigBytes=(w.length+1)*4,this._process();for(var C=this._hash,b=C.words,A=0;A<5;A++){var T=b[A];b[A]=(T<<8|T>>>24)&16711935|(T<<24|T>>>8)&4278255360}return C},clone:function(){var _=a.clone.call(this);return _._hash=this._hash.clone(),_}});function l(_,w,k){return _^w^k}function h(_,w,k){return _&w|~_&k}function p(_,w,k){return(_|~w)^k}function v(_,w,k){return _&k|w&~k}function g(_,w,k){return _^(w|~k)}function R(_,w){return _<<w|_>>>32-w}i.RIPEMD160=a._createHelper(S),i.HmacRIPEMD160=a._createHmacHelper(S)}(),r.RIPEMD160})}(Bf)),Bf.exports}var Ff={exports:{}},Hf;function zd(){return Hf||(Hf=1,function(e,t){(function(r,n){e.exports=n(ze())})(Be,function(r){(function(){var n=r,i=n.lib,o=i.Base,s=n.enc,a=s.Utf8,c=n.algo;c.HMAC=o.extend({init:function(u,d){u=this._hasher=new u.init,typeof d=="string"&&(d=a.parse(d));var E=u.blockSize,m=E*4;d.sigBytes>m&&(d=u.finalize(d)),d.clamp();for(var f=this._oKey=d.clone(),y=this._iKey=d.clone(),S=f.words,l=y.words,h=0;h<E;h++)S[h]^=1549556828,l[h]^=909522486;f.sigBytes=y.sigBytes=m,this.reset()},reset:function(){var u=this._hasher;u.reset(),u.update(this._iKey)},update:function(u){return this._hasher.update(u),this},finalize:function(u){var d=this._hasher,E=d.finalize(u);d.reset();var m=d.finalize(this._oKey.clone().concat(E));return m}})})()})}(Ff)),Ff.exports}var Wf={exports:{}},zf;function TR(){return zf||(zf=1,function(e,t){(function(r,n,i){e.exports=n(ze(),Wd(),zd())})(Be,function(r){return function(){var n=r,i=n.lib,o=i.Base,s=i.WordArray,a=n.algo,c=a.SHA256,u=a.HMAC,d=a.PBKDF2=o.extend({cfg:o.extend({keySize:128/32,hasher:c,iterations:25e4}),init:function(E){this.cfg=this.cfg.extend(E)},compute:function(E,m){for(var f=this.cfg,y=u.create(f.hasher,E),S=s.create(),l=s.create([1]),h=S.words,p=l.words,v=f.keySize,g=f.iterations;h.length<v;){var R=y.update(m).finalize(l);y.reset();for(var _=R.words,w=_.length,k=R,O=1;O<g;O++){k=y.finalize(k),y.reset();for(var C=k.words,b=0;b<w;b++)_[b]^=C[b]}S.concat(R),p[0]++}return S.sigBytes=v*4,S}});n.PBKDF2=function(E,m,f){return d.create(f).compute(E,m)}}(),r.PBKDF2})}(Wf)),Wf.exports}var $f={exports:{}},Kf;function ti(){return Kf||(Kf=1,function(e,t){(function(r,n,i){e.exports=n(ze(),jv(),zd())})(Be,function(r){return function(){var n=r,i=n.lib,o=i.Base,s=i.WordArray,a=n.algo,c=a.MD5,u=a.EvpKDF=o.extend({cfg:o.extend({keySize:128/32,hasher:c,iterations:1}),init:function(d){this.cfg=this.cfg.extend(d)},compute:function(d,E){for(var m,f=this.cfg,y=f.hasher.create(),S=s.create(),l=S.words,h=f.keySize,p=f.iterations;l.length<h;){m&&y.update(m),m=y.update(d).finalize(E),y.reset();for(var v=1;v<p;v++)m=y.finalize(m),y.reset();S.concat(m)}return S.sigBytes=h*4,S}});n.EvpKDF=function(d,E,m){return u.create(m).compute(d,E)}}(),r.EvpKDF})}($f)),$f.exports}var Gf={exports:{}},Jf;function Vt(){return Jf||(Jf=1,function(e,t){(function(r,n,i){e.exports=n(ze(),ti())})(Be,function(r){r.lib.Cipher||function(n){var i=r,o=i.lib,s=o.Base,a=o.WordArray,c=o.BufferedBlockAlgorithm,u=i.enc;u.Utf8;var d=u.Base64,E=i.algo,m=E.EvpKDF,f=o.Cipher=c.extend({cfg:s.extend(),createEncryptor:function(C,b){return this.create(this._ENC_XFORM_MODE,C,b)},createDecryptor:function(C,b){return this.create(this._DEC_XFORM_MODE,C,b)},init:function(C,b,A){this.cfg=this.cfg.extend(A),this._xformMode=C,this._key=b,this.reset()},reset:function(){c.reset.call(this),this._doReset()},process:function(C){return this._append(C),this._process()},finalize:function(C){C&&this._append(C);var b=this._doFinalize();return b},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function C(b){return typeof b=="string"?O:_}return function(b){return{encrypt:function(A,T,M){return C(T).encrypt(b,A,T,M)},decrypt:function(A,T,M){return C(T).decrypt(b,A,T,M)}}}}()});o.StreamCipher=f.extend({_doFinalize:function(){var C=this._process(!0);return C},blockSize:1});var y=i.mode={},S=o.BlockCipherMode=s.extend({createEncryptor:function(C,b){return this.Encryptor.create(C,b)},createDecryptor:function(C,b){return this.Decryptor.create(C,b)},init:function(C,b){this._cipher=C,this._iv=b}}),l=y.CBC=function(){var C=S.extend();C.Encryptor=C.extend({processBlock:function(A,T){var M=this._cipher,D=M.blockSize;b.call(this,A,T,D),M.encryptBlock(A,T),this._prevBlock=A.slice(T,T+D)}}),C.Decryptor=C.extend({processBlock:function(A,T){var M=this._cipher,D=M.blockSize,N=A.slice(T,T+D);M.decryptBlock(A,T),b.call(this,A,T,D),this._prevBlock=N}});function b(A,T,M){var D,N=this._iv;N?(D=N,this._iv=n):D=this._prevBlock;for(var P=0;P<M;P++)A[T+P]^=D[P]}return C}(),h=i.pad={},p=h.Pkcs7={pad:function(C,b){for(var A=b*4,T=A-C.sigBytes%A,M=T<<24|T<<16|T<<8|T,D=[],N=0;N<T;N+=4)D.push(M);var P=a.create(D,T);C.concat(P)},unpad:function(C){var b=C.words[C.sigBytes-1>>>2]&255;C.sigBytes-=b}};o.BlockCipher=f.extend({cfg:f.cfg.extend({mode:l,padding:p}),reset:function(){var C;f.reset.call(this);var b=this.cfg,A=b.iv,T=b.mode;this._xformMode==this._ENC_XFORM_MODE?C=T.createEncryptor:(C=T.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==C?this._mode.init(this,A&&A.words):(this._mode=C.call(T,this,A&&A.words),this._mode.__creator=C)},_doProcessBlock:function(C,b){this._mode.processBlock(C,b)},_doFinalize:function(){var C,b=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(b.pad(this._data,this.blockSize),C=this._process(!0)):(C=this._process(!0),b.unpad(C)),C},blockSize:128/32});var v=o.CipherParams=s.extend({init:function(C){this.mixIn(C)},toString:function(C){return(C||this.formatter).stringify(this)}}),g=i.format={},R=g.OpenSSL={stringify:function(C){var b,A=C.ciphertext,T=C.salt;return T?b=a.create([1398893684,1701076831]).concat(T).concat(A):b=A,b.toString(d)},parse:function(C){var b,A=d.parse(C),T=A.words;return T[0]==1398893684&&T[1]==1701076831&&(b=a.create(T.slice(2,4)),T.splice(0,4),A.sigBytes-=16),v.create({ciphertext:A,salt:b})}},_=o.SerializableCipher=s.extend({cfg:s.extend({format:R}),encrypt:function(C,b,A,T){T=this.cfg.extend(T);var M=C.createEncryptor(A,T),D=M.finalize(b),N=M.cfg;return v.create({ciphertext:D,key:A,iv:N.iv,algorithm:C,mode:N.mode,padding:N.padding,blockSize:C.blockSize,formatter:T.format})},decrypt:function(C,b,A,T){T=this.cfg.extend(T),b=this._parse(b,T.format);var M=C.createDecryptor(A,T).finalize(b.ciphertext);return M},_parse:function(C,b){return typeof C=="string"?b.parse(C,this):C}}),w=i.kdf={},k=w.OpenSSL={execute:function(C,b,A,T,M){if(T||(T=a.random(64/8)),M)var D=m.create({keySize:b+A,hasher:M}).compute(C,T);else var D=m.create({keySize:b+A}).compute(C,T);var N=a.create(D.words.slice(b),A*4);return D.sigBytes=b*4,v.create({key:D,iv:N,salt:T})}},O=o.PasswordBasedCipher=_.extend({cfg:_.cfg.extend({kdf:k}),encrypt:function(C,b,A,T){T=this.cfg.extend(T);var M=T.kdf.execute(A,C.keySize,C.ivSize,T.salt,T.hasher);T.iv=M.iv;var D=_.encrypt.call(this,C,b,M.key,T);return D.mixIn(M),D},decrypt:function(C,b,A,T){T=this.cfg.extend(T),b=this._parse(b,T.format);var M=T.kdf.execute(A,C.keySize,C.ivSize,b.salt,T.hasher);T.iv=M.iv;var D=_.decrypt.call(this,C,b,M.key,T);return D}})}()})}(Gf)),Gf.exports}var qf={exports:{}},Yf;function CR(){return Yf||(Yf=1,function(e,t){(function(r,n,i){e.exports=n(ze(),Vt())})(Be,function(r){return r.mode.CFB=function(){var n=r.lib.BlockCipherMode.extend();n.Encryptor=n.extend({processBlock:function(o,s){var a=this._cipher,c=a.blockSize;i.call(this,o,s,c,a),this._prevBlock=o.slice(s,s+c)}}),n.Decryptor=n.extend({processBlock:function(o,s){var a=this._cipher,c=a.blockSize,u=o.slice(s,s+c);i.call(this,o,s,c,a),this._prevBlock=u}});function i(o,s,a,c){var u,d=this._iv;d?(u=d.slice(0),this._iv=void 0):u=this._prevBlock,c.encryptBlock(u,0);for(var E=0;E<a;E++)o[s+E]^=u[E]}return n}(),r.mode.CFB})}(qf)),qf.exports}var Qf={exports:{}},Xf;function wR(){return Xf||(Xf=1,function(e,t){(function(r,n,i){e.exports=n(ze(),Vt())})(Be,function(r){return r.mode.CTR=function(){var n=r.lib.BlockCipherMode.extend(),i=n.Encryptor=n.extend({processBlock:function(o,s){var a=this._cipher,c=a.blockSize,u=this._iv,d=this._counter;u&&(d=this._counter=u.slice(0),this._iv=void 0);var E=d.slice(0);a.encryptBlock(E,0),d[c-1]=d[c-1]+1|0;for(var m=0;m<c;m++)o[s+m]^=E[m]}});return n.Decryptor=i,n}(),r.mode.CTR})}(Qf)),Qf.exports}var Zf={exports:{}},em;function AR(){return em||(em=1,function(e,t){(function(r,n,i){e.exports=n(ze(),Vt())})(Be,function(r){/** @preserve
 * Counter block mode compatible with  Dr Brian Gladman fileenc.c
 * derived from CryptoJS.mode.CTR
 * Jan Hruby jhruby.web@gmail.com
 */return r.mode.CTRGladman=function(){var n=r.lib.BlockCipherMode.extend();function i(a){if((a>>24&255)===255){var c=a>>16&255,u=a>>8&255,d=a&255;c===255?(c=0,u===255?(u=0,d===255?d=0:++d):++u):++c,a=0,a+=c<<16,a+=u<<8,a+=d}else a+=1<<24;return a}function o(a){return(a[0]=i(a[0]))===0&&(a[1]=i(a[1])),a}var s=n.Encryptor=n.extend({processBlock:function(a,c){var u=this._cipher,d=u.blockSize,E=this._iv,m=this._counter;E&&(m=this._counter=E.slice(0),this._iv=void 0),o(m);var f=m.slice(0);u.encryptBlock(f,0);for(var y=0;y<d;y++)a[c+y]^=f[y]}});return n.Decryptor=s,n}(),r.mode.CTRGladman})}(Zf)),Zf.exports}var tm={exports:{}},rm;function kR(){return rm||(rm=1,function(e,t){(function(r,n,i){e.exports=n(ze(),Vt())})(Be,function(r){return r.mode.OFB=function(){var n=r.lib.BlockCipherMode.extend(),i=n.Encryptor=n.extend({processBlock:function(o,s){var a=this._cipher,c=a.blockSize,u=this._iv,d=this._keystream;u&&(d=this._keystream=u.slice(0),this._iv=void 0),a.encryptBlock(d,0);for(var E=0;E<c;E++)o[s+E]^=d[E]}});return n.Decryptor=i,n}(),r.mode.OFB})}(tm)),tm.exports}var nm={exports:{}},im;function PR(){return im||(im=1,function(e,t){(function(r,n,i){e.exports=n(ze(),Vt())})(Be,function(r){return r.mode.ECB=function(){var n=r.lib.BlockCipherMode.extend();return n.Encryptor=n.extend({processBlock:function(i,o){this._cipher.encryptBlock(i,o)}}),n.Decryptor=n.extend({processBlock:function(i,o){this._cipher.decryptBlock(i,o)}}),n}(),r.mode.ECB})}(nm)),nm.exports}var om={exports:{}},sm;function IR(){return sm||(sm=1,function(e,t){(function(r,n,i){e.exports=n(ze(),Vt())})(Be,function(r){return r.pad.AnsiX923={pad:function(n,i){var o=n.sigBytes,s=i*4,a=s-o%s,c=o+a-1;n.clamp(),n.words[c>>>2]|=a<<24-c%4*8,n.sigBytes+=a},unpad:function(n){var i=n.words[n.sigBytes-1>>>2]&255;n.sigBytes-=i}},r.pad.Ansix923})}(om)),om.exports}var am={exports:{}},cm;function OR(){return cm||(cm=1,function(e,t){(function(r,n,i){e.exports=n(ze(),Vt())})(Be,function(r){return r.pad.Iso10126={pad:function(n,i){var o=i*4,s=o-n.sigBytes%o;n.concat(r.lib.WordArray.random(s-1)).concat(r.lib.WordArray.create([s<<24],1))},unpad:function(n){var i=n.words[n.sigBytes-1>>>2]&255;n.sigBytes-=i}},r.pad.Iso10126})}(am)),am.exports}var um={exports:{}},lm;function DR(){return lm||(lm=1,function(e,t){(function(r,n,i){e.exports=n(ze(),Vt())})(Be,function(r){return r.pad.Iso97971={pad:function(n,i){n.concat(r.lib.WordArray.create([2147483648],1)),r.pad.ZeroPadding.pad(n,i)},unpad:function(n){r.pad.ZeroPadding.unpad(n),n.sigBytes--}},r.pad.Iso97971})}(um)),um.exports}var dm={exports:{}},hm;function MR(){return hm||(hm=1,function(e,t){(function(r,n,i){e.exports=n(ze(),Vt())})(Be,function(r){return r.pad.ZeroPadding={pad:function(n,i){var o=i*4;n.clamp(),n.sigBytes+=o-(n.sigBytes%o||o)},unpad:function(n){for(var i=n.words,o=n.sigBytes-1,o=n.sigBytes-1;o>=0;o--)if(i[o>>>2]>>>24-o%4*8&255){n.sigBytes=o+1;break}}},r.pad.ZeroPadding})}(dm)),dm.exports}var pm={exports:{}},fm;function NR(){return fm||(fm=1,function(e,t){(function(r,n,i){e.exports=n(ze(),Vt())})(Be,function(r){return r.pad.NoPadding={pad:function(){},unpad:function(){}},r.pad.NoPadding})}(pm)),pm.exports}var mm={exports:{}},gm;function LR(){return gm||(gm=1,function(e,t){(function(r,n,i){e.exports=n(ze(),Vt())})(Be,function(r){return function(n){var i=r,o=i.lib,s=o.CipherParams,a=i.enc,c=a.Hex,u=i.format;u.Hex={stringify:function(d){return d.ciphertext.toString(c)},parse:function(d){var E=c.parse(d);return s.create({ciphertext:E})}}}(),r.format.Hex})}(mm)),mm.exports}var vm={exports:{}},Sm;function xR(){return Sm||(Sm=1,function(e,t){(function(r,n,i){e.exports=n(ze(),Ai(),ki(),ti(),Vt())})(Be,function(r){return function(){var n=r,i=n.lib,o=i.BlockCipher,s=n.algo,a=[],c=[],u=[],d=[],E=[],m=[],f=[],y=[],S=[],l=[];(function(){for(var v=[],g=0;g<256;g++)g<128?v[g]=g<<1:v[g]=g<<1^283;for(var R=0,_=0,g=0;g<256;g++){var w=_^_<<1^_<<2^_<<3^_<<4;w=w>>>8^w&255^99,a[R]=w,c[w]=R;var k=v[R],O=v[k],C=v[O],b=v[w]*257^w*16843008;u[R]=b<<24|b>>>8,d[R]=b<<16|b>>>16,E[R]=b<<8|b>>>24,m[R]=b;var b=C*16843009^O*65537^k*257^R*16843008;f[w]=b<<24|b>>>8,y[w]=b<<16|b>>>16,S[w]=b<<8|b>>>24,l[w]=b,R?(R=k^v[v[v[C^k]]],_^=v[v[_]]):R=_=1}})();var h=[0,1,2,4,8,16,32,64,128,27,54],p=s.AES=o.extend({_doReset:function(){var v;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var g=this._keyPriorReset=this._key,R=g.words,_=g.sigBytes/4,w=this._nRounds=_+6,k=(w+1)*4,O=this._keySchedule=[],C=0;C<k;C++)C<_?O[C]=R[C]:(v=O[C-1],C%_?_>6&&C%_==4&&(v=a[v>>>24]<<24|a[v>>>16&255]<<16|a[v>>>8&255]<<8|a[v&255]):(v=v<<8|v>>>24,v=a[v>>>24]<<24|a[v>>>16&255]<<16|a[v>>>8&255]<<8|a[v&255],v^=h[C/_|0]<<24),O[C]=O[C-_]^v);for(var b=this._invKeySchedule=[],A=0;A<k;A++){var C=k-A;if(A%4)var v=O[C];else var v=O[C-4];A<4||C<=4?b[A]=v:b[A]=f[a[v>>>24]]^y[a[v>>>16&255]]^S[a[v>>>8&255]]^l[a[v&255]]}}},encryptBlock:function(v,g){this._doCryptBlock(v,g,this._keySchedule,u,d,E,m,a)},decryptBlock:function(v,g){var R=v[g+1];v[g+1]=v[g+3],v[g+3]=R,this._doCryptBlock(v,g,this._invKeySchedule,f,y,S,l,c);var R=v[g+1];v[g+1]=v[g+3],v[g+3]=R},_doCryptBlock:function(v,g,R,_,w,k,O,C){for(var b=this._nRounds,A=v[g]^R[0],T=v[g+1]^R[1],M=v[g+2]^R[2],D=v[g+3]^R[3],N=4,P=1;P<b;P++){var I=_[A>>>24]^w[T>>>16&255]^k[M>>>8&255]^O[D&255]^R[N++],L=_[T>>>24]^w[M>>>16&255]^k[D>>>8&255]^O[A&255]^R[N++],W=_[M>>>24]^w[D>>>16&255]^k[A>>>8&255]^O[T&255]^R[N++],U=_[D>>>24]^w[A>>>16&255]^k[T>>>8&255]^O[M&255]^R[N++];A=I,T=L,M=W,D=U}var I=(C[A>>>24]<<24|C[T>>>16&255]<<16|C[M>>>8&255]<<8|C[D&255])^R[N++],L=(C[T>>>24]<<24|C[M>>>16&255]<<16|C[D>>>8&255]<<8|C[A&255])^R[N++],W=(C[M>>>24]<<24|C[D>>>16&255]<<16|C[A>>>8&255]<<8|C[T&255])^R[N++],U=(C[D>>>24]<<24|C[A>>>16&255]<<16|C[T>>>8&255]<<8|C[M&255])^R[N++];v[g]=I,v[g+1]=L,v[g+2]=W,v[g+3]=U},keySize:256/32});n.AES=o._createHelper(p)}(),r.AES})}(vm)),vm.exports}var ym={exports:{}},Em;function UR(){return Em||(Em=1,function(e,t){(function(r,n,i){e.exports=n(ze(),Ai(),ki(),ti(),Vt())})(Be,function(r){return function(){var n=r,i=n.lib,o=i.WordArray,s=i.BlockCipher,a=n.algo,c=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],u=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],d=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],E=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],m=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],f=a.DES=s.extend({_doReset:function(){for(var h=this._key,p=h.words,v=[],g=0;g<56;g++){var R=c[g]-1;v[g]=p[R>>>5]>>>31-R%32&1}for(var _=this._subKeys=[],w=0;w<16;w++){for(var k=_[w]=[],O=d[w],g=0;g<24;g++)k[g/6|0]|=v[(u[g]-1+O)%28]<<31-g%6,k[4+(g/6|0)]|=v[28+(u[g+24]-1+O)%28]<<31-g%6;k[0]=k[0]<<1|k[0]>>>31;for(var g=1;g<7;g++)k[g]=k[g]>>>(g-1)*4+3;k[7]=k[7]<<5|k[7]>>>27}for(var C=this._invSubKeys=[],g=0;g<16;g++)C[g]=_[15-g]},encryptBlock:function(h,p){this._doCryptBlock(h,p,this._subKeys)},decryptBlock:function(h,p){this._doCryptBlock(h,p,this._invSubKeys)},_doCryptBlock:function(h,p,v){this._lBlock=h[p],this._rBlock=h[p+1],y.call(this,4,252645135),y.call(this,16,65535),S.call(this,2,858993459),S.call(this,8,16711935),y.call(this,1,1431655765);for(var g=0;g<16;g++){for(var R=v[g],_=this._lBlock,w=this._rBlock,k=0,O=0;O<8;O++)k|=E[O][((w^R[O])&m[O])>>>0];this._lBlock=w,this._rBlock=_^k}var C=this._lBlock;this._lBlock=this._rBlock,this._rBlock=C,y.call(this,1,1431655765),S.call(this,8,16711935),S.call(this,2,858993459),y.call(this,16,65535),y.call(this,4,252645135),h[p]=this._lBlock,h[p+1]=this._rBlock},keySize:64/32,ivSize:64/32,blockSize:64/32});function y(h,p){var v=(this._lBlock>>>h^this._rBlock)&p;this._rBlock^=v,this._lBlock^=v<<h}function S(h,p){var v=(this._rBlock>>>h^this._lBlock)&p;this._lBlock^=v,this._rBlock^=v<<h}n.DES=s._createHelper(f);var l=a.TripleDES=s.extend({_doReset:function(){var h=this._key,p=h.words;if(p.length!==2&&p.length!==4&&p.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var v=p.slice(0,2),g=p.length<4?p.slice(0,2):p.slice(2,4),R=p.length<6?p.slice(0,2):p.slice(4,6);this._des1=f.createEncryptor(o.create(v)),this._des2=f.createEncryptor(o.create(g)),this._des3=f.createEncryptor(o.create(R))},encryptBlock:function(h,p){this._des1.encryptBlock(h,p),this._des2.decryptBlock(h,p),this._des3.encryptBlock(h,p)},decryptBlock:function(h,p){this._des3.decryptBlock(h,p),this._des2.encryptBlock(h,p),this._des1.decryptBlock(h,p)},keySize:192/32,ivSize:64/32,blockSize:64/32});n.TripleDES=s._createHelper(l)}(),r.TripleDES})}(ym)),ym.exports}var Rm={exports:{}},bm;function VR(){return bm||(bm=1,function(e,t){(function(r,n,i){e.exports=n(ze(),Ai(),ki(),ti(),Vt())})(Be,function(r){return function(){var n=r,i=n.lib,o=i.StreamCipher,s=n.algo,a=s.RC4=o.extend({_doReset:function(){for(var d=this._key,E=d.words,m=d.sigBytes,f=this._S=[],y=0;y<256;y++)f[y]=y;for(var y=0,S=0;y<256;y++){var l=y%m,h=E[l>>>2]>>>24-l%4*8&255;S=(S+f[y]+h)%256;var p=f[y];f[y]=f[S],f[S]=p}this._i=this._j=0},_doProcessBlock:function(d,E){d[E]^=c.call(this)},keySize:256/32,ivSize:0});function c(){for(var d=this._S,E=this._i,m=this._j,f=0,y=0;y<4;y++){E=(E+1)%256,m=(m+d[E])%256;var S=d[E];d[E]=d[m],d[m]=S,f|=d[(d[E]+d[m])%256]<<24-y*8}return this._i=E,this._j=m,f}n.RC4=o._createHelper(a);var u=s.RC4Drop=a.extend({cfg:a.cfg.extend({drop:192}),_doReset:function(){a._doReset.call(this);for(var d=this.cfg.drop;d>0;d--)c.call(this)}});n.RC4Drop=o._createHelper(u)}(),r.RC4})}(Rm)),Rm.exports}var _m={exports:{}},Tm;function BR(){return Tm||(Tm=1,function(e,t){(function(r,n,i){e.exports=n(ze(),Ai(),ki(),ti(),Vt())})(Be,function(r){return function(){var n=r,i=n.lib,o=i.StreamCipher,s=n.algo,a=[],c=[],u=[],d=s.Rabbit=o.extend({_doReset:function(){for(var m=this._key.words,f=this.cfg.iv,y=0;y<4;y++)m[y]=(m[y]<<8|m[y]>>>24)&16711935|(m[y]<<24|m[y]>>>8)&4278255360;var S=this._X=[m[0],m[3]<<16|m[2]>>>16,m[1],m[0]<<16|m[3]>>>16,m[2],m[1]<<16|m[0]>>>16,m[3],m[2]<<16|m[1]>>>16],l=this._C=[m[2]<<16|m[2]>>>16,m[0]&4294901760|m[1]&65535,m[3]<<16|m[3]>>>16,m[1]&4294901760|m[2]&65535,m[0]<<16|m[0]>>>16,m[2]&4294901760|m[3]&65535,m[1]<<16|m[1]>>>16,m[3]&4294901760|m[0]&65535];this._b=0;for(var y=0;y<4;y++)E.call(this);for(var y=0;y<8;y++)l[y]^=S[y+4&7];if(f){var h=f.words,p=h[0],v=h[1],g=(p<<8|p>>>24)&16711935|(p<<24|p>>>8)&4278255360,R=(v<<8|v>>>24)&16711935|(v<<24|v>>>8)&4278255360,_=g>>>16|R&4294901760,w=R<<16|g&65535;l[0]^=g,l[1]^=_,l[2]^=R,l[3]^=w,l[4]^=g,l[5]^=_,l[6]^=R,l[7]^=w;for(var y=0;y<4;y++)E.call(this)}},_doProcessBlock:function(m,f){var y=this._X;E.call(this),a[0]=y[0]^y[5]>>>16^y[3]<<16,a[1]=y[2]^y[7]>>>16^y[5]<<16,a[2]=y[4]^y[1]>>>16^y[7]<<16,a[3]=y[6]^y[3]>>>16^y[1]<<16;for(var S=0;S<4;S++)a[S]=(a[S]<<8|a[S]>>>24)&16711935|(a[S]<<24|a[S]>>>8)&4278255360,m[f+S]^=a[S]},blockSize:128/32,ivSize:64/32});function E(){for(var m=this._X,f=this._C,y=0;y<8;y++)c[y]=f[y];f[0]=f[0]+1295307597+this._b|0,f[1]=f[1]+3545052371+(f[0]>>>0<c[0]>>>0?1:0)|0,f[2]=f[2]+886263092+(f[1]>>>0<c[1]>>>0?1:0)|0,f[3]=f[3]+1295307597+(f[2]>>>0<c[2]>>>0?1:0)|0,f[4]=f[4]+3545052371+(f[3]>>>0<c[3]>>>0?1:0)|0,f[5]=f[5]+886263092+(f[4]>>>0<c[4]>>>0?1:0)|0,f[6]=f[6]+1295307597+(f[5]>>>0<c[5]>>>0?1:0)|0,f[7]=f[7]+3545052371+(f[6]>>>0<c[6]>>>0?1:0)|0,this._b=f[7]>>>0<c[7]>>>0?1:0;for(var y=0;y<8;y++){var S=m[y]+f[y],l=S&65535,h=S>>>16,p=((l*l>>>17)+l*h>>>15)+h*h,v=((S&4294901760)*S|0)+((S&65535)*S|0);u[y]=p^v}m[0]=u[0]+(u[7]<<16|u[7]>>>16)+(u[6]<<16|u[6]>>>16)|0,m[1]=u[1]+(u[0]<<8|u[0]>>>24)+u[7]|0,m[2]=u[2]+(u[1]<<16|u[1]>>>16)+(u[0]<<16|u[0]>>>16)|0,m[3]=u[3]+(u[2]<<8|u[2]>>>24)+u[1]|0,m[4]=u[4]+(u[3]<<16|u[3]>>>16)+(u[2]<<16|u[2]>>>16)|0,m[5]=u[5]+(u[4]<<8|u[4]>>>24)+u[3]|0,m[6]=u[6]+(u[5]<<16|u[5]>>>16)+(u[4]<<16|u[4]>>>16)|0,m[7]=u[7]+(u[6]<<8|u[6]>>>24)+u[5]|0}n.Rabbit=o._createHelper(d)}(),r.Rabbit})}(_m)),_m.exports}var Cm={exports:{}},wm;function jR(){return wm||(wm=1,function(e,t){(function(r,n,i){e.exports=n(ze(),Ai(),ki(),ti(),Vt())})(Be,function(r){return function(){var n=r,i=n.lib,o=i.StreamCipher,s=n.algo,a=[],c=[],u=[],d=s.RabbitLegacy=o.extend({_doReset:function(){var m=this._key.words,f=this.cfg.iv,y=this._X=[m[0],m[3]<<16|m[2]>>>16,m[1],m[0]<<16|m[3]>>>16,m[2],m[1]<<16|m[0]>>>16,m[3],m[2]<<16|m[1]>>>16],S=this._C=[m[2]<<16|m[2]>>>16,m[0]&4294901760|m[1]&65535,m[3]<<16|m[3]>>>16,m[1]&4294901760|m[2]&65535,m[0]<<16|m[0]>>>16,m[2]&4294901760|m[3]&65535,m[1]<<16|m[1]>>>16,m[3]&4294901760|m[0]&65535];this._b=0;for(var l=0;l<4;l++)E.call(this);for(var l=0;l<8;l++)S[l]^=y[l+4&7];if(f){var h=f.words,p=h[0],v=h[1],g=(p<<8|p>>>24)&16711935|(p<<24|p>>>8)&4278255360,R=(v<<8|v>>>24)&16711935|(v<<24|v>>>8)&4278255360,_=g>>>16|R&4294901760,w=R<<16|g&65535;S[0]^=g,S[1]^=_,S[2]^=R,S[3]^=w,S[4]^=g,S[5]^=_,S[6]^=R,S[7]^=w;for(var l=0;l<4;l++)E.call(this)}},_doProcessBlock:function(m,f){var y=this._X;E.call(this),a[0]=y[0]^y[5]>>>16^y[3]<<16,a[1]=y[2]^y[7]>>>16^y[5]<<16,a[2]=y[4]^y[1]>>>16^y[7]<<16,a[3]=y[6]^y[3]>>>16^y[1]<<16;for(var S=0;S<4;S++)a[S]=(a[S]<<8|a[S]>>>24)&16711935|(a[S]<<24|a[S]>>>8)&4278255360,m[f+S]^=a[S]},blockSize:128/32,ivSize:64/32});function E(){for(var m=this._X,f=this._C,y=0;y<8;y++)c[y]=f[y];f[0]=f[0]+1295307597+this._b|0,f[1]=f[1]+3545052371+(f[0]>>>0<c[0]>>>0?1:0)|0,f[2]=f[2]+886263092+(f[1]>>>0<c[1]>>>0?1:0)|0,f[3]=f[3]+1295307597+(f[2]>>>0<c[2]>>>0?1:0)|0,f[4]=f[4]+3545052371+(f[3]>>>0<c[3]>>>0?1:0)|0,f[5]=f[5]+886263092+(f[4]>>>0<c[4]>>>0?1:0)|0,f[6]=f[6]+1295307597+(f[5]>>>0<c[5]>>>0?1:0)|0,f[7]=f[7]+3545052371+(f[6]>>>0<c[6]>>>0?1:0)|0,this._b=f[7]>>>0<c[7]>>>0?1:0;for(var y=0;y<8;y++){var S=m[y]+f[y],l=S&65535,h=S>>>16,p=((l*l>>>17)+l*h>>>15)+h*h,v=((S&4294901760)*S|0)+((S&65535)*S|0);u[y]=p^v}m[0]=u[0]+(u[7]<<16|u[7]>>>16)+(u[6]<<16|u[6]>>>16)|0,m[1]=u[1]+(u[0]<<8|u[0]>>>24)+u[7]|0,m[2]=u[2]+(u[1]<<16|u[1]>>>16)+(u[0]<<16|u[0]>>>16)|0,m[3]=u[3]+(u[2]<<8|u[2]>>>24)+u[1]|0,m[4]=u[4]+(u[3]<<16|u[3]>>>16)+(u[2]<<16|u[2]>>>16)|0,m[5]=u[5]+(u[4]<<8|u[4]>>>24)+u[3]|0,m[6]=u[6]+(u[5]<<16|u[5]>>>16)+(u[4]<<16|u[4]>>>16)|0,m[7]=u[7]+(u[6]<<8|u[6]>>>24)+u[5]|0}n.RabbitLegacy=o._createHelper(d)}(),r.RabbitLegacy})}(Cm)),Cm.exports}var Am={exports:{}},km;function FR(){return km||(km=1,function(e,t){(function(r,n,i){e.exports=n(ze(),Ai(),ki(),ti(),Vt())})(Be,function(r){return function(){var n=r,i=n.lib,o=i.BlockCipher,s=n.algo;const a=16,c=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],u=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var d={pbox:[],sbox:[]};function E(l,h){let p=h>>24&255,v=h>>16&255,g=h>>8&255,R=h&255,_=l.sbox[0][p]+l.sbox[1][v];return _=_^l.sbox[2][g],_=_+l.sbox[3][R],_}function m(l,h,p){let v=h,g=p,R;for(let _=0;_<a;++_)v=v^l.pbox[_],g=E(l,v)^g,R=v,v=g,g=R;return R=v,v=g,g=R,g=g^l.pbox[a],v=v^l.pbox[a+1],{left:v,right:g}}function f(l,h,p){let v=h,g=p,R;for(let _=a+1;_>1;--_)v=v^l.pbox[_],g=E(l,v)^g,R=v,v=g,g=R;return R=v,v=g,g=R,g=g^l.pbox[1],v=v^l.pbox[0],{left:v,right:g}}function y(l,h,p){for(let w=0;w<4;w++){l.sbox[w]=[];for(let k=0;k<256;k++)l.sbox[w][k]=u[w][k]}let v=0;for(let w=0;w<a+2;w++)l.pbox[w]=c[w]^h[v],v++,v>=p&&(v=0);let g=0,R=0,_=0;for(let w=0;w<a+2;w+=2)_=m(l,g,R),g=_.left,R=_.right,l.pbox[w]=g,l.pbox[w+1]=R;for(let w=0;w<4;w++)for(let k=0;k<256;k+=2)_=m(l,g,R),g=_.left,R=_.right,l.sbox[w][k]=g,l.sbox[w][k+1]=R;return!0}var S=s.Blowfish=o.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var l=this._keyPriorReset=this._key,h=l.words,p=l.sigBytes/4;y(d,h,p)}},encryptBlock:function(l,h){var p=m(d,l[h],l[h+1]);l[h]=p.left,l[h+1]=p.right},decryptBlock:function(l,h){var p=f(d,l[h],l[h+1]);l[h]=p.left,l[h+1]=p.right},blockSize:64/32,keySize:128/32,ivSize:64/32});n.Blowfish=o._createHelper(S)}(),r.Blowfish})}(Am)),Am.exports}(function(e,t){(function(r,n,i){e.exports=n(ze(),Rc(),vR(),SR(),Ai(),yR(),ki(),jv(),Wd(),ER(),Fv(),RR(),bR(),_R(),zd(),TR(),ti(),Vt(),CR(),wR(),AR(),kR(),PR(),IR(),OR(),DR(),MR(),NR(),LR(),xR(),UR(),VR(),BR(),jR(),FR())})(Be,function(r){return r})})(Bv);var HR=Bv.exports;const fs=dR(HR);function WR(e){return fs.MD5(e).toString().toUpperCase()}function zR(e,t,r,n,i,o,s,a){var c;let u="";o.set("x-log-apiversion","0.6.0"),o.set("x-log-signaturemethod","hmac-sha1"),u+=e+`
`+s+`
`+((c=o.get("Content-Type"))!=null?c:"")+`
`+a+`
`;const d=(y,S)=>y[0].localeCompare(S[0]),E=y=>y[0].startsWith("x-log-")||y[0].startsWith("x-acs-");try{const y=[...o.entries()].filter(E).sort(d).map(S=>S[0]+":"+S[1]+`
`).join("");u+=y}catch{}u+=t,i.size>0&&(u+="?");try{u+=[...i.entries()].sort(d).map(y=>y[0]+"="+y[1]).join("&")}catch{}const m=fs.HmacSHA1(u,n).toString(fs.enc.Base64),f="LOG "+r+":"+m;return o.set("Authorization",f),o.set("x-log-date",a),f}var $R=(e,t,r)=>new Promise((n,i)=>{var o=c=>{try{a(r.next(c))}catch(u){i(u)}},s=c=>{try{a(r.throw(c))}catch(u){i(u)}},a=c=>c.done?n(c.value):Promise.resolve(c.value).then(o,s);a((r=r.apply(e,t)).next())});function KR(e){return $R(this,null,function*(){const t=new Date;if(e.refreshSTSTokenInterval||(e.refreshSTSTokenInterval=3e5),!e.stsTokenFreshTime||+t-e.stsTokenFreshTime>=e.refreshSTSTokenInterval){e.stsTokenFreshTime=t;try{yield e.refreshSTSToken()}catch(r){typeof console.error=="function"&&console.error(`Some error occured during excuting refreshSTSToken, see:
`+r)}}return null})}var GR=(e,t,r)=>new Promise((n,i)=>{var o=c=>{try{a(r.next(c))}catch(u){i(u)}},s=c=>{try{a(r.throw(c))}catch(u){i(u)}},a=c=>c.done?n(c.value):Promise.resolve(c.value).then(o,s);a((r=r.apply(e,t)).next())});function $d(e){return{transString:function(t){let r={},n=0,i=!1;for(let o in t){if((o==="time"||o==="__time__")&&typeof t[o]=="number"){n=t[o],i=!0;continue}typeof t[o]=="object"?r[o]=JSON.stringify(t[o]):r[o]=String(t[o])}return r.__time__=i?n:Math.floor(new Date().getTime()/1e3),r},process:function(t,r){return GR(this,null,function*(){yield KR(e);let n=t.slice(t.indexOf("/logstores")),i=r.length,o=WR(r),s=new Date().toUTCString(),a=new Map,c=new Map([["Content-Type","application/json"],["Content-MD5",o],["x-log-bodyrawsize",i.toString()]]);e.securityToken&&c.set("x-acs-security-token",e.securityToken),zR("POST",n,e.accessKeyId,e.accessKeySecret,a,c,o,s);let u=Object.fromEntries(c);return{data:r,header:u}})}}}typeof window<"u"&&Vv(window,"stsPlugin",$d);var JR=/d{1,4}|D{3,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|W{1,2}|[LlopSZN]|"[^"]*"|'[^']*'/g,qR=/\b(?:[A-Z]{1,3}[A-Z][TC])(?:[-+]\d{4})?|((?:Australian )?(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time)\b/g,YR=/[^-+\dA-Z]/g;function Kd(e,t,r,n){if(arguments.length===1&&typeof e=="string"&&!/\d/.test(e)&&(t=e,e=void 0),e=e||e===0?e:new Date,e instanceof Date||(e=new Date(e)),isNaN(e))throw TypeError("Invalid date");t=String(Pm[t]||t||Pm.default);var i=t.slice(0,4);(i==="UTC:"||i==="GMT:")&&(t=t.slice(4),r=!0,i==="GMT:"&&(n=!0));var o=function(){return r?"getUTC":"get"},s=function(){return e[o()+"Date"]()},a=function(){return e[o()+"Day"]()},c=function(){return e[o()+"Month"]()},u=function(){return e[o()+"FullYear"]()},d=function(){return e[o()+"Hours"]()},E=function(){return e[o()+"Minutes"]()},m=function(){return e[o()+"Seconds"]()},f=function(){return e[o()+"Milliseconds"]()},y=function(){return r?0:e.getTimezoneOffset()},S=function(){return QR(e)},l=function(){return XR(e)},h={d:function(){return s()},dd:function(){return yr(s())},ddd:function(){return ur.dayNames[a()]},DDD:function(){return Im({y:u(),m:c(),d:s(),_:o(),dayName:ur.dayNames[a()],short:!0})},dddd:function(){return ur.dayNames[a()+7]},DDDD:function(){return Im({y:u(),m:c(),d:s(),_:o(),dayName:ur.dayNames[a()+7]})},m:function(){return c()+1},mm:function(){return yr(c()+1)},mmm:function(){return ur.monthNames[c()]},mmmm:function(){return ur.monthNames[c()+12]},yy:function(){return String(u()).slice(2)},yyyy:function(){return yr(u(),4)},h:function(){return d()%12||12},hh:function(){return yr(d()%12||12)},H:function(){return d()},HH:function(){return yr(d())},M:function(){return E()},MM:function(){return yr(E())},s:function(){return m()},ss:function(){return yr(m())},l:function(){return yr(f(),3)},L:function(){return yr(Math.floor(f()/10))},t:function(){return d()<12?ur.timeNames[0]:ur.timeNames[1]},tt:function(){return d()<12?ur.timeNames[2]:ur.timeNames[3]},T:function(){return d()<12?ur.timeNames[4]:ur.timeNames[5]},TT:function(){return d()<12?ur.timeNames[6]:ur.timeNames[7]},Z:function(){return n?"GMT":r?"UTC":ZR(e)},o:function(){return(y()>0?"-":"+")+yr(Math.floor(Math.abs(y())/60)*100+Math.abs(y())%60,4)},p:function(){return(y()>0?"-":"+")+yr(Math.floor(Math.abs(y())/60),2)+":"+yr(Math.floor(Math.abs(y())%60),2)},S:function(){return["th","st","nd","rd"][s()%10>3?0:(s()%100-s()%10!=10)*s()%10]},W:function(){return S()},WW:function(){return yr(S())},N:function(){return l()}};return t.replace(JR,function(p){return p in h?h[p]():p.slice(1,p.length-1)})}var Pm={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",paddedShortDate:"mm/dd/yyyy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},ur={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],timeNames:["a","p","am","pm","A","P","AM","PM"]},yr=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2;return String(e).padStart(t,"0")},Im=function(e){var t=e.y,r=e.m,n=e.d,i=e._,o=e.dayName,s=e.short,a=s===void 0?!1:s,c=new Date,u=new Date;u.setDate(u[i+"Date"]()-1);var d=new Date;d.setDate(d[i+"Date"]()+1);var E=function(){return c[i+"Date"]()},m=function(){return c[i+"Month"]()},f=function(){return c[i+"FullYear"]()},y=function(){return u[i+"Date"]()},S=function(){return u[i+"Month"]()},l=function(){return u[i+"FullYear"]()},h=function(){return d[i+"Date"]()},p=function(){return d[i+"Month"]()},v=function(){return d[i+"FullYear"]()};return f()===t&&m()===r&&E()===n?a?"Tdy":"Today":l()===t&&S()===r&&y()===n?a?"Ysd":"Yesterday":v()===t&&p()===r&&h()===n?a?"Tmw":"Tomorrow":o},QR=function(e){var t=new Date(e.getFullYear(),e.getMonth(),e.getDate());t.setDate(t.getDate()-(t.getDay()+6)%7+3);var r=new Date(t.getFullYear(),0,4);r.setDate(r.getDate()-(r.getDay()+6)%7+3);var n=t.getTimezoneOffset()-r.getTimezoneOffset();t.setHours(t.getHours()-n);var i=(t-r)/(864e5*7);return 1+Math.floor(i)},XR=function(e){var t=e.getDay();return t===0&&(t=7),t},ZR=function(e){return(String(e).match(qR)||[""]).pop().replace(YR,"").replace(/GMT\+0000/g,"UTC")};const{BrowserUtil:eb}=We.AliRTS,Oi={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Gecko:"Gecko",WebKit:"WebKit"},Gs=(e,t)=>{const r=t.match(e);return r&&r.length>0&&r[1]||""},tb=[{test:[/\sedg\//i,[/edg([ea]|ios)/i]],describe(e){if(/\sedg\//i.test(e))return{name:Oi.Blink};const t=Gs(/edge\/(\d+(\.?_?\d+)+)/i,e);return{name:Oi.EdgeHTML,version:t}}},{test:[/trident/i],describe(e){const t={name:Oi.Trident},r=Gs(/trident\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test(e){const t=/gecko/i.test(e),r=/like gecko/i.test(e);return t&&!r},describe(e){const t={name:Oi.Gecko},r=Gs(/gecko\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(apple)?webkit\/537\.36/i],describe(){return{name:Oi.Blink}}},{test:[/(apple)?webkit/i],describe(e){const t={name:Oi.WebKit},r=Gs(/webkit\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}}],Gd=(e,t)=>e.find(r=>{if(typeof r.test=="function")return r.test(t);if(Array.isArray(r.test))return r.test.some(n=>typeof n=="string"?t.indexOf(n)>-1:n instanceof RegExp?n.test(t):!1)}),rb=()=>{try{const e=navigator.userAgent||"",t=Gd(tb,e);if(t){const r=t.describe(e);return`${r.name}/${r.version||eb.browserVersion}`}}catch{}return navigator.userAgent},nb=[{test:["wow64","win64","x64"],describe(){return"amd64"}},{test:["i686","x86"],describe(){return"x86"}},{test:["aarch64","arm64"],describe(){return"arm64"}},{test:["arm"],describe(){return"arm"}}],Hv=()=>{let e="unknown";try{const t=navigator.userAgent||"",r=Gd(nb,t);if(!r)return e;e=r.describe(t)}catch{}return e},ib=[{test:[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],describe(){return"Samsung"}},{test:[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i,/\((ipad);[-\w\),; ]+apple/i,/(macintosh);/i],describe(){return"Apple"}},{test:[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],describe(){return"Huawei"}},{test:[/(?:honor)([-\w ]+)[;\)]/i],describe(){return"Honor"}},{test:[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],describe(){return"Xiaomi"}},{test:[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],describe(){return"Oppo"}},{test:[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],describe(){return"Vivo"}},{test:[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],describe(){return"Realme"}},{test:[/(pixel c)\b/i,/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],describe(){return"Google"}},{test:[/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],describe(){return"ZTE"}},{test:[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],describe(){return"Meizu"}}],ob=()=>{let e="Unknown";try{const t=navigator.userAgent||"",r=Gd(ib,t);if(!r)return e;e=r.describe(t)}catch{}return e},{BrowserUtil:Om,SystenUtil:Dm}=We.AliRTS,sb=Hv(),ab="woMMssV6jmyol9fr",cb=200,Js=10*60*1e3,qs={host:"cn-hangzhou.log.aliyuncs.com",project:"alivc-aio",logstore:"logger",time:10,count:10};function _u(){return Kd(new Date,"HH:MM:ss.l")}function Mm(){return Kd(new Date,"isoDate")}var Jd=(e=>(e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.API=2]="API",e[e.WARNING=3]="WARNING",e[e.ERROR=4]="ERROR",e[e.NONE=5]="NONE",e))(Jd||{});class ub{constructor(){B(this,"tracker"),B(this,"slsPlugin"),B(this,"stsData"),B(this,"stsExpiration",Date.now()),B(this,"clientId",hn()),B(this,"bSesid",hn()),B(this,"logLevel",3),B(this,"appId",""),B(this,"sessionId",""),B(this,"logCache",[]),B(this,"updateTaskTimer"),B(this,"endReported",!0),B(this,"logSequence",0),B(this,"sendLogBeforeUnload",t=>Q(this,null,function*(){if(!this.slsPlugin)return;this.logSequence+=1,t.unshift(this.getLogParams(710203,{log:`[${Mm()} ${_u()}] [INF] beforeunload`,stat_log_seq:this.logSequence}));const r=`https://${qs.project}.${qs.host}/logstores/${qs.logstore}`,n={__logs__:t.map(s=>this.slsPlugin.transString(s))},{data:i,header:o}=yield this.slsPlugin.process(r,JSON.stringify(n));fetch(r,{keepalive:!0,method:"POST",headers:o,body:i})})),B(this,"logMethod",(t,r=console.log)=>(...n)=>{let i=_u();this.logLevel<=t&&r(i,...n);let o=vr.paramArrayToString(n);t>0&&this.addLog(o)}),B(this,"d",this.logMethod(0,console.debug)),B(this,"i",this.logMethod(1)),B(this,"w",this.logMethod(3,console.warn)),B(this,"e",this.logMethod(4,(...t)=>{const[r,...n]=t;console.error(r,"<error>",n)})),B(this,"ev",this.logMethod(2)),B(this,"a",this.logMethod(2,(...t)=>{const[r,...n]=t;if(n.length>2){const i=`${n[1]}`;i.startsWith("__g__")&&console.group(`${i.substring(5)}_${n[2]}`)}console.log(r,...n)})),B(this,"ar",this.logMethod(2,(...t)=>{const[r,...n]=t;console.log(r,...n),n.length>2&&`${n[1]}`.startsWith("__g__")&&console.groupEnd()})),B(this,"ae",this.logMethod(2,(...t)=>{const[r,...n]=t;console.error(r,"<error>",...n),n.length>2&&`${n[1]}`.startsWith("__g__")&&console.groupEnd()})),window.addEventListener("beforeunload",()=>{this.reportEnd(!0)})}init(){this.reset(),this.startSTSUpdateTask()}destroy(){this.updateTaskTimer&&clearTimeout(this.updateTaskTimer)}reset(){this.bSesid=hn(),this.endReported=!0,this.logSequence=0,this.appId="",this.sessionId=""}startSTSUpdateTask(){return Q(this,null,function*(){this.updateTaskTimer&&clearTimeout(this.updateTaskTimer);try{const t=yield this.refreshSTSToken();this.createTracker(t)}catch{}this.updateTaskTimer=setTimeout(()=>{this.startSTSUpdateTask()},Js)})}refreshSTSToken(){return Q(this,null,function*(){if(!this.stsData||this.stsExpiration<=Date.now()-Js){const t=yield this.requestSTSToken(),r=new Date(t==null?void 0:t.Expiration).getTime()||0,n=Date.now()+Js;this.stsExpiration=Math.max(r,n),this.stsData=t}return this.stsData})}requestSTSToken(){const t=Date.now(),r=`${this.clientId}|${ab}|${t}`,n={Action:"AssumeSlsRoleV2",AuthInfo:fs.MD5(r).toString(fs.enc.Hex),ClientId:this.clientId,BusinessType:"logger",AppVersion:"1.0",Version:"2017-03-14",AuthTimestamp:`${t}`,TerminalType:"web",DeviceModel:"",Format:"JSON",SignatureMethod:"HMAC-SHA1",SignatureVersion:"1.0",Timestamp:Kd(t,"isoUtcDateTime")},i=`https://slsrole.alicdn.com/?${new URLSearchParams(n).toString()}`;return fetch(i).then(o=>o.json()).then(o=>JSON.parse(window.atob(o.SlsAuthResult)))}createTracker(t){if(!this.tracker){const r={accessKeyId:t.AccessKeyId,accessKeySecret:t.AccessKeySecret,securityToken:t.SecurityToken,refreshSTSTokenInterval:Js,stsTokenFreshTime:void 0,refreshSTSToken:()=>{this.refreshSTSToken().then(o=>{r.accessKeyId=o.AccessKeyId,r.accessKeySecret=o.AccessKeySecret,r.securityToken=o.SecurityToken}).catch(()=>{})}},n=new Hd(qs),i=$d(r);n.useStsPlugin(i),this.slsPlugin=i,this.tracker=n,this.reportStartAndCache()}}changeConfig(t){t.logLevel!==void 0&&t.logLevel>=0&&t.logLevel<=5&&(this.logLevel=t.logLevel)}setSessionID(t,r){!t||!r||(this.appId=t,this.sessionId=r,this.reportStartAndCache())}reportStartAndCache(){if(!this.tracker||!this.sessionId)return;this.endReported=!1;const t={task_btm_sec:0,task_duration:0,task_etm_sec:0,task_type:"session"},r=[this.getLogParams(710201,t),this.getLogParams(710202,t)];this.tracker.sendBatchLogsImmediate(r),this.logCache.forEach(n=>{this.sendLog(n)})}reportEnd(t=!1){if(!this.tracker||!this.sessionId||this.endReported){this.reset();return}const r={task_btm_sec:0,task_duration:0,task_etm_sec:0,task_type:"session"},n=[this.getLogParams(710204,r),this.getLogParams(710205,r)];t?this.sendLogBeforeUnload(n):(this.tracker.sendBatchLogsImmediate(n),this.endReported=!0),this.reset()}getLogParams(t,r){return Ne({appid:`${window.location.host}`,appid_list:this.appId,appver:"",b_sesid:this.bSesid,biz_type:"rtc",cpu_info:sb,db:Om.browserName,dm:Om.browserVersion,install_uuid:this.clientId,logger_v:"0.0.1",os:Dm.systemName,osv:Dm.systemVersion,p_sesid:this.bSesid,sdk_version:Ec,sdkname:"AliRTCSdk",stm:Date.now(),tar_pf:"web",traceid:this.sessionId,event_id:t},r||{})}sendLog(t){if(!this.tracker||!this.sessionId)return;this.logSequence+=1;const r=this.getLogParams(710203,{log:t,stat_log_seq:this.logSequence});this.tracker.send(r)}addLog(t){const r=_u(),n=`[${Mm()} ${r}] ${t}`;!this.sessionId||!this.tracker?(this.logCache.push(n),this.logCache.length>=cb&&this.logCache.shift()):this.sendLog(n)}}let he=class{static getLogger(){return this.logger||(this.logger=new ub),this.logger}static init(){this.getLogger().init()}static destroy(){this.getLogger().destroy()}static setLogLevel(t){this.getLogger().changeConfig({logLevel:t})}static setSessionID(t,r){this.getLogger().setSessionID(t,r)}static reportEnd(){this.getLogger().reportEnd()}static interface(...t){this.getLogger().a("[API]",...t)}static interfaceResult(t,r,n,...i){n?this.getLogger().ar("[ARE]",t,r,...i):this.getLogger().ae("[ARE]",t,r,...i)}static event(...t){this.getLogger().ev("[EVT]",...t)}static debug(...t){this.getLogger().d("[DBG]",...t)}static info(...t){this.getLogger().i("[INF]",...t)}static warn(...t){this.getLogger().w("[WARN]",...t)}static error(...t){this.getLogger().e("[ERR]",...t)}};B(he,"logger");const lb=e=>Q(void 0,null,function*(){const t=new We.AliRTS.SupportUtil;let r={support:!1,detail:{isWebRTCSupported:t.checkMediaDevices()&&t.checkWebRtcSupport(),isH264DecodeSupported:!1,isH264EncodeSupported:!1,isScreenShareSupported:!1,isSendMediaExtensionMsgSupported:!1,isBrowserSupported:t.checkBrowser({errorCode:0,message:""})}};if(r.support=r.detail.isWebRTCSupported&&r.detail.isBrowserSupported,t.checkWebRtcSupport()&&e!=="sendonly"){const n=yield t.checkH264Decode();r.detail.isH264DecodeSupported=n,r.support=r.support&&n}if(t.checkWebRtcSupport()&&e!=="recvonly"){const n=yield t.checkH264Encode();r.detail.isH264EncodeSupported=n,r.support=r.support&&n}return r.detail.isScreenShareSupported=t.checkWebRtcSupport()&&t.checkScreenCapture()&&!We.AliRTS.SystenUtil.isAndroid&&!We.AliRTS.SystenUtil.isIos,r.detail.isSendMediaExtensionMsgSupported=t.checkWebRtcSupport()&&t.checkEncodedTransformSupport(),r}),db=()=>new We.AliRTS.SupportUtil().checkScreenCapture();var Dt=(e=>(e[e.AliRtcSdkStreamTypeCapture=0]="AliRtcSdkStreamTypeCapture",e[e.AliRtcSdkStreamTypeScreen=1]="AliRtcSdkStreamTypeScreen",e))(Dt||{}),Wv=(e=>(e[e.PRE_PROCESSOR=0]="PRE_PROCESSOR",e[e.POST_PROCESSOR=1]="POST_PROCESSOR",e))(Wv||{}),Ts=(e=>(e[e.AUDIO=0]="AUDIO",e[e.VIDEO=1]="VIDEO",e[e.BOTH=2]="BOTH",e))(Ts||{});class _i extends Ut{constructor(t,r=Dt.AliRtcSdkStreamTypeCapture,n=1){super(),B(this,"name"),B(this,"options"),B(this,"type",0),B(this,"streamType"),B(this,"trackType"),B(this,"zIndex",1),B(this,"_isEnable",!0),B(this,"lastInputAudioTrack"),B(this,"lastOutputAudioTrack"),B(this,"lastInputVideoTrack"),B(this,"lastOutputVideoTrack"),B(this,"_hasCleared",!0),this.name=t,this.streamType=r,this.trackType=n,this.options=this.initOptions}get initOptions(){return{}}getOptions(){return this.options}init(){return Q(this,null,function*(){})}enable(){this._isEnable||(this._isEnable=!0,this.init(),this.emit("enabled"))}disable(){this._isEnable&&(this._isEnable=!1,this.clear(),this.emit("disabled"))}get isEnable(){return this._isEnable}audioUpdated(t){var r,n;return((r=this.lastInputAudioTrack)==null?void 0:r.id)!==((n=t.currentAudioTrack)==null?void 0:n.id)}videoUpdated(t){var r,n;return((r=this.lastInputVideoTrack)==null?void 0:r.id)!==((n=t.currentVideoTrack)==null?void 0:n.id)}execute(t,r){return Q(this,null,function*(){const n=this.shouldUpdate(t,r);this.lastInputAudioTrack=t.currentAudioTrack,this.lastInputVideoTrack=t.currentVideoTrack,this._hasCleared||n?(yield this.process(t,r),this._hasCleared=!1):(this.lastOutputAudioTrack&&(this.trackType===2||this.trackType===0)&&this.lastOutputAudioTrack&&t.updateAudioTrack(this.lastOutputAudioTrack),this.lastOutputVideoTrack&&(this.trackType===2||this.trackType===1)&&this.lastOutputVideoTrack&&t.updateVideoTrack(this.lastOutputVideoTrack)),this.lastOutputAudioTrack=t.currentAudioTrack,this.lastOutputVideoTrack=t.currentVideoTrack})}clear(t){this._hasCleared=!0,this.lastInputAudioTrack=void 0,this.lastInputVideoTrack=void 0,this.lastOutputAudioTrack=void 0,this.lastOutputVideoTrack=void 0}}var ms=(e=>(e[e.LiveTranscodingSingle=0]="LiveTranscodingSingle",e[e.LiveTranscodingMix=1]="LiveTranscodingMix",e))(ms||{}),qd=(e=>(e[e.LiveTranscodingOrigin=0]="LiveTranscodingOrigin",e[e.LiveTranscodingAudio=1]="LiveTranscodingAudio",e[e.LiveTranscodingVideo=2]="LiveTranscodingVideo",e))(qd||{}),co=(e=>(e[e.LiveTranscodingCamera=0]="LiveTranscodingCamera",e[e.LiveTranscodingShareScreen=1]="LiveTranscodingShareScreen",e))(co||{});const qo={0:"camera",1:"shareScreen"};var Yd=(e=>(e[e.LiveTranscoding_Profile_1IN_1080P=0]="LiveTranscoding_Profile_1IN_1080P",e[e.LiveTranscoding_Profile_1IN_720P=1]="LiveTranscoding_Profile_1IN_720P",e[e.LiveTranscoding_Profile_1IN_360P=2]="LiveTranscoding_Profile_1IN_360P",e[e.LiveTranscoding_Profile_2IN_1080P=3]="LiveTranscoding_Profile_2IN_1080P",e[e.LiveTranscoding_Profile_2IN_720P=4]="LiveTranscoding_Profile_2IN_720P",e[e.LiveTranscoding_Profile_2IN_360P=5]="LiveTranscoding_Profile_2IN_360P",e[e.LiveTranscoding_Profile_4IN_1080P=6]="LiveTranscoding_Profile_4IN_1080P",e[e.LiveTranscoding_Profile_4IN_720P=7]="LiveTranscoding_Profile_4IN_720P",e[e.LiveTranscoding_Profile_4IN_360P=8]="LiveTranscoding_Profile_4IN_360P",e[e.LiveTranscoding_Profile_9IN_1080P=9]="LiveTranscoding_Profile_9IN_1080P",e[e.LiveTranscoding_Profile_9IN_720P=10]="LiveTranscoding_Profile_9IN_720P",e[e.LiveTranscoding_Profile_9IN_360P=11]="LiveTranscoding_Profile_9IN_360P",e[e.LiveTranscoding_Profile_12IN_1080P=12]="LiveTranscoding_Profile_12IN_1080P",e[e.LiveTranscoding_Profile_12IN_720P=13]="LiveTranscoding_Profile_12IN_720P",e[e.LiveTranscoding_Profile_12IN_360P=14]="LiveTranscoding_Profile_12IN_360P",e[e.LiveTranscoding_Profile_16IN_1080P=15]="LiveTranscoding_Profile_16IN_1080P",e[e.LiveTranscoding_Profile_16IN_720P=16]="LiveTranscoding_Profile_16IN_720P",e[e.LiveTranscoding_Profile_16IN_360P=17]="LiveTranscoding_Profile_16IN_360P",e[e.LiveTranscoding_Profile_Mixed=9999]="LiveTranscoding_Profile_Mixed",e))(Yd||{});const hb={0:"1IN_1080P",1:"1IN_720P",2:"1IN_360P",3:"2IN_1080P",4:"2IN_720P",5:"2IN_360P",6:"4IN_1080P",7:"4IN_720P",8:"4IN_360P",9:"9IN_1080P",10:"9IN_720P",11:"9IN_360P",12:"12IN_1080P",13:"12IN_720P",14:"12IN_360P",15:"16IN_1080P",16:"16IN_720P",17:"16IN_360P",9999:"Mixed_Audio"};var bc=(e=>(e[e.LiveTranscoding_HZ_48000=48e3]="LiveTranscoding_HZ_48000",e[e.LiveTranscoding_HZ_44100=44100]="LiveTranscoding_HZ_44100",e[e.LiveTranscoding_HZ_32000=32e3]="LiveTranscoding_HZ_32000",e[e.LiveTranscoding_HZ_16000=16e3]="LiveTranscoding_HZ_16000",e[e.LiveTranscoding_HZ_8000=8e3]="LiveTranscoding_HZ_8000",e))(bc||{}),gs=(e=>(e[e.LiveTranscodingNoBody=0]="LiveTranscodingNoBody",e[e.LiveTranscodingBody=1]="LiveTranscodingBody",e))(gs||{}),Cs=(e=>(e[e.NOTO_SERIF_CJKSC_REGULAR=0]="NOTO_SERIF_CJKSC_REGULAR",e[e.ALIBABA_PUHUITI_REGULAR=1]="ALIBABA_PUHUITI_REGULAR",e[e.ALIBABA_PUHUITI_BOLD=2]="ALIBABA_PUHUITI_BOLD",e[e.ALIBABA_PUHUITI_Heavy=3]="ALIBABA_PUHUITI_Heavy",e[e.ALIBABA_PUHUITI_LIGHT=4]="ALIBABA_PUHUITI_LIGHT",e[e.ALIBABA_PUHUITI_MEDIUM=5]="ALIBABA_PUHUITI_MEDIUM",e))(Cs||{}),Qd=(e=>(e[e.LiveTranscodingOrigin=0]="LiveTranscodingOrigin",e[e.LiveTranscodingCrop=1]="LiveTranscodingCrop",e[e.LiveTranscodingFill=2]="LiveTranscodingFill",e))(Qd||{}),_c=(e=>(e[e.LiveTranscodingNormal=0]="LiveTranscodingNormal",e[e.LiveTranscodingVirtualBackground=1]="LiveTranscodingVirtualBackground",e))(_c||{}),Xd=(e=>(e[e.LiveTranscodingState_IDLE=0]="LiveTranscodingState_IDLE",e[e.LiveTranscodingState_CONNNECT=1]="LiveTranscodingState_CONNNECT",e[e.LiveTranscodingState_RUNNING=2]="LiveTranscodingState_RUNNING",e[e.LiveTranscodingState_RECOVERING=3]="LiveTranscodingState_RECOVERING",e[e.LiveTranscodingState_FAILURE=4]="LiveTranscodingState_FAILURE",e[e.LiveTranscodingState_END=5]="LiveTranscodingState_END",e))(Xd||{}),on=(e=>(e[e.LiveTranscodingErrorPublishOk=0]="LiveTranscodingErrorPublishOk",e[e.LiveTranscodingErrorStreamNotFound=17825793]="LiveTranscodingErrorStreamNotFound",e[e.LiveTranscodingErrorStreamAlreadyExist=17825794]="LiveTranscodingErrorStreamAlreadyExist",e[e.LiveTranscodingErrorInvalidParam=17825795]="LiveTranscodingErrorInvalidParam",e[e.LiveTranscodingErrorInternalError=17825796]="LiveTranscodingErrorInternalError",e[e.LiveTranscodingErrorRtmpServerError=17825797]="LiveTranscodingErrorRtmpServerError",e[e.LiveTranscodingErrorRtmpStreamUrlError=17825798]="LiveTranscodingErrorRtmpStreamUrlError",e[e.LiveTranscodingErrorPublishTimeout=17825799]="LiveTranscodingErrorPublishTimeout",e[e.LiveTranscodingErrorNotAuthorized=17825800]="LiveTranscodingErrorNotAuthorized",e))(on||{}),Zd=(e=>(e[e.TrascodingPublishTaskStatusStart=0]="TrascodingPublishTaskStatusStart",e[e.TrascodingPublishTaskStatusUpdate=1]="TrascodingPublishTaskStatusUpdate",e[e.TrascodingPublishTaskStatusStop=2]="TrascodingPublishTaskStatusStop",e))(Zd||{}),lr=(e=>(e[e.MPU_TASK_TRANSACTION_START=0]="MPU_TASK_TRANSACTION_START",e[e.MPU_TASK_TRANSACTION_UPDATE=1]="MPU_TASK_TRANSACTION_UPDATE",e[e.MPU_TASK_TRANSACTION_STOP=2]="MPU_TASK_TRANSACTION_STOP",e[e.MPU_TASK_TRANSACTION_LIST=3]="MPU_TASK_TRANSACTION_LIST",e[e.MPU_TASK_TRANSACTION_POLLING=4]="MPU_TASK_TRANSACTION_POLLING",e[e.MPU_TASK_TRANSACTION_ACKNOWLEDGE=5]="MPU_TASK_TRANSACTION_ACKNOWLEDGE",e[e.MPU_TASK_TRANSACTION_END=6]="MPU_TASK_TRANSACTION_END",e))(lr||{});const pb={0:"/libra/v1/sdk/start-task",1:"/libra/v1/sdk/update-task",2:"/libra/v1/sdk/stop-task",3:"/libra/v1/sdk/list-task",4:"/libra/v1/sdk/polling",5:"/libra/v1/sdk/acknowledge",6:"/"};class eh{constructor(t,r,n,i,o,s,a,c){B(this,"videoWidth"),B(this,"videoHeight"),B(this,"videoFramerate",20),B(this,"videoBitrate",2e3),B(this,"videoGop",30),B(this,"audioSamplerate",bc.LiveTranscoding_HZ_44100),B(this,"audioBitrate",500),B(this,"audioChannels",1),this.videoWidth=t,this.videoHeight=r,n&&(this.videoFramerate=n),i&&(this.videoBitrate=i),o&&(this.videoGop=o),s&&(this.audioSamplerate=s),a&&(this.audioBitrate=a),c&&(this.audioChannels=c)}}const th=e=>((e&16711680)>>16)+(e&65280)+((e&255)<<16),Ur=(e=0,t)=>{if(t==0)return 0;let r=e/t;return r<0&&(r=0),r>1&&(r=1),r};class Za{constructor(t,r,n){/*!  */B(this,"mixMode",ms.LiveTranscodingSingle);/*!  */B(this,"singleParam");/*!  */B(this,"mixParam"),t&&(this.mixMode=t),r&&(this.singleParam=r),n&&(this.mixParam=n)}toJson(t,r,n,i,o){const s={appid:r.appId,channelid:r.channelId};if(t===lr.MPU_TASK_TRANSACTION_POLLING||t===lr.MPU_TASK_TRANSACTION_LIST||t===lr.MPU_TASK_TRANSACTION_ACKNOWLEDGE)return t===lr.MPU_TASK_TRANSACTION_ACKNOWLEDGE&&(s.messageid=o),s;if(s.taskid=n,t!==lr.MPU_TASK_TRANSACTION_STOP){if(s.mixmode=this.mixMode,i&&(s.streamurl=i),this.mixMode===ms.LiveTranscodingSingle){const a=this.singleParam;if(a){s.streamtype=a.streamType,a.sourceType===co.LiveTranscodingShareScreen?s.sourcetype=qo[a.sourceType]:s.sourcetype=qo[co.LiveTranscodingCamera];const c=[];a.userId&&c.push(a.userId),s.subspecusers=c}}else if(t===lr.MPU_TASK_TRANSACTION_START||t===lr.MPU_TASK_TRANSACTION_UPDATE){const a=this.mixParam;if(a){a.taskProfile&&(s.taskprofile=hb[a.taskProfile]);const c=a.encodeParam||new eh(1280,720);let u=c.videoWidth,d=c.videoHeight;const E={};Object.keys(c).forEach(f=>{const y=c[f];y>0&&(E[f.toLowerCase()]=y)}),E.lowbitratehighquality=0,s.encodeparam=E,s.backgrounds=a.backgrounds.map(f=>f.toJson(u,d)),s.watermarks=a.watermarks.map(f=>f.toJson(u,d)),s.clockwidgets=a.clockWidgets.map(f=>f.toJson(u,d));const m=a.users.map(f=>f.userId);s.subspecusers=[...new Set(m)],s.layouts=[{audiomixcount:a.users.length,panes:a.users.map((f,y)=>f.toJson(y,u,d,a.mediaProcessMode))}],s.layoutids=["0"],s.cropmode=a.cropMode,s.backgroundcolor=th(a.backgroundColor),s.taskmode=a.mediaProcessMode}}}return s}}var bn=(e=>(e.pre="pre",e.prod="prod",e))(bn||{}),vn=(e=>(e.AliRtcSdkCommunication="communication",e.AliRtcSdkInteractiveLive="interactive_live",e.AliRtcSdkInteractiveWithLowLatencyLive="cdn_live",e))(vn||{}),gn=(e=>(e.AliRtcSdkInteractive="interactive",e.AliRtcSdkLive="live",e))(gn||{}),cn=(e=>(e[e.AliEngineLocalDeviceTypeUnknown=0]="AliEngineLocalDeviceTypeUnknown",e[e.AliEngineLocalDeviceTypeMic=1]="AliEngineLocalDeviceTypeMic",e[e.AliEngineLocalDeviceTypeSpeaker=2]="AliEngineLocalDeviceTypeSpeaker",e[e.AliEngineLocalDeviceTypeAudioDevice=3]="AliEngineLocalDeviceTypeAudioDevice",e[e.AliEngineLocalDeviceTypeCamera=4]="AliEngineLocalDeviceTypeCamera",e[e.AliEngineLocalDeviceTypeDisplay=5]="AliEngineLocalDeviceTypeDisplay",e[e.AliEngineLocalDeviceTypeVideoDevice=6]="AliEngineLocalDeviceTypeVideoDevice",e))(cn||{}),Ct=(e=>(e[e.AliEngineLocalDeviceExceptionTypeUnknown=0]="AliEngineLocalDeviceExceptionTypeUnknown",e[e.AliEngineLocalDeviceExceptionTypeMicOpenFail=1]="AliEngineLocalDeviceExceptionTypeMicOpenFail",e[e.AliEngineLocalDeviceExceptionTypeMicInterrupt=2]="AliEngineLocalDeviceExceptionTypeMicInterrupt",e[e.AliEngineLocalDeviceExceptionTypeMicAuthFail=3]="AliEngineLocalDeviceExceptionTypeMicAuthFail",e[e.AliEngineLocalDeviceExceptionTypeMicNotAvailable=4]="AliEngineLocalDeviceExceptionTypeMicNotAvailable",e[e.AliEngineLocalDeviceExceptionTypeSpeakerOpenFail=5]="AliEngineLocalDeviceExceptionTypeSpeakerOpenFail",e[e.AliEngineLocalDeviceExceptionTypeSpeakerInterrupt=6]="AliEngineLocalDeviceExceptionTypeSpeakerInterrupt",e[e.AliEngineLocalDeviceExceptionTypeSpeakerNotAvailable=7]="AliEngineLocalDeviceExceptionTypeSpeakerNotAvailable",e[e.AliEngineLocalDeviceExceptionTypeAudioDeviceException=8]="AliEngineLocalDeviceExceptionTypeAudioDeviceException",e[e.AliEngineLocalDeviceExceptionTypeCameraOpenFail=9]="AliEngineLocalDeviceExceptionTypeCameraOpenFail",e[e.AliEngineLocalDeviceExceptionTypeCameraInterrupt=10]="AliEngineLocalDeviceExceptionTypeCameraInterrupt",e[e.AliEngineLocalDeviceExceptionTypeCameraAuthFail=11]="AliEngineLocalDeviceExceptionTypeCameraAuthFail",e[e.AliEngineLocalDeviceExceptionTypeDisplayException=12]="AliEngineLocalDeviceExceptionTypeDisplayException",e[e.AliEngineLocalDeviceExceptionTypeVideoDeviceException=13]="AliEngineLocalDeviceExceptionTypeVideoDeviceException",e))(Ct||{}),Ze=(e=>(e[e.AliRtcConnectionStatusInit=0]="AliRtcConnectionStatusInit",e[e.AliRtcConnectionStatusDisconnected=1]="AliRtcConnectionStatusDisconnected",e[e.AliRtcConnectionStatusConnecting=2]="AliRtcConnectionStatusConnecting",e[e.AliRtcConnectionStatusConnected=3]="AliRtcConnectionStatusConnected",e[e.AliRtcConnectionStatusReconnecting=4]="AliRtcConnectionStatusReconnecting",e[e.AliRtcConnectionStatusFailed=5]="AliRtcConnectionStatusFailed",e))(Ze||{}),ci=(e=>(e[e.AliRtcConnectionChangedDummyReason=0]="AliRtcConnectionChangedDummyReason",e[e.AliRtcConnectionMediaPathChanged=1]="AliRtcConnectionMediaPathChanged",e[e.AliRtcConnectionSignalingHeartbeatTimeout=2]="AliRtcConnectionSignalingHeartbeatTimeout",e[e.AliRtcConnectionSignalingHeartbeatAlive=3]="AliRtcConnectionSignalingHeartbeatAlive",e[e.AliRtcConnectionSignalingHttpDnsResolved=4]="AliRtcConnectionSignalingHttpDnsResolved",e[e.AliRtcConnectionSignalingHttpDnsFailure=5]="AliRtcConnectionSignalingHttpDnsFailure",e[e.AliRtcConnectionSignalingGslbFailure=6]="AliRtcConnectionSignalingGslbFailure",e[e.AliRtcConnectionSignalingGslbSuccess=7]="AliRtcConnectionSignalingGslbSuccess",e[e.AliRtcConnectionSignalingJoinRoomFailure=8]="AliRtcConnectionSignalingJoinRoomFailure",e[e.AliRtcConnectionSignalingJoinRoomSuccess=9]="AliRtcConnectionSignalingJoinRoomSuccess",e[e.AliRtcConnectionSignalingLeaveRoom=10]="AliRtcConnectionSignalingLeaveRoom",e[e.AliRtcConnectionSignalingConnecting=11]="AliRtcConnectionSignalingConnecting",e[e.AliRtcConnectionChangedNetworkInterrupted=12]="AliRtcConnectionChangedNetworkInterrupted",e))(ci||{}),rh=(e=>(e[e.AliRtcUserOfflineQuit=0]="AliRtcUserOfflineQuit",e[e.AliRtcUserOfflineDropped=1]="AliRtcUserOfflineDropped",e[e.AliRtcUserOfflineBecomeAudience=2]="AliRtcUserOfflineBecomeAudience",e))(rh||{}),uo=(e=>(e[e.AliRtcAudioTrackNo=0]="AliRtcAudioTrackNo",e[e.AliRtcAudioTrackMic=1]="AliRtcAudioTrackMic",e[e.AliRtcAudioTrackDual=2]="AliRtcAudioTrackDual",e))(uo||{}),xe=(e=>(e[e.AliRtcVideoTrackNo=0]="AliRtcVideoTrackNo",e[e.AliRtcVideoTrackCamera=1]="AliRtcVideoTrackCamera",e[e.AliRtcVideoTrackScreen=2]="AliRtcVideoTrackScreen",e[e.AliRtcVideoTrackBoth=3]="AliRtcVideoTrackBoth",e))(xe||{}),Oe=(e=>(e[e.AliRtcStatePublishIdle=0]="AliRtcStatePublishIdle",e[e.AliRtcStateNoPublish=1]="AliRtcStateNoPublish",e[e.AliRtcStatePublishing=2]="AliRtcStatePublishing",e[e.AliRtcStatePublished=3]="AliRtcStatePublished",e))(Oe||{}),qe=(e=>(e[e.AliRtcStateSubscribeIdle=0]="AliRtcStateSubscribeIdle",e[e.AliRtcStateNoSubscribe=1]="AliRtcStateNoSubscribe",e[e.AliRtcStateSubscribing=2]="AliRtcStateSubscribing",e[e.AliRtcStateSubscribed=3]="AliRtcStateSubscribed",e))(qe||{}),Lt=(e=>(e[e.AliRtcVideoStreamTypeNone=0]="AliRtcVideoStreamTypeNone",e[e.AliRtcVideoStreamTypeHigh=1]="AliRtcVideoStreamTypeHigh",e[e.AliRtcVideoStreamTypeLow=2]="AliRtcVideoStreamTypeLow",e))(Lt||{}),vs=(e=>(e[e.CAMERA_INVALID=-1]="CAMERA_INVALID",e[e.CAMERA_REAR=0]="CAMERA_REAR",e[e.CAMERA_FRONT=1]="CAMERA_FRONT",e))(vs||{});const Nm=10,Lm=5e3,zv=class pa extends Ut{constructor(t){super(),B(this,"ws"),B(this,"socketStatus",0),B(this,"wsUrl",""),B(this,"lastConnectStartTime",0),B(this,"maxConnectRetryCount",Nm),B(this,"connectRetryCount",0),B(this,"gotErr",!1),B(this,"closedByInvoke",!0),B(this,"isReconnecting",!1),B(this,"networkAvailableChecked",!0),B(this,"reconnectTimeoutId",0),this.maxConnectRetryCount=t??Nm,this.onOpen=this.onOpen.bind(this),this.onMessage=this.onMessage.bind(this),this.onError=this.onError.bind(this),this.onClose=this.onClose.bind(this)}get connectUrl(){return this.wsUrl}get connectStatus(){return this.socketStatus}start(t){this.wsUrl=t,this.initWebSocket()}send(t){return this.ws&&this.socketStatus===2?(this.ws.send(JSON.stringify(t)),!0):!1}close(){this.closedByInvoke=!0,this.uninitWebscoket()}reconnect(){this.reconnectTimeoutId&&(clearTimeout(this.reconnectTimeoutId),this.reconnectTimeoutId=0),this.emit("onReconnectStart"),this.isReconnecting=!0,this.initWebSocket()}onOpen(t){he.info(`[${pa.logName}]`,"onOpen"),this.socketStatus=2,this.connectRetryCount=0,this.networkAvailableChecked=!1,this.closedByInvoke=!1,this.gotErr=!1,this.isReconnecting=!1,this.emit("onOpen",t)}onMessage(t){this.emit("onMessage",t)}onError(t){this.isReconnecting&&this.emit("onReconnectFail",t),this.emit("onError",t),this.isReconnecting=!1,this.socketStatus!==2&&vr.isNetworkAvailable().then(r=>{r&&console.error(pa.logName,"onError, Network is available, token may be invalid")})}onClose(t){return Q(this,null,function*(){if(this.closedByInvoke){this.socketStatus=0;return}if(he.info(`[${pa.logName}]`,`onClose, code: ${t.code}, reason: ${t.reason}, status: ${status}, retryCount: ${this.connectRetryCount}`),(yield vr.isNetworkAvailable())&&!this.networkAvailableChecked){this.reconnect(),this.networkAvailableChecked=!0;return}else this.connectRetryCount||this.emit("onNetworkError"),this.reconnectTimeoutId||(this.connectRetryCount+=1,this.connectRetryCount>this.maxConnectRetryCount?this.emit("onConnectFail"):Date.now()-this.lastConnectStartTime>=Lm?this.reconnect():this.reconnectTimeoutId=window.setTimeout(()=>{this.reconnect()},Lm));this.socketStatus=0,this.emit("onClose",t)})}initWebSocket(){this.uninitWebscoket(),this.socketStatus=1,this.lastConnectStartTime=Date.now(),this.ws=new WebSocket(this.wsUrl),this.ws.addEventListener("open",this.onOpen),this.ws.addEventListener("message",this.onMessage),this.ws.addEventListener("error",this.onError),this.ws.addEventListener("close",this.onClose)}uninitWebscoket(){this.ws&&(this.ws.removeEventListener("open",this.onOpen),this.ws.removeEventListener("message",this.onMessage),this.ws.removeEventListener("error",this.onError),this.ws.removeEventListener("close",this.onClose),this.ws.readyState!==WebSocket.CLOSED&&this.ws.close(),this.ws=void 0,this.socketStatus=0)}};B(zv,"logName","Socket");let fb=zv;var Tt=(e=>(e.KEEPALIVE="keepalive",e.JOINCHANNEL="joinchannel",e.NOTIFYJOIN="notifyjoin",e.NOTIFYSTATUS="notifystatus",e.STATUSREPORT="statusreport",e.LEAVECHANNEL="leavechannel",e.NOTIFYLEAVE="notifyleave",e.NOTIFYPUBLISH="notifypublish",e.BYE="bye",e.RECONNECT="reconnect",e.PUBLISH="publish",e.REFRESHURL="refreshurl",e.UNSUBSCRIBE="unsubscribe",e.ROLEUPDATE="roleupdate",e))(Tt||{});class mb{constructor(t,r){B(this,"authInfo"),B(this,"userName"),B(this,"seqIndex",0),this.authInfo=t,this.userName=r}get roleAuth(){if(this.authInfo.role){const{timestamp:t,nonce:r,token:n,role:i}=this.authInfo;return{timestamp:t,nonce:r,token:n,tokenrole:i}}}refreshAuthInfo(t){this.authInfo=t}getSeqIndex(){return this.seqIndex}createKeepAlivePackage(){return this.createBaseSendPackage("keepalive")}createJoinPackage(){let t=this.createBaseSendPackage("joinchannel");return t.header.displayName=this.userName,t.header.clientversion=vr.getVersionNumber().toString(),t.header.platform=lf,this.roleAuth&&(t.data.auth=this.roleAuth),t}crateLeavePackage(){return this.createBaseSendPackage("leavechannel")}createStatusPackage(t){let r=this.createBaseSendPackage("statusreport");return r.header.displayName=this.userName,r.data.status=t,r}createPublishPackage(){let t=this.createBaseSendPackage("publish");return t.data.users=[{}],this.roleAuth&&(t.data.auth=this.roleAuth),t}createRoleUpdatePackage(){let t=this.createBaseSendPackage("roleupdate");return t.header.displayName=this.userName,t}createReconnectPackage(t){let r=this.createBaseSendPackage("reconnect");return r.header.displayName=this.userName,r.header.clientversion=vr.getVersionNumber().toString(),r.header.platform=lf,r.data=Ne(Ne({},r.data),t??{}),this.roleAuth&&(r.data.auth=this.roleAuth),r}createRefreshUrlPackage(){let t=this.createBaseSendPackage("refreshurl");return t.header.displayName=this.userName,t}createResponsePackage(t,r){return{version:1,code:200,tid:t,msgtype:r}}createBaseSendPackage(t){var r;return++this.seqIndex,{version:1,msgtype:t,tid:hn(),header:{appid:this.authInfo.appId,channelid:this.authInfo.channelId,sessionid:(r=this.authInfo.sessionId)!=null?r:"",userid:this.authInfo.userId},data:{seq:this.seqIndex}}}}var pe=(e=>(e[e.ERR_JOIN_ALREADY_JOINED=16843521]="ERR_JOIN_ALREADY_JOINED",e[e.ERR_JOIN_BAD_APPID=33620481]="ERR_JOIN_BAD_APPID",e[e.ERR_JOIN_INVALID_APPID=33620482]="ERR_JOIN_INVALID_APPID",e[e.ERR_JOIN_BAD_CHANNEL=33620484]="ERR_JOIN_BAD_CHANNEL",e[e.ERR_JOIN_INVALID_CHANNEL=33620483]="ERR_JOIN_INVALID_CHANNEL",e[e.ERR_JOIN_BAD_TOKEN=33620485]="ERR_JOIN_BAD_TOKEN",e[e.ERR_JOIN_TIMEOUT=16908804]="ERR_JOIN_TIMEOUT",e[e.ERR_JOIN_ERR_JOIN_BAD_PARAMBAD=16974081]="ERR_JOIN_ERR_JOIN_BAD_PARAMBAD",e[e.ERR_JOIN_CHANNEL_FAILED=16974338]="ERR_JOIN_CHANNEL_FAILED",e[e.ERR_LOG_ALREADY_INIT=16974085]="ERR_LOG_ALREADY_INIT",e[e.ERR_LOG_ROOT_PATH_ERROR=16974086]="ERR_LOG_ROOT_PATH_ERROR",e[e.ERR_MIC_OPEN_FAIL=17040388]="ERR_MIC_OPEN_FAIL",e[e.ERR_SPEAKER_OPEN_FAIL=17040389]="ERR_SPEAKER_OPEN_FAIL",e[e.ERR_MIC_INTERRUPT=17040390]="ERR_MIC_INTERRUPT",e[e.ERR_SPEAKER_INTERRUPT=17040391]="ERR_SPEAKER_INTERRUPT",e[e.ERR_MIC_AUTH_FAIL=17040392]="ERR_MIC_AUTH_FAIL",e[e.ERR_MIC_NOT_AVAILABLE=17040393]="ERR_MIC_NOT_AVAILABLE",e[e.ERR_SPEAKER_NOT_AVAILABLE=17040400]="ERR_SPEAKER_NOT_AVAILABLE",e[e.ERR_CAMERA_OPEN_FAIL=17039620]="ERR_CAMERA_OPEN_FAIL",e[e.ERR_CAMERA_AUTH_FAIL=17039621]="ERR_CAMERA_AUTH_FAIL",e[e.ERR_CAMERA_INTERRUPT=17039622]="ERR_CAMERA_INTERRUPT",e[e.ERR_CAMERA_NOT_AVAILABLE=17039623]="ERR_CAMERA_NOT_AVAILABLE",e[e.ERR_VIDEO_DISPLAY_OPEN_FAIL=17039873]="ERR_VIDEO_DISPLAY_OPEN_FAIL",e[e.ERR_VIDEO_DISPLAY_INTERRUPT=1064992]="ERR_VIDEO_DISPLAY_INTERRUPT",e[e.ERR_ICE_CONNECTION_CONNECT_FAIL=17105409]="ERR_ICE_CONNECTION_CONNECT_FAIL",e[e.ERR_ICE_CONNECTION_RECONNECT_FAI=17105410]="ERR_ICE_CONNECTION_RECONNECT_FAI",e[e.ERR_ICE_CONNECTION_MOBILITY_FAIL=17105411]="ERR_ICE_CONNECTION_MOBILITY_FAIL",e[e.ERR_ICE_CONNECTION_HEARTBEAT_TIMEOUT=16908812]="ERR_ICE_CONNECTION_HEARTBEAT_TIMEOUT",e[e.ERR_LATENCY_LIVE_COMMUNICATION_FAILED=17235971]="ERR_LATENCY_LIVE_COMMUNICATION_FAILED",e[e.ERR_LATENCY_LIVE_MEIDASETTING_FAILED=17235972]="ERR_LATENCY_LIVE_MEIDASETTING_FAILED",e[e.ERR_LATENCY_LIVE_NONE_BROADCASTER=17235973]="ERR_LATENCY_LIVE_NONE_BROADCASTER",e[e.ERR_LATENCY_LIVE_NEED_RESTART=17235974]="ERR_LATENCY_LIVE_NEED_RESTART",e[e.ERR_LATENCY_LIVE_NEED_RESTART_AGAIN_LATER=17235975]="ERR_LATENCY_LIVE_NEED_RESTART_AGAIN_LATER",e[e.ERR_LATENCY_LIVE_SERVICE_UNAVAILABLE=17235976]="ERR_LATENCY_LIVE_SERVICE_UNAVAILABLE",e[e.ERR_LATENCY_LIVE_MEDIACONNECTION_INTERRUPTION=17235977]="ERR_LATENCY_LIVE_MEDIACONNECTION_INTERRUPTION",e[e.ERR_SDK_PUBLISH_INVAILD=16974597]="ERR_SDK_PUBLISH_INVAILD",e[e.ERR_SDK_PUBLISH_NOT_JOIN_CHANNEL=16843782]="ERR_SDK_PUBLISH_NOT_JOIN_CHANNEL",e[e.ERR_SDK_PUBLISH_AUDIO_STREAM_FAILED=16843856]="ERR_SDK_PUBLISH_AUDIO_STREAM_FAILED",e[e.ERR_SDK_PUBLISH_VIDEO_STREAM_FAILED=16843857]="ERR_SDK_PUBLISH_VIDEO_STREAM_FAILED",e[e.ERR_SDK_PUBLISH_DUAL_STREAM_FAILED=16843858]="ERR_SDK_PUBLISH_DUAL_STREAM_FAILED",e[e.ERR_SDK_PUBLISH_SCEEN_SHARE_FAILED=16843859]="ERR_SDK_PUBLISH_SCEEN_SHARE_FAILED",e[e.ERR_SDK_PUBLISH_SCREEN_SHARE_CONFIG_ERROR=16843860]="ERR_SDK_PUBLISH_SCREEN_SHARE_CONFIG_ERROR",e[e.ERR_SDK_SUBSCRIBE_INVAILD=16974852]="ERR_SDK_SUBSCRIBE_INVAILD",e[e.ERR_SDK_SUBSCRIBE_NOT_JOIN_CHANNEL=16844112]="ERR_SDK_SUBSCRIBE_NOT_JOIN_CHANNEL",e[e.ERR_SDK_SUBSCRIBE_AUDIO_STREAM_FAILED=16844113]="ERR_SDK_SUBSCRIBE_AUDIO_STREAM_FAILED",e[e.ERR_SDK_SUBSCRIBE_VIDEO_STREAM_FAILED=16844114]="ERR_SDK_SUBSCRIBE_VIDEO_STREAM_FAILED",e[e.ERR_SDK_SUBSCRIBE_DUAL_STREAM_FAILED=16844115]="ERR_SDK_SUBSCRIBE_DUAL_STREAM_FAILED",e[e.ERR_SDK_SUBSCRIBE_SCREEN_SHARE_FAILED=16844116]="ERR_SDK_SUBSCRIBE_SCREEN_SHARE_FAILED",e[e.ERR_SDK_SUBSCRIBE_DATA_FAILED=16844117]="ERR_SDK_SUBSCRIBE_DATA_FAILED",e[e.ERR_SDK_SUBSCRIBE_DATA_ERROR=16844118]="ERR_SDK_SUBSCRIBE_DATA_ERROR",e[e.ERR_SDK_INVALID_STATE=16974340]="ERR_SDK_INVALID_STATE",e[e.ERR_INVALID_ARGUMENTS=16974083]="ERR_INVALID_ARGUMENTS",e[e.ERR_SESSION_REMOVED=33620229]="ERR_SESSION_REMOVED",e[e.ERR_SDK_UPDATE_ROLE_CHANNEL=16908801]="ERR_SDK_UPDATE_ROLE_CHANNEL",e[e.ERR_INNER=-1]="ERR_INNER",e[e.ERR_SDK_MPU_TASK_PUBLISH_OK=0]="ERR_SDK_MPU_TASK_PUBLISH_OK",e[e.ERR_SDK_MPU_TASK_STREAM_NOT_FOUND=17825793]="ERR_SDK_MPU_TASK_STREAM_NOT_FOUND",e[e.ERR_SDK_MPU_TASK_STREAM_ALREADY_EXIST=17825794]="ERR_SDK_MPU_TASK_STREAM_ALREADY_EXIST",e[e.ERR_SDK_MPU_TASK_INVALID_PARAM=17825795]="ERR_SDK_MPU_TASK_INVALID_PARAM",e[e.ERR_SDK_MPU_TASK_INTERNAL_ERROR=17825796]="ERR_SDK_MPU_TASK_INTERNAL_ERROR",e[e.ERR_SDK_MPU_TASK_RTMP_SERVER_ERROR=17825797]="ERR_SDK_MPU_TASK_RTMP_SERVER_ERROR",e[e.ERR_SDK_MPU_TASK_RTMP_STREAM_URL_ERROR=17825798]="ERR_SDK_MPU_TASK_RTMP_STREAM_URL_ERROR",e[e.ERR_SDK_MPU_TASK_PUBLISH_TIMEOUT=17825799]="ERR_SDK_MPU_TASK_PUBLISH_TIMEOUT",e[e.ERR_SDK_MPU_TASK_NOT_AUTHORIZED=17825800]="ERR_SDK_MPU_TASK_NOT_AUTHORIZED",e[e.ERR_SDK_CHANNEL_RELAY_STATE_ERROR=18874369]="ERR_SDK_CHANNEL_RELAY_STATE_ERROR",e[e.ERR_SDK_CHANNEL_RELAY_SRC_NOT_ALLOW=18874370]="ERR_SDK_CHANNEL_RELAY_SRC_NOT_ALLOW",e[e.ERR_SDK_CHANNEL_RELAY_JOIN_DEST_FAILED=18874371]="ERR_SDK_CHANNEL_RELAY_JOIN_DEST_FAILED",e[e.ERR_SDK_CHANNEL_RELAY_TOKEN_INVALID=18874372]="ERR_SDK_CHANNEL_RELAY_TOKEN_INVALID",e[e.ERR_SDK_CHANNEL_RELAY_ROLE_ERROR=18874373]="ERR_SDK_CHANNEL_RELAY_ROLE_ERROR",e[e.ERR_SDK_CHANNEL_RELAY_INVALID_PARAM=18874374]="ERR_SDK_CHANNEL_RELAY_INVALID_PARAM",e[e.ERR_SDK_CHANNEL_RELAY_TO_SELF_ERROR=18874375]="ERR_SDK_CHANNEL_RELAY_TO_SELF_ERROR",e))(pe||{});class ue extends Error{constructor(t,r,n){super(r),B(this,"_code"),B(this,"_extra"),this._code=t,this._extra=n}static fromRtsError(t){return t instanceof ue?t:new ue((t==null?void 0:t.errorCode)||-1,(t==null?void 0:t.message)||(t==null?void 0:t.errorCodeName)||"rts error",t)}static fromError(t,r=-1,n=""){return new ue(r,(t==null?void 0:t.message)||(t==null?void 0:t.reason)||n||"error",t)}get code(){return this._code}set code(t){this._code=t}get reason(){return this.message}get extra(){return this._extra}}const gb=3e4,$v=class Wr extends Ut{constructor(t,r,n,i,o,s){super(),B(this,"authInfo"),B(this,"userName"),B(this,"channelProfile"),B(this,"clientRole"),B(this,"slsReporter"),B(this,"wsClient"),B(this,"packageCreater"),B(this,"keepAliveTimer",0),B(this,"packageCache",new Map),B(this,"isFirstConnect",!0),B(this,"aliveChecker",0),B(this,"reconnectData"),this.authInfo=t,this.userName=r,this.packageCreater=new mb(t,r),this.channelProfile=n,this.clientRole=i,this.slsReporter=o,this.wsClient=new fb(s),this.wsClient.on("onOpen",this.onOpen.bind(this)),this.wsClient.on("onMessage",this.onMessage.bind(this)),this.wsClient.on("onError",this.onError.bind(this)),this.wsClient.on("onClose",this.onClose.bind(this)),this.wsClient.on("onConnectFail",this.onConnectFail.bind(this)),this.wsClient.on("onAuthInvalid",this.onAuthInvalid.bind(this)),this.wsClient.on("onNetworkError",this.onNetworkError.bind(this)),this.wsClient.on("onReconnectStart",this.onReconnectStart.bind(this)),this.wsClient.on("onReconnectFail",this.onReconnectFail.bind(this))}get retryCount(){return this.wsClient.connectRetryCount}start(t){this.wsClient.start(t)}startKeepAlive(){this.keepAliveTimer===0&&(this.keepAliveTimer=window.setInterval(()=>{let t=this.packageCreater.createKeepAlivePackage();this.sendPackage(t)},5e3)),this.checkAlive()}stopKeepAlive(){this.keepAliveTimer!==0&&(clearInterval(this.keepAliveTimer),this.keepAliveTimer=0),this.aliveChecker&&(window.clearTimeout(this.aliveChecker),this.aliveChecker=0)}sendPkgCache(){this.packageCache.forEach(t=>{this.wsClient.send(t)})}leave(){let t=this.packageCreater.crateLeavePackage();this.sendPackage(t)}reportStatus(t){let r=this.packageCreater.createStatusPackage(t);this.sendPackage(r)}publish(t){const r=t,{l1ip:n}=r,i=Jo(r,["l1ip"]);let o=this.packageCreater.createPublishPackage();o.data.users=[],o.data.l1ip=n,i.subscribe.signal=this.wsClient.connectUrl;const{tracks:s,resume:a}=i;s.forEach(c=>{const{codec:u,ssrc:d}=c;c.userdata=JSON.stringify({codec:u}),c.ssrc=`${d}`,a&&(c.attr={reason:"reconnect"})}),o.data.users.push(i),this.sendPackage(o)}roleUpdate(t){let r=this.packageCreater.createRoleUpdatePackage();r.data.clientrole=t,this.sendPackage(r)}refreshUrl(t){const r=this.packageCreater.createRefreshUrlPackage();r.data=Ne(bi(Ne({},r.data),{sessionid:r.header.sessionid}),t),this.sendPackage(r)}refreshAuthInfo(t){this.authInfo=t,this.packageCreater.refreshAuthInfo(t)}close(){he.info(`[${Wr.logName}] close`),this.stopKeepAlive(),this.wsClient.off("onOpen",this.onOpen.bind(this)),this.wsClient.off("onMessage",this.onMessage.bind(this)),this.wsClient.off("onError",this.onError.bind(this)),this.wsClient.off("onClose",this.onClose.bind(this)),this.wsClient.off("onConnectFail",this.onConnectFail.bind(this)),this.wsClient.off("onAuthInvalid",this.onAuthInvalid.bind(this)),this.wsClient.off("onReconnectStart"),this.wsClient.off("onReconnectFail"),this.wsClient.close()}sendPackage(t){[Tt.KEEPALIVE,Tt.RECONNECT,Tt.JOINCHANNEL].includes(t.msgtype)||this.packageCache.set(t.tid,t),this.wsClient.send(t),t.msgtype!==Tt.KEEPALIVE&&this.slsReporter.reportRoomServerEvent(!0,t.msgtype,t.tid,t)}updateReconnectData(t){this.reconnectData=t}onOpen(){if(he.info(`[${Wr.logName}] onOpen`),this.isFirstConnect){let t=this.packageCreater.createJoinPackage();t.data.configure={channelprofile:this.channelProfile},(this.channelProfile===vn.AliRtcSdkInteractiveLive||this.channelProfile===vn.AliRtcSdkInteractiveWithLowLatencyLive)&&(t.data.configure.clientrole=this.clientRole),this.sendPackage(t)}else{this.stopKeepAlive();const t=this.packageCreater.createReconnectPackage(this.reconnectData);this.sendPackage(t)}}onMessage(t){try{let r=JSON.parse(t.data);this.packageCache.delete(r.tid),this.onRecvMessage(r),r!=null&&r.msgtype&&(r==null?void 0:r.msgtype)!==Tt.KEEPALIVE&&this.slsReporter.reportRoomServerEvent(!1,r.msgtype,r.tid,r)}catch(r){he.warn(`[${Wr.logName}] onMessage err`,r,t)}}onError(t){he.warn(`[${Wr.logName}] onError`,t),this.isFirstConnect&&this.onConnectFail()}onConnectFail(){he.warn(`[${Wr.logName}] onConnectFail`);const t=new ue(pe.ERR_INNER,"Signaling connect failed.");this.isFirstConnect?this.emit("onJoinChannelResult",t):this.emit("onConnectFail",t)}onAuthInvalid(){he.warn(`[${Wr.logName}] onAuthInvalid`),this.isFirstConnect&&this.emit("onAuthInvalid")}onNetworkError(){he.warn(`[${Wr.logName}] onNetworkError`);const t=new ue(pe.ERR_INNER,"Network error, signaling connect failed.");this.emit("onNetworkError",t)}onClose(t){he.info(`[${Wr.logName}] onClose`,t),this.stopKeepAlive()}onKeepAliveRsp(){this.emit("onKeepAliveRsp"),this.checkAlive()}onReconnectStart(){this.emit("onReconnectStart")}onReconnectFail(){this.emit("onReconnectFail",new ue(pe.ERR_INNER,"signaling reconnect failed."))}checkAlive(){window.clearTimeout(this.aliveChecker),this.aliveChecker=window.setTimeout(()=>{he.info(`[${Wr.logName}] not alive, reconnect`),this.stopKeepAlive(),this.emit("onReconnectStart"),this.wsClient.reconnect()},gb)}onRecvMessage(t){switch(t.msgtype!==Tt.KEEPALIVE&&he.info(`[${Wr.logName}] recv msg: ${t.msgtype}`),t.msgtype){case Tt.JOINCHANNEL:this.onJoinResult(t);break;case Tt.KEEPALIVE:this.onKeepAliveRsp();break;case Tt.PUBLISH:this.onPublishResult(t);break;case Tt.NOTIFYJOIN:this.onNotifyJoin(t);break;case Tt.NOTIFYSTATUS:this.onNotifyStatus(t);break;case Tt.LEAVECHANNEL:this.onLeaveResult(t);break;case Tt.NOTIFYLEAVE:this.onNotifyLeave(t);break;case Tt.NOTIFYPUBLISH:this.onNotifyPublish(t);break;case Tt.STATUSREPORT:this.onStatusReport(t);break;case Tt.BYE:this.onBye(t);break;case Tt.ROLEUPDATE:this.onRoleUpdateResult(t);break;case Tt.REFRESHURL:this.onRefreshUrlResult(t);break;case Tt.RECONNECT:this.onReconnectResult(t);break}}onJoinResult(t){this.isFirstConnect=!1,this.emit("onJoinChannelResult",t)}onLeaveResult(t){this.emit("onLeaveResult",t.code,t.tid)}onPublishResult(t){this.emit("onPublishResult",t.code,t.tid,t.description)}onRoleUpdateResult(t){this.emit("onRoleUpdateResult",t.code,t.tid,t.description)}onRefreshUrlResult(t){this.emit("onRefreshUrlResult",t)}onReconnectResult(t){if(t.code===200)this.sendPkgCache(),this.startKeepAlive(),this.emit("onReconnectSuccess",t.data.users);else{const r=new ue(pe.ERR_INNER,`reconnect failed, code: ${t.code};description: ${t.description}`);t.code===403&&(r.code=403),this.emit("onReconnectFail",r),this.close()}}onNotifyJoin(t){let r=this.packageCreater.createResponsePackage(t.tid,t.msgtype);this.wsClient.send(r),t&&t.data&&t.data.users&&this.emit("onNotifyJoin",t.data.users)}onNotifyStatus(t){let r=this.packageCreater.createResponsePackage(t.tid,t.msgtype);this.wsClient.send(r),t.data&&t.data.status&&t.data.status.length&&this.emit("onNotifyStatus",t.data.status)}onNotifyLeave(t){let r=this.packageCreater.createResponsePackage(t.tid,t.msgtype);this.wsClient.send(r),t.data&&t.data.users&&t.data.users.length&&this.emit("onNotifyLeave",t.data.users)}onNotifyPublish(t){let r=this.packageCreater.createResponsePackage(t.tid,t.msgtype);this.wsClient.send(r),t.data&&t.data.users&&t.data.users.length&&this.emit("onNotifyPublish",t.data.users)}onStatusReport(t){this.emit("onStatusReport",t.code,t.tid,t.description)}onBye(t){this.stopKeepAlive(),this.emit("onBye",t.reason,t.description)}};B($v,"logName","RSMessageCenter");let vb=$v;const ee=(e,t)=>(r,n,i)=>{const o=i.value;return i.value=function(...s){var a;const c=`[${((a=r.constructor)==null?void 0:a.logName)||""}]`,u=Date.now();let d=[];if(e)try{d=e(s)}catch{}he.interface(c,n,...d);const E=o.apply(this,s);return Promise.resolve(E).then(m=>m).catch(m=>m).then(m=>{var f;let y="";const S=m instanceof Error,l=S&&((f=r.constructor)==null?void 0:f.logError);if(!(!t&&!S)){if(l)y=m;else if(S)y=m.message||"";else if(t)if(m===void 0)y="";else try{y=t(m)}catch{}else return;he.interfaceResult(c,n,!(S&&l),`${Date.now()-u}ms`,y)}}),E},i},ge=e=>e;var Sb=Object.defineProperty,yb=Object.getOwnPropertyDescriptor,nh=(e,t,r,n)=>{for(var i=n>1?void 0:n?yb(t,r):t,o=e.length-1,s;o>=0;o--)(s=e[o])&&(i=(n?s(t,r,i):s(i))||i);return n&&i&&Sb(t,r,i),i},Er;const Tc=(Er=class extends Ut{constructor(e,t,r,n=bn.prod){super(),B(this,"messageCenter"),B(this,"authInfo"),B(this,"userName"),B(this,"channelProfile"),B(this,"clientRole"),B(this,"slsReporter"),B(this,"reconnectData"),B(this,"roomServerUri",""),this.channelProfile=e,this.clientRole=t,this.slsReporter=r,this.reconnectData={role:{channelprofile:e,clientrole:t}};const i=n===bn.pre?Xa.pre:Xa.prod;this.roomServerUri=`wss://${i}/roomserver/v1/ws`}updateReconnectData(e){var t;this.reconnectData=e,(t=this.messageCenter)==null||t.updateReconnectData(this.reconnectData)}reset(){he.info("[roomsig] reset"),this.messageCenter&&(this.messageCenter.close(),this.messageCenter=void 0),this.authInfo=void 0}join(e,t,r){return Q(this,null,function*(){return new Promise((n,i)=>{const o={};this.authInfo=e,this.userName=t,this.messageCenter=new vb(e,t,this.channelProfile,this.clientRole,this.slsReporter,r),this.initMessageCenter(),this.messageCenter.once("onJoinChannelResult",a=>{var c,u,d;if(he.info(`[${Er.logName}]`,"join result: ",a),o.taskretrynum=((c=this.messageCenter)==null?void 0:c.retryCount)||0,a.code==200){(u=this.messageCenter)==null||u.sendPkgCache(),(d=this.messageCenter)==null||d.startKeepAlive();let E=a.data;E.tid=a.tid,E.users=a.data.users,E.timestamp=a.timestamp,o.est&&(o.joinconnecttc=Date.now()-o.est),this.slsReporter.reportJoinConnection(o),n(E)}else this.reset(),i(this.handleSignalError(a.code,a.reason,pe.ERR_JOIN_CHANNEL_FAILED))}),this.messageCenter.once("onAuthInvalid",()=>{this.reset(),i(new ue(pe.ERR_JOIN_BAD_TOKEN,"join failed because authentication failed"))}),he.info(`[${Er.logName}]`,"start ws connecting roomserver and auto join when connected");const s={appid:this.authInfo.appId,callid:this.authInfo.sessionId,channelid:this.authInfo.channelId,userid:this.authInfo.userId,nonce:this.authInfo.nonce||"",timestamp:this.authInfo.timestamp,token:this.authInfo.token,authtype:"app",tid:hn()};e.role&&(s.tokenrole=e.role),o.est=Date.now(),this.messageCenter.start(this.roomServerUri+"?"+vr.queryingParam(s))})})}leave(){return he.info("[roomsig] leave .."),new Promise((e,t)=>{this.messageCenter?(this.messageCenter.on("onLeaveResult",(r,n)=>{he.info(`[${Er.logName}]`,"recv leave response "+r),r===200?(this.updateReconnectData(),this.reset(),e({tid:n})):t(this.handleSignalError(r,"leave error"))}),he.info(`[${Er.logName}]`,"send leave request"),this.messageCenter.leave()):(he.info(`[${Er.logName}]`,"no message center, ok to leave"),e({tid:""}))})}publish(e){return new Promise((t,r)=>{var n;this.messageCenter?(this.messageCenter.once("onPublishResult",(i,o,s)=>{he.info(`[${Er.logName}]`,"recv pubish response "+i),i===200?(this.updateReconnectData(bi(Ne({},this.reconnectData),{publish:{users:[e]}})),t({tid:o})):r(this.handleSignalError(i,`publish error, ${s}`))}),this.authInfo&&(e.sessionid=(n=this.authInfo.sessionId)!=null?n:""),e.callid||(e.callid=hn()),he.info(`[${Er.logName}]`,"assign callid "+e.callid+" and send publish request"),this.messageCenter.publish(e)):r(this.handleSignalError(-1,"publish error, no message center"))})}roleUpdate(e){return new Promise((t,r)=>{if(!this.messageCenter){r(this.handleSignalError(-1,"role update error, no message center"));return}this.messageCenter.on("onRoleUpdateResult",(n,i,o)=>{var s,a;he.info(`[${Er.logName}]`,"recv role update response "+n),n===200?((a=(s=this.reconnectData)==null?void 0:s.role)!=null&&a.clientrole&&(this.reconnectData.role.clientrole=e,this.updateReconnectData(this.reconnectData)),t({tid:i})):r(this.handleSignalError(n,`role update error, ${o}`))}),this.messageCenter.roleUpdate(e)})}setChannelProfile(e){this.channelProfile=e}refreshUrl(e){return he.info(`[${Er.logName}]`,"refreshUrl .."),new Promise((t,r)=>{if(!this.messageCenter){r(this.handleSignalError(-1,"refresh url error, no message center"));return}this.messageCenter.on("onRefreshUrlResult",n=>{const{code:i,description:o,data:s={}}=n||{};he.info("recv refresh url response "+i),i===200?t(s):r(this.handleSignalError(i,`refresh url error, ${o}`))}),he.info("send refresh url request"),this.messageCenter.refreshUrl(e)})}reportStatus(e){return he.info(`[${Er.logName}]`,"reportStatus "+e),new Promise((t,r)=>{this.messageCenter?(this.messageCenter.once("onStatusReport",(n,i)=>{n===200?t():r(new ue(n,i))}),this.messageCenter.reportStatus(e)):r(new ue(-1,"No messageCenter"))})}handleSignalError(e,t,r=pe.ERR_INNER){const n=`signal error: code - ${e}; description - ${t}`;return new ue(r,n)}refreshAuthInfo(e){return Q(this,null,function*(){var t;this.authInfo&&(this.authInfo=e,(t=this.messageCenter)==null||t.refreshAuthInfo(this.authInfo))})}initMessageCenter(){var e,t,r,n,i,o,s,a,c,u,d,E;(e=this.messageCenter)==null||e.on("onKeepAliveRsp",()=>{this.emit("onKeepAliveRsp")}),(t=this.messageCenter)==null||t.on("onNotifyJoin",m=>{this.emit("onNotifyJoin",m)}),(r=this.messageCenter)==null||r.on("onNotifyStatus",m=>{this.emit("onNotifyStatus",m)}),(n=this.messageCenter)==null||n.on("onNotifyLeave",m=>{this.emit("onNotifyLeave",m)}),(i=this.messageCenter)==null||i.on("onNotifyPublish",m=>{this.emit("onNotifyPublish",m)}),(o=this.messageCenter)==null||o.on("onBye",(m,f)=>{this.emit("onBye",m,f)}),(s=this.messageCenter)==null||s.on("onReconnectStart",()=>{this.emit("onReconnectStart")}),(a=this.messageCenter)==null||a.on("onReconnectSuccess",m=>{this.emit("onReconnectSuccess",m)}),(c=this.messageCenter)==null||c.on("onReconnectFail",m=>{this.emit("onReconnectFail",m)}),(u=this.messageCenter)==null||u.on("onConnectFail",m=>{this.emit("onConnectFail",m),this.reset()}),(d=this.messageCenter)==null||d.on("onNetworkError",m=>{this.emit("onNetworkError",m)}),(E=this.messageCenter)==null||E.on("onAuthInvalid",()=>{this.emit("onAuthInvalid")})}},B(Er,"logName","RoomServerSignaling"),Er);nh([ee()],Tc.prototype,"join",1);nh([ee()],Tc.prototype,"publish",1);nh([ee()],Tc.prototype,"roleUpdate",1);let Eb=Tc;const Rb="https://pgw.rtn.aliyuncs.com",bb="https://gw.rtn.aliyuncs.com",xm=10*60*1e3,_b=12,Kv=class kl extends Ut{constructor(t,r){super(),B(this,"env"),B(this,"authInfo"),B(this,"timer"),B(this,"slsReporter"),B(this,"expiration",0),B(this,"skipTime",0),B(this,"requestToken",()=>Q(this,null,function*(){if(this.skipTime=0,!this.authInfo)return;const{appId:n,channelId:i,userId:o,nonce:s="",token:a,timestamp:c,sessionId:u,role:d}=this.authInfo;let E=bb;this.env===bn.pre&&(E=Rb);const m=`${E}/gslb/v1/stsupdate?appid=${n}&channelid=${i}&userid=${o}&nonce=${s}&token=${a}&timestamp=${c}&session=${u}${d?`&tokenrole=${d}`:""}&slstoken=true&osstoken=true&tokensid=false`,f=Date.now();fetch(m).then(y=>y.json()).then(y=>{var S,l;if(y.code===0){const h=(S=y.data)==null?void 0:S.oss,p=(l=y.data)==null?void 0:l.sls;this.expiration=h.expiration||p.expiration,this.emit("onTokenUpdate",h,p),he.event(`[${kl.logName}]`,"getToken",h,p)}else throw new Error;this.slsReporter.reportSTSResult(200,f)}).catch(y=>{this.slsReporter.reportSTSResult(-1,f),he.error(`[${kl.logName}]`,"getToken",y.message)})})),this.slsReporter=t,this.env=r}refreshAuthInfo(t){this.authInfo=t}startSTSUpdate(t){this.authInfo=t,this.requestToken(),this.timer&&clearInterval(this.timer),this.timer=window.setInterval(()=>{if(this.expiration&&Math.floor((Date.now()+xm*1.5)/1e3)<this.expiration&&this.skipTime<_b){this.skipTime+=1;return}this.requestToken()},xm)}clear(){this.timer&&clearInterval(this.timer)}};B(Kv,"logName","StsManager");let Tb=Kv;var Cb=Object.defineProperty,wb=Object.getOwnPropertyDescriptor,Ab=(e,t,r,n)=>{for(var i=n>1?void 0:n?wb(t,r):t,o=e.length-1,s;o>=0;o--)(s=e[o])&&(i=(n?s(t,r,i):s(i))||i);return n&&i&&Cb(t,r,i),i};class ih extends Ut{constructor(t,r,n,i=bn.prod){super(),B(this,"signaling"),B(this,"authInfo"),B(this,"userName"),B(this,"channelProfile"),B(this,"clientRole"),B(this,"env",bn.prod),B(this,"maxConnectRetryCount"),B(this,"stsManager"),B(this,"slsReporter"),this.channelProfile=t,this.clientRole=r,this.env=i,this.slsReporter=n,this.stsManager=new Tb(n,i)}reset(){var t;he.info("[signalingmanager] reset"),(t=this.signaling)==null||t.reset(),this.stsManager.clear(),this.signaling=void 0,this.authInfo=void 0}join(t,r=t.userId,n,i){return this.maxConnectRetryCount=n,this.userName=r,new Promise((o,s)=>{this.signaling?s(new ue(pe.ERR_JOIN_ALREADY_JOINED,"already joined")):(he.info("[signalingmanager] create signaling"),this.signaling=new Eb(this.channelProfile,this.clientRole,this.slsReporter,this.env),this.initSignaling(),i&&(i.rs=Date.now()),this.signaling.join(t,r,n).then(a=>{this.authInfo=t,i&&(i.re=Date.now()),o(a)}).catch(a=>{this.reset(),s(a)}),this.stsManager.startSTSUpdate(t))})}retryJoin(){const t=this.authInfo;this.reset(),t&&this.join(t,this.userName,this.maxConnectRetryCount)}leave(){return new Promise((t,r)=>{this.signaling?this.signaling.leave().then(n=>{this.reset(),t(n)}).catch(n=>{r(n)}):t({tid:""})})}publish(t){return new Promise((r,n)=>{var i;this.signaling&&this.authInfo?(t.userid=this.authInfo.userId,t.displayname=(i=this.userName)!=null?i:this.authInfo.userId,this.signaling.publish(t).then(o=>{r(o)}).catch(o=>{n(o)})):n(new ue(pe.ERR_SDK_PUBLISH_NOT_JOIN_CHANNEL,"no signaling"))})}reportStatus(t){return new Promise((r,n)=>{this.signaling?this.signaling.reportStatus(t).then(()=>{r()}).catch(i=>{n(i)}):n(new ue(-1,"no signaling"))})}setClientRole(t){return Q(this,null,function*(){const r=this.clientRole;if(!this.signaling){this.clientRole=t;return}const n=Date.now();try{const i=yield this.signaling.roleUpdate(t);return this.slsReporter.reportRoleUpdateResult(r,t,Date.now()-n,0),i}catch(i){this.slsReporter.reportRoleUpdateResult(r,t,Date.now()-n,i.code||-1)}})}setChannelProfile(t){this.signaling?this.signaling.setChannelProfile(t):this.channelProfile=t}refreshUrl(t){return this.signaling?this.signaling.refreshUrl(t):Promise.reject(new ue(pe.ERR_SDK_INVALID_STATE,"should join first"))}refreshAuthInfo(t){return Q(this,null,function*(){var r;try{this.authInfo&&(this.authInfo=Ne(Ne({},this.authInfo),t),(r=this.signaling)==null||r.refreshAuthInfo(this.authInfo),this.stsManager.refreshAuthInfo(this.authInfo))}catch(n){throw n}})}initSignaling(){var t,r,n,i,o,s,a,c,u,d,E,m,f;(t=this.signaling)==null||t.on("onKeepAliveRsp",this.onKeepAliveRsp.bind(this)),(r=this.signaling)==null||r.on("onNotifyJoin",this.onNotifyJoin.bind(this)),(n=this.signaling)==null||n.on("onNotifyStatus",this.onNotifyStatus.bind(this)),(i=this.signaling)==null||i.on("onNotifyLeave",this.onNotifyLeave.bind(this)),(o=this.signaling)==null||o.on("onNotifyPublish",this.onNotifyPublish.bind(this)),(s=this.signaling)==null||s.on("onBye",this.onBye.bind(this)),(a=this.signaling)==null||a.on("onReconnectStart",this.onReconnectStart.bind(this)),(c=this.signaling)==null||c.on("onReconnectSuccess",this.onReconnectSuccess.bind(this)),(u=this.signaling)==null||u.on("onReconnectFail",this.onReconnectFail.bind(this)),(d=this.signaling)==null||d.on("onConnectFail",this.onConnectFail.bind(this)),(E=this.signaling)==null||E.on("onNetworkError",this.onNetworkError.bind(this)),(m=this.signaling)==null||m.on("onAuthInvalid",this.onAuthInvalid.bind(this)),(f=this.signaling)==null||f.on("onError",this.onError.bind(this))}onKeepAliveRsp(){this.emit("onKeepAliveRsp")}onNotifyJoin(t){this.emit("onNotifyJoin",t)}onNotifyStatus(t){this.emit("onNotifyStatus",t)}onNotifyLeave(t){this.emit("onNotifyLeave",t)}onNotifyPublish(t){this.emit("onNotifyPublish",t)}onBye(t,r){this.emit("onBye",t,r)}onConnectFail(t){this.reset(),this.emit("onConnectFail",t)}onNetworkError(t){this.emit("onNetworkError",t)}onAuthInvalid(t){}onReconnectStart(){this.emit("onReconnectStart")}onReconnectSuccess(t){this.emit("onReconnectSuccess",t)}onReconnectFail(t){this.emit("onReconnectFail",t)}onError(t){this.emit("onError",t)}}B(ih,"logName","SignalingManager");Ab([ee(ge)],ih.prototype,"publish",1);const Gv=class Lo{static getInstance(){return Lo.instance||(Lo.instance=new AudioContext),Lo.instance.resume(),Lo.instance}};B(Gv,"instance");let fa=Gv;function kb(e,t,r,n,i){let o=n,s=0,a;const c=e.createAnalyser();c.fftSize=256;const u=new Uint8Array(c.frequencyBinCount);t.connect(c),c.connect(r);const d=()=>{a&&window.clearInterval(a)},E=()=>{a=window.setInterval(()=>{c.getByteFrequencyData(u);let m=Math.round(u.reduce((f,y)=>f+y)/u.length);m=Math.min(100,m),s=m,i&&i(m)},o)};return E(),{updateInterval:m=>{d(),o=m,E()},getLevel:()=>s,dispose:()=>{d(),t.disconnect(),c.disconnect()}}}class Pb extends Ut{constructor(){super(),B(this,"audioContext"),B(this,"stream"),B(this,"sourceNode"),B(this,"analyser"),this.audioContext=fa.getInstance(),this.stream=new MediaStream}getLevel(){return this.analyser?this.analyser.getLevel():0}start(t,r=1e3){this.sourceNode&&this.stop(),this.stream.addTrack(t),this.sourceNode=this.audioContext.createMediaStreamSource(this.stream);const n=this.audioContext.createMediaStreamDestination();this.analyser=kb(this.audioContext,this.sourceNode,n,r,i=>{this.emit("audioLevel",i)})}stop(){this.analyser&&this.analyser.dispose(),this.analyser=void 0,this.sourceNode=void 0,this.stream.getAudioTracks().forEach(t=>{this.stream.removeTrack(t)})}dispose(){this.stop()}}class Jv extends Ut{constructor(t,r,n,i){super(),B(this,"uid"),B(this,"name"),B(this,"rtsManager"),B(this,"callId",""),B(this,"audioLevelMonitor"),B(this,"audioVolumeIndicationInterval",0),this.uid=t,this.name=r,this.rtsManager=n,this.audioVolumeIndicationInterval=i,this.audioLevelMonitor=new Pb}get userId(){return this.uid}get displayname(){return this.name}createCallId(){this.callId||(this.callId=vr.createCallid())}setUserInfo(t,r){this.uid=t,this.name=r}refreshUserInfo(t){this.uid=t}getAudioLevel(){return this.audioLevelMonitor.getLevel()}enableAudioVolumeIndication(t){this.audioVolumeIndicationInterval=t}clear(){this.audioLevelMonitor.dispose()}}class qv{static getCurrentStatus(t){let r=0;t.micOpen&&(r+=1),t.micInterrupted&&(r+=2),t.cameraOpen&&(r+=4),t.screenShare&&(r+=128),t.audioDisable&&(r+=8),t.videoDisable&&(r+=16),t.screenDisable&&(r+=256);let n=r.toString(16);for(;n.length<16;)n="0"+n;return n}static parseStatus(t){let r=parseInt(t,16);return{micOpen:!!(r&1),micInterrupted:!!(r&2),cameraOpen:!!(r&4),screenShare:!!(r&128),audioDisable:!!(r&8),videoDisable:!!(r&16),screenDisable:!!(r&256),backgroundMode:!!(r&32),accompanyPlaying:!!(r&64)}}}const Yv="customVideoProfile",Qv="customScreenProfile",xo={width:1280,height:720,frameRate:30,maxBitrate:2e3},Uo={width:1920,height:1080,frameRate:30,maxBitrate:2600},Ib={1e4:Ct.AliEngineLocalDeviceExceptionTypeUnknown,2e4:Ct.AliEngineLocalDeviceExceptionTypeUnknown,10001:Ct.AliEngineLocalDeviceExceptionTypeMicNotAvailable,10002:Ct.AliEngineLocalDeviceExceptionTypeMicAuthFail,10003:Ct.AliEngineLocalDeviceExceptionTypeMicOpenFail,10005:Ct.AliEngineLocalDeviceExceptionTypeCameraAuthFail,10004:Ct.AliEngineLocalDeviceExceptionTypeVideoDeviceException,10006:Ct.AliEngineLocalDeviceExceptionTypeCameraOpenFail,10010:Ct.AliEngineLocalDeviceExceptionTypeDisplayException,10011:Ct.AliEngineLocalDeviceExceptionTypeDisplayException,10012:Ct.AliEngineLocalDeviceExceptionTypeDisplayException,10013:Ct.AliEngineLocalDeviceExceptionTypeDisplayException,10014:Ct.AliEngineLocalDeviceExceptionTypeDisplayException,10019:Ct.AliEngineLocalDeviceExceptionTypeDisplayException},Ob=e=>e.getAudioTracks()[0];function Um(e){var t;if(((t=e==null?void 0:e.nodeName)==null?void 0:t.toLowerCase())==="video")return e.setAttribute("playsinline",""),e;if(typeof e=="string"){let r=document.getElementById(e);if(r){if(r.nodeName.toLocaleLowerCase()==="video")return r.setAttribute("playsinline",""),r;throw new ue(pe.ERR_INVALID_ARGUMENTS,"element should be HtmlVideoElement")}else throw new ue(pe.ERR_INVALID_ARGUMENTS,"element not founded")}else throw new ue(pe.ERR_INVALID_ARGUMENTS,"element id should be string")}function Pl(e){var t;const r=[];if(Array.isArray(e))e.forEach(n=>{try{r.push(Um(n))}catch{}});else if(typeof e=="string"||((t=e==null?void 0:e.nodeName)==null?void 0:t.toLowerCase())==="video")try{r.push(Um(e))}catch{}return r}function xn(e){return new Promise(t=>setTimeout(t,e))}function Vm(e,t,r=1e3,n=i=>!0){return Q(this,null,function*(){let i=0,o;for(;i<t;)try{return yield e(i)}catch(s){if(i++,i>=t||!n(s))throw s||o;yield new Promise(a=>setTimeout(a,r))}})}function Db(e,t){let r=0;const n=[];for(;r<e.byteLength;){const i=Math.min(t,e.byteLength-r),o=e.slice(r,r+i);n.push(o),r+=i}return n}const Xv=(e,t,r=!1)=>{const n=()=>(e.muted=!0,Promise.race([xn(500),e._playPromise||Promise.resolve()]).catch(()=>{}).then(()=>{let i;return r&&e.srcObject===t?i=Promise.resolve():(e.load(),e.srcObject=t,i=e.play(),e._playPromise=i),i}));return new Promise(i=>{if(We.AliRTS.BrowserUtil.isMicroMessenger){const o=window.top!==window.self,s=window.WeixinJSBridge||window.top.WeixinJSBridge;s?s.invoke("getNetworkType",{},()=>{i(n())}):(o?window.top.document:document).addEventListener("WeixinJSBridgeReady",()=>{s.invoke("getNetworkType",{},()=>{i(n())})}),setTimeout(()=>{i(n())},1e3)}else setTimeout(()=>{i(n())},0)})},nn=e=>{Promise.race([xn(100),e._playPromise||Promise.resolve()]).catch(()=>{}).then(()=>{e.srcObject=null,e._playPromise=void 0})};var oh=(e=>(e[e.AliEngineDataMsgNone=0]="AliEngineDataMsgNone",e[e.AliEngineDataMsgMusicProgress=1]="AliEngineDataMsgMusicProgress",e[e.AliEngineDataMsgCustom=2]="AliEngineDataMsgCustom",e))(oh||{});class Cc{constructor(t,r,n,i=0){B(this,"msgType"),B(this,"msgId"),B(this,"protocolVersion"),B(this,"tlvVersion"),this.msgType=t,this.msgId=r,this.protocolVersion=n,this.tlvVersion=i}build(){const t=new Uint8Array(4);return t.set(Uint8Array.from([this.protocolVersion,this.tlvVersion<<4|this.msgType&15]),0),t.set(Uint16Array.from([this.msgId]),2),t}static parse(t){const r=new DataView(t),n=r.getUint8(0),i=r.getUint8(1)>>4,o=r.getUint8(1)&15,s=r.getUint16(2);return new Cc(o,s,n,i)}}const ri=5;class Ys{constructor(t,r,n){if(B(this,"_byteArray"),this._byteArray=new Uint8Array(0),t!==void 0&&r!==void 0&&n!==void 0){const i=new Cc(t,r,n).build();this._byteArray=new Uint8Array(i.byteLength+this._byteArray.byteLength),this._byteArray.set(i,0)}}write(t,r){const n=this._byteArray,i=new ArrayBuffer(ri),o=new DataView(i);o.setUint8(0,t),o.setUint32(1,r.byteLength);const s=new Uint8Array(n.byteLength+ri+r.byteLength);s.set(n,0),s.set(new Uint8Array(i),n.byteLength),s.set(new Uint8Array(r),n.byteLength+ri),this._byteArray=s}static parse(t){const r={},n=new DataView(t);let i=0;for(;i<t.byteLength;){const o=n.getUint8(i),s=n.getUint32(i+1);if(i+ri+s<=t.byteLength){const a=t.slice(i+ri,i+ri+s);r[o]=a,i+=ri+s}else break}return r}get buffer(){return this._byteArray.buffer}}class Ss{constructor(t=0,r=!0,n=1,i=!1,o=0,s=!1,a=!1,c=3){B(this,"_fin",!0),B(this,"_hasExtension",!1),B(this,"_version",0),B(this,"_frameType",1),B(this,"_isEncrypted",!1),B(this,"_isCompressed",!1),B(this,"_signalType",3),B(this,"_payloadLength",0),this._fin=r,this._hasExtension=i,this._version=o,this._frameType=n,this._isEncrypted=s,this._isCompressed=a,this._signalType=c,this._payloadLength=t}get fin(){return this._fin}get hasExtension(){return this._hasExtension}get version(){return this._version}get frameType(){return this._frameType}get isEncrypted(){return this._isEncrypted}get isCompressed(){return this._isCompressed}get signalType(){return this._signalType}get payloadLength(){return this._payloadLength}toBuffer(){const t=new ArrayBuffer(4),r=new DataView(t);return r.setUint8(0,(this._fin?1:0)<<7|(this._hasExtension?1:0)<<6|this._version<<4|this._frameType&15),r.setUint8(1,(this._isEncrypted?1:0)<<7|(this._isCompressed?1:0)<<6|this._signalType&15),r.setUint16(2,this._payloadLength),t}static parse(t){const r=new DataView(t),n=r.getUint8(0)>>7===1,i=(r.getUint8(0)&64)>>6===1,o=(r.getUint8(0)&48)>>4,s=r.getUint8(0)&15,a=r.getUint8(1)>>7===1,c=(r.getUint8(1)&64)>>6===1,u=r.getUint8(1)&15,d=r.getUint16(2);return new Ss(d,n,s,i,o,a,c,u)}}class wc{constructor(t,r){B(this,"_body"),B(this,"_header",new Ss),this._header=t,this._body=r}get header(){return this._header}get isFin(){return this._header.fin}get body(){return this._body}toGRTNBuffer(){const t=this._header.toBuffer(),r=this._body,n=new ArrayBuffer(4);new DataView(n).setUint8(0,1*Math.pow(2,4));const i=new Uint8Array(n.byteLength+t.byteLength+r.byteLength);return i.set(new Uint8Array(n),0),i.set(new Uint8Array(t),n.byteLength),i.set(new Uint8Array(r),n.byteLength+t.byteLength),i.buffer}static parse(t){const r=t.slice(0,4),n=Ss.parse(r);let i=new ArrayBuffer(0);return t.byteLength-4>=n.payloadLength&&(i=t.slice(4,4+n.payloadLength)),new wc(n,i)}}const Tu=e=>{const t=e.byteLength,r=new DataView(e);let n=0;for(let i=0;i<t;i++)n=n*256+r.getUint8(i);return n};let Bm=0;class Jn{constructor(t,r=0,n=0,i=0){B(this,"data"),B(this,"networkTime"),B(this,"futureOrProgress"),B(this,"type"),this.data=t,this.type=r,this.networkTime=n,this.futureOrProgress=i}toBuffer(){const t=new Ys(0,0,0);t.write(1,Uint8Array.from([0]).buffer),t.write(2,Uint16Array.from([0]).buffer),Bm++,t.write(3,Uint32Array.from([Bm]).buffer);const r=new Ys;return r.write(1,Uint8Array.from([0]).buffer),r.write(2,Uint8Array.from([this.type]).buffer),r.write(3,Uint32Array.from([this.futureOrProgress]).buffer),r.write(4,Uint32Array.from([Number(this.networkTime>>32&4294967295),Number(this.networkTime&4294967295)]).buffer),r.write(5,this.data),t.write(30,r.buffer),t.buffer}static parse(t){if(!t||t.byteLength<4)return;Cc.parse(t.slice(0,4));const r=Ys.parse(t.slice(4))[30];if(!r)return;const n=Ys.parse(r),i=n[2],o=n[3],s=n[4],a=n[5];if(a.byteLength!==0)return new Jn(a,Tu(i),Tu(s),Tu(o))}}var Mb=Object.defineProperty,Nb=Object.getOwnPropertyDescriptor,mt=(e,t,r,n)=>{for(var i=n>1?void 0:n?Nb(t,r):t,o=e.length-1,s;o>=0;o--)(s=e[o])&&(i=(n?s(t,r,i):s(i))||i);return n&&i&&Mb(t,r,i),i};const jm=30;class wo extends Ut{constructor(){super(),B(this,"state"),B(this,"time"),this.state=Oe.AliRtcStatePublishIdle,this.time=Date.now()}setState(t){const r=this.state,n=this.time;this.state=t,this.time=Date.now(),this.emit("change",r,t,Math.floor((this.time-n)/1e3))}}var ni;const ht=(ni=class extends Jv{constructor(e){const{rtsManager:t,localStreamManager:r,slsReporter:n,signalingManager:i,audioVolumeIndicationInterval:o,parameter:s}=e;super("","",t,o),B(this,"url",""),B(this,"joinTime",0),B(this,"_isPublishing",!1),B(this,"publishPromise",Promise.resolve({traceId:"",l1ip:void 0})),B(this,"previewElements",[]),B(this,"screenPreviewElements",[]),B(this,"streamManager"),B(this,"dc"),B(this,"streamTracks"),B(this,"publishId",hn()),B(this,"signalingManager"),B(this,"traceId",""),B(this,"monitorTimerId"),B(this,"monitorDataCache",{}),B(this,"trackTraceIdMap",{}),B(this,"candidateDataCache",[]),B(this,"pcMediaStatsMap",{}),B(this,"slsReporter"),B(this,"audioPubState"),B(this,"videoPubState"),B(this,"videoSmallPubState"),B(this,"screenPubState"),B(this,"dataPubState"),B(this,"parameter",{}),B(this,"onTrackEnd",a=>{this.emit(a)}),this.streamManager=r,this.signalingManager=i,this.slsReporter=n,this.parameter=s,this.streamManager.on("trackended",a=>{this.onTrackEnd(a)}),this.streamManager.on("publishupdate",()=>{this.publishUpdate()}),this.audioPubState=new wo,this.audioPubState.on("change",(a,c,u)=>{this.emit("audioPublishStateChanged",a,c,u)}),this.videoPubState=new wo,this.videoPubState.on("change",(a,c,u)=>{this.emit("videoPublishStateChanged",a,c,u)}),this.videoSmallPubState=new wo,this.videoSmallPubState.on("change",(a,c,u)=>{this.emit("dualStreamPublishStateChanged",a,c,u)}),this.screenPubState=new wo,this.screenPubState.on("change",(a,c,u)=>{this.emit("screenPublishStateChanged",a,c,u)}),this.dataPubState=new wo,this.dataPubState.on("change",(a,c,u)=>{this.emit("dataPublishStateChanged",a,c,u)}),this.startStreamMonitor()}get joined(){return!!this.uid}get isPublishing(){return this._isPublishing}get publishStreams(){return this.streamManager.publishStreams}get cameraTrack(){return this.streamManager.cameraStreamInfo.originVideoTrack}get screenTrack(){return this.streamManager.screenStreamInfo.originVideoTrack}get audioTrack(){return this.streamManager.cameraStreamInfo.originAudioTrack}get hasCamera(){return!!this.streamManager.cameraStreamInfo.originVideoTrack}get hasMicrophone(){return!!this.streamManager.cameraStreamInfo.originAudioTrack}get hasScreenShare(){return!!this.streamManager.screenStreamInfo.originVideoTrack}get hasCameraTrackInMS(){var e;return!!((e=this.streamTracks)!=null&&e.find(({ssrc:t,type:r,msid:n})=>r==="video"&&t&&n===se.VideoLarge))}get hasCameraDualTrackInMS(){var e;return!!((e=this.streamTracks)!=null&&e.find(({ssrc:t,type:r,msid:n})=>r==="video"&&t&&n===se.VideoSmall))}get hasScreenTrackInMS(){var e;return!!((e=this.streamTracks)!=null&&e.find(({ssrc:t,type:r,msid:n})=>r==="video"&&t&&n===se.Screen))}get hasAudioTrackInMS(){var e;return!!((e=this.streamTracks)!=null&&e.find(({ssrc:t,type:r,msid:n})=>r==="audio"&&t&&n===se.Audio))}get cameraDirection(){var e,t;return(t=(e=this.streamManager.cameraStreamInfo)==null?void 0:e.cameraVideoConstraints)==null?void 0:t.facingMode}get audioCaptureDisabled(){return this.streamManager.audioCaptureDisabled}get cameraCaptureDisabled(){return this.streamManager.cameraCaptureDisabled}get publishLocalVideoStreamEnabled(){return this.streamManager.publishLocalVideoStreamEnabled}get publishLocalAudioStreamEnabled(){return this.streamManager.publishLocalAudioStreamEnabled}get publishLocalScreenStreamEnabled(){return this.streamManager.publishLocalScreenStreamEnabled}setPublishLocalAudioStreamEnabled(e){this.streamManager.publishLocalAudioStreamEnabled=e}setPublishLocalVideoStreamEnabled(e){this.streamManager.publishLocalVideoStreamEnabled=e}setPublishLocalScreenStreamEnabled(e){this.streamManager.publishLocalScreenStreamEnabled=e}initInfo(e,t){this.joinTime=Date.now(),this.rtsManager.localJoinTime=this.joinTime,this.setUserInfo(e.userId,e.userId),this.url=t,this.callId=e.sessionId||vr.createCallid(),this.updatePubId()}setVideoProfile(e,t){return Q(this,null,function*(){yield this.streamManager.setVideoProfile(e,t)})}setVideoContentHint(e){this.streamManager.setVideoContentHint(e)}setScreenContentHint(e){this.streamManager.setScreenContentHint(e)}setAudioProfile(e){return Q(this,null,function*(){yield this.streamManager.setAudioProfile(e)})}setScreenProfile(e,t){return Q(this,null,function*(){yield this.streamManager.setScreenProfile(e,t)})}setCameraDirection(e){if(e===vs.CAMERA_FRONT)this.streamManager.setCameraVideoConstraints({facingMode:"user"});else if(e===vs.CAMERA_REAR)this.streamManager.setCameraVideoConstraints({facingMode:"environment"});else throw new ue(pe.ERR_CAMERA_OPEN_FAIL,`camera direction set to  ${e} failed`)}setCameraDeviceId(e){this.streamManager.setCameraVideoConstraints({deviceId:e})}muteLocalCamera(e){this.streamManager.setCameraMuted(e),this.slsReporter.reportMute(this.callId,!e,"video")}muteLocalMic(e){this.streamManager.setAudioMuted(e),this.slsReporter.reportMute(this.callId,!e,"audio")}muteLocalScreen(e){this.streamManager.setScreenMuted(e),this.slsReporter.reportMute(this.callId,!e,"screen")}setMicrophoneDeviceId(e){this.streamManager.setMicAudioConstraints({deviceId:e})}updatePubId(){this.publishId=hn()}clearPublishState(){this.streamTracks=void 0}leave(){return Q(this,null,function*(){this._isPublishing&&(this._isPublishing=!1,yield this.unPublish())})}clear(){return Q(this,null,function*(){Lv(ni.prototype,this,"clear").call(this),this.stopPreview(),this.resetPreviewElements(),this.resetSecondayPreviewElements(),this.clearStream(),yield this.leave(),this.streamManager.cameraCaptureDisabled=!1})}resetElement(e){this.previewElements.includes(e)&&(nn(e),this.previewElements.splice(this.previewElements.indexOf(e),1)),this.screenPreviewElements.includes(e)&&(nn(e),this.screenPreviewElements.splice(this.screenPreviewElements.indexOf(e),1))}setPreviewElement(e){const{videoElement:t,screen:r}=e;r?this.screenPreviewElements.includes(t)||this.screenPreviewElements.push(t):this.previewElements.includes(t)||this.previewElements.push(t)}startDefaultCamera(e){return Q(this,null,function*(){const{hasCamera:t,cameraCaptureDisabled:r,publishLocalVideoStreamEnabled:n}=this;let i=[];if(!t&&!e&&!r&&n){try{i=yield We.AliRTS.getCameraList(),i.length&&(yield this.startCameraCapture())}catch(o){throw o.code===We.AliRTS.ErrorCode.ERROR_DEVICE_VIDEODEVICE_NOTALLOWED?new ue(pe.ERR_CAMERA_AUTH_FAIL,"camera auth fail"):new ue(pe.ERR_CAMERA_OPEN_FAIL,`camera open fail: ${o.message}`)}if(!i.length)throw new ue(pe.ERR_CAMERA_NOT_AVAILABLE,"No camera device can be captured")}})}startDefaultAudio(){return Q(this,null,function*(){const{hasMicrophone:e,audioCaptureDisabled:t,publishLocalAudioStreamEnabled:r}=this;let n=[];if(!e&&!t&&r){try{n=yield We.AliRTS.getMicList(),n.length&&(yield this.startAudioCapture())}catch(i){throw i.code===We.AliRTS.ErrorCode.ERROR_DEVICE_AUDIODEVICE_NOTALLOWED?new ue(pe.ERR_MIC_AUTH_FAIL,"microphone auth fail"):new ue(pe.ERR_MIC_OPEN_FAIL,`microphone open fail: ${i.message}`)}if(!n.length)throw new ue(pe.ERR_MIC_NOT_AVAILABLE,"No microphone device can be captured")}})}setViewConfig(e,t){if(!e){t===xe.AliRtcVideoTrackCamera?this.stopPreview({primary:!0,screen:!1}):this.stopPreview({primary:!1,screen:!0});return}if(![xe.AliRtcVideoTrackCamera,xe.AliRtcVideoTrackScreen].includes(t))throw new ue(pe.ERR_INVALID_ARGUMENTS,"set view config invalid track",{track:t});e.forEach(r=>{this.setPreviewElement({videoElement:r,screen:t===xe.AliRtcVideoTrackScreen})})}startCameraCapture(){return Q(this,null,function*(){return this.streamManager.cameraCaptureDisabled=!1,yield this.createLocalStream({video:!0})})}stopCameraCapture(){return Q(this,null,function*(){this.streamManager.cameraCaptureDisabled=!0,yield this.stopLocalStream({video:!0})})}startAudioCapture(){return Q(this,null,function*(){return this.streamManager.audioCaptureDisabled=!1,yield this.createLocalStream({audio:!0})})}stopAudioCapture(){return Q(this,null,function*(){this.streamManager.audioCaptureDisabled=!0,yield this.stopLocalStream({audio:!0})})}preview(e){return Q(this,null,function*(){const{videoElement:t,screen:r}=e??{};try{let n=r?this.streamManager.screenStreamInfo.previewStream:this.streamManager.cameraStreamInfo.previewStream;if(!t)throw new ue(pe.ERR_INVALID_ARGUMENTS,"no video element found",{videoElement:t});if(!n){he.info(`[${ni.logName}]`,"preview no stream founded");return}return Xv(t,n.mediaStream),this.setPreviewElement(e),n.mediaStream}catch(n){const i=pe.ERR_INNER;throw ue.fromError(n,i,"preview failed")}})}previewAll(e){return Q(this,null,function*(){const{primary:t=!0,screen:r=!0}=e??{};if(t&&this.previewElements.length)for(let n=0;n<this.previewElements.length;n++){const i=this.previewElements[n];yield this.preview({videoElement:i})}if(r&&this.screenPreviewElements.length)for(let n=0;n<this.screenPreviewElements.length;n++){const i=this.screenPreviewElements[n];yield this.preview({videoElement:i,screen:!0})}})}stopPreview(e){const{videoElement:t,primary:r=!0,screen:n=!0}=e||{};if(!t)r&&(this.previewElements.forEach(i=>{nn(i)}),this.previewElements=[]),n&&(this.screenPreviewElements.forEach(i=>{nn(i)}),this.screenPreviewElements=[]);else{const i=this.previewElements.findIndex(o=>o===t);if(i>=0)this.previewElements.splice(i,1),nn(t);else{const o=this.screenPreviewElements.findIndex(s=>s===t);o>=0&&(this.screenPreviewElements.splice(o,1),nn(t))}}}resumePublish(){return Q(this,null,function*(){this._isPublishing=!1,yield this.startPublish(!0)})}createLocalStream(e){return Q(this,null,function*(){try{if(e.video)for(let r=0;r<this.previewElements.length;r++){const n=this.previewElements[r];nn(n)}else if(e.screen)for(let r=0;r<this.screenPreviewElements.length;r++){const n=this.screenPreviewElements[r];nn(n)}const t=yield this.streamManager.createLocalStream(e);return t!=null&&t.audioTrack&&this.audioVolumeIndicationInterval>0&&this.audioLevelMonitor.start(t.audioTrack,this.audioVolumeIndicationInterval),e.video?this.previewAll({primary:!0}):e.screen&&this.previewAll({screen:!0}),t}catch(t){const r=Ib[t.errorCode];throw r&&(e.audio?this.emit("localDeviceException",cn.AliEngineLocalDeviceTypeMic,r,""):e.video?this.emit("localDeviceException",cn.AliEngineLocalDeviceTypeCamera,r,""):e.screen?this.emit("localDeviceException",cn.AliEngineLocalDeviceTypeDisplay,r,""):this.emit("localDeviceException",cn.AliEngineLocalDeviceTypeUnknown,r,"")),t}})}stopLocalStream(e){return Q(this,null,function*(){e.audio&&this.audioLevelMonitor.stop(),yield this.streamManager.stopLocalStream(e)})}compareAndPublish(e,t,r){return Q(this,null,function*(){var n,i;if(!e&&!t)return;if(e&&!t){const s={};return r===se.Audio?s.audio=!0:r===se.VideoLarge||r===se.VideoSmall?(s.video=!0,s.vMsid=r):r===se.Screen&&(s.screen=!0),yield this.publishDeleteTracks(s)}const o={};if(t!=null&&t.hasVideo&&(o.isScreen=r===se.Screen,o.vMsid=r),t!=null&&t.hasAudio&&(o.aMsid=r),!e&&t)return yield this.publishAdd(t,o,!1);if(e&&t){const s=e.trackId,a=((n=t.videoTrack)==null?void 0:n.id)||((i=t.audioTrack)==null?void 0:i.id);if(s!==a)return yield this.publishReplace(t,o)}})}reportAudioProfile(){const e=this.streamManager.cameraStreamInfo.audioProfile||"standard",t=We.AliRTS.AudioProfileMap.get(e);this.slsReporter.reportPublishProfile(se.Audio,{a_profile:e,bits:(t==null?void 0:t.maxBitrate)||0,samplerate:(t==null?void 0:t.sampleRate)||0,channel:(t==null?void 0:t.channelCount)||0})}reportVideoProfile(){const e=this.streamManager.cameraStreamInfo.videoProfile||"",t=We.AliRTS.VideoProfileMap.get(e);t&&this.slsReporter.reportPublishProfile(se.VideoLarge,{v_profile:e,wdth:(t==null?void 0:t.width)||0,hgt:(t==null?void 0:t.height)||0,fps:(t==null?void 0:t.frameRate)||0,bitrate:(t==null?void 0:t.maxBitrate)||0})}reportScreenProfile(){const e=this.streamManager.screenStreamInfo.videoProfile||"",t=We.AliRTS.VideoProfileMap.get(e);t&&this.slsReporter.reportPublishProfile(se.Screen,{v_profile:e,wdth:(t==null?void 0:t.width)||0,hgt:(t==null?void 0:t.height)||0,fps:(t==null?void 0:t.frameRate)||0,bitrate:(t==null?void 0:t.maxBitrate)||0})}startPublish(){return Q(this,arguments,function*(e=!1,t=dn.MANUAL){var r;if(!this.joined)return;const n=yield this.streamManager.publishStreams,{audio:i,video:o,videoSmall:s,screen:a}=n;if(!i&&!o&&!s&&!a){he.event(`[${ni.logName}]`,"startPublish no stream founded");return}this.createCallId();try{const c=new Date().getTime();i&&this.audioPubState.setState(Oe.AliRtcStatePublishing),o&&this.videoPubState.setState(Oe.AliRtcStatePublishing),s&&this.videoSmallPubState.setState(Oe.AliRtcStatePublishing),a&&this.screenPubState.setState(Oe.AliRtcStatePublishing),this.publishPromise=this.rtsManager.publish(this.url,this.callId,e,t);const{traceId:u,l1ip:d}=yield this.publishPromise;this._isPublishing=!0,this.streamTracks=this.rtsManager.publishingTracks,this.traceId=u,(r=this.parameter.data)!=null&&r.enablePubDataChannel&&(yield this.publishDataChannel()),i&&(this.trackTraceIdMap[se.Audio]=u,this.reportAudioProfile()),s&&(this.trackTraceIdMap[se.VideoSmall]=u),o&&(this.trackTraceIdMap[se.VideoLarge]=u,this.reportVideoProfile()),a&&(this.trackTraceIdMap[se.Screen]=u,this.reportScreenProfile());const E={type:In.Add,userid:this.userId,sessionid:"",displayname:this.name,pubid:this.publishId,resume:e,subscribe:{signal:"",pullstreamurl:this.url},l1ip:this.parameter.reportL1IP?d:void 0,callid:this.callId,tracks:this.streamTracks,traceid:u};yield this.syncPublishToRoomServer(E,n,c),i&&this.audioPubState.setState(Oe.AliRtcStatePublished),o&&this.videoPubState.setState(Oe.AliRtcStatePublished),s&&this.videoSmallPubState.setState(Oe.AliRtcStatePublished),a&&this.screenPubState.setState(Oe.AliRtcStatePublished)}catch(c){throw i&&this.audioPubState.setState(Oe.AliRtcStateNoPublish),o&&this.videoPubState.setState(Oe.AliRtcStateNoPublish),s&&this.videoSmallPubState.setState(Oe.AliRtcStateNoPublish),a&&this.screenPubState.setState(Oe.AliRtcStateNoPublish),c}})}updateStreams(){return Q(this,null,function*(){yield this.streamManager.updateStreams()})}publishDataChannel(){return Q(this,null,function*(){this.dataPubState.setState(Oe.AliRtcStatePublishing);const e=yield this.rtsManager.publishAddDataChannel(this.url);e?(this.dc=e,this.dc.datachannel&&(this.dc.datachannel.binaryType="arraybuffer"),this.dataPubState.setState(Oe.AliRtcStatePublished)):this.emit("publishDataError",new ue(pe.ERR_INNER,"publishDataError"))})}clearDataChannel(){this.dc=void 0}publishUpdate(e){return Q(this,null,function*(){var t,r,n,i,o;if(!this._isPublishing)return;yield this.publishPromise;const s=this.streamManager.publishStreams;let a;const c=new Date().getTime();try{const u=(t=this.streamTracks)==null?void 0:t.find(({ssrc:h,type:p,msid:v})=>p==="audio"&&h&&v===se.Audio),d=yield this.compareAndPublish(u,s.audio,se.Audio);d&&(a=d);const E=(r=this.streamTracks)==null?void 0:r.find(({ssrc:h,type:p,msid:v})=>p==="video"&&h&&v===se.VideoLarge),m=yield this.compareAndPublish(E,s.video,se.VideoLarge);m&&(a=m);const f=(n=this.streamTracks)==null?void 0:n.find(({ssrc:h,type:p,msid:v})=>p==="video"&&h&&v===se.VideoSmall),y=yield this.compareAndPublish(f,s.videoSmall,se.VideoSmall);y&&(a=y);const S=(i=this.streamTracks)==null?void 0:i.find(({ssrc:h,type:p,msid:v})=>p==="video"&&h&&v===se.Screen),l=yield this.compareAndPublish(S,s.screen,se.Screen);if(l&&(a=l),!a)if(e===dn.RECONNECT&&this.rtsManager.publishingTracks.length>0){const h=this.rtsManager.publishingTracks.find(({type:v})=>v==="video"),p=this.rtsManager.publishingTracks.find(({type:v})=>v==="audio");(h||p)&&(yield this.rtsManager.waitPublishSender(this.url,!h,h?h.msid:p==null?void 0:p.msid)),a={type:In.Add,userid:this.userId,sessionid:"",displayname:this.name,pubid:this.publishId,resume:!0,subscribe:{signal:"",pullstreamurl:this.url},callid:this.callId,tracks:this.rtsManager.publishingTracks,traceid:this.traceId}}else return;(o=this.parameter.data)!=null&&o.enablePubDataChannel&&!this.dc&&(yield this.publishDataChannel()),yield this.syncPublishToRoomServer(a,s,c)}catch(u){const{code:d}=u??{},E=this.url;throw d===403&&E&&(yield this.refreshPushStreamUrl(),a=yield this.publishUpdate()),u}return a})}syncPublishToRoomServer(e,t,r){return Q(this,null,function*(){var n;if(!e)throw new ue(pe.ERR_INNER,"sync publish to room server failed because  no publishInfo");let i=e;if(this.dc){const s=e,{tracks:a}=s,c=Jo(s,["tracks"]);i=bi(Ne({},c),{tracks:[...a,{type:"data",msid:se.Data,ssrc:`${((n=this.callId)==null?void 0:n.length)>8?this.callId.substring(0,8):"web"}${this.dc.datachannel.id||"0"}`,codec:"text"}]})}const o=yield this.signalingManager.publish(i);e.signaltid=o.tid})}refreshPushStreamUrl(){return Q(this,null,function*(){const e=new ue(pe.ERR_INNER,"refresh push stream url error"),t=this.url;if(!t)throw e;const r=yield this.signalingManager.refreshUrl({pushstreamurl:t});if(!(r!=null&&r.pushstreamurl))throw e;this.url=r==null?void 0:r.pushstreamurl})}publishAdd(e,t,r=!1,n=0){return Q(this,null,function*(){this.createCallId();const i=(t==null?void 0:t.aMsid)===se.Audio,o=(t==null?void 0:t.vMsid)===se.VideoLarge,s=(t==null?void 0:t.vMsid)===se.VideoSmall,a=(t==null?void 0:t.vMsid)===se.Screen;i&&this.audioPubState.setState(Oe.AliRtcStatePublishing),o&&this.videoPubState.setState(Oe.AliRtcStatePublishing),s&&this.videoSmallPubState.setState(Oe.AliRtcStatePublishing),a&&this.screenPubState.setState(Oe.AliRtcStatePublishing);try{const c=yield this.rtsManager.publishAdd(this.url,e,this.callId,t,!1,!0);i&&(this.audioPubState.setState(Oe.AliRtcStatePublished),this.reportAudioProfile(),this.trackTraceIdMap[se.Audio]=c),o&&(this.videoPubState.setState(Oe.AliRtcStatePublished),this.reportVideoProfile(),this.trackTraceIdMap[se.VideoLarge]=c),s&&(this.videoSmallPubState.setState(Oe.AliRtcStatePublished),this.trackTraceIdMap[se.VideoSmall]=c),a&&(this.screenPubState.setState(Oe.AliRtcStatePublished),this.reportScreenProfile(),this.trackTraceIdMap[se.Screen]=c),this.streamTracks=this.rtsManager.publishingTracks;const u={type:In.Add,userid:this.userId,sessionid:"",displayname:this.name,pubid:this.publishId,resume:r,subscribe:{signal:"",pullstreamurl:this.url},callid:this.callId,tracks:this.streamTracks,traceid:c};return this.reportSelfDeviceStatus(),this.monitorTimerId||this.startStreamMonitor(),u}catch(c){let u=pe.ERR_SDK_PUBLISH_INVAILD;if(i&&(this.audioPubState.setState(Oe.AliRtcStateNoPublish),u=pe.ERR_SDK_PUBLISH_AUDIO_STREAM_FAILED),o&&(this.videoPubState.setState(Oe.AliRtcStateNoPublish),u=pe.ERR_SDK_PUBLISH_VIDEO_STREAM_FAILED),s&&(this.videoSmallPubState.setState(Oe.AliRtcStateNoPublish),u=pe.ERR_SDK_PUBLISH_DUAL_STREAM_FAILED),a&&(this.screenPubState.setState(Oe.AliRtcStateNoPublish),u=pe.ERR_SDK_PUBLISH_SCEEN_SHARE_FAILED),c.errorCode===15006&&n<3)return this.publishAdd(e,t,r,n+1);throw ue.fromError(c,u,"publish add failed")}})}publishReplace(e,t){return Q(this,null,function*(){try{yield this.rtsManager.publishReplace(this.url,e,t),this.streamTracks=this.rtsManager.publishingTracks;const r={type:In.Replace,userid:this.userId,sessionid:"",pubid:this.publishId,displayname:this.name,subscribe:{signal:"",pullstreamurl:this.url},callid:this.callId,tracks:this.streamTracks};return this.reportSelfDeviceStatus(),r}catch(r){throw ue.fromError(r,pe.ERR_INNER,`publish replace failed, vMsid: ${t==null?void 0:t.vMsid} aMsid: ${t==null?void 0:t.aMsid}`)}})}publishDeleteTracks(e){return Q(this,null,function*(){const t={type:In.Delete,userid:this.userId,sessionid:"",displayname:this.displayname,callid:this.callId,pubid:this.publishId,subscribe:{signal:"",pullstreamurl:this.url},tracks:[]};try{return yield this.rtsManager.publishDelete(this.url,e),this.streamTracks=this.rtsManager.publishingTracks,e.audio&&this.audioPubState.setState(Oe.AliRtcStateNoPublish),e.video&&(e.vMsid===se.VideoSmall?this.videoSmallPubState.setState(Oe.AliRtcStateNoPublish):this.videoPubState.setState(Oe.AliRtcStateNoPublish)),e.screen&&this.screenPubState.setState(Oe.AliRtcStateNoPublish),t.tracks=this.streamTracks,this.reportSelfDeviceStatus(),t}catch(r){throw ue.fromError(r,pe.ERR_INNER,"publish delete tracks failed")}})}publishStop(){return Q(this,null,function*(){if(!this._isPublishing)throw new ue(pe.ERR_INNER,"publish stop failed, previous localStream is required for publishing stopping");he.info(`[${ni.logName}]`,"publishStop",{url:this.url});const e=new Date().getTime();try{const t=this.hasAudioTrackInMS,r=this.hasCameraTrackInMS,n=this.hasCameraDualTrackInMS,i=this.hasScreenTrackInMS;yield this.rtsManager.publishStop(this.url),t&&this.audioPubState.setState(Oe.AliRtcStateNoPublish),r&&this.videoPubState.setState(Oe.AliRtcStateNoPublish),n&&this.videoSmallPubState.setState(Oe.AliRtcStateNoPublish),i&&this.screenPubState.setState(Oe.AliRtcStateNoPublish),this.traceId="",Object.keys(this.monitorDataCache).forEach(s=>{this.reportPublishMonitor(s)}),this.streamTracks=[];const o={type:In.Stop,userid:this.userId,sessionid:"",displayname:this.displayname,callid:this.callId,pubid:this.publishId,subscribe:{signal:"",pullstreamurl:this.url},tracks:[]};return this.syncPublishToRoomServer(o,{},e),o}catch(t){throw ue.fromError(t,pe.ERR_INNER,"publish stop failed")}})}unPublish(){return Q(this,null,function*(){const e=new Date().getTime();let t={type:In.UnPublish,userid:this.userId,sessionid:"",displayname:this.displayname,callid:this.callId,pubid:this.publishId,subscribe:{signal:"",pullstreamurl:this.url},tracks:[]};try{if(this._isPublishing){const r=this.hasAudioTrackInMS,n=this.hasCameraTrackInMS,i=this.hasCameraDualTrackInMS,o=this.hasScreenTrackInMS;yield this.rtsManager.unpublish(),this.streamTracks=[],this.stopStreamMonitor(),r&&this.audioPubState.setState(Oe.AliRtcStateNoPublish),n&&this.videoPubState.setState(Oe.AliRtcStateNoPublish),i&&this.videoSmallPubState.setState(Oe.AliRtcStateNoPublish),o&&this.screenPubState.setState(Oe.AliRtcStateNoPublish),this._isPublishing=!1,this.traceId="",this.clearStream()}return this.dc&&(this.rtsManager.publishStopDataChannel(this.url,this.dc),this.dataPubState.setState(Oe.AliRtcStateNoPublish),this.dc=void 0),this.slsReporter.reportUnpublish(this.callId||"",e,0,""),t}catch(r){throw ue.fromError(r,pe.ERR_INNER,"unpublish failed")}})}reportSelfDeviceStatus(){this.emit(ir.Local,this.getDeviceStatus())}getDeviceStatus(){var e,t,r,n;let i={micOpen:!1,micInterrupted:!1,cameraOpen:!1,screenShare:!1,audioDisable:!0,videoDisable:!0,screenDisable:!0,backgroundMode:!1,accompanyPlaying:!1};return i.cameraOpen=this.hasCamera,i.micOpen=this.hasMicrophone,i.screenShare=this.hasScreenShare,i.audioDisable=!((e=this.streamManager.cameraStreamInfo.originAudioTrack)!=null&&e.enabled),i.videoDisable=!((t=this.streamManager.cameraStreamInfo.originVideoTrack)!=null&&t.enabled),i.screenDisable=!this.hasScreenShare||!((n=(r=this.streamManager.screenStreamInfo)==null?void 0:r.originVideoTrack)!=null&&n.enabled),qv.getCurrentStatus(i)}resetPreviewElements(){this.previewElements.forEach(e=>{e.srcObject=null,e._playPromise=void 0},[]),this.previewElements=[]}resetSecondayPreviewElements(){this.screenPreviewElements.forEach(e=>{e.srcObject=null,e._playPromise=void 0},[]),this.screenPreviewElements=[]}getMediaStats(e){return this.pcMediaStatsMap[e]}reportPublishMonitor(e){if(!e)return;let t;try{e===se.Audio?t=this.rtsManager.getStreamByMsid({url:this.url,aMsid:e}).audioTrack:t=this.rtsManager.getStreamByMsid({url:this.url,vMsid:e}).videoTrack}catch{}this.slsReporter.reportPublishMonitor(this.callId,this.trackTraceIdMap[e]||"",e,t,this.monitorDataCache[e]),this.monitorDataCache[e]=[]}reportNetwork(){this.slsReporter.reportNetworkMonitor(this.candidateDataCache),this.candidateDataCache=[]}startStreamMonitor(){this.monitorTimerId||(this.monitorTimerId=window.setInterval(()=>Q(this,null,function*(){var e,t;try{const r=yield this.rtsManager.getPCStats();let n;r==null||r.forEach(s=>{s.type==="media-source"||s.type==="media-playout"?s.id&&(this.pcMediaStatsMap[s.id]=s):s.type==="candidate-pair"&&s.state==="succeeded"&&(n=s)});let i;if(((e=this.candidateDataCache)==null?void 0:e.length)>0){const s=this.candidateDataCache[this.candidateDataCache.length-1]||{},{_last:a}=s;i=Jo(s,["_last"])}((t=this.candidateDataCache)==null?void 0:t.length)>=jm&&this.reportNetwork(),n&&(n._last=i,this.candidateDataCache.push(n));let o=Object.keys(this.monitorDataCache).filter(s=>{var a;return((a=this.monitorDataCache[s])==null?void 0:a.length)>0});(this.streamTracks||[]).forEach(s=>{const a=s.msid;if(!a)return;o.includes(a)&&(o=o.filter(u=>u!==a));let c;a===se.Audio?c=this.rtsManager.getPublishAudioStats(this.url):c=this.rtsManager.getPublishVideoStats(this.url,a),c.then(u=>{if(!u.timestamp)return;this.monitorDataCache[a]||(this.monitorDataCache[a]=[]);const d=this.getMediaStats(u.mediaSourceId);u._source=d;const E=this.monitorDataCache[a];let m;if((E==null?void 0:E.length)>0){const f=E[E.length-1]||{},{_last:y}=f;m=Jo(f,["_last"])}(E==null?void 0:E.length)>=jm&&this.reportPublishMonitor(a),u._last=m,u._codec=s.codec||"",this.monitorDataCache[a].push(u)})}),o.forEach(s=>{this.reportPublishMonitor(s)})}catch{}}),1e3))}stopStreamMonitor(){this.monitorTimerId&&(clearInterval(this.monitorTimerId),this.monitorTimerId=void 0),Object.keys(this.monitorDataCache).forEach(e=>{this.reportPublishMonitor(e)})}clearStream(){this.streamManager.stop(),this.audioPubState.setState(Oe.AliRtcStatePublishIdle),this.videoPubState.setState(Oe.AliRtcStatePublishIdle),this.videoSmallPubState.setState(Oe.AliRtcStatePublishIdle),this.screenPubState.setState(Oe.AliRtcStatePublishIdle)}getCurrentCameraDeviceId(){var e;return(e=this.streamManager.cameraStreamInfo.originVideoTrack)==null?void 0:e.getSettings().deviceId}getCurrentMicDeviceId(){var e;return(e=this.streamManager.cameraStreamInfo.originAudioTrack)==null?void 0:e.getSettings().deviceId}enableAudioVolumeIndication(e){this.audioVolumeIndicationInterval!==e&&(this.audioVolumeIndicationInterval>0&&e<=0&&this.audioLevelMonitor.stop(),e>0&&this.streamManager.cameraStreamInfo.originAudioTrack&&this.audioLevelMonitor.start(this.streamManager.cameraStreamInfo.originAudioTrack,e),this.audioVolumeIndicationInterval=e)}sendSEI(e,t,r){return Q(this,null,function*(){if(!this.url)return;let n=0;return!t||t<1?n=1:n=t-1,this.rtsManager.sendSEI(this.url,e,n,r)})}sendDataChannelMessage(e){return Q(this,null,function*(){var t;if(!((t=this.parameter.data)!=null&&t.enablePubDataChannel))throw new ue(pe.ERR_INNER,"data channel publish is not enabled");if(!this.dc)throw new ue(pe.ERR_INNER,"data channel is not ready");const r=e.toBuffer(),n=Db(r,1156);n.forEach((i,o)=>{const s=new wc(new Ss(i.byteLength,o===n.length-1,o===0?1:0),i);this.dc.send(s.toGRTNBuffer())})})}getStats(){return Q(this,null,function*(){const e=[];if(this.hasAudioTrackInMS){const i=yield this.rtsManager.getPublishAudioStats(this.url);i&&e.push({stats:i,track:uo.AliRtcAudioTrackMic})}const t=[];if(this.hasCameraTrackInMS){const i=yield this.rtsManager.getPublishVideoStats(this.url,se.VideoLarge);i&&t.push({track:xe.AliRtcVideoTrackCamera,streamType:Lt.AliRtcVideoStreamTypeHigh,stats:i})}if(this.hasCameraDualTrackInMS){const i=yield this.rtsManager.getPublishVideoStats(this.url,se.VideoSmall);i&&t.push({track:xe.AliRtcVideoTrackCamera,streamType:Lt.AliRtcVideoStreamTypeLow,stats:i})}if(this.hasScreenTrackInMS){const i=yield this.rtsManager.getPublishVideoStats(this.url,se.Screen);i&&t.push({track:xe.AliRtcVideoTrackScreen,stats:i})}let r;const n=yield this.rtsManager.getPCStats();return n==null||n.forEach(i=>{i.type==="candidate-pair"&&i.state==="succeeded"&&(r=i)}),{audio:e,video:t,candidate:r}})}},B(ni,"logName","LocalUser"),ni);mt([ee()],ht.prototype,"clearPublishState",1);mt([ee()],ht.prototype,"clear",1);mt([ee(ge)],ht.prototype,"startDefaultCamera",1);mt([ee(ge)],ht.prototype,"startDefaultAudio",1);mt([ee()],ht.prototype,"setViewConfig",1);mt([ee()],ht.prototype,"startCameraCapture",1);mt([ee()],ht.prototype,"stopCameraCapture",1);mt([ee()],ht.prototype,"startAudioCapture",1);mt([ee()],ht.prototype,"stopAudioCapture",1);mt([ee()],ht.prototype,"stopPreview",1);mt([ee()],ht.prototype,"resumePublish",1);mt([ee()],ht.prototype,"createLocalStream",1);mt([ee()],ht.prototype,"stopLocalStream",1);mt([ee(ge)],ht.prototype,"startPublish",1);mt([ee()],ht.prototype,"updateStreams",1);mt([ee(ge)],ht.prototype,"publishUpdate",1);mt([ee(([e])=>[e])],ht.prototype,"syncPublishToRoomServer",1);mt([ee()],ht.prototype,"refreshPushStreamUrl",1);mt([ee(([e,t,r])=>[JSON.stringify(r)])],ht.prototype,"publishAdd",1);mt([ee(([e,t])=>[JSON.stringify(t)])],ht.prototype,"publishReplace",1);mt([ee(ge)],ht.prototype,"publishDeleteTracks",1);mt([ee()],ht.prototype,"publishStop",1);mt([ee()],ht.prototype,"unPublish",1);mt([ee(([e,t,r])=>[e.length,t,r])],ht.prototype,"sendSEI",1);let Fm=ht;var On=(e=>(e.OPUS="opus",e.H264="H264",e.UNKNOWN="",e))(On||{}),je=(e=>(e[e.NotSubscribe=0]="NotSubscribe",e[e.Subscribing=1]="Subscribing",e[e.Subscribed=2]="Subscribed",e))(je||{}),gi=(e=>(e.VideoTrackEnded="videoTrackEnded",e.AudioTrackEnded="audioTrackEnded",e.ScreenTrackEnded="screenTrackEnded",e))(gi||{});const Lb=e=>{const t=new MediaStream;return t.addTrack(e),t},Zv=e=>Q(void 0,null,function*(){return yield We.AliRTS.createStream({custom:!0,mediaStream:e})}),Ao=e=>Q(void 0,null,function*(){const t=Lb(e);return yield Zv(t)}),xb=e=>{const{audio:t,video:r,screen:n}=e;if(r&&n)throw new ue(pe.ERR_INNER,"create stream error, cannot create video && screen together");return!(!r&&!t&&!n)},Ub=e=>e===se.Audio||e===Fd.Audio,Vb=e=>e===se.VideoLarge||e===Fd.VideoLarge,Bb=e=>e===se.VideoSmall,jb=e=>e===se.Screen,Fb=e=>e===se.Data;var Hb=Object.defineProperty,Wb=Object.getOwnPropertyDescriptor,zb=(e,t,r,n)=>{for(var i=n>1?void 0:n?Wb(t,r):t,o=e.length-1,s;o>=0;o--)(s=e[o])&&(i=(n?s(t,r,i):s(i))||i);return n&&i&&Hb(t,r,i),i};class ec extends Ut{constructor(){super(),B(this,"audioInfo",{subscribeState:je.NotSubscribe,ssrc:"",msid:"",pt:0,red:0,codec:On.UNKNOWN}),B(this,"videoLargeInfo",{subscribeState:je.NotSubscribe,ssrc:"",msid:"",pt:0,red:0,codec:On.UNKNOWN}),B(this,"videoSmallInfo",{subscribeState:je.NotSubscribe,ssrc:"",msid:"",pt:0,red:0,codec:On.UNKNOWN}),B(this,"screenInfo",{subscribeState:je.NotSubscribe,ssrc:"",msid:"",pt:0,red:0,codec:On.UNKNOWN}),B(this,"dataInfo",{subscribeState:je.NotSubscribe,ssrc:"",msid:"",pt:0,red:0,codec:On.UNKNOWN}),B(this,"audioVolume",1),B(this,"audioMuted",!1),B(this,"userStatus")}getAudioInfo(){return this.audioInfo}getVideoSmallInfo(){return this.videoSmallInfo}getVideoLargeInfo(){return this.videoLargeInfo}getScreenInfo(){return this.screenInfo}getDataInfo(){return this.dataInfo}get subscribingInfos(){return[this.audioInfo,this.videoLargeInfo,this.videoSmallInfo,this.screenInfo].filter(t=>t.msid&&t.subscribeState===je.Subscribed)}get hasTrack(){return this.hasAudio||this.hasVideo||this.hasScreen||this.hasData}get hasAudio(){return this.audioInfo.ssrc!==""}get hasVideo(){return this.videoLargeInfo.ssrc!==""||this.videoSmallInfo.ssrc!==""}get hasVideoLarge(){return this.videoLargeInfo.ssrc!==""}get hasVideoSmall(){return this.videoSmallInfo.ssrc!==""}get hasScreen(){return this.screenInfo.ssrc!==""}get hasData(){return this.dataInfo.ssrc!==""}get isAudioSubscribed(){return this.audioInfo.subscribeState===je.Subscribed}get isAudioSubscribing(){return this.audioInfo.subscribeState===je.Subscribing}get isVideoSubscribed(){return this.isVideoLargeSubscribed||this.isVideoSmallSubscribed}get isVideoSubscribing(){return this.isVideoLargeSubscribing||this.isVideoSmallSubscribing}get isVideoLargeSubscribed(){return this.videoLargeInfo.subscribeState===je.Subscribed}get isVideoLargeSubscribing(){return this.videoLargeInfo.subscribeState===je.Subscribing}get isVideoSmallSubscribed(){return this.videoSmallInfo.subscribeState===je.Subscribed}get isVideoSmallSubscribing(){return this.videoSmallInfo.subscribeState===je.Subscribing}get isScreenSubscribed(){return this.screenInfo.subscribeState===je.Subscribed}get isScreenSubscribing(){return this.screenInfo.subscribeState===je.Subscribing}get isDataSubscribed(){return this.dataInfo.subscribeState===je.Subscribed}get isDataSubscribing(){return this.dataInfo.subscribeState===je.Subscribing}get audioCodec(){return this.audioInfo.codec}get videoCodec(){return this.hasVideoLarge?this.videoLargeInfo.codec:this.hasVideoSmall?this.videoSmallInfo.codec:this.hasScreen?this.screenInfo.codec:On.UNKNOWN}get audioTrackInfo(){return this.hasAudio?uo.AliRtcAudioTrackMic:uo.AliRtcAudioTrackNo}get videoTrackInfo(){return this.hasVideo&&this.hasScreen?xe.AliRtcVideoTrackBoth:this.hasVideo?xe.AliRtcVideoTrackCamera:this.hasScreen?xe.AliRtcVideoTrackScreen:xe.AliRtcVideoTrackNo}updateTracks(t){let r="",n="",i="",o="",s="";return t?(t.forEach(a=>{var c;let u=On.UNKNOWN;const d=((c=a==null?void 0:a.attr)==null?void 0:c.reason)==="reconnect";if(a.userdata){const{codec:E}=JSON.parse(a.userdata);E&&(u=E)}Ub(a.msid)?(r=a.ssrc,this.audioInfo.msid=a.msid,this.audioInfo.codec=u,(d||this.audioInfo.ssrc!==r)&&(this.audioInfo.subscribeState=je.NotSubscribe)):Bb(a.msid)?(i=a.ssrc,this.videoSmallInfo.msid=a.msid,this.videoSmallInfo.codec=u,(d||this.videoSmallInfo.ssrc!==i)&&(this.videoSmallInfo.subscribeState=je.NotSubscribe)):Vb(a.msid)?(n=a.ssrc,this.videoLargeInfo.msid=a.msid,this.videoLargeInfo.codec=u,(d||this.videoLargeInfo.ssrc!==n)&&(this.videoLargeInfo.subscribeState=je.NotSubscribe)):jb(a.msid)?(o=a.ssrc,this.screenInfo.msid=a.msid,this.screenInfo.codec=u,(d||this.screenInfo.ssrc!==o)&&(this.screenInfo.subscribeState=je.NotSubscribe)):Fb(a.msid)&&(s=a.ssrc,this.dataInfo.msid=a.msid,this.dataInfo.codec=u,(d||this.dataInfo.ssrc!==s)&&(this.dataInfo.subscribeState=je.NotSubscribe))}),this.updateRemoteTrackSsrc(r,n,i,o,s)):this.updateRemoteTrackSsrc(r,n,i,o,s),{}}updateRemoteTrackSsrc(t,r,n,i,o){this.audioInfo.ssrc=t,this.videoSmallInfo.ssrc=n,this.videoLargeInfo.ssrc=r,this.screenInfo.ssrc=i,this.dataInfo.ssrc=o}markRemoteTrackSubscribing(t){return t.video&&(t.vMsid===this.videoSmallInfo.msid&&(this.videoSmallInfo.subscribeState=je.Subscribing),(t.vMsid===this.videoLargeInfo.msid||!t.vMsid)&&(this.videoLargeInfo.subscribeState=je.Subscribing)),t.screen&&(this.screenInfo.subscribeState=je.Subscribing),t.audio&&(this.audioInfo.subscribeState=je.Subscribing),t.data&&(this.dataInfo.subscribeState=je.Subscribing),{videoLargeInfo:this.videoLargeInfo,videoSmallInfo:this.videoSmallInfo}}updateRemoteTrackSubState(t){return t.video!==void 0&&((t.vMsid===this.videoSmallInfo.msid||!t.vMsid)&&(this.videoSmallInfo.subscribeState=t.video?je.Subscribed:je.NotSubscribe),(t.vMsid===this.videoLargeInfo.msid||!t.vMsid)&&(this.videoLargeInfo.subscribeState=t.video?je.Subscribed:je.NotSubscribe)),t.screen!==void 0&&(this.screenInfo.subscribeState=t.screen?je.Subscribed:je.NotSubscribe),t.audio!==void 0&&(this.audioInfo.subscribeState=t.audio?je.Subscribed:je.NotSubscribe),t.data!==void 0&&(this.dataInfo.subscribeState=t.data?je.Subscribed:je.NotSubscribe),{audioInfo:this.audioInfo,videoLargeInfo:this.videoLargeInfo,videoSmallInfo:this.videoSmallInfo,screenInfo:this.screenInfo,dataInfo:this.dataInfo}}updateRemoteUserDeviceStatus(t){let r=qv.parseStatus(t);const{audioDisable:n,videoDisable:i,screenDisable:o}=r;return this.userStatus?(this.userStatus.audioDisable!=n&&(this.userStatus.audioDisable=n,this.emit(ir.Remote,n?Ye.MuteAudio:Ye.UnmuteAudio)),this.userStatus.videoDisable!=i&&(this.userStatus.videoDisable=i,this.emit(ir.Remote,i?Ye.MuteVideo:Ye.UnmuteVideo)),this.userStatus.screenDisable!=o&&(this.userStatus.screenDisable=o,this.emit(ir.Remote,o?Ye.MuteScreen:Ye.UnmuteScreen))):(this.userStatus=r,this.emit(ir.Remote,n?Ye.MuteAudio:Ye.UnmuteAudio),this.emit(ir.Remote,i?Ye.MuteVideo:Ye.UnmuteVideo),this.emit(ir.Remote,o?Ye.MuteScreen:Ye.UnmuteScreen)),!1}}B(ec,"logName","RemoteStreamInfo");zb([ee()],ec.prototype,"updateRemoteTrackSubState",1);class e1{constructor(t){B(this,"remoteUser"),this.remoteUser=t}get userId(){return this.remoteUser.userId}get displayName(){return this.remoteUser.displayname}get isMuteAudioPlaying(){return this.remoteUser.getAudioMuted()}get hasAudio(){return this.remoteUser.hasAudioTrack}get hasCamera(){return this.remoteUser.hasVideoTrack}get hasCameraLarge(){return this.remoteUser.hasVideoLargeTrack}get hasCameraSmall(){return this.remoteUser.hasVideoSmallTrack}get hasScreenShare(){return this.remoteUser.hasScreenTrack}get isAudioSubscribing(){return this.remoteUser.isAudioSubscribing}get isVideoSubscribing(){return this.remoteUser.isVideoSubscribing}get isVideoLargeSubscribing(){return this.remoteUser.isVideoLargeSubscribing}get isVideoSmallSubscribing(){return this.remoteUser.isVideoSmallSubscribing}get isScreenSubscribing(){return this.remoteUser.isScreenSubscribing}get audioElement(){return this.remoteUser.getAudioElement()}}var $b=Object.defineProperty,Kb=Object.getOwnPropertyDescriptor,Gt=(e,t,r,n)=>{for(var i=n>1?void 0:n?Kb(t,r):t,o=e.length-1,s;o>=0;o--)(s=e[o])&&(i=(n?s(t,r,i):s(i))||i);return n&&i&&$b(t,r,i),i};class Di extends Ut{constructor(){super(),B(this,"state"),B(this,"time"),B(this,"_enabled"),this.state=qe.AliRtcStateSubscribeIdle,this.time=Date.now(),this._enabled=!0}setState(t){if(this.state===t)return;const r=this.state,n=this.time;this.state=t,this.time=Date.now(),this.emit("change",r,t,Math.floor((this.time-n)/1e3))}get currentState(){return this.state}getEnabled(){return this._enabled}setEnabled(t){this._enabled=t}}const Gb=30;var Rr;const Bt=(Rr=class extends Jv{constructor(e){var t;const{userId:r,displayName:n,rtsManager:i,usersViewMap:o,slsReporter:s,signalingManager:a,localUser:c,audioVolumeIndicationInterval:u,playoutVolume:d,parameter:E}=e;super(r,n,i,u),B(this,"remoteCallid",""),B(this,"remoteUserInfo"),B(this,"localUser"),B(this,"lastPubId",""),B(this,"stream"),B(this,"screenStream"),B(this,"viewMap"),B(this,"audioTrack"),B(this,"audioElement"),B(this,"subscribed",!1),B(this,"mediaStream"),B(this,"secondaryMediaStream"),B(this,"prevSubConfig"),B(this,"signalingManager"),B(this,"slsReporter"),B(this,"wantSubAudio",!1),B(this,"wantSubVideo",!1),B(this,"wantSubScreen",!1),B(this,"defaultVideoStreamType",Lt.AliRtcVideoStreamTypeHigh),B(this,"audioMuted",!1),B(this,"playoutVolume",1),B(this,"playoutGainNode"),B(this,"audioSubState"),B(this,"videoSubState"),B(this,"videoLargeSubState",new Di),B(this,"videoSmallSubState",new Di),B(this,"screenSubState"),B(this,"dataSubState"),B(this,"dc"),B(this,"dcMsgWaitingPieces",[]),B(this,"streamInfo"),B(this,"streamUrl",""),B(this,"parameter",{}),B(this,"monitorTimerId"),B(this,"monitorDataCache",{}),B(this,"trackTraceIdMap",{}),B(this,"handleAudioContextSuspended",m=>{m.target.state==="suspended"&&this.emit("remoteAudioPlayError",this.uid,"AudioContext suspended")}),B(this,"onDataChannelMessage",m=>{var f;const y=wc.parse(m.slice(4));let S;if(y.body)if(y.isFin){if(this.dcMsgWaitingPieces.length>0){const l=this.dcMsgWaitingPieces.reduce((h,p)=>h+p.byteLength,y.body.byteLength);try{const h=new ArrayBuffer(l);let p=0;for(let v=0;v<this.dcMsgWaitingPieces.length;v++){const g=this.dcMsgWaitingPieces[v];new Uint8Array(h,p,g.byteLength).set(new Uint8Array(g)),p+=g.byteLength}new Uint8Array(h,p,y.body.byteLength).set(new Uint8Array(y.body)),S=Jn.parse(h)}catch{}this.dcMsgWaitingPieces=[],S||(S=Jn.parse(y.body))}else S=Jn.parse(y.body);S||he.event(`[${Rr.logName}]`,`parse data channel message fail, piece count: ${this.dcMsgWaitingPieces.length+1}`)}else{y.header.frameType===1&&(this.dcMsgWaitingPieces=[]),this.dcMsgWaitingPieces.push(y.body);return}S&&(he.event(`[${Rr.logName}]`,`receive data channel message, length: ${(f=S.data)==null?void 0:f.byteLength}`),this.emit("remoteDataChannelMessage",this.uid,S))}),B(this,"onDataChannelError",m=>{this.emit("occurError",ue.fromError(m,pe.ERR_SDK_SUBSCRIBE_DATA_ERROR))}),B(this,"handleAudioPaused",()=>{this.emit("remoteAudioPlayError",this.uid,"paused")}),this.streamInfo=new ec,this.remoteUserInfo=new e1(this),this.parameter=E,this.streamInfo.on(ir.Remote,m=>{this.emit(ir.Remote,m,this.userId)}),this.signalingManager=a,this.viewMap=(t=o[r])!=null?t:{cameraViews:[],screenViews:[]},o[r]=this.viewMap,this.slsReporter=s,this.localUser=c,this.audioSubState=new Di,this.audioSubState.on("change",(m,f,y)=>{this.emit("audioSubscribeStateChanged",this.uid,m,f,y)}),this.videoSubState=new Di,this.videoSubState.on("change",(m,f,y)=>{this.emit("videoSubscribeStateChanged",this.uid,m,f,y)}),this.screenSubState=new Di,this.screenSubState.on("change",(m,f,y)=>{this.emit("screenSubscribeStateChanged",this.uid,m,f,y)}),this.dataSubState=new Di,this.dataSubState.on("change",(m,f,y)=>{this.emit("dataSubscribeStateChanged",this.uid,m,f,y)}),this.playoutVolume=d}isWantSubAudio(){return this.wantSubAudio}setWantSubAudio(e){this.wantSubAudio=e}isWantSubVideo(){return this.wantSubVideo}setWantSubVideo(e){this.wantSubVideo=e}isWantSubScreen(){return this.wantSubScreen}setWantSubScreen(e){this.wantSubScreen=e}setRemoteDefaultVideoStreamType(e){e!==this.defaultVideoStreamType&&(this.defaultVideoStreamType=e,this.updateSubscribe(tt.User))}setAudioMuted(e){this.audioMuted=e,this.toggleAudio(!e)}getAudioElement(){return this.audioElement}setPlayoutVolume(e){if(this.playoutVolume=e,this.audioElement)if(this.parameter.enableAudioContextPlayoutVolume)if(this.playoutGainNode)this.playoutGainNode.gain.value=e;else{const t=this.audioElement.srcObject;if(t){const r=fa.getInstance();r.addEventListener("statechange",this.handleAudioContextSuspended);const n=r.createMediaStreamSource(t);this.audioElement.muted=!0,this.playoutGainNode=r.createGain(),n.connect(this.playoutGainNode),this.playoutGainNode.gain.value=e,this.playoutGainNode.connect(r.destination)}}else this.audioElement.volume=e}getAudioMuted(){return this.audioMuted}get hasAudioTrack(){var e;return!!((e=this.streamInfo)!=null&&e.hasAudio)}get hasVideoTrack(){var e;return!!((e=this.streamInfo)!=null&&e.hasVideo)}get hasVideoLargeTrack(){var e;return!!((e=this.streamInfo)!=null&&e.hasVideoLarge)}get hasVideoSmallTrack(){var e;return!!((e=this.streamInfo)!=null&&e.hasVideoSmall)}get hasScreenTrack(){var e;return!!((e=this.streamInfo)!=null&&e.hasScreen)}get isAudioSubscribing(){var e,t;return!!((e=this.streamInfo)!=null&&e.isAudioSubscribed)||!!((t=this.streamInfo)!=null&&t.isAudioSubscribing)}get isVideoSubscribing(){var e,t;return!!((e=this.streamInfo)!=null&&e.isVideoSubscribed)||!!((t=this.streamInfo)!=null&&t.isVideoSubscribing)}get isVideoLargeSubscribing(){var e,t;return!!((e=this.streamInfo)!=null&&e.isVideoLargeSubscribed)||!!((t=this.streamInfo)!=null&&t.isVideoLargeSubscribing)}get isVideoSmallSubscribing(){var e,t;return!!((e=this.streamInfo)!=null&&e.isVideoSmallSubscribed)||!!((t=this.streamInfo)!=null&&t.isVideoSmallSubscribing)}get isScreenSubscribing(){var e,t;return!!((e=this.streamInfo)!=null&&e.isScreenSubscribed)||!!((t=this.streamInfo)!=null&&t.isScreenSubscribing)}get isDataSubscribing(){var e,t;return!!((e=this.streamInfo)!=null&&e.isDataSubscribed)||!!((t=this.streamInfo)!=null&&t.isDataSubscribing)}get audioEnabled(){var e,t;return!!((t=(e=this.stream)==null?void 0:e.audioTrack)!=null&&t.enabled)}get videoEnabled(){var e,t;return!!((t=(e=this.stream)==null?void 0:e.videoTrack)!=null&&t.enabled)}get screenEnabled(){var e,t;return!!((t=(e=this.screenStream)==null?void 0:e.videoTrack)!=null&&t.enabled)}get getAudioTrack(){return this.audioTrack}get getCameraStream(){return this.stream}get getScreenStream(){return this.screenStream}setViewConfig(e,t){if(t!==xe.AliRtcVideoTrackScreen&&t!==xe.AliRtcVideoTrackCamera)throw new ue(pe.ERR_INVALID_ARGUMENTS,"track is not AliRtcVideoTrackScreen or AliRtcVideoTrackCamera");e?Pl(e).forEach(r=>{r.setAttribute("playsinline",""),We.AliRTS.BrowserUtil.isMicroMessenger&&(r.setAttribute("x5-video-player-type","h5-page"),r.setAttribute("x5-playsinline",""),We.AliRTS.SystenUtil.isAndroid||We.AliRTS.SystenUtil.isIos&&r.setAttribute("x-webkit-airplay","allow")),t===xe.AliRtcVideoTrackScreen?this.viewMap.screenViews.push(r):this.viewMap.cameraViews.push(r),this.play(r,t===xe.AliRtcVideoTrackScreen)}):(this.stopPlayAll(t===xe.AliRtcVideoTrackScreen),t===xe.AliRtcVideoTrackScreen?this.viewMap.screenViews=[]:this.viewMap.cameraViews=[])}clear(e=!0){return Q(this,null,function*(){var t;this.subscribeStopDataChannel(),e&&this.doStopSubscribe(this.streamUrl),Lv(Rr.prototype,this,"clear").call(this),this.stopPlayAudio(),this.clearStream(),this.clearScreenStream(),this.playoutGainNode&&(this.playoutGainNode.disconnect(),this.playoutGainNode=void 0,fa.getInstance().removeEventListener("statechange",this.handleAudioContextSuspended)),(t=this.streamInfo)==null||t.removeAllListeners(ir.Remote)})}updateRemoteUserDeviceStatus(e){var t;(t=this.streamInfo)==null||t.updateRemoteUserDeviceStatus(e)}updateRemoteTracks(e,t,r,n){return Q(this,null,function*(){var i;return this.remoteCallid=e,(!this.streamUrl||!this.streamInfo.hasTrack)&&(this.streamUrl=t??""),this.callId=e??"",this.streamInfo||(this.streamInfo=new ec),(i=this.streamInfo)==null?void 0:i.updateTracks(n)})}subscribe(e,t){return Q(this,arguments,function*(r,n,i=Date.now()){var o,s;let a=r;if(!a){const{hasAudio:f,hasVideo:y,hasScreen:S,hasData:l}=(o=this.streamInfo)!=null?o:{};a={audio:this.wantSubAudio&&f,video:this.wantSubVideo&&y,screen:this.wantSubScreen&&S,data:((s=this.parameter.data)==null?void 0:s.enableSubDataChannel)&&l}}this.streamInfo.markRemoteTrackSubscribing(a);const{screen:c,audio:u,video:d,vMsid:E}=a,m=[];(d||u)&&m.push({audio:u,video:d,vMsid:E}),c&&m.push({screen:c}),!(m.length===0&&!(r!=null&&r.data))&&(yield Promise.all(m.map(f=>this.subscribeProxy(f,n||tt.User,i))),r!=null&&r.data&&this.subscribeDataChannel())})}subscribeProxy(e,t,r){return Q(this,null,function*(){var n,i,o,s;let a=new Date().getTime(),c="";try{e.audio&&this.audioSubState.setState(qe.AliRtcStateSubscribing),e.video&&(this.videoSubState.currentState===qe.AliRtcStateSubscribeIdle||this.videoSubState.currentState===qe.AliRtcStateNoSubscribe)&&this.videoSubState.setState(qe.AliRtcStateSubscribing),e.screen&&this.screenSubState.setState(qe.AliRtcStateSubscribing);const u=yield this.rtsManager.subscribe({remoteUser:this,options:e},t,((n=this.localUser)==null?void 0:n.callId)||"",this.callId,r);this.streamInfo.updateRemoteTrackSubState(e),c=u.traceId||"";const{stream:d}=u;if(e.audio){this.trackTraceIdMap[se.Audio]=c;const m=d.audioTrack;m&&(this.audioTrack=m,(i=d.mediaStream)==null||i.removeTrack(m),this.playAudio(),this.audioVolumeIndicationInterval&&this.audioLevelMonitor.start(m,this.audioVolumeIndicationInterval)),this.audioSubState.setState(qe.AliRtcStateSubscribed),this.audioSubState.getEnabled()||this.toggleAudio(!1)}e.video&&(this.videoSubState.setState(qe.AliRtcStateSubscribed),e.vMsid===se.VideoSmall?(this.trackTraceIdMap[se.VideoSmall]=c,this.videoSmallSubState.setState(qe.AliRtcStateSubscribed)):(this.trackTraceIdMap[se.VideoLarge]=c,this.videoLargeSubState.setState(qe.AliRtcStateSubscribed)),this.videoSubState.getEnabled()||this.toggleVideo(!1),this.updateStream(d,this.isVideoLargeSubscribing&&this.isVideoSmallSubscribing)),e.screen&&(this.screenSubState.setState(qe.AliRtcStateSubscribed),this.trackTraceIdMap[se.Screen]=c,this.videoSubState.getEnabled()||this.toggleScreen(!1),this.updateScreenStream(d));const E=new Date().getTime()-a;this.slsReporter.reportSubscribe(((o=this.localUser)==null?void 0:o.callId)||"",this.callId,!!e.video&&e.vMsid===se.VideoLarge,!!e.video&&e.vMsid===se.VideoSmall,!!e.screen,!!e.audio,0,"",E,{pctid:this.rtsManager.pcTraceId,subtid:c,ajsub:t===tt.Join?1:0,url:this.streamUrl,est:a}),this.startStreamMonitor()}catch(u){const d=new Date().getTime()-a;e.audio&&this.audioSubState.setState(qe.AliRtcStateNoSubscribe),e.video&&this.videoSubState.setState(qe.AliRtcStateNoSubscribe),e.screen&&this.screenSubState.setState(qe.AliRtcStateNoSubscribe),u&&(u.message=`user(${this.uid}) subscribe error, ${(u==null?void 0:u.message)||""}`);let E=pe.ERR_INNER;e.audio&&(E=pe.ERR_SDK_SUBSCRIBE_AUDIO_STREAM_FAILED),e.video&&(e.vMsid===se.VideoSmall?E=pe.ERR_SDK_SUBSCRIBE_DUAL_STREAM_FAILED:E=pe.ERR_SDK_SUBSCRIBE_VIDEO_STREAM_FAILED),e.screen&&(E=pe.ERR_SDK_SUBSCRIBE_SCREEN_SHARE_FAILED),this.slsReporter.reportSubscribe(((s=this.localUser)==null?void 0:s.callId)||"",this.callId,!!e.video&&e.vMsid===se.VideoLarge,!!e.video&&e.vMsid===se.VideoSmall,!!e.screen,!!e.audio,E,"",d,{pctid:this.rtsManager.pcTraceId,subtid:"",ajsub:t===tt.Join?1:0,url:this.streamUrl,est:a});const m=ue.fromError(u,E);throw this.emit("remoteSubscribeError",m),m}})}subscribeDeleteTracks(e){return Q(this,null,function*(){const{audio:t,video:r,screen:n,data:i,vMsid:o}=e,s=[];(t||r||i)&&s.push({audio:t,video:r,vMsid:o}),n&&s.push({screen:n}),s.length!==0&&(yield Promise.all(s.map(a=>this.subscribeDeleteProxy(a))),e.data&&this.subscribeStopDataChannel())})}subscribeDeleteProxy(e){return Q(this,null,function*(){try{const t=yield this.rtsManager.subscibeDelete({remoteUser:this,options:e}),{stream:r}=t??{},n={};e.audio===!0&&(n.audio=!1,this.audioSubState.setState(qe.AliRtcStateNoSubscribe)),e.video===!0&&(n.video=!1,e.vMsid===se.VideoSmall?(this.videoSmallSubState.setState(qe.AliRtcStateNoSubscribe),(this.videoLargeSubState.currentState===qe.AliRtcStateNoSubscribe||this.videoLargeSubState.currentState===qe.AliRtcStateSubscribeIdle)&&this.videoSubState.setState(qe.AliRtcStateNoSubscribe)):(this.videoLargeSubState.setState(qe.AliRtcStateNoSubscribe),(this.videoSmallSubState.currentState===qe.AliRtcStateNoSubscribe||this.videoSmallSubState.currentState===qe.AliRtcStateSubscribeIdle)&&this.videoSubState.setState(qe.AliRtcStateNoSubscribe))),e.screen===!0&&(n.screen=!1,this.screenSubState.setState(qe.AliRtcStateNoSubscribe));const{callId:i,remoteCallid:o}=this,s={callid:i,remoteCallid:o,remoteStream:r};return e.audio&&(this.audioLevelMonitor.stop(),this.stopPlayAudio(),this.audioTrack=void 0),this.streamInfo.updateRemoteTrackSubState({audio:e.audio===!0?!1:void 0,video:e.video===!0?!1:void 0,screen:e.screen===!0?!1:void 0,vMsid:e.vMsid}),s}catch(t){throw ue.fromError(t,pe.ERR_INNER,"subscribe delete failed")}})}restore(){this.callId="",this.clearStream(),this.clearScreenStream(),this.audioTrack=void 0,this.streamInfo.updateRemoteTrackSubState({audio:!1,video:!1,screen:!1,data:!1}),this.audioElement&&this.audioElement.removeEventListener("pause",this.handleAudioPaused)}resumeAudio(){return Q(this,null,function*(){const e=fa.getInstance();return e.state!=="running"&&e.resume(),this.audioElement?this.audioElement.play():this.playAudio()})}resumeVideo(e){return Q(this,null,function*(){if(!e||e===xe.AliRtcVideoTrackCamera||e===xe.AliRtcVideoTrackBoth)return this.playAll();if(!e||e===xe.AliRtcVideoTrackScreen||e===xe.AliRtcVideoTrackBoth)return this.playAll(!0)})}resumePlay(){this.playAudio(),this.playAll(),this.playAll(!0)}stopSubscribe(e){return Q(this,null,function*(){var t,r;let n=new Date().getTime();try{let i;e?i=yield this.subscribeDeleteTracks(e):i=yield this.doStopSubscribe(this.streamUrl),this.slsReporter.reportUnsubscribe(((t=this.localUser)==null?void 0:t.callId)||(i==null?void 0:i.callid)||"",this.callId,new Date().getTime()-n,0,"")}catch(i){throw this.slsReporter.reportUnsubscribe(((r=this.localUser)==null?void 0:r.callId)||"",this.callId,new Date().getTime()-n,0,""),i}})}doStopSubscribe(e){return Q(this,null,function*(){var t,r,n,i;const{callId:o,remoteCallid:s}=this;if((this.isAudioSubscribing||this.isVideoSubscribing||this.isScreenSubscribing)&&e)try{this.stopStreamMonitor(),yield this.rtsManager.subscibeStop(e),this.restore();const a={callid:o,remoteCallid:s,remoteStream:this.stream};return this.callId="",a}catch(a){if(((i=(n=(r=(t=a==null?void 0:a.extraInfo)==null?void 0:t.parsedData)==null?void 0:r.streams)==null?void 0:n[0])==null?void 0:i.res_code)!==404)throw ue.fromError(a,pe.ERR_INNER,"subscribe stop failed")}})}updateStream(e,t=!1){return Q(this,null,function*(){this.stream&&this.stream.videoTrack&&e.mediaStream&&t&&(yield new Promise(r=>{let n,i;if(e.mediaStream){i=document.createElement("video");const o=()=>{he.event(`uid: ${this.userId} new mediaStream canplay`),i&&i.removeEventListener("canplaythrough",o,!1),i=void 0,clearTimeout(n),r(!0)};i.addEventListener("canplaythrough",o,!1),(i._playPromise||Promise.resolve()).then(()=>{i&&e.mediaStream&&(i.srcObject=e.mediaStream)})}else r(!0);n=window.setTimeout(()=>{he.event(`uid: ${this.userId} new mediaStream timeout`),i=void 0,r(!0)},3e3)}),this.updateSubscribe(tt.User)),this.stream=e,this.playAll(!1,t),!this.subscribed&&e&&(this.subscribed=!0),e.hasAudio&&this.isAudioSubscribing&&e.enableAudio(),e.hasVideo&&this.isVideoSubscribing&&e.enableVideo()})}updateScreenStream(e){this.screenStream=e,this.playAll(!0),!this.subscribed&&e&&(this.subscribed=!0),e.hasVideo&&this.isScreenSubscribing&&e.enableVideo()}clearStream(){var e;(e=this.stream)==null||e.stop(),this.stream=void 0}clearScreenStream(){var e;(e=this.screenStream)==null||e.stop(),this.screenStream=void 0}subscribeDataChannel(){if(this.dc)try{this.dc.dispose(),this.dcMsgWaitingPieces=[],this.dc.off("message",this.onDataChannelMessage),this.dc=void 0}catch{}!this.streamInfo.hasAudio&&!this.streamInfo.hasVideo&&!this.streamInfo.hasScreen||(this.dataSubState.setState(qe.AliRtcStateSubscribing),this.rtsManager.subscribeAddDataChannel(this.streamUrl).then(e=>{if(e){this.dc=e,this.dc.datachannel&&(this.dc.datachannel.binaryType="arraybuffer"),this.dc.on("message",this.onDataChannelMessage),this.dc.on("error",this.onDataChannelError),this.dataSubState.setState(qe.AliRtcStateSubscribed),this.streamInfo.updateRemoteTrackSubState({data:!0});return}else throw new Error("no dc founded")}).catch(e=>{const t=ue.fromError(e,pe.ERR_INNER,"subscribe data failed");this.emit("remoteSubscribeError",t),this.dataSubState.setState(qe.AliRtcStateNoSubscribe)}))}subscribeStopDataChannel(){if(this.dc){try{this.rtsManager.subscribeStopDatachannel(this.streamUrl,this.dc)}catch{}this.dcMsgWaitingPieces=[],this.dc.off("message",this.onDataChannelMessage),this.dc.off("error",this.onDataChannelError),this.dataSubState.setState(qe.AliRtcStateNoSubscribe),this.dc=void 0,this.streamInfo.updateRemoteTrackSubState({data:!1})}}getRetryOptions(){var e,t,r,n,i,o,s;const a={};this.wantSubAudio&&(e=this.streamInfo)!=null&&e.hasAudio&&(a.audio=!0,a.aMsid=((t=this.streamInfo.getAudioInfo())==null?void 0:t.msid)||se.Audio),this.wantSubVideo&&(r=this.streamInfo)!=null&&r.hasVideo&&(this.defaultVideoStreamType===Lt.AliRtcVideoStreamTypeLow&&(n=this.streamInfo)!=null&&n.hasVideoSmall?(a.video=!0,a.vMsid=se.VideoSmall):(i=this.streamInfo)!=null&&i.hasVideoLarge&&(a.video=!0,a.vMsid=((o=this.streamInfo.getVideoLargeInfo())==null?void 0:o.msid)||se.VideoLarge)),this.wantSubScreen&&(s=this.streamInfo)!=null&&s.hasScreen&&(a.screen=!0);let c={};if(a.audio||a.video)c={audio:a.audio,video:a.video},this.streamInfo.updateRemoteTrackSubState({screen:!1,data:!1});else if(a.screen)c={screen:a.screen},this.streamInfo.updateRemoteTrackSubState({data:!1});else return;return{remoteUser:this,options:c}}updateSubscribe(e){var t,r,n,i,o,s,a,c,u,d,E,m,f,y,S,l,h;const p=Date.now(),v={},g={};if(this.wantSubAudio&&!this.isAudioSubscribing&&(t=this.streamInfo)!=null&&t.hasAudio?(v.audio=!0,v.aMsid=((r=this.streamInfo.getAudioInfo())==null?void 0:r.msid)||se.Audio):(!this.wantSubAudio||!((n=this.streamInfo)!=null&&n.hasAudio))&&this.isAudioSubscribing&&(g.audio=!0,g.aMsid=((i=this.streamInfo.getAudioInfo())==null?void 0:i.msid)||se.Audio),this.wantSubVideo&&(o=this.streamInfo)!=null&&o.hasVideo?(this.defaultVideoStreamType===Lt.AliRtcVideoStreamTypeLow&&!this.isVideoSmallSubscribing&&(s=this.streamInfo)!=null&&s.hasVideoSmall?(v.video=!0,v.vMsid=se.VideoSmall):!this.isVideoLargeSubscribing&&(a=this.streamInfo)!=null&&a.hasVideoLarge&&!(this.defaultVideoStreamType===Lt.AliRtcVideoStreamTypeLow&&this.isVideoSmallSubscribing)&&(v.video=!0,v.vMsid=((c=this.streamInfo.getVideoLargeInfo())==null?void 0:c.msid)||se.VideoLarge),this.defaultVideoStreamType===Lt.AliRtcVideoStreamTypeLow&&this.isVideoLargeSubscribing&&this.isVideoSmallSubscribing&&this.streamInfo.hasVideoSmall?(g.video=!0,g.vMsid=se.VideoLarge):this.defaultVideoStreamType===Lt.AliRtcVideoStreamTypeHigh&&this.isVideoLargeSubscribing&&this.isVideoSmallSubscribing&&(g.video=!0,g.vMsid=se.VideoSmall)):(!this.wantSubVideo||!((u=this.streamInfo)!=null&&u.hasVideo))&&this.isVideoSubscribing&&(g.video=!0,g.vMsid=this.streamInfo.isVideoSmallSubscribed||this.streamInfo.isVideoSmallSubscribing?se.VideoSmall:((d=this.streamInfo.getVideoLargeInfo())==null?void 0:d.msid)||se.VideoLarge),this.wantSubScreen&&!this.isScreenSubscribing&&(E=this.streamInfo)!=null&&E.hasScreen?v.screen=!0:(!this.wantSubScreen||!((m=this.streamInfo)!=null&&m.hasScreen))&&this.isScreenSubscribing&&(g.screen=!0),(f=this.parameter.data)!=null&&f.enableSubDataChannel&&!this.isDataSubscribing&&(y=this.streamInfo)!=null&&y.hasData?v.data=!0:(!((S=this.parameter.data)!=null&&S.enableSubDataChannel)||!((l=this.streamInfo)!=null&&l.hasData))&&this.isDataSubscribing&&(g.data=!0),(v.audio||v.video||v.screen||v.data)&&(this.createCallId(),this.subscribe(v,e,p)),(g.audio||g.video||g.screen)&&this.subscribeDeleteTracks(g),e===tt.Reconnect){if(he.event(`[${Rr.logName}]`,"reconnect, try to resume"),this.streamInfo.hasAudio&&!v.audio){const R=this.rtsManager.getStreamByMsid({url:this.streamUrl,aMsid:this.streamInfo.getAudioInfo().msid||se.Audio}).audioTrack;R&&(this.audioTrack=R,this.playAudio())}if(this.streamInfo.hasVideo&&!v.video){const R=this.rtsManager.getStreamByMsid({url:this.streamUrl,vMsid:this.streamInfo.isVideoSmallSubscribed||this.streamInfo.isVideoSmallSubscribing?se.VideoSmall:((h=this.streamInfo.getVideoLargeInfo())==null?void 0:h.msid)||se.VideoLarge});R&&R.mediaStream&&(this.stream=R,this.playAll(!1))}if(this.streamInfo.hasScreen&&!v.screen){const R=this.rtsManager.getStreamByMsid({url:this.streamUrl,sMsid:this.streamInfo.getScreenInfo().msid||se.Screen});R&&R.mediaStream&&(this.screenStream=R,this.playAll(!0))}}return{addOption:v,deleteOption:g}}handleAutoPlayFailed(){he.event(`[${Rr.logName}]`,"auto play failed"),this.emit("remoteAudioAutoPlayFail",this.uid);const e=()=>{this.resumeAudio().then(()=>{document.removeEventListener("click",e,!1),document.removeEventListener("touchstart",e,!1)})};document.addEventListener("click",e,!1),document.addEventListener("touchstart",e,!1)}handleVideoPlayFailded(e,t){this.emit("remoteVideoAutoPlayFail",this.uid,t);const r=()=>{var n;const i=(n=t===xe.AliRtcVideoTrackScreen?this.screenStream:this.stream)==null?void 0:n.mediaStream;e.srcObject===i&&this.play(e,t===xe.AliRtcVideoTrackScreen),document.removeEventListener("click",r,!1),document.removeEventListener("touchstart",r,!1)};document.addEventListener("click",r,!1),document.addEventListener("touchstart",r,!1)}playAudio(){return Q(this,null,function*(){var e,t;if(!this.audioTrack){he.event(`[${Rr.logName}]`,this.userId,"audio track is null");return}if(this.toggleAudio(!this.audioMuted),this.audioElement||(he.event(`[${Rr.logName}]`,this.userId,"create audio element"),this.audioElement=document.createElement("audio"),this.audioElement.setAttribute("autoplay","autoplay"),this.audioElement.addEventListener("pause",this.handleAudioPaused),this.setPlayoutVolume(this.playoutVolume)),((t=(e=this.audioElement.srcObject)==null?void 0:e.getAudioTracks())==null?void 0:t[0])!==this.audioTrack){let r=this.audioElement.srcObject;r?r.getAudioTracks().forEach(n=>{r.removeTrack(n)}):(r=new MediaStream,this.audioElement.srcObject=r),r.addTrack(this.audioTrack)}if(We.AliRTS.SystenUtil.isIos&&parseInt(We.AliRTS.SystenUtil.systemVersion)<=13){he.event(`[${Rr.logName}]`,"play audio for iOS 13-");const r=this.audioElement;r.setAttribute("autoplay","");const n=()=>{r.removeEventListener("playing",n),r.pause(),r.play().catch(()=>{this.handleAutoPlayFailed()})};this.audioElement.addEventListener("playing",n)}else(()=>{var r;he.event(`[${Rr.logName}]`,"try play audio"),(r=this.audioElement)==null||r.play().then(()=>{he.event(`[${Rr.logName}]`,"play audio success")}).catch(()=>{this.handleAutoPlayFailed()})})()})}stopPlayAudio(){this.audioElement&&(this.audioElement.pause(),this.audioElement.srcObject=null,this.audioElement.removeEventListener("pause",this.handleAudioPaused))}playAll(e=!1,t=!1){e?(this.viewMap.screenViews||[]).forEach(r=>{this.play(r,e,t)}):(this.viewMap.cameraViews||[]).forEach(r=>{this.play(r,e,t)})}play(e,t=!1,r=!1){const n=t?this.screenStream:this.stream;!e||!n||!n.mediaStream||Xv(e,n.mediaStream,r).catch(i=>{i.code===20||i.name==="AbortError"||this.handleVideoPlayFailded(e,t?xe.AliRtcVideoTrackScreen:xe.AliRtcVideoTrackCamera)})}stopPlayAll(e=!1){e?this.viewMap.screenViews.forEach(t=>{nn(t)}):this.viewMap.cameraViews.forEach(t=>{nn(t)})}toggleAudio(e=!0){this.audioSubState.setEnabled(e),this.audioTrack&&(this.audioTrack.enabled=e)}toggleVideo(e=!0){this.videoSubState.setEnabled(e),this.stream&&(e?this.stream.enableVideo():this.stream.disableVideo())}toggleScreen(e=!0){this.screenSubState.setEnabled(e),this.screenStream&&(e?this.screenStream.enableVideo():this.screenStream.disableVideo())}getStats(){return Q(this,null,function*(){var e,t,r,n,i;const o=[];if(this.isAudioSubscribing){const a=yield this.rtsManager.getSubscribeAudioStats(this.streamUrl);a&&o.push({uid:this.uid,track:uo.AliRtcAudioTrackMic,stats:a})}const s=[];if((e=this.streamInfo)!=null&&e.isVideoLargeSubscribed){const a=yield this.rtsManager.getSubscribeVideoStats(this.streamUrl,((t=this.streamInfo.getVideoLargeInfo())==null?void 0:t.msid)||se.VideoLarge);a&&s.push({uid:this.uid,track:xe.AliRtcVideoTrackCamera,streamType:Lt.AliRtcVideoStreamTypeHigh,stats:a})}if((r=this.streamInfo)!=null&&r.isVideoSmallSubscribed){const a=yield this.rtsManager.getSubscribeVideoStats(this.streamUrl,((n=this.streamInfo.getVideoSmallInfo())==null?void 0:n.msid)||se.VideoSmall);a&&s.push({uid:this.uid,track:xe.AliRtcVideoTrackCamera,streamType:Lt.AliRtcVideoStreamTypeLow,stats:a})}if(this.isScreenSubscribing){const a=yield this.rtsManager.getSubscribeVideoStats(this.streamUrl,((i=this.streamInfo.getScreenInfo())==null?void 0:i.msid)||se.Screen);a&&s.push({uid:this.uid,track:xe.AliRtcVideoTrackScreen,stats:a})}return{audio:o,video:s}})}enableAudioVolumeIndication(e){this.audioVolumeIndicationInterval!==e&&(this.audioVolumeIndicationInterval>0&&e<=0&&this.audioLevelMonitor.stop(),e>0&&this.audioTrack&&this.audioLevelMonitor.start(this.audioTrack,e),this.audioVolumeIndicationInterval=e)}reportSubscribeMonitor(e){var t;e&&(this.slsReporter.reportSubscribeMonitor(((t=this.localUser)==null?void 0:t.callId)||"",this.callId,this.trackTraceIdMap[e]||"",e,this.monitorDataCache[e]),this.monitorDataCache[e]=[])}startStreamMonitor(){this.monitorTimerId||(this.monitorTimerId=window.setInterval(()=>Q(this,null,function*(){try{if(this.streamInfo.subscribingInfos.length===0){this.stopStreamMonitor();return}let e=Object.keys(this.monitorDataCache).filter(t=>{var r;return((r=this.monitorDataCache[t])==null?void 0:r.length)>0});this.streamInfo.subscribingInfos.forEach(t=>{const r=t.msid;if(!r)return;e.includes(r)&&(e=e.filter(o=>o!==r));let n;const i=r===se.Audio;i?n=this.rtsManager.getSubscribeAudioStats(this.streamUrl):n=this.rtsManager.getSubscribeVideoStats(this.streamUrl,r),n.then(o=>{var s;if(!o.timestamp)return;this.monitorDataCache[r]||(this.monitorDataCache[r]=[]);const a=this.monitorDataCache[r];let c;if((a==null?void 0:a.length)>0){const u=a[a.length-1]||{},{_last:d}=u;c=Jo(u,["_last"])}(a==null?void 0:a.length)>=Gb&&this.reportSubscribeMonitor(r),o._last=c,o._codec=t.codec,i&&(o._source=(s=this.localUser)==null?void 0:s.getMediaStats(o.playoutId)),this.monitorDataCache[r].push(o)})}),e.forEach(t=>{this.reportSubscribeMonitor(t)})}catch{}}),1e3))}stopStreamMonitor(){this.monitorTimerId&&(clearInterval(this.monitorTimerId),this.monitorTimerId=void 0),Object.keys(this.monitorDataCache).forEach(e=>{this.reportSubscribeMonitor(e)})}},B(Rr,"logName","RemoteUser"),Rr);Gt([ee()],Bt.prototype,"clear",1);Gt([ee()],Bt.prototype,"updateRemoteUserDeviceStatus",1);Gt([ee()],Bt.prototype,"updateRemoteTracks",1);Gt([ee(ge)],Bt.prototype,"subscribe",1);Gt([ee()],Bt.prototype,"subscribeProxy",1);Gt([ee(ge)],Bt.prototype,"subscribeDeleteProxy",1);Gt([ee()],Bt.prototype,"restore",1);Gt([ee(ge)],Bt.prototype,"resumeAudio",1);Gt([ee(ge)],Bt.prototype,"stopSubscribe",1);Gt([ee(ge)],Bt.prototype,"doStopSubscribe",1);Gt([ee()],Bt.prototype,"clearStream",1);Gt([ee()],Bt.prototype,"clearScreenStream",1);Gt([ee()],Bt.prototype,"updateSubscribe",1);Gt([ee()],Bt.prototype,"playAudio",1);Gt([ee()],Bt.prototype,"stopPlayAudio",1);Gt([ee((e,t,r)=>[typeof e=="string"?e:e==null?void 0:e.nodeType,t,r])],Bt.prototype,"play",1);Gt([ee()],Bt.prototype,"stopPlayAll",1);let Jb=Bt;var Bn=(e=>(e[e.AliRtcPluginErrorCodeSuccess=0]="AliRtcPluginErrorCodeSuccess",e[e.AliRtcPluginErrorCodeFailed=-1]="AliRtcPluginErrorCodeFailed",e[e.AliRtcPluginErrorNoFindPlugin=-2]="AliRtcPluginErrorNoFindPlugin",e[e.AliRtcPluginErrorParameterError=-3]="AliRtcPluginErrorParameterError",e[e.AliRtcPluginErrorLoadError=-4]="AliRtcPluginErrorLoadError",e[e.AliRtcPluginErrorCreateError=-5]="AliRtcPluginErrorCreateError",e[e.AliRtcPluginErrorInitError=-6]="AliRtcPluginErrorInitError",e[e.AliRtcPluginErrorInitTokenError=-7]="AliRtcPluginErrorInitTokenError",e))(Bn||{});class qb extends Ut{constructor(){super(...arguments),B(this,"plugins",new Map)}add(t,r){if(this.plugins.has(t.name))throw new ue(Bn.AliRtcPluginErrorCreateError,`Plugin ${t.name} already exists`);this.plugins.set(t.name,t),r&&t.setOptions(r),this.emit("added",t),t.on("enabled",()=>this.emit("added",t)),t.on("disabled",()=>this.emit("removed",t)),t.on("updated",()=>this.emit("updated",t))}remove(t){const r=this.plugins.get(t);if(!r)throw new ue(Bn.AliRtcPluginErrorNoFindPlugin,`Plugin ${t} not founded`);this.plugins.delete(t),r.removeAllListeners(),this.emit("removed",r)}removeAll(){this.plugins.forEach(t=>{this.remove(t.name)})}get(t){return this.plugins.get(t)}has(t){return!!this.plugins.get(t)}getAll(){return Array.from(this.plugins.values())}}var Yb=Object.defineProperty,Qb=Object.getOwnPropertyDescriptor,Pt=(e,t,r,n)=>{for(var i=n>1?void 0:n?Qb(t,r):t,o=e.length-1,s;o>=0;o--)(s=e[o])&&(i=(n?s(t,r,i):s(i))||i);return n&&i&&Yb(t,r,i),i};const Ac=([e])=>{const{remoteUser:t,options:r}=e;return[`user(${t.userId})`,r]},Hm=5;var br;const _t=(br=class extends Ut{constructor(e,t,r,n,i){super(),B(this,"rts"),B(this,"encodedInsertableStreams",!0),B(this,"audioRedEnabled",!1),B(this,"localStreamManager"),B(this,"slsReporter"),B(this,"_rtsReconnecting",!1),B(this,"_rtsPeerConnectionType","publish"),B(this,"connecting",!1),B(this,"connected",!1),B(this,"_pcTraceId",""),B(this,"_localJoinTime",0),B(this,"publishRetryHook"),B(this,"subscribeRetryOptionsHook"),B(this,"connectionResolve"),B(this,"connectingPromise"),B(this,"dcResolve"),B(this,"dcReject"),B(this,"dcConnectingPromise"),B(this,"_publishingTracks",[]),B(this,"parameter",{}),this.localStreamManager=e,this.slsReporter=t,this.publishRetryHook=r,this.subscribeRetryOptionsHook=n,this.parameter=i,this.rts=We.AliRTS.createClient(),this.addRTSListener()}addRTSListener(){this.rts.on("connectStatusChange",e=>{var t,r,n,i;if(he.event(`[${br.logName}]`,"rts connectStatusChange to:",e.status),e.status===We.EConnectStatus.CONNECT_STATUS_DISCONNECTED)this.dcReject&&this.dcReject(),this.setConnected(!1),this.slsReporter.reportWarning("rts disconnected"),this.emit("disconnected");else if(e.status===We.EConnectStatus.CONNECT_STATUS_CONNECTED){const o=(i=(n=(r=(t=this.rts.commonController)==null?void 0:t.peerCore)==null?void 0:r.getSignal())==null?void 0:n.getDatachannelCore())==null?void 0:i.readyState;he.event(`[${br.logName}]`,"dcReadyState:",o),o==="open"&&this.dcResolve&&this.dcResolve(!0),this._rtsReconnecting&&this._rtsPeerConnectionType==="publish"&&(this._publishingTracks=this.rts.getPublishTrackInfoList());try{this.emit("connected",this._rtsReconnecting,this._rtsPeerConnectionType)}catch{}this.setConnected(!0)}}),this.rts.on("datachannelStatusChange",e=>{he.event(`[${br.logName}]`,"rts datachannelStatusChange to:",e.status),e.status===We.EDatachannelStatus.DATACHANNEL_STATUS_OPEN?this.dcResolve&&this.dcResolve(!0):e.status===We.EDatachannelStatus.DATACHANNEL_STATUS_CLOSE&&(this.dcReject&&this.dcReject(),this.dcConnectingPromise=new Promise((t,r)=>{this.dcResolve=t,this.dcReject=r}))}),this.rts.on("receivedSEI",e=>{this.emit("seimessage",e.url,e.sei.payloadType,e.sei.data)})}get pcTraceId(){return this._pcTraceId}set localJoinTime(e){this._localJoinTime=e}setEncodedInsertableStreams(e){this.encodedInsertableStreams=e}setAudioRedEnabled(e){var t;if(e!==this.audioRedEnabled){try{const r=[...((t=RTCRtpReceiver.getCapabilities("audio"))==null?void 0:t.codecs)||[]];if(r.length>0){if(e){const n=r.findIndex(o=>o.mimeType==="audio/red"),i=r.findIndex(o=>o.mimeType==="audio/opus");if(n>-1&&i>-1&&n>i){const o=r[i];r[i]=r[n],r[n]=o}}this.rts.setSenderCodecPreferences({audio:r}),this.rts.setReceiverCodecPreferences({audio:r})}}catch{}this.audioRedEnabled=e}}clear(){this.setConnected(!1);try{this.rts.unpublish()}catch{}this.rts=We.AliRTS.createClient(),this.addRTSListener()}startConnect(){this.connecting=!0,this.connectingPromise=new Promise(e=>{this.connectionResolve=e}),this.dcConnectingPromise=new Promise((e,t)=>{this.dcResolve=e,this.dcReject=t})}setConnected(e){var t;this.connected=e,this.connecting=!1,this._rtsReconnecting=!1,(t=this.connectionResolve)==null||t.call(this,!0)}get isConnecting(){return this.connecting}get isConnected(){return this.connected}get publishingTracks(){return this._publishingTracks}getPubMsid(e,t){const{aMsid:r,vMsid:n}=t??{},i={};return e.hasAudio&&(i.aMsid=[r??se.Audio]),e.hasScreen&&(i.vMsid=[se.Screen]),e.hasVideo&&(i.vMsid=[n??(t!=null&&t.isScreen?se.Screen:se.VideoLarge)]),i}updatePublishingTracks(e){e&&(this._publishingTracks=e.map(({msid:t,from:r,ssrc:n,codec:i,type:o,trackId:s})=>({msid:t,from:r,type:o,ssrc:`${n}`,codec:i??"",trackId:s})))}httpPublish(e,t){return Q(this,arguments,function*(r,n,i=!1,o=dn.MANUAL){var s,a;let c;const{publishStream:u,videoSmallStream:d,screenStream:E,vMsid:m}=yield this.localStreamManager.createHTTPPublishStream();if(!u)return he.warn(`[${br.logName}]`,"publishStream is null"),{traceId:"",l1ip:c};const f=this.getPubMsid(u,{vMsid:m});this.encodedInsertableStreams&&(f.encodedInsertableStreams=!0),f.answerSdpHook=p=>{const v=/\d+\.\d+\.\d+\.\d+(?=\s+1106|\s+8000)/.exec(p);return v!=null&&v[0]&&(c=v[0]),p},(a=(s=this.parameter)==null?void 0:s.net)!=null&&a.useTCP&&(f.tcpOnly=!0),f.beforeRetry=p=>Q(this,null,function*(){this._rtsReconnecting=!0,this.publishRetryHook&&this.publishRetryHook();const{publishStream:v,vMsid:g}=yield this.localStreamManager.createHTTPPublishStream();if(!v)return;const R=this.getPubMsid(v,{vMsid:g});return p.stream=v,R.aMsid?p.aMsid=R.aMsid:p.aMsid=[],R.vMsid?p.vMsid=R.vMsid:p.vMsid=[],p}),this._rtsPeerConnectionType="publish";let y=!u.hasVideo,S=m,l="";this.startConnect();const h=Date.now();try{l=yield this.rts.publish(r,u,f)}catch(p){this.setConnected(!1);const v=2e3-(Date.now()-h);throw v<=0?this.emit("disconnected"):setTimeout(()=>{this.emit("disconnected")},v),this.slsReporter.reportPublish(i,r,n,u.hasVideo&&(!m||m===se.VideoLarge),u.hasVideo&&m===se.VideoSmall,u.hasVideo&&m===se.Screen,u.hasAudio,(p==null?void 0:p.errorCode)||-1,this.pcTraceId,"",h),ue.fromRtsError(p)}he.event(`[${br.logName}]`,"rts publish success",l),this.slsReporter.reportPublish(i,r,n,u.hasVideo&&(!m||m===se.VideoLarge),u.hasVideo&&m===se.VideoSmall,u.hasVideo&&m===se.Screen,u.hasAudio,0,l,l,h);try{const p=Date.now();return this._pcTraceId=l,this.setConnected(!0),this._publishingTracks=this.rts.getPublishTrackInfoList(),d&&(yield this.publishAdd(r,d,n,{vMsid:se.VideoSmall},i),y=!1,S=se.VideoSmall),E&&(yield this.publishAdd(r,E,n,{vMsid:se.Screen},i),y=!1,S=se.Screen),yield this.waitPublishSender(r,y,S),this.slsReporter.reportPublishFirstPacket(i,n,h,p,this._localJoinTime,y?se.Audio:f.vMsid,l||"",l||"",o),{traceId:l,l1ip:c}}catch(p){throw this.setConnected(!1),ue.fromError(p)}})}waitPublishSender(e,t=!1,r){return Q(this,null,function*(){const n=(i,o)=>{let s=0;const a=()=>(t?this.rts.getPublishAudioStats(e,r):this.rts.getPublishVideoStats(e,r)).then(c=>!(c.bytesSent>0)&&s<i?(s++,new Promise(u=>setTimeout(()=>u(a()),o))):Promise.resolve());return a()};return Promise.race([xn(1e3),n(5,100)]).catch(()=>{})})}getPublishVideoStats(e,t){return Q(this,null,function*(){return yield this.rts.getPublishVideoStats(e,t)})}getPublishAudioStats(e,t){return Q(this,null,function*(){return yield this.rts.getPublishAudioStats(e,t)})}publishAdd(e,t,r,n){return Q(this,arguments,function*(i,o,s,a,c=!1,u=!1,d=dn.MANUAL){var E,m,f,y,S,l,h,p;const v=Date.now(),g=this.getPubMsid(o,a);try{const R=yield Vm(_=>Q(this,null,function*(){return _>0&&he.event(`[${br.logName}]`,`publishAdd retry times: ${_}`),this.isConnected?(yield this.dcConnectingPromise,this.rts.publishAdd([Ne({url:i,stream:o,updateSourceStream:!1},g)])):Promise.reject(new ue(pe.ERR_INNER,"rts not connected"))}),Hm,0,_=>(_==null?void 0:_.errorCode)===15006);if(R){const _=Date.now(),[w]=R;return this.slsReporter.reportPublish(!1,i,s,((E=g.vMsid)==null?void 0:E[0])===se.VideoLarge,((m=g.vMsid)==null?void 0:m[0])===se.VideoSmall,((f=g.vMsid)==null?void 0:f[0])===se.Screen,((y=g.aMsid)==null?void 0:y[0])===se.Audio,0,this.pcTraceId,w.traceId||"",v),this.updatePublishingTracks(w.trackInfoList),u&&(yield this.waitPublishSender(i,!o.hasVideo,o.hasVideo?a==null?void 0:a.vMsid:a==null?void 0:a.aMsid)),this.slsReporter.reportPublishFirstPacket(c,s,v,_,this._localJoinTime,(o.hasVideo?a==null?void 0:a.vMsid:a==null?void 0:a.aMsid)||"",this.pcTraceId,w.traceId||"",d),w.traceId||""}}catch(R){throw this.slsReporter.reportPublish(!1,i,s,((S=g.vMsid)==null?void 0:S[0])===se.VideoLarge,((l=g.vMsid)==null?void 0:l[0])===se.VideoSmall,((h=g.vMsid)==null?void 0:h[0])===se.Screen,((p=g.aMsid)==null?void 0:p[0])===se.Audio,(R==null?void 0:R.errorCode)||-1,this.pcTraceId,"",v),R!=null&&R.errorCode?ue.fromRtsError(R):ue.fromError(R)}return""})}publishDelete(e,t){return Q(this,null,function*(){var r,n,i,o,s,a,c,u;yield this.dcConnectingPromise;const d=(n=(r=this.publishingTracks)==null?void 0:r.find(({msid:S})=>S===se.Audio))==null?void 0:n.msid,E=(o=(i=this.publishingTracks)==null?void 0:i.find(({msid:S})=>S===se.VideoLarge))==null?void 0:o.msid,m=(a=(s=this.publishingTracks)==null?void 0:s.find(({msid:S})=>S===se.Screen))==null?void 0:a.msid,f=[];t.screen&&m?f.push(m):t.video&&f.push(t.vMsid||E);const y=[];t.audio&&d&&y.push(d),he.event(br.logName,"publishDelete",{streamUrl:e,aMsid:y,vMsid:f});try{const[S]=(yield this.rts.publishDeleteTracks([{url:e,aMsid:y,vMsid:f}]))||[];return he.event(br.logName,"publishDelete",{result:S}),S&&this.updatePublishingTracks(S.trackInfoList),((u=(c=S==null?void 0:S.trackInfoList)==null?void 0:c[0])==null?void 0:u.trackId)||""}catch(S){throw ue.fromRtsError(S)}})}publishReplace(e,t,r){return Q(this,null,function*(){var n,i;yield this.dcConnectingPromise;const{vMsid:o,aMsid:s}=r??{};try{const a=yield this.rts.publishReplaceTracks([{url:e,stream:t,updateSourceStream:!1,vMsid:o,aMsid:s}]),[c]=a;return this.updatePublishingTracks(c.trackInfoList),((i=(n=c==null?void 0:c.trackInfoList)==null?void 0:n[0])==null?void 0:i.trackId)||""}catch(a){throw ue.fromRtsError(a)}})}publishStop(e){return Q(this,null,function*(){return yield this.rts.publishStop([{url:e}]),this._publishingTracks=[],""})}publishAddDataChannel(e){return Q(this,null,function*(){yield this.dcConnectingPromise;const t=yield this.rts.publishAddDatachannel({signalUrl:e,url:e,label:se.Data,msid:se.Data}),r=t==null?void 0:t.datachannel;if(r&&r.send){const n=new ArrayBuffer(4);new DataView(n).setUint8(0,240),r.datachannel.send(n)}return r})}publishStopDataChannel(e,t){return Q(this,null,function*(){return yield this.rts.publishStopDatachannel({url:e,datachannel:t})})}unpublish(){return Q(this,null,function*(){yield this.rts.unpublish(),this.connecting=!1,this.connected=!1})}getSubConfig(e,t){let r=t??{};t||(r={audio:!0,video:!0,screen:!0});const n={};return r.audio&&(n.aMsid=[(e==null?void 0:e.getAudioInfo().msid)||se.Audio]),r.video?r.vMsid?n.vMsid=[r.vMsid]:e!=null&&e.hasVideoLarge?n.vMsid=[(e==null?void 0:e.getVideoLargeInfo().msid)||se.VideoLarge]:e!=null&&e.hasVideoSmall?n.vMsid=[(e==null?void 0:e.getVideoSmallInfo().msid)||se.VideoSmall]:n.vMsid=[se.VideoLarge]:r.screen&&e!=null&&e.hasScreen&&(n.vMsid=[(e==null?void 0:e.getScreenInfo().msid)||se.Screen]),n}httpSubscribe(e){return Q(this,null,function*(){var t,r,n,i,o,s;const{remoteUser:a,options:c}=e;let u=a.streamUrl;c.video||c.screen?c!=null&&c.audio||(u+="@subaudio=no"):u+="@subvideo=no";const d=this.getSubConfig(a.streamInfo,c);if(this.encodedInsertableStreams&&(d.encodedInsertableStreams=!0),(r=(t=this.parameter)==null?void 0:t.net)!=null&&r.useTCP&&(d.tcpOnly=!0),(i=(n=this.parameter)==null?void 0:n.net)!=null&&i.mediaTimeout){const E=(s=(o=this.parameter)==null?void 0:o.net)==null?void 0:s.mediaTimeout;E>1e3&&E<1e5&&(d.mediaTimeout=E)}d.beforeRetry=E=>Q(this,null,function*(){this._rtsReconnecting=!0;try{this.emit("reconnecting","subscribe")}catch{}if(this._publishingTracks=[],this.subscribeRetryOptionsHook){const m=this.subscribeRetryOptionsHook();if(m){let f=a.streamUrl;c.video||c.screen?c!=null&&c.audio||(f+="@subaudio=no"):f+="@subvideo=no",E.url=f;const y=this.getSubConfig(m.remoteUser.streamInfo,m.options);y.aMsid&&(E.aMsid=y.aMsid),y.vMsid&&(E.vMsid=y.vMsid)}else return}return E}),this._rtsPeerConnectionType="subscribe";try{this.startConnect();const E=yield this.rts.subscribe(u,d);return this._pcTraceId=E.traceId,this.setConnected(!0),{traceId:E.traceId,stream:E}}catch(E){throw this.setConnected(!1),this.emit("disconnected"),ue.fromRtsError(E)}})}subscribeAdd(e){return Q(this,null,function*(){var t,r,n,i;const{remoteUser:o,options:s}=e,a=bi(Ne({url:o.streamUrl,subAudio:!!s.audio,subVideo:!!(s.screen||s.video)},this.getSubConfig(o.streamInfo,s)),{targetStream:s.screen?o.getScreenStream:o.getCameraStream});try{return(yield Vm(c=>Q(this,null,function*(){return yield this.dcConnectingPromise,c>0&&he.event(`[${br.logName}]`,`subscribeAdd retry times: ${c}`),this.isConnected?this.rts.subscribeAdd([a]):Promise.reject()}),Hm,0,c=>(c==null?void 0:c.errorCode)===15006))[0]}catch(c){if(((i=(n=(r=(t=c==null?void 0:c.extraInfo)==null?void 0:t.parsedData)==null?void 0:r.streams)==null?void 0:n[0])==null?void 0:i.res_code)===508)return this.emit("subscribeexceeds"),null;throw ue.fromRtsError(c)}})}subscibeDelete(e){return Q(this,null,function*(){var t,r,n,i;yield this.dcConnectingPromise;const{remoteUser:o,options:s}=e,a=bi(Ne({url:o.streamUrl,subAudio:!!s.audio,subVideo:!!(s.screen||s.video)},this.getSubConfig(o.streamInfo,s)),{targetStream:s.screen?o.getScreenStream:o.getCameraStream});try{return(yield this.rts.subscribeDeleteTracks([a]))[0]}catch(c){if(((i=(n=(r=(t=c==null?void 0:c.extraInfo)==null?void 0:t.parsedData)==null?void 0:r.streams)==null?void 0:n[0])==null?void 0:i.res_code)===404)return;throw ue.fromRtsError(c)}})}subscibeStop(e){return Q(this,null,function*(){var t,r,n,i;try{yield this.rts.subscribeStop([{url:e}])}catch(o){if(((i=(n=(r=(t=o==null?void 0:o.extraInfo)==null?void 0:t.parsedData)==null?void 0:r.streams)==null?void 0:n[0])==null?void 0:i.res_code)===404)return;throw ue.fromRtsError(o)}})}subscribeAddDataChannel(e){return Q(this,null,function*(){yield this.dcConnectingPromise;const t=yield this.rts.subscribeAddDatachannel({signalUrl:e,url:e,label:se.Data,msid:se.Data}),r=t==null?void 0:t.datachannel;if(r&&r.send){const n=new ArrayBuffer(4);new DataView(n).setUint8(0,240),r.send(n)}return r})}subscribeStopDatachannel(e,t){return Q(this,null,function*(){let r;try{r=yield this.rts.subscribeStopDatachannel({url:e,datachannel:t})}catch{}return t==null||t.dispose(),r})}publish(e,t){return Q(this,arguments,function*(r,n,i=!1,o=dn.MANUAL){let s="",a;if(this.connecting&&(yield this.connectingPromise),this.connected){yield this.dcConnectingPromise;let c=!1,u;const{audio:d,video:E,videoSmall:m,screen:f}=this.localStreamManager.publishStreams;d&&(s=yield this.publishAdd(r,d,n,{aMsid:se.Audio},i),c=!0,u=se.Audio,yield xn(100)),E&&(s=yield this.publishAdd(r,E,n,{vMsid:se.VideoLarge},i),c=!1,u=se.VideoLarge,yield xn(100)),m&&(s=yield this.publishAdd(r,m,n,{vMsid:se.VideoSmall},i),c=!1,u=se.VideoSmall,yield xn(100)),f&&(s=yield this.publishAdd(r,f,n,{isScreen:!0,vMsid:se.Screen},i),c=!1,u=se.Screen),u&&(yield this.waitPublishSender(r,c,u))}else{const c=yield this.httpPublish(r,n,i,o);s=c.traceId,a=c.l1ip}return{traceId:s,l1ip:a}})}subscribe(e,t,r,n,i){return Q(this,null,function*(){let o=!1;const{options:s,remoteUser:a}=e;if(s.video&&s.screen)throw new ue(pe.ERR_INNER,"subscribe error, video and screen cannot be subscribed at the same time");this.connecting&&(yield this.connectingPromise);let c,u=Date.now();this.connected?(u=Date.now(),c=yield this.subscribeAdd(e)):(o=!0,c=yield this.httpSubscribe(e));const d=Date.now();let E=se.VideoLarge,m=s.video||s.screen,f=s.audio;s.video&&s.vMsid?E=s.vMsid:s.screen&&(E=se.Screen);let y=0,S=0,l=0;const h=((p,v)=>{let g=0;const R=()=>{let _;return f&&!y&&(_=this.rts.getSubscribeAudioStats(a.streamUrl).then(w=>{if(w.packetsReceived>0)y=Date.now();else if(!m)return g<p?(g++,new Promise(k=>setTimeout(()=>k(R()),v))):!1;return!0})),m&&!l&&(_=this.rts.getSubscribeVideoStats(a.streamUrl,E).then(w=>{if(w.packetsReceived>0&&(S=Date.now()),w.framesDecoded>0)l=Date.now();else return g<p?(g++,new Promise(k=>setTimeout(()=>k(R()),v))):(he.event(`[${br.logName}]`,a.userId,""),!1);return!0})),Promise.resolve(_)};return R()})(40,100);return h.then(()=>{S&&this.slsReporter.reportSubscribeFirstPacket(t===tt.Resume,r,n,E,{fprt:S-u,ifsprtc:l?l-u:0,ajsub:t===tt.Join?1:0,pctid:this.pcTraceId,subtid:(c==null?void 0:c.traceId)||"",sstc:d-u}),l&&this.slsReporter.reportSubscribeFirstFrame(t===tt.Resume,r,n,E,{fvfrt:l-u,fp2fftc:l-S,ajsub:t===tt.Join?1:0,tffrtc:t===tt.Join?l-this.localJoinTime:l-i,pctid:this.pcTraceId,subtid:(c==null?void 0:c.traceId)||"",fvfdtc:l-u}),y&&this.slsReporter.reportSubscribeFirstPacket(t===tt.Resume,r,n,se.Audio,{fprt:y-u,ifsprtc:y-u,ajsub:t===tt.Join?1:0,pctid:this.pcTraceId,subtid:(c==null?void 0:c.traceId)||"",sstc:d-u})}),o&&(yield Promise.race([h,xn(1500)])),c})}getSubscribeVideoStats(e,t){return Q(this,null,function*(){return yield this.rts.getSubscribeVideoStats(e,t)})}getSubscribeAudioStats(e,t){return Q(this,null,function*(){return yield this.rts.getSubscribeAudioStats(e,t)})}getStreamByMsid(e){return this.rts.commonController.streamManager.getStreamByMsid(e)}getPCStats(){return Q(this,null,function*(){var e,t;return(t=(e=this.rts.commonController.peerCore)==null?void 0:e.pc)==null?void 0:t.getStats()})}sendSEI(e,t,r,n){return Q(this,null,function*(){return this.rts.sendSEI({url:e,vMsid:se.VideoLarge,data:t,repeatCount:r,payloadType:n})})}},B(br,"logName","RtsManager"),br);Pt([ee(ge)],_t.prototype,"startConnect",1);Pt([ee()],_t.prototype,"updatePublishingTracks",1);Pt([ee(ge,ge)],_t.prototype,"httpPublish",1);Pt([ee(ge,ge)],_t.prototype,"waitPublishSender",1);Pt([ee(([e,t,r])=>[e,JSON.stringify(r)],ge)],_t.prototype,"publishAdd",1);Pt([ee(ge,ge)],_t.prototype,"publishDelete",1);Pt([ee(([e,t,r])=>[e,JSON.stringify(r)])],_t.prototype,"publishReplace",1);Pt([ee(ge)],_t.prototype,"publishStop",1);Pt([ee(ge)],_t.prototype,"publishAddDataChannel",1);Pt([ee(ge)],_t.prototype,"publishStopDataChannel",1);Pt([ee()],_t.prototype,"unpublish",1);Pt([ee(Ac,({traceId:e})=>e)],_t.prototype,"httpSubscribe",1);Pt([ee(Ac,({traceId:e})=>e)],_t.prototype,"subscribeAdd",1);Pt([ee(Ac)],_t.prototype,"subscibeDelete",1);Pt([ee(ge)],_t.prototype,"subscibeStop",1);Pt([ee(ge)],_t.prototype,"subscribeAddDataChannel",1);Pt([ee(ge)],_t.prototype,"subscribeStopDatachannel",1);Pt([ee(ge)],_t.prototype,"publish",1);Pt([ee(Ac)],_t.prototype,"subscribe",1);Pt([ee()],_t.prototype,"sendSEI",1);let Xb=_t;class Cu{constructor(){B(this,"profile"),B(this,"profileMap",new Map),B(this,"audioProfile"),B(this,"contentHint")}updateProfile(t,r){r&&this.profileMap.set(t,r),this.profile=t}get videoProfile(){return this.profile}updateAudioProfile(t){this.audioProfile=t}setContentHint(t,r){r&&(this.contentHint=r),this.contentHint&&t&&(t.contentHint=this.contentHint)}setVideoProfile(t,r,n=!1){return Q(this,null,function*(){if(!this.profile)return;const i=this.profileMap.get(this.profile)||(r==null?void 0:r.VideoProfileMap.get(this.profile));if(i){if(!n&&t&&t.applyConstraints)try{yield t.applyConstraints(i)}catch{}r&&(r==null||r.VideoProfileMap.set(this.profile,i),yield r.setVideoProfile(this.profile))}})}}class Il extends Ut{constructor(t){super(),B(this,"type"),B(this,"originVideoTrack"),B(this,"videoSource"),B(this,"_videoMuted",!1),B(this,"originAudioTrack"),B(this,"audioSource"),B(this,"_audioMuted",!1),B(this,"_targetVideoTrack"),B(this,"_targetDualVideoTrack"),B(this,"_targetAudioTrack"),B(this,"_publishVideoStream"),B(this,"_publishDualVideoStream"),B(this,"_publishAudioStream"),B(this,"_previewStream"),B(this,"plugins",[]),B(this,"_profileManager"),B(this,"cameraVideoConstraints"),B(this,"micAudioConstraints"),B(this,"onVideoTrackEnded",()=>{this.emit("videotrackended")}),B(this,"onAudioTrackEnded",()=>{this.emit("audiotrackended")}),this.type=t}get profileManager(){return this._profileManager}get audioProfile(){var t;return(t=this.profileManager)==null?void 0:t.audioProfile}updateSource(t,r,n){return Q(this,null,function*(){var i,o,s,a,c,u;const{videoTrack:d,audioTrack:E}=t;d&&((i=this.originVideoTrack)==null||i.removeEventListener("ended",this.onVideoTrackEnded)),E&&((o=this.originAudioTrack)==null||o.removeEventListener("ended",this.onAudioTrackEnded)),this.type===Dt.AliRtcSdkStreamTypeScreen?this.stop():(d&&((s=this.originVideoTrack)==null||s.stop()),E&&((a=this.originAudioTrack)==null||a.stop())),d&&(this.originVideoTrack=d,(c=this.originVideoTrack)==null||c.addEventListener("ended",this.onVideoTrackEnded),this.videoSource=r||ao.Camera,this.updateVideoTrack(d)),E&&(this.originAudioTrack=E,(u=this.originAudioTrack)==null||u.addEventListener("ended",this.onAudioTrackEnded),this.audioSource=n||Qa.Microphone,this.updateAudioTrack(E))})}get currentProfile(){var t;return(t=this.profileManager)==null?void 0:t.profile}get currentVideoTrack(){return this._targetVideoTrack}get currentDualVideoTrack(){return this._targetDualVideoTrack}get publishVideoStream(){return this._publishVideoStream}get publishDualVideoStream(){return this._publishDualVideoStream}get currentAudioTrack(){return this._targetAudioTrack}get publishAudioStream(){return this._publishAudioStream}get previewStream(){return this._previewStream}updateVideoTrack(t,r=!1){return Q(this,null,function*(){(this._targetVideoTrack!==t||r)&&(this._targetVideoTrack=t)})}updateDualVideoTrack(t,r=!1){return Q(this,null,function*(){(this._targetDualVideoTrack!==t||r)&&(this._targetDualVideoTrack=t)})}updateAudioTrack(t,r=!1){return Q(this,null,function*(){(this._targetAudioTrack!==t||r)&&(this._targetAudioTrack=t)})}setAudioMuted(t){var r,n;this._audioMuted=t,t?(r=this.publishAudioStream)==null||r.disableAudio():(n=this.publishAudioStream)==null||n.enableAudio()}get isAudioMuted(){return this._audioMuted}setVideoMuted(t){var r,n;this._videoMuted=t,t?(r=this.publishVideoStream)==null||r.disableVideo():(n=this.publishVideoStream)==null||n.enableVideo()}get isVideoMuted(){return this._videoMuted}process(t){return Q(this,null,function*(){var r,n,i,o,s,a,c,u,d,E,m,f;this._targetAudioTrack=this.originAudioTrack,this._targetVideoTrack=this.originVideoTrack;for(const y of this.plugins)try{yield y.execute(this,t)}catch(S){console.error(`error in plugin-${y.name}, error: ${S}`)}this._targetVideoTrack?((n=(r=this._publishVideoStream)==null?void 0:r.videoTrack)==null?void 0:n.id)!==this._targetVideoTrack.id&&(this._publishVideoStream=yield Ao(this._targetVideoTrack),this.setVideoMuted(this._videoMuted),(i=this.profileManager)==null||i.setVideoProfile(this.originVideoTrack,this._publishVideoStream,!0),(o=this.profileManager)==null||o.setContentHint(this._targetVideoTrack),this.previewStream?(s=this.previewStream)==null||s.mergeStream(this._publishVideoStream):this._previewStream=yield Ao(this._targetVideoTrack)):(this._publishVideoStream=void 0,(a=this.previewStream)==null||a.deleteTracks({video:!0})),this._targetDualVideoTrack?((u=(c=this._publishDualVideoStream)==null?void 0:c.videoTrack)==null?void 0:u.id)!==this._targetDualVideoTrack.id&&(this._publishDualVideoStream=yield Ao(this._targetDualVideoTrack),this._videoMuted?this._publishDualVideoStream.disableVideo():this._publishDualVideoStream.enableVideo()):this._publishDualVideoStream=void 0,this._targetAudioTrack?((E=(d=this._publishAudioStream)==null?void 0:d.audioTrack)==null?void 0:E.id)!==this._targetAudioTrack.id&&(this._publishAudioStream=yield Ao(this._targetAudioTrack),this.setAudioMuted(this._audioMuted),this.previewStream?(m=this.previewStream)==null||m.mergeStream(this._publishAudioStream):this._previewStream=yield Ao(this._targetAudioTrack)):(this._publishAudioStream=void 0,(f=this.previewStream)==null||f.deleteTracks({audio:!0}))})}stopVideo(){var t,r;this.originVideoTrack&&((t=this.originVideoTrack)==null||t.removeEventListener("ended",this.onAudioTrackEnded),(r=this.originVideoTrack)==null||r.stop(),this.originVideoTrack=void 0),this.updateVideoTrack(void 0)}stopAudio(){var t,r;this.originAudioTrack&&((t=this.originAudioTrack)==null||t.removeEventListener("ended",this.onAudioTrackEnded),(r=this.originAudioTrack)==null||r.stop(),this.originAudioTrack=void 0),this.updateAudioTrack(void 0)}stop(){this.stopVideo(),this.stopAudio()}updateVideoProfile(t,r){return Q(this,null,function*(){this._profileManager||(this._profileManager=new Cu),t&&this._profileManager.updateProfile(t,r),yield this._profileManager.setVideoProfile(this.originVideoTrack,this._publishVideoStream,this.type===Dt.AliRtcSdkStreamTypeScreen)})}get videoProfile(){var t;return(t=this.profileManager)==null?void 0:t.videoProfile}setVideoContentHint(t){this._profileManager||(this._profileManager=new Cu),this._profileManager.setContentHint(this.currentVideoTrack,t)}updateAudioProfile(t){return Q(this,null,function*(){this._profileManager||(this._profileManager=new Cu),this._profileManager.updateAudioProfile(t)})}cloneVideoProfile(t){return Q(this,null,function*(){var r;yield(r=this.profileManager)==null?void 0:r.setVideoProfile(void 0,t)})}addPlugin(t){const r=this.plugins.findIndex(n=>n.zIndex>t.zIndex);r>-1?this.plugins.splice(r,0,t):this.plugins.push(t)}removePlugin(t){const r=this.plugins.indexOf(t);return r>-1?(t.clear(this),this.plugins.splice(r,1),!0):!1}}var Zb=Object.defineProperty,e_=Object.getOwnPropertyDescriptor,Xr=(e,t,r,n)=>{for(var i=n>1?void 0:n?e_(t,r):t,o=e.length-1,s;o>=0;o--)(s=e[o])&&(i=(n?s(t,r,i):s(i))||i);return n&&i&&Zb(t,r,i),i},ko;const Fr=(ko=class extends Ut{constructor(e,t){super(),B(this,"pluginManager"),B(this,"slsReporter"),B(this,"publishingCameraVideoStream"),B(this,"publishingScreenVideoStream"),B(this,"cameraStreamInfo",new Il(Dt.AliRtcSdkStreamTypeCapture)),B(this,"screenStreamInfo",new Il(Dt.AliRtcSdkStreamTypeScreen)),B(this,"streamInfos",[this.cameraStreamInfo,this.screenStreamInfo]),B(this,"_audioCaptureDisabled",!1),B(this,"_cameraCaptureDisabled",!1),B(this,"_publishLocalAudioStreamEnabled",!0),B(this,"_publishLocalVideoStreamEnabled",!0),B(this,"_publishLocalScreenStreamEnabled",!0),this.screenStreamInfo.setVideoContentHint("motion"),this.pluginManager=e,this.slsReporter=t;const r=n=>Q(this,null,function*(){if(he.info(`[${ko.logName}]`,"plugin added",n.name),!n.isSupported("6.13.8-beta.0")){console.warn(`${n.name} is not supported!!!`),n.emit("unsupported");return}try{yield n.init()}catch(i){n.emit("error",ue.fromError(i,Bn.AliRtcPluginErrorInitError))}n.streamType===Dt.AliRtcSdkStreamTypeCapture&&(this.cameraStreamInfo.addPlugin(n),yield this.cameraStreamInfo.process(this.streamInfos)),n.streamType===Dt.AliRtcSdkStreamTypeScreen&&(this.screenStreamInfo.addPlugin(n),yield this.screenStreamInfo.process(this.streamInfos)),this.emit("publishupdate")});this.cameraStreamInfo.updateVideoProfile(Yv,xo),this.cameraStreamInfo.on("videotrackended",()=>Q(this,null,function*(){yield this.stopLocalStream({video:!0}),this.emit("trackended",gi.VideoTrackEnded)})),this.cameraStreamInfo.on("audiotrackended",()=>Q(this,null,function*(){yield this.stopLocalStream({audio:!0}),this.emit("trackended",gi.AudioTrackEnded)})),this.screenStreamInfo.updateVideoProfile(Qv,Uo),this.screenStreamInfo.on("videotrackended",()=>Q(this,null,function*(){yield this.stopLocalStream({screen:!0}),this.emit("trackended",gi.ScreenTrackEnded)})),this.pluginManager.on("added",r),this.pluginManager.on("removed",n=>Q(this,null,function*(){this.cameraStreamInfo.removePlugin(n)&&(yield this.cameraStreamInfo.process(this.streamInfos)),this.screenStreamInfo.removePlugin(n)&&(yield this.screenStreamInfo.process(this.streamInfos)),this.emit("publishupdate")})),this.pluginManager.on("updated",()=>Q(this,null,function*(){yield this.updateStreams()}))}get hasCamera(){return!!this.cameraStreamInfo.originVideoTrack}get audioCaptureDisabled(){return this._audioCaptureDisabled}set audioCaptureDisabled(e){this._audioCaptureDisabled=e}get cameraCaptureDisabled(){return this._cameraCaptureDisabled}set cameraCaptureDisabled(e){this._cameraCaptureDisabled=e}setAudioMuted(e){this.cameraStreamInfo.setAudioMuted(e)}get isAudioMuted(){return this.cameraStreamInfo.isAudioMuted}setCameraMuted(e){this.cameraStreamInfo.setVideoMuted(e)}get isCameraMuted(){return this.cameraStreamInfo.isVideoMuted}setScreenMuted(e){this.screenStreamInfo.setVideoMuted(e)}get isScreenMuted(){return this.screenStreamInfo.isVideoMuted}get publishLocalAudioStreamEnabled(){return this._publishLocalAudioStreamEnabled}set publishLocalAudioStreamEnabled(e){this._publishLocalAudioStreamEnabled=e}get publishLocalVideoStreamEnabled(){return this._publishLocalVideoStreamEnabled}set publishLocalVideoStreamEnabled(e){this._publishLocalVideoStreamEnabled=e}get publishLocalScreenStreamEnabled(){return this._publishLocalScreenStreamEnabled}set publishLocalScreenStreamEnabled(e){this._publishLocalScreenStreamEnabled=e}updateStreams(){return Q(this,null,function*(){yield this.cameraStreamInfo.process(this.streamInfos),yield this.screenStreamInfo.process(this.streamInfos),this.emit("publishupdate")})}setAvailableCameraDeviceId(){return Q(this,null,function*(){var e,t,r,n;if((e=this.cameraStreamInfo.cameraVideoConstraints)!=null&&e.deviceId){let i=(t=this.cameraStreamInfo.cameraVideoConstraints)==null?void 0:t.deviceId;const o=yield We.AliRTS.getCameraList();o.find(s=>s.deviceId===i)||(i=(n=(r=o.find(s=>!!s.deviceId))==null?void 0:r.deviceId)!=null?n:""),this.cameraStreamInfo.cameraVideoConstraints.deviceId=i}})}setAvailableMicrophoneDeviceId(){return Q(this,null,function*(){var e,t,r,n;if((e=this.cameraStreamInfo.micAudioConstraints)!=null&&e.deviceId){let i=(t=this.cameraStreamInfo.micAudioConstraints)==null?void 0:t.deviceId;const o=yield We.AliRTS.getMicList();o.find(s=>s.deviceId===i)||(i=(n=(r=o.find(s=>!!s.deviceId))==null?void 0:r.deviceId)!=null?n:""),this.cameraStreamInfo.micAudioConstraints.deviceId=i}})}createLocalStream(e){return Q(this,null,function*(){var t;const{screen:r,mediaStream:n,videoProfile:i,screenProfile:o}=e;let{video:s,audio:a}=e;const c=xb(e);let u;if(c){n||(s===!0&&this.cameraStreamInfo.cameraVideoConstraints?(yield this.setAvailableCameraDeviceId(),s=Ne({},this.cameraStreamInfo.cameraVideoConstraints)):typeof s=="object"&&(yield this.setAvailableCameraDeviceId(),s=Ne(Ne({},s),this.cameraStreamInfo.cameraVideoConstraints)),a===void 0&&this.audioCaptureDisabled?a=!1:a&&(a===!0&&this.cameraStreamInfo.micAudioConstraints?(yield this.setAvailableMicrophoneDeviceId(),a=Ne({},this.cameraStreamInfo.micAudioConstraints)):typeof a=="object"&&(yield this.setAvailableMicrophoneDeviceId(),a=Ne(Ne({},a),this.cameraStreamInfo.micAudioConstraints)),this._audioCaptureDisabled=!1));const d=Date.now();try{u=yield We.AliRTS.createStream({audio:a,video:s,screen:r,custom:!!n,mediaStream:n,skipProfile:!0}),a&&!n&&this.slsReporter.reportAudio(null,Date.now()-d,((t=u==null?void 0:u.audioTrack)==null?void 0:t.label)||""),r&&!n&&this.slsReporter.reportScreen(null,Date.now()-d)}catch(E){throw a&&!n&&this.slsReporter.reportAudio(E,Date.now()-d,""),r&&!n&&this.slsReporter.reportScreen(null,Date.now()-d),E}if(r)yield this.screenStreamInfo.updateSource(u,ao.Screen,Qa.Screen),yield this.setScreenProfile(o),this.setScreenContentHint(),this.publishingScreenVideoStream=void 0;else if(yield this.cameraStreamInfo.updateSource(u,ao.Camera,Qa.Microphone),u.hasVideo&&(yield this.setVideoProfile(i),this.setVideoContentHint(),this.publishingCameraVideoStream=void 0),u.hasAudio&&typeof a=="boolean"){const E=this.cameraStreamInfo.audioProfile;E&&(yield u.setAudioProfile(E))}}return We.AliRTS.SystenUtil.isIos&&We.AliRTS.SystenUtil.compareVersion("15.1")&&!We.AliRTS.SystenUtil.compareVersion("15.2")&&(yield xn(1e3)),yield this.updateStreams(),u})}stopLocalStream(e){return Q(this,null,function*(){const{screen:t,video:r,audio:n}=e??{};let i=!1;r&&this.cameraStreamInfo.originVideoTrack&&(i=!0,this.cameraStreamInfo.stopVideo(),this.publishingCameraVideoStream=void 0),n&&this.cameraStreamInfo.originAudioTrack&&(i=!0,this.cameraStreamInfo.stopAudio()),t&&this.screenStreamInfo.originVideoTrack&&(i=!0,this.screenStreamInfo.stop(),this.publishingScreenVideoStream=void 0,this.slsReporter.reportScreenStop(null)),i&&(yield this.updateStreams())})}get publishStreams(){const{publishLocalVideoStreamEnabled:e,publishLocalAudioStreamEnabled:t,publishLocalScreenStreamEnabled:r}=this;return{video:e?this.cameraStreamInfo.publishVideoStream:void 0,videoSmall:e?this.cameraStreamInfo.publishDualVideoStream:void 0,audio:t?this.cameraStreamInfo.publishAudioStream:void 0,screen:r?this.screenStreamInfo.publishVideoStream:void 0}}createHTTPPublishStream(){return Q(this,null,function*(){var e,t,r,n;let i,o=!1,s,a,c;const u=yield this.publishStreams;try{if(!u.audio&&!u.video&&!u.videoSmall&&!u.screen)throw he.error(`[${ko.logName}]`,"no tracks founded"),new ue(pe.ERR_SDK_PUBLISH_INVAILD,"no tracks founded");const d=new MediaStream;(e=u.audio)!=null&&e.audioTrack&&d.addTrack(u.audio.audioTrack),(t=u.video)!=null&&t.videoTrack?(d.addTrack(u.video.videoTrack),a=u.videoSmall,c=u.screen):(r=u.screen)!=null&&r.videoTrack&&(s=se.Screen,d.addTrack((n=u.screen)==null?void 0:n.videoTrack),o=!0),i=yield Zv(d),o?(this.screenStreamInfo.cloneVideoProfile(i),this.publishingScreenVideoStream=i):(this.cameraStreamInfo.cloneVideoProfile(i),this.publishingCameraVideoStream=i)}catch{}return{publishStream:i,videoSmallStream:a,screenStream:c,vMsid:s}})}stop(){this.cameraStreamInfo.stop(),this.screenStreamInfo.stop(),this.updateStreams()}setVideoProfile(e,t){return Q(this,null,function*(){yield this.cameraStreamInfo.updateVideoProfile(e,t),this.publishingCameraVideoStream&&this.cameraStreamInfo.cloneVideoProfile(this.publishingCameraVideoStream)})}setVideoContentHint(e){this.cameraStreamInfo.setVideoContentHint(e)}setAudioProfile(e){return Q(this,null,function*(){var t;yield this.cameraStreamInfo.updateAudioProfile(e),yield(t=this.publishingCameraVideoStream)==null?void 0:t.setAudioProfile(e)})}setScreenProfile(e,t){return Q(this,null,function*(){yield this.screenStreamInfo.updateVideoProfile(e,t),this.publishingScreenVideoStream&&this.screenStreamInfo.cloneVideoProfile(this.publishingScreenVideoStream)})}setScreenContentHint(e){this.screenStreamInfo.setVideoContentHint(e)}setCameraVideoConstraints(e){var t;this.cameraStreamInfo.cameraVideoConstraints=Ne(Ne({},(t=this.cameraStreamInfo.cameraVideoConstraints)!=null?t:{}),e)}setMicAudioConstraints(e){var t;this.cameraStreamInfo.micAudioConstraints=Ne(Ne({},(t=this.cameraStreamInfo.micAudioConstraints)!=null?t:{}),e)}},B(ko,"logName","LocalStreamManager"),ko);Xr([ee(([e])=>{const{audio:t,video:r,screen:n,custom:i,skipProfile:o,videoProfile:s,screenProfile:a}=e;return[{audio:t,video:r,screen:n,custom:i,skipProfile:o,videoProfile:s,screenProfile:a}]})],Fr.prototype,"createLocalStream",1);Xr([ee(ge)],Fr.prototype,"stopLocalStream",1);Xr([ee()],Fr.prototype,"createHTTPPublishStream",1);Xr([ee()],Fr.prototype,"stop",1);Xr([ee(ge)],Fr.prototype,"setVideoProfile",1);Xr([ee(ge)],Fr.prototype,"setVideoContentHint",1);Xr([ee(ge)],Fr.prototype,"setAudioProfile",1);Xr([ee(ge)],Fr.prototype,"setScreenProfile",1);Xr([ee(ge)],Fr.prototype,"setScreenContentHint",1);Xr([ee(ge)],Fr.prototype,"setCameraVideoConstraints",1);Xr([ee(ge)],Fr.prototype,"setMicAudioConstraints",1);let t_=Fr;class r_ extends _i{constructor(){super("AliRtcScreenStandardize",Dt.AliRtcSdkStreamTypeScreen),B(this,"canvas"),B(this,"lastWidth"),B(this,"lastHeight"),B(this,"hasScreenTrack",!1)}get initOptions(){return{base:4}}setOptions(t){this.options=t}isSupported(){return!(typeof TransformStream>"u"||typeof MediaStreamTrackProcessor>"u"||typeof MediaStreamTrackGenerator>"u")}updateProcessCanvas(t,r){if(this.canvas&&this.lastWidth===t&&this.lastHeight===r)return;const n=Math.ceil(t/this.options.base)*this.options.base,i=Math.ceil(r/this.options.base)*this.options.base;if(this.canvas||(this.canvas=document.createElement("canvas")),this.canvas.width=n,this.canvas.height=i,this.lastWidth&&t>this.lastWidth||this.lastHeight&&r>this.lastHeight){const o=this.canvas.getContext("2d");o&&o.clearRect(0,0,n,i)}this.lastWidth=t,this.lastHeight=r}shouldUpdate(t){return this.hasScreenTrack!==(!!t.originVideoTrack&&t.videoSource===ao.Screen)}handleFrame(t,r){return Q(this,null,function*(){var n;const{displayWidth:i,displayHeight:o}=t;if(!i||!o||i%this.options.base===0&&o%this.options.base===0)return this.clear(r),t;this.updateProcessCanvas(i,o);const s=(n=this.canvas)==null?void 0:n.getContext("2d");if(this.canvas&&s){s.drawImage(t,0,0,i,o);const a=new VideoFrame(this.canvas,{timestamp:t.timestamp});return t.close(),a}return t})}process(t){return Q(this,null,function*(){var r;if(!t.originVideoTrack||t.videoSource!==ao.Screen){this.clear(t),this.hasScreenTrack=!1;return}const n=new MediaStreamTrackProcessor({track:t.originVideoTrack}),i=new MediaStreamTrackGenerator({kind:"video"}),o=new MediaStream([i]),s=this,a=new TransformStream({transform(u,d){return Q(this,null,function*(){const E=yield s.handleFrame(u,t);yield d.enqueue(E),E==null||E.close()})}});n.readable.pipeThrough(a).pipeTo(i.writable);const c=(r=o.getVideoTracks())==null?void 0:r[0];t.updateVideoTrack(c),this.hasScreenTrack=!0})}clear(t){this.canvas=void 0,this.lastWidth=void 0,this.lastHeight=void 0,super.clear(t)}}class n_ extends _i{constructor(){super("blankAudio",Dt.AliRtcSdkStreamTypeCapture,Ts.BOTH),B(this,"hasTrack",!1),B(this,"oscillator",null),B(this,"audioTrack",null),B(this,"createAudioTrack",()=>{const t=new AudioContext;this.oscillator=t.createOscillator();const r=t.createGain();r.gain.value=0;const n=t.createMediaStreamDestination();this.oscillator.connect(r),r.connect(n),this.oscillator.start();const i=n.stream;return this.audioTrack=i.getAudioTracks()[0],this.audioTrack}),this.zIndex=9}isSupported(){return!0}setOptions(){throw new Error("Method not implemented.")}shouldUpdate(t,r){return this.hasTrack!==r.some(n=>n.originVideoTrack||n.originAudioTrack)}process(t,r){return Q(this,null,function*(){var n;const i=r.some(o=>o.originVideoTrack||o.originAudioTrack);this.hasTrack=i,i?this.audioTrack&&((n=this.oscillator)==null||n.stop(),this.oscillator=null,this.audioTrack.stop(),this.audioTrack=null):(this.audioTrack||(this.audioTrack=this.createAudioTrack()),t.updateAudioTrack(this.audioTrack))})}}class t1{constructor(t){B(this,"name","COMMON"),this.name=t||this.name}info(...t){}warn(...t){}print(t,...r){const n=t.toLowerCase();n&&console[n](`[${t}][${this.name}]`,...r)}}B(t1,"LEVEL",0);class i_{constructor(){B(this,"logger",new t1("AudioMixer")),B(this,"audioContext",new AudioContext),B(this,"audioDestination",this.audioContext.createMediaStreamDestination()),B(this,"audioTrack",Ob(this.audioDestination.stream)),B(this,"sourceNodeMap",{})}get sourceNodeList(){return Object.values(this.sourceNodeMap).map(t=>t.sourceNode).filter(t=>!!t)}get gainNodeList(){return Object.values(this.sourceNodeMap).map(t=>t.gainNode).filter(t=>!!t)}get sourceCount(){return this.sourceNodeList.length}resume(){var t;return(t=this.audioContext)==null?void 0:t.resume()}addTrack(t){this.connectTrack(t)}hasTrack(t){return!!this.sourceNodeMap[t]}removeTrack(t){const{sourceNode:r,gainNode:n}=this.sourceNodeMap[t]||{};n==null||n.disconnect(),r==null||r.disconnect(),delete this.sourceNodeMap[t],r?this.logger.info("SourceNode disconnected. Active source node:",this.sourceNodeList.length):this.logger.warn(`SourceNode ${t} does not exit. Active source node: ${this.sourceNodeList.length}`)}getAudioTrack(){return this.audioTrack}setVolume(t,r){const{gainNode:n}=this.sourceNodeMap[r]||{};n?(this.logger.info(`Setting node(${r}) volume to ${this.scale(t)}`),n.gain.value=this.scale(t)):this.logger.warn(`GainNode ${r} does not exit.`)}reset(){this.disconnectSourceNode(),this.sourceNodeMap={}}dispose(){var t;this.reset(),(t=this.audioTrack)==null||t.stop(),this.audioDestination.disconnect(),this.audioContext.close()}connectTrack(t){if(!this.audioContext)return this.logger.warn("AudioContext not initialized");let r=new MediaStream;r.addTrack(t);const n=this.audioContext.createMediaStreamSource(r),i=this.audioContext.createGain();i.gain.value=1,n.connect(i),i.connect(this.audioDestination),this.sourceNodeMap[t.id]={track:t,sourceNode:n,gainNode:i},this.logger.info("New sourceNode connected. Active source node:",this.sourceNodeList.length)}disconnectSourceNode(){this.sourceNodeList.forEach(t=>t.disconnect()),this.gainNodeList.forEach(t=>t.disconnect())}scale(t){return t/100}}const o_=4;class s_ extends _i{constructor(){super("audioMixer",Dt.AliRtcSdkStreamTypeCapture,Ts.AUDIO),B(this,"audioMixer"),B(this,"primaryAudioTrackId"),B(this,"screenAudioTrackId"),B(this,"dirty",!1),this.zIndex=8}get initOptions(){return{audio:1,screen:1}}setOptions(t){Object.entries(t).forEach(([r,n])=>{this.isValidVolume(n)&&(this.options[r]=n)}),this.dirty=!0,this.emit("updated")}isSupported(){return"AudioContext"in window}shouldUpdate(t,r){var n,i;if(t.type!==Dt.AliRtcSdkStreamTypeCapture)return!1;const o=r.find(a=>a.type===Dt.AliRtcSdkStreamTypeCapture),s=r.find(a=>a.type===Dt.AliRtcSdkStreamTypeScreen);return!(this.primaryAudioTrackId===((n=o==null?void 0:o.currentAudioTrack)==null?void 0:n.id)&&this.screenAudioTrackId===((i=s==null?void 0:s.currentAudioTrack)==null?void 0:i.id)&&!this.dirty)}process(t,r){return Q(this,null,function*(){var n,i;this.dirty=!1;const o=r.find(c=>c.type===Dt.AliRtcSdkStreamTypeScreen),s=t.currentAudioTrack,a=o==null?void 0:o.currentAudioTrack;if(!a&&this.options.audio===1){this.audioMixer&&(this.audioMixer.dispose(),this.audioMixer=void 0),this.primaryAudioTrackId=s==null?void 0:s.id,t.updateAudioTrack(s);return}this.audioMixer||(this.audioMixer=new i_),yield this.audioMixer.resume(),this.primaryAudioTrackId&&(s==null?void 0:s.id)!==this.primaryAudioTrackId&&((n=this.audioMixer)==null||n.removeTrack(this.primaryAudioTrackId)),s&&!this.audioMixer.hasTrack(s==null?void 0:s.id)&&this.audioMixer.addTrack(s),this.primaryAudioTrackId=s==null?void 0:s.id,this.screenAudioTrackId&&(a==null?void 0:a.id)!==this.screenAudioTrackId&&((i=this.audioMixer)==null||i.removeTrack(this.screenAudioTrackId)),a&&!this.audioMixer.hasTrack(a==null?void 0:a.id)&&this.audioMixer.addTrack(a),this.screenAudioTrackId=a==null?void 0:a.id,this.updateVolume(),t.updateAudioTrack(this.audioMixer.getAudioTrack())})}isValidVolume(t){return t!==void 0&&t>=0&&t<=o_}updateVolume(){this.audioMixer&&(this.primaryAudioTrackId&&this.audioMixer.setVolume(this.options.audio*100,this.primaryAudioTrackId),this.screenAudioTrackId&&this.audioMixer.setVolume(this.options.screen*100,this.screenAudioTrackId))}clear(t){var r;(r=this.audioMixer)==null||r.dispose(),super.clear(t)}}class sh{constructor(t,r){B(this,"originTrack"),B(this,"originVideo"),B(this,"targetWidth"),B(this,"targetHeight"),B(this,"targetFrameRate"),B(this,"targetCanvas"),B(this,"animationFrameId"),B(this,"resultTrack"),this.targetWidth=r.width,this.targetHeight=r.height,this.targetFrameRate=r.frameRate,this.originTrack=t,this.originVideo=document.createElement("video"),this.originVideo.muted=!0,this.originVideo.autoplay=!0,this.originVideo.controls=!1,this.targetCanvas=document.createElement("canvas"),this.targetCanvas.width=this.targetWidth,this.targetCanvas.height=this.targetHeight}updateOptions(t){this.targetWidth=t.width,this.targetHeight=t.height,this.targetFrameRate=t.frameRate,this.targetCanvas.width=this.targetWidth,this.targetCanvas.height=this.targetHeight,this.resultTrack&&this.resultTrack.applyConstraints({frameRate:this.targetFrameRate})}dispose(){}getVideoTrack(){return this.resultTrack||(this.resultTrack=this.targetCanvas.captureStream().getVideoTracks()[0],this.resultTrack.applyConstraints({frameRate:this.targetFrameRate})),this.resultTrack}cancelAnimation(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=void 0)}getPositionAndSize(t,r,n,i){const o=r/t,s=i/n;let a=n,c=i,u=0,d=0;return s>o?(a=Math.round(c/o),u=Math.round((n-a)/2)):s<o&&(c=Math.round(a*o),d=Math.round((i-c)/2)),{x:u,y:d,width:a,height:c}}}class a_ extends sh{constructor(t,r){super(t,r),B(this,"targetCtx"),this.targetCtx=this.targetCanvas.getContext("2d"),this.startRender=this.startRender.bind(this),this.stopRender=this.startRender.bind(this),this.initStream(t)}initStream(t){const r=new MediaStream;r.addTrack(t),this.originVideo.srcObject=r,this.originVideo.play(),this.originVideo.addEventListener("canplay",this.startRender),this.originVideo.addEventListener("pause",this.stopRender),this.originVideo.addEventListener("ended",this.stopRender)}startRender(){this.cancelAnimation();const t=()=>{if(!this.targetCtx)return;const r=this.getPositionAndSize(this.originVideo.videoWidth,this.originVideo.videoHeight,this.targetWidth,this.targetHeight);this.targetCtx.drawImage(this.originVideo,0,0,this.originVideo.videoWidth,this.originVideo.videoHeight,r.x,r.y,r.width,r.height),!this.originVideo.paused&&!this.originVideo.ended&&(this.animationFrameId=requestAnimationFrame(t))};t()}stopRender(){this.cancelAnimation()}dispose(){this.stopRender(),this.originVideo.removeEventListener("play",this.startRender),this.originVideo.removeEventListener("pause",this.stopRender),this.originVideo.removeEventListener("ended",this.stopRender),this.originVideo.pause(),this.originVideo.srcObject=null}}const c_=`
attribute vec2 a_position;
attribute vec2 a_texCoord;

uniform vec2 u_resolution;
varying vec2 v_texCoord;

void main() {
  // convert the rectangle from pixels to 0.0 to 1.0
  vec2 zeroToOne = a_position / u_resolution;

  // convert from 0->1 to 0->2
  vec2 zeroToTwo = zeroToOne * 2.0;

  // convert from 0->2 to -1->+1 (clipspace)
  vec2 clipSpace = zeroToTwo - 1.0;

  gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);

  v_texCoord = a_texCoord;
}
`,u_=`
precision mediump float;

varying lowp vec2 v_texCoord;
uniform sampler2D u_texture;

void main() {
  gl_FragColor = texture2D(u_texture, v_texCoord);
}
`;function l_(){let e;try{const t=document.createElement("canvas");t.width=1,t.height=1;const r={alpha:!1,depth:!1,stencil:!1,antialias:!1,preferLowPowerToHighPerformance:!0};e=t.getContext("webgl2",r)}catch{return!1}return!!e}function d_(e){const t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),t}function Wm(e,t,r){const n=e.createShader(t);if(!n){console.error("create shader failed");return}return e.shaderSource(n,r),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)?n:(console.error(`An error occurred compiling the shaders: ${e.getShaderInfoLog(n)}`),e.deleteShader(n),null)}function h_(e,t,r){const n=Wm(e,e.VERTEX_SHADER,t),i=Wm(e,e.FRAGMENT_SHADER,r),o=e.createProgram();if(!(!o||!n||!i))return e.attachShader(o,n),e.attachShader(o,i),e.linkProgram(o),e.getProgramParameter(o,e.LINK_STATUS)?o:(console.error(`Unable to initialize the shader program: ${e.getProgramInfoLog(o)}`),null)}function p_(e,t,r,n=0,i=0){const o=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,o);const s=n,a=i,c=t+n,u=r+i,d=[s,a,c,a,s,u,s,u,c,a,c,u];return e.bufferData(e.ARRAY_BUFFER,new Float32Array(d),e.STATIC_DRAW),o}class zm extends sh{constructor(t,r){super(t,r),B(this,"targetCtx"),B(this,"targetTexture"),B(this,"locationMap"),this.targetCtx=this.targetCanvas.getContext("webgl2"),this.locationMap={},this.startRender=this.startRender.bind(this),this.stopRender=this.startRender.bind(this),this.updateBuffer=this.updateBuffer.bind(this),this.initGL(),this.initStream(t)}static isSupport(){return l_()}initGL(){const t=this.targetCtx;if(!t)return;this.targetTexture=d_(t);const r=h_(t,c_,u_);if(!r){console.log("[ScalerWebGL] program is null.");return}t.useProgram(r);const n=t.getAttribLocation(r,"a_position"),i=t.getAttribLocation(r,"a_texCoord"),o=t.getUniformLocation(r,"u_resolution");if(!o){console.log("[ScalerWebGL] resolutionLocation is null.");return}const s=t.getUniformLocation(r,"u_texture");if(!s){console.log("[ScalerWebGL] textureLocation is null.");return}this.locationMap={program:r,positionLocation:n,texCoordLocation:i,resolutionLocation:o,textureLocation:s},this.updateBuffer()}initStream(t){const r=new MediaStream;r.addTrack(t),this.originVideo.srcObject=r,this.originVideo.play(),this.originVideo.addEventListener("canplay",this.startRender),this.originVideo.addEventListener("pause",this.stopRender),this.originVideo.addEventListener("ended",this.stopRender),this.originVideo.addEventListener("resize",this.updateBuffer)}startRender(){this.cancelAnimation();const t=()=>{this.targetCtx&&(this.renderTexture(),!this.originVideo.paused&&!this.originVideo.ended&&(this.animationFrameId=requestAnimationFrame(t)))};t()}updateBuffer(){const t=this.targetCtx,r=this.locationMap.positionLocation,n=this.locationMap.texCoordLocation,i=this.locationMap.resolutionLocation;if(!t||!this.originVideo.videoWidth||!this.originVideo.videoHeight)return;const o=this.getPositionAndSize(this.originVideo.videoWidth,this.originVideo.videoHeight,this.targetWidth,this.targetHeight),s=p_(t,o.width,o.height,o.x,o.y);t.enableVertexAttribArray(r),t.bindBuffer(t.ARRAY_BUFFER,s),t.vertexAttribPointer(r,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(n);const a=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,a),t.vertexAttribPointer(n,2,t.FLOAT,!1,0,0),t.uniform2f(i,this.targetWidth,this.targetHeight)}renderTexture(){const t=this.targetTexture,r=this.targetCtx,n=this.locationMap.textureLocation;!t||!r||(r.bindTexture(r.TEXTURE_2D,t),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,this.originVideo),r.useProgram(this.locationMap.program),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,t),r.uniform1i(n,0),r.viewport(0,0,r.canvas.width,r.canvas.height),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),r.drawArrays(r.TRIANGLES,0,6))}stopRender(){this.cancelAnimation()}updateOptions(t){super.updateOptions(t),this.updateBuffer()}dispose(){this.stopRender(),this.originVideo.removeEventListener("play",this.startRender),this.originVideo.removeEventListener("pause",this.stopRender),this.originVideo.removeEventListener("ended",this.stopRender),this.originVideo.removeEventListener("resize",this.updateBuffer),this.originVideo.pause(),this.originVideo.srcObject=null}}const f_=`
var targetOptions={
  width: 320,
  height: 180,
  ratio: 0.5625,
  interval: 66,
};
var timer;
var reader;
var writer;

function updateOptions(data) {
  targetOptions.width=data.width||320;
  targetOptions.height=data.height||180;
  targetOptions.ratio=targetOptions.height/targetOptions.width;
  targetOptions.interval=Math.floor(1000/data.frameRate)||66;
}

function postError(err, defaultMsg) {
  var msg=err ? err.message : '';
  postMessage({ type: 'error', messge: msg || defaultMsg });
}

function startLoop(data) {
  if(timer){
    clearInterval(timer);
  }
  timer=setInterval(() => {
    reader.read().then(function (ret){
      var videoFrame=ret.value;
      if(ret.done || !videoFrame) {
        return;
      }

      var vratio=videoFrame.displayHeight/videoFrame.displayWidth;
      var vw=videoFrame.displayWidth;
      var vh=videoFrame.displayHeight;
      var vx=0;
      var vy=0;
      if(targetOptions.ratio>vratio){
        vw=Math.round(vh/targetOptions.ratio);
        vx=Math.round((videoFrame.displayWidth-vw)/2);
      }else if(targetOptions.ratio<vratio){
        vh=Math.round(vw*targetOptions.ratio);
        vy=Math.round((videoFrame.displayHeight-vh)/2);
      }
      var newFrame=new VideoFrame(videoFrame,{
        displayWidth:targetOptions.width,
        displayHeight:targetOptions.height,
        visibleRect:{
          x:vx,
          y:vy,
          width:vw,
          height:vh,
        },
        timestamp:videoFrame.timestamp,
      });

      writer.write(newFrame).catch(function (err){
        postError(err, 'write error');
      });
      videoFrame.close();
    }).catch(function (err){
      postError(err, 'read error');
    });
  }, targetOptions.interval);
}

onmessage = function(evt) {
  var data=evt.data;
  switch (data.type) {
    case 'startRender':
      updateOptions(data);
      reader=data.readable.getReader();
      writer=data.writable.getWriter();
      startLoop(data);
      break;
    case 'updateOptions':
      updateOptions(data);
      startLoop(data);
      break;
    default:
      break;
  }
}
`;class $m extends sh{constructor(t,r){super(t,r),B(this,"processor"),B(this,"trackGenerator"),B(this,"worker"),this.processor=new MediaStreamTrackProcessor({track:t}),this.trackGenerator=new MediaStreamTrackGenerator({kind:"video"}),this.startTransform()}static isSupport(){return"MediaStreamTrackProcessor"in window&&"MediaStreamTrackGenerator"in window&&"TransformStream"in window&&"VideoFrame"in window}startTransform(){const t=new Blob([f_],{type:"text/javascript"}),r=(window.URL||window.webkitURL).createObjectURL(t);this.worker=new Worker(r);const{readable:n}=this.processor,{writable:i}=this.trackGenerator;this.worker.postMessage({type:"startRender",readable:n,writable:i,width:this.targetWidth,height:this.targetHeight,frameRate:this.targetFrameRate},[n,i])}updateOptions(t){super.updateOptions(t),this.worker&&this.worker.postMessage(Ne({type:"updateOptions"},t))}dispose(){try{this.processor.readable.cancel(),this.trackGenerator.writable.close()}catch{}}getVideoTrack(){return this.trackGenerator}}class Ol{static isSupport(){return typeof HTMLCanvasElement.prototype.captureStream=="function"}static getInstance(t,r){return $m.isSupport()?new $m(t,r):zm.isSupport()?new zm(t,r):new a_(t,r)}}class m_ extends _i{constructor(){super(...arguments),B(this,"hasVideoTrack",!1),B(this,"videoScaler")}get initOptions(){return{width:320,height:180,frameRate:15}}setOptions(t){var r;this.options=t,(r=this.videoScaler)==null||r.updateOptions(t)}isSupported(){return Ol.isSupport()}shouldUpdate(t){return this.hasVideoTrack!==!!t.currentVideoTrack}process(t){return Q(this,null,function*(){if(t.currentVideoTrack){if(this.hasVideoTrack=!0,!this.videoScaler){const n=this.options||this.initOptions;this.videoScaler=Ol.getInstance(t.currentVideoTrack,n)}const r=this.videoScaler.getVideoTrack();r&&t.updateDualVideoTrack(r)}else t.updateDualVideoTrack(),this.emit("updated"),this.videoScaler&&this.videoScaler.dispose()})}clear(t){super.clear(t),this.hasVideoTrack=!1,t==null||t.updateDualVideoTrack()}}var g_=Object.defineProperty,v_=Object.getOwnPropertyDescriptor,Sr=(e,t,r,n)=>{for(var i=n>1?void 0:n?v_(t,r):t,o=e.length-1,s;o>=0;o--)(s=e[o])&&(i=(n?s(t,r,i):s(i))||i);return n&&i&&g_(t,r,i),i};class tr extends Ut{constructor(t){super(),B(this,"self"),B(this,"userMap",{}),B(this,"usersViewMap",{}),B(this,"rtsManager"),B(this,"localStreamManager"),B(this,"authInfo"),B(this,"signalingManager"),B(this,"pluginManager"),B(this,"audioMixerPlugin"),B(this,"dualVideoPlugin"),B(this,"blankAudioPlugin"),B(this,"slsReporter"),B(this,"statsMonitorId"),B(this,"autoSubAudio",!0),B(this,"autoSubVideo",!0),B(this,"autoSubScreen",!0),B(this,"wantSubAudio",!0),B(this,"wantSubVideo",!0),B(this,"wantSubScreen",!0),B(this,"defaultStreamType",Lt.AliRtcVideoStreamTypeHigh),B(this,"audioMuted",!1),B(this,"playoutVolume",1),B(this,"audioVolumeIndicationInterval",0),B(this,"indicationTimer",0),B(this,"parameter",{}),B(this,"publishRetryOptionsHook",()=>{var i;for(const o of this.remoteUsers)o.restore();(i=this.self)==null||i.clearDataChannel()}),B(this,"subscribeRetryOptionsHook",()=>{var i;(i=this.self)==null||i.clearDataChannel();let o=!1,s;for(const a of this.remoteUsers)if(o)a.restore();else{const c=a.getRetryOptions();c&&(s=c,o=!0)}return s});const{signalingManager:r,slsReporter:n}=t;this.signalingManager=r,this.addSignalingManagerListener(),this.slsReporter=n,this.pluginManager=new qb,this.localStreamManager=new t_(this.pluginManager,this.slsReporter),this.rtsManager=new Xb(this.localStreamManager,this.slsReporter,this.publishRetryOptionsHook,this.subscribeRetryOptionsHook,this.parameter),this.self=new Fm({rtsManager:this.rtsManager,localStreamManager:this.localStreamManager,slsReporter:this.slsReporter,signalingManager:this.signalingManager,pluginManager:this.pluginManager,audioVolumeIndicationInterval:this.audioVolumeIndicationInterval,parameter:this.parameter}),this.audioMixerPlugin=new s_,this.pluginManager.add(this.audioMixerPlugin),this.dualVideoPlugin=new m_("dualVideoPlugin"),db()&&this.pluginManager.add(new r_)}addSignalingManagerListener(){this.signalingManager.on("onNotifyPublish",t=>{he.event("[Signaling] Notify Publish ",t),t.forEach(r=>{this.onRemotePublishStateChange(r)})}),this.signalingManager.stsManager.on("onTokenUpdate",(t,r)=>{this.slsReporter.updateToken(r,t)})}isAutoSubAudio(){return this.autoSubAudio}setAutoSubAudio(t){this.autoSubAudio=t}isAutoSubVideo(){return this.autoSubVideo}setAutoSubVideo(t){this.autoSubVideo=t}isAutoSubScreen(){return this.autoSubScreen}setAutoSubScreen(t){this.autoSubScreen=t}isWantSubAudio(){return this.wantSubAudio}setWantSubAudio(t){this.wantSubAudio=t,this.remoteUsers.forEach(r=>{r.setWantSubAudio(t),r.updateSubscribe(tt.User)})}isWantSubVideo(){return this.wantSubVideo}setWantSubVideo(t){this.wantSubVideo=t,this.remoteUsers.forEach(r=>{r.setWantSubVideo(t),r.updateSubscribe(tt.User)})}isWantSubScreen(){return this.wantSubScreen}setWantSubScreen(t){this.wantSubScreen=t,this.remoteUsers.forEach(r=>{r.setWantSubScreen(t),r.updateSubscribe(tt.User)})}setRemoteDefaultVideoStreamType(t){this.defaultStreamType=t,this.remoteUsers.forEach(r=>{r.setRemoteDefaultVideoStreamType(t)})}setRemoteUserVideoStreamType(t,r){var n;(n=this.getRemoteUser(t))==null||n.setRemoteDefaultVideoStreamType(r)}setAudioMuted(t){this.audioMuted=t,this.remoteUsers.forEach(r=>{r.setAudioMuted(t)})}setLocalViewConfig(t,r){var n;if(!t)return(n=this.publisher)==null?void 0:n.setViewConfig(null,r);const i=Pl(t);i.length!==0&&i.forEach(o=>{var s,a;(s=this.publisher)==null||s.resetElement(o),Object.values(this.usersViewMap).forEach(({cameraViews:c=[],screenViews:u=[]})=>{c.includes(o)&&c.splice(c.indexOf(o),1),u.includes(o)&&u.splice(u.indexOf(o),1)}),(a=this.publisher)==null||a.setViewConfig(i,r)})}setRemoteViewConfig(t,r,n){var i,o;if(!r)return(i=this.userMap[t])==null?void 0:i.setViewConfig(null,n);const s=Pl(r);s.length!==0&&(s.forEach(a=>{var c;(c=this.publisher)==null||c.resetElement(a),Object.values(this.usersViewMap).forEach(({cameraViews:u=[],screenViews:d=[]})=>{u.includes(a)&&u.splice(u.indexOf(a),1),d.includes(a)&&d.splice(d.indexOf(a),1)})}),(o=this.userMap[t])==null||o.setViewConfig(s,n))}get channel(){var t;return(t=this.authInfo)==null?void 0:t.channelId}get userId(){var t;return(t=this.authInfo)==null?void 0:t.userId}get remoteUsers(){return Object.values(this.userMap)}get publisher(){return this.self}get isSubscribing(){var t;return((t=this.remoteUsers)!=null?t:[]).some(r=>{const{isAudioSubscribing:n,isVideoSubscribing:i,isScreenSubscribing:o}=r;return n||i||o})}onRemotePublishStateChange(t){var r;const{userid:n,callid:i,subscribe:o,pubid:s="",tracks:a}=t,c=(r=o==null?void 0:o.pullstreamurl)!=null?r:"";let u=this.getRemoteUser(n);if(!u)return;const d=u.streamInfo.audioTrackInfo,E=u.streamInfo.videoTrackInfo;u.updateRemoteTracks(i,c,s,a),u.updateSubscribe(tt.Publish),(d!==u.streamInfo.audioTrackInfo||E!==u.streamInfo.videoTrackInfo)&&this.emit("remoteTrackAvailableChange",n,u.streamInfo.audioTrackInfo,u.streamInfo.videoTrackInfo)}init(t,r){var n;this.authInfo=t,this.self||(this.self=new Fm({rtsManager:this.rtsManager,localStreamManager:this.localStreamManager,slsReporter:this.slsReporter,signalingManager:this.signalingManager,pluginManager:this.pluginManager,audioVolumeIndicationInterval:this.audioVolumeIndicationInterval,parameter:this.parameter})),this.self.enableAudioVolumeIndication(this.audioVolumeIndicationInterval),(n=this.self)==null||n.initInfo(t,r.pushstreamurl),r.users.forEach(i=>{const o=i.userid;if(o){const s=this.addUser(o,i.displayname,tt.InRoom),{callid:a,subscribe:c,tracks:u}=i;s.updateRemoteTracks(a,(c==null?void 0:c.pullstreamurl)||"","",u),this.emit("remoteTrackAvailableChange",o,s.streamInfo.audioTrackInfo,s.streamInfo.videoTrackInfo)}}),this.startStatsMonitor()}leave(){return Q(this,null,function*(){var t;this.stopStatsMonitor(),Object.values(this.usersViewMap).forEach(({cameraViews:r=[],screenViews:n=[]})=>{r.forEach(i=>{i.srcObject=null,i._playPromise=void 0}),n.forEach(i=>{i.srcObject=null,i._playPromise=void 0})}),this.usersViewMap={};for(let r in this.userMap)this.userMap[r]&&(this.userMap[r].clear(),delete this.userMap[r]);(t=this.self)==null||t.leave(),this.localStreamManager.stop(),this.rtsManager.clear(),this.authInfo=void 0})}clear(){return Q(this,null,function*(){var t;yield this.leave(),(t=this.self)==null||t.clear(),this.pluginManager.removeAll()})}startStatsMonitor(){this.statsMonitorId=window.setInterval(()=>Q(this,null,function*(){if(this.publisher){const{audio:n,video:i,candidate:o}=yield this.publisher.getStats();n&&n.length>0&&this.emit("rtcLocalAudioStats",n),i&&i.length>0&&this.emit("rtcLocalVideoStats",i),o&&this.emit("rtcStats",o)}const t=[],r=[];for(const n of this.remoteUsers){const{audio:i,video:o}=yield n.getStats();i&&i.forEach(s=>{t.push(s)}),o&&o.forEach(s=>{r.push(s)})}t.length>0&&this.emit("rtcRemoteAudioStats",t),r.length>0&&this.emit("rtcRemoteVideoStats",r)}),2e3)}stopStatsMonitor(){this.statsMonitorId&&clearInterval(this.statsMonitorId)}addUser(t,r,n){return this.userMap[t]||(this.userMap[t]=this.executeAddUser(t,r,n)),this.userMap[t]}executeAddUser(t,r,n){const i=new Jb({userId:t,displayName:r,rtsManager:this.rtsManager,signalingManager:this.signalingManager,usersViewMap:this.usersViewMap,slsReporter:this.slsReporter,localUser:this.self,audioVolumeIndicationInterval:this.audioVolumeIndicationInterval,playoutVolume:this.playoutVolume,parameter:this.parameter});return i.on(ir.Remote,this.onRemoteDeviceStatusChange.bind(this)),i.on(Ye.PullStreamStats,this.onRemoteStatReport.bind(this)),i.on(Ye.RtsSubscribeExceeds,this.onSubscribeExceeds.bind(this)),i.on("audioSubscribeStateChanged",(o,s,a,c)=>{this.emit("audioSubscribeStateChanged",o,s,a,c,this.channel||"")}),i.on("videoSubscribeStateChanged",(o,s,a,c)=>{this.emit("videoSubscribeStateChanged",o,s,a,c,this.channel||"")}),i.on("screenSubscribeStateChanged",(o,s,a,c)=>{this.emit("screenSubscribeStateChanged",o,s,a,c,this.channel||"")}),i.on("dataSubscribeStateChanged",(o,s,a,c)=>{this.emit("dataSubscribeStateChanged",o,s,a,c,this.channel||"")}),i.on("remoteAudioAutoPlayFail",o=>{this.emit("remoteAudioAutoPlayFail",o)}),i.on("remoteVideoAutoPlayFail",(o,s)=>{this.emit("remoteVideoAutoPlayFail",o,s)}),i.on("remoteAudioPlayError",(o,s)=>{this.emit("remoteAudioPlayError",o,s)}),i.on("remoteVideoPlayError",(o,s)=>{this.emit("remoteVideoPlayError",o,s)}),i.on("remoteSubscribeError",o=>{this.emit("remoteSubscribeError",o,i.userId)}),i.on("occurError",o=>{this.emit("occurError",o,i.userId)}),i.on("remoteDataChannelMessage",(o,s)=>{this.emit("remoteDataChannelMessage",o,s)}),i.setWantSubAudio(this.autoSubAudio&&this.wantSubAudio),i.setWantSubVideo(this.autoSubVideo&&this.wantSubVideo),i.setWantSubScreen(this.autoSubScreen&&this.wantSubScreen),i.setRemoteDefaultVideoStreamType(this.defaultStreamType),i.setAudioMuted(this.audioMuted),(this.autoSubAudio||this.autoSubVideo||this.autoSubScreen)&&i.updateSubscribe(n),i}onRemoteDeviceStatusChange(t,r){t===Ye.MuteAudio?this.emit("userAudioMuted",r,!0):t===Ye.UnmuteAudio?this.emit("userAudioMuted",r,!1):t===Ye.MuteVideo?this.emit("userVideoMuted",r,!0):t===Ye.UnmuteVideo?this.emit("userVideoMuted",r,!1):t===Ye.MuteScreen?this.emit("userScreenMuted",r,!0):t===Ye.UnmuteScreen&&this.emit("userScreenMuted",r,!1)}onRemoteStatReport(t,r,n){this.emit(Ye.PullStreamStats,t,r,n)}onSubscribeExceeds(t,r){this.emit(Ye.RtsSubscribeExceeds,t,r)}removeLeftUser(t){return Q(this,null,function*(){t.userid&&this.userMap[t.userid]&&(yield this.userMap[t.userid].clear(!1),delete this.userMap[t.userid])})}updateUsers(t){const r=[],n=[],i={};t.forEach(a=>{a.userid&&(this.userMap[a.userid]?(n.push(a),i[a.userid]=this.userMap[a.userid]):(r.push(a),i[a.userid]=this.executeAddUser(a.userid,a.displayname,tt.Resume)))});const o=Object.keys(this.userMap),s=[];return o.forEach(a=>{i[a]||s.push({userid:a,reason:"",leavecode:rh.AliRtcUserOfflineQuit})}),this.userMap=i,{joinList:r,leaveList:s,presentList:n}}getRemoteUser(t){return this.userMap[t]}updateRemoteUserDeviceStatus(t){t&&t.userid&&this.userMap[t.userid]&&this.userMap[t.userid].updateRemoteUserDeviceStatus(t.status)}updateAudioWant(t,r){const n=this.userMap[t];if(!n)throw new ue(pe.ERR_INNER,`no remote user(${t}) founded`);n.setWantSubAudio(r),r?n.updateSubscribe(tt.User):n.stopSubscribe({audio:!0})}updateVideoWant(t,r){const n=this.userMap[t];if(!n)throw new ue(pe.ERR_INNER,`no remote user(${t}) founded`);n.setWantSubVideo(r),r?n.updateSubscribe(tt.User):n.stopSubscribe({video:!0})}updateScreenWant(t,r){const n=this.userMap[t];if(!n)throw new ue(pe.ERR_INNER,`no remote user(${t}) founded`);n.setWantSubScreen(r),r?n.updateSubscribe(tt.User):n.stopSubscribe({screen:!0})}stopIndication(){this.indicationTimer&&window.clearInterval(this.indicationTimer)}startIndication(t){this.stopIndication(),this.indicationTimer=window.setInterval(()=>{var r;const n=this.remoteUsers.map(i=>({userId:i.userId,volume:i.getAudioLevel()||0}));n.unshift({userId:"",volume:((r=this.self)==null?void 0:r.getAudioLevel())||0}),this.emit("audioVolume",n)},t)}setEnableDualVideoStream(t,r){if(!this.dualVideoPlugin)return;r&&this.dualVideoPlugin.setOptions(r);const n=this.pluginManager.has(this.dualVideoPlugin.name);t?!n&&this.pluginManager.add(this.dualVideoPlugin):n&&this.pluginManager.remove(this.dualVideoPlugin.name)}setAudioVolume(t){var r;(r=this.audioMixerPlugin)==null||r.setOptions(t)}enableAudioVolumeIndication(t){var r;this.audioVolumeIndicationInterval!==t&&(this.audioVolumeIndicationInterval>0&&t<=0&&this.stopIndication(),t>0&&this.startIndication(t),this.audioVolumeIndicationInterval=t,this.remoteUsers.forEach(n=>{n.enableAudioVolumeIndication(t)}),(r=this.self)==null||r.enableAudioVolumeIndication(t))}setPlayoutVolume(t){this.playoutVolume=t,this.remoteUsers.forEach(r=>{r.setPlayoutVolume(t)})}refreshAuthInfo(t){var r;this.authInfo&&(this.authInfo=Ne(Ne({},this.authInfo),t)),t.userId&&((r=this.self)==null||r.refreshUserInfo(t.userId))}setEnableMediaExtensionMsg(t){this.rtsManager.setEncodedInsertableStreams(t)}setAudioRedEnabled(t){this.rtsManager.setAudioRedEnabled(t)}setParameter(t){var r,n,i;const o=JSON.parse(t);Object.keys(o).forEach(s=>{const a=this.parameter[s],c=o[s];typeof a=="object"&&typeof c=="object"?this.parameter[s]=Ne(Ne({},a),c):this.parameter[s]=c}),o.enableBlankAudio===!0?(this.blankAudioPlugin||(this.blankAudioPlugin=new n_),this.pluginManager.has((r=this.blankAudioPlugin)==null?void 0:r.name)||this.pluginManager.add(this.blankAudioPlugin)):o.enableBlankAudio===!1&&(this.blankAudioPlugin&&this.pluginManager.remove((n=this.blankAudioPlugin)==null?void 0:n.name),(i=this.blankAudioPlugin)==null||i.clear(),this.blankAudioPlugin=void 0)}getParameter(){return JSON.stringify(this.parameter)}sendDataChannelMessage(t){var r;return(r=this.self)==null?void 0:r.sendDataChannelMessage(t)}}B(tr,"logName","BizControl");Sr([ee()],tr.prototype,"init",1);Sr([ee()],tr.prototype,"leave",1);Sr([ee()],tr.prototype,"clear",1);Sr([ee(ge)],tr.prototype,"addUser",1);Sr([ee()],tr.prototype,"removeLeftUser",1);Sr([ee()],tr.prototype,"updateUsers",1);Sr([ee(ge)],tr.prototype,"updateAudioWant",1);Sr([ee(ge)],tr.prototype,"updateVideoWant",1);Sr([ee(ge)],tr.prototype,"updateScreenWant",1);Sr([ee()],tr.prototype,"stopIndication",1);Sr([ee()],tr.prototype,"startIndication",1);Sr([ee(ge)],tr.prototype,"setEnableDualVideoStream",1);Sr([ee(ge)],tr.prototype,"setAudioVolume",1);Sr([ee()],tr.prototype,"enableAudioVolumeIndication",1);const wu=e=>Q(void 0,null,function*(){const t=new Uint8Array(160).fill(170),r=new TextEncoder().encode(e),n=yield window.crypto.subtle.importKey("raw",t,{name:"HMAC",hash:{name:"SHA-1"}},!1,["sign"]),i=yield window.crypto.subtle.sign("HMAC",n,r);return Array.from(new Uint8Array(i)).map(o=>o.toString(16).padStart(2,"0")).join("")});class S_{constructor(t){B(this,"authInfo"),B(this,"slsReporter"),this.slsReporter=t}doRequest(t,r){var n;const i=this.authInfo;if(!i)return Promise.reject(on.LiveTranscodingErrorInvalidParam);const o="https://gw.rtn.aliyuncs.com",s=pb[t],a={appid:i.appId,userid:i.userId,channelid:i.channelId,timestamp:i.timestamp,token:i.token,nonce:i.nonce?i.nonce:"",requestid:vr.createCallid(),tokensid:!1,session:(n=i.sessionId)!=null?n:vr.createCallid()},c=Object.keys(a).map(d=>`${d}=${encodeURIComponent(a[d])}`).join("&"),u=`${o}${s}?${c}`;return fetch(u,{method:"POST",headers:{"Content-Type":"application/json; charset=UTF-8"},body:JSON.stringify(r)}).then(d=>d.status!==200?(this.slsReporter.reportTranscodingError(d.status,r.taskid||""),Promise.reject(new ue(pe.ERR_INNER,`transcoding request failed, status: ${d.status}`))):d).catch(d=>Promise.reject(new ue(pe.ERR_INNER,`transcoding request failed, err: ${d.message}`)))}setAuthInfo(t){this.authInfo=t}clear(){this.authInfo=void 0}startPublishLiveStream(t,r){return Q(this,null,function*(){if(!this.authInfo)return Promise.reject(on.LiveTranscodingErrorInvalidParam);const n=yield wu(t.split("?")[0]),i=lr.MPU_TASK_TRANSACTION_UPDATE,o=r.toJson(i,this.authInfo,n,t);return this.doRequest(i,o)})}startPublishLiveStreamWithTaskId(t,r){return Q(this,null,function*(){if(!this.authInfo)return Promise.reject(on.LiveTranscodingErrorInvalidParam);const n=lr.MPU_TASK_TRANSACTION_UPDATE,i=r.toJson(n,this.authInfo,t);return this.doRequest(n,i)})}updatePublishLiveStream(t,r){return Q(this,null,function*(){if(!this.authInfo)return Promise.reject(on.LiveTranscodingErrorInvalidParam);const n=yield wu(t.split("?")[0]),i=lr.MPU_TASK_TRANSACTION_UPDATE,o=r.toJson(i,this.authInfo,n,t);return this.doRequest(i,o)})}updatePublishLiveStreamWithTaskId(t,r){return Q(this,null,function*(){if(!this.authInfo)return Promise.reject(on.LiveTranscodingErrorInvalidParam);const n=lr.MPU_TASK_TRANSACTION_UPDATE,i=r.toJson(n,this.authInfo,t);return this.doRequest(n,i)})}stopPublishLiveStream(t){return Q(this,null,function*(){if(!this.authInfo)return Promise.reject(on.LiveTranscodingErrorInvalidParam);const r=yield wu(t.split("?")[0]),n=lr.MPU_TASK_TRANSACTION_STOP,i=new Za().toJson(n,this.authInfo,r,t);return this.doRequest(n,i)})}stopPublishLiveStreamWithTaskId(t){if(!this.authInfo)return Promise.reject(on.LiveTranscodingErrorInvalidParam);const r=lr.MPU_TASK_TRANSACTION_STOP,n=new Za().toJson(r,this.authInfo,t);return this.doRequest(r,n)}refreshAuthInfo(t){this.authInfo&&this.setAuthInfo(Ne(Ne({},this.authInfo),t))}}class ah{static checkString(t){return typeof t=="string"}static checkNumber(t){return typeof t=="number"}static checkHtmlVideoElement(t){return t&&t.nodeName==="VIDEO"}static checkHtmlAudioElement(t){return t&&t.nodeName==="AUDIO"}static checkAuthInfo(t){if(!t)return new ue(pe.ERR_JOIN_ERR_JOIN_BAD_PARAMBAD,"no authInfo founded");if(!t.appId)return new ue(pe.ERR_JOIN_ERR_JOIN_BAD_PARAMBAD,"no appId founded");if(!t.channelId)return new ue(pe.ERR_JOIN_ERR_JOIN_BAD_PARAMBAD,"no channelId founded");if(!t.userId)return new ue(pe.ERR_JOIN_ERR_JOIN_BAD_PARAMBAD,"no userId founded");if(t.timestamp){if(!ah.checkNumber(t.timestamp))return new ue(pe.ERR_JOIN_ERR_JOIN_BAD_PARAMBAD,"timestamp is not number")}else return new ue(pe.ERR_JOIN_ERR_JOIN_BAD_PARAMBAD,"no timestamp founded");return t.token?null:new ue(pe.ERR_JOIN_ERR_JOIN_BAD_PARAMBAD,"no token founded")}static checkMediaStreamTrack(t){return t instanceof MediaStreamTrack}static checkVideoEncoderConfiguration(t){return t&&(t.width||t.height||t.frameRate||t.bitrateMax)}}class r1{constructor(t){B(this,"taskProfile"),B(this,"encodeParam"),B(this,"users",[]),B(this,"backgroundColor",0),B(this,"backgrounds",[]),B(this,"watermarks",[]),B(this,"clockWidgets",[]),B(this,"cropMode"),B(this,"mediaProcessMode"),this.taskProfile=t}}class n1{constructor(t,r,n){B(this,"userId"),B(this,"streamType"),B(this,"sourceType"),this.userId=t,this.streamType=r,this.sourceType=n}}class i1{constructor(t,r,n,i=0,o=16777215,s=Cs.NOTO_SERIF_CJKSC_REGULAR){B(this,"x"),B(this,"y"),B(this,"fontSize"),B(this,"zOrder"),B(this,"fontColor"),B(this,"fontType"),this.x=t,this.y=r,this.fontSize=n,this.zOrder=i,this.fontColor=o,this.fontType=s}toJson(t,r){return{x:Ur(this.x,t),y:Ur(this.y,r),fonttype:this.fontType,fontsize:this.fontSize,fontcolor:th(this.fontColor),zorder:this.zOrder}}}var o1=(e=>(e[e.NOT_DISPLAY=0]="NOT_DISPLAY",e[e.ALWAYS=1]="ALWAYS",e[e.WHEN_NO_VIDEO=2]="WHEN_NO_VIDEO",e))(o1||{});class ch{constructor(t,r,n,i,o,s=0,a=1,c=1){B(this,"url"),B(this,"x"),B(this,"y"),B(this,"width"),B(this,"height"),B(this,"alpha"),B(this,"display",1),B(this,"zOrder"),this.url=t,this.x=r,this.y=n,this.width=i,this.height=o,this.zOrder=s,this.alpha=a,this.display=c}toJson(t,r){return{url:this.url,alpha:this.alpha,display:this.display,x:Ur(this.x,t),y:Ur(this.y,r),width:Ur(this.width,t),height:Ur(this.height,r),zorder:this.zOrder}}}B(ch,"DisplayType",o1);class s1{constructor(t,r,n,i,o=0,s=16777215,a=Cs.NOTO_SERIF_CJKSC_REGULAR){B(this,"text"),B(this,"x"),B(this,"y"),B(this,"fontSize"),B(this,"zOrder"),B(this,"fontColor"),B(this,"fontType"),this.text=t,this.x=r,this.y=n,this.fontSize=i,this.zOrder=o,this.fontColor=s,this.fontType=a}toJson(t,r){return{text:this.text,x:Ur(this.x,t),y:Ur(this.y,r),fonttype:this.fontType,fontsize:this.fontSize,fontcolor:th(this.fontColor),zorder:this.zOrder}}}class a1{constructor(t,r,n,i,o,s=0,a){B(this,"userId"),B(this,"x"),B(this,"y"),B(this,"width"),B(this,"height"),B(this,"zOrder"),B(this,"sourceType"),B(this,"segmentType",gs.LiveTranscodingNoBody),B(this,"images",[]),B(this,"texts",[]),typeof t=="number"?this.userId=t.toString():this.userId=t,this.x=r,this.y=n,this.width=i,this.height=o,this.zOrder=s,a&&(this.sourceType=a)}toJson(t,r,n,i){const o={paneid:t,majorpane:0,x:Ur(this.x,r),y:Ur(this.y,n),width:Ur(this.width,r),height:Ur(this.height,n),zorder:this.zOrder,userid:this.userId,images:this.images.map(s=>s.toJson(r,n)),texts:this.texts.map(s=>s.toJson(r,n))};return this.sourceType&&qo[this.sourceType]?o.sourcetype=qo[this.sourceType]:o.sourcetype=qo[co.LiveTranscodingCamera],this.segmentType&&i===_c.LiveTranscodingVirtualBackground?o.segmenttype=this.segmentType:o.segmenttype=gs.LiveTranscodingNoBody,o}}const{BrowserUtil:Au,SystenUtil:Km}=We.AliRTS;class Gm{constructor(){B(this,"tracker"),B(this,"param"),B(this,"msgCacheArr",[]),B(this,"index",0),B(this,"stsOpt"),B(this,"slsToken"),B(this,"ossToken")}createTracker(){if(!this.tracker&&this.slsToken&&this.param){const t=this.slsToken;this.ossToken&&(this.param.ossbn=this.ossToken.bucket_name,this.param.ossep=this.ossToken.region_endpoint);const r=new Hd({host:t.region_endpoint,project:t.project,logstore:t.log_store_stats}),n={accessKeyId:t.access_key_id,accessKeySecret:t.access_key_secret,securityToken:t.security_token,refreshSTSToken:()=>{this.slsToken&&(n.accessKeyId=this.slsToken.access_key_id,n.accessKeySecret=this.slsToken.access_key_secret,n.securityToken=this.slsToken.security_token)}};this.stsOpt=n;const i=$d(n);r.useStsPlugin(i),this.tracker=r,this.msgCacheArr.forEach((o,s)=>{var a,c;(c=this.tracker)==null||c.send(Ne(bi(Ne({},this.param),{stat_log_id:`${((a=this.param)==null?void 0:a.sesid)||"nosession"}-${s}`}),o))}),this.index=this.index+this.msgCacheArr.length,this.msgCacheArr=[]}}start(t){this.initParam(t),this.createTracker()}updateToken(t,r){this.slsToken=t,this.ossToken=r,this.createTracker()}stop(){this.tracker=void 0,this.param=void 0,this.msgCacheArr=[],this.index=0,this.stsOpt=void 0,this.slsToken=void 0,this.ossToken=void 0}sendReport(t){var r,n;t.tm=Date.now();let i;try{i=JSON.parse(JSON.stringify(Ne(bi(Ne({bt:Au.browserName||"unknown"},this.param),{stat_log_id:`${((r=this.param)==null?void 0:r.sesid)||"nosession"}-${this.index}`}),t)))}catch{}if(i){if(!this.tracker){this.msgCacheArr.push(i);return}(n=this.tracker)==null||n.send(i),this.index++}}initParam(t){let r=localStorage==null?void 0:localStorage.getItem("AliRtcUUID");r||(r=hn(),localStorage==null||localStorage.setItem("AliRtcUUID",r)),this.param||(this.param={apid:t.appId,usrid:t.userId,statsvrs:"0.6.1",evetid:0,sesid:t.sessionId,sessionId:t.sessionId,channelid:t.channelId,usrn:t.userId,osn:Km.systemName,osv:Km.systemVersion,deb:ob(),den:rb(),udid:r,sdkvrs:Ec,acs:"Unknown",cput:Hv(),dm:`${window.location.protocol}//${window.location.host}`,bt:Au.browserName,bv:Au.browserVersion,envir:"PRODUCT",args:""})}}const st=(e,t=1,r=6e4,n=0)=>{let i=e;return i||(i=0),Math.min(r,Math.max(n,Math.round(i*t)))},Or=(e,t,r=2e7,n=0)=>{let i=t;(!t||t<0||t>1e4)&&(i=1e3);let o=e;return o||(o=0),Math.min(r,Math.max(n,Math.round(o/(i/1e3))))},ii=(e,t)=>{if(t===0||!t)return"0.00";let r=e;return(!r||r<0)&&(r=0),(r/t*100).toFixed(2)},Jm=e=>e>=0&&e<=1?st(Math.floor(32767*e),1,32767):0,ct=(e,t)=>{var r,n,i;let o=((r=e._last)==null?void 0:r[t])||0;return e.ssrc&&(n=e._last)!=null&&n.ssrc&&e.ssrc!==((i=e._last)==null?void 0:i.ssrc)&&(o=0),((e==null?void 0:e[t])||0)-o},y_=(e,t)=>{var r,n,i;return(((r=e==null?void 0:e._source)==null?void 0:r[t])||0)-(((i=(n=e==null?void 0:e._last)==null?void 0:n._source)==null?void 0:i[t])||0)},qm=(e,t)=>st(ct(e,t),1e3,1e4),oi=(e,t=2e7)=>st(e,1,t),c1=class Dl{constructor(t){B(this,"engine"),B(this,"logClient"),B(this,"authInfo"),this.logClient=new Gm,this.engine=t}static getLogClient(){return this.staticClient||(this.staticClient=new Gm),this.staticClient}static reportOSSUpload(t,r,n=0){Dl.getLogClient().sendReport({errmsg:`${r}/${t}.log`,errtype:n,evetid:70017,sesid:t,sessionId:t,stat_log_id:`${t}-70017`})}start(t){this.authInfo=t,this.logClient.start(t)}updateToken(t,r){this.logClient.updateToken(t,r),Dl.getLogClient().updateToken(t,r)}stop(){this.logClient.stop()}reportPublishMonitor(t,r,n,i,o){if(!n||o.length<=0)return;const s=n===se.Audio,a={ctm:Math.floor(o[0].timestamp||0),src:o[0].ssrc||"",codec:o[0]._codec||""},c=[],u=[],d=[],E=[],m=[],f=[],y=[],S=[],l=[],h=[],p=[],v=[],g=[],R=[],_=[],w=[],k=[],O=[],C=[];try{if(o.forEach(b=>{var A,T,M,D,N,P;if(!b||!b.timestamp)return;const I=(A=b._last)!=null&&A.timestamp?b.timestamp-b._last.timestamp:1e3,L=ct(b,"bytesSent"),W=ct(b,"headerBytesSent"),U=Or(st(L+W,8,2e7),I);c.push(U);const x=Or(st(L,8,2e7),I);u.push(x);const V=Or(st(W,8,2e7),I);d.push(V);const j=ct(b,"packetsSent"),H=Or(j,I);E.push(H);const z=ct(b,"packetsLost"),K=Or(z,I);m.push(K);const $=ii(z,j);if(f.push($),s)(T=b._source)!=null&&T.audioLevel&&y.push(Jm(b._source.audioLevel)),S.push(0);else{l.push(qm(b,"totalEncodeTime")),h.push(oi((M=b._source)==null?void 0:M.framesPerSecond,100)),p.push(oi((D=b._source)==null?void 0:D.framesPerSecond,100)),v.push(oi(b.framesPerSecond,100)),g.push(oi((N=b._source)==null?void 0:N.height,4400)),R.push(oi((P=b._source)==null?void 0:P.width,7700)),_.push(oi(b.frameHeight,4400)),w.push(oi(b.frameWidth,7700));const Z=ct(b,"totalPacketSendDelay");k.push(st(Z,1/(z||1),2e3));const ne=ct(b,"qpSum");O.push(st(ne,1/(b.framesPerSecond||1),51)),C.push(0)}}),a.sbr=c.join(","),a.mbrs=u.join(","),a.pbrs=d.join(","),a.ps=E.join(","),a.pl=m.join(","),a.plr=f.join(","),s){const b=(i==null?void 0:i.getSettings().sampleRate)||0;a.ailevel=y.join(","),a.arpc=S.join(","),a.arsr=b,a.aesr=b,a.publevel=-90,a.rawlevel=-90}else a.em=l.join(","),a.cfps=h.join(","),a.ifps=p.join(","),a.sfps=v.join(","),a.ih=g.join(","),a.iw=R.join(","),a.sh=_.join(","),a.sw=w.join(","),a.sd=k.join(","),a.aqp=O.join(","),a.caf=C.join(","),a.can=C.join(","),a.cav=u.join(","),a.ifimax=C.join(","),a.ifimin=C.join(","),a.efimax=C.join(","),a.efimin=C.join(","),a.sfimax=C.join(","),a.sfimin=C.join(","),a.apsnr=C.join(",")}catch{}this.log({evetid:10070,traceid:r,calid:t,args:this.data2String(Ne({calid:t,tckid:n,traceid:r},a))})}reportSubscribeMonitor(t,r,n,i,o){if(!i||!o||o.length<=0)return;const s=i===se.Audio,a={ctm:Math.floor(o[0].timestamp||0),src:o[0].ssrc||"",codec:o[0]._codec||""},c=[],u=[],d=[],E=[],m=[],f=[],y=[],S=[],l=[],h=[],p=[],v=[],g=[],R=[],_=[],w=[],k=[],O=[],C=[],b=[],A=[],T=[],M=[],D=[],N=[],P=[],I=[],L=[],W=[],U=[],x=[],V=[],j=[],H=[];try{o.forEach(z=>{var K,$;if(!z||!z.timestamp)return;const Z=(K=z._last)!=null&&K.timestamp?z.timestamp-z._last.timestamp:1e3,ne=ct(z,"bytesReceived"),te=ct(z,"headerBytesReceived"),ae=Or(st(ne+te,8,2e7),Z);c.push(ae);const le=Or(st(ne,8,2e7),Z);u.push(le);const fe=Or(st(te,8,2e7),Z);d.push(fe);const ve=ct(z,"packetsReceived"),Se=Or(ve,Z);E.push(Se);const be=ct(z,"packetsLost"),Me=Or(be,Z);m.push(Me);const _e=ii(be,ve);f.push(_e);const ke=ct(z,"jitterBufferDelay"),Pe=ct(z,"jitterBufferEmittedCount");if(z.jitterBufferDelay&&z.jitterBufferEmittedCount){const rt=st(ke,1e3/Pe,1e4);y.push(rt)}else y.push(0);const Le=ct(z,"fecPacketsReceived");v.push(ii(Le,ve));const Qe=ct(z,"retransmittedPacketsReceived"),Ge=ve+be-Qe;if(l.push(ii(ve-Qe,Ge)),h.push(ii(be,Ge)),S.push(ii(Qe,Ge)),p.push(Ge),j.push(0),H.push(""),s){R.push(Jm(z.audioLevel));const rt=y_(z,"synthesizedSamplesEvents");_.push(rt);const Xe=qm(z,"synthesizedSamplesDuration");w.push(Xe);const at=ii(Xe,Z);g.push(at),k.push(0)}else{const rt=($=z._last)!=null&&$.totalInterFrameDelay?z.totalInterFrameDelay-z._last.totalInterFrameDelay:0;O.push(st(rt,1e3/(z.framesDecoded||30),500)),C.push(st(z.framesPerSecond,1,100)),b.push(ct(z,"framesReceived")),V.push(ct(z,"framesRendered")),A.push(st(z.frameHeight,1,4400)),T.push(st(z.frameWidth,1,7700));const Xe=ct(z,"totalProcessingDelay");M.push(st(Xe,1e3/(z.framesDecoded||30),12e4));const at=ct(z,"nackCount");N.push(at);const Jt=ct(z,"pliCount");D.push(Jt);const jt=ct(z,"qpSum");P.push(st(jt,1/(z.framesPerSecond||1),51)),I.push(st(z.framesDropped));const It=ct(z,"totalFreezesDuration");L.push(st(It,1e3,3e4));const ot=ct(z,"jitterBufferEmittedCount"),Et=ct(z,"jitterBufferDelay");Et&&ot?W.push(st(Et,1e3/ot,3e4)):W.push(0);const nt=ct(z,"jitterBufferTargetDelay");nt&&ot?U.push(st(nt,1e3/ot,3e4)):U.push(0);const Ie=ct(z,"jitterBufferMinimumDelay");Ie&&ot?x.push(st(Ie,1e3/ot,3e4)):x.push(0)}}),a.rbr=c.join(","),a.mbrs=u.join(","),a.pbrs=d.join(","),a.pr=E.join(","),a.pl=m.join(","),a.plr=f.join(","),a.jd=y.join(","),a.fecr=v.join(","),a.retransr=S.join(","),a.baser=l.join(","),a.basel=h.join(","),a.recoverr=j.join(","),a.alll=h.join(","),a.totalc=p.join(","),s?(a.er=g.join(","),a.aolevel=R.join(","),a.asrc=k.join(","),a.scnt=_.join(","),a.sdura=w.join(",")):(a.dm=O.join(","),a.dfps=C.join(","),a.rfps=b.join(","),a.rh=A.join(","),a.rw=T.join(","),a.fpt=H.join(","),a.ns=N.join(","),a.pliss=D.join(","),a.aqp=P.join(","),a.ofimax=j.join(","),a.ofimin=j.join(","),a.dfimax=j.join(","),a.dfimin=j.join(","),a.rfimax=j.join(","),a.rfimin=j.join(","),a.vrstutter=L.join(","),a.cdm=W.join(","),a.tdm=U.join(","),a.pdm=x.join(","),a.ofps=V.join(","),a.dfbd=I.join(","))}catch{}this.log({evetid:10080,traceid:n,rmtid:r,calid:t,args:this.data2String(Ne({calid:t,rmtid:r,tckid:i,traceid:n},a))})}reportNetworkMonitor(t){if(t.length<=0)return;const r=[],n=[],i=[],o=[],s=[],a=[],c=[],u=[],d=[],E=[];t.forEach((f,y)=>{var S;if(!f.timestamp)return;const l=(S=f._last)!=null&&S.timestamp?f.timestamp-f._last.timestamp:1e3;r.push(st(f.currentRoundTripTime,1e3)),n.push(st(f.availableOutgoingBitrate,8,2e8)),i.push(Or(st(f.bytesSent,8,2e7),l,25e6)),o.push(Or(st(f.bytesReceived,8,2e7),l,25e6)),s.push(0),a.push(0),y%5===0&&(c.push(""),u.push(""),d.push(""),E.push(""))});const m={ctm:Math.floor(t[0].timestamp||0),rtt:r.join(","),bsps:i.join(","),brps:o.join(","),cpu:c.join(","),mem:u.join(","),sysmem:d.join(","),systotalmem:E.join(","),audioonly:this.engine.isAudioOnly()?1:0};this.log({evetid:10071,args:this.data2String(Ne({asb:n.join(","),abms:s.join(","),vbms:a.join(",")},m))}),this.log({evetid:10081,args:this.data2String(Ne({},m))})}reportJoin(t,r,n=""){var i,o;const{start:s,rs:a=0,re:c=0}=r,u=Date.now()-s,d=c-a;let E=0;a&&(E=a-s);let m=0;c&&(m=c-a),this.log({evetid:10010,args:this.data2String({sesid:((i=this.authInfo)==null?void 0:i.sessionId)||"",joitm:u,rslt:t,gslbtm:0,dnstm:0,avcftm:0,gslbrslt:0,dnsrslt:0,avcfrslt:0,mode:2,jrtc:d,usrn:(o=this.authInfo)==null?void 0:o.userId,mgt:"cdn",cttc:E,iptc:m,ndn:1,gslbloc:1,ccag:0,ucag:0,cpg:0,upg:0,tid:n})})}reportJoinConnection(t){this.log({evetid:20002,args:this.data2String(Ne({transretrynum:0,ldnstc:0,tcptc:0,ssltc:0,url:""},t))})}reportLeave(t,r,n){this.log({evetid:10020,args:this.data2String({lvetm:t,rslt:r,tid:n})})}reportPublish(t,r,n,i,o,s,a,c,u,d,E){this.log({evetid:t?10032:10030,calid:n,args:this.data2String({calid:n,url:r,isvl:i?1:0,isvs:o?1:0,isvss:s?1:0,isaudio:a?1:0,rslt:c,tid:"123",pubtm:Date.now()-E,pctid:u,pubtid:d,isvp:0,isarecording:0,isad:0,isdc:0,pubretry:0,pbrttimes:0})})}reportPublishFirstPacket(t,r,n,i,o,s,a,c,u){const d=Date.now();this.log({evetid:t?10033:10031,calid:r,args:this.data2String({calid:r,fpst:d-n,tckid:s,est:n,pctid:a,pubtid:c,totaltm:d-o,jorm:u===dn.JOIN_CHANNEL?1:0,cptc:0,sptc:i-n,iptc:0,ipc2fptc:0,dctc:0,patc:0})})}reportUnpublish(t,r,n,i){var o;this.log({evetid:10040,args:this.data2String({calid:t,unpubtm:r,rslt:n,tid:i,sesid:((o=this.authInfo)==null?void 0:o.sessionId)||""})})}reportSubscribe(t,r,n,i,o,s,a,c,u,d){this.log({evetid:10050,calid:t,rmtid:r,args:this.data2String(Ne({calid:t,rmtid:r,isvl:n?1:0,isvs:i?1:0,isvss:o?1:0,isaudio:s?1:0,rslt:a,tid:c,subtm:u,isvp:0,isaplaying:0,isad:0,isdc:0,subretry:0,sbrttimes:0},d))})}reportSubscribeFirstPacket(t,r,n,i,o){this.log({evetid:t?10054:10051,calid:r,rmtid:n,args:this.data2String(Ne({calid:r,rmtid:n,tckid:i,cptc:0,iptc:0,ipc2fptc:0,dctc:0,patc:0},o))})}reportSubscribeFirstFrame(t,r,n,i,o){this.log({evetid:t?10055:10052,calid:r,rmtid:n,args:this.data2String(Ne({calid:r,rmtid:n,tckid:i},o))}),this.log({evetid:t?10058:10057,args:this.data2String(Ne({calid:r,rmtid:n,tckid:i},o))})}reportUnsubscribe(t,r,n,i,o){this.log({evetid:10060,calid:t,args:this.data2String({calid:t,rmtid:r,unsubtm:n,rslt:i,tid:o})})}reportMute(t,r,n){this.log({evetid:11030,args:this.data2String({calid:t,rmtid:"",enable:r?1:0,mt:n})})}reportRoleUpdate(t,r){this.log({evetid:11040,args:this.data2String({or:t||"",nr:r,ctm:Date.now(),rslt:0})})}reportRoleUpdateResult(t,r,n,i){this.log({evetid:11041,args:this.data2String({or:t||"",nr:r,ctm:n,rslt:i})})}reportVideoProfile(t){this.log({evetid:20074,args:this.data2String({pf:t,tckid:"sophon_camera_large"})})}reportScreenProfile(t){this.log({evetid:20074,args:this.data2String({pf:t,tckid:"sophon_screenshare"})})}reportError(t){this.log({evetid:10091,args:this.data2String({rslt:(t==null?void 0:t.code)||-1})})}reportWarning(t){this.log({evetid:10092,args:this.data2String({rslt:-1,errmsg:t})})}reportRoomServerEvent(t,r,n,i){this.log({evetid:20005,args:this.data2String({calid:"",rmtid:"",rt:t?0:1,dr:t?"s":"r",mt:r,ri:n,cs:1,srt:Date.now(),rspc:(i==null?void 0:i.code)||"",mc:JSON.stringify(i)})})}reportTranscodingError(t,r){this.log({evetid:10101,args:this.data2String({rslt:t,taskid:r})})}reportBye(t){var r;this.log({evetid:10093,args:this.data2String({rslt:t,sesid:((r=this.authInfo)==null?void 0:r.sessionId)||""})})}reportAudio(t,r,n){var i;this.log({evetid:80013,args:this.data2String({rslt:t?-1:0,adm:1,adt:0,adr:t?2:0,acms:r,adrpn:n})}),this.log({evetid:80014,args:this.data2String({sesid:((i=this.authInfo)==null?void 0:i.sessionId)||"",rslt:t?-1:0,adm:1,adt:0,adr:t?2:0,acms:r,adrpn:n})})}reportScreen(t,r){var n,i,o,s;this.log({evetid:90013,args:this.data2String({rslt:t?-1:0,vcms:r,vde:(n=t==null?void 0:t.code)!=null?n:-1,sesid:((i=this.authInfo)==null?void 0:i.sessionId)||""})}),this.log({evetid:90014,args:this.data2String({rslt:t?-1:0,vcms:r,vde:(o=t==null?void 0:t.code)!=null?o:-1,sesid:((s=this.authInfo)==null?void 0:s.sessionId)||""})})}reportScreenStop(t){this.log({evetid:90019,args:this.data2String({rslt:t?t.code||-1:0})}),this.log({evetid:90020,args:this.data2String({rslt:t?t.code||-1:0})})}reportSwitchCamera(t){var r;this.log({evetid:90025,args:this.data2String({rslt:0,td:t,sesid:((r=this.authInfo)==null?void 0:r.sessionId)||""})})}reportPublishProfile(t,r){this.log({evetid:10201,args:this.data2String(Ne({tckid:t},r))})}reportSDKCreated(t){this.log({evetid:70011,createtm:Date.now()-t,tm:t})}reportJoinInvoked(t){this.log({evetid:70012,jnnonce:t.nonce||"",jntoken:t.token||"",jntm:t.timestamp||""})}reportJoinResult(t){this.log({evetid:70013,rslt:t?t.code||-1:0,dnsrslt:0})}reportSTSResult(t,r){this.log({evetid:70014,rslt:t,asty:1,reqtm:Date.now()-r})}reportLeaveInvoked(){this.log({evetid:70015})}reportSEIMessage(t,r,n,i,o){this.log({evetid:40301,args:this.data2String({tm:Date.now(),sei_pt:t,sei_len:r,sei_rep:n,sei_delay:i,sei_key:o})})}log(t){t&&(t.tm=new Date().getTime(),he.debug("[ConsoleLogger]","log",t),this.logClient.sendReport(t))}data2String(t){let r="";for(let n in t)r.length&&(r+="&"),r+=n+"="+t[n];return r}};B(c1,"staticClient");let E_=c1;var R_=Object.defineProperty,b_=Object.getOwnPropertyDescriptor,Re=(e,t,r,n)=>{for(var i=n>1?void 0:n?b_(t,r):t,o=e.length-1,s;o>=0;o--)(s=e[o])&&(i=(n?s(t,r,i):s(i))||i);return n&&i&&R_(t,r,i),i},Ce;const ye=(Ce=class extends Ut{constructor(e){super(),B(this,"channelProfile"),B(this,"clientRole"),B(this,"signalingManager"),B(this,"bizControl"),B(this,"liveTranscoding"),B(this,"maxSignalingConnectRetryCount"),B(this,"slsReporter"),B(this,"connectState",Ze.AliRtcConnectionStatusInit),B(this,"networkError",!1),B(this,"_audioOnlyMode",!1),B(this,"_authInfoWillExpireTimer",null),B(this,"_authInfoExpiredTimer",null),B(this,"_serverCheckAuthInfoTimestamp",null),B(this,"_localCheckAuthInfoTimestamp",null);const t=Date.now();he.init(),this.slsReporter=new E_(this),this.channelProfile=vn.AliRtcSdkCommunication,this.clientRole=gn.AliRtcSdkLive,this.liveTranscoding=new S_(this.slsReporter),this.signalingManager=new ih(this.channelProfile,this.clientRole,this.slsReporter,(e==null?void 0:e.env)===bn.pre?bn.pre:bn.prod),this.addSignalingManagerListeners(),this.maxSignalingConnectRetryCount=e==null?void 0:e.maxSignalingConnectRetryCount,this.bizControl=new tr({slsReporter:this.slsReporter,signalingManager:this.signalingManager}),this.addBizControlListeners(),this.addPublisherListeners(),this.slsReporter.reportSDKCreated(t)}static getSdkVersion(){return Ec}static setLogLevel(e){he.setLogLevel(e)}static getInstance(e){return Ce._instance||(Ce._instance=new Ce(e)),Ce._instance}destroy(){return Q(this,null,function*(){Ce._instance=void 0,yield this.leaveChannel(),yield this.bizControl.clear(),he.destroy()})}get channel(){return this.bizControl.channel}get userId(){return this.bizControl.userId}get remoteUsers(){return this.bizControl.remoteUsers}get publisher(){return this.bizControl.publisher}get publishAudioStream(){var e;return(e=this.publisher)==null?void 0:e.publishStreams.audio}get isPublishing(){const{publisher:e}=this.bizControl;return e?e.isPublishing:!1}get currentRoleCanPublish(){return this.channelProfile===vn.AliRtcSdkCommunication||this.clientRole===gn.AliRtcSdkInteractive}addPublisherListeners(){var e,t,r,n,i,o,s,a,c,u;(e=this.publisher)==null||e.on(ir.Local,d=>{he.event("[Publisher] Device Status Change",d),this.onLocalDeviceStatusChange(d)}),(t=this.publisher)==null||t.on(gi.VideoTrackEnded,()=>{he.event("[Publisher] VideoTrack Ended"),this.emit("localDeviceException",cn.AliEngineLocalDeviceTypeCamera,Ct.AliEngineLocalDeviceExceptionTypeCameraInterrupt,"")}),(r=this.publisher)==null||r.on(gi.ScreenTrackEnded,()=>{he.event("[Publisher] ScreenTrack Ended"),this.emit("localDeviceException",cn.AliEngineLocalDeviceTypeDisplay,Ct.AliEngineLocalDeviceExceptionTypeDisplayException,"")}),(n=this.publisher)==null||n.on(gi.AudioTrackEnded,()=>{he.event("[Publisher] AudioTrack Ended"),this.emit("localDeviceException",cn.AliEngineLocalDeviceTypeMic,Ct.AliEngineLocalDeviceExceptionTypeMicInterrupt,"")}),(i=this.publisher)==null||i.on("localDeviceException",(d,E,m="")=>{this.emit("localDeviceException",d,E,m)}),(o=this.publisher)==null||o.on("audioPublishStateChanged",(d,E,m)=>{var f;this.emit("audioPublishStateChanged",d,E,m,(f=this.channel)!=null?f:"")}),(s=this.publisher)==null||s.on("videoPublishStateChanged",(d,E,m)=>{var f;this.emit("videoPublishStateChanged",d,E,m,(f=this.channel)!=null?f:"")}),(a=this.publisher)==null||a.on("dualStreamPublishStateChanged",(d,E,m)=>{var f;this.emit("dualStreamPublishStateChanged",d,E,m,(f=this.channel)!=null?f:"")}),(c=this.publisher)==null||c.on("screenPublishStateChanged",(d,E,m)=>{var f;this.emit("screenSharePublishStateChanged",d,E,m,(f=this.channel)!=null?f:"")}),(u=this.publisher)==null||u.on("dataPublishStateChanged",(d,E,m)=>{var f;this.emit("dataPublishStateChanged",d,E,m,(f=this.channel)!=null?f:"")})}occurError(e,t){he.event(`[${Ce.logName}]`,"Occur Error",e,t),this.emit("onOccurError",e,t),this.emit("occurError",e,t)}addBizControlListeners(){this.bizControl.rtsManager.on("connected",e=>{var t;e&&((t=this.publisher)==null||t.publishUpdate(dn.RECONNECT),this.remoteUsers.forEach(r=>{r.updateSubscribe(tt.Reconnect)}))}),this.bizControl.rtsManager.on("disconnected",()=>Q(this,null,function*(){he.event(`[${Ce.logName}]`,"RTS Disconnected"),(yield vr.isNetworkAvailable())?this.onNetworkRecovery():this.onNetworkError()})),this.bizControl.rtsManager.on("subscribeexceeds",()=>Q(this,null,function*(){yield this.resumePublishForNetworkRecovery(),yield this.resumeSubList()})),this.bizControl.rtsManager.on("seimessage",(e,t,r)=>{const n=this.remoteUsers.find(i=>i.streamUrl===e);n&&this.emit("mediaExtensionMsgReceived",n.userId,r,t)}),this.bizControl.on(ir.Remote,(e,t)=>{he.event(`[${Ce.logName}]`,"RemoteUser Device Status Change",e,t)}),this.bizControl.on("remoteTrackAvailableChange",(e,t,r)=>{this.emit("remoteTrackAvailableNotify",e,t,r)}),this.bizControl.on("audioSubscribeStateChanged",(e,t,r,n,i)=>{this.emit("audioSubscribeStateChanged",e,t,r,n,i)}),this.bizControl.on("videoSubscribeStateChanged",(e,t,r,n,i)=>{this.emit("videoSubscribeStateChanged",e,t,r,n,i)}),this.bizControl.on("screenSubscribeStateChanged",(e,t,r,n,i)=>{this.emit("screenShareSubscribeStateChanged",e,t,r,n,i)}),this.bizControl.on("dataSubscribeStateChanged",(e,t,r,n,i)=>{this.emit("dataSubscribeStateChanged",e,t,r,n,i)}),this.bizControl.on("userAudioMuted",(e,t)=>{this.emit("userAudioMuted",e,t)}),this.bizControl.on("userVideoMuted",(e,t)=>{this.emit("userVideoMuted",e,t)}),this.bizControl.on("userScreenMuted",(e,t)=>{this.emit("userScreenMuted",e,t)}),this.bizControl.on("audioVolume",e=>{this.emit("audioVolume",e)}),this.bizControl.on("remoteAudioAutoPlayFail",e=>{this.emit("remoteAudioAutoPlayFail",e)}),this.bizControl.on("remoteVideoAutoPlayFail",(e,t)=>{this.emit("remoteVideoAutoPlayFail",e,t)}),this.bizControl.on("remoteAudioPlayError",(e,t)=>{this.emit("remoteAudioPlayError",e,t)}),this.bizControl.on("remoteVideoPlayError",(e,t)=>{this.emit("remoteVideoPlayError",e,t)}),this.bizControl.on("rtcStats",e=>{this.emit("rtcStats",e)}),this.bizControl.on("rtcLocalAudioStats",e=>{this.emit("rtcLocalAudioStats",e)}),this.bizControl.on("rtcLocalVideoStats",e=>{this.emit("rtcLocalVideoStats",e)}),this.bizControl.on("rtcRemoteAudioStats",e=>{this.emit("rtcRemoteAudioStats",e)}),this.bizControl.on("rtcRemoteVideoStats",e=>{this.emit("rtcRemoteVideoStats",e)}),this.bizControl.on("remoteSubscribeError",(e,t)=>{this.occurError(e,t),this.slsReporter.reportError(e)}),this.bizControl.on("occurError",(e,t)=>{this.occurError(e,t),this.slsReporter.reportError(e)}),this.bizControl.on("remoteDataChannelMessage",(e,t)=>{this.emit("dataChannelMsg",e,t)})}addSignalingManagerListeners(){this.signalingManager.on("onKeepAliveRsp",()=>{this.networkError&&(he.event("[Signaling] Receive KeepAlive Response",`networkError: ${this.networkError}`),this.onNetworkRecovery())}),this.signalingManager.on("onNotifyJoin",e=>{he.event("[Signaling] Notify Join ",e),this.handleUsersJoin(e),e.forEach(t=>{this.emit("remoteUserOnLineNotify",t.userid,0)})}),this.signalingManager.on("onNotifyStatus",e=>{he.event("[Signaling] Notify Status ",e),e.forEach(t=>{this.bizControl.updateRemoteUserDeviceStatus(t)})}),this.signalingManager.on("onNotifyLeave",e=>{he.event("[Signaling] Notify Leave ",e),e.forEach(t=>{this.emit("remoteUserOffLineNotify",t.userid,t.leavecode),this.bizControl.removeLeftUser(t)})}),this.signalingManager.on("onBye",(e,t)=>{he.event("[Signaling] Bye ",e,t),this.slsReporter.reportError({message:`reason: ${e}, description: ${t}`}),this.emit("bye",e),this.leaveChannel(),this.slsReporter.reportBye(e)}),this.signalingManager.on("onConnectFail",e=>{he.event("[Signaling] Connect Failed ",e),this.onError(e),this.backToUnpublishStatus(),this.connectState=Ze.AliRtcConnectionStatusFailed,this.emit("connectionStatusChange",Ze.AliRtcConnectionStatusFailed,ci.AliRtcConnectionChangedNetworkInterrupted)}),this.signalingManager.on("onNetworkError",e=>{this.slsReporter.reportWarning("signaling network error"),he.event("[Signaling] Network error ",e),this.onNetworkError()}),this.signalingManager.on("onAuthInvalid",()=>{he.event("[Signaling] Auth Invalid")}),this.signalingManager.on("onReconnectStart",()=>{he.event("[Signaling] Reconnect Start "),this.connectState=Ze.AliRtcConnectionStatusReconnecting,this.emit("connectionStatusChange",Ze.AliRtcConnectionStatusReconnecting,ci.AliRtcConnectionSignalingConnecting)}),this.signalingManager.on("onReconnectSuccess",e=>{he.event("[Signaling] Reconnect Success ",e),this.onNetworkRecovery(e)}),this.signalingManager.on("onReconnectFail",e=>{this.slsReporter.reportWarning("signaling reconnect fail: ${err.code}"),he.event("[Signaling] Reconnect Failed ",e),e.code===403&&this.emit("authInfoExpired")}),this.signalingManager.on("onError",e=>{this.slsReporter.reportWarning("signaling error: ${err.message}"),he.event("[Signaling] Error ",e),this.onError(e)})}backToUnpublishStatus(){var e,t;this.connectState=Ze.AliRtcConnectionStatusDisconnected,(e=this.publisher)!=null&&e.isPublishing&&((t=this.publisher)==null||t.clearPublishState()),this.networkError=!1}handleUsersJoin(e){e.forEach(t=>{const r=t.userid;if(r){const n=this.bizControl.addUser(r,t.displayname,tt.Join);he.event(`[${Ce.logName}]`,Ye.UserJoined,n)}})}onLocalDeviceStatusChange(e){he.event(`[${Ce.logName}]`,ir.Local,e),this.signalingManager.reportStatus(e).then(()=>{he.debug("[signaling] reportStatus suc")}).catch(t=>{he.error("[signaling] reportStatus failed",t)})}resumePublishForNetworkRecovery(){return Q(this,null,function*(){var e;try{yield(e=this.publisher)==null?void 0:e.resumePublish()}catch(t){const{code:r}=t;if(r===10205){let n=1;try{yield new Promise((i,o)=>{const s=setInterval(()=>Q(this,null,function*(){var a;n>1&&(clearInterval(s),o()),n+=1;try{yield(a=this.publisher)==null?void 0:a.resumePublish(),clearInterval(s),i()}catch(c){const{code:u}=c;u!==10205&&(clearInterval(s),o())}}),1e3)})}catch{}}throw t}})}onNetworkRecovery(e){return Q(this,null,function*(){var t;he.event(Ce.logName,"onNetworkRecovery",`rts isConnected: ${this.bizControl.rtsManager.isConnected}; rts isConnecting: ${this.bizControl.rtsManager.isConnecting}`,{users:e}),!this.bizControl.rtsManager.isConnected&&!this.bizControl.rtsManager.isConnecting?(yield this.resumePublishForNetworkRecovery(),yield this.resumeSubList()):e&&(yield this.resumeSubList(e)),this.networkError&&(this.networkError=!1,(t=this.publisher)==null||t.reportSelfDeviceStatus(),this.connectState=Ze.AliRtcConnectionStatusConnected,this.emit("connectionStatusChange",Ze.AliRtcConnectionStatusConnected,ci.AliRtcConnectionSignalingHeartbeatAlive))})}resumeSubList(e){return Q(this,null,function*(){if(e!=null&&e.length){const{joinList:t,leaveList:r,presentList:n}=this.bizControl.updateUsers(e);he.info(`[${Ce.logName}]`,"resumeSubList",{joinList:t,leaveList:r,presentList:n}),this.handleUsersJoin(t),r.forEach(i=>{he.event(Ce.logName,Ye.UserLeft,i.userid,i.reason),this.emit("remoteUserOffLineNotify",i.userid,rh.AliRtcUserOfflineQuit)});for(let i=0;i<n.length;i++){const o=n[i],s=o.userid,a=this.bizControl.getRemoteUser(s);this.bizControl.onRemotePublishStateChange(o),a==null||a.restore(),a==null||a.updateSubscribe(tt.Resume)}}else for(let t=0;t<this.remoteUsers.length;t++){const r=this.remoteUsers[t];try{r.restore(),r.updateSubscribe(tt.Resume)}catch{}}})}retrySubscribe(e){return Q(this,null,function*(){const t=this.bizControl.getRemoteUser(e);if(!t)throw new ue(pe.ERR_INNER,`no remote user(${e}) founded`);t.restore(),t.updateSubscribe(tt.Retry)})}onNetworkError(){this.connectState===Ze.AliRtcConnectionStatusConnected&&(this.networkError||(this.connectState=Ze.AliRtcConnectionStatusDisconnected,this.emit("connectionStatusChange",Ze.AliRtcConnectionStatusDisconnected,ci.AliRtcConnectionChangedNetworkInterrupted)),this.networkError=!0)}onError(e){this.slsReporter.reportError(e),he.event(Ce.logName,Ye.Error,e)}setEnableDualVideoStream(e,t){this.bizControl.setEnableDualVideoStream(e,t)}hadPushStream(e){if(!(this.publisher&&e))throw new ue(pe.ERR_INNER,"stream is not publishing")}getCurrentMicDeviceId(){var e;return(e=this.publisher)==null?void 0:e.getCurrentMicDeviceId()}setChannelProfile(e){if(![Ze.AliRtcConnectionStatusInit,Ze.AliRtcConnectionStatusDisconnected,Ze.AliRtcConnectionStatusFailed].includes(this.connectState))throw new ue(pe.ERR_INNER,"cannot set channel profile in call");this.channelProfile=e,this.channelProfile===vn.AliRtcSdkCommunication&&(this.clientRole=gn.AliRtcSdkLive),this.signalingManager.setChannelProfile(e)}startAndPublishDefaultDevices(e){return Q(this,null,function*(){var t,r,n,i,o;if(!this.publisher)return;const{hasCamera:s,hasMicrophone:a,hasScreenShare:c}=this.publisher;if(!s&&!a&&!c){try{yield(t=this.publisher)==null?void 0:t.startDefaultCamera(this._audioOnlyMode)}catch(d){he.warn(`[${Ce.logName}]`,"startDefaultCamera failed",d.code,d.message),d instanceof ue&&this.occurError(d),this.occurError(new ue(pe.ERR_SDK_PUBLISH_VIDEO_STREAM_FAILED,`auto start video failed, ${d.message||""}`))}try{yield(r=this.publisher)==null?void 0:r.startDefaultAudio()}catch(d){he.warn(`[${Ce.logName}]`,"startDefaultAUdio failed",d.code,d.message),d instanceof ue&&this.occurError(d),this.occurError(new ue(pe.ERR_SDK_PUBLISH_AUDIO_STREAM_FAILED,`auto start audio failed, ${d.message||""}`))}yield(n=this.publisher)==null?void 0:n.previewAll()}const u=((i=this.publisher)==null?void 0:i.publishStreams)||{};if(Object.values(u).some(d=>d))try{yield(o=this.publisher)==null?void 0:o.startPublish(!1,e)}catch(d){const E=[];u!=null&&u.audio&&E.push(pe.ERR_SDK_PUBLISH_AUDIO_STREAM_FAILED),u!=null&&u.video&&E.push(pe.ERR_SDK_PUBLISH_VIDEO_STREAM_FAILED),E.forEach(m=>{this.occurError(new ue(m,`auto publish stream failed, ${d.message||""}`))})}})}setClientRole(e){return Q(this,null,function*(){var t,r;try{if(this.channelProfile===vn.AliRtcSdkCommunication)return;if(!Object.values(gn).includes(e))throw new ue(pe.ERR_INVALID_ARGUMENTS,`set client role error, role value(${e}) is invalid`);if(this.clientRole===e)return;this.slsReporter.reportRoleUpdate(this.clientRole,e),this.isInCall()?this.clientRole===gn.AliRtcSdkInteractive?(this.bizControl.isSubscribing?yield(t=this.publisher)==null?void 0:t.clearStream():yield(r=this.publisher)==null?void 0:r.unPublish(),yield this.signalingManager.setClientRole(e)):(yield this.signalingManager.setClientRole(e),yield this.startAndPublishDefaultDevices(dn.ROLE_CHANGE)):yield this.signalingManager.setClientRole(e),this.clientRole=e}catch(n){throw n.code===403&&this.emit("authInfoExpired"),n}})}getCurrentClientRole(){return this.clientRole}setAudioOnlyMode(e){if(this.isInCall())throw new ue(pe.ERR_INNER,"can not change audioOnly mode in call");this._audioOnlyMode=e}setAudioRedEnabled(e){if(this.isInCall())throw new ue(pe.ERR_INNER,"can not change audioRedEnabled in call");this.bizControl.setAudioRedEnabled(e)}setCheckAuthInfoTimer(e,t){const r=(e-t)*1e3;this._authInfoExpiredTimer=window.setTimeout(()=>{this.emit("authInfoExpired")},r),this._authInfoWillExpireTimer=window.setTimeout(()=>{this.emit("authInfoWillExpire")},r-3e4),this._serverCheckAuthInfoTimestamp=t,this._localCheckAuthInfoTimestamp=+Date.now()/1e3}clearCheckAuthInfoTimer(){this._authInfoExpiredTimer&&window.clearTimeout(this._authInfoExpiredTimer),this._authInfoWillExpireTimer&&window.clearTimeout(this._authInfoWillExpireTimer)}joinChannel(e,t){return Q(this,null,function*(){var r,n;let i,o=t;if(typeof e=="string")try{const c=JSON.parse(window.atob(e));i={appId:c.appid,channelId:c.channelid,userId:c.userid,timestamp:c.timestamp,nonce:c.nonce,token:c.token}}catch(c){throw new ue(pe.ERR_INVALID_ARGUMENTS,`authInfo is invalid: ${c.message||""}`)}else i=e;o||(o=i.userId);const s={start:Date.now()};let a=ah.checkAuthInfo(i);if(Ze.AliRtcConnectionStatusInit===this.connectState||Ze.AliRtcConnectionStatusDisconnected===this.connectState||Ze.AliRtcConnectionStatusFailed===this.connectState){if(this.connectState=Ze.AliRtcConnectionStatusConnecting,a)throw this.connectState=Ze.AliRtcConnectionStatusFailed,this.slsReporter.reportJoin(a.code,s,""),this.slsReporter.reportJoinResult(a),a;i.sessionId=vr.createCallid("web"),he.setSessionID(i.appId,i.sessionId),this.slsReporter.start(i);try{const c=yield this.signalingManager.join(i,o,this.maxSignalingConnectRetryCount,s);this.connectState=Ze.AliRtcConnectionStatusConnected,(r=this.publisher)==null||r.reportSelfDeviceStatus(),this.bizControl.init(i,c),this.setCheckAuthInfoTimer(i.timestamp,c.timestamp),this.liveTranscoding.setAuthInfo(i),this.slsReporter.reportJoin(0,s,c.tid),this.slsReporter.reportJoinResult(null)}catch(c){const u=(n=c.code)!=null?n:-1,d=c.reason||c.message||"";throw this.connectState=Ze.AliRtcConnectionStatusDisconnected,this.slsReporter.reportJoin(u,s,""),this.slsReporter.reportJoinResult(c),new ue(u,d)}this.currentRoleCanPublish&&(yield this.startAndPublishDefaultDevices(dn.JOIN_CHANNEL)),this.remoteUsers.forEach(c=>{c.updateSubscribe(tt.Join)})}else{const c=new ue(pe.ERR_JOIN_ALREADY_JOINED,"already joined");throw this.connectState===Ze.AliRtcConnectionStatusConnecting&&(c.message="Repeated operation during login"),this.slsReporter.reportJoin(c.code,s,""),c}})}leaveChannel(){return Q(this,null,function*(){var e;this.slsReporter.reportLeaveInvoked(),yield this.bizControl.leave();let t=new Date().getTime();if(Ze.AliRtcConnectionStatusConnected===this.connectState)try{let r;r=yield this.signalingManager.leave(),this.slsReporter.reportLeave(new Date().getTime()-t,0,(e=r==null?void 0:r.tid)!=null?e:"")}catch(r){this.slsReporter.reportLeave(new Date().getTime()-t,r.code,r.reason)}else this.slsReporter.reportLeave(0,0,"");this.networkError=!1,this.connectState=Ze.AliRtcConnectionStatusDisconnected,this.clearCheckAuthInfoTimer(),this.liveTranscoding.clear(),this.slsReporter.stop(),this.signalingManager.reset(),he.reportEnd()})}isInCall(){return this.connectState===Ze.AliRtcConnectionStatusConnected}refreshAuthInfo(e){return Q(this,null,function*(){let t;if(typeof e=="string")try{const c=JSON.parse(window.atob(e));t={userId:c.userid,timestamp:c.timestamp,nonce:c.nonce,token:c.token}}catch(c){throw new ue(pe.ERR_INVALID_ARGUMENTS,`authInfo is invalid: ${c.message||""}`)}else t=e;const{userId:r,nonce:n,timestamp:i,token:o,role:s}=t,a={userId:r,nonce:n,timestamp:i,token:o,role:s};try{yield this.signalingManager.refreshAuthInfo(a),this.bizControl.refreshAuthInfo(a),this.liveTranscoding.refreshAuthInfo(a),this.clearCheckAuthInfoTimer(),this._serverCheckAuthInfoTimestamp&&this._localCheckAuthInfoTimestamp&&t.timestamp&&this.setCheckAuthInfoTimer(t.timestamp,this._serverCheckAuthInfoTimestamp+(Date.now()-this._localCheckAuthInfoTimestamp))}catch(c){throw c}})}isAudioOnly(){return this._audioOnlyMode}publishLocalAudioStream(e){return Q(this,null,function*(){var t,r,n,i;(t=this.publisher)==null||t.setPublishLocalAudioStreamEnabled(e),this.connectState===Ze.AliRtcConnectionStatusConnected&&(e?(r=this.publisher)!=null&&r.hasMicrophone?yield(n=this.publisher)==null?void 0:n.updateStreams():yield this.startAudioCapture():yield(i=this.publisher)==null?void 0:i.publishUpdate())})}isLocalAudioStreamPublished(){var e,t;return(t=(e=this.publisher)==null?void 0:e.publishLocalAudioStreamEnabled)!=null?t:!0}setDefaultSubscribeAllRemoteAudioStreams(e){this.bizControl.setAutoSubAudio(e)}subscribeAllRemoteAudioStreams(e){this.bizControl.setWantSubAudio(e)}subscribeRemoteAudioStream(e,t){if(t&&!this.bizControl.isWantSubAudio)throw new ue(pe.ERR_INVALID_ARGUMENTS,"subscribeAllRemoteAudioStreams(true) must be called first");this.bizControl.updateAudioWant(e,t)}resumeRemoteAudioStream(e){const t=this.bizControl.getRemoteUser(e);if(!t)throw new ue(pe.ERR_INNER,`no remote user(${e}) founded`);t.resumeAudio()}stopRemoteAudioPlay(e){const t=this.bizControl.getRemoteUser(e);if(!t)throw new ue(pe.ERR_INNER,`no remote user(${e}) founded`);t.stopPlayAudio()}publishLocalVideoStream(e){return Q(this,null,function*(){var t,r,n,i;(t=this.publisher)==null||t.setPublishLocalVideoStreamEnabled(e),this.connectState===Ze.AliRtcConnectionStatusConnected&&(e?(r=this.publisher)!=null&&r.hasCamera?yield(n=this.publisher)==null?void 0:n.updateStreams():yield this.enableLocalVideo():yield(i=this.publisher)==null?void 0:i.publishUpdate())})}isLocalVideoStreamPublished(){var e,t;return(t=(e=this.publisher)==null?void 0:e.publishLocalVideoStreamEnabled)!=null?t:!0}setRemoteDefaultVideoStreamType(e){[Lt.AliRtcVideoStreamTypeHigh,Lt.AliRtcVideoStreamTypeLow].includes(e)&&this.bizControl.setRemoteDefaultVideoStreamType(e)}setRemoteUserVideoStreamType(e,t){[Lt.AliRtcVideoStreamTypeHigh,Lt.AliRtcVideoStreamTypeLow].includes(t)&&this.bizControl.setRemoteUserVideoStreamType(e,t)}setDefaultSubscribeAllRemoteVideoStreams(e){this.bizControl.setAutoSubVideo(e),this.bizControl.setAutoSubScreen(e)}subscribeAllRemoteVideoStreams(e){this.bizControl.setWantSubVideo(e),this.bizControl.setWantSubScreen(e)}subscribeRemoteMediaStream(e,t,r,n){const i=this.bizControl.getRemoteUser(e);if(!i)throw new ue(pe.ERR_INNER,`no remote user(${e}) founded`);r&&(t===xe.AliRtcVideoTrackScreen||t===xe.AliRtcVideoTrackBoth)?i.setWantSubScreen(!0):i.setWantSubScreen(!1),r&&(t===xe.AliRtcVideoTrackCamera||t===xe.AliRtcVideoTrackBoth)?i.setWantSubVideo(!0):i.setWantSubVideo(!1),i.setWantSubAudio(n),i.updateSubscribe(tt.User)}resumeRemoteMediaStream(e,t){const r=this.bizControl.getRemoteUser(e);r&&r.resumeVideo(t)}getOnlineRemoteUsers(){return this.bizControl.remoteUsers.map(e=>e.userId)}getUserInfo(e){var t;return(t=this.bizControl.getRemoteUser(e))==null?void 0:t.remoteUserInfo}isUserOnline(e){return!!this.bizControl.remoteUsers.find(t=>t.userId===e)}startScreenShare(e){return Q(this,null,function*(){var t;const r={video:!1,audio:!1},{audio:n=!1,videoTrack:i,audioTrack:o}=e||{};if(i||o){r.screen=!0;const s=new MediaStream;i&&s.addTrack(i),o&&s.addTrack(o),r.mediaStream=s}else r.screen=n?{audio:!0}:!0;yield(t=this.publisher)==null?void 0:t.createLocalStream(r)})}stopScreenShare(){return Q(this,null,function*(){var e;(e=this.publisher)==null||e.stopLocalStream({screen:!0})})}setScreenShareConfiguration(e){return Q(this,null,function*(){var t;const{frameRate:r=Uo.frameRate,bitrate:n=Uo.maxBitrate}=e;yield(t=this.publisher)==null?void 0:t.setScreenProfile(Qv,{width:Uo.width,height:Uo.height,frameRate:r,maxBitrate:n})})}setScreenShareContentHint(e){return Q(this,null,function*(){var t;e&&((t=this.publisher)==null||t.setScreenContentHint(e))})}publishLocalScreenShareStream(e,t){return Q(this,null,function*(){var r,n,i;(r=this.publisher)==null||r.setPublishLocalScreenStreamEnabled(e),this.connectState===Ze.AliRtcConnectionStatusConnected&&(e?(n=this.publisher)!=null&&n.hasScreenShare?yield this.publisher.updateStreams():yield this.startScreenShare(t):yield(i=this.publisher)==null?void 0:i.publishUpdate())})}isScreenSharePublished(){var e,t;return(t=(e=this.publisher)==null?void 0:e.publishLocalScreenStreamEnabled)!=null?t:!0}setAudioShareVolume(e){if(typeof e!="number")throw new ue(pe.ERR_INVALID_ARGUMENTS,"volume must be a number");this.bizControl.setAudioVolume({screen:Math.max(0,Math.min(e,400))/100})}enableAudioVolumeIndication(e){this.bizControl.enableAudioVolumeIndication(e)}muteLocalMic(e=!1){var t;this.isPublishing&&this.onLocalDeviceStatusChange(e?Ye.MuteAudio:Ye.UnmuteAudio),(t=this.publisher)==null||t.muteLocalMic(e)}muteRemoteAudioPlaying(e,t=!1){const r=this.bizControl.getRemoteUser(e);if(!r)throw new ue(pe.ERR_INNER,`no remote user(${e}) founded`);r.setAudioMuted(t)}muteAllRemoteAudioPlaying(e=!1){this.bizControl.setAudioMuted(e)}startAudioCapture(e){return Q(this,null,function*(){var t;const r={audio:e||!0};yield(t=this.publisher)==null?void 0:t.createLocalStream(r)})}stopAudioCapture(){var e;(e=this.publisher)==null||e.stopAudioCapture()}switchMicrophone(e,t){return Q(this,null,function*(){var r,n,i,o;if(yield(r=this.publisher)==null?void 0:r.setMicrophoneDeviceId(e),!((n=this.publisher)!=null&&n.audioCaptureDisabled)){if(t){yield(i=this.publisher)==null?void 0:i.createLocalStream({audio:!0,mediaStream:new MediaStream([t])});return}yield(o=this.publisher)==null?void 0:o.createLocalStream({audio:{deviceId:e}})}})}setRecordingVolume(e){if(typeof e!="number")throw new ue(pe.ERR_INVALID_ARGUMENTS,"volume must be a number");this.bizControl.setAudioVolume({audio:Math.max(0,Math.min(e,400))/100})}setPlayoutVolume(e){if(typeof e!="number")throw new ue(pe.ERR_INVALID_ARGUMENTS,"volume must be a number");this.bizControl.setPlayoutVolume(Math.max(0,Math.min(e,100))/100)}setRemoteAudioVolume(e,t){const r=this.bizControl.getRemoteUser(e);if(!r)throw new ue(pe.ERR_INNER,`no remote user(${e}) founded`);if(typeof t!="number")throw new ue(pe.ERR_INVALID_ARGUMENTS,"volume must be a number");r.setPlayoutVolume(Math.max(0,Math.min(t,100))/100)}setAudioProfile(e){return Q(this,null,function*(){var t;yield(t=this.publisher)==null?void 0:t.setAudioProfile(e)})}getAudioTrack(e){return Q(this,null,function*(){var t;if(!e)return(t=this.publisher)==null?void 0:t.audioTrack;const r=this.bizControl.getRemoteUser(e);return r==null?void 0:r.getAudioTrack})}setLocalViewConfig(e,t){return Q(this,null,function*(){var r,n,i;if(this._audioOnlyMode)throw new ue(pe.ERR_INNER,"Cannot set local view in audio only mode");(r=this.bizControl)==null||r.setLocalViewConfig(e,t),t===xe.AliRtcVideoTrackCamera&&(n=this.publisher)!=null&&n.hasCamera?yield this.startPreview():t===xe.AliRtcVideoTrackScreen&&(i=this.publisher)!=null&&i.hasScreenShare&&(yield this.startPreviewScreen())})}setCameraCapturerConfiguration(e){return Q(this,null,function*(){var t,r,n;const{width:i=xo.width,height:o=xo.height,frameRate:s=xo.frameRate,bitrate:a=xo.maxBitrate,cameraDirection:c,deviceId:u}=e;yield(t=this.publisher)==null?void 0:t.setVideoProfile(Yv,{width:i,height:o,frameRate:s,maxBitrate:a}),c!==void 0&&((r=this.publisher)==null||r.setCameraDirection(c)),u&&((n=this.publisher)==null||n.setCameraDeviceId(u))})}setCameraCapturerContentHint(e){return Q(this,null,function*(){var t;e&&((t=this.publisher)==null||t.setVideoContentHint(e))})}enableLocalVideo(e=!0){return Q(this,null,function*(){var t,r,n,i,o,s,a,c,u,d,E;if(this._audioOnlyMode)throw new ue(pe.ERR_INNER,"Cannot enable local video in audio only mode");e?((r=(t=this.publisher)==null?void 0:t.publishStreams)!=null&&r.video&&((o=(i=(n=this.publisher)==null?void 0:n.publishStreams)==null?void 0:i.video)==null||o.disableVideo(),(u=(c=(a=(s=this.publisher)==null?void 0:s.publishStreams)==null?void 0:a.video)==null?void 0:c.videoTrack)==null||u.stop()),yield(d=this.publisher)==null?void 0:d.startCameraCapture()):yield(E=this.publisher)==null?void 0:E.stopCameraCapture()})}muteLocalCamera(e){return Q(this,null,function*(){var t;this.isPublishing&&this.onLocalDeviceStatusChange(e?Ye.MuteVideo:Ye.UnmuteVideo),(t=this.publisher)==null||t.muteLocalCamera(e)})}muteLocalScreen(e){return Q(this,null,function*(){var t;this.isPublishing&&this.onLocalDeviceStatusChange(e?Ye.MuteScreen:Ye.UnmuteScreen),(t=this.publisher)==null||t.muteLocalScreen(e)})}setRemoteViewConfig(e,t,r){this.bizControl.setRemoteViewConfig(t,e,r)}isCameraOn(){var e,t;return(t=(e=this.publisher)==null?void 0:e.hasCamera)!=null?t:!1}switchCamera(e,t){return Q(this,null,function*(){var r,n,i,o,s,a,c,u,d,E,m,f,y;if(this._audioOnlyMode)throw new ue(pe.ERR_INNER,"Cannot switch camera in audio only mode");const S={};if(e?(S.deviceId=e,this.slsReporter.reportSwitchCamera(e)):(S.cameraDirection=((r=this.publisher)==null?void 0:r.cameraDirection)==="environment"?vs.CAMERA_FRONT:vs.CAMERA_REAR,this.slsReporter.reportSwitchCamera(((n=this.publisher)==null?void 0:n.cameraDirection)||"")),yield this.setCameraCapturerConfiguration(S),!((i=this.publisher)!=null&&i.cameraCaptureDisabled)){(s=(o=this.publisher)==null?void 0:o.publishStreams)!=null&&s.video&&((u=(c=(a=this.publisher)==null?void 0:a.publishStreams)==null?void 0:c.video)==null||u.disableVideo(),(f=(m=(E=(d=this.publisher)==null?void 0:d.publishStreams)==null?void 0:E.video)==null?void 0:m.videoTrack)==null||f.stop());const l={video:!0};t&&(l.mediaStream=new MediaStream([t])),yield(y=this.publisher)==null?void 0:y.createLocalStream(l)}})}getCurrentCameraDeviceId(){var e;return(e=this.publisher)==null?void 0:e.getCurrentCameraDeviceId()}startPreview(){return Q(this,null,function*(){var e,t;if(this._audioOnlyMode)throw new ue(pe.ERR_INNER,"Cannot start preview camera in audio only mode");(e=this.publisher)!=null&&e.hasCamera||(yield this.enableLocalVideo(!0)),yield(t=this.publisher)==null?void 0:t.previewAll({screen:!1})})}startPreviewScreen(e){return Q(this,null,function*(){var t,r;if(this._audioOnlyMode)throw new ue(pe.ERR_INNER,"Cannot start preview screen share in audio only mode");(t=this.publisher)!=null&&t.hasScreenShare||(yield this.startScreenShare(e)),yield(r=this.publisher)==null?void 0:r.previewAll({primary:!1})})}stopPreview(){return Q(this,null,function*(){var e;yield(e=this.publisher)==null?void 0:e.stopPreview({primary:!0,screen:!1})})}stopPreviewScreen(){return Q(this,null,function*(){var e;yield(e=this.publisher)==null?void 0:e.stopPreview({primary:!1,screen:!0})})}getVideoTrack(e){return Q(this,null,function*(){var t,r,n,i;const{userId:o,streamType:s}=e;if(!o)return s===Dt.AliRtcSdkStreamTypeCapture?(t=this.publisher)==null?void 0:t.cameraTrack:(r=this.publisher)==null?void 0:r.screenTrack;const a=this.bizControl.getRemoteUser(o);return s===Dt.AliRtcSdkStreamTypeCapture?(n=a==null?void 0:a.getCameraStream)==null?void 0:n.videoTrack:(i=a==null?void 0:a.getScreenStream)==null?void 0:i.videoTrack})}startPublishLiveStream(e,t){return Q(this,null,function*(){return this.liveTranscoding.startPublishLiveStream(e,t)})}updatePublishLiveStream(e,t){return Q(this,null,function*(){return this.liveTranscoding.updatePublishLiveStream(e,t)})}updatePublishLiveStreamWithTaskId(e,t){return this.liveTranscoding.updatePublishLiveStreamWithTaskId(e,t)}stopPublishLiveStream(e){return Q(this,null,function*(){return this.liveTranscoding.stopPublishLiveStream(e)})}stopPublishLiveStreamWithTaskId(e){return this.liveTranscoding.stopPublishLiveStreamWithTaskId(e)}setEnableMediaExtensionMsg(e){var t;(t=this.bizControl)==null||t.setEnableMediaExtensionMsg(!!e)}sendMediaExtensionMsg(e,t){return Q(this,null,function*(){return this.sendMediaExtensionMsgEx(e,t,5)})}sendMediaExtensionMsgEx(e,t,r){return Q(this,null,function*(){var n;if(!this.publisher||!this.isPublishing)throw new ue(pe.ERR_INNER,"you should publish first");return this.slsReporter.reportSEIMessage(r,e.byteLength,t,0,!1),(n=this.publisher)==null?void 0:n.sendSEI(e,t,r)})}enablePlugin(e,t){this.bizControl.pluginManager.add(e,t)}removePlugin(e){this.bizControl.pluginManager.remove(e)}setPluginOption(e,t){const r=this.bizControl.pluginManager.get(e);r&&t&&r.setOptions(t)}getPluginOption(e){const t=this.bizControl.pluginManager.get(e);return t==null?void 0:t.getOptions()}isBeautyAvailable(){return this.bizControl.pluginManager.has("AliRtcBeauty")}isBeautyEnabled(){const e=this.bizControl.pluginManager.get("AliRtcBeauty");if(!e)throw new ue(Bn.AliRtcPluginErrorNoFindPlugin,"you should enable beautyPlugin first");return!!(e!=null&&e.isEnable)}setBeautyEffect(e,t){const r=this.bizControl.pluginManager.get("AliRtcBeauty");if(!r)throw new ue(Bn.AliRtcPluginErrorNoFindPlugin,"you should enable beautyPlugin first");e?r.enable():r.disable(),r.setOptions({basicBeauty:{skinBuffing:Math.max(Math.min(1,+t.smoothnessLevel),0),whitening:Math.max(Math.min(1,+t.whiteningLevel),0)}})}enableBackgroundExchange(e,t){const r=this.bizControl.pluginManager.get("AliRtcBeauty");if(!r||!r.isEnable)throw new ue(Bn.AliRtcPluginErrorNoFindPlugin,"you should enable beautyPlugin first");const n={setSegmentBackgroundImage:{backgroundImgUrl:e?t:""}};e&&(n.segmentBackgroundProcess={enable:!1}),r.setOptions(n)}enableBackgroundBlur(e){const t=this.bizControl.pluginManager.get("AliRtcBeauty");if(!t||!t.isEnable)throw new ue(Bn.AliRtcPluginErrorNoFindPlugin,"you should enable beautyPlugin first");const r={segmentBackgroundProcess:{type:0,enable:e}};e&&(r.setSegmentBackgroundImage={type:0,backgroundImgUrl:""}),t.setOptions(r)}setParameter(e){this.bizControl.setParameter(e)}getParameter(){return this.bizControl.getParameter()}sendDataChannelMessage(e){this.bizControl.sendDataChannelMessage(e)}},B(Ce,"logName","AliRtcEngine"),B(Ce,"logError",!0),B(Ce,"isSupported",lb),B(Ce,"isDualVideoStreamSupported",Ol.isSupport),B(Ce,"getCameraList",()=>Q(Ce,null,function*(){return(yield We.AliRTS.getCameraList()).filter(e=>e.deviceId)})),B(Ce,"getMicrophoneList",()=>Q(Ce,null,function*(){return(yield We.AliRTS.getMicList()).filter(e=>e.deviceId)})),B(Ce,"getSpeakerList",()=>Q(Ce,null,function*(){return(yield We.AliRTS.getSpeakerList()).filter(e=>e.deviceId)})),B(Ce,"_instance"),B(Ce,"AliRtcSdkChannelProfile",vn),B(Ce,"AliRtcSdkClientRole",gn),B(Ce,"AliRtcVideoStreamType",Lt),B(Ce,"AliRtcVideoTrack",xe),B(Ce,"AliRtcAudioTrack",uo),B(Ce,"AliRtcPublishState",Oe),B(Ce,"AliRtcSubscribeState",qe),B(Ce,"AliRtcRawDataStreamType",Dt),B(Ce,"AliRtcLogLevel",Jd),B(Ce,"AliRtcEngineLocalDeviceType",cn),B(Ce,"AliRtcEngineLocalDeviceExceptionType",Ct),B(Ce,"AliRtcConnectionStatus",Ze),B(Ce,"AliRtcConnectionStatusChangeReason",ci),B(Ce,"AliRtcPlugin",_i),B(Ce,"AliRtcPluginTrackType",Ts),B(Ce,"AliRtcLiveTranscodingParam",Za),B(Ce,"AliRtcLiveTranscodingEncodeParam",eh),B(Ce,"AliRtcLiveTranscodingMixParam",r1),B(Ce,"AliRtcLiveTranscodingSingleParam",n1),B(Ce,"AliRtcTranscodingClockWidget",i1),B(Ce,"AliRtcTranscodingImage",ch),B(Ce,"AliRtcTranscodingText",s1),B(Ce,"AliRtcTranscodingUser",a1),B(Ce,"AliRtcLiveTranscodingMixMode",ms),B(Ce,"AliRtcLiveTranscodingStreamType",qd),B(Ce,"AliRtcLiveTranscodingSourceType",co),B(Ce,"AliRtcLiveTranscodingTaskProfile",Yd),B(Ce,"AliRtcLiveTranscodingAudioSampleRate",bc),B(Ce,"AliRtcLiveTranscodingSegmentType",gs),B(Ce,"AliRtcLiveTranscodingFontType",Cs),B(Ce,"AliRtcLiveTranscodingCropMode",Qd),B(Ce,"AliRtcLiveTranscodingMediaProcessMode",_c),B(Ce,"AliRtcLiveTranscodingState",Xd),B(Ce,"AliRtcLiveTranscodingErrorCode",on),B(Ce,"AliRtcTrascodingPublishTaskStatus",Zd),B(Ce,"AliRtcDataChannelMsg",Jn),B(Ce,"AliRtcDataMsgType",oh),B(Ce,"Plugin",_i),Ce);Re([ee()],ye.prototype,"destroy",1);Re([ee()],ye.prototype,"backToUnpublishStatus",1);Re([ee()],ye.prototype,"resumePublishForNetworkRecovery",1);Re([ee()],ye.prototype,"onNetworkRecovery",1);Re([ee()],ye.prototype,"resumeSubList",1);Re([ee(ge)],ye.prototype,"retrySubscribe",1);Re([ee(ge)],ye.prototype,"setEnableDualVideoStream",1);Re([ee(ge)],ye.prototype,"setChannelProfile",1);Re([ee(ge)],ye.prototype,"setClientRole",1);Re([ee(ge)],ye.prototype,"setAudioOnlyMode",1);Re([ee()],ye.prototype,"clearCheckAuthInfoTimer",1);Re([ee(ge)],ye.prototype,"joinChannel",1);Re([ee(ge)],ye.prototype,"leaveChannel",1);Re([ee(ge)],ye.prototype,"refreshAuthInfo",1);Re([ee(ge)],ye.prototype,"publishLocalAudioStream",1);Re([ee(ge)],ye.prototype,"setDefaultSubscribeAllRemoteAudioStreams",1);Re([ee(ge)],ye.prototype,"subscribeAllRemoteAudioStreams",1);Re([ee(ge)],ye.prototype,"subscribeRemoteAudioStream",1);Re([ee(ge)],ye.prototype,"resumeRemoteAudioStream",1);Re([ee(ge)],ye.prototype,"stopRemoteAudioPlay",1);Re([ee(ge)],ye.prototype,"publishLocalVideoStream",1);Re([ee(ge)],ye.prototype,"setRemoteDefaultVideoStreamType",1);Re([ee(ge)],ye.prototype,"setRemoteUserVideoStreamType",1);Re([ee(ge)],ye.prototype,"setDefaultSubscribeAllRemoteVideoStreams",1);Re([ee(ge)],ye.prototype,"subscribeAllRemoteVideoStreams",1);Re([ee(ge)],ye.prototype,"subscribeRemoteMediaStream",1);Re([ee(ge)],ye.prototype,"resumeRemoteMediaStream",1);Re([ee(([e])=>[`${e==null?void 0:e.audio}`])],ye.prototype,"startScreenShare",1);Re([ee()],ye.prototype,"stopScreenShare",1);Re([ee(ge)],ye.prototype,"setScreenShareConfiguration",1);Re([ee(ge)],ye.prototype,"setScreenShareContentHint",1);Re([ee()],ye.prototype,"publishLocalScreenShareStream",1);Re([ee(ge)],ye.prototype,"setAudioShareVolume",1);Re([ee(ge)],ye.prototype,"enableAudioVolumeIndication",1);Re([ee(ge)],ye.prototype,"muteLocalMic",1);Re([ee(ge)],ye.prototype,"muteRemoteAudioPlaying",1);Re([ee(ge)],ye.prototype,"muteAllRemoteAudioPlaying",1);Re([ee(ge)],ye.prototype,"startAudioCapture",1);Re([ee()],ye.prototype,"stopAudioCapture",1);Re([ee(ge)],ye.prototype,"switchMicrophone",1);Re([ee(ge)],ye.prototype,"setRecordingVolume",1);Re([ee(ge)],ye.prototype,"setPlayoutVolume",1);Re([ee(ge)],ye.prototype,"setRemoteAudioVolume",1);Re([ee(ge)],ye.prototype,"setAudioProfile",1);Re([ee(ge)],ye.prototype,"getAudioTrack",1);Re([ee(ge)],ye.prototype,"setLocalViewConfig",1);Re([ee(ge)],ye.prototype,"setCameraCapturerConfiguration",1);Re([ee(ge)],ye.prototype,"setCameraCapturerContentHint",1);Re([ee(ge)],ye.prototype,"enableLocalVideo",1);Re([ee(ge)],ye.prototype,"muteLocalCamera",1);Re([ee(ge)],ye.prototype,"muteLocalScreen",1);Re([ee(ge)],ye.prototype,"setRemoteViewConfig",1);Re([ee(ge)],ye.prototype,"switchCamera",1);Re([ee()],ye.prototype,"startPreview",1);Re([ee()],ye.prototype,"startPreviewScreen",1);Re([ee()],ye.prototype,"stopPreview",1);Re([ee()],ye.prototype,"stopPreviewScreen",1);Re([ee()],ye.prototype,"startPublishLiveStream",1);Re([ee()],ye.prototype,"updatePublishLiveStream",1);Re([ee()],ye.prototype,"updatePublishLiveStreamWithTaskId",1);Re([ee()],ye.prototype,"stopPublishLiveStream",1);Re([ee()],ye.prototype,"stopPublishLiveStreamWithTaskId",1);Re([ee(ge)],ye.prototype,"setEnableMediaExtensionMsg",1);Re([ee(([e,t,r])=>[e.byteLength,t,r])],ye.prototype,"sendMediaExtensionMsgEx",1);Re([ee(([e,t])=>[e.name||"",t])],ye.prototype,"enablePlugin",1);Re([ee(ge)],ye.prototype,"removePlugin",1);Re([ee(ge)],ye.prototype,"setPluginOption",1);Re([ee(ge)],ye.prototype,"getPluginOption",1);Re([ee(ge)],ye.prototype,"setBeautyEffect",1);Re([ee(ge)],ye.prototype,"enableBackgroundExchange",1);Re([ee(ge)],ye.prototype,"enableBackgroundBlur",1);Re([ee(ge)],ye.prototype,"setParameter",1);Re([ee(([e])=>{var t;return[(t=e.data)==null?void 0:t.byteLength]})],ye.prototype,"sendDataChannelMessage",1);Re([ee(ge)],ye,"setLogLevel",1);let u1=ye;var Ym;const l1=new jd({businessName:"imp-web-rtc",version:(Ym=u1.getSdkVersion())!=null?Ym:"unknown",env:"prod",disabled:window.AliRtcOptionsDisableProxy===!0});l1.setReady();const Yo=l1.wrap(u1),__=Object.freeze(Object.defineProperty({__proto__:null,AliRtcConnectionStatus:Ze,AliRtcConnectionStatusChangeReason:ci,AliRtcDataChannelMsg:Jn,AliRtcDataMsgType:oh,AliRtcEngineLocalDeviceExceptionType:Ct,AliRtcEngineLocalDeviceType:cn,AliRtcErrorCode:pe,AliRtcLiveTranscodingAudioSampleRate:bc,AliRtcLiveTranscodingCropMode:Qd,AliRtcLiveTranscodingEncodeParam:eh,AliRtcLiveTranscodingErrorCode:on,AliRtcLiveTranscodingFontType:Cs,AliRtcLiveTranscodingMediaProcessMode:_c,AliRtcLiveTranscodingMixMode:ms,AliRtcLiveTranscodingMixParam:r1,AliRtcLiveTranscodingParam:Za,AliRtcLiveTranscodingSegmentType:gs,AliRtcLiveTranscodingSingleParam:n1,AliRtcLiveTranscodingSourceType:co,AliRtcLiveTranscodingState:Xd,AliRtcLiveTranscodingStreamType:qd,AliRtcLiveTranscodingTaskProfile:Yd,AliRtcLocalStreamInfo:Il,AliRtcLogLevel:Jd,AliRtcPlugin:_i,AliRtcPluginTrackType:Ts,AliRtcPluginType:Wv,AliRtcPublishState:Oe,AliRtcRawDataStreamType:Dt,AliRtcRemoteUserInfo:e1,AliRtcSdkChannelProfile:vn,AliRtcSdkClientRole:gn,AliRtcSubscribeState:qe,AliRtcTranscodingClockWidget:i1,AliRtcTranscodingImage:ch,AliRtcTranscodingText:s1,AliRtcTranscodingUser:a1,AliRtcTrascodingPublishTaskStatus:Zd,AliRtcVideoStreamType:Lt,AliRtcVideoTrack:xe,default:Yo},Symbol.toStringTag,{value:"Module"}));var T_=Object.defineProperty,C_=(e,t,r)=>t in e?T_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,De=(e,t,r)=>C_(e,typeof t!="symbol"?t+"":t,r),Wt=(e,t,r)=>new Promise((n,i)=>{var o=c=>{try{a(r.next(c))}catch(u){i(u)}},s=c=>{try{a(r.throw(c))}catch(u){i(u)}},a=c=>c.done?n(c.value):Promise.resolve(c.value).then(o,s);a((r=r.apply(e,t)).next())});function w_(e){const t=atob(e),r=new Uint8Array(t.length);for(let n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return new TextDecoder("utf-8").decode(r)}var Tr=(e=>(e[e.VoiceAgent=0]="VoiceAgent",e[e.AvatarAgent=1]="AvatarAgent",e[e.VisionAgent=2]="VisionAgent",e))(Tr||{}),Dr=(e=>(e[e.Listening=1]="Listening",e[e.Thinking=2]="Thinking",e[e.Speaking=3]="Speaking",e))(Dr||{}),Qt=(e=>(e[e.None=0]="None",e[e.InvalidAction=-1]="InvalidAction",e[e.InvalidParames=-2]="InvalidParames",e[e.BeginCallFailed=-1e4]="BeginCallFailed",e[e.ConnectionFailed=-10001]="ConnectionFailed",e[e.PublishFailed=-10002]="PublishFailed",e[e.SubscribeFailed=-10003]="SubscribeFailed",e[e.TokenExpired=-10004]="TokenExpired",e[e.KickedByUserReplace=-10005]="KickedByUserReplace",e[e.KickedBySystem=-10006]="KickedBySystem",e[e.KickedByChannelTerminated=-10007]="KickedByChannelTerminated",e[e.LocalDeviceException=-10008]="LocalDeviceException",e[e.AgentLeaveChannel=-10101]="AgentLeaveChannel",e[e.AgentPullFailed=-10102]="AgentPullFailed",e[e.AgentASRFailed=-10103]="AgentASRFailed",e[e.AvatarServiceFailed=-10201]="AvatarServiceFailed",e[e.AvatarRoutesExhausted=-10202]="AvatarRoutesExhausted",e[e.AgentSubscriptionRequired=-10203]="AgentSubscriptionRequired",e[e.AgentNotFound=-10204]="AgentNotFound",e[e.UnknowError=-4e4]="UnknowError",e))(Qt||{});class uh{constructor(t,r,n,i,o,s){De(this,"shareId"),De(this,"agentType"),De(this,"expireTime"),De(this,"templateConfig"),De(this,"region"),De(this,"userData"),this.shareId=t,this.agentType=r,this.expireTime=n,this.templateConfig=i,this.region=o,this.userData=s}static fromToken(t){const r=w_(decodeURIComponent(t).split(" ").join("+")),n=JSON.parse(r),i=n.ExpireTime;let o=0;return n.WorkflowType==="AvatarChat3D"?o=1:n.WorkflowType==="VisionChat"&&(o=2),new uh(n.TemporaryAIAgentId,o,new Date(i.replace(" ","T")+"Z"),n.TemplateConfig,n.Region,n.UserData)}}class Sn extends Error{constructor(t,r){super(t),De(this,"code"),this.code=r||-4e4}}class Ki{constructor(){De(this,"agentGreeting"),De(this,"userOnlineTimeout",-1),De(this,"userOfflineTimeout",-1),De(this,"workflowOverrideParams"),De(this,"bailianAppParams"),De(this,"asrMaxSilence",-1),De(this,"volume",-1),De(this,"enableVoiceInterrupt",!0),De(this,"agentVoiceId"),De(this,"avatarUrl"),De(this,"enableIntelligentSegment",!0),De(this,"agentMaxIdleTime",-1),De(this,"enablePushToTalk",!1),De(this,"agentAvatarId"),De(this,"agentGracefulShutdown",!1),De(this,"asrLanguageId"),De(this,"wakeUpQuery")}getJsonString(t){const r={},n={EnableVoiceInterrupt:this.enableVoiceInterrupt,EnablePushToTalk:this.enablePushToTalk,EnableIntelligentSegment:this.enableIntelligentSegment,GracefulShutdown:this.agentGracefulShutdown};return this.agentGreeting!==void 0&&(n.Greeting=this.agentGreeting),this.userOnlineTimeout>-1&&(n.UserOnlineTimeout=this.userOnlineTimeout),this.userOfflineTimeout>-1&&(n.UserOfflineTimeout=this.userOfflineTimeout),this.workflowOverrideParams!==void 0&&(n.WorkflowOverrideParams=JSON.stringify(this.workflowOverrideParams)),this.bailianAppParams!==void 0&&(n.BailianAppParams=JSON.stringify(this.bailianAppParams)),this.asrMaxSilence>-1&&(n.AsrMaxSilence=this.asrMaxSilence),this.volume>-1&&(n.Volume=this.volume),this.agentVoiceId!==void 0&&(n.VoiceId=this.agentVoiceId),this.agentMaxIdleTime>-1&&(n.MaxIdleTime=this.agentMaxIdleTime),t===Tr.AvatarAgent&&this.agentAvatarId!==void 0&&(n.AvatarId=this.agentAvatarId),this.asrLanguageId!==void 0&&(n.AsrLanguageId=this.asrLanguageId),this.wakeUpQuery!==void 0&&(n.WakeUpQuery=this.wakeUpQuery),r[Ki.getTemplateConfigKey(t)]=n,JSON.stringify(r)}static getTemplateConfigKey(t){switch(t){case Tr.AvatarAgent:return"AvatarChat3D";case Tr.VisionAgent:return"VisionChat";default:return"VoiceChat"}}static fromJsonString(t,r){try{const n=JSON.parse(r),i=Ki.getTemplateConfigKey(t),o=n[i],s=new Ki;return o.EnablePushToTalk!==void 0&&(s.enablePushToTalk=o.EnablePushToTalk),o.EnableIntelligentSegment!==void 0&&(s.enableIntelligentSegment=o.EnableIntelligentSegment),o.EnableVoiceInterrupt!==void 0&&(s.enableVoiceInterrupt=o.EnableVoiceInterrupt),o.Greeting!==void 0&&(s.agentGreeting=o.Greeting),o.UserOnlineTimeout!==void 0&&(s.userOnlineTimeout=o.UserOnlineTimeout),o.WorkflowOverrideParams!==void 0&&(s.workflowOverrideParams=JSON.parse(o.WorkflowOverrideParams)),o.BailianAppParams!==void 0&&(s.bailianAppParams=JSON.parse(o.BailianAppParams)),o.AsrMaxSilence!==void 0&&(s.asrMaxSilence=o.AsrMaxSilence),o.Volume!==void 0&&(s.volume=o.Volume),o.VoiceId!==void 0&&(s.agentVoiceId=o.VoiceId),o.MaxIdleTime!==void 0&&(s.agentMaxIdleTime=o.MaxIdleTime),t===Tr.AvatarAgent&&o.AvatarId!==void 0&&(s.agentAvatarId=o.AvatarId),o.AsrLanguageId!==void 0&&(s.asrLanguageId=o.AsrLanguageId),o.WakeUpQuery!==void 0&&(s.wakeUpQuery=o.WakeUpQuery),s}catch(n){return console.error(n),new Ki}}}var pt=(e=>(e[e.None=0]="None",e[e.AgentErrorOccurs=1e3]="AgentErrorOccurs",e[e.AgentStateChanged=1001]="AgentStateChanged",e[e.AgentSubtitleNotify=1002]="AgentSubtitleNotify",e[e.UserSubtitleNotify=1003]="UserSubtitleNotify",e[e.VoiceInterruptChanged=1004]="VoiceInterruptChanged",e[e.VoiceIdChanged=1005]="VoiceIdChanged",e[e.RTCTokenResponsed=1006]="RTCTokenResponsed",e[e.PushToTalkChanged=1007]="PushToTalkChanged",e[e.VoiceprintUsingChanged=1008]="VoiceprintUsingChanged",e[e.VoiceprintClearSucceed=1009]="VoiceprintClearSucceed",e[e.AgentWillLeave=1010]="AgentWillLeave",e[e.CustomMessageReceived=1011]="CustomMessageReceived",e[e.HumanTakeoverWillStart=1012]="HumanTakeoverWillStart",e[e.HumanTakeoverConnected=1013]="HumanTakeoverConnected",e[e.AgentEmotionNotify=1014]="AgentEmotionNotify",e[e.StopAgent=1100]="StopAgent",e[e.InterruptSpeaking=1101]="InterruptSpeaking",e[e.EnableVoiceInterrupt=1102]="EnableVoiceInterrupt",e[e.SwitchVoiceId=1103]="SwitchVoiceId",e[e.RequestRTCToken=1104]="RequestRTCToken",e[e.EnablePushToTalk=1105]="EnablePushToTalk",e[e.StartPushToTalk=1106]="StartPushToTalk",e[e.FinishPushToTalk=1107]="FinishPushToTalk",e[e.CancelPushToTalk=1108]="CancelPushToTalk",e[e.SendTextToAgent=1111]="SendTextToAgent",e))(pt||{});const A_="https://ice-smart-aiagent-fcapp-appserver.aliyuncs.com",ma=class{};De(ma,"generateAIAgent",(e,t,r,n,i,o)=>Wt(ma,null,function*(){if(!e||!t)throw new Error("userId or sharedId is empty");const s={user_id:e,expire:24*60*60,ai_agent_id:t};let a={};if(n)try{a=JSON.parse(n)}catch(c){console.log(c)}return s.template_config=JSON.stringify(a),i&&(s.region=i),o&&(s.user_data=o),fetch(`${A_}/api/v1/aiagent/generateAIAgentCall`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).then(c=>Wt(ma,null,function*(){let u={};try{u=yield c.json()}catch(d){console.error(d)}if(u.error_code==="Forbidden.SubscriptionRequired")throw new Sn("Forbidden.SubscriptionRequired",Qt.AgentSubscriptionRequired);if(u.error_code==="AgentNotFound")throw new Sn("AgentNotFound",Qt.AgentNotFound);if(c.status!==200)throw new Sn(`response status is ${c.status}`);return u})).then(c=>{if(c.code===200)return{agentType:r,instanceId:c.ai_agent_instance_id,channelId:c.channel_id,userId:c.ai_agent_user_id,rtcToken:c.rtc_auth_token,reqId:c.request_id||""};throw new Sn(c.message||"request error")})}));let k_=ma;class ga extends Ut{constructor(t){super(),De(this,"_isCalling",!1),De(this,"_isOnCall",!1),De(this,"_rtcEngine"),De(this,"_dcReady",!1),De(this,"_seqId",1),De(this,"_userId"),De(this,"_config"),De(this,"_agentType"),De(this,"_agentInfo"),De(this,"_agentState",Dr.Listening),De(this,"_avatarUserId"),De(this,"_avatarViewSeted",!1),De(this,"_view"),De(this,"_takeoverUid"),De(this,"_takeoverMode"),De(this,"_enablePushToTalk",!1),De(this,"_isStartPushToTalk",!1),De(this,"onDataChannelMsg",(r,n)=>{var i,o,s;try{const a=JSON.parse(new TextDecoder().decode(n.data));if(a.type===pt.AgentStateChanged)this._agentState=a.data.state,this.emit("agentStateChange",a.data.state);else if(a.type===pt.AgentSubtitleNotify)this.emit("agentSubtitleNotify",a.data);else if(a.type===pt.UserSubtitleNotify)this.emit("userSubtitleNotify",a.data);else if(a.type===pt.AgentEmotionNotify)this.emit("agentEmotionNotify",a.data.emotion,a.data.sentenceId);else if(a.type===pt.VoiceInterruptChanged)this.emit("voiceInterruptChanged",a.data.enable);else if(a.type===pt.VoiceIdChanged)this.emit("voiceIdChanged",a.data.voiceId);else if(a.type===pt.PushToTalkChanged)this.emit("pushToTalkChanged",a.data.enable);else if(a.type===pt.RTCTokenResponsed)this.emit("newRTCToken",a.data.token);else if(a.type===pt.AgentErrorOccurs){let c=0;const u=a.data.code;u===4001?c=Qt.AvatarRoutesExhausted:u===4004?c=Qt.AgentPullFailed:u===4005?c=Qt.AgentASRFailed:u===4006&&(c=Qt.AvatarServiceFailed),c&&this.emit("errorOccurred",c)}else if(a.type===pt.AgentWillLeave)this.emit("agentWillLeave",a.data.reason,a.data.message);else if(a.type===pt.CustomMessageReceived){const c=a.data.message||"";try{const u=JSON.parse(c);this.emit("receivedAgentCustomMessage",u)}catch(u){console.error(u)}}else if(a.type===pt.HumanTakeoverWillStart){const c=(i=a.data)==null?void 0:i.takeoverUid,u=(o=a.data)==null?void 0:o.takeoverMode;if(this._takeoverUid=c,this._takeoverMode=u,u===0)try{(s=this._rtcEngine)==null||s.subscribeRemoteAudioStream(c,!1)}catch{}this.emit("humanTakeoverWillStart",c,u)}else if(a.type===pt.HumanTakeoverConnected){const c=a.data.takeoverUid;this.emit("humanTakeoverConnected",c)}else console.log(`AICallEngine dataChannelMsg unknown: ${JSON.stringify(a)}`)}catch(a){console.log(`AICallEngine dataChannelMsg failed: ${a}`)}}),De(this,"handleLocalUserVolume",(r,n)=>{this.emit("speakingVolumeChanged",r,n)}),this._config=t||{}}static parseShareAgentCall(t){return uh.fromToken(t)}get userId(){return this._userId}get isOnCall(){return this._isOnCall}get agentInfo(){return this._agentInfo}get agentState(){return this._agentState}getRTCInstance(){return this._rtcEngine}standardAgentInfo(t){const r=t,n=t,i=t;return!r.channelId&&(n.channel_id||i.ChannelId)&&(r.channelId=n.channel_id||i.ChannelId),!r.rtcToken&&(n.rtc_auth_token||i.Token)&&(r.rtcToken=n.rtc_auth_token||i.Token),!r.instanceId&&(n.ai_agent_instance_id||i.InstanceId)&&(r.instanceId=n.ai_agent_instance_id||i.InstanceId),!r.userId&&(n.ai_agent_user_id||i.AIAgentUserId)&&(r.userId=n.ai_agent_user_id||i.AIAgentUserId),!r.reqId&&(n.request_id||i.RequestId)&&(r.reqId=n.request_id||i.RequestId),r}init(t,r){return Wt(this,null,function*(){var n,i,o,s,a,c,u,d;r&&(this._config=r),this._agentType=t;const E={};if(((i=(n=this._config)==null?void 0:n.rtcEngineConfig)==null?void 0:i.environment)==="PRE"&&(E.env="pre"),this._rtcEngine=Yo.getInstance(E),this._rtcEngine.setParameter(JSON.stringify({data:{enablePubDataChannel:!0,enableSubDataChannel:!0}})),this._rtcEngine.setClientRole(gn.AliRtcSdkInteractive),this._rtcEngine.enableAudioVolumeIndication(200),this._rtcEngine.on("dataChannelMsg",this.onDataChannelMsg),this._rtcEngine.on("audioVolume",m=>{m.forEach(({volume:f,userId:y})=>{this.handleLocalUserVolume(y,f)})}),this._rtcEngine.on("onOccurError",m=>{console.log(m)}),this._rtcEngine.on("authInfoWillExpire",()=>{this.emit("authInfoWillExpire")}),this._rtcEngine.on("authInfoExpired",()=>{this.emit("authInfoExpired")}),this._rtcEngine.on("remoteUserOnLineNotify",m=>{var f;this._takeoverUid===m&&this._takeoverMode===0&&((f=this._rtcEngine)==null||f.subscribeRemoteAudioStream(m,!1))}),this._rtcEngine.on("remoteUserOffLineNotify",m=>{var f;(((f=this.agentInfo)==null?void 0:f.userId)===m||this._avatarUserId===m)&&this.emit("errorOccurred",Qt.AgentLeaveChannel)}),this._rtcEngine.on("dataPublishStateChanged",(m,f)=>{f===Oe.AliRtcStatePublished?this._dcReady=!0:this._dcReady=!1}),this._rtcEngine.on("localDeviceException",m=>{var f,y;m===1?(f=this._rtcEngine)==null||f.startAudioCapture():m===4&&((y=this._rtcEngine)==null||y.enableLocalVideo(!0))}),this._rtcEngine.on("bye",m=>{m===1?this.emit("errorOccurred",Qt.KickedBySystem):m===2?this.emit("errorOccurred",Qt.KickedByChannelTerminated):m===3&&this.emit("errorOccurred",Qt.KickedByUserReplace)}),this._rtcEngine.on("remoteTrackAvailableNotify",(m,f,y)=>{var S;this._agentType===Tr.AvatarAgent&&y===xe.AliRtcVideoTrackCamera&&m!==((S=this.agentInfo)==null?void 0:S.userId)&&!this._avatarUserId&&(this._avatarUserId=m,this.startPlayAgentVideo())}),this._rtcEngine.on("audioSubscribeStateChanged",(m,f,y)=>{var S,l,h,p;m===((S=this.agentInfo)==null?void 0:S.userId)&&y===qe.AliRtcStateSubscribed&&this.emit("audioSubscribed",m,(p=(h=this._rtcEngine)==null?void 0:h.getUserInfo((l=this.agentInfo)==null?void 0:l.userId))==null?void 0:p.audioElement)}),this._agentType===Tr.VisionAgent){(o=this._config)!=null&&o.previewElement&&this._rtcEngine.setLocalViewConfig((s=this._config)==null?void 0:s.previewElement,xe.AliRtcVideoTrackCamera);const m={};let f=!1;(a=this._config.cameraConfig)!=null&&a.width&&(f=!0,m.width=this._config.cameraConfig.width),(c=this._config.cameraConfig)!=null&&c.height&&(f=!0,m.height=this._config.cameraConfig.height),(u=this._config.cameraConfig)!=null&&u.frameRate&&(f=!0,m.frameRate=this._config.cameraConfig.frameRate),(d=this._config.cameraConfig)!=null&&d.bitrate&&(f=!0,m.bitrate=this._config.cameraConfig.bitrate),f&&this._rtcEngine.setCameraCapturerConfiguration(m)}else this._rtcEngine.publishLocalVideoStream(!1);try{this._agentType===Tr.VisionAgent?yield Promise.all([this._rtcEngine.enableLocalVideo(!0),this._rtcEngine.startAudioCapture()]):yield this._rtcEngine.startAudioCapture()}catch(m){this._isCalling=!1;const f=m.errorCode;if(f>=1e4&&f<=10007){const y=new Sn(`Device Not Allowed or Not Readable, code: ${f}`);throw y.code=Qt.LocalDeviceException,y}throw m}})}call(t,r,n,i){return Wt(this,null,function*(){var o,s,a,c,u,d;const E=this.standardAgentInfo(r);if(n!==void 0&&(typeof n=="object"?this._config=n:(this._agentType=n,i&&(this._config=i))),this._agentType||(this._agentType=E.agentType),this._agentType===void 0){const m=new Sn("InvalidParames, agentType is undefined");throw m.code=Qt.InvalidParames,m}if(((o=this._config)==null?void 0:o.enablePushToTalk)!==void 0&&((s=this._config.templateConfig)==null?void 0:s.enablePushToTalk)===void 0&&(this._config.templateConfig||(this._config.templateConfig=new Ki),this._config.templateConfig.enablePushToTalk=this._config.enablePushToTalk),this._enablePushToTalk=((a=this._config.templateConfig)==null?void 0:a.enablePushToTalk)||!1,!this._isCalling){if(this._userId=t,this._agentInfo=E,this._isCalling=!0,this._rtcEngine||(yield this.init(this._agentType,this._config)),!this._rtcEngine){this._isCalling=!1;const m=new Sn("RTCEngine init failed");throw m.code=Qt.UnknowError,m}try{yield this._rtcEngine.joinChannel(E.rtcToken,t);const m=((c=this._rtcEngine)==null?void 0:c.remoteUsers)||[];if(m.length>0){const f=m[0];f.hasVideoTrack&&(this._avatarUserId=f.userId,this.startPlayAgentVideo())}this._isOnCall=!0,this._enablePushToTalk&&(this.mute(!0),(u=this._config.pushToTalkConfig)!=null&&u.closeMicrophoneOnRelease&&(this._rtcEngine.setParameter(JSON.stringify({enableBlankAudio:!0})),this._rtcEngine.stopAudioCapture()),(d=this._config.pushToTalkConfig)!=null&&d.pushVideoOnRelease||this._rtcEngine.publishLocalVideoStream(!1)),this.emit("callBegin")}catch(m){throw console.log(`AICallEngine joinChannel failed: ${m.code} - ${m.message}`),m}}})}startPlayAgentVideo(){!this._view||!this._avatarUserId||this._avatarViewSeted||this._rtcEngine&&(this._rtcEngine.setRemoteViewConfig(this._view,this._avatarUserId,xe.AliRtcVideoTrackCamera),this._avatarViewSeted=!0)}setAgentView(t){this._view=t,this.startPlayAgentVideo()}startPreview(t){var r;this._config.previewElement=t,(r=this._rtcEngine)==null||r.setLocalViewConfig(t,xe.AliRtcVideoTrackCamera)}stopPreview(){var t;(t=this._rtcEngine)==null||t.setLocalViewConfig(null,xe.AliRtcVideoTrackCamera)}handup(){return Wt(this,null,function*(){this.emit("callEnd"),this.destroy()})}destroy(){return Wt(this,null,function*(){var t,r;(t=this._rtcEngine)==null||t.off("dataChannelMsg",this.onDataChannelMsg),yield(r=this._rtcEngine)==null?void 0:r.destroy(),this._rtcEngine=void 0,this._dcReady=!1,this._userId=void 0,this._agentInfo=void 0,this._isCalling=!1,this._isOnCall=!1,this._view=void 0,this._avatarUserId=void 0,this._avatarViewSeted=!1,this._config={}})}mute(t){return Wt(this,null,function*(){!this.isOnCall||!this._rtcEngine||this._rtcEngine.muteLocalMic(t)})}switchMicrophone(t){return Wt(this,null,function*(){!this.isOnCall||!this._rtcEngine||this._rtcEngine.switchMicrophone(t)})}muteLocalCamera(t){return Wt(this,null,function*(){var r,n;!this.isOnCall||!this._rtcEngine||(t?(this._rtcEngine.enableLocalVideo(!1),this._rtcEngine.setLocalViewConfig(null,xe.AliRtcVideoTrackCamera)):(this._rtcEngine.enableLocalVideo(!0),(r=this._config)!=null&&r.previewElement&&this._rtcEngine.setLocalViewConfig((n=this._config)==null?void 0:n.previewElement,xe.AliRtcVideoTrackCamera)))})}switchCamera(t){return Wt(this,null,function*(){!this.isOnCall||!this._rtcEngine||this._rtcEngine.switchCamera(t)})}updateToken(t){return Wt(this,null,function*(){this.isOnCall&&this._rtcEngine&&this._rtcEngine.refreshAuthInfo(t)})}stopAgent(){return Wt(this,null,function*(){if(!this.isOnCall)return;const t={type:pt.StopAgent};this.sendMsgToDataChannel(t)})}interruptSpeaking(){return Wt(this,null,function*(){if(!this.isOnCall)return;const t={type:pt.InterruptSpeaking};this.sendMsgToDataChannel(t)})}enableVoiceInterrupt(t){return Wt(this,null,function*(){if(!this.isOnCall)return;const r={type:pt.EnableVoiceInterrupt,data:{enable:t}};this.sendMsgToDataChannel(r)})}switchVoiceId(t){return Wt(this,null,function*(){if(!this.isOnCall)return;const r={type:pt.SwitchVoiceId,data:{voiceId:t}};this.sendMsgToDataChannel(r)})}requestRTCToken(){return Wt(this,null,function*(){if(!this.isOnCall||!this.userId)return;const t={type:pt.RequestRTCToken,data:{userId:this.userId}};this.sendMsgToDataChannel(t)})}enablePushToTalk(t){var r,n;if(this._enablePushToTalk===t)return!1;if(this._isStartPushToTalk=!1,this._enablePushToTalk=t,!this._rtcEngine)return!0;if((r=this._config.pushToTalkConfig)!=null&&r.closeMicrophoneOnRelease&&((n=this._rtcEngine)==null||n.setParameter(JSON.stringify({enableBlankAudio:!0}))),t?this.rtcStopTalk():this.rtcStartTalk(),this.isOnCall){const i={type:pt.EnablePushToTalk,data:{enable:this._enablePushToTalk}};return this.sendMsgToDataChannel(i),!0}return!1}rtcStartTalk(){var t,r,n,i;this._agentType===Tr.VisionAgent&&((t=this._rtcEngine)==null||t.publishLocalVideoStream(!0)),(r=this._config.pushToTalkConfig)!=null&&r.closeMicrophoneOnRelease?(n=this._rtcEngine)==null||n.startAudioCapture():(i=this._rtcEngine)==null||i.muteLocalMic(!1)}startPushToTalk(){return!this.isOnCall||!this._enablePushToTalk||this._isStartPushToTalk?!1:(this.rtcStartTalk(),this._isStartPushToTalk=!0,this.sendMsgToDataChannel({type:pt.StartPushToTalk}),!0)}rtcStopTalk(){var t,r,n,i,o;this._agentType===Tr.VisionAgent&&!((t=this._config.pushToTalkConfig)!=null&&t.pushVideoOnRelease)&&((r=this._rtcEngine)==null||r.publishLocalVideoStream(!1)),(n=this._config.pushToTalkConfig)!=null&&n.closeMicrophoneOnRelease?(i=this._rtcEngine)==null||i.stopAudioCapture():(o=this._rtcEngine)==null||o.muteLocalMic(!0)}finishPushToTalk(){return!this.isOnCall||!this._enablePushToTalk||!this._isStartPushToTalk?!1:(this._isStartPushToTalk=!1,this.rtcStopTalk(),this.sendMsgToDataChannel({type:pt.FinishPushToTalk}),!0)}cancelPushToTalk(){return!this.isOnCall||!this._enablePushToTalk||!this._isStartPushToTalk?!1:(this._isStartPushToTalk=!1,this.rtcStopTalk(),this.sendMsgToDataChannel({type:pt.CancelPushToTalk}),!0)}sendTextToAgent(t){if(this.isOnCall)return this.sendMsgToDataChannel({type:pt.SendTextToAgent,data:{text:t.text,enableInterrupt:1}})}generateShareAgentCall(t,r){return Wt(this,null,function*(){if(!t||!t.shareId){const n=new Sn("InvalidParames, shareConfig.shareId is required");throw n.code=Qt.InvalidParames,n}if(t.expireTime&&t.expireTime.getTime()<Date.now()){const n=new Sn("TokenExpired");throw n.code=Qt.TokenExpired,n}return k_.generateAIAgent(r,t.shareId,t.agentType||Tr.VoiceAgent,t.templateConfig,t.region,t.userData)})}sendMsgToDataChannel(t){var r;if(!this._rtcEngine||!this._dcReady)return console.warn("AICallEngine dataChannel is not ready"),!1;const n=JSON.stringify({type:t.type,data:t.data,seqId:this._seqId++,senderId:this._userId,receiverId:(r=this._agentInfo)==null?void 0:r.userId});let i;const o=new TextEncoder().encode(n);return o instanceof Uint8Array?i=o.buffer:i=o,this._rtcEngine.sendDataChannelMessage(new Jn(i)),!0}}De(ga,"isSupported",Yo.isSupported),De(ga,"getMicrophoneList",Yo.getMicrophoneList),De(ga,"getCameraList",Yo.getCameraList);function d1(e,t){return function(){return e.apply(t,arguments)}}const{toString:P_}=Object.prototype,{getPrototypeOf:lh}=Object,{iterator:kc,toStringTag:h1}=Symbol,Pc=(e=>t=>{const r=P_.call(t);return e[r]||(e[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),Zr=e=>(e=e.toLowerCase(),t=>Pc(t)===e),Ic=e=>t=>typeof t===e,{isArray:mo}=Array,lo=Ic("undefined");function ws(e){return e!==null&&!lo(e)&&e.constructor!==null&&!lo(e.constructor)&&gr(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const p1=Zr("ArrayBuffer");function I_(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&p1(e.buffer),t}const O_=Ic("string"),gr=Ic("function"),f1=Ic("number"),As=e=>e!==null&&typeof e=="object",D_=e=>e===!0||e===!1,va=e=>{if(Pc(e)!=="object")return!1;const t=lh(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(h1 in e)&&!(kc in e)},M_=e=>{if(!As(e)||ws(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},N_=Zr("Date"),L_=Zr("File"),x_=Zr("Blob"),U_=Zr("FileList"),V_=e=>As(e)&&gr(e.pipe),B_=e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||gr(e.append)&&((t=Pc(e))==="formdata"||t==="object"&&gr(e.toString)&&e.toString()==="[object FormData]"))},j_=Zr("URLSearchParams"),[F_,H_,W_,z_]=["ReadableStream","Request","Response","Headers"].map(Zr),$_=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function ks(e,t,{allOwnKeys:r=!1}={}){if(e===null||typeof e>"u")return;let n,i;if(typeof e!="object"&&(e=[e]),mo(e))for(n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else{if(ws(e))return;const o=r?Object.getOwnPropertyNames(e):Object.keys(e),s=o.length;let a;for(n=0;n<s;n++)a=o[n],t.call(null,e[a],a,e)}}function m1(e,t){if(ws(e))return null;t=t.toLowerCase();const r=Object.keys(e);let n=r.length,i;for(;n-- >0;)if(i=r[n],t===i.toLowerCase())return i;return null}const hi=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),g1=e=>!lo(e)&&e!==hi;function Ml(){const{caseless:e,skipUndefined:t}=g1(this)&&this||{},r={},n=(i,o)=>{const s=e&&m1(r,o)||o;va(r[s])&&va(i)?r[s]=Ml(r[s],i):va(i)?r[s]=Ml({},i):mo(i)?r[s]=i.slice():(!t||!lo(i))&&(r[s]=i)};for(let i=0,o=arguments.length;i<o;i++)arguments[i]&&ks(arguments[i],n);return r}const K_=(e,t,r,{allOwnKeys:n}={})=>(ks(t,(i,o)=>{r&&gr(i)?e[o]=d1(i,r):e[o]=i},{allOwnKeys:n}),e),G_=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),J_=(e,t,r,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},q_=(e,t,r,n)=>{let i,o,s;const a={};if(t=t||{},e==null)return t;do{for(i=Object.getOwnPropertyNames(e),o=i.length;o-- >0;)s=i[o],(!n||n(s,e,t))&&!a[s]&&(t[s]=e[s],a[s]=!0);e=r!==!1&&lh(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},Y_=(e,t,r)=>{e=String(e),(r===void 0||r>e.length)&&(r=e.length),r-=t.length;const n=e.indexOf(t,r);return n!==-1&&n===r},Q_=e=>{if(!e)return null;if(mo(e))return e;let t=e.length;if(!f1(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},X_=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&lh(Uint8Array)),Z_=(e,t)=>{const n=(e&&e[kc]).call(e);let i;for(;(i=n.next())&&!i.done;){const o=i.value;t.call(e,o[0],o[1])}},eT=(e,t)=>{let r;const n=[];for(;(r=e.exec(t))!==null;)n.push(r);return n},tT=Zr("HTMLFormElement"),rT=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,n,i){return n.toUpperCase()+i}),Qm=(({hasOwnProperty:e})=>(t,r)=>e.call(t,r))(Object.prototype),nT=Zr("RegExp"),v1=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),n={};ks(r,(i,o)=>{let s;(s=t(i,o,e))!==!1&&(n[o]=s||i)}),Object.defineProperties(e,n)},iT=e=>{v1(e,(t,r)=>{if(gr(e)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const n=e[r];if(gr(n)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},oT=(e,t)=>{const r={},n=i=>{i.forEach(o=>{r[o]=!0})};return mo(e)?n(e):n(String(e).split(t)),r},sT=()=>{},aT=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t;function cT(e){return!!(e&&gr(e.append)&&e[h1]==="FormData"&&e[kc])}const uT=e=>{const t=new Array(10),r=(n,i)=>{if(As(n)){if(t.indexOf(n)>=0)return;if(ws(n))return n;if(!("toJSON"in n)){t[i]=n;const o=mo(n)?[]:{};return ks(n,(s,a)=>{const c=r(s,i+1);!lo(c)&&(o[a]=c)}),t[i]=void 0,o}}return n};return r(e,0)},lT=Zr("AsyncFunction"),dT=e=>e&&(As(e)||gr(e))&&gr(e.then)&&gr(e.catch),S1=((e,t)=>e?setImmediate:t?((r,n)=>(hi.addEventListener("message",({source:i,data:o})=>{i===hi&&o===r&&n.length&&n.shift()()},!1),i=>{n.push(i),hi.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",gr(hi.postMessage)),hT=typeof queueMicrotask<"u"?queueMicrotask.bind(hi):typeof process<"u"&&process.nextTick||S1,pT=e=>e!=null&&gr(e[kc]),ie={isArray:mo,isArrayBuffer:p1,isBuffer:ws,isFormData:B_,isArrayBufferView:I_,isString:O_,isNumber:f1,isBoolean:D_,isObject:As,isPlainObject:va,isEmptyObject:M_,isReadableStream:F_,isRequest:H_,isResponse:W_,isHeaders:z_,isUndefined:lo,isDate:N_,isFile:L_,isBlob:x_,isRegExp:nT,isFunction:gr,isStream:V_,isURLSearchParams:j_,isTypedArray:X_,isFileList:U_,forEach:ks,merge:Ml,extend:K_,trim:$_,stripBOM:G_,inherits:J_,toFlatObject:q_,kindOf:Pc,kindOfTest:Zr,endsWith:Y_,toArray:Q_,forEachEntry:Z_,matchAll:eT,isHTMLForm:tT,hasOwnProperty:Qm,hasOwnProp:Qm,reduceDescriptors:v1,freezeMethods:iT,toObjectSet:oT,toCamelCase:rT,noop:sT,toFiniteNumber:aT,findKey:m1,global:hi,isContextDefined:g1,isSpecCompliantForm:cT,toJSONObject:uT,isAsyncFn:lT,isThenable:dT,setImmediate:S1,asap:hT,isIterable:pT};function Ue(e,t,r,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),i&&(this.response=i,this.status=i.status?i.status:null)}ie.inherits(Ue,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ie.toJSONObject(this.config),code:this.code,status:this.status}}});const y1=Ue.prototype,E1={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{E1[e]={value:e}});Object.defineProperties(Ue,E1);Object.defineProperty(y1,"isAxiosError",{value:!0});Ue.from=(e,t,r,n,i,o)=>{const s=Object.create(y1);ie.toFlatObject(e,s,function(d){return d!==Error.prototype},u=>u!=="isAxiosError");const a=e&&e.message?e.message:"Error",c=t==null&&e?e.code:t;return Ue.call(s,a,c,r,n,i),e&&s.cause==null&&Object.defineProperty(s,"cause",{value:e,configurable:!0}),s.name=e&&e.name||"Error",o&&Object.assign(s,o),s};const fT=null;function Nl(e){return ie.isPlainObject(e)||ie.isArray(e)}function R1(e){return ie.endsWith(e,"[]")?e.slice(0,-2):e}function Xm(e,t,r){return e?e.concat(t).map(function(i,o){return i=R1(i),!r&&o?"["+i+"]":i}).join(r?".":""):t}function mT(e){return ie.isArray(e)&&!e.some(Nl)}const gT=ie.toFlatObject(ie,{},null,function(t){return/^is[A-Z]/.test(t)});function Oc(e,t,r){if(!ie.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,r=ie.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(S,l){return!ie.isUndefined(l[S])});const n=r.metaTokens,i=r.visitor||d,o=r.dots,s=r.indexes,c=(r.Blob||typeof Blob<"u"&&Blob)&&ie.isSpecCompliantForm(t);if(!ie.isFunction(i))throw new TypeError("visitor must be a function");function u(y){if(y===null)return"";if(ie.isDate(y))return y.toISOString();if(ie.isBoolean(y))return y.toString();if(!c&&ie.isBlob(y))throw new Ue("Blob is not supported. Use a Buffer instead.");return ie.isArrayBuffer(y)||ie.isTypedArray(y)?c&&typeof Blob=="function"?new Blob([y]):Buffer.from(y):y}function d(y,S,l){let h=y;if(y&&!l&&typeof y=="object"){if(ie.endsWith(S,"{}"))S=n?S:S.slice(0,-2),y=JSON.stringify(y);else if(ie.isArray(y)&&mT(y)||(ie.isFileList(y)||ie.endsWith(S,"[]"))&&(h=ie.toArray(y)))return S=R1(S),h.forEach(function(v,g){!(ie.isUndefined(v)||v===null)&&t.append(s===!0?Xm([S],g,o):s===null?S:S+"[]",u(v))}),!1}return Nl(y)?!0:(t.append(Xm(l,S,o),u(y)),!1)}const E=[],m=Object.assign(gT,{defaultVisitor:d,convertValue:u,isVisitable:Nl});function f(y,S){if(!ie.isUndefined(y)){if(E.indexOf(y)!==-1)throw Error("Circular reference detected in "+S.join("."));E.push(y),ie.forEach(y,function(h,p){(!(ie.isUndefined(h)||h===null)&&i.call(t,h,ie.isString(p)?p.trim():p,S,m))===!0&&f(h,S?S.concat(p):[p])}),E.pop()}}if(!ie.isObject(e))throw new TypeError("data must be an object");return f(e),t}function Zm(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function dh(e,t){this._pairs=[],e&&Oc(e,this,t)}const b1=dh.prototype;b1.append=function(t,r){this._pairs.push([t,r])};b1.toString=function(t){const r=t?function(n){return t.call(this,n,Zm)}:Zm;return this._pairs.map(function(i){return r(i[0])+"="+r(i[1])},"").join("&")};function vT(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function _1(e,t,r){if(!t)return e;const n=r&&r.encode||vT;ie.isFunction(r)&&(r={serialize:r});const i=r&&r.serialize;let o;if(i?o=i(t,r):o=ie.isURLSearchParams(t)?t.toString():new dh(t,r).toString(n),o){const s=e.indexOf("#");s!==-1&&(e=e.slice(0,s)),e+=(e.indexOf("?")===-1?"?":"&")+o}return e}class ST{constructor(){this.handlers=[]}use(t,r,n){return this.handlers.push({fulfilled:t,rejected:r,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){ie.forEach(this.handlers,function(n){n!==null&&t(n)})}}const e0=ST,T1={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},yT=typeof URLSearchParams<"u"?URLSearchParams:dh,ET=typeof FormData<"u"?FormData:null,RT=typeof Blob<"u"?Blob:null,bT={isBrowser:!0,classes:{URLSearchParams:yT,FormData:ET,Blob:RT},protocols:["http","https","file","blob","url","data"]},hh=typeof window<"u"&&typeof document<"u",Ll=typeof navigator=="object"&&navigator||void 0,_T=hh&&(!Ll||["ReactNative","NativeScript","NS"].indexOf(Ll.product)<0),TT=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),CT=hh&&window.location.href||"http://localhost",wT=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:hh,hasStandardBrowserEnv:_T,hasStandardBrowserWebWorkerEnv:TT,navigator:Ll,origin:CT},Symbol.toStringTag,{value:"Module"})),Zt={...wT,...bT};function AT(e,t){return Oc(e,new Zt.classes.URLSearchParams,{visitor:function(r,n,i,o){return Zt.isNode&&ie.isBuffer(r)?(this.append(n,r.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)},...t})}function kT(e){return ie.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function PT(e){const t={},r=Object.keys(e);let n;const i=r.length;let o;for(n=0;n<i;n++)o=r[n],t[o]=e[o];return t}function C1(e){function t(r,n,i,o){let s=r[o++];if(s==="__proto__")return!0;const a=Number.isFinite(+s),c=o>=r.length;return s=!s&&ie.isArray(i)?i.length:s,c?(ie.hasOwnProp(i,s)?i[s]=[i[s],n]:i[s]=n,!a):((!i[s]||!ie.isObject(i[s]))&&(i[s]=[]),t(r,n,i[s],o)&&ie.isArray(i[s])&&(i[s]=PT(i[s])),!a)}if(ie.isFormData(e)&&ie.isFunction(e.entries)){const r={};return ie.forEachEntry(e,(n,i)=>{t(kT(n),i,r,0)}),r}return null}function IT(e,t,r){if(ie.isString(e))try{return(t||JSON.parse)(e),ie.trim(e)}catch(n){if(n.name!=="SyntaxError")throw n}return(r||JSON.stringify)(e)}const ph={transitional:T1,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const n=r.getContentType()||"",i=n.indexOf("application/json")>-1,o=ie.isObject(t);if(o&&ie.isHTMLForm(t)&&(t=new FormData(t)),ie.isFormData(t))return i?JSON.stringify(C1(t)):t;if(ie.isArrayBuffer(t)||ie.isBuffer(t)||ie.isStream(t)||ie.isFile(t)||ie.isBlob(t)||ie.isReadableStream(t))return t;if(ie.isArrayBufferView(t))return t.buffer;if(ie.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let a;if(o){if(n.indexOf("application/x-www-form-urlencoded")>-1)return AT(t,this.formSerializer).toString();if((a=ie.isFileList(t))||n.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return Oc(a?{"files[]":t}:t,c&&new c,this.formSerializer)}}return o||i?(r.setContentType("application/json",!1),IT(t)):t}],transformResponse:[function(t){const r=this.transitional||ph.transitional,n=r&&r.forcedJSONParsing,i=this.responseType==="json";if(ie.isResponse(t)||ie.isReadableStream(t))return t;if(t&&ie.isString(t)&&(n&&!this.responseType||i)){const s=!(r&&r.silentJSONParsing)&&i;try{return JSON.parse(t,this.parseReviver)}catch(a){if(s)throw a.name==="SyntaxError"?Ue.from(a,Ue.ERR_BAD_RESPONSE,this,null,this.response):a}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Zt.classes.FormData,Blob:Zt.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ie.forEach(["delete","get","head","post","put","patch"],e=>{ph.headers[e]={}});const fh=ph,OT=ie.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),DT=e=>{const t={};let r,n,i;return e&&e.split(`
`).forEach(function(s){i=s.indexOf(":"),r=s.substring(0,i).trim().toLowerCase(),n=s.substring(i+1).trim(),!(!r||t[r]&&OT[r])&&(r==="set-cookie"?t[r]?t[r].push(n):t[r]=[n]:t[r]=t[r]?t[r]+", "+n:n)}),t},t0=Symbol("internals");function Po(e){return e&&String(e).trim().toLowerCase()}function Sa(e){return e===!1||e==null?e:ie.isArray(e)?e.map(Sa):String(e)}function MT(e){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=r.exec(e);)t[n[1]]=n[2];return t}const NT=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function ku(e,t,r,n,i){if(ie.isFunction(n))return n.call(this,t,r);if(i&&(t=r),!!ie.isString(t)){if(ie.isString(n))return t.indexOf(n)!==-1;if(ie.isRegExp(n))return n.test(t)}}function LT(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,r,n)=>r.toUpperCase()+n)}function xT(e,t){const r=ie.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(e,n+r,{value:function(i,o,s){return this[n].call(this,t,i,o,s)},configurable:!0})})}class Dc{constructor(t){t&&this.set(t)}set(t,r,n){const i=this;function o(a,c,u){const d=Po(c);if(!d)throw new Error("header name must be a non-empty string");const E=ie.findKey(i,d);(!E||i[E]===void 0||u===!0||u===void 0&&i[E]!==!1)&&(i[E||c]=Sa(a))}const s=(a,c)=>ie.forEach(a,(u,d)=>o(u,d,c));if(ie.isPlainObject(t)||t instanceof this.constructor)s(t,r);else if(ie.isString(t)&&(t=t.trim())&&!NT(t))s(DT(t),r);else if(ie.isObject(t)&&ie.isIterable(t)){let a={},c,u;for(const d of t){if(!ie.isArray(d))throw TypeError("Object iterator must return a key-value pair");a[u=d[0]]=(c=a[u])?ie.isArray(c)?[...c,d[1]]:[c,d[1]]:d[1]}s(a,r)}else t!=null&&o(r,t,n);return this}get(t,r){if(t=Po(t),t){const n=ie.findKey(this,t);if(n){const i=this[n];if(!r)return i;if(r===!0)return MT(i);if(ie.isFunction(r))return r.call(this,i,n);if(ie.isRegExp(r))return r.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=Po(t),t){const n=ie.findKey(this,t);return!!(n&&this[n]!==void 0&&(!r||ku(this,this[n],n,r)))}return!1}delete(t,r){const n=this;let i=!1;function o(s){if(s=Po(s),s){const a=ie.findKey(n,s);a&&(!r||ku(n,n[a],a,r))&&(delete n[a],i=!0)}}return ie.isArray(t)?t.forEach(o):o(t),i}clear(t){const r=Object.keys(this);let n=r.length,i=!1;for(;n--;){const o=r[n];(!t||ku(this,this[o],o,t,!0))&&(delete this[o],i=!0)}return i}normalize(t){const r=this,n={};return ie.forEach(this,(i,o)=>{const s=ie.findKey(n,o);if(s){r[s]=Sa(i),delete r[o];return}const a=t?LT(o):String(o).trim();a!==o&&delete r[o],r[a]=Sa(i),n[a]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const r=Object.create(null);return ie.forEach(this,(n,i)=>{n!=null&&n!==!1&&(r[i]=t&&ie.isArray(n)?n.join(", "):n)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,r])=>t+": "+r).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...r){const n=new this(t);return r.forEach(i=>n.set(i)),n}static accessor(t){const n=(this[t0]=this[t0]={accessors:{}}).accessors,i=this.prototype;function o(s){const a=Po(s);n[a]||(xT(i,s),n[a]=!0)}return ie.isArray(t)?t.forEach(o):o(t),this}}Dc.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);ie.reduceDescriptors(Dc.prototype,({value:e},t)=>{let r=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(n){this[r]=n}}});ie.freezeMethods(Dc);const Yr=Dc;function Pu(e,t){const r=this||fh,n=t||r,i=Yr.from(n.headers);let o=n.data;return ie.forEach(e,function(a){o=a.call(r,o,i.normalize(),t?t.status:void 0)}),i.normalize(),o}function w1(e){return!!(e&&e.__CANCEL__)}function go(e,t,r){Ue.call(this,e??"canceled",Ue.ERR_CANCELED,t,r),this.name="CanceledError"}ie.inherits(go,Ue,{__CANCEL__:!0});function A1(e,t,r){const n=r.config.validateStatus;!r.status||!n||n(r.status)?e(r):t(new Ue("Request failed with status code "+r.status,[Ue.ERR_BAD_REQUEST,Ue.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function UT(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function VT(e,t){e=e||10;const r=new Array(e),n=new Array(e);let i=0,o=0,s;return t=t!==void 0?t:1e3,function(c){const u=Date.now(),d=n[o];s||(s=u),r[i]=c,n[i]=u;let E=o,m=0;for(;E!==i;)m+=r[E++],E=E%e;if(i=(i+1)%e,i===o&&(o=(o+1)%e),u-s<t)return;const f=d&&u-d;return f?Math.round(m*1e3/f):void 0}}function BT(e,t){let r=0,n=1e3/t,i,o;const s=(u,d=Date.now())=>{r=d,i=null,o&&(clearTimeout(o),o=null),e(...u)};return[(...u)=>{const d=Date.now(),E=d-r;E>=n?s(u,d):(i=u,o||(o=setTimeout(()=>{o=null,s(i)},n-E)))},()=>i&&s(i)]}const tc=(e,t,r=3)=>{let n=0;const i=VT(50,250);return BT(o=>{const s=o.loaded,a=o.lengthComputable?o.total:void 0,c=s-n,u=i(c),d=s<=a;n=s;const E={loaded:s,total:a,progress:a?s/a:void 0,bytes:c,rate:u||void 0,estimated:u&&a&&d?(a-s)/u:void 0,event:o,lengthComputable:a!=null,[t?"download":"upload"]:!0};e(E)},r)},r0=(e,t)=>{const r=e!=null;return[n=>t[0]({lengthComputable:r,total:e,loaded:n}),t[1]]},n0=e=>(...t)=>ie.asap(()=>e(...t)),jT=Zt.hasStandardBrowserEnv?((e,t)=>r=>(r=new URL(r,Zt.origin),e.protocol===r.protocol&&e.host===r.host&&(t||e.port===r.port)))(new URL(Zt.origin),Zt.navigator&&/(msie|trident)/i.test(Zt.navigator.userAgent)):()=>!0,FT=Zt.hasStandardBrowserEnv?{write(e,t,r,n,i,o,s){if(typeof document>"u")return;const a=[`${e}=${encodeURIComponent(t)}`];ie.isNumber(r)&&a.push(`expires=${new Date(r).toUTCString()}`),ie.isString(n)&&a.push(`path=${n}`),ie.isString(i)&&a.push(`domain=${i}`),o===!0&&a.push("secure"),ie.isString(s)&&a.push(`SameSite=${s}`),document.cookie=a.join("; ")},read(e){if(typeof document>"u")return null;const t=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function HT(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function WT(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function k1(e,t,r){let n=!HT(t);return e&&(n||r==!1)?WT(e,t):t}const i0=e=>e instanceof Yr?{...e}:e;function Ti(e,t){t=t||{};const r={};function n(u,d,E,m){return ie.isPlainObject(u)&&ie.isPlainObject(d)?ie.merge.call({caseless:m},u,d):ie.isPlainObject(d)?ie.merge({},d):ie.isArray(d)?d.slice():d}function i(u,d,E,m){if(ie.isUndefined(d)){if(!ie.isUndefined(u))return n(void 0,u,E,m)}else return n(u,d,E,m)}function o(u,d){if(!ie.isUndefined(d))return n(void 0,d)}function s(u,d){if(ie.isUndefined(d)){if(!ie.isUndefined(u))return n(void 0,u)}else return n(void 0,d)}function a(u,d,E){if(E in t)return n(u,d);if(E in e)return n(void 0,u)}const c={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,withXSRFToken:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:a,headers:(u,d,E)=>i(i0(u),i0(d),E,!0)};return ie.forEach(Object.keys({...e,...t}),function(d){const E=c[d]||i,m=E(e[d],t[d],d);ie.isUndefined(m)&&E!==a||(r[d]=m)}),r}const P1=e=>{const t=Ti({},e);let{data:r,withXSRFToken:n,xsrfHeaderName:i,xsrfCookieName:o,headers:s,auth:a}=t;if(t.headers=s=Yr.from(s),t.url=_1(k1(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),a&&s.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):""))),ie.isFormData(r)){if(Zt.hasStandardBrowserEnv||Zt.hasStandardBrowserWebWorkerEnv)s.setContentType(void 0);else if(ie.isFunction(r.getHeaders)){const c=r.getHeaders(),u=["content-type","content-length"];Object.entries(c).forEach(([d,E])=>{u.includes(d.toLowerCase())&&s.set(d,E)})}}if(Zt.hasStandardBrowserEnv&&(n&&ie.isFunction(n)&&(n=n(t)),n||n!==!1&&jT(t.url))){const c=i&&o&&FT.read(o);c&&s.set(i,c)}return t},zT=typeof XMLHttpRequest<"u",$T=zT&&function(e){return new Promise(function(r,n){const i=P1(e);let o=i.data;const s=Yr.from(i.headers).normalize();let{responseType:a,onUploadProgress:c,onDownloadProgress:u}=i,d,E,m,f,y;function S(){f&&f(),y&&y(),i.cancelToken&&i.cancelToken.unsubscribe(d),i.signal&&i.signal.removeEventListener("abort",d)}let l=new XMLHttpRequest;l.open(i.method.toUpperCase(),i.url,!0),l.timeout=i.timeout;function h(){if(!l)return;const v=Yr.from("getAllResponseHeaders"in l&&l.getAllResponseHeaders()),R={data:!a||a==="text"||a==="json"?l.responseText:l.response,status:l.status,statusText:l.statusText,headers:v,config:e,request:l};A1(function(w){r(w),S()},function(w){n(w),S()},R),l=null}"onloadend"in l?l.onloadend=h:l.onreadystatechange=function(){!l||l.readyState!==4||l.status===0&&!(l.responseURL&&l.responseURL.indexOf("file:")===0)||setTimeout(h)},l.onabort=function(){l&&(n(new Ue("Request aborted",Ue.ECONNABORTED,e,l)),l=null)},l.onerror=function(g){const R=g&&g.message?g.message:"Network Error",_=new Ue(R,Ue.ERR_NETWORK,e,l);_.event=g||null,n(_),l=null},l.ontimeout=function(){let g=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const R=i.transitional||T1;i.timeoutErrorMessage&&(g=i.timeoutErrorMessage),n(new Ue(g,R.clarifyTimeoutError?Ue.ETIMEDOUT:Ue.ECONNABORTED,e,l)),l=null},o===void 0&&s.setContentType(null),"setRequestHeader"in l&&ie.forEach(s.toJSON(),function(g,R){l.setRequestHeader(R,g)}),ie.isUndefined(i.withCredentials)||(l.withCredentials=!!i.withCredentials),a&&a!=="json"&&(l.responseType=i.responseType),u&&([m,y]=tc(u,!0),l.addEventListener("progress",m)),c&&l.upload&&([E,f]=tc(c),l.upload.addEventListener("progress",E),l.upload.addEventListener("loadend",f)),(i.cancelToken||i.signal)&&(d=v=>{l&&(n(!v||v.type?new go(null,e,l):v),l.abort(),l=null)},i.cancelToken&&i.cancelToken.subscribe(d),i.signal&&(i.signal.aborted?d():i.signal.addEventListener("abort",d)));const p=UT(i.url);if(p&&Zt.protocols.indexOf(p)===-1){n(new Ue("Unsupported protocol "+p+":",Ue.ERR_BAD_REQUEST,e));return}l.send(o||null)})},KT=(e,t)=>{const{length:r}=e=e?e.filter(Boolean):[];if(t||r){let n=new AbortController,i;const o=function(u){if(!i){i=!0,a();const d=u instanceof Error?u:this.reason;n.abort(d instanceof Ue?d:new go(d instanceof Error?d.message:d))}};let s=t&&setTimeout(()=>{s=null,o(new Ue(`timeout ${t} of ms exceeded`,Ue.ETIMEDOUT))},t);const a=()=>{e&&(s&&clearTimeout(s),s=null,e.forEach(u=>{u.unsubscribe?u.unsubscribe(o):u.removeEventListener("abort",o)}),e=null)};e.forEach(u=>u.addEventListener("abort",o));const{signal:c}=n;return c.unsubscribe=()=>ie.asap(a),c}},GT=KT,JT=function*(e,t){let r=e.byteLength;if(!t||r<t){yield e;return}let n=0,i;for(;n<r;)i=n+t,yield e.slice(n,i),n=i},qT=async function*(e,t){for await(const r of YT(e))yield*JT(r,t)},YT=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const t=e.getReader();try{for(;;){const{done:r,value:n}=await t.read();if(r)break;yield n}}finally{await t.cancel()}},o0=(e,t,r,n)=>{const i=qT(e,t);let o=0,s,a=c=>{s||(s=!0,n&&n(c))};return new ReadableStream({async pull(c){try{const{done:u,value:d}=await i.next();if(u){a(),c.close();return}let E=d.byteLength;if(r){let m=o+=E;r(m)}c.enqueue(new Uint8Array(d))}catch(u){throw a(u),u}},cancel(c){return a(c),i.return()}},{highWaterMark:2})},s0=64*1024,{isFunction:Qs}=ie,QT=(({Request:e,Response:t})=>({Request:e,Response:t}))(ie.global),{ReadableStream:a0,TextEncoder:c0}=ie.global,u0=(e,...t)=>{try{return!!e(...t)}catch{return!1}},XT=e=>{e=ie.merge.call({skipUndefined:!0},QT,e);const{fetch:t,Request:r,Response:n}=e,i=t?Qs(t):typeof fetch=="function",o=Qs(r),s=Qs(n);if(!i)return!1;const a=i&&Qs(a0),c=i&&(typeof c0=="function"?(y=>S=>y.encode(S))(new c0):async y=>new Uint8Array(await new r(y).arrayBuffer())),u=o&&a&&u0(()=>{let y=!1;const S=new r(Zt.origin,{body:new a0,method:"POST",get duplex(){return y=!0,"half"}}).headers.has("Content-Type");return y&&!S}),d=s&&a&&u0(()=>ie.isReadableStream(new n("").body)),E={stream:d&&(y=>y.body)};i&&["text","arrayBuffer","blob","formData","stream"].forEach(y=>{!E[y]&&(E[y]=(S,l)=>{let h=S&&S[y];if(h)return h.call(S);throw new Ue(`Response type '${y}' is not supported`,Ue.ERR_NOT_SUPPORT,l)})});const m=async y=>{if(y==null)return 0;if(ie.isBlob(y))return y.size;if(ie.isSpecCompliantForm(y))return(await new r(Zt.origin,{method:"POST",body:y}).arrayBuffer()).byteLength;if(ie.isArrayBufferView(y)||ie.isArrayBuffer(y))return y.byteLength;if(ie.isURLSearchParams(y)&&(y=y+""),ie.isString(y))return(await c(y)).byteLength},f=async(y,S)=>{const l=ie.toFiniteNumber(y.getContentLength());return l??m(S)};return async y=>{let{url:S,method:l,data:h,signal:p,cancelToken:v,timeout:g,onDownloadProgress:R,onUploadProgress:_,responseType:w,headers:k,withCredentials:O="same-origin",fetchOptions:C}=P1(y),b=t||fetch;w=w?(w+"").toLowerCase():"text";let A=GT([p,v&&v.toAbortSignal()],g),T=null;const M=A&&A.unsubscribe&&(()=>{A.unsubscribe()});let D;try{if(_&&u&&l!=="get"&&l!=="head"&&(D=await f(k,h))!==0){let U=new r(S,{method:"POST",body:h,duplex:"half"}),x;if(ie.isFormData(h)&&(x=U.headers.get("content-type"))&&k.setContentType(x),U.body){const[V,j]=r0(D,tc(n0(_)));h=o0(U.body,s0,V,j)}}ie.isString(O)||(O=O?"include":"omit");const N=o&&"credentials"in r.prototype,P={...C,signal:A,method:l.toUpperCase(),headers:k.normalize().toJSON(),body:h,duplex:"half",credentials:N?O:void 0};T=o&&new r(S,P);let I=await(o?b(T,C):b(S,P));const L=d&&(w==="stream"||w==="response");if(d&&(R||L&&M)){const U={};["status","statusText","headers"].forEach(H=>{U[H]=I[H]});const x=ie.toFiniteNumber(I.headers.get("content-length")),[V,j]=R&&r0(x,tc(n0(R),!0))||[];I=new n(o0(I.body,s0,V,()=>{j&&j(),M&&M()}),U)}w=w||"text";let W=await E[ie.findKey(E,w)||"text"](I,y);return!L&&M&&M(),await new Promise((U,x)=>{A1(U,x,{data:W,headers:Yr.from(I.headers),status:I.status,statusText:I.statusText,config:y,request:T})})}catch(N){throw M&&M(),N&&N.name==="TypeError"&&/Load failed|fetch/i.test(N.message)?Object.assign(new Ue("Network Error",Ue.ERR_NETWORK,y,T),{cause:N.cause||N}):Ue.from(N,N&&N.code,y,T)}}},ZT=new Map,I1=e=>{let t=e&&e.env||{};const{fetch:r,Request:n,Response:i}=t,o=[n,i,r];let s=o.length,a=s,c,u,d=ZT;for(;a--;)c=o[a],u=d.get(c),u===void 0&&d.set(c,u=a?new Map:XT(t)),d=u;return u};I1();const mh={http:fT,xhr:$T,fetch:{get:I1}};ie.forEach(mh,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const l0=e=>`- ${e}`,e2=e=>ie.isFunction(e)||e===null||e===!1;function t2(e,t){e=ie.isArray(e)?e:[e];const{length:r}=e;let n,i;const o={};for(let s=0;s<r;s++){n=e[s];let a;if(i=n,!e2(n)&&(i=mh[(a=String(n)).toLowerCase()],i===void 0))throw new Ue(`Unknown adapter '${a}'`);if(i&&(ie.isFunction(i)||(i=i.get(t))))break;o[a||"#"+s]=i}if(!i){const s=Object.entries(o).map(([c,u])=>`adapter ${c} `+(u===!1?"is not supported by the environment":"is not available in the build"));let a=r?s.length>1?`since :
`+s.map(l0).join(`
`):" "+l0(s[0]):"as no adapter specified";throw new Ue("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return i}const O1={getAdapter:t2,adapters:mh};function Iu(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new go(null,e)}function d0(e){return Iu(e),e.headers=Yr.from(e.headers),e.data=Pu.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),O1.getAdapter(e.adapter||fh.adapter,e)(e).then(function(n){return Iu(e),n.data=Pu.call(e,e.transformResponse,n),n.headers=Yr.from(n.headers),n},function(n){return w1(n)||(Iu(e),n&&n.response&&(n.response.data=Pu.call(e,e.transformResponse,n.response),n.response.headers=Yr.from(n.response.headers))),Promise.reject(n)})}const D1="1.13.2",Mc={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{Mc[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const h0={};Mc.transitional=function(t,r,n){function i(o,s){return"[Axios v"+D1+"] Transitional option '"+o+"'"+s+(n?". "+n:"")}return(o,s,a)=>{if(t===!1)throw new Ue(i(s," has been removed"+(r?" in "+r:"")),Ue.ERR_DEPRECATED);return r&&!h0[s]&&(h0[s]=!0,console.warn(i(s," has been deprecated since v"+r+" and will be removed in the near future"))),t?t(o,s,a):!0}};Mc.spelling=function(t){return(r,n)=>(console.warn(`${n} is likely a misspelling of ${t}`),!0)};function r2(e,t,r){if(typeof e!="object")throw new Ue("options must be an object",Ue.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let i=n.length;for(;i-- >0;){const o=n[i],s=t[o];if(s){const a=e[o],c=a===void 0||s(a,o,e);if(c!==!0)throw new Ue("option "+o+" must be "+c,Ue.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new Ue("Unknown option "+o,Ue.ERR_BAD_OPTION)}}const ya={assertOptions:r2,validators:Mc},tn=ya.validators;class rc{constructor(t){this.defaults=t||{},this.interceptors={request:new e0,response:new e0}}async request(t,r){try{return await this._request(t,r)}catch(n){if(n instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const o=i.stack?i.stack.replace(/^.+\n/,""):"";try{n.stack?o&&!String(n.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+o):n.stack=o}catch{}}throw n}}_request(t,r){typeof t=="string"?(r=r||{},r.url=t):r=t||{},r=Ti(this.defaults,r);const{transitional:n,paramsSerializer:i,headers:o}=r;n!==void 0&&ya.assertOptions(n,{silentJSONParsing:tn.transitional(tn.boolean),forcedJSONParsing:tn.transitional(tn.boolean),clarifyTimeoutError:tn.transitional(tn.boolean)},!1),i!=null&&(ie.isFunction(i)?r.paramsSerializer={serialize:i}:ya.assertOptions(i,{encode:tn.function,serialize:tn.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),ya.assertOptions(r,{baseUrl:tn.spelling("baseURL"),withXsrfToken:tn.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let s=o&&ie.merge(o.common,o[r.method]);o&&ie.forEach(["delete","get","head","post","put","patch","common"],y=>{delete o[y]}),r.headers=Yr.concat(s,o);const a=[];let c=!0;this.interceptors.request.forEach(function(S){typeof S.runWhen=="function"&&S.runWhen(r)===!1||(c=c&&S.synchronous,a.unshift(S.fulfilled,S.rejected))});const u=[];this.interceptors.response.forEach(function(S){u.push(S.fulfilled,S.rejected)});let d,E=0,m;if(!c){const y=[d0.bind(this),void 0];for(y.unshift(...a),y.push(...u),m=y.length,d=Promise.resolve(r);E<m;)d=d.then(y[E++],y[E++]);return d}m=a.length;let f=r;for(;E<m;){const y=a[E++],S=a[E++];try{f=y(f)}catch(l){S.call(this,l);break}}try{d=d0.call(this,f)}catch(y){return Promise.reject(y)}for(E=0,m=u.length;E<m;)d=d.then(u[E++],u[E++]);return d}getUri(t){t=Ti(this.defaults,t);const r=k1(t.baseURL,t.url,t.allowAbsoluteUrls);return _1(r,t.params,t.paramsSerializer)}}ie.forEach(["delete","get","head","options"],function(t){rc.prototype[t]=function(r,n){return this.request(Ti(n||{},{method:t,url:r,data:(n||{}).data}))}});ie.forEach(["post","put","patch"],function(t){function r(n){return function(o,s,a){return this.request(Ti(a||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:o,data:s}))}}rc.prototype[t]=r(),rc.prototype[t+"Form"]=r(!0)});const Ea=rc;class gh{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(o){r=o});const n=this;this.promise.then(i=>{if(!n._listeners)return;let o=n._listeners.length;for(;o-- >0;)n._listeners[o](i);n._listeners=null}),this.promise.then=i=>{let o;const s=new Promise(a=>{n.subscribe(a),o=a}).then(i);return s.cancel=function(){n.unsubscribe(o)},s},t(function(o,s,a){n.reason||(n.reason=new go(o,s,a),r(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const t=new AbortController,r=n=>{t.abort(n)};return this.subscribe(r),t.signal.unsubscribe=()=>this.unsubscribe(r),t.signal}static source(){let t;return{token:new gh(function(i){t=i}),cancel:t}}}const n2=gh;function i2(e){return function(r){return e.apply(null,r)}}function o2(e){return ie.isObject(e)&&e.isAxiosError===!0}const xl={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(xl).forEach(([e,t])=>{xl[t]=e});const s2=xl;function M1(e){const t=new Ea(e),r=d1(Ea.prototype.request,t);return ie.extend(r,Ea.prototype,t,{allOwnKeys:!0}),ie.extend(r,t,null,{allOwnKeys:!0}),r.create=function(i){return M1(Ti(e,i))},r}const kt=M1(fh);kt.Axios=Ea;kt.CanceledError=go;kt.CancelToken=n2;kt.isCancel=w1;kt.VERSION=D1;kt.toFormData=Oc;kt.AxiosError=Ue;kt.Cancel=kt.CanceledError;kt.all=function(t){return Promise.all(t)};kt.spread=i2;kt.isAxiosError=o2;kt.mergeConfig=Ti;kt.AxiosHeaders=Yr;kt.formToJSON=e=>C1(ie.isHTMLForm(e)?new FormData(e):e);kt.getAdapter=O1.getAdapter;kt.HttpStatusCode=s2;kt.default=kt;const Ul=kt;let Xs;const a2=new Uint8Array(16);function c2(){if(!Xs&&(Xs=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Xs))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Xs(a2)}const Ht=[];for(let e=0;e<256;++e)Ht.push((e+256).toString(16).slice(1));function u2(e,t=0){return Ht[e[t+0]]+Ht[e[t+1]]+Ht[e[t+2]]+Ht[e[t+3]]+"-"+Ht[e[t+4]]+Ht[e[t+5]]+"-"+Ht[e[t+6]]+Ht[e[t+7]]+"-"+Ht[e[t+8]]+Ht[e[t+9]]+"-"+Ht[e[t+10]]+Ht[e[t+11]]+Ht[e[t+12]]+Ht[e[t+13]]+Ht[e[t+14]]+Ht[e[t+15]]}const l2=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),p0={randomUUID:l2};function Mi(e,t,r){if(p0.randomUUID&&!t&&!e)return p0.randomUUID();e=e||{};const n=e.random||(e.rng||c2)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){r=r||0;for(let i=0;i<16;++i)t[r+i]=n[i];return t}return u2(n)}const pn=Object.create(null);pn.open="0";pn.close="1";pn.ping="2";pn.pong="3";pn.message="4";pn.upgrade="5";pn.noop="6";const Ra=Object.create(null);Object.keys(pn).forEach(e=>{Ra[pn[e]]=e});const Vl={type:"error",data:"parser error"},N1=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",L1=typeof ArrayBuffer=="function",x1=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,vh=({type:e,data:t},r,n)=>N1&&t instanceof Blob?r?n(t):f0(t,n):L1&&(t instanceof ArrayBuffer||x1(t))?r?n(t):f0(new Blob([t]),n):n(pn[e]+(t||"")),f0=(e,t)=>{const r=new FileReader;return r.onload=function(){const n=r.result.split(",")[1];t("b"+(n||""))},r.readAsDataURL(e)};function m0(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let Ou;function d2(e,t){if(N1&&e.data instanceof Blob)return e.data.arrayBuffer().then(m0).then(t);if(L1&&(e.data instanceof ArrayBuffer||x1(e.data)))return t(m0(e.data));vh(e,!1,r=>{Ou||(Ou=new TextEncoder),t(Ou.encode(r))})}const g0="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Vo=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let e=0;e<g0.length;e++)Vo[g0.charCodeAt(e)]=e;const h2=e=>{let t=e.length*.75,r=e.length,n,i=0,o,s,a,c;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);const u=new ArrayBuffer(t),d=new Uint8Array(u);for(n=0;n<r;n+=4)o=Vo[e.charCodeAt(n)],s=Vo[e.charCodeAt(n+1)],a=Vo[e.charCodeAt(n+2)],c=Vo[e.charCodeAt(n+3)],d[i++]=o<<2|s>>4,d[i++]=(s&15)<<4|a>>2,d[i++]=(a&3)<<6|c&63;return u},p2=typeof ArrayBuffer=="function",Sh=(e,t)=>{if(typeof e!="string")return{type:"message",data:U1(e,t)};const r=e.charAt(0);return r==="b"?{type:"message",data:f2(e.substring(1),t)}:Ra[r]?e.length>1?{type:Ra[r],data:e.substring(1)}:{type:Ra[r]}:Vl},f2=(e,t)=>{if(p2){const r=h2(e);return U1(r,t)}else return{base64:!0,data:e}},U1=(e,t)=>{switch(t){case"blob":return e instanceof Blob?e:new Blob([e]);case"arraybuffer":default:return e instanceof ArrayBuffer?e:e.buffer}},V1=String.fromCharCode(30),m2=(e,t)=>{const r=e.length,n=new Array(r);let i=0;e.forEach((o,s)=>{vh(o,!1,a=>{n[s]=a,++i===r&&t(n.join(V1))})})},g2=(e,t)=>{const r=e.split(V1),n=[];for(let i=0;i<r.length;i++){const o=Sh(r[i],t);if(n.push(o),o.type==="error")break}return n};function v2(){return new TransformStream({transform(e,t){d2(e,r=>{const n=r.length;let i;if(n<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,n);else if(n<65536){i=new Uint8Array(3);const o=new DataView(i.buffer);o.setUint8(0,126),o.setUint16(1,n)}else{i=new Uint8Array(9);const o=new DataView(i.buffer);o.setUint8(0,127),o.setBigUint64(1,BigInt(n))}e.data&&typeof e.data!="string"&&(i[0]|=128),t.enqueue(i),t.enqueue(r)})}})}let Du;function Zs(e){return e.reduce((t,r)=>t+r.length,0)}function ea(e,t){if(e[0].length===t)return e.shift();const r=new Uint8Array(t);let n=0;for(let i=0;i<t;i++)r[i]=e[0][n++],n===e[0].length&&(e.shift(),n=0);return e.length&&n<e[0].length&&(e[0]=e[0].slice(n)),r}function S2(e,t){Du||(Du=new TextDecoder);const r=[];let n=0,i=-1,o=!1;return new TransformStream({transform(s,a){for(r.push(s);;){if(n===0){if(Zs(r)<1)break;const c=ea(r,1);o=(c[0]&128)===128,i=c[0]&127,i<126?n=3:i===126?n=1:n=2}else if(n===1){if(Zs(r)<2)break;const c=ea(r,2);i=new DataView(c.buffer,c.byteOffset,c.length).getUint16(0),n=3}else if(n===2){if(Zs(r)<8)break;const c=ea(r,8),u=new DataView(c.buffer,c.byteOffset,c.length),d=u.getUint32(0);if(d>Math.pow(2,53-32)-1){a.enqueue(Vl);break}i=d*Math.pow(2,32)+u.getUint32(4),n=3}else{if(Zs(r)<i)break;const c=ea(r,i);a.enqueue(Sh(o?c:Du.decode(c),t)),n=0}if(i===0||i>e){a.enqueue(Vl);break}}}})}const B1=4;function At(e){if(e)return y2(e)}function y2(e){for(var t in At.prototype)e[t]=At.prototype[t];return e}At.prototype.on=At.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this};At.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this};At.prototype.off=At.prototype.removeListener=At.prototype.removeAllListeners=At.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var r=this._callbacks["$"+e];if(!r)return this;if(arguments.length==1)return delete this._callbacks["$"+e],this;for(var n,i=0;i<r.length;i++)if(n=r[i],n===t||n.fn===t){r.splice(i,1);break}return r.length===0&&delete this._callbacks["$"+e],this};At.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),r=this._callbacks["$"+e],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(r){r=r.slice(0);for(var n=0,i=r.length;n<i;++n)r[n].apply(this,t)}return this};At.prototype.emitReserved=At.prototype.emit;At.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]};At.prototype.hasListeners=function(e){return!!this.listeners(e).length};const Nc=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?t=>Promise.resolve().then(t):(t,r)=>r(t,0))(),Lr=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())(),E2="arraybuffer";function j1(e,...t){return t.reduce((r,n)=>(e.hasOwnProperty(n)&&(r[n]=e[n]),r),{})}const R2=Lr.setTimeout,b2=Lr.clearTimeout;function Lc(e,t){t.useNativeTimers?(e.setTimeoutFn=R2.bind(Lr),e.clearTimeoutFn=b2.bind(Lr)):(e.setTimeoutFn=Lr.setTimeout.bind(Lr),e.clearTimeoutFn=Lr.clearTimeout.bind(Lr))}const _2=1.33;function T2(e){return typeof e=="string"?C2(e):Math.ceil((e.byteLength||e.size)*_2)}function C2(e){let t=0,r=0;for(let n=0,i=e.length;n<i;n++)t=e.charCodeAt(n),t<128?r+=1:t<2048?r+=2:t<55296||t>=57344?r+=3:(n++,r+=4);return r}function F1(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function w2(e){let t="";for(let r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t}function A2(e){let t={},r=e.split("&");for(let n=0,i=r.length;n<i;n++){let o=r[n].split("=");t[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return t}class k2 extends Error{constructor(t,r,n){super(t),this.description=r,this.context=n,this.type="TransportError"}}class yh extends At{constructor(t){super(),this.writable=!1,Lc(this,t),this.opts=t,this.query=t.query,this.socket=t.socket,this.supportsBinary=!t.forceBase64}onError(t,r,n){return super.emitReserved("error",new k2(t,r,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){this.readyState==="open"&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const r=Sh(t,this.socket.binaryType);this.onPacket(r)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t,r={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(r)}_hostname(){const t=this.opts.hostname;return t.indexOf(":")===-1?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(this.opts.port)!==443||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(t){const r=w2(t);return r.length?"?"+r:""}}class P2 extends yh{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(t){this.readyState="pausing";const r=()=>{this.readyState="paused",t()};if(this._polling||!this.writable){let n=0;this._polling&&(n++,this.once("pollComplete",function(){--n||r()})),this.writable||(n++,this.once("drain",function(){--n||r()}))}else r()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){const r=n=>{if(this.readyState==="opening"&&n.type==="open"&&this.onOpen(),n.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)};g2(t,this.socket.binaryType).forEach(r),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const t=()=>{this.write([{type:"close"}])};this.readyState==="open"?t():this.once("open",t)}write(t){this.writable=!1,m2(t,r=>{this.doWrite(r,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const t=this.opts.secure?"https":"http",r=this.query||{};return this.opts.timestampRequests!==!1&&(r[this.opts.timestampParam]=F1()),!this.supportsBinary&&!r.sid&&(r.b64=1),this.createUri(t,r)}}let H1=!1;try{H1=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const I2=H1;function O2(){}class D2 extends P2{constructor(t){if(super(t),typeof location<"u"){const r=location.protocol==="https:";let n=location.port;n||(n=r?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||n!==t.port}}doWrite(t,r){const n=this.request({method:"POST",data:t});n.on("success",r),n.on("error",(i,o)=>{this.onError("xhr post error",i,o)})}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(r,n)=>{this.onError("xhr poll error",r,n)}),this.pollXhr=t}}let Zi=class ba extends At{constructor(t,r,n){super(),this.createRequest=t,Lc(this,n),this._opts=n,this._method=n.method||"GET",this._uri=r,this._data=n.data!==void 0?n.data:null,this._create()}_create(){var t;const r=j1(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");r.xdomain=!!this._opts.xd;const n=this._xhr=this.createRequest(r);try{n.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let i in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(i)&&n.setRequestHeader(i,this._opts.extraHeaders[i])}}catch{}if(this._method==="POST")try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{n.setRequestHeader("Accept","*/*")}catch{}(t=this._opts.cookieJar)===null||t===void 0||t.addCookies(n),"withCredentials"in n&&(n.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(n.timeout=this._opts.requestTimeout),n.onreadystatechange=()=>{var i;n.readyState===3&&((i=this._opts.cookieJar)===null||i===void 0||i.parseCookies(n.getResponseHeader("set-cookie"))),n.readyState===4&&(n.status===200||n.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof n.status=="number"?n.status:0)},0))},n.send(this._data)}catch(i){this.setTimeoutFn(()=>{this._onError(i)},0);return}typeof document<"u"&&(this._index=ba.requestsCount++,ba.requests[this._index]=this)}_onError(t){this.emitReserved("error",t,this._xhr),this._cleanup(!0)}_cleanup(t){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=O2,t)try{this._xhr.abort()}catch{}typeof document<"u"&&delete ba.requests[this._index],this._xhr=null}}_onLoad(){const t=this._xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}};Zi.requestsCount=0;Zi.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",v0);else if(typeof addEventListener=="function"){const e="onpagehide"in Lr?"pagehide":"unload";addEventListener(e,v0,!1)}}function v0(){for(let e in Zi.requests)Zi.requests.hasOwnProperty(e)&&Zi.requests[e].abort()}const M2=function(){const e=W1({xdomain:!1});return e&&e.responseType!==null}();class N2 extends D2{constructor(t){super(t);const r=t&&t.forceBase64;this.supportsBinary=M2&&!r}request(t={}){return Object.assign(t,{xd:this.xd},this.opts),new Zi(W1,this.uri(),t)}}function W1(e){const t=e.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!t||I2))return new XMLHttpRequest}catch{}if(!t)try{return new Lr[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const z1=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class L2 extends yh{get name(){return"websocket"}doOpen(){const t=this.uri(),r=this.opts.protocols,n=z1?{}:j1(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(t,r,n)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let r=0;r<t.length;r++){const n=t[r],i=r===t.length-1;vh(n,this.supportsBinary,o=>{try{this.doWrite(n,o)}catch{}i&&Nc(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const t=this.opts.secure?"wss":"ws",r=this.query||{};return this.opts.timestampRequests&&(r[this.opts.timestampParam]=F1()),this.supportsBinary||(r.b64=1),this.createUri(t,r)}}const Mu=Lr.WebSocket||Lr.MozWebSocket;class x2 extends L2{createSocket(t,r,n){return z1?new Mu(t,r,n):r?new Mu(t,r):new Mu(t)}doWrite(t,r){this.ws.send(r)}}class U2 extends yh{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(t){return this.emitReserved("error",t)}this._transport.closed.then(()=>{this.onClose()}).catch(t=>{this.onError("webtransport error",t)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(t=>{const r=S2(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=t.readable.pipeThrough(r).getReader(),i=v2();i.readable.pipeTo(t.writable),this._writer=i.writable.getWriter();const o=()=>{n.read().then(({done:a,value:c})=>{a||(this.onPacket(c),o())}).catch(a=>{})};o();const s={type:"open"};this.query.sid&&(s.data=`{"sid":"${this.query.sid}"}`),this._writer.write(s).then(()=>this.onOpen())})})}write(t){this.writable=!1;for(let r=0;r<t.length;r++){const n=t[r],i=r===t.length-1;this._writer.write(n).then(()=>{i&&Nc(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var t;(t=this._transport)===null||t===void 0||t.close()}}const V2={websocket:x2,webtransport:U2,polling:N2},B2=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,j2=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Bl(e){if(e.length>8e3)throw"URI too long";const t=e,r=e.indexOf("["),n=e.indexOf("]");r!=-1&&n!=-1&&(e=e.substring(0,r)+e.substring(r,n).replace(/:/g,";")+e.substring(n,e.length));let i=B2.exec(e||""),o={},s=14;for(;s--;)o[j2[s]]=i[s]||"";return r!=-1&&n!=-1&&(o.source=t,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=F2(o,o.path),o.queryKey=H2(o,o.query),o}function F2(e,t){const r=/\/{2,9}/g,n=t.replace(r,"/").split("/");return(t.slice(0,1)=="/"||t.length===0)&&n.splice(0,1),t.slice(-1)=="/"&&n.splice(n.length-1,1),n}function H2(e,t){const r={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,i,o){i&&(r[i]=o)}),r}const jl=typeof addEventListener=="function"&&typeof removeEventListener=="function",_a=[];jl&&addEventListener("offline",()=>{_a.forEach(e=>e())},!1);class qn extends At{constructor(t,r){if(super(),this.binaryType=E2,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,t&&typeof t=="object"&&(r=t,t=null),t){const n=Bl(t);r.hostname=n.host,r.secure=n.protocol==="https"||n.protocol==="wss",r.port=n.port,n.query&&(r.query=n.query)}else r.host&&(r.hostname=Bl(r.host).host);Lc(this,r),this.secure=r.secure!=null?r.secure:typeof location<"u"&&location.protocol==="https:",r.hostname&&!r.port&&(r.port=this.secure?"443":"80"),this.hostname=r.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=r.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},r.transports.forEach(n=>{const i=n.prototype.name;this.transports.push(i),this._transportsByName[i]=n}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},r),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=A2(this.opts.query)),jl&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},_a.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(t){const r=Object.assign({},this.opts.query);r.EIO=B1,r.transport=t,this.id&&(r.sid=this.id);const n=Object.assign({},this.opts,{query:r,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new this._transportsByName[t](n)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const t=this.opts.rememberUpgrade&&qn.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const r=this.createTransport(t);r.open(),this.setTransport(r)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",r=>this._onClose("transport close",r))}onOpen(){this.readyState="open",qn.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const r=new Error("server error");r.code=t.data,this._onError(r);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this._pingInterval=t.pingInterval,this._pingTimeout=t.pingTimeout,this._maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const t=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+t,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},t),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this._getWritablePackets();this.transport.send(t),this._prevBufferLen=t.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let r=1;for(let n=0;n<this.writeBuffer.length;n++){const i=this.writeBuffer[n].data;if(i&&(r+=T2(i)),n>0&&r>this._maxPayload)return this.writeBuffer.slice(0,n);r+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const t=Date.now()>this._pingTimeoutTime;return t&&(this._pingTimeoutTime=0,Nc(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),t}write(t,r,n){return this._sendPacket("message",t,r,n),this}send(t,r,n){return this._sendPacket("message",t,r,n),this}_sendPacket(t,r,n,i){if(typeof r=="function"&&(i=r,r=void 0),typeof n=="function"&&(i=n,n=null),this.readyState==="closing"||this.readyState==="closed")return;n=n||{},n.compress=n.compress!==!1;const o={type:t,data:r,options:n};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),i&&this.once("flush",i),this.flush()}close(){const t=()=>{this._onClose("forced close"),this.transport.close()},r=()=>{this.off("upgrade",r),this.off("upgradeError",r),t()},n=()=>{this.once("upgrade",r),this.once("upgradeError",r)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():t()}):this.upgrading?n():t()),this}_onError(t){if(qn.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",t),this._onClose("transport error",t)}_onClose(t,r){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),jl&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const n=_a.indexOf(this._offlineEventListener);n!==-1&&_a.splice(n,1)}this.readyState="closed",this.id=null,this.emitReserved("close",t,r),this.writeBuffer=[],this._prevBufferLen=0}}}qn.protocol=B1;class W2 extends qn{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let t=0;t<this._upgrades.length;t++)this._probe(this._upgrades[t])}_probe(t){let r=this.createTransport(t),n=!1;qn.priorWebsocketSuccess=!1;const i=()=>{n||(r.send([{type:"ping",data:"probe"}]),r.once("packet",E=>{if(!n)if(E.type==="pong"&&E.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",r),!r)return;qn.priorWebsocketSuccess=r.name==="websocket",this.transport.pause(()=>{n||this.readyState!=="closed"&&(d(),this.setTransport(r),r.send([{type:"upgrade"}]),this.emitReserved("upgrade",r),r=null,this.upgrading=!1,this.flush())})}else{const m=new Error("probe error");m.transport=r.name,this.emitReserved("upgradeError",m)}}))};function o(){n||(n=!0,d(),r.close(),r=null)}const s=E=>{const m=new Error("probe error: "+E);m.transport=r.name,o(),this.emitReserved("upgradeError",m)};function a(){s("transport closed")}function c(){s("socket closed")}function u(E){r&&E.name!==r.name&&o()}const d=()=>{r.removeListener("open",i),r.removeListener("error",s),r.removeListener("close",a),this.off("close",c),this.off("upgrading",u)};r.once("open",i),r.once("error",s),r.once("close",a),this.once("close",c),this.once("upgrading",u),this._upgrades.indexOf("webtransport")!==-1&&t!=="webtransport"?this.setTimeoutFn(()=>{n||r.open()},200):r.open()}onHandshake(t){this._upgrades=this._filterUpgrades(t.upgrades),super.onHandshake(t)}_filterUpgrades(t){const r=[];for(let n=0;n<t.length;n++)~this.transports.indexOf(t[n])&&r.push(t[n]);return r}}let z2=class extends W2{constructor(t,r={}){const n=typeof t=="object"?t:r;(!n.transports||n.transports&&typeof n.transports[0]=="string")&&(n.transports=(n.transports||["polling","websocket","webtransport"]).map(i=>V2[i]).filter(i=>!!i)),super(t,n)}};function $2(e,t="",r){let n=e;r=r||typeof location<"u"&&location,e==null&&(e=r.protocol+"//"+r.host),typeof e=="string"&&(e.charAt(0)==="/"&&(e.charAt(1)==="/"?e=r.protocol+e:e=r.host+e),/^(https?|wss?):\/\//.test(e)||(typeof r<"u"?e=r.protocol+"//"+e:e="https://"+e),n=Bl(e)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const o=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+o+":"+n.port+t,n.href=n.protocol+"://"+o+(r&&r.port===n.port?"":":"+n.port),n}const K2=typeof ArrayBuffer=="function",G2=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,$1=Object.prototype.toString,J2=typeof Blob=="function"||typeof Blob<"u"&&$1.call(Blob)==="[object BlobConstructor]",q2=typeof File=="function"||typeof File<"u"&&$1.call(File)==="[object FileConstructor]";function Eh(e){return K2&&(e instanceof ArrayBuffer||G2(e))||J2&&e instanceof Blob||q2&&e instanceof File}function Ta(e,t){if(!e||typeof e!="object")return!1;if(Array.isArray(e)){for(let r=0,n=e.length;r<n;r++)if(Ta(e[r]))return!0;return!1}if(Eh(e))return!0;if(e.toJSON&&typeof e.toJSON=="function"&&arguments.length===1)return Ta(e.toJSON(),!0);for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&Ta(e[r]))return!0;return!1}function Y2(e){const t=[],r=e.data,n=e;return n.data=Fl(r,t),n.attachments=t.length,{packet:n,buffers:t}}function Fl(e,t){if(!e)return e;if(Eh(e)){const r={_placeholder:!0,num:t.length};return t.push(e),r}else if(Array.isArray(e)){const r=new Array(e.length);for(let n=0;n<e.length;n++)r[n]=Fl(e[n],t);return r}else if(typeof e=="object"&&!(e instanceof Date)){const r={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=Fl(e[n],t));return r}return e}function Q2(e,t){return e.data=Hl(e.data,t),delete e.attachments,e}function Hl(e,t){if(!e)return e;if(e&&e._placeholder===!0){if(typeof e.num=="number"&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}else if(Array.isArray(e))for(let r=0;r<e.length;r++)e[r]=Hl(e[r],t);else if(typeof e=="object")for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(e[r]=Hl(e[r],t));return e}const K1=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],X2=5;var Ve;(function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"})(Ve||(Ve={}));class Z2{constructor(t){this.replacer=t}encode(t){return(t.type===Ve.EVENT||t.type===Ve.ACK)&&Ta(t)?this.encodeAsBinary({type:t.type===Ve.EVENT?Ve.BINARY_EVENT:Ve.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id}):[this.encodeAsString(t)]}encodeAsString(t){let r=""+t.type;return(t.type===Ve.BINARY_EVENT||t.type===Ve.BINARY_ACK)&&(r+=t.attachments+"-"),t.nsp&&t.nsp!=="/"&&(r+=t.nsp+","),t.id!=null&&(r+=t.id),t.data!=null&&(r+=JSON.stringify(t.data,this.replacer)),r}encodeAsBinary(t){const r=Y2(t),n=this.encodeAsString(r.packet),i=r.buffers;return i.unshift(n),i}}class Rh extends At{constructor(t){super(),this.reviver=t}add(t){let r;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");r=this.decodeString(t);const n=r.type===Ve.BINARY_EVENT;n||r.type===Ve.BINARY_ACK?(r.type=n?Ve.EVENT:Ve.ACK,this.reconstructor=new eC(r),r.attachments===0&&super.emitReserved("decoded",r)):super.emitReserved("decoded",r)}else if(Eh(t)||t.base64)if(this.reconstructor)r=this.reconstructor.takeBinaryData(t),r&&(this.reconstructor=null,super.emitReserved("decoded",r));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let r=0;const n={type:Number(t.charAt(0))};if(Ve[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===Ve.BINARY_EVENT||n.type===Ve.BINARY_ACK){const o=r+1;for(;t.charAt(++r)!=="-"&&r!=t.length;);const s=t.substring(o,r);if(s!=Number(s)||t.charAt(r)!=="-")throw new Error("Illegal attachments");n.attachments=Number(s)}if(t.charAt(r+1)==="/"){const o=r+1;for(;++r&&!(t.charAt(r)===","||r===t.length););n.nsp=t.substring(o,r)}else n.nsp="/";const i=t.charAt(r+1);if(i!==""&&Number(i)==i){const o=r+1;for(;++r;){const s=t.charAt(r);if(s==null||Number(s)!=s){--r;break}if(r===t.length)break}n.id=Number(t.substring(o,r+1))}if(t.charAt(++r)){const o=this.tryParse(t.substr(r));if(Rh.isPayloadValid(n.type,o))n.data=o;else throw new Error("invalid payload")}return n}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,r){switch(t){case Ve.CONNECT:return nc(r);case Ve.DISCONNECT:return r===void 0;case Ve.CONNECT_ERROR:return typeof r=="string"||nc(r);case Ve.EVENT:case Ve.BINARY_EVENT:return Array.isArray(r)&&(typeof r[0]=="number"||typeof r[0]=="string"&&K1.indexOf(r[0])===-1);case Ve.ACK:case Ve.BINARY_ACK:return Array.isArray(r)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class eC{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const r=Q2(this.reconPack,this.buffers);return this.finishedReconstruction(),r}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function tC(e){return typeof e=="string"}const rC=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};function nC(e){return e===void 0||rC(e)}function nc(e){return Object.prototype.toString.call(e)==="[object Object]"}function iC(e,t){switch(e){case Ve.CONNECT:return t===void 0||nc(t);case Ve.DISCONNECT:return t===void 0;case Ve.EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&K1.indexOf(t[0])===-1);case Ve.ACK:return Array.isArray(t);case Ve.CONNECT_ERROR:return typeof t=="string"||nc(t);default:return!1}}function oC(e){return tC(e.nsp)&&nC(e.id)&&iC(e.type,e.data)}const sC=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Rh,Encoder:Z2,get PacketType(){return Ve},isPacketValid:oC,protocol:X2},Symbol.toStringTag,{value:"Module"}));function Kr(e,t,r){return e.on(t,r),function(){e.off(t,r)}}const aC=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class G1 extends At{constructor(t,r,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=r,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[Kr(t,"open",this.onopen.bind(this)),Kr(t,"packet",this.onpacket.bind(this)),Kr(t,"error",this.onerror.bind(this)),Kr(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...r){var n,i,o;if(aC.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(r.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(r),this;const s={type:Ve.EVENT,data:r};if(s.options={},s.options.compress=this.flags.compress!==!1,typeof r[r.length-1]=="function"){const d=this.ids++,E=r.pop();this._registerAckCallback(d,E),s.id=d}const a=(i=(n=this.io.engine)===null||n===void 0?void 0:n.transport)===null||i===void 0?void 0:i.writable,c=this.connected&&!(!((o=this.io.engine)===null||o===void 0)&&o._hasPingExpired());return this.flags.volatile&&!a||(c?(this.notifyOutgoingListeners(s),this.packet(s)):this.sendBuffer.push(s)),this.flags={},this}_registerAckCallback(t,r){var n;const i=(n=this.flags.timeout)!==null&&n!==void 0?n:this._opts.ackTimeout;if(i===void 0){this.acks[t]=r;return}const o=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let a=0;a<this.sendBuffer.length;a++)this.sendBuffer[a].id===t&&this.sendBuffer.splice(a,1);r.call(this,new Error("operation has timed out"))},i),s=(...a)=>{this.io.clearTimeoutFn(o),r.apply(this,a)};s.withError=!0,this.acks[t]=s}emitWithAck(t,...r){return new Promise((n,i)=>{const o=(s,a)=>s?i(s):n(a);o.withError=!0,r.push(o),this.emit(t,...r)})}_addToQueue(t){let r;typeof t[t.length-1]=="function"&&(r=t.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((i,...o)=>(this._queue[0],i!==null?n.tryCount>this._opts.retries&&(this._queue.shift(),r&&r(i)):(this._queue.shift(),r&&r(null,...o)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||this._queue.length===0)return;const r=this._queue[0];r.pending&&!t||(r.pending=!0,r.tryCount++,this.flags=r.flags,this.emit.apply(this,r.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){typeof this.auth=="function"?this.auth(t=>{this._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:Ve.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,r){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,r),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(t=>{if(!this.sendBuffer.some(n=>String(n.id)===t)){const n=this.acks[t];delete this.acks[t],n.withError&&n.call(this,new Error("socket has been disconnected"))}})}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case Ve.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Ve.EVENT:case Ve.BINARY_EVENT:this.onevent(t);break;case Ve.ACK:case Ve.BINARY_ACK:this.onack(t);break;case Ve.DISCONNECT:this.ondisconnect();break;case Ve.CONNECT_ERROR:this.destroy();const n=new Error(t.data.message);n.data=t.data.data,this.emitReserved("connect_error",n);break}}onevent(t){const r=t.data||[];t.id!=null&&r.push(this.ack(t.id)),this.connected?this.emitEvent(r):this.receiveBuffer.push(Object.freeze(r))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const r=this._anyListeners.slice();for(const n of r)n.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&typeof t[t.length-1]=="string"&&(this._lastOffset=t[t.length-1])}ack(t){const r=this;let n=!1;return function(...i){n||(n=!0,r.packet({type:Ve.ACK,id:t,data:i}))}}onack(t){const r=this.acks[t.id];typeof r=="function"&&(delete this.acks[t.id],r.withError&&t.data.unshift(null),r.apply(this,t.data))}onconnect(t,r){this.id=t,this.recovered=r&&this._pid===r,this._pid=r,this.connected=!0,this.emitBuffered(),this._drainQueue(!0),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Ve.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const r=this._anyListeners;for(let n=0;n<r.length;n++)if(t===r[n])return r.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const r=this._anyOutgoingListeners;for(let n=0;n<r.length;n++)if(t===r[n])return r.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const r=this._anyOutgoingListeners.slice();for(const n of r)n.apply(this,t.data)}}}function vo(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}vo.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=Math.floor(t*10)&1?e+r:e-r}return Math.min(e,this.max)|0};vo.prototype.reset=function(){this.attempts=0};vo.prototype.setMin=function(e){this.ms=e};vo.prototype.setMax=function(e){this.max=e};vo.prototype.setJitter=function(e){this.jitter=e};class Wl extends At{constructor(t,r){var n;super(),this.nsps={},this.subs=[],t&&typeof t=="object"&&(r=t,t=void 0),r=r||{},r.path=r.path||"/socket.io",this.opts=r,Lc(this,r),this.reconnection(r.reconnection!==!1),this.reconnectionAttempts(r.reconnectionAttempts||1/0),this.reconnectionDelay(r.reconnectionDelay||1e3),this.reconnectionDelayMax(r.reconnectionDelayMax||5e3),this.randomizationFactor((n=r.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new vo({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(r.timeout==null?2e4:r.timeout),this._readyState="closed",this.uri=t;const i=r.parser||sC;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=r.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,t||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(t){return t===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var r;return t===void 0?this._reconnectionDelay:(this._reconnectionDelay=t,(r=this.backoff)===null||r===void 0||r.setMin(t),this)}randomizationFactor(t){var r;return t===void 0?this._randomizationFactor:(this._randomizationFactor=t,(r=this.backoff)===null||r===void 0||r.setJitter(t),this)}reconnectionDelayMax(t){var r;return t===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,(r=this.backoff)===null||r===void 0||r.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new z2(this.uri,this.opts);const r=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const i=Kr(r,"open",function(){n.onopen(),t&&t()}),o=a=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",a),t?t(a):this.maybeReconnectOnOpen()},s=Kr(r,"error",o);if(this._timeout!==!1){const a=this._timeout,c=this.setTimeoutFn(()=>{i(),o(new Error("timeout")),r.close()},a);this.opts.autoUnref&&c.unref(),this.subs.push(()=>{this.clearTimeoutFn(c)})}return this.subs.push(i),this.subs.push(s),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(Kr(t,"ping",this.onping.bind(this)),Kr(t,"data",this.ondata.bind(this)),Kr(t,"error",this.onerror.bind(this)),Kr(t,"close",this.onclose.bind(this)),Kr(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(r){this.onclose("parse error",r)}}ondecoded(t){Nc(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,r){let n=this.nsps[t];return n?this._autoConnect&&!n.active&&n.connect():(n=new G1(this,t,r),this.nsps[t]=n),n}_destroy(t){const r=Object.keys(this.nsps);for(const n of r)if(this.nsps[n].active)return;this._close()}_packet(t){const r=this.encoder.encode(t);for(let n=0;n<r.length;n++)this.engine.write(r[n],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(t,r){var n;this.cleanup(),(n=this.engine)===null||n===void 0||n.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,r),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const r=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(i=>{i?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",i)):t.onreconnect()}))},r);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const Io={};function Ca(e,t){typeof e=="object"&&(t=e,e=void 0),t=t||{};const r=$2(e,t.path||"/socket.io"),n=r.source,i=r.id,o=r.path,s=Io[i]&&o in Io[i].nsps,a=t.forceNew||t["force new connection"]||t.multiplex===!1||s;let c;return a?c=new Wl(n,t):(Io[i]||(Io[i]=new Wl(n,t)),c=Io[i]),r.query&&!t.query&&(t.query=r.queryKey),c.socket(r.path,t)}Object.assign(Ca,{Manager:Wl,Socket:G1,io:Ca,connect:Ca});const cC=`https://${window.location.hostname}:3000`;Ul.defaults.baseURL=cC;const uC=()=>{const[e,t]=et.useState(null),[r,n]=et.useState(Dr.Listening),[i,o]=et.useState("idle"),[s,a]=et.useState([]),[c,u]=et.useState(""),[d,E]=et.useState(null),[m,f]=et.useState({isTransferring:!1,isWaitingHuman:!1,sessionId:null,queuePosition:0,estimatedWaitTime:0}),y=et.useRef(null),S=et.useRef(null),l=et.useRef(null),h=et.useRef(null),p=et.useRef(null),v=et.useRef(!1),g=et.useRef(s);et.useEffect(()=>{g.current=s},[s]);const R=["","","","",""];et.useEffect(()=>{(async()=>{try{const M=new ga;M.on("previewStarted",()=>{console.log("Preview started")}),M.on("callBegin",()=>{o("connected")}),M.on("callEnd",()=>{o("ended"),n(Dr.Listening)}),M.on("agentStateChanged",D=>{n(D)}),M.on("userSubtitleNotify",D=>{const N=D.text;if(u(N),D.isSentenceEnd){a(I=>[...I,{id:Mi(),role:"user",content:N}]),u("");const P=R.find(I=>N.includes(I));P&&(console.log(`[Keyword Detected]: ${P}`),w("keyword_detected",P))}}),M.on("agentSubtitleNotify",D=>{if(console.log("[AgentSubtitle]",{text:D.text,isSentenceEnd:D.isSentenceEnd,end:D.end,sentenceId:D.sentenceId}),D.text){const N=D.isSentenceEnd||D.end||!1;a(P=>{const I=P[P.length-1];if(I&&I.role==="agent"&&I.isPartial){const L={...I,content:I.content+D.text,isPartial:!N};return[...P.slice(0,-1),L]}return[...P,{id:Mi(),role:"agent",content:D.text,isPartial:!N}]})}}),M.on("receivedAgentCustomMessage",D=>{console.log("[AI Custom Message]:",D),D.type==="transfer_to_human"&&window.confirm(`AI 
`+(D.reason?`${D.reason}`:""))&&w("ai_suggested",void 0)}),M.on("errorOccurred",D=>{console.error("AICall Error:",D),E(D.message||"Unknown error"),o("ended")}),t(M)}catch(M){E(M.message)}})()},[]);const _=et.useCallback(async T=>{if(e)try{o("connecting"),E(null);const M=await Ul.post("/api/start-call",{userId:T});console.log("[AICall] API Response:",M.data);const{rtcChannelId:D,rtcJoinToken:N,instanceId:P}=M.data;if(!P||!D||!N)throw new Error("API : "+JSON.stringify(M.data));y.current=P,S.current=D,l.current=T,await e.init(Tr.VoiceAgent);const I={agentType:Tr.VoiceAgent,instanceId:P,channelId:D,rtcToken:N,userId:T};console.log("[AICall] Calling with agentInfo:",I),await e.call(T,I)}catch(M){console.error(M),E(M.message||"Failed to start call"),o("idle")}},[e]),w=et.useCallback(async(T,M)=>{var D,N;if(m.isTransferring){console.warn("[HumanTakeover] Already transferring, ignoring request");return}if(!y.current||!S.current||!l.current){E("");return}try{f(W=>({...W,isTransferring:!0}));const P=g.current;console.log("[HumanTakeover] Requesting human takeover:",{reason:T,keyword:M,instanceId:y.current,messagesCount:P.length,messages:P});const I=await Ul.post("/api/request-human-takeover",{instanceId:y.current,userId:l.current,channelId:S.current,reason:T,keyword:M,conversationHistory:P.map(W=>({id:W.id,role:W.role,content:W.content}))}),{data:L}=I.data;console.log("[HumanTakeover] Response:",L),f({isTransferring:!1,isWaitingHuman:!0,sessionId:L.sessionId,queuePosition:L.queuePosition,estimatedWaitTime:L.estimatedWaitTime||0}),a(W=>[...W,{id:Mi(),role:"ai",content:L.queuePosition>0?` ${L.queuePosition}  ${Math.ceil(L.estimatedWaitTime/60)} `:"..."}])}catch(P){console.error("[HumanTakeover] Failed:",P),E(((N=(D=P.response)==null?void 0:D.data)==null?void 0:N.message)||""),f(I=>({...I,isTransferring:!1}))}},[m.isTransferring,s]),k=et.useCallback(async(T,M,D,N,P,I)=>{try{console.log("[SwitchChannel] Switching to human agent channel:",{channelId:T,userId:D,rtcAppId:I}),e&&(console.log("[SwitchChannel] Hanging up AI call..."),await e.handup().catch(U=>{console.warn("[SwitchChannel] Failed to hangup AI call:",U)}));const W=(await TE(()=>Promise.resolve().then(()=>__),void 0).then(U=>U.default)).getInstance();p.current=W,W.on("onJoinChannelResult",U=>{console.log("[RTC] Joined human channel:",U),v.current=!0,a(x=>[...x,{id:Mi(),role:"ai",content:"..."}])}),W.on("onLeaveChannelResult",()=>{console.log("[RTC] Left human channel"),v.current=!1}),W.on("onRemoteUserOnLineNotify",U=>{console.log("[RTC] Remote user online:",U),W.subscribe(U).catch(x=>{console.error("[RTC] Failed to subscribe:",x)})}),W.on("onError",U=>{console.error("[RTC] Error:",U),E(": "+(U.message||""))}),console.log("[SwitchChannel] Joining channel with auth info..."),await W.joinChannel({appId:I,channelId:T,userId:D,token:M,timestamp:P,nonce:N});try{await W.startPreview(),console.log("[RTC] Local preview started")}catch(U){console.warn("[RTC] Start preview failed (may be normal):",U)}console.log("[SwitchChannel] Successfully switched to human channel")}catch(L){console.error("[SwitchChannel] Failed to switch channel:",L),E(": "+(L.message||"")),f(W=>({...W,isWaitingHuman:!1,isTransferring:!1}))}},[e]),O=et.useRef(k),C=et.useRef(e),b=et.useRef(!1);et.useEffect(()=>{O.current=k},[k]),et.useEffect(()=>{C.current=e},[e]),et.useEffect(()=>{const T=`https://${window.location.hostname}:3000`;console.log("[WebSocket] Connecting to:",T);const M=Ca(T,{transports:["websocket"],reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3});return h.current=M,M.on("connect",()=>{console.log("[WebSocket] Connected, socket id:",M.id)}),M.on("disconnect",D=>{console.log("[WebSocket] Disconnected, reason:",D)}),M.on("connect_error",D=>{console.error("[WebSocket] Connection error:",D)}),M.on("takeover-success",async D=>{var N,P,I;if(console.log("[Takeover Success] Received:",D),b.current){console.log("[Takeover Success] Already switching channel, ignoring duplicate event");return}if(D.userId&&l.current&&D.userId!==l.current){console.log("[Takeover Success] Not for current user, ignoring");return}if((N=D.rtcInfo)!=null&&N.channelId&&((P=D.rtcInfo)!=null&&P.userToken))if(console.log("[Plan B] Received independent RTC channel info:",{channelId:D.rtcInfo.channelId,agentName:(I=D.agentInfo)==null?void 0:I.name,hasNonce:!!D.rtcInfo.userNonce,hasTimestamp:!!D.rtcInfo.timestamp,hasAppId:!!D.rtcInfo.appId}),b.current=!0,f(L=>({...L,isWaitingHuman:!1,isTransferring:!0})),a(L=>{var W;return[...L,{id:Mi(),role:"ai",content:` ${((W=D.agentInfo)==null?void 0:W.name)||""}...`}]}),l.current&&D.rtcInfo.userNonce&&D.rtcInfo.timestamp&&D.rtcInfo.appId)try{await O.current(D.rtcInfo.channelId,D.rtcInfo.userToken,l.current,D.rtcInfo.userNonce,D.rtcInfo.timestamp,D.rtcInfo.appId),f(L=>({...L,isTransferring:!1})),o("connected"),console.log("[Takeover Success] Channel switch completed")}catch(L){console.error("[Takeover Success] Failed to switch channel:",L),E(""),f(W=>({...W,isTransferring:!1}))}finally{b.current=!1}else console.error("[Takeover Success] Missing required RTC info:",{userId:l.current,userNonce:D.rtcInfo.userNonce,timestamp:D.rtcInfo.timestamp,appId:D.rtcInfo.appId}),b.current=!1}),()=>{setTimeout(()=>{h.current===M&&(console.log("[WebSocket] Cleanup: disconnecting"),M.disconnect())},100)}},[]);const A=et.useCallback(async()=>{if(e&&(await e.handup(),o("ended")),p.current&&v.current)try{console.log("[EndCall] Leaving human RTC channel..."),await p.current.leaveChannel(),p.current=null,v.current=!1}catch(T){console.warn("[EndCall] Failed to leave human channel:",T)}h.current&&h.current.disconnect(),f({isTransferring:!1,isWaitingHuman:!1,sessionId:null,queuePosition:0,estimatedWaitTime:0})},[e]);return{engine:e,startCall:_,endCall:A,callState:i,agentState:r,messages:s,subtitle:c,error:d,requestHumanTakeover:w,humanTakeover:m}};function lC(){const{startCall:e,endCall:t,callState:r,agentState:n,subtitle:i,error:o,requestHumanTakeover:s,humanTakeover:a}=uC(),[c]=et.useState(Mi()),u=()=>{s("user_requested")},d=()=>{e(c)},E=f=>{switch(f){case Dr.Listening:return"Listening...";case Dr.Thinking:return"Thinking...";case Dr.Speaking:return"Speaking";default:return"Idle"}},m=f=>{switch(f){case Dr.Listening:return"status-listening";case Dr.Thinking:return"status-thinking";case Dr.Speaking:return"status-speaking";default:return""}};return Fe.jsx("div",{className:"container",children:r==="idle"||r==="ended"?Fe.jsxs("div",{className:"call-panel",children:[Fe.jsx("h1",{children:"AI "}),Fe.jsx("p",{children:""}),Fe.jsx("button",{className:"btn-call",onClick:d,children:Fe.jsx("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"currentColor",children:Fe.jsx("path",{d:"M20.01 15.38c-1.23 0-2.42-.2-3.53-.56a.977.977 0 00-1.01.24l-1.57 1.97c-2.83-1.44-5.15-3.75-6.59-6.59l1.97-1.57c.22-.22.3-.53.24-1.01a18.23 18.23 0 01-.56-3.53.978.978 0 00-.97-.98H4.99a.978.978 0 00-.98.98C4.16 14.39 12.02 22 20.97 22a.978.978 0 00.98-.98v-4.66a.978.978 0 00-.94-.98z"})})}),o&&Fe.jsx("p",{style:{color:"red"},children:o})]}):Fe.jsxs("div",{className:"call-panel",children:[Fe.jsx("div",{className:`status-badge ${m(n)}`,children:E(n)}),Fe.jsxs("div",{className:`visualizer ${n===Dr.Speaking?"speaking":""}`,children:[Fe.jsx("div",{className:"bar"}),Fe.jsx("div",{className:"bar"}),Fe.jsx("div",{className:"bar"}),Fe.jsx("div",{className:"bar"}),Fe.jsx("div",{className:"bar"})]}),Fe.jsx("div",{className:"subtitle-area",children:i||(n===Dr.Listening?"...":"...")}),a.isWaitingHuman&&Fe.jsx("div",{className:"takeover-status",children:Fe.jsxs("div",{className:"takeover-notice",children:[Fe.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",style:{marginRight:"8px"},children:Fe.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})}),a.queuePosition>0?Fe.jsxs("span",{children:["...  ",a.queuePosition," ",a.estimatedWaitTime>0&&` ( ${Math.ceil(a.estimatedWaitTime/60)} )`]}):Fe.jsx("span",{children:"..."})]})}),a.isTransferring&&Fe.jsx("div",{className:"takeover-status",children:Fe.jsxs("div",{className:"takeover-notice",children:[Fe.jsx("div",{className:"spinner"}),Fe.jsx("span",{children:"..."})]})}),Fe.jsxs("div",{className:"control-bar",children:[!a.isWaitingHuman&&!a.isTransferring&&Fe.jsxs("button",{className:"btn-transfer",onClick:u,title:"",children:[Fe.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:Fe.jsx("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"})}),Fe.jsx("span",{children:""})]}),Fe.jsx("button",{className:"btn-hangup",onClick:t,children:Fe.jsx("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"currentColor",children:Fe.jsx("path",{d:"M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08a.996.996 0 010-1.41C2.92 9.07 7.24 7.5 12 7.5s9.08 1.57 11.71 4.16c.39.39.39 1.03 0 1.42l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28a11.274 11.274 0 00-2.66-1.85.999.999 0 01-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z"})})})]})]})})}Nu.createRoot(document.getElementById("root")).render(Fe.jsx(lS.StrictMode,{children:Fe.jsx(lC,{})}));
