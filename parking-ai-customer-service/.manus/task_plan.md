# 停车场 AI 智能客服系统 - 任务计划

> **按照 Manus 方法论创建** - planning-with-files skill
>
> **创建时间**: 2026-01-18 22:30
> **项目版本**: v2.1

---

## 📌 项目目标

构建一个完整的停车场 AI 智能客服系统，支持：
1. 用户与 AI 智能客服进行语音对话
2. 用户请求转人工时，自动切换到独立 RTC 频道
3. 客服端工作台管理会话队列和语音通话
4. 关键词自动触发转人工

---

## 🎯 当前阶段

### 阶段状态：功能验证阶段

```
[x] 阶段 1：项目基础设施 ✅
[x] 阶段 2：核心功能实现 ✅
[x] 阶段 3：方案 B 实施（独立 RTC 通道）✅
[ ] 阶段 4：功能验证测试 ⬅️ 当前阶段
[ ] 阶段 5：性能优化
[ ] 阶段 6：生产环境准备
```

---

## 📊 阶段 4：功能验证测试（当前）

### 4.1 核心流程验证 (P0)
- [ ] TC-301: 完整转人工流程端到端测试
  - [ ] 用户发起 AI 通话
  - [ ] 用户点击"转人工"
  - [ ] 客服端收到会话通知
  - [ ] 客服接听
  - [ ] 双方语音通话
  - [ ] 正常挂断

### 4.2 关键词触发测试 (P1)
- [ ] 用户说"转人工"自动触发
- [ ] 用户说"人工客服"自动触发
- [ ] 用户说"投诉"自动触发
- [ ] 验证关键词检测逻辑

### 4.3 排队机制测试 (P1)
- [ ] 多用户并发请求转人工
- [ ] 验证 FIFO 队列顺序
- [ ] 验证队列位置更新通知

### 4.4 异常场景测试 (P2)
- [ ] 用户中途挂断
- [ ] 客服掉线处理
- [ ] 网络中断恢复
- [ ] RTC 连接失败

### 4.5 性能基准测试 (P2)
- [ ] 通话建立延迟 < 3 秒
- [ ] 转人工 RTC 切换延迟 < 5 秒
- [ ] 长时间通话稳定性（30 分钟+）

---

## 🔄 决策日志

| 日期 | 决策 | 理由 |
|------|------|------|
| 2026-01-16 | 采用方案 B（独立 RTC 通道） | TakeoverAIAgentCall API 存在黑盒问题，文档不完整 |
| 2026-01-16 | 使用 HUMAN_ 前缀创建频道 ID | 便于识别和管理人工客服通道 |
| 2026-01-18 | 引入 Manus 方法论 | 提升项目管理和上下文持久化能力 |

---

## ⚠️ 遇到的错误

| 错误 | 尝试次数 | 解决状态 |
|------|----------|----------|
| RTC Token 签名错误 | 3 | ✅ 已解决：修正字段顺序为 AppID+AppKey+ChannelID+UserID+Nonce+Timestamp |
| joinChannel 参数格式错误 | 2 | ✅ 已解决：使用 AliRtcAuthInfo 对象 |
| Playwright MCP 权限问题 | 1 | ⚠️ 暂缓：使用替代测试方案 |

---

## 📁 关键文件索引

### 核心代码
- `src/hooks/useAICall.ts` - 用户端 AI 通话 + 频道切换逻辑
- `agent-client/src/hooks/useRTCCall.ts` - 客服端 RTC 加入逻辑
- `server/server.js` - 后端 API + Token 生成

### 配置文件
- `server/.env` - 阿里云凭证和 RTC 配置
- `vite.config.ts` - 用户端 Vite 配置
- `agent-client/vite.config.ts` - 客服端 Vite 配置

### 文档
- `log.md` - 开发日志（1055+ 行）
- `PLAN_B_IMPLEMENTATION.md` - 方案 B 实施文档
- `TESTING_GUIDE.md` - 测试指南

---

## 🚀 下一步行动

1. **立即**：执行 TC-301 完整转人工流程测试
2. **今天**：完成 4.1 和 4.2 测试
3. **本周**：完成阶段 4 所有测试
4. **下周**：进入阶段 5 性能优化

---

**更新时间**: 2026-01-18 22:30
**维护者**: AI 全栈架构师
