{
  "nodes": [
    {
      "nodeId": "userGuide",
      "name": "系统配置",
      "intro": "可以配置应用的系统参数",
      "avatar": "core/workflow/template/systemConfig",
      "flowNodeType": "userGuide",
      "position": {
        "x": -42.513886863695575,
        "y": -343.5
      },
      "inputs": [
        {
          "key": "welcomeText",
          "renderTypeList": [
            "hidden"
          ],
          "valueType": "string",
          "label": "core.app.Welcome Text",
          "value": "您好！我是智慧停车场AI客服助手🚗\n\n我可以帮您：\n• 查询停车费用\n• 办理月卡/优惠\n• 处理出入场问题\n• 开具发票\n\n如需人工服务，请说\"转人工\"。"
        },
        {
          "key": "variables",
          "renderTypeList": [
            "hidden"
          ],
          "valueType": "any",
          "label": "core.app.Chat Variable",
          "value": [
            {
              "id": "instanceId",
              "key": "instanceId",
              "label": "智能体实例ID",
              "type": "input",
              "required": false,
              "maxLen": 100,
              "enums": [],
              "description": "阿里云AI智能体实例ID，由调用方传入"
            },
            {
              "id": "userId",
              "key": "userId",
              "label": "用户ID",
              "type": "input",
              "required": false,
              "maxLen": 100,
              "enums": [],
              "description": "用户唯一标识，由调用方传入"
            },
            {
              "id": "channelId",
              "key": "channelId",
              "label": "RTC频道ID",
              "type": "input",
              "required": false,
              "maxLen": 100,
              "enums": [],
              "description": "RTC通话频道ID，由调用方传入"
            }
          ]
        },
        {
          "key": "questionGuide",
          "valueType": "boolean",
          "renderTypeList": [
            "hidden"
          ],
          "label": "core.app.Question Guide",
          "value": true
        },
        {
          "key": "tts",
          "renderTypeList": [
            "hidden"
          ],
          "valueType": "any",
          "label": "",
          "value": {
            "type": "web"
          }
        },
        {
          "key": "whisper",
          "renderTypeList": [
            "hidden"
          ],
          "valueType": "any",
          "label": "",
          "value": {
            "open": true,
            "autoSend": true,
            "autoTTSResponse": true
          }
        },
        {
          "key": "scheduleTrigger",
          "renderTypeList": [
            "hidden"
          ],
          "valueType": "any",
          "label": "",
          "value": null
        }
      ],
      "outputs": []
    },
    {
      "nodeId": "448745",
      "name": "流程开始",
      "intro": "",
      "avatar": "core/workflow/template/workflowStart",
      "flowNodeType": "workflowStart",
      "position": {
        "x": 496.0412809204529,
        "y": -200
      },
      "inputs": [
        {
          "key": "userChatInput",
          "renderTypeList": [
            "reference",
            "textarea"
          ],
          "valueType": "string",
          "label": "workflow:user_question",
          "required": true,
          "toolDescription": "用户问题",
          "debugLabel": ""
        }
      ],
      "outputs": [
        {
          "id": "userChatInput",
          "key": "userChatInput",
          "label": "common:core.module.input.label.user question",
          "valueType": "string",
          "type": "static",
          "description": ""
        }
      ],
      "isFolded": false
    },
    {
      "nodeId": "classifyNode",
      "name": "问题分类",
      "intro": "根据用户的历史记录和当前问题判断该次提问的类型。",
      "avatar": "core/workflow/template/questionClassify",
      "flowNodeType": "classifyQuestion",
      "showStatus": true,
      "position": {
        "x": 900,
        "y": -300
      },
      "version": "4.9.2",
      "inputs": [
        {
          "key": "model",
          "renderTypeList": [
            "selectLLMModel",
            "reference"
          ],
          "label": "common:core.module.input.label.aiModel",
          "required": true,
          "valueType": "string",
          "llmModelType": "classify",
          "value": "qwen-turbo",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "systemPrompt",
          "renderTypeList": [
            "textarea",
            "reference"
          ],
          "max": 3000,
          "valueType": "string",
          "label": "common:core.module.input.label.Background",
          "description": "common:core.module.input.description.Background",
          "placeholder": "common:core.module.input.placeholder.Classify background",
          "value": "你是一个智慧停车场的客服助手，请判断用户的意图。\n\n注意：\n- 用户明确要求人工时，归类为\"转人工\"\n- 用户表达不满、投诉时，归类为\"投诉紧急\"\n- 用户询问操作问题时，归类为\"常规咨询\"\n- 用户打招呼闲聊时，归类为\"闲聊\"",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "history",
          "renderTypeList": [
            "numberInput",
            "reference"
          ],
          "valueType": "chatHistory",
          "label": "common:core.module.input.label.chat history",
          "description": "workflow:max_dialog_rounds",
          "required": true,
          "min": 0,
          "max": 50,
          "value": 6,
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "userChatInput",
          "renderTypeList": [
            "reference",
            "textarea"
          ],
          "valueType": "string",
          "label": "workflow:user_question",
          "toolDescription": "用户输入的问题（问题需要完善）",
          "required": true,
          "value": [
            "448745",
            "userChatInput"
          ],
          "debugLabel": ""
        },
        {
          "key": "agents",
          "renderTypeList": [
            "custom"
          ],
          "valueType": "any",
          "label": "",
          "value": [
            {
              "value": "转人工：用户明确要求人工客服\n关键词：人工、转接、客服、真人\n示例：我要人工客服、帮我转人工",
              "key": "human"
            },
            {
              "value": "投诉紧急：用户情绪激动或投诉\n关键词：投诉、举报、太慢了、急死了\n示例：我要投诉、你们什么服务",
              "key": "urgent"
            },
            {
              "value": "常规咨询：停车相关问题\n关键词：多少钱、怎么收费、月卡、发票\n示例：停车费怎么算、月卡多少钱",
              "key": "normal"
            },
            {
              "value": "闲聊：打招呼或闲聊\n关键词：你好、在吗、谢谢、再见\n示例：你好啊、谢谢你",
              "key": "chat"
            }
          ],
          "debugLabel": "",
          "toolDescription": ""
        }
      ],
      "outputs": [
        {
          "id": "cqResult",
          "key": "cqResult",
          "required": true,
          "label": "workflow:classification_result",
          "valueType": "string",
          "type": "static",
          "description": ""
        }
      ]
    },
    {
      "nodeId": "humanReply",
      "name": "转人工回复",
      "intro": "AI对话",
      "avatar": "core/workflow/template/aiChat",
      "flowNodeType": "chatNode",
      "showStatus": true,
      "position": {
        "x": 1774.8134202479903,
        "y": -1367.9926980881323
      },
      "version": "4.9.7",
      "inputs": [
        {
          "key": "model",
          "renderTypeList": [
            "settingLLMModel",
            "reference"
          ],
          "label": "common:core.module.input.label.aiModel",
          "valueType": "string",
          "value": "qwen-turbo",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "temperature",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "number",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "maxToken",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "number",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "isResponseAnswerText",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "value": true,
          "valueType": "boolean",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "aiChatQuoteRole",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "string",
          "value": "system",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "quoteTemplate",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "string",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "quotePrompt",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "string",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "aiChatVision",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "boolean",
          "value": true,
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "aiChatReasoning",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "boolean",
          "value": true,
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "aiChatTopP",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "number",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "aiChatStopSign",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "string",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "aiChatResponseFormat",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "string",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "aiChatJsonSchema",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "string",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "systemPrompt",
          "renderTypeList": [
            "textarea",
            "reference"
          ],
          "max": 3000,
          "valueType": "string",
          "label": "common:core.ai.Prompt",
          "value": "你是停车场客服助手。用户请求转人工，请回复：\n\"好的，正在为您转接人工客服，请稍候~\"\n\n回复要求：简洁友好，不超过30字",
          "description": "common:core.app.tip.systemPromptTip",
          "placeholder": "common:core.app.tip.chatNodeSystemPromptTip",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "history",
          "renderTypeList": [
            "numberInput",
            "reference"
          ],
          "valueType": "chatHistory",
          "label": "common:core.module.input.label.chat history",
          "required": true,
          "min": 0,
          "max": 50,
          "value": 3,
          "description": "workflow:max_dialog_rounds",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "quoteQA",
          "renderTypeList": [
            "settingDatasetQuotePrompt"
          ],
          "label": "",
          "debugLabel": "知识库引用",
          "description": "",
          "valueType": "datasetQuote",
          "toolDescription": ""
        },
        {
          "key": "fileUrlList",
          "renderTypeList": [
            "reference",
            "input"
          ],
          "label": "app:workflow.user_file_input",
          "debugLabel": "文件链接",
          "description": "app:workflow.user_file_input_desc",
          "valueType": "arrayString",
          "toolDescription": "",
          "value": []
        },
        {
          "key": "userChatInput",
          "renderTypeList": [
            "reference",
            "textarea"
          ],
          "valueType": "string",
          "label": "workflow:user_question",
          "required": true,
          "value": [
            "448745",
            "userChatInput"
          ],
          "toolDescription": "用户问题",
          "debugLabel": ""
        }
      ],
      "outputs": [
        {
          "id": "history",
          "key": "history",
          "required": true,
          "label": "common:core.module.output.label.New context",
          "description": "将本次回复内容拼接上历史记录，作为新的上下文返回",
          "valueType": "chatHistory",
          "valueDesc": "{\n  obj: System | Human | AI;\n  value: string;\n}[]",
          "type": "static"
        },
        {
          "id": "answerText",
          "key": "answerText",
          "required": true,
          "label": "common:core.module.output.label.Ai response content",
          "valueType": "string",
          "type": "static",
          "description": "将在 stream 回复完毕后触发"
        },
        {
          "id": "reasoningText",
          "key": "reasoningText",
          "required": false,
          "label": "workflow:reasoning_text",
          "valueType": "string",
          "type": "static",
          "invalid": true,
          "description": ""
        },
        {
          "id": "system_error_text",
          "key": "system_error_text",
          "type": "error",
          "valueType": "string",
          "label": "workflow:error_text",
          "description": ""
        }
      ],
      "catchError": false
    },
    {
      "nodeId": "urgentReply",
      "name": "投诉处理",
      "intro": "AI对话",
      "avatar": "core/workflow/template/aiChat",
      "flowNodeType": "chatNode",
      "showStatus": true,
      "position": {
        "x": 1895.4702565280081,
        "y": -187.26582167034434
      },
      "version": "4.9.7",
      "inputs": [
        {
          "key": "model",
          "renderTypeList": [
            "settingLLMModel",
            "reference"
          ],
          "label": "common:core.module.input.label.aiModel",
          "valueType": "string",
          "value": "qwen-turbo",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "temperature",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "number",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "maxToken",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "number",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "isResponseAnswerText",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "value": true,
          "valueType": "boolean",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "aiChatQuoteRole",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "string",
          "value": "system",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "quoteTemplate",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "string",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "quotePrompt",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "string",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "aiChatVision",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "boolean",
          "value": true,
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "aiChatReasoning",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "boolean",
          "value": true,
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "aiChatTopP",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "number",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "aiChatStopSign",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "string",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "aiChatResponseFormat",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "string",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "aiChatJsonSchema",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "string",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "systemPrompt",
          "renderTypeList": [
            "textarea",
            "reference"
          ],
          "max": 3000,
          "valueType": "string",
          "label": "common:core.ai.Prompt",
          "value": "你是停车场客服助手。用户情绪激动或有投诉，请：\n1. 先道歉安抚\n2. 表示重视\n3. 告知转人工\n\n示例：\"非常抱歉给您带来不便！我们非常重视您的反馈，正在为您转接人工客服优先处理，请稍候~\"",
          "description": "common:core.app.tip.systemPromptTip",
          "placeholder": "common:core.app.tip.chatNodeSystemPromptTip",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "history",
          "renderTypeList": [
            "numberInput",
            "reference"
          ],
          "valueType": "chatHistory",
          "label": "common:core.module.input.label.chat history",
          "required": true,
          "min": 0,
          "max": 50,
          "value": 6,
          "description": "workflow:max_dialog_rounds",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "quoteQA",
          "renderTypeList": [
            "settingDatasetQuotePrompt"
          ],
          "label": "",
          "debugLabel": "知识库引用",
          "description": "",
          "valueType": "datasetQuote",
          "toolDescription": ""
        },
        {
          "key": "fileUrlList",
          "renderTypeList": [
            "reference",
            "input"
          ],
          "label": "app:workflow.user_file_input",
          "debugLabel": "文件链接",
          "description": "app:workflow.user_file_input_desc",
          "valueType": "arrayString",
          "toolDescription": "",
          "value": []
        },
        {
          "key": "userChatInput",
          "renderTypeList": [
            "reference",
            "textarea"
          ],
          "valueType": "string",
          "label": "workflow:user_question",
          "required": true,
          "value": [
            "448745",
            "userChatInput"
          ],
          "toolDescription": "用户问题",
          "debugLabel": ""
        }
      ],
      "outputs": [
        {
          "id": "history",
          "key": "history",
          "required": true,
          "label": "common:core.module.output.label.New context",
          "description": "将本次回复内容拼接上历史记录，作为新的上下文返回",
          "valueType": "chatHistory",
          "valueDesc": "{\n  obj: System | Human | AI;\n  value: string;\n}[]",
          "type": "static"
        },
        {
          "id": "answerText",
          "key": "answerText",
          "required": true,
          "label": "common:core.module.output.label.Ai response content",
          "valueType": "string",
          "type": "static",
          "description": "将在 stream 回复完毕后触发"
        },
        {
          "id": "reasoningText",
          "key": "reasoningText",
          "required": false,
          "label": "workflow:reasoning_text",
          "valueType": "string",
          "type": "static",
          "invalid": true,
          "description": ""
        },
        {
          "id": "system_error_text",
          "key": "system_error_text",
          "type": "error",
          "valueType": "string",
          "label": "workflow:error_text",
          "description": ""
        }
      ],
      "catchError": false
    },
    {
      "nodeId": "datasetSearch",
      "name": "知识库搜索",
      "intro": "调用知识库搜索",
      "avatar": "core/workflow/template/datasetSearch",
      "flowNodeType": "datasetSearchNode",
      "showStatus": true,
      "position": {
        "x": 2080.5195224661156,
        "y": 1241.4775266222784
      },
      "version": "4.9.2",
      "inputs": [
        {
          "key": "datasets",
          "renderTypeList": [
            "selectDataset",
            "reference"
          ],
          "label": "common:core.module.input.label.Select dataset",
          "value": [],
          "valueType": "selectDataset",
          "required": true,
          "valueDesc": "{\n  datasetId: string;\n}[]",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "similarity",
          "renderTypeList": [
            "selectDatasetParamsModal"
          ],
          "label": "",
          "value": 0.5,
          "valueType": "number",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "limit",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "value": 3000,
          "valueType": "number",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "searchMode",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "string",
          "value": "mixedRecall",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "embeddingWeight",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "number",
          "value": 0.5,
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "usingReRank",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "boolean",
          "value": false,
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "rerankModel",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "string",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "rerankWeight",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "number",
          "value": 0.5,
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "datasetSearchUsingExtensionQuery",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "boolean",
          "value": true,
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "datasetSearchExtensionModel",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "string",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "datasetSearchExtensionBg",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "string",
          "value": "",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "authTmbId",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "boolean",
          "value": false,
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "userChatInput",
          "renderTypeList": [
            "reference",
            "textarea"
          ],
          "valueType": "string",
          "label": "workflow:user_question",
          "required": true,
          "value": [
            "448745",
            "userChatInput"
          ],
          "toolDescription": "需要检索的内容",
          "debugLabel": ""
        },
        {
          "key": "collectionFilterMatch",
          "renderTypeList": [
            "textarea",
            "reference"
          ],
          "label": "workflow:collection_metadata_filter",
          "valueType": "string",
          "isPro": true,
          "description": "workflow:filter_description",
          "debugLabel": "",
          "toolDescription": ""
        }
      ],
      "outputs": [
        {
          "id": "quoteQA",
          "key": "quoteQA",
          "label": "common:core.module.Dataset quote.label",
          "type": "static",
          "valueType": "datasetQuote",
          "description": "特殊数组格式，搜索结果为空时，返回空数组。",
          "valueDesc": "{\n  id: string;\n  datasetId: string;\n  collectionId: string;\n  sourceName: string;\n  sourceId?: string;\n  q: string;\n  a: string\n}[]"
        },
        {
          "id": "system_error_text",
          "key": "system_error_text",
          "type": "error",
          "valueType": "string",
          "label": "workflow:error_text",
          "description": ""
        }
      ],
      "catchError": false
    },
    {
      "nodeId": "normalReply",
      "name": "知识库回答",
      "intro": "AI对话",
      "avatar": "core/workflow/template/aiChat",
      "flowNodeType": "chatNode",
      "showStatus": true,
      "position": {
        "x": 3170.748824534619,
        "y": 1189.9909553118582
      },
      "version": "4.9.7",
      "inputs": [
        {
          "key": "model",
          "renderTypeList": [
            "settingLLMModel",
            "reference"
          ],
          "label": "common:core.module.input.label.aiModel",
          "valueType": "string",
          "value": "qwen-turbo",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "temperature",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "number",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "maxToken",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "number",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "isResponseAnswerText",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "value": true,
          "valueType": "boolean",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "aiChatQuoteRole",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "string",
          "value": "system",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "quoteTemplate",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "string",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "quotePrompt",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "string",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "aiChatVision",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "boolean",
          "value": true,
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "aiChatReasoning",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "boolean",
          "value": true,
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "aiChatTopP",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "number",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "aiChatStopSign",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "string",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "aiChatResponseFormat",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "string",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "aiChatJsonSchema",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "string",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "systemPrompt",
          "renderTypeList": [
            "textarea",
            "reference"
          ],
          "max": 3000,
          "valueType": "string",
          "label": "common:core.ai.Prompt",
          "value": "你是停车场客服助手。请根据知识库内容回答用户问题。\n\n回答原则：\n1. 简洁明了，不超过50字\n2. 直接说重点，不要说\"根据查询...\"\n3. 告诉用户怎么做\n4. 友好收尾\n\n示例：\n问：停车费怎么算？\n答：您好！前15分钟免费，之后每小时3元，24小时封顶30元。还有问题可以继续问我~",
          "description": "common:core.app.tip.systemPromptTip",
          "placeholder": "common:core.app.tip.chatNodeSystemPromptTip",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "history",
          "renderTypeList": [
            "numberInput",
            "reference"
          ],
          "valueType": "chatHistory",
          "label": "common:core.module.input.label.chat history",
          "required": true,
          "min": 0,
          "max": 50,
          "value": 6,
          "description": "workflow:max_dialog_rounds",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "quoteQA",
          "renderTypeList": [
            "settingDatasetQuotePrompt"
          ],
          "label": "",
          "valueType": "datasetQuote",
          "value": [
            "datasetSearch",
            "quoteQA"
          ],
          "debugLabel": "知识库引用",
          "description": "",
          "toolDescription": ""
        },
        {
          "key": "fileUrlList",
          "renderTypeList": [
            "reference",
            "input"
          ],
          "label": "app:workflow.user_file_input",
          "debugLabel": "文件链接",
          "description": "app:workflow.user_file_input_desc",
          "valueType": "arrayString",
          "toolDescription": "",
          "value": []
        },
        {
          "key": "userChatInput",
          "renderTypeList": [
            "reference",
            "textarea"
          ],
          "valueType": "string",
          "label": "workflow:user_question",
          "required": true,
          "value": [
            "448745",
            "userChatInput"
          ],
          "toolDescription": "用户问题",
          "debugLabel": ""
        }
      ],
      "outputs": [
        {
          "id": "history",
          "key": "history",
          "required": true,
          "label": "common:core.module.output.label.New context",
          "description": "将本次回复内容拼接上历史记录，作为新的上下文返回",
          "valueType": "chatHistory",
          "valueDesc": "{\n  obj: System | Human | AI;\n  value: string;\n}[]",
          "type": "static"
        },
        {
          "id": "answerText",
          "key": "answerText",
          "required": true,
          "label": "common:core.module.output.label.Ai response content",
          "valueType": "string",
          "type": "static",
          "description": "将在 stream 回复完毕后触发"
        },
        {
          "id": "reasoningText",
          "key": "reasoningText",
          "required": false,
          "label": "workflow:reasoning_text",
          "valueType": "string",
          "type": "static",
          "invalid": true,
          "description": ""
        },
        {
          "id": "system_error_text",
          "key": "system_error_text",
          "type": "error",
          "valueType": "string",
          "label": "workflow:error_text",
          "description": ""
        }
      ],
      "catchError": false
    },
    {
      "nodeId": "chatReply",
      "name": "闲聊回复",
      "intro": "AI对话",
      "avatar": "core/workflow/template/aiChat",
      "flowNodeType": "chatNode",
      "showStatus": true,
      "position": {
        "x": 1217.080212425671,
        "y": 1406.0661108254596
      },
      "version": "4.9.7",
      "inputs": [
        {
          "key": "model",
          "renderTypeList": [
            "settingLLMModel",
            "reference"
          ],
          "label": "common:core.module.input.label.aiModel",
          "valueType": "string",
          "value": "qwen-turbo",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "temperature",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "number",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "maxToken",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "number",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "isResponseAnswerText",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "value": true,
          "valueType": "boolean",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "aiChatQuoteRole",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "string",
          "value": "system",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "quoteTemplate",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "string",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "quotePrompt",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "string",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "aiChatVision",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "boolean",
          "value": true,
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "aiChatReasoning",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "boolean",
          "value": true,
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "aiChatTopP",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "number",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "aiChatStopSign",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "string",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "aiChatResponseFormat",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "string",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "aiChatJsonSchema",
          "renderTypeList": [
            "hidden"
          ],
          "label": "",
          "valueType": "string",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "systemPrompt",
          "renderTypeList": [
            "textarea",
            "reference"
          ],
          "max": 3000,
          "valueType": "string",
          "label": "common:core.ai.Prompt",
          "value": "你是智慧停车场的AI客服助手，亲切友好。\n\n回复要求：\n1. 简短热情（不超过20字）\n2. 自然引导用户说出需求\n\n示例：\n- 用户说\"你好\" → \"您好！请问有什么可以帮您的吗？\"\n- 用户说\"谢谢\" → \"不客气，祝您停车愉快！\"",
          "description": "common:core.app.tip.systemPromptTip",
          "placeholder": "common:core.app.tip.chatNodeSystemPromptTip",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "history",
          "renderTypeList": [
            "numberInput",
            "reference"
          ],
          "valueType": "chatHistory",
          "label": "common:core.module.input.label.chat history",
          "required": true,
          "min": 0,
          "max": 50,
          "value": 3,
          "description": "workflow:max_dialog_rounds",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "quoteQA",
          "renderTypeList": [
            "settingDatasetQuotePrompt"
          ],
          "label": "",
          "debugLabel": "知识库引用",
          "description": "",
          "valueType": "datasetQuote",
          "toolDescription": ""
        },
        {
          "key": "fileUrlList",
          "renderTypeList": [
            "reference",
            "input"
          ],
          "label": "app:workflow.user_file_input",
          "debugLabel": "文件链接",
          "description": "app:workflow.user_file_input_desc",
          "valueType": "arrayString",
          "toolDescription": "",
          "value": []
        },
        {
          "key": "userChatInput",
          "renderTypeList": [
            "reference",
            "textarea"
          ],
          "valueType": "string",
          "label": "workflow:user_question",
          "required": true,
          "value": [
            "448745",
            "userChatInput"
          ],
          "toolDescription": "用户问题",
          "debugLabel": ""
        }
      ],
      "outputs": [
        {
          "id": "history",
          "key": "history",
          "required": true,
          "label": "common:core.module.output.label.New context",
          "description": "将本次回复内容拼接上历史记录，作为新的上下文返回",
          "valueType": "chatHistory",
          "valueDesc": "{\n  obj: System | Human | AI;\n  value: string;\n}[]",
          "type": "static"
        },
        {
          "id": "answerText",
          "key": "answerText",
          "required": true,
          "label": "common:core.module.output.label.Ai response content",
          "valueType": "string",
          "type": "static",
          "description": "将在 stream 回复完毕后触发"
        },
        {
          "id": "reasoningText",
          "key": "reasoningText",
          "required": false,
          "label": "workflow:reasoning_text",
          "valueType": "string",
          "type": "static",
          "invalid": true,
          "description": ""
        },
        {
          "id": "system_error_text",
          "key": "system_error_text",
          "type": "error",
          "valueType": "string",
          "label": "workflow:error_text",
          "description": ""
        }
      ],
      "catchError": false
    },
    {
      "nodeId": "httpHuman",
      "name": "触发转人工API",
      "intro": "调用后端转人工接口，透传RTC参数",
      "avatar": "core/workflow/template/httpRequest",
      "flowNodeType": "httpRequest468",
      "showStatus": true,
      "position": {
        "x": 3153.3523008143393,
        "y": -504.6303232977498
      },
      "inputs": [
        {
          "key": "system_addInputParam",
          "renderTypeList": [
            "addInputParam"
          ],
          "valueType": "dynamic",
          "label": "",
          "required": false,
          "description": "common:core.module.input.description.HTTP Dynamic Input",
          "editField": {
            "key": true,
            "valueType": true
          },
          "customInputConfig": {
            "selectValueTypeList": [
              "string",
              "number",
              "boolean",
              "object",
              "arrayString",
              "arrayNumber",
              "arrayBoolean",
              "arrayObject",
              "arrayAny",
              "any",
              "chatHistory",
              "datasetQuote",
              "dynamic",
              "selectDataset",
              "selectApp"
            ],
            "showDescription": false,
            "showDefaultValue": true
          },
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "system_httpMethod",
          "renderTypeList": [
            "custom"
          ],
          "valueType": "string",
          "label": "",
          "value": "POST",
          "required": true,
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "system_httpTimeout",
          "renderTypeList": [
            "custom"
          ],
          "valueType": "number",
          "label": "",
          "value": 30,
          "min": 5,
          "max": 600,
          "required": true,
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "system_httpReqUrl",
          "renderTypeList": [
            "hidden"
          ],
          "valueType": "string",
          "label": "",
          "description": "common:core.module.input.description.Http Request Url",
          "placeholder": "https://api.ai.com/getInventory",
          "required": false,
          "value": "https://47.237.118.74:3000/api/request-human-takeover",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "system_header_secret",
          "renderTypeList": [
            "hidden"
          ],
          "valueType": "object",
          "label": "",
          "required": false,
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "system_httpHeader",
          "renderTypeList": [
            "custom"
          ],
          "valueType": "any",
          "value": [
            {
              "key": "Content-Type",
              "type": "string",
              "value": "application/json"
            }
          ],
          "label": "",
          "description": "common:core.module.input.description.Http Request Header",
          "required": false,
          "placeholder": "common:core.module.input.description.Http Request Header",
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "system_httpParams",
          "renderTypeList": [
            "hidden"
          ],
          "valueType": "any",
          "value": [],
          "label": "",
          "required": false,
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "system_httpJsonBody",
          "renderTypeList": [
            "hidden"
          ],
          "valueType": "any",
          "label": "",
          "value": "{\n  \"userId\": \"{{userId}}\",\n  \"reason\": \"ai_suggested\",\n  \"source\": \"fastgpt\"\n}",
          "required": false,
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "system_httpFormBody",
          "renderTypeList": [
            "hidden"
          ],
          "valueType": "any",
          "value": [],
          "label": "",
          "required": false,
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "system_httpContentType",
          "renderTypeList": [
            "hidden"
          ],
          "valueType": "string",
          "value": "json",
          "label": "",
          "required": false,
          "debugLabel": "",
          "toolDescription": ""
        },
        {
          "key": "instanceId",
          "valueType": "string",
          "label": "instanceId",
          "renderTypeList": [
            "reference"
          ],
          "description": "智能体实例ID",
          "canEdit": true,
          "editField": {
            "key": true,
            "valueType": true
          },
          "value": [
            "userGuide",
            "instanceId"
          ],
          "customInputConfig": {
            "selectValueTypeList": [
              "string",
              "number",
              "boolean",
              "object",
              "arrayString",
              "arrayNumber",
              "arrayBoolean",
              "arrayObject",
              "arrayAny",
              "any",
              "chatHistory",
              "datasetQuote",
              "dynamic",
              "selectDataset",
              "selectApp"
            ],
            "showDescription": false,
            "showDefaultValue": true
          }
        },
        {
          "key": "userId",
          "valueType": "string",
          "label": "userId",
          "renderTypeList": [
            "reference"
          ],
          "description": "用户ID",
          "canEdit": true,
          "editField": {
            "key": true,
            "valueType": true
          },
          "value": [
            "userGuide",
            "userId"
          ],
          "customInputConfig": {
            "selectValueTypeList": [
              "string",
              "number",
              "boolean",
              "object",
              "arrayString",
              "arrayNumber",
              "arrayBoolean",
              "arrayObject",
              "arrayAny",
              "any",
              "chatHistory",
              "datasetQuote",
              "dynamic",
              "selectDataset",
              "selectApp"
            ],
            "showDescription": false,
            "showDefaultValue": true
          }
        },
        {
          "key": "channelId",
          "valueType": "string",
          "label": "channelId",
          "renderTypeList": [
            "reference"
          ],
          "description": "RTC频道ID",
          "canEdit": true,
          "editField": {
            "key": true,
            "valueType": true
          },
          "value": [
            "userGuide",
            "channelId"
          ],
          "customInputConfig": {
            "selectValueTypeList": [
              "string",
              "number",
              "boolean",
              "object",
              "arrayString",
              "arrayNumber",
              "arrayBoolean",
              "arrayObject",
              "arrayAny",
              "any",
              "chatHistory",
              "datasetQuote",
              "dynamic",
              "selectDataset",
              "selectApp"
            ],
            "showDescription": false,
            "showDefaultValue": true
          }
        }
      ],
      "outputs": [
        {
          "id": "httpRawResponse",
          "key": "httpRawResponse",
          "required": true,
          "label": "workflow:raw_response",
          "description": "HTTP请求的原始响应。只能接受字符串或JSON类型响应数据。",
          "valueType": "any",
          "type": "static"
        },
        {
          "id": "error",
          "key": "error",
          "label": "workflow:error_text",
          "valueType": "string",
          "type": "error",
          "description": ""
        },
        {
          "id": "system_httpResult",
          "key": "system_httpResult",
          "label": "HTTP响应",
          "valueType": "any",
          "type": "static"
        }
      ],
      "catchError": true
    }
  ],
  "edges": [
    {
      "source": "448745",
      "target": "classifyNode",
      "sourceHandle": "448745-source-right",
      "targetHandle": "classifyNode-target-left"
    },
    {
      "source": "classifyNode",
      "target": "humanReply",
      "sourceHandle": "classifyNode-source-human",
      "targetHandle": "humanReply-target-left"
    },
    {
      "source": "classifyNode",
      "target": "urgentReply",
      "sourceHandle": "classifyNode-source-urgent",
      "targetHandle": "urgentReply-target-left"
    },
    {
      "source": "classifyNode",
      "target": "datasetSearch",
      "sourceHandle": "classifyNode-source-normal",
      "targetHandle": "datasetSearch-target-left"
    },
    {
      "source": "classifyNode",
      "target": "chatReply",
      "sourceHandle": "classifyNode-source-chat",
      "targetHandle": "chatReply-target-left"
    },
    {
      "source": "datasetSearch",
      "target": "normalReply",
      "sourceHandle": "datasetSearch-source-right",
      "targetHandle": "normalReply-target-left"
    },
    {
      "source": "humanReply",
      "target": "httpHuman",
      "sourceHandle": "humanReply-source-right",
      "targetHandle": "httpHuman-target-left"
    },
    {
      "source": "urgentReply",
      "target": "httpHuman",
      "sourceHandle": "urgentReply-source-right",
      "targetHandle": "httpHuman-target-left"
    }
  ],
  "chatConfig": {
    "variables": [
      {
        "id": "jHjSX5",
        "key": "instanceId",
        "label": "instanceId",
        "type": "input",
        "description": "",
        "required": true,
        "valueType": "string",
        "list": [
          {
            "value": "",
            "label": ""
          }
        ],
        "defaultValue": "",
        "enums": [
          {
            "value": "",
            "label": ""
          }
        ]
      },
      {
        "id": "gDiwye",
        "key": "userId",
        "label": "userId",
        "type": "input",
        "description": "",
        "required": true,
        "valueType": "string",
        "list": [
          {
            "value": "",
            "label": ""
          }
        ],
        "defaultValue": "",
        "enums": [
          {
            "value": "",
            "label": ""
          }
        ]
      },
      {
        "id": "nYd6mr",
        "key": "channelId",
        "label": "channelId",
        "type": "input",
        "description": "",
        "required": true,
        "valueType": "string",
        "list": [
          {
            "value": "",
            "label": ""
          }
        ],
        "defaultValue": "",
        "enums": [
          {
            "value": "",
            "label": ""
          }
        ]
      }
    ],
    "scheduledTriggerConfig": {
      "cronString": "",
      "timezone": "Asia/Shanghai",
      "defaultPrompt": ""
    },
    "_id": "695f186cf1912aafcb9779ac"
  }
}