(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))o(u);new MutationObserver(u=>{for(const g of u)if(g.type==="childList")for(const c of g.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function n(u){const g={};return u.integrity&&(g.integrity=u.integrity),u.referrerPolicy&&(g.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?g.credentials="include":u.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function o(u){if(u.ep)return;u.ep=!0;const g=n(u);fetch(u.href,g)}})();function A1(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Vd={exports:{}},os={};var cv;function C1(){if(cv)return os;cv=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(o,u,g){var c=null;if(g!==void 0&&(c=""+g),u.key!==void 0&&(c=""+u.key),"key"in u){g={};for(var s in u)s!=="key"&&(g[s]=u[s])}else g=u;return u=g.ref,{$$typeof:i,type:o,key:c,ref:u!==void 0?u:null,props:g}}return os.Fragment=e,os.jsx=n,os.jsxs=n,os}var lv;function w1(){return lv||(lv=1,Vd.exports=C1()),Vd.exports}var Ge=w1(),Hd={exports:{}},at={};var uv;function D1(){if(uv)return at;uv=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),u=Symbol.for("react.profiler"),g=Symbol.for("react.consumer"),c=Symbol.for("react.context"),s=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),l=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),S=Symbol.for("react.activity"),T=Symbol.iterator;function y(z){return z===null||typeof z!="object"?null:(z=T&&z[T]||z["@@iterator"],typeof z=="function"?z:null)}var R={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,h={};function m(z,V,re){this.props=z,this.context=V,this.refs=h,this.updater=re||R}m.prototype.isReactComponent={},m.prototype.setState=function(z,V){if(typeof z!="object"&&typeof z!="function"&&z!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,z,V,"setState")},m.prototype.forceUpdate=function(z){this.updater.enqueueForceUpdate(this,z,"forceUpdate")};function _(){}_.prototype=m.prototype;function A(z,V,re){this.props=z,this.context=V,this.refs=h,this.updater=re||R}var E=A.prototype=new _;E.constructor=A,v(E,m.prototype),E.isPureReactComponent=!0;var b=Array.isArray;function w(){}var C={H:null,A:null,T:null,S:null},P=Object.prototype.hasOwnProperty;function U(z,V,re){var Q=re.ref;return{$$typeof:i,type:z,key:V,ref:Q!==void 0?Q:null,props:re}}function B(z,V){return U(z.type,V,z.props)}function L(z){return typeof z=="object"&&z!==null&&z.$$typeof===i}function H(z){var V={"=":"=0",":":"=2"};return"$"+z.replace(/[=:]/g,function(re){return V[re]})}var O=/\/+/g;function x(z,V){return typeof z=="object"&&z!==null&&z.key!=null?H(""+z.key):V.toString(36)}function F(z){switch(z.status){case"fulfilled":return z.value;case"rejected":throw z.reason;default:switch(typeof z.status=="string"?z.then(w,w):(z.status="pending",z.then(function(V){z.status==="pending"&&(z.status="fulfilled",z.value=V)},function(V){z.status==="pending"&&(z.status="rejected",z.reason=V)})),z.status){case"fulfilled":return z.value;case"rejected":throw z.reason}}throw z}function N(z,V,re,Q,Z){var q=typeof z;(q==="undefined"||q==="boolean")&&(z=null);var Y=!1;if(z===null)Y=!0;else switch(q){case"bigint":case"string":case"number":Y=!0;break;case"object":switch(z.$$typeof){case i:case e:Y=!0;break;case p:return Y=z._init,N(Y(z._payload),V,re,Q,Z)}}if(Y)return Z=Z(z),Y=Q===""?"."+x(z,0):Q,b(Z)?(re="",Y!=null&&(re=Y.replace(O,"$&/")+"/"),N(Z,V,re,"",function(te){return te})):Z!=null&&(L(Z)&&(Z=B(Z,re+(Z.key==null||z&&z.key===Z.key?"":(""+Z.key).replace(O,"$&/")+"/")+Y)),V.push(Z)),1;Y=0;var J=Q===""?".":Q+":";if(b(z))for(var $=0;$<z.length;$++)Q=z[$],q=J+x(Q,$),Y+=N(Q,V,re,q,Z);else if($=y(z),typeof $=="function")for(z=$.call(z),$=0;!(Q=z.next()).done;)Q=Q.value,q=J+x(Q,$++),Y+=N(Q,V,re,q,Z);else if(q==="object"){if(typeof z.then=="function")return N(F(z),V,re,Q,Z);throw V=String(z),Error("Objects are not valid as a React child (found: "+(V==="[object Object]"?"object with keys {"+Object.keys(z).join(", ")+"}":V)+"). If you meant to render a collection of children, use an array instead.")}return Y}function k(z,V,re){if(z==null)return z;var Q=[],Z=0;return N(z,Q,"","",function(q){return V.call(re,q,Z++)}),Q}function M(z){if(z._status===-1){var V=z._result;V=V(),V.then(function(re){(z._status===0||z._status===-1)&&(z._status=1,z._result=re)},function(re){(z._status===0||z._status===-1)&&(z._status=2,z._result=re)}),z._status===-1&&(z._status=0,z._result=V)}if(z._status===1)return z._result.default;throw z._result}var j=typeof reportError=="function"?reportError:function(z){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var V=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof z=="object"&&z!==null&&typeof z.message=="string"?String(z.message):String(z),error:z});if(!window.dispatchEvent(V))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",z);return}console.error(z)},G={map:k,forEach:function(z,V,re){k(z,function(){V.apply(this,arguments)},re)},count:function(z){var V=0;return k(z,function(){V++}),V},toArray:function(z){return k(z,function(V){return V})||[]},only:function(z){if(!L(z))throw Error("React.Children.only expected to receive a single React element child.");return z}};return at.Activity=S,at.Children=G,at.Component=m,at.Fragment=n,at.Profiler=u,at.PureComponent=A,at.StrictMode=o,at.Suspense=d,at.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=C,at.__COMPILER_RUNTIME={__proto__:null,c:function(z){return C.H.useMemoCache(z)}},at.cache=function(z){return function(){return z.apply(null,arguments)}},at.cacheSignal=function(){return null},at.cloneElement=function(z,V,re){if(z==null)throw Error("The argument must be a React element, but you passed "+z+".");var Q=v({},z.props),Z=z.key;if(V!=null)for(q in V.key!==void 0&&(Z=""+V.key),V)!P.call(V,q)||q==="key"||q==="__self"||q==="__source"||q==="ref"&&V.ref===void 0||(Q[q]=V[q]);var q=arguments.length-2;if(q===1)Q.children=re;else if(1<q){for(var Y=Array(q),J=0;J<q;J++)Y[J]=arguments[J+2];Q.children=Y}return U(z.type,Z,Q)},at.createContext=function(z){return z={$$typeof:c,_currentValue:z,_currentValue2:z,_threadCount:0,Provider:null,Consumer:null},z.Provider=z,z.Consumer={$$typeof:g,_context:z},z},at.createElement=function(z,V,re){var Q,Z={},q=null;if(V!=null)for(Q in V.key!==void 0&&(q=""+V.key),V)P.call(V,Q)&&Q!=="key"&&Q!=="__self"&&Q!=="__source"&&(Z[Q]=V[Q]);var Y=arguments.length-2;if(Y===1)Z.children=re;else if(1<Y){for(var J=Array(Y),$=0;$<Y;$++)J[$]=arguments[$+2];Z.children=J}if(z&&z.defaultProps)for(Q in Y=z.defaultProps,Y)Z[Q]===void 0&&(Z[Q]=Y[Q]);return U(z,q,Z)},at.createRef=function(){return{current:null}},at.forwardRef=function(z){return{$$typeof:s,render:z}},at.isValidElement=L,at.lazy=function(z){return{$$typeof:p,_payload:{_status:-1,_result:z},_init:M}},at.memo=function(z,V){return{$$typeof:l,type:z,compare:V===void 0?null:V}},at.startTransition=function(z){var V=C.T,re={};C.T=re;try{var Q=z(),Z=C.S;Z!==null&&Z(re,Q),typeof Q=="object"&&Q!==null&&typeof Q.then=="function"&&Q.then(w,j)}catch(q){j(q)}finally{V!==null&&re.types!==null&&(V.types=re.types),C.T=V}},at.unstable_useCacheRefresh=function(){return C.H.useCacheRefresh()},at.use=function(z){return C.H.use(z)},at.useActionState=function(z,V,re){return C.H.useActionState(z,V,re)},at.useCallback=function(z,V){return C.H.useCallback(z,V)},at.useContext=function(z){return C.H.useContext(z)},at.useDebugValue=function(){},at.useDeferredValue=function(z,V){return C.H.useDeferredValue(z,V)},at.useEffect=function(z,V){return C.H.useEffect(z,V)},at.useEffectEvent=function(z){return C.H.useEffectEvent(z)},at.useId=function(){return C.H.useId()},at.useImperativeHandle=function(z,V,re){return C.H.useImperativeHandle(z,V,re)},at.useInsertionEffect=function(z,V){return C.H.useInsertionEffect(z,V)},at.useLayoutEffect=function(z,V){return C.H.useLayoutEffect(z,V)},at.useMemo=function(z,V){return C.H.useMemo(z,V)},at.useOptimistic=function(z,V){return C.H.useOptimistic(z,V)},at.useReducer=function(z,V,re){return C.H.useReducer(z,V,re)},at.useRef=function(z){return C.H.useRef(z)},at.useState=function(z){return C.H.useState(z)},at.useSyncExternalStore=function(z,V,re){return C.H.useSyncExternalStore(z,V,re)},at.useTransition=function(){return C.H.useTransition()},at.version="19.2.3",at}var dv;function Kh(){return dv||(dv=1,Hd.exports=D1()),Hd.exports}var ot=Kh(),jd={exports:{}},as={},zd={exports:{}},Fd={};var hv;function O1(){return hv||(hv=1,(function(i){function e(N,k){var M=N.length;N.push(k);e:for(;0<M;){var j=M-1>>>1,G=N[j];if(0<u(G,k))N[j]=k,N[M]=G,M=j;else break e}}function n(N){return N.length===0?null:N[0]}function o(N){if(N.length===0)return null;var k=N[0],M=N.pop();if(M!==k){N[0]=M;e:for(var j=0,G=N.length,z=G>>>1;j<z;){var V=2*(j+1)-1,re=N[V],Q=V+1,Z=N[Q];if(0>u(re,M))Q<G&&0>u(Z,re)?(N[j]=Z,N[Q]=M,j=Q):(N[j]=re,N[V]=M,j=V);else if(Q<G&&0>u(Z,M))N[j]=Z,N[Q]=M,j=Q;else break e}}return k}function u(N,k){var M=N.sortIndex-k.sortIndex;return M!==0?M:N.id-k.id}if(i.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var g=performance;i.unstable_now=function(){return g.now()}}else{var c=Date,s=c.now();i.unstable_now=function(){return c.now()-s}}var d=[],l=[],p=1,S=null,T=3,y=!1,R=!1,v=!1,h=!1,m=typeof setTimeout=="function"?setTimeout:null,_=typeof clearTimeout=="function"?clearTimeout:null,A=typeof setImmediate<"u"?setImmediate:null;function E(N){for(var k=n(l);k!==null;){if(k.callback===null)o(l);else if(k.startTime<=N)o(l),k.sortIndex=k.expirationTime,e(d,k);else break;k=n(l)}}function b(N){if(v=!1,E(N),!R)if(n(d)!==null)R=!0,w||(w=!0,H());else{var k=n(l);k!==null&&F(b,k.startTime-N)}}var w=!1,C=-1,P=5,U=-1;function B(){return h?!0:!(i.unstable_now()-U<P)}function L(){if(h=!1,w){var N=i.unstable_now();U=N;var k=!0;try{e:{R=!1,v&&(v=!1,_(C),C=-1),y=!0;var M=T;try{t:{for(E(N),S=n(d);S!==null&&!(S.expirationTime>N&&B());){var j=S.callback;if(typeof j=="function"){S.callback=null,T=S.priorityLevel;var G=j(S.expirationTime<=N);if(N=i.unstable_now(),typeof G=="function"){S.callback=G,E(N),k=!0;break t}S===n(d)&&o(d),E(N)}else o(d);S=n(d)}if(S!==null)k=!0;else{var z=n(l);z!==null&&F(b,z.startTime-N),k=!1}}break e}finally{S=null,T=M,y=!1}k=void 0}}finally{k?H():w=!1}}}var H;if(typeof A=="function")H=function(){A(L)};else if(typeof MessageChannel<"u"){var O=new MessageChannel,x=O.port2;O.port1.onmessage=L,H=function(){x.postMessage(null)}}else H=function(){m(L,0)};function F(N,k){C=m(function(){N(i.unstable_now())},k)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(N){N.callback=null},i.unstable_forceFrameRate=function(N){0>N||125<N?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<N?Math.floor(1e3/N):5},i.unstable_getCurrentPriorityLevel=function(){return T},i.unstable_next=function(N){switch(T){case 1:case 2:case 3:var k=3;break;default:k=T}var M=T;T=k;try{return N()}finally{T=M}},i.unstable_requestPaint=function(){h=!0},i.unstable_runWithPriority=function(N,k){switch(N){case 1:case 2:case 3:case 4:case 5:break;default:N=3}var M=T;T=N;try{return k()}finally{T=M}},i.unstable_scheduleCallback=function(N,k,M){var j=i.unstable_now();switch(typeof M=="object"&&M!==null?(M=M.delay,M=typeof M=="number"&&0<M?j+M:j):M=j,N){case 1:var G=-1;break;case 2:G=250;break;case 5:G=1073741823;break;case 4:G=1e4;break;default:G=5e3}return G=M+G,N={id:p++,callback:k,priorityLevel:N,startTime:M,expirationTime:G,sortIndex:-1},M>j?(N.sortIndex=M,e(l,N),n(d)===null&&N===n(l)&&(v?(_(C),C=-1):v=!0,F(b,M-j))):(N.sortIndex=G,e(d,N),R||y||(R=!0,w||(w=!0,H()))),N},i.unstable_shouldYield=B,i.unstable_wrapCallback=function(N){var k=T;return function(){var M=T;T=k;try{return N.apply(this,arguments)}finally{T=M}}}})(Fd)),Fd}var fv;function I1(){return fv||(fv=1,zd.exports=O1()),zd.exports}var Gd={exports:{}},Oi={};var pv;function M1(){if(pv)return Oi;pv=1;var i=Kh();function e(d){var l="https://react.dev/errors/"+d;if(1<arguments.length){l+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)l+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+d+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var o={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},u=Symbol.for("react.portal");function g(d,l,p){var S=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:u,key:S==null?null:""+S,children:d,containerInfo:l,implementation:p}}var c=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function s(d,l){if(d==="font")return"";if(typeof l=="string")return l==="use-credentials"?l:""}return Oi.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=o,Oi.createPortal=function(d,l){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11)throw Error(e(299));return g(d,l,null,p)},Oi.flushSync=function(d){var l=c.T,p=o.p;try{if(c.T=null,o.p=2,d)return d()}finally{c.T=l,o.p=p,o.d.f()}},Oi.preconnect=function(d,l){typeof d=="string"&&(l?(l=l.crossOrigin,l=typeof l=="string"?l==="use-credentials"?l:"":void 0):l=null,o.d.C(d,l))},Oi.prefetchDNS=function(d){typeof d=="string"&&o.d.D(d)},Oi.preinit=function(d,l){if(typeof d=="string"&&l&&typeof l.as=="string"){var p=l.as,S=s(p,l.crossOrigin),T=typeof l.integrity=="string"?l.integrity:void 0,y=typeof l.fetchPriority=="string"?l.fetchPriority:void 0;p==="style"?o.d.S(d,typeof l.precedence=="string"?l.precedence:void 0,{crossOrigin:S,integrity:T,fetchPriority:y}):p==="script"&&o.d.X(d,{crossOrigin:S,integrity:T,fetchPriority:y,nonce:typeof l.nonce=="string"?l.nonce:void 0})}},Oi.preinitModule=function(d,l){if(typeof d=="string")if(typeof l=="object"&&l!==null){if(l.as==null||l.as==="script"){var p=s(l.as,l.crossOrigin);o.d.M(d,{crossOrigin:p,integrity:typeof l.integrity=="string"?l.integrity:void 0,nonce:typeof l.nonce=="string"?l.nonce:void 0})}}else l==null&&o.d.M(d)},Oi.preload=function(d,l){if(typeof d=="string"&&typeof l=="object"&&l!==null&&typeof l.as=="string"){var p=l.as,S=s(p,l.crossOrigin);o.d.L(d,p,{crossOrigin:S,integrity:typeof l.integrity=="string"?l.integrity:void 0,nonce:typeof l.nonce=="string"?l.nonce:void 0,type:typeof l.type=="string"?l.type:void 0,fetchPriority:typeof l.fetchPriority=="string"?l.fetchPriority:void 0,referrerPolicy:typeof l.referrerPolicy=="string"?l.referrerPolicy:void 0,imageSrcSet:typeof l.imageSrcSet=="string"?l.imageSrcSet:void 0,imageSizes:typeof l.imageSizes=="string"?l.imageSizes:void 0,media:typeof l.media=="string"?l.media:void 0})}},Oi.preloadModule=function(d,l){if(typeof d=="string")if(l){var p=s(l.as,l.crossOrigin);o.d.m(d,{as:typeof l.as=="string"&&l.as!=="script"?l.as:void 0,crossOrigin:p,integrity:typeof l.integrity=="string"?l.integrity:void 0})}else o.d.m(d)},Oi.requestFormReset=function(d){o.d.r(d)},Oi.unstable_batchedUpdates=function(d,l){return d(l)},Oi.useFormState=function(d,l,p){return c.H.useFormState(d,l,p)},Oi.useFormStatus=function(){return c.H.useHostTransitionStatus()},Oi.version="19.2.3",Oi}var mv;function N1(){if(mv)return Gd.exports;mv=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),Gd.exports=M1(),Gd.exports}var gv;function k1(){if(gv)return as;gv=1;var i=I1(),e=Kh(),n=N1();function o(t){var r="https://react.dev/errors/"+t;if(1<arguments.length){r+="?args[]="+encodeURIComponent(arguments[1]);for(var a=2;a<arguments.length;a++)r+="&args[]="+encodeURIComponent(arguments[a])}return"Minified React error #"+t+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function u(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function g(t){var r=t,a=t;if(t.alternate)for(;r.return;)r=r.return;else{t=r;do r=t,(r.flags&4098)!==0&&(a=r.return),t=r.return;while(t)}return r.tag===3?a:null}function c(t){if(t.tag===13){var r=t.memoizedState;if(r===null&&(t=t.alternate,t!==null&&(r=t.memoizedState)),r!==null)return r.dehydrated}return null}function s(t){if(t.tag===31){var r=t.memoizedState;if(r===null&&(t=t.alternate,t!==null&&(r=t.memoizedState)),r!==null)return r.dehydrated}return null}function d(t){if(g(t)!==t)throw Error(o(188))}function l(t){var r=t.alternate;if(!r){if(r=g(t),r===null)throw Error(o(188));return r!==t?null:t}for(var a=t,f=r;;){var D=a.return;if(D===null)break;var I=D.alternate;if(I===null){if(f=D.return,f!==null){a=f;continue}break}if(D.child===I.child){for(I=D.child;I;){if(I===a)return d(D),t;if(I===f)return d(D),r;I=I.sibling}throw Error(o(188))}if(a.return!==f.return)a=D,f=I;else{for(var K=!1,ee=D.child;ee;){if(ee===a){K=!0,a=D,f=I;break}if(ee===f){K=!0,f=D,a=I;break}ee=ee.sibling}if(!K){for(ee=I.child;ee;){if(ee===a){K=!0,a=I,f=D;break}if(ee===f){K=!0,f=I,a=D;break}ee=ee.sibling}if(!K)throw Error(o(189))}}if(a.alternate!==f)throw Error(o(190))}if(a.tag!==3)throw Error(o(188));return a.stateNode.current===a?t:r}function p(t){var r=t.tag;if(r===5||r===26||r===27||r===6)return t;for(t=t.child;t!==null;){if(r=p(t),r!==null)return r;t=t.sibling}return null}var S=Object.assign,T=Symbol.for("react.element"),y=Symbol.for("react.transitional.element"),R=Symbol.for("react.portal"),v=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),m=Symbol.for("react.profiler"),_=Symbol.for("react.consumer"),A=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),b=Symbol.for("react.suspense"),w=Symbol.for("react.suspense_list"),C=Symbol.for("react.memo"),P=Symbol.for("react.lazy"),U=Symbol.for("react.activity"),B=Symbol.for("react.memo_cache_sentinel"),L=Symbol.iterator;function H(t){return t===null||typeof t!="object"?null:(t=L&&t[L]||t["@@iterator"],typeof t=="function"?t:null)}var O=Symbol.for("react.client.reference");function x(t){if(t==null)return null;if(typeof t=="function")return t.$$typeof===O?null:t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case v:return"Fragment";case m:return"Profiler";case h:return"StrictMode";case b:return"Suspense";case w:return"SuspenseList";case U:return"Activity"}if(typeof t=="object")switch(t.$$typeof){case R:return"Portal";case A:return t.displayName||"Context";case _:return(t._context.displayName||"Context")+".Consumer";case E:var r=t.render;return t=t.displayName,t||(t=r.displayName||r.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case C:return r=t.displayName||null,r!==null?r:x(t.type)||"Memo";case P:r=t._payload,t=t._init;try{return x(t(r))}catch{}}return null}var F=Array.isArray,N=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,k=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,M={pending:!1,data:null,method:null,action:null},j=[],G=-1;function z(t){return{current:t}}function V(t){0>G||(t.current=j[G],j[G]=null,G--)}function re(t,r){G++,j[G]=t.current,t.current=r}var Q=z(null),Z=z(null),q=z(null),Y=z(null);function J(t,r){switch(re(q,r),re(Z,t),re(Q,null),r.nodeType){case 9:case 11:t=(t=r.documentElement)&&(t=t.namespaceURI)?Mg(t):0;break;default:if(t=r.tagName,r=r.namespaceURI)r=Mg(r),t=Ng(r,t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}V(Q),re(Q,t)}function $(){V(Q),V(Z),V(q)}function te(t){t.memoizedState!==null&&re(Y,t);var r=Q.current,a=Ng(r,t.type);r!==a&&(re(Z,t),re(Q,a))}function ie(t){Z.current===t&&(V(Q),V(Z)),Y.current===t&&(V(Y),ts._currentValue=M)}var se,he;function de(t){if(se===void 0)try{throw Error()}catch(a){var r=a.stack.trim().match(/\n( *(at )?)/);se=r&&r[1]||"",he=-1<a.stack.indexOf(`
    at`)?" (<anonymous>)":-1<a.stack.indexOf("@")?"@unknown:0:0":""}return`
`+se+t+he}var be=!1;function Re(t,r){if(!t||be)return"";be=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var f={DetermineComponentFrameRoot:function(){try{if(r){var xe=function(){throw Error()};if(Object.defineProperty(xe.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(xe,[])}catch(we){var Ee=we}Reflect.construct(t,[],xe)}else{try{xe.call()}catch(we){Ee=we}t.call(xe.prototype)}}else{try{throw Error()}catch(we){Ee=we}(xe=t())&&typeof xe.catch=="function"&&xe.catch(function(){})}}catch(we){if(we&&Ee&&typeof we.stack=="string")return[we.stack,Ee.stack]}return[null,null]}};f.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var D=Object.getOwnPropertyDescriptor(f.DetermineComponentFrameRoot,"name");D&&D.configurable&&Object.defineProperty(f.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var I=f.DetermineComponentFrameRoot(),K=I[0],ee=I[1];if(K&&ee){var ce=K.split(`
`),Se=ee.split(`
`);for(D=f=0;f<ce.length&&!ce[f].includes("DetermineComponentFrameRoot");)f++;for(;D<Se.length&&!Se[D].includes("DetermineComponentFrameRoot");)D++;if(f===ce.length||D===Se.length)for(f=ce.length-1,D=Se.length-1;1<=f&&0<=D&&ce[f]!==Se[D];)D--;for(;1<=f&&0<=D;f--,D--)if(ce[f]!==Se[D]){if(f!==1||D!==1)do if(f--,D--,0>D||ce[f]!==Se[D]){var Me=`
`+ce[f].replace(" at new "," at ");return t.displayName&&Me.includes("<anonymous>")&&(Me=Me.replace("<anonymous>",t.displayName)),Me}while(1<=f&&0<=D);break}}}finally{be=!1,Error.prepareStackTrace=a}return(a=t?t.displayName||t.name:"")?de(a):""}function Te(t,r){switch(t.tag){case 26:case 27:case 5:return de(t.type);case 16:return de("Lazy");case 13:return t.child!==r&&r!==null?de("Suspense Fallback"):de("Suspense");case 19:return de("SuspenseList");case 0:case 15:return Re(t.type,!1);case 11:return Re(t.type.render,!1);case 1:return Re(t.type,!0);case 31:return de("Activity");default:return""}}function Ae(t){try{var r="",a=null;do r+=Te(t,a),a=t,t=t.return;while(t);return r}catch(f){return`
Error generating stack: `+f.message+`
`+f.stack}}var Ie=Object.prototype.hasOwnProperty,Le=i.unstable_scheduleCallback,Be=i.unstable_cancelCallback,$e=i.unstable_shouldYield,Ne=i.unstable_requestPaint,ze=i.unstable_now,Je=i.unstable_getCurrentPriorityLevel,rt=i.unstable_ImmediatePriority,It=i.unstable_UserBlockingPriority,dt=i.unstable_NormalPriority,Ct=i.unstable_LowPriority,_t=i.unstable_IdlePriority,ft=i.log,pt=i.unstable_setDisableYieldValue,jt=null,yt=null;function Nt(t){if(typeof ft=="function"&&pt(t),yt&&typeof yt.setStrictMode=="function")try{yt.setStrictMode(jt,t)}catch{}}var kt=Math.clz32?Math.clz32:ae,fi=Math.log,X=Math.LN2;function ae(t){return t>>>=0,t===0?32:31-(fi(t)/X|0)|0}var ne=256,oe=262144,fe=4194304;function ve(t){var r=t&42;if(r!==0)return r;switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return t&261888;case 262144:case 524288:case 1048576:case 2097152:return t&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return t&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return t}}function le(t,r,a){var f=t.pendingLanes;if(f===0)return 0;var D=0,I=t.suspendedLanes,K=t.pingedLanes;t=t.warmLanes;var ee=f&134217727;return ee!==0?(f=ee&~I,f!==0?D=ve(f):(K&=ee,K!==0?D=ve(K):a||(a=ee&~t,a!==0&&(D=ve(a))))):(ee=f&~I,ee!==0?D=ve(ee):K!==0?D=ve(K):a||(a=f&~t,a!==0&&(D=ve(a)))),D===0?0:r!==0&&r!==D&&(r&I)===0&&(I=D&-D,a=r&-r,I>=a||I===32&&(a&4194048)!==0)?r:D}function Oe(t,r){return(t.pendingLanes&~(t.suspendedLanes&~t.pingedLanes)&r)===0}function _e(t,r){switch(t){case 1:case 2:case 4:case 8:case 64:return r+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ue(){var t=fe;return fe<<=1,(fe&62914560)===0&&(fe=4194304),t}function Fe(t){for(var r=[],a=0;31>a;a++)r.push(t);return r}function Ke(t,r){t.pendingLanes|=r,r!==268435456&&(t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0)}function nt(t,r,a,f,D,I){var K=t.pendingLanes;t.pendingLanes=a,t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0,t.expiredLanes&=a,t.entangledLanes&=a,t.errorRecoveryDisabledLanes&=a,t.shellSuspendCounter=0;var ee=t.entanglements,ce=t.expirationTimes,Se=t.hiddenUpdates;for(a=K&~a;0<a;){var Me=31-kt(a),xe=1<<Me;ee[Me]=0,ce[Me]=-1;var Ee=Se[Me];if(Ee!==null)for(Se[Me]=null,Me=0;Me<Ee.length;Me++){var we=Ee[Me];we!==null&&(we.lane&=-536870913)}a&=~xe}f!==0&&Ni(t,f,0),I!==0&&D===0&&t.tag!==0&&(t.suspendedLanes|=I&~(K&~r))}function Ni(t,r,a){t.pendingLanes|=r,t.suspendedLanes&=~r;var f=31-kt(r);t.entangledLanes|=r,t.entanglements[f]=t.entanglements[f]|1073741824|a&261930}function Ds(t,r){var a=t.entangledLanes|=r;for(t=t.entanglements;a;){var f=31-kt(a),D=1<<f;D&r|t[f]&r&&(t[f]|=r),a&=~D}}function mf(t,r){var a=r&-r;return a=(a&42)!==0?1:Dl(a),(a&(t.suspendedLanes|r))!==0?0:a}function Dl(t){switch(t){case 2:t=1;break;case 8:t=4;break;case 32:t=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:t=128;break;case 268435456:t=134217728;break;default:t=0}return t}function Ol(t){return t&=-t,2<t?8<t?(t&134217727)!==0?32:268435456:8:2}function gf(){var t=k.p;return t!==0?t:(t=window.event,t===void 0?32:tv(t.type))}function vf(t,r){var a=k.p;try{return k.p=t,r()}finally{k.p=a}}var un=Math.random().toString(36).slice(2),Ri="__reactFiber$"+un,xi="__reactProps$"+un,So="__reactContainer$"+un,Il="__reactEvents$"+un,pb="__reactListeners$"+un,mb="__reactHandles$"+un,yf="__reactResources$"+un,ga="__reactMarker$"+un;function Ml(t){delete t[Ri],delete t[xi],delete t[Il],delete t[pb],delete t[mb]}function bo(t){var r=t[Ri];if(r)return r;for(var a=t.parentNode;a;){if(r=a[So]||a[Ri]){if(a=r.alternate,r.child!==null||a!==null&&a.child!==null)for(t=Vg(t);t!==null;){if(a=t[Ri])return a;t=Vg(t)}return r}t=a,a=t.parentNode}return null}function Eo(t){if(t=t[Ri]||t[So]){var r=t.tag;if(r===5||r===6||r===13||r===31||r===26||r===27||r===3)return t}return null}function va(t){var r=t.tag;if(r===5||r===26||r===27||r===6)return t.stateNode;throw Error(o(33))}function Ro(t){var r=t[yf];return r||(r=t[yf]={hoistableStyles:new Map,hoistableScripts:new Map}),r}function yi(t){t[ga]=!0}var Sf=new Set,bf={};function Fn(t,r){_o(t,r),_o(t+"Capture",r)}function _o(t,r){for(bf[t]=r,t=0;t<r.length;t++)Sf.add(r[t])}var gb=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Ef={},Rf={};function vb(t){return Ie.call(Rf,t)?!0:Ie.call(Ef,t)?!1:gb.test(t)?Rf[t]=!0:(Ef[t]=!0,!1)}function Os(t,r,a){if(vb(r))if(a===null)t.removeAttribute(r);else{switch(typeof a){case"undefined":case"function":case"symbol":t.removeAttribute(r);return;case"boolean":var f=r.toLowerCase().slice(0,5);if(f!=="data-"&&f!=="aria-"){t.removeAttribute(r);return}}t.setAttribute(r,""+a)}}function Is(t,r,a){if(a===null)t.removeAttribute(r);else{switch(typeof a){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(r);return}t.setAttribute(r,""+a)}}function Hr(t,r,a,f){if(f===null)t.removeAttribute(a);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(a);return}t.setAttributeNS(r,a,""+f)}}function or(t){switch(typeof t){case"bigint":case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function _f(t){var r=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function yb(t,r,a){var f=Object.getOwnPropertyDescriptor(t.constructor.prototype,r);if(!t.hasOwnProperty(r)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var D=f.get,I=f.set;return Object.defineProperty(t,r,{configurable:!0,get:function(){return D.call(this)},set:function(K){a=""+K,I.call(this,K)}}),Object.defineProperty(t,r,{enumerable:f.enumerable}),{getValue:function(){return a},setValue:function(K){a=""+K},stopTracking:function(){t._valueTracker=null,delete t[r]}}}}function Nl(t){if(!t._valueTracker){var r=_f(t)?"checked":"value";t._valueTracker=yb(t,r,""+t[r])}}function Tf(t){if(!t)return!1;var r=t._valueTracker;if(!r)return!0;var a=r.getValue(),f="";return t&&(f=_f(t)?t.checked?"true":"false":t.value),t=f,t!==a?(r.setValue(t),!0):!1}function Ms(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}var Sb=/[\n"\\]/g;function ar(t){return t.replace(Sb,function(r){return"\\"+r.charCodeAt(0).toString(16)+" "})}function kl(t,r,a,f,D,I,K,ee){t.name="",K!=null&&typeof K!="function"&&typeof K!="symbol"&&typeof K!="boolean"?t.type=K:t.removeAttribute("type"),r!=null?K==="number"?(r===0&&t.value===""||t.value!=r)&&(t.value=""+or(r)):t.value!==""+or(r)&&(t.value=""+or(r)):K!=="submit"&&K!=="reset"||t.removeAttribute("value"),r!=null?Pl(t,K,or(r)):a!=null?Pl(t,K,or(a)):f!=null&&t.removeAttribute("value"),D==null&&I!=null&&(t.defaultChecked=!!I),D!=null&&(t.checked=D&&typeof D!="function"&&typeof D!="symbol"),ee!=null&&typeof ee!="function"&&typeof ee!="symbol"&&typeof ee!="boolean"?t.name=""+or(ee):t.removeAttribute("name")}function Af(t,r,a,f,D,I,K,ee){if(I!=null&&typeof I!="function"&&typeof I!="symbol"&&typeof I!="boolean"&&(t.type=I),r!=null||a!=null){if(!(I!=="submit"&&I!=="reset"||r!=null)){Nl(t);return}a=a!=null?""+or(a):"",r=r!=null?""+or(r):a,ee||r===t.value||(t.value=r),t.defaultValue=r}f=f??D,f=typeof f!="function"&&typeof f!="symbol"&&!!f,t.checked=ee?t.checked:!!f,t.defaultChecked=!!f,K!=null&&typeof K!="function"&&typeof K!="symbol"&&typeof K!="boolean"&&(t.name=K),Nl(t)}function Pl(t,r,a){r==="number"&&Ms(t.ownerDocument)===t||t.defaultValue===""+a||(t.defaultValue=""+a)}function To(t,r,a,f){if(t=t.options,r){r={};for(var D=0;D<a.length;D++)r["$"+a[D]]=!0;for(a=0;a<t.length;a++)D=r.hasOwnProperty("$"+t[a].value),t[a].selected!==D&&(t[a].selected=D),D&&f&&(t[a].defaultSelected=!0)}else{for(a=""+or(a),r=null,D=0;D<t.length;D++){if(t[D].value===a){t[D].selected=!0,f&&(t[D].defaultSelected=!0);return}r!==null||t[D].disabled||(r=t[D])}r!==null&&(r.selected=!0)}}function Cf(t,r,a){if(r!=null&&(r=""+or(r),r!==t.value&&(t.value=r),a==null)){t.defaultValue!==r&&(t.defaultValue=r);return}t.defaultValue=a!=null?""+or(a):""}function wf(t,r,a,f){if(r==null){if(f!=null){if(a!=null)throw Error(o(92));if(F(f)){if(1<f.length)throw Error(o(93));f=f[0]}a=f}a==null&&(a=""),r=a}a=or(r),t.defaultValue=a,f=t.textContent,f===a&&f!==""&&f!==null&&(t.value=f),Nl(t)}function Ao(t,r){if(r){var a=t.firstChild;if(a&&a===t.lastChild&&a.nodeType===3){a.nodeValue=r;return}}t.textContent=r}var bb=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Df(t,r,a){var f=r.indexOf("--")===0;a==null||typeof a=="boolean"||a===""?f?t.setProperty(r,""):r==="float"?t.cssFloat="":t[r]="":f?t.setProperty(r,a):typeof a!="number"||a===0||bb.has(r)?r==="float"?t.cssFloat=a:t[r]=(""+a).trim():t[r]=a+"px"}function Of(t,r,a){if(r!=null&&typeof r!="object")throw Error(o(62));if(t=t.style,a!=null){for(var f in a)!a.hasOwnProperty(f)||r!=null&&r.hasOwnProperty(f)||(f.indexOf("--")===0?t.setProperty(f,""):f==="float"?t.cssFloat="":t[f]="");for(var D in r)f=r[D],r.hasOwnProperty(D)&&a[D]!==f&&Df(t,D,f)}else for(var I in r)r.hasOwnProperty(I)&&Df(t,I,r[I])}function Ll(t){if(t.indexOf("-")===-1)return!1;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Eb=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Rb=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ns(t){return Rb.test(""+t)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":t}function jr(){}var Ul=null;function xl(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Co=null,wo=null;function If(t){var r=Eo(t);if(r&&(t=r.stateNode)){var a=t[xi]||null;e:switch(t=r.stateNode,r.type){case"input":if(kl(t,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name),r=a.name,a.type==="radio"&&r!=null){for(a=t;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll('input[name="'+ar(""+r)+'"][type="radio"]'),r=0;r<a.length;r++){var f=a[r];if(f!==t&&f.form===t.form){var D=f[xi]||null;if(!D)throw Error(o(90));kl(f,D.value,D.defaultValue,D.defaultValue,D.checked,D.defaultChecked,D.type,D.name)}}for(r=0;r<a.length;r++)f=a[r],f.form===t.form&&Tf(f)}break e;case"textarea":Cf(t,a.value,a.defaultValue);break e;case"select":r=a.value,r!=null&&To(t,!!a.multiple,r,!1)}}}var Bl=!1;function Mf(t,r,a){if(Bl)return t(r,a);Bl=!0;try{var f=t(r);return f}finally{if(Bl=!1,(Co!==null||wo!==null)&&(Sc(),Co&&(r=Co,t=wo,wo=Co=null,If(r),t)))for(r=0;r<t.length;r++)If(t[r])}}function ya(t,r){var a=t.stateNode;if(a===null)return null;var f=a[xi]||null;if(f===null)return null;a=f[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(t=t.type,f=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!f;break e;default:t=!1}if(t)return null;if(a&&typeof a!="function")throw Error(o(231,r,typeof a));return a}var zr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Vl=!1;if(zr)try{var Sa={};Object.defineProperty(Sa,"passive",{get:function(){Vl=!0}}),window.addEventListener("test",Sa,Sa),window.removeEventListener("test",Sa,Sa)}catch{Vl=!1}var dn=null,Hl=null,ks=null;function Nf(){if(ks)return ks;var t,r=Hl,a=r.length,f,D="value"in dn?dn.value:dn.textContent,I=D.length;for(t=0;t<a&&r[t]===D[t];t++);var K=a-t;for(f=1;f<=K&&r[a-f]===D[I-f];f++);return ks=D.slice(t,1<f?1-f:void 0)}function Ps(t){var r=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&r===13&&(t=13)):t=r,t===10&&(t=13),32<=t||t===13?t:0}function Ls(){return!0}function kf(){return!1}function Bi(t){function r(a,f,D,I,K){this._reactName=a,this._targetInst=D,this.type=f,this.nativeEvent=I,this.target=K,this.currentTarget=null;for(var ee in t)t.hasOwnProperty(ee)&&(a=t[ee],this[ee]=a?a(I):I[ee]);return this.isDefaultPrevented=(I.defaultPrevented!=null?I.defaultPrevented:I.returnValue===!1)?Ls:kf,this.isPropagationStopped=kf,this}return S(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=Ls)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=Ls)},persist:function(){},isPersistent:Ls}),r}var Gn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Us=Bi(Gn),ba=S({},Gn,{view:0,detail:0}),_b=Bi(ba),jl,zl,Ea,xs=S({},ba,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Gl,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Ea&&(Ea&&t.type==="mousemove"?(jl=t.screenX-Ea.screenX,zl=t.screenY-Ea.screenY):zl=jl=0,Ea=t),jl)},movementY:function(t){return"movementY"in t?t.movementY:zl}}),Pf=Bi(xs),Tb=S({},xs,{dataTransfer:0}),Ab=Bi(Tb),Cb=S({},ba,{relatedTarget:0}),Fl=Bi(Cb),wb=S({},Gn,{animationName:0,elapsedTime:0,pseudoElement:0}),Db=Bi(wb),Ob=S({},Gn,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Ib=Bi(Ob),Mb=S({},Gn,{data:0}),Lf=Bi(Mb),Nb={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},kb={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Pb={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Lb(t){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(t):(t=Pb[t])?!!r[t]:!1}function Gl(){return Lb}var Ub=S({},ba,{key:function(t){if(t.key){var r=Nb[t.key]||t.key;if(r!=="Unidentified")return r}return t.type==="keypress"?(t=Ps(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?kb[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Gl,charCode:function(t){return t.type==="keypress"?Ps(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Ps(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),xb=Bi(Ub),Bb=S({},xs,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Uf=Bi(Bb),Vb=S({},ba,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Gl}),Hb=Bi(Vb),jb=S({},Gn,{propertyName:0,elapsedTime:0,pseudoElement:0}),zb=Bi(jb),Fb=S({},xs,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Gb=Bi(Fb),Wb=S({},Gn,{newState:0,oldState:0}),qb=Bi(Wb),Kb=[9,13,27,32],Wl=zr&&"CompositionEvent"in window,Ra=null;zr&&"documentMode"in document&&(Ra=document.documentMode);var Yb=zr&&"TextEvent"in window&&!Ra,xf=zr&&(!Wl||Ra&&8<Ra&&11>=Ra),Bf=" ",Vf=!1;function Hf(t,r){switch(t){case"keyup":return Kb.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function jf(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Do=!1;function Xb(t,r){switch(t){case"compositionend":return jf(r);case"keypress":return r.which!==32?null:(Vf=!0,Bf);case"textInput":return t=r.data,t===Bf&&Vf?null:t;default:return null}}function Jb(t,r){if(Do)return t==="compositionend"||!Wl&&Hf(t,r)?(t=Nf(),ks=Hl=dn=null,Do=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return xf&&r.locale!=="ko"?null:r.data;default:return null}}var Qb={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function zf(t){var r=t&&t.nodeName&&t.nodeName.toLowerCase();return r==="input"?!!Qb[t.type]:r==="textarea"}function Ff(t,r,a,f){Co?wo?wo.push(f):wo=[f]:Co=f,r=Cc(r,"onChange"),0<r.length&&(a=new Us("onChange","change",null,a,f),t.push({event:a,listeners:r}))}var _a=null,Ta=null;function $b(t){Ag(t,0)}function Bs(t){var r=va(t);if(Tf(r))return t}function Gf(t,r){if(t==="change")return r}var Wf=!1;if(zr){var ql;if(zr){var Kl="oninput"in document;if(!Kl){var qf=document.createElement("div");qf.setAttribute("oninput","return;"),Kl=typeof qf.oninput=="function"}ql=Kl}else ql=!1;Wf=ql&&(!document.documentMode||9<document.documentMode)}function Kf(){_a&&(_a.detachEvent("onpropertychange",Yf),Ta=_a=null)}function Yf(t){if(t.propertyName==="value"&&Bs(Ta)){var r=[];Ff(r,Ta,t,xl(t)),Mf($b,r)}}function Zb(t,r,a){t==="focusin"?(Kf(),_a=r,Ta=a,_a.attachEvent("onpropertychange",Yf)):t==="focusout"&&Kf()}function eE(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Bs(Ta)}function tE(t,r){if(t==="click")return Bs(r)}function iE(t,r){if(t==="input"||t==="change")return Bs(r)}function rE(t,r){return t===r&&(t!==0||1/t===1/r)||t!==t&&r!==r}var Xi=typeof Object.is=="function"?Object.is:rE;function Aa(t,r){if(Xi(t,r))return!0;if(typeof t!="object"||t===null||typeof r!="object"||r===null)return!1;var a=Object.keys(t),f=Object.keys(r);if(a.length!==f.length)return!1;for(f=0;f<a.length;f++){var D=a[f];if(!Ie.call(r,D)||!Xi(t[D],r[D]))return!1}return!0}function Xf(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Jf(t,r){var a=Xf(t);t=0;for(var f;a;){if(a.nodeType===3){if(f=t+a.textContent.length,t<=r&&f>=r)return{node:a,offset:r-t};t=f}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=Xf(a)}}function Qf(t,r){return t&&r?t===r?!0:t&&t.nodeType===3?!1:r&&r.nodeType===3?Qf(t,r.parentNode):"contains"in t?t.contains(r):t.compareDocumentPosition?!!(t.compareDocumentPosition(r)&16):!1:!1}function $f(t){t=t!=null&&t.ownerDocument!=null&&t.ownerDocument.defaultView!=null?t.ownerDocument.defaultView:window;for(var r=Ms(t.document);r instanceof t.HTMLIFrameElement;){try{var a=typeof r.contentWindow.location.href=="string"}catch{a=!1}if(a)t=r.contentWindow;else break;r=Ms(t.document)}return r}function Yl(t){var r=t&&t.nodeName&&t.nodeName.toLowerCase();return r&&(r==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||r==="textarea"||t.contentEditable==="true")}var nE=zr&&"documentMode"in document&&11>=document.documentMode,Oo=null,Xl=null,Ca=null,Jl=!1;function Zf(t,r,a){var f=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;Jl||Oo==null||Oo!==Ms(f)||(f=Oo,"selectionStart"in f&&Yl(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),Ca&&Aa(Ca,f)||(Ca=f,f=Cc(Xl,"onSelect"),0<f.length&&(r=new Us("onSelect","select",null,r,a),t.push({event:r,listeners:f}),r.target=Oo)))}function Wn(t,r){var a={};return a[t.toLowerCase()]=r.toLowerCase(),a["Webkit"+t]="webkit"+r,a["Moz"+t]="moz"+r,a}var Io={animationend:Wn("Animation","AnimationEnd"),animationiteration:Wn("Animation","AnimationIteration"),animationstart:Wn("Animation","AnimationStart"),transitionrun:Wn("Transition","TransitionRun"),transitionstart:Wn("Transition","TransitionStart"),transitioncancel:Wn("Transition","TransitionCancel"),transitionend:Wn("Transition","TransitionEnd")},Ql={},ep={};zr&&(ep=document.createElement("div").style,"AnimationEvent"in window||(delete Io.animationend.animation,delete Io.animationiteration.animation,delete Io.animationstart.animation),"TransitionEvent"in window||delete Io.transitionend.transition);function qn(t){if(Ql[t])return Ql[t];if(!Io[t])return t;var r=Io[t],a;for(a in r)if(r.hasOwnProperty(a)&&a in ep)return Ql[t]=r[a];return t}var tp=qn("animationend"),ip=qn("animationiteration"),rp=qn("animationstart"),oE=qn("transitionrun"),aE=qn("transitionstart"),sE=qn("transitioncancel"),np=qn("transitionend"),op=new Map,$l="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");$l.push("scrollEnd");function Rr(t,r){op.set(t,r),Fn(r,[t])}var Vs=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var r=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(r))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)},sr=[],Mo=0,Zl=0;function Hs(){for(var t=Mo,r=Zl=Mo=0;r<t;){var a=sr[r];sr[r++]=null;var f=sr[r];sr[r++]=null;var D=sr[r];sr[r++]=null;var I=sr[r];if(sr[r++]=null,f!==null&&D!==null){var K=f.pending;K===null?D.next=D:(D.next=K.next,K.next=D),f.pending=D}I!==0&&ap(a,D,I)}}function js(t,r,a,f){sr[Mo++]=t,sr[Mo++]=r,sr[Mo++]=a,sr[Mo++]=f,Zl|=f,t.lanes|=f,t=t.alternate,t!==null&&(t.lanes|=f)}function eu(t,r,a,f){return js(t,r,a,f),zs(t)}function Kn(t,r){return js(t,null,null,r),zs(t)}function ap(t,r,a){t.lanes|=a;var f=t.alternate;f!==null&&(f.lanes|=a);for(var D=!1,I=t.return;I!==null;)I.childLanes|=a,f=I.alternate,f!==null&&(f.childLanes|=a),I.tag===22&&(t=I.stateNode,t===null||t._visibility&1||(D=!0)),t=I,I=I.return;return t.tag===3?(I=t.stateNode,D&&r!==null&&(D=31-kt(a),t=I.hiddenUpdates,f=t[D],f===null?t[D]=[r]:f.push(r),r.lane=a|536870912),I):null}function zs(t){if(50<Ya)throw Ya=0,ld=null,Error(o(185));for(var r=t.return;r!==null;)t=r,r=t.return;return t.tag===3?t.stateNode:null}var No={};function cE(t,r,a,f){this.tag=t,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ji(t,r,a,f){return new cE(t,r,a,f)}function tu(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Fr(t,r){var a=t.alternate;return a===null?(a=Ji(t.tag,r,t.key,t.mode),a.elementType=t.elementType,a.type=t.type,a.stateNode=t.stateNode,a.alternate=t,t.alternate=a):(a.pendingProps=r,a.type=t.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=t.flags&65011712,a.childLanes=t.childLanes,a.lanes=t.lanes,a.child=t.child,a.memoizedProps=t.memoizedProps,a.memoizedState=t.memoizedState,a.updateQueue=t.updateQueue,r=t.dependencies,a.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},a.sibling=t.sibling,a.index=t.index,a.ref=t.ref,a.refCleanup=t.refCleanup,a}function sp(t,r){t.flags&=65011714;var a=t.alternate;return a===null?(t.childLanes=0,t.lanes=r,t.child=null,t.subtreeFlags=0,t.memoizedProps=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.stateNode=null):(t.childLanes=a.childLanes,t.lanes=a.lanes,t.child=a.child,t.subtreeFlags=0,t.deletions=null,t.memoizedProps=a.memoizedProps,t.memoizedState=a.memoizedState,t.updateQueue=a.updateQueue,t.type=a.type,r=a.dependencies,t.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),t}function Fs(t,r,a,f,D,I){var K=0;if(f=t,typeof t=="function")tu(t)&&(K=1);else if(typeof t=="string")K=f1(t,a,Q.current)?26:t==="html"||t==="head"||t==="body"?27:5;else e:switch(t){case U:return t=Ji(31,a,r,D),t.elementType=U,t.lanes=I,t;case v:return Yn(a.children,D,I,r);case h:K=8,D|=24;break;case m:return t=Ji(12,a,r,D|2),t.elementType=m,t.lanes=I,t;case b:return t=Ji(13,a,r,D),t.elementType=b,t.lanes=I,t;case w:return t=Ji(19,a,r,D),t.elementType=w,t.lanes=I,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case A:K=10;break e;case _:K=9;break e;case E:K=11;break e;case C:K=14;break e;case P:K=16,f=null;break e}K=29,a=Error(o(130,t===null?"null":typeof t,"")),f=null}return r=Ji(K,a,r,D),r.elementType=t,r.type=f,r.lanes=I,r}function Yn(t,r,a,f){return t=Ji(7,t,f,r),t.lanes=a,t}function iu(t,r,a){return t=Ji(6,t,null,r),t.lanes=a,t}function cp(t){var r=Ji(18,null,null,0);return r.stateNode=t,r}function ru(t,r,a){return r=Ji(4,t.children!==null?t.children:[],t.key,r),r.lanes=a,r.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},r}var lp=new WeakMap;function cr(t,r){if(typeof t=="object"&&t!==null){var a=lp.get(t);return a!==void 0?a:(r={value:t,source:r,stack:Ae(r)},lp.set(t,r),r)}return{value:t,source:r,stack:Ae(r)}}var ko=[],Po=0,Gs=null,wa=0,lr=[],ur=0,hn=null,Ir=1,Mr="";function Gr(t,r){ko[Po++]=wa,ko[Po++]=Gs,Gs=t,wa=r}function up(t,r,a){lr[ur++]=Ir,lr[ur++]=Mr,lr[ur++]=hn,hn=t;var f=Ir;t=Mr;var D=32-kt(f)-1;f&=~(1<<D),a+=1;var I=32-kt(r)+D;if(30<I){var K=D-D%5;I=(f&(1<<K)-1).toString(32),f>>=K,D-=K,Ir=1<<32-kt(r)+D|a<<D|f,Mr=I+t}else Ir=1<<I|a<<D|f,Mr=t}function nu(t){t.return!==null&&(Gr(t,1),up(t,1,0))}function ou(t){for(;t===Gs;)Gs=ko[--Po],ko[Po]=null,wa=ko[--Po],ko[Po]=null;for(;t===hn;)hn=lr[--ur],lr[ur]=null,Mr=lr[--ur],lr[ur]=null,Ir=lr[--ur],lr[ur]=null}function dp(t,r){lr[ur++]=Ir,lr[ur++]=Mr,lr[ur++]=hn,Ir=r.id,Mr=r.overflow,hn=t}var _i=null,Kt=null,Tt=!1,fn=null,dr=!1,au=Error(o(519));function pn(t){var r=Error(o(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Da(cr(r,t)),au}function hp(t){var r=t.stateNode,a=t.type,f=t.memoizedProps;switch(r[Ri]=t,r[xi]=f,a){case"dialog":gt("cancel",r),gt("close",r);break;case"iframe":case"object":case"embed":gt("load",r);break;case"video":case"audio":for(a=0;a<Ja.length;a++)gt(Ja[a],r);break;case"source":gt("error",r);break;case"img":case"image":case"link":gt("error",r),gt("load",r);break;case"details":gt("toggle",r);break;case"input":gt("invalid",r),Af(r,f.value,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name,!0);break;case"select":gt("invalid",r);break;case"textarea":gt("invalid",r),wf(r,f.value,f.defaultValue,f.children)}a=f.children,typeof a!="string"&&typeof a!="number"&&typeof a!="bigint"||r.textContent===""+a||f.suppressHydrationWarning===!0||Og(r.textContent,a)?(f.popover!=null&&(gt("beforetoggle",r),gt("toggle",r)),f.onScroll!=null&&gt("scroll",r),f.onScrollEnd!=null&&gt("scrollend",r),f.onClick!=null&&(r.onclick=jr),r=!0):r=!1,r||pn(t,!0)}function fp(t){for(_i=t.return;_i;)switch(_i.tag){case 5:case 31:case 13:dr=!1;return;case 27:case 3:dr=!0;return;default:_i=_i.return}}function Lo(t){if(t!==_i)return!1;if(!Tt)return fp(t),Tt=!0,!1;var r=t.tag,a;if((a=r!==3&&r!==27)&&((a=r===5)&&(a=t.type,a=!(a!=="form"&&a!=="button")||Td(t.type,t.memoizedProps)),a=!a),a&&Kt&&pn(t),fp(t),r===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(o(317));Kt=Bg(t)}else if(r===31){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(o(317));Kt=Bg(t)}else r===27?(r=Kt,Dn(t.type)?(t=Od,Od=null,Kt=t):Kt=r):Kt=_i?fr(t.stateNode.nextSibling):null;return!0}function Xn(){Kt=_i=null,Tt=!1}function su(){var t=fn;return t!==null&&(zi===null?zi=t:zi.push.apply(zi,t),fn=null),t}function Da(t){fn===null?fn=[t]:fn.push(t)}var cu=z(null),Jn=null,Wr=null;function mn(t,r,a){re(cu,r._currentValue),r._currentValue=a}function qr(t){t._currentValue=cu.current,V(cu)}function lu(t,r,a){for(;t!==null;){var f=t.alternate;if((t.childLanes&r)!==r?(t.childLanes|=r,f!==null&&(f.childLanes|=r)):f!==null&&(f.childLanes&r)!==r&&(f.childLanes|=r),t===a)break;t=t.return}}function uu(t,r,a,f){var D=t.child;for(D!==null&&(D.return=t);D!==null;){var I=D.dependencies;if(I!==null){var K=D.child;I=I.firstContext;e:for(;I!==null;){var ee=I;I=D;for(var ce=0;ce<r.length;ce++)if(ee.context===r[ce]){I.lanes|=a,ee=I.alternate,ee!==null&&(ee.lanes|=a),lu(I.return,a,t),f||(K=null);break e}I=ee.next}}else if(D.tag===18){if(K=D.return,K===null)throw Error(o(341));K.lanes|=a,I=K.alternate,I!==null&&(I.lanes|=a),lu(K,a,t),K=null}else K=D.child;if(K!==null)K.return=D;else for(K=D;K!==null;){if(K===t){K=null;break}if(D=K.sibling,D!==null){D.return=K.return,K=D;break}K=K.return}D=K}}function Uo(t,r,a,f){t=null;for(var D=r,I=!1;D!==null;){if(!I){if((D.flags&524288)!==0)I=!0;else if((D.flags&262144)!==0)break}if(D.tag===10){var K=D.alternate;if(K===null)throw Error(o(387));if(K=K.memoizedProps,K!==null){var ee=D.type;Xi(D.pendingProps.value,K.value)||(t!==null?t.push(ee):t=[ee])}}else if(D===Y.current){if(K=D.alternate,K===null)throw Error(o(387));K.memoizedState.memoizedState!==D.memoizedState.memoizedState&&(t!==null?t.push(ts):t=[ts])}D=D.return}t!==null&&uu(r,t,a,f),r.flags|=262144}function Ws(t){for(t=t.firstContext;t!==null;){if(!Xi(t.context._currentValue,t.memoizedValue))return!0;t=t.next}return!1}function Qn(t){Jn=t,Wr=null,t=t.dependencies,t!==null&&(t.firstContext=null)}function Ti(t){return pp(Jn,t)}function qs(t,r){return Jn===null&&Qn(t),pp(t,r)}function pp(t,r){var a=r._currentValue;if(r={context:r,memoizedValue:a,next:null},Wr===null){if(t===null)throw Error(o(308));Wr=r,t.dependencies={lanes:0,firstContext:r},t.flags|=524288}else Wr=Wr.next=r;return a}var lE=typeof AbortController<"u"?AbortController:function(){var t=[],r=this.signal={aborted:!1,addEventListener:function(a,f){t.push(f)}};this.abort=function(){r.aborted=!0,t.forEach(function(a){return a()})}},uE=i.unstable_scheduleCallback,dE=i.unstable_NormalPriority,ni={$$typeof:A,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function du(){return{controller:new lE,data:new Map,refCount:0}}function Oa(t){t.refCount--,t.refCount===0&&uE(dE,function(){t.controller.abort()})}var Ia=null,hu=0,xo=0,Bo=null;function hE(t,r){if(Ia===null){var a=Ia=[];hu=0,xo=md(),Bo={status:"pending",value:void 0,then:function(f){a.push(f)}}}return hu++,r.then(mp,mp),r}function mp(){if(--hu===0&&Ia!==null){Bo!==null&&(Bo.status="fulfilled");var t=Ia;Ia=null,xo=0,Bo=null;for(var r=0;r<t.length;r++)(0,t[r])()}}function fE(t,r){var a=[],f={status:"pending",value:null,reason:null,then:function(D){a.push(D)}};return t.then(function(){f.status="fulfilled",f.value=r;for(var D=0;D<a.length;D++)(0,a[D])(r)},function(D){for(f.status="rejected",f.reason=D,D=0;D<a.length;D++)(0,a[D])(void 0)}),f}var gp=N.S;N.S=function(t,r){Zm=ze(),typeof r=="object"&&r!==null&&typeof r.then=="function"&&hE(t,r),gp!==null&&gp(t,r)};var $n=z(null);function fu(){var t=$n.current;return t!==null?t:zt.pooledCache}function Ks(t,r){r===null?re($n,$n.current):re($n,r.pool)}function vp(){var t=fu();return t===null?null:{parent:ni._currentValue,pool:t}}var Vo=Error(o(460)),pu=Error(o(474)),Ys=Error(o(542)),Xs={then:function(){}};function yp(t){return t=t.status,t==="fulfilled"||t==="rejected"}function Sp(t,r,a){switch(a=t[a],a===void 0?t.push(r):a!==r&&(r.then(jr,jr),r=a),r.status){case"fulfilled":return r.value;case"rejected":throw t=r.reason,Ep(t),t;default:if(typeof r.status=="string")r.then(jr,jr);else{if(t=zt,t!==null&&100<t.shellSuspendCounter)throw Error(o(482));t=r,t.status="pending",t.then(function(f){if(r.status==="pending"){var D=r;D.status="fulfilled",D.value=f}},function(f){if(r.status==="pending"){var D=r;D.status="rejected",D.reason=f}})}switch(r.status){case"fulfilled":return r.value;case"rejected":throw t=r.reason,Ep(t),t}throw eo=r,Vo}}function Zn(t){try{var r=t._init;return r(t._payload)}catch(a){throw a!==null&&typeof a=="object"&&typeof a.then=="function"?(eo=a,Vo):a}}var eo=null;function bp(){if(eo===null)throw Error(o(459));var t=eo;return eo=null,t}function Ep(t){if(t===Vo||t===Ys)throw Error(o(483))}var Ho=null,Ma=0;function Js(t){var r=Ma;return Ma+=1,Ho===null&&(Ho=[]),Sp(Ho,t,r)}function Na(t,r){r=r.props.ref,t.ref=r!==void 0?r:null}function Qs(t,r){throw r.$$typeof===T?Error(o(525)):(t=Object.prototype.toString.call(r),Error(o(31,t==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":t)))}function Rp(t){function r(me,ue){if(t){var ye=me.deletions;ye===null?(me.deletions=[ue],me.flags|=16):ye.push(ue)}}function a(me,ue){if(!t)return null;for(;ue!==null;)r(me,ue),ue=ue.sibling;return null}function f(me){for(var ue=new Map;me!==null;)me.key!==null?ue.set(me.key,me):ue.set(me.index,me),me=me.sibling;return ue}function D(me,ue){return me=Fr(me,ue),me.index=0,me.sibling=null,me}function I(me,ue,ye){return me.index=ye,t?(ye=me.alternate,ye!==null?(ye=ye.index,ye<ue?(me.flags|=67108866,ue):ye):(me.flags|=67108866,ue)):(me.flags|=1048576,ue)}function K(me){return t&&me.alternate===null&&(me.flags|=67108866),me}function ee(me,ue,ye,Pe){return ue===null||ue.tag!==6?(ue=iu(ye,me.mode,Pe),ue.return=me,ue):(ue=D(ue,ye),ue.return=me,ue)}function ce(me,ue,ye,Pe){var et=ye.type;return et===v?Me(me,ue,ye.props.children,Pe,ye.key):ue!==null&&(ue.elementType===et||typeof et=="object"&&et!==null&&et.$$typeof===P&&Zn(et)===ue.type)?(ue=D(ue,ye.props),Na(ue,ye),ue.return=me,ue):(ue=Fs(ye.type,ye.key,ye.props,null,me.mode,Pe),Na(ue,ye),ue.return=me,ue)}function Se(me,ue,ye,Pe){return ue===null||ue.tag!==4||ue.stateNode.containerInfo!==ye.containerInfo||ue.stateNode.implementation!==ye.implementation?(ue=ru(ye,me.mode,Pe),ue.return=me,ue):(ue=D(ue,ye.children||[]),ue.return=me,ue)}function Me(me,ue,ye,Pe,et){return ue===null||ue.tag!==7?(ue=Yn(ye,me.mode,Pe,et),ue.return=me,ue):(ue=D(ue,ye),ue.return=me,ue)}function xe(me,ue,ye){if(typeof ue=="string"&&ue!==""||typeof ue=="number"||typeof ue=="bigint")return ue=iu(""+ue,me.mode,ye),ue.return=me,ue;if(typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case y:return ye=Fs(ue.type,ue.key,ue.props,null,me.mode,ye),Na(ye,ue),ye.return=me,ye;case R:return ue=ru(ue,me.mode,ye),ue.return=me,ue;case P:return ue=Zn(ue),xe(me,ue,ye)}if(F(ue)||H(ue))return ue=Yn(ue,me.mode,ye,null),ue.return=me,ue;if(typeof ue.then=="function")return xe(me,Js(ue),ye);if(ue.$$typeof===A)return xe(me,qs(me,ue),ye);Qs(me,ue)}return null}function Ee(me,ue,ye,Pe){var et=ue!==null?ue.key:null;if(typeof ye=="string"&&ye!==""||typeof ye=="number"||typeof ye=="bigint")return et!==null?null:ee(me,ue,""+ye,Pe);if(typeof ye=="object"&&ye!==null){switch(ye.$$typeof){case y:return ye.key===et?ce(me,ue,ye,Pe):null;case R:return ye.key===et?Se(me,ue,ye,Pe):null;case P:return ye=Zn(ye),Ee(me,ue,ye,Pe)}if(F(ye)||H(ye))return et!==null?null:Me(me,ue,ye,Pe,null);if(typeof ye.then=="function")return Ee(me,ue,Js(ye),Pe);if(ye.$$typeof===A)return Ee(me,ue,qs(me,ye),Pe);Qs(me,ye)}return null}function we(me,ue,ye,Pe,et){if(typeof Pe=="string"&&Pe!==""||typeof Pe=="number"||typeof Pe=="bigint")return me=me.get(ye)||null,ee(ue,me,""+Pe,et);if(typeof Pe=="object"&&Pe!==null){switch(Pe.$$typeof){case y:return me=me.get(Pe.key===null?ye:Pe.key)||null,ce(ue,me,Pe,et);case R:return me=me.get(Pe.key===null?ye:Pe.key)||null,Se(ue,me,Pe,et);case P:return Pe=Zn(Pe),we(me,ue,ye,Pe,et)}if(F(Pe)||H(Pe))return me=me.get(ye)||null,Me(ue,me,Pe,et,null);if(typeof Pe.then=="function")return we(me,ue,ye,Js(Pe),et);if(Pe.$$typeof===A)return we(me,ue,ye,qs(ue,Pe),et);Qs(ue,Pe)}return null}function Xe(me,ue,ye,Pe){for(var et=null,Dt=null,Ze=ue,lt=ue=0,bt=null;Ze!==null&&lt<ye.length;lt++){Ze.index>lt?(bt=Ze,Ze=null):bt=Ze.sibling;var Ot=Ee(me,Ze,ye[lt],Pe);if(Ot===null){Ze===null&&(Ze=bt);break}t&&Ze&&Ot.alternate===null&&r(me,Ze),ue=I(Ot,ue,lt),Dt===null?et=Ot:Dt.sibling=Ot,Dt=Ot,Ze=bt}if(lt===ye.length)return a(me,Ze),Tt&&Gr(me,lt),et;if(Ze===null){for(;lt<ye.length;lt++)Ze=xe(me,ye[lt],Pe),Ze!==null&&(ue=I(Ze,ue,lt),Dt===null?et=Ze:Dt.sibling=Ze,Dt=Ze);return Tt&&Gr(me,lt),et}for(Ze=f(Ze);lt<ye.length;lt++)bt=we(Ze,me,lt,ye[lt],Pe),bt!==null&&(t&&bt.alternate!==null&&Ze.delete(bt.key===null?lt:bt.key),ue=I(bt,ue,lt),Dt===null?et=bt:Dt.sibling=bt,Dt=bt);return t&&Ze.forEach(function(kn){return r(me,kn)}),Tt&&Gr(me,lt),et}function it(me,ue,ye,Pe){if(ye==null)throw Error(o(151));for(var et=null,Dt=null,Ze=ue,lt=ue=0,bt=null,Ot=ye.next();Ze!==null&&!Ot.done;lt++,Ot=ye.next()){Ze.index>lt?(bt=Ze,Ze=null):bt=Ze.sibling;var kn=Ee(me,Ze,Ot.value,Pe);if(kn===null){Ze===null&&(Ze=bt);break}t&&Ze&&kn.alternate===null&&r(me,Ze),ue=I(kn,ue,lt),Dt===null?et=kn:Dt.sibling=kn,Dt=kn,Ze=bt}if(Ot.done)return a(me,Ze),Tt&&Gr(me,lt),et;if(Ze===null){for(;!Ot.done;lt++,Ot=ye.next())Ot=xe(me,Ot.value,Pe),Ot!==null&&(ue=I(Ot,ue,lt),Dt===null?et=Ot:Dt.sibling=Ot,Dt=Ot);return Tt&&Gr(me,lt),et}for(Ze=f(Ze);!Ot.done;lt++,Ot=ye.next())Ot=we(Ze,me,lt,Ot.value,Pe),Ot!==null&&(t&&Ot.alternate!==null&&Ze.delete(Ot.key===null?lt:Ot.key),ue=I(Ot,ue,lt),Dt===null?et=Ot:Dt.sibling=Ot,Dt=Ot);return t&&Ze.forEach(function(T1){return r(me,T1)}),Tt&&Gr(me,lt),et}function Bt(me,ue,ye,Pe){if(typeof ye=="object"&&ye!==null&&ye.type===v&&ye.key===null&&(ye=ye.props.children),typeof ye=="object"&&ye!==null){switch(ye.$$typeof){case y:e:{for(var et=ye.key;ue!==null;){if(ue.key===et){if(et=ye.type,et===v){if(ue.tag===7){a(me,ue.sibling),Pe=D(ue,ye.props.children),Pe.return=me,me=Pe;break e}}else if(ue.elementType===et||typeof et=="object"&&et!==null&&et.$$typeof===P&&Zn(et)===ue.type){a(me,ue.sibling),Pe=D(ue,ye.props),Na(Pe,ye),Pe.return=me,me=Pe;break e}a(me,ue);break}else r(me,ue);ue=ue.sibling}ye.type===v?(Pe=Yn(ye.props.children,me.mode,Pe,ye.key),Pe.return=me,me=Pe):(Pe=Fs(ye.type,ye.key,ye.props,null,me.mode,Pe),Na(Pe,ye),Pe.return=me,me=Pe)}return K(me);case R:e:{for(et=ye.key;ue!==null;){if(ue.key===et)if(ue.tag===4&&ue.stateNode.containerInfo===ye.containerInfo&&ue.stateNode.implementation===ye.implementation){a(me,ue.sibling),Pe=D(ue,ye.children||[]),Pe.return=me,me=Pe;break e}else{a(me,ue);break}else r(me,ue);ue=ue.sibling}Pe=ru(ye,me.mode,Pe),Pe.return=me,me=Pe}return K(me);case P:return ye=Zn(ye),Bt(me,ue,ye,Pe)}if(F(ye))return Xe(me,ue,ye,Pe);if(H(ye)){if(et=H(ye),typeof et!="function")throw Error(o(150));return ye=et.call(ye),it(me,ue,ye,Pe)}if(typeof ye.then=="function")return Bt(me,ue,Js(ye),Pe);if(ye.$$typeof===A)return Bt(me,ue,qs(me,ye),Pe);Qs(me,ye)}return typeof ye=="string"&&ye!==""||typeof ye=="number"||typeof ye=="bigint"?(ye=""+ye,ue!==null&&ue.tag===6?(a(me,ue.sibling),Pe=D(ue,ye),Pe.return=me,me=Pe):(a(me,ue),Pe=iu(ye,me.mode,Pe),Pe.return=me,me=Pe),K(me)):a(me,ue)}return function(me,ue,ye,Pe){try{Ma=0;var et=Bt(me,ue,ye,Pe);return Ho=null,et}catch(Ze){if(Ze===Vo||Ze===Ys)throw Ze;var Dt=Ji(29,Ze,null,me.mode);return Dt.lanes=Pe,Dt.return=me,Dt}}}var to=Rp(!0),_p=Rp(!1),gn=!1;function mu(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function gu(t,r){t=t.updateQueue,r.updateQueue===t&&(r.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,callbacks:null})}function vn(t){return{lane:t,tag:0,payload:null,callback:null,next:null}}function yn(t,r,a){var f=t.updateQueue;if(f===null)return null;if(f=f.shared,(Mt&2)!==0){var D=f.pending;return D===null?r.next=r:(r.next=D.next,D.next=r),f.pending=r,r=zs(t),ap(t,null,a),r}return js(t,f,r,a),zs(t)}function ka(t,r,a){if(r=r.updateQueue,r!==null&&(r=r.shared,(a&4194048)!==0)){var f=r.lanes;f&=t.pendingLanes,a|=f,r.lanes=a,Ds(t,a)}}function vu(t,r){var a=t.updateQueue,f=t.alternate;if(f!==null&&(f=f.updateQueue,a===f)){var D=null,I=null;if(a=a.firstBaseUpdate,a!==null){do{var K={lane:a.lane,tag:a.tag,payload:a.payload,callback:null,next:null};I===null?D=I=K:I=I.next=K,a=a.next}while(a!==null);I===null?D=I=r:I=I.next=r}else D=I=r;a={baseState:f.baseState,firstBaseUpdate:D,lastBaseUpdate:I,shared:f.shared,callbacks:f.callbacks},t.updateQueue=a;return}t=a.lastBaseUpdate,t===null?a.firstBaseUpdate=r:t.next=r,a.lastBaseUpdate=r}var yu=!1;function Pa(){if(yu){var t=Bo;if(t!==null)throw t}}function La(t,r,a,f){yu=!1;var D=t.updateQueue;gn=!1;var I=D.firstBaseUpdate,K=D.lastBaseUpdate,ee=D.shared.pending;if(ee!==null){D.shared.pending=null;var ce=ee,Se=ce.next;ce.next=null,K===null?I=Se:K.next=Se,K=ce;var Me=t.alternate;Me!==null&&(Me=Me.updateQueue,ee=Me.lastBaseUpdate,ee!==K&&(ee===null?Me.firstBaseUpdate=Se:ee.next=Se,Me.lastBaseUpdate=ce))}if(I!==null){var xe=D.baseState;K=0,Me=Se=ce=null,ee=I;do{var Ee=ee.lane&-536870913,we=Ee!==ee.lane;if(we?(St&Ee)===Ee:(f&Ee)===Ee){Ee!==0&&Ee===xo&&(yu=!0),Me!==null&&(Me=Me.next={lane:0,tag:ee.tag,payload:ee.payload,callback:null,next:null});e:{var Xe=t,it=ee;Ee=r;var Bt=a;switch(it.tag){case 1:if(Xe=it.payload,typeof Xe=="function"){xe=Xe.call(Bt,xe,Ee);break e}xe=Xe;break e;case 3:Xe.flags=Xe.flags&-65537|128;case 0:if(Xe=it.payload,Ee=typeof Xe=="function"?Xe.call(Bt,xe,Ee):Xe,Ee==null)break e;xe=S({},xe,Ee);break e;case 2:gn=!0}}Ee=ee.callback,Ee!==null&&(t.flags|=64,we&&(t.flags|=8192),we=D.callbacks,we===null?D.callbacks=[Ee]:we.push(Ee))}else we={lane:Ee,tag:ee.tag,payload:ee.payload,callback:ee.callback,next:null},Me===null?(Se=Me=we,ce=xe):Me=Me.next=we,K|=Ee;if(ee=ee.next,ee===null){if(ee=D.shared.pending,ee===null)break;we=ee,ee=we.next,we.next=null,D.lastBaseUpdate=we,D.shared.pending=null}}while(!0);Me===null&&(ce=xe),D.baseState=ce,D.firstBaseUpdate=Se,D.lastBaseUpdate=Me,I===null&&(D.shared.lanes=0),_n|=K,t.lanes=K,t.memoizedState=xe}}function Tp(t,r){if(typeof t!="function")throw Error(o(191,t));t.call(r)}function Ap(t,r){var a=t.callbacks;if(a!==null)for(t.callbacks=null,t=0;t<a.length;t++)Tp(a[t],r)}var jo=z(null),$s=z(0);function Cp(t,r){t=tn,re($s,t),re(jo,r),tn=t|r.baseLanes}function Su(){re($s,tn),re(jo,jo.current)}function bu(){tn=$s.current,V(jo),V($s)}var Qi=z(null),hr=null;function Sn(t){var r=t.alternate;re(ti,ti.current&1),re(Qi,t),hr===null&&(r===null||jo.current!==null||r.memoizedState!==null)&&(hr=t)}function Eu(t){re(ti,ti.current),re(Qi,t),hr===null&&(hr=t)}function wp(t){t.tag===22?(re(ti,ti.current),re(Qi,t),hr===null&&(hr=t)):bn()}function bn(){re(ti,ti.current),re(Qi,Qi.current)}function $i(t){V(Qi),hr===t&&(hr=null),V(ti)}var ti=z(0);function Zs(t){for(var r=t;r!==null;){if(r.tag===13){var a=r.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||wd(a)||Dd(a)))return r}else if(r.tag===19&&(r.memoizedProps.revealOrder==="forwards"||r.memoizedProps.revealOrder==="backwards"||r.memoizedProps.revealOrder==="unstable_legacy-backwards"||r.memoizedProps.revealOrder==="together")){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var Kr=0,st=null,Ut=null,oi=null,ec=!1,zo=!1,io=!1,tc=0,Ua=0,Fo=null,pE=0;function $t(){throw Error(o(321))}function Ru(t,r){if(r===null)return!1;for(var a=0;a<r.length&&a<t.length;a++)if(!Xi(t[a],r[a]))return!1;return!0}function _u(t,r,a,f,D,I){return Kr=I,st=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,N.H=t===null||t.memoizedState===null?um:Bu,io=!1,I=a(f,D),io=!1,zo&&(I=Op(r,a,f,D)),Dp(t),I}function Dp(t){N.H=Va;var r=Ut!==null&&Ut.next!==null;if(Kr=0,oi=Ut=st=null,ec=!1,Ua=0,Fo=null,r)throw Error(o(300));t===null||ai||(t=t.dependencies,t!==null&&Ws(t)&&(ai=!0))}function Op(t,r,a,f){st=t;var D=0;do{if(zo&&(Fo=null),Ua=0,zo=!1,25<=D)throw Error(o(301));if(D+=1,oi=Ut=null,t.updateQueue!=null){var I=t.updateQueue;I.lastEffect=null,I.events=null,I.stores=null,I.memoCache!=null&&(I.memoCache.index=0)}N.H=dm,I=r(a,f)}while(zo);return I}function mE(){var t=N.H,r=t.useState()[0];return r=typeof r.then=="function"?xa(r):r,t=t.useState()[0],(Ut!==null?Ut.memoizedState:null)!==t&&(st.flags|=1024),r}function Tu(){var t=tc!==0;return tc=0,t}function Au(t,r,a){r.updateQueue=t.updateQueue,r.flags&=-2053,t.lanes&=~a}function Cu(t){if(ec){for(t=t.memoizedState;t!==null;){var r=t.queue;r!==null&&(r.pending=null),t=t.next}ec=!1}Kr=0,oi=Ut=st=null,zo=!1,Ua=tc=0,Fo=null}function ki(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return oi===null?st.memoizedState=oi=t:oi=oi.next=t,oi}function ii(){if(Ut===null){var t=st.alternate;t=t!==null?t.memoizedState:null}else t=Ut.next;var r=oi===null?st.memoizedState:oi.next;if(r!==null)oi=r,Ut=t;else{if(t===null)throw st.alternate===null?Error(o(467)):Error(o(310));Ut=t,t={memoizedState:Ut.memoizedState,baseState:Ut.baseState,baseQueue:Ut.baseQueue,queue:Ut.queue,next:null},oi===null?st.memoizedState=oi=t:oi=oi.next=t}return oi}function ic(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function xa(t){var r=Ua;return Ua+=1,Fo===null&&(Fo=[]),t=Sp(Fo,t,r),r=st,(oi===null?r.memoizedState:oi.next)===null&&(r=r.alternate,N.H=r===null||r.memoizedState===null?um:Bu),t}function rc(t){if(t!==null&&typeof t=="object"){if(typeof t.then=="function")return xa(t);if(t.$$typeof===A)return Ti(t)}throw Error(o(438,String(t)))}function wu(t){var r=null,a=st.updateQueue;if(a!==null&&(r=a.memoCache),r==null){var f=st.alternate;f!==null&&(f=f.updateQueue,f!==null&&(f=f.memoCache,f!=null&&(r={data:f.data.map(function(D){return D.slice()}),index:0})))}if(r==null&&(r={data:[],index:0}),a===null&&(a=ic(),st.updateQueue=a),a.memoCache=r,a=r.data[r.index],a===void 0)for(a=r.data[r.index]=Array(t),f=0;f<t;f++)a[f]=B;return r.index++,a}function Yr(t,r){return typeof r=="function"?r(t):r}function nc(t){var r=ii();return Du(r,Ut,t)}function Du(t,r,a){var f=t.queue;if(f===null)throw Error(o(311));f.lastRenderedReducer=a;var D=t.baseQueue,I=f.pending;if(I!==null){if(D!==null){var K=D.next;D.next=I.next,I.next=K}r.baseQueue=D=I,f.pending=null}if(I=t.baseState,D===null)t.memoizedState=I;else{r=D.next;var ee=K=null,ce=null,Se=r,Me=!1;do{var xe=Se.lane&-536870913;if(xe!==Se.lane?(St&xe)===xe:(Kr&xe)===xe){var Ee=Se.revertLane;if(Ee===0)ce!==null&&(ce=ce.next={lane:0,revertLane:0,gesture:null,action:Se.action,hasEagerState:Se.hasEagerState,eagerState:Se.eagerState,next:null}),xe===xo&&(Me=!0);else if((Kr&Ee)===Ee){Se=Se.next,Ee===xo&&(Me=!0);continue}else xe={lane:0,revertLane:Se.revertLane,gesture:null,action:Se.action,hasEagerState:Se.hasEagerState,eagerState:Se.eagerState,next:null},ce===null?(ee=ce=xe,K=I):ce=ce.next=xe,st.lanes|=Ee,_n|=Ee;xe=Se.action,io&&a(I,xe),I=Se.hasEagerState?Se.eagerState:a(I,xe)}else Ee={lane:xe,revertLane:Se.revertLane,gesture:Se.gesture,action:Se.action,hasEagerState:Se.hasEagerState,eagerState:Se.eagerState,next:null},ce===null?(ee=ce=Ee,K=I):ce=ce.next=Ee,st.lanes|=xe,_n|=xe;Se=Se.next}while(Se!==null&&Se!==r);if(ce===null?K=I:ce.next=ee,!Xi(I,t.memoizedState)&&(ai=!0,Me&&(a=Bo,a!==null)))throw a;t.memoizedState=I,t.baseState=K,t.baseQueue=ce,f.lastRenderedState=I}return D===null&&(f.lanes=0),[t.memoizedState,f.dispatch]}function Ou(t){var r=ii(),a=r.queue;if(a===null)throw Error(o(311));a.lastRenderedReducer=t;var f=a.dispatch,D=a.pending,I=r.memoizedState;if(D!==null){a.pending=null;var K=D=D.next;do I=t(I,K.action),K=K.next;while(K!==D);Xi(I,r.memoizedState)||(ai=!0),r.memoizedState=I,r.baseQueue===null&&(r.baseState=I),a.lastRenderedState=I}return[I,f]}function Ip(t,r,a){var f=st,D=ii(),I=Tt;if(I){if(a===void 0)throw Error(o(407));a=a()}else a=r();var K=!Xi((Ut||D).memoizedState,a);if(K&&(D.memoizedState=a,ai=!0),D=D.queue,Nu(kp.bind(null,f,D,t),[t]),D.getSnapshot!==r||K||oi!==null&&oi.memoizedState.tag&1){if(f.flags|=2048,Go(9,{destroy:void 0},Np.bind(null,f,D,a,r),null),zt===null)throw Error(o(349));I||(Kr&127)!==0||Mp(f,r,a)}return a}function Mp(t,r,a){t.flags|=16384,t={getSnapshot:r,value:a},r=st.updateQueue,r===null?(r=ic(),st.updateQueue=r,r.stores=[t]):(a=r.stores,a===null?r.stores=[t]:a.push(t))}function Np(t,r,a,f){r.value=a,r.getSnapshot=f,Pp(r)&&Lp(t)}function kp(t,r,a){return a(function(){Pp(r)&&Lp(t)})}function Pp(t){var r=t.getSnapshot;t=t.value;try{var a=r();return!Xi(t,a)}catch{return!0}}function Lp(t){var r=Kn(t,2);r!==null&&Fi(r,t,2)}function Iu(t){var r=ki();if(typeof t=="function"){var a=t;if(t=a(),io){Nt(!0);try{a()}finally{Nt(!1)}}}return r.memoizedState=r.baseState=t,r.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Yr,lastRenderedState:t},r}function Up(t,r,a,f){return t.baseState=a,Du(t,Ut,typeof f=="function"?f:Yr)}function gE(t,r,a,f,D){if(sc(t))throw Error(o(485));if(t=r.action,t!==null){var I={payload:D,action:t,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(K){I.listeners.push(K)}};N.T!==null?a(!0):I.isTransition=!1,f(I),a=r.pending,a===null?(I.next=r.pending=I,xp(r,I)):(I.next=a.next,r.pending=a.next=I)}}function xp(t,r){var a=r.action,f=r.payload,D=t.state;if(r.isTransition){var I=N.T,K={};N.T=K;try{var ee=a(D,f),ce=N.S;ce!==null&&ce(K,ee),Bp(t,r,ee)}catch(Se){Mu(t,r,Se)}finally{I!==null&&K.types!==null&&(I.types=K.types),N.T=I}}else try{I=a(D,f),Bp(t,r,I)}catch(Se){Mu(t,r,Se)}}function Bp(t,r,a){a!==null&&typeof a=="object"&&typeof a.then=="function"?a.then(function(f){Vp(t,r,f)},function(f){return Mu(t,r,f)}):Vp(t,r,a)}function Vp(t,r,a){r.status="fulfilled",r.value=a,Hp(r),t.state=a,r=t.pending,r!==null&&(a=r.next,a===r?t.pending=null:(a=a.next,r.next=a,xp(t,a)))}function Mu(t,r,a){var f=t.pending;if(t.pending=null,f!==null){f=f.next;do r.status="rejected",r.reason=a,Hp(r),r=r.next;while(r!==f)}t.action=null}function Hp(t){t=t.listeners;for(var r=0;r<t.length;r++)(0,t[r])()}function jp(t,r){return r}function zp(t,r){if(Tt){var a=zt.formState;if(a!==null){e:{var f=st;if(Tt){if(Kt){t:{for(var D=Kt,I=dr;D.nodeType!==8;){if(!I){D=null;break t}if(D=fr(D.nextSibling),D===null){D=null;break t}}I=D.data,D=I==="F!"||I==="F"?D:null}if(D){Kt=fr(D.nextSibling),f=D.data==="F!";break e}}pn(f)}f=!1}f&&(r=a[0])}}return a=ki(),a.memoizedState=a.baseState=r,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:jp,lastRenderedState:r},a.queue=f,a=sm.bind(null,st,f),f.dispatch=a,f=Iu(!1),I=xu.bind(null,st,!1,f.queue),f=ki(),D={state:r,dispatch:null,action:t,pending:null},f.queue=D,a=gE.bind(null,st,D,I,a),D.dispatch=a,f.memoizedState=t,[r,a,!1]}function Fp(t){var r=ii();return Gp(r,Ut,t)}function Gp(t,r,a){if(r=Du(t,r,jp)[0],t=nc(Yr)[0],typeof r=="object"&&r!==null&&typeof r.then=="function")try{var f=xa(r)}catch(K){throw K===Vo?Ys:K}else f=r;r=ii();var D=r.queue,I=D.dispatch;return a!==r.memoizedState&&(st.flags|=2048,Go(9,{destroy:void 0},vE.bind(null,D,a),null)),[f,I,t]}function vE(t,r){t.action=r}function Wp(t){var r=ii(),a=Ut;if(a!==null)return Gp(r,a,t);ii(),r=r.memoizedState,a=ii();var f=a.queue.dispatch;return a.memoizedState=t,[r,f,!1]}function Go(t,r,a,f){return t={tag:t,create:a,deps:f,inst:r,next:null},r=st.updateQueue,r===null&&(r=ic(),st.updateQueue=r),a=r.lastEffect,a===null?r.lastEffect=t.next=t:(f=a.next,a.next=t,t.next=f,r.lastEffect=t),t}function qp(){return ii().memoizedState}function oc(t,r,a,f){var D=ki();st.flags|=t,D.memoizedState=Go(1|r,{destroy:void 0},a,f===void 0?null:f)}function ac(t,r,a,f){var D=ii();f=f===void 0?null:f;var I=D.memoizedState.inst;Ut!==null&&f!==null&&Ru(f,Ut.memoizedState.deps)?D.memoizedState=Go(r,I,a,f):(st.flags|=t,D.memoizedState=Go(1|r,I,a,f))}function Kp(t,r){oc(8390656,8,t,r)}function Nu(t,r){ac(2048,8,t,r)}function yE(t){st.flags|=4;var r=st.updateQueue;if(r===null)r=ic(),st.updateQueue=r,r.events=[t];else{var a=r.events;a===null?r.events=[t]:a.push(t)}}function Yp(t){var r=ii().memoizedState;return yE({ref:r,nextImpl:t}),function(){if((Mt&2)!==0)throw Error(o(440));return r.impl.apply(void 0,arguments)}}function Xp(t,r){return ac(4,2,t,r)}function Jp(t,r){return ac(4,4,t,r)}function Qp(t,r){if(typeof r=="function"){t=t();var a=r(t);return function(){typeof a=="function"?a():r(null)}}if(r!=null)return t=t(),r.current=t,function(){r.current=null}}function $p(t,r,a){a=a!=null?a.concat([t]):null,ac(4,4,Qp.bind(null,r,t),a)}function ku(){}function Zp(t,r){var a=ii();r=r===void 0?null:r;var f=a.memoizedState;return r!==null&&Ru(r,f[1])?f[0]:(a.memoizedState=[t,r],t)}function em(t,r){var a=ii();r=r===void 0?null:r;var f=a.memoizedState;if(r!==null&&Ru(r,f[1]))return f[0];if(f=t(),io){Nt(!0);try{t()}finally{Nt(!1)}}return a.memoizedState=[f,r],f}function Pu(t,r,a){return a===void 0||(Kr&1073741824)!==0&&(St&261930)===0?t.memoizedState=r:(t.memoizedState=a,t=tg(),st.lanes|=t,_n|=t,a)}function tm(t,r,a,f){return Xi(a,r)?a:jo.current!==null?(t=Pu(t,a,f),Xi(t,r)||(ai=!0),t):(Kr&42)===0||(Kr&1073741824)!==0&&(St&261930)===0?(ai=!0,t.memoizedState=a):(t=tg(),st.lanes|=t,_n|=t,r)}function im(t,r,a,f,D){var I=k.p;k.p=I!==0&&8>I?I:8;var K=N.T,ee={};N.T=ee,xu(t,!1,r,a);try{var ce=D(),Se=N.S;if(Se!==null&&Se(ee,ce),ce!==null&&typeof ce=="object"&&typeof ce.then=="function"){var Me=fE(ce,f);Ba(t,r,Me,tr(t))}else Ba(t,r,f,tr(t))}catch(xe){Ba(t,r,{then:function(){},status:"rejected",reason:xe},tr())}finally{k.p=I,K!==null&&ee.types!==null&&(K.types=ee.types),N.T=K}}function SE(){}function Lu(t,r,a,f){if(t.tag!==5)throw Error(o(476));var D=rm(t).queue;im(t,D,r,M,a===null?SE:function(){return nm(t),a(f)})}function rm(t){var r=t.memoizedState;if(r!==null)return r;r={memoizedState:M,baseState:M,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Yr,lastRenderedState:M},next:null};var a={};return r.next={memoizedState:a,baseState:a,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Yr,lastRenderedState:a},next:null},t.memoizedState=r,t=t.alternate,t!==null&&(t.memoizedState=r),r}function nm(t){var r=rm(t);r.next===null&&(r=t.alternate.memoizedState),Ba(t,r.next.queue,{},tr())}function Uu(){return Ti(ts)}function om(){return ii().memoizedState}function am(){return ii().memoizedState}function bE(t){for(var r=t.return;r!==null;){switch(r.tag){case 24:case 3:var a=tr();t=vn(a);var f=yn(r,t,a);f!==null&&(Fi(f,r,a),ka(f,r,a)),r={cache:du()},t.payload=r;return}r=r.return}}function EE(t,r,a){var f=tr();a={lane:f,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null},sc(t)?cm(r,a):(a=eu(t,r,a,f),a!==null&&(Fi(a,t,f),lm(a,r,f)))}function sm(t,r,a){var f=tr();Ba(t,r,a,f)}function Ba(t,r,a,f){var D={lane:f,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null};if(sc(t))cm(r,D);else{var I=t.alternate;if(t.lanes===0&&(I===null||I.lanes===0)&&(I=r.lastRenderedReducer,I!==null))try{var K=r.lastRenderedState,ee=I(K,a);if(D.hasEagerState=!0,D.eagerState=ee,Xi(ee,K))return js(t,r,D,0),zt===null&&Hs(),!1}catch{}if(a=eu(t,r,D,f),a!==null)return Fi(a,t,f),lm(a,r,f),!0}return!1}function xu(t,r,a,f){if(f={lane:2,revertLane:md(),gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null},sc(t)){if(r)throw Error(o(479))}else r=eu(t,a,f,2),r!==null&&Fi(r,t,2)}function sc(t){var r=t.alternate;return t===st||r!==null&&r===st}function cm(t,r){zo=ec=!0;var a=t.pending;a===null?r.next=r:(r.next=a.next,a.next=r),t.pending=r}function lm(t,r,a){if((a&4194048)!==0){var f=r.lanes;f&=t.pendingLanes,a|=f,r.lanes=a,Ds(t,a)}}var Va={readContext:Ti,use:rc,useCallback:$t,useContext:$t,useEffect:$t,useImperativeHandle:$t,useLayoutEffect:$t,useInsertionEffect:$t,useMemo:$t,useReducer:$t,useRef:$t,useState:$t,useDebugValue:$t,useDeferredValue:$t,useTransition:$t,useSyncExternalStore:$t,useId:$t,useHostTransitionStatus:$t,useFormState:$t,useActionState:$t,useOptimistic:$t,useMemoCache:$t,useCacheRefresh:$t};Va.useEffectEvent=$t;var um={readContext:Ti,use:rc,useCallback:function(t,r){return ki().memoizedState=[t,r===void 0?null:r],t},useContext:Ti,useEffect:Kp,useImperativeHandle:function(t,r,a){a=a!=null?a.concat([t]):null,oc(4194308,4,Qp.bind(null,r,t),a)},useLayoutEffect:function(t,r){return oc(4194308,4,t,r)},useInsertionEffect:function(t,r){oc(4,2,t,r)},useMemo:function(t,r){var a=ki();r=r===void 0?null:r;var f=t();if(io){Nt(!0);try{t()}finally{Nt(!1)}}return a.memoizedState=[f,r],f},useReducer:function(t,r,a){var f=ki();if(a!==void 0){var D=a(r);if(io){Nt(!0);try{a(r)}finally{Nt(!1)}}}else D=r;return f.memoizedState=f.baseState=D,t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:D},f.queue=t,t=t.dispatch=EE.bind(null,st,t),[f.memoizedState,t]},useRef:function(t){var r=ki();return t={current:t},r.memoizedState=t},useState:function(t){t=Iu(t);var r=t.queue,a=sm.bind(null,st,r);return r.dispatch=a,[t.memoizedState,a]},useDebugValue:ku,useDeferredValue:function(t,r){var a=ki();return Pu(a,t,r)},useTransition:function(){var t=Iu(!1);return t=im.bind(null,st,t.queue,!0,!1),ki().memoizedState=t,[!1,t]},useSyncExternalStore:function(t,r,a){var f=st,D=ki();if(Tt){if(a===void 0)throw Error(o(407));a=a()}else{if(a=r(),zt===null)throw Error(o(349));(St&127)!==0||Mp(f,r,a)}D.memoizedState=a;var I={value:a,getSnapshot:r};return D.queue=I,Kp(kp.bind(null,f,I,t),[t]),f.flags|=2048,Go(9,{destroy:void 0},Np.bind(null,f,I,a,r),null),a},useId:function(){var t=ki(),r=zt.identifierPrefix;if(Tt){var a=Mr,f=Ir;a=(f&~(1<<32-kt(f)-1)).toString(32)+a,r="_"+r+"R_"+a,a=tc++,0<a&&(r+="H"+a.toString(32)),r+="_"}else a=pE++,r="_"+r+"r_"+a.toString(32)+"_";return t.memoizedState=r},useHostTransitionStatus:Uu,useFormState:zp,useActionState:zp,useOptimistic:function(t){var r=ki();r.memoizedState=r.baseState=t;var a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return r.queue=a,r=xu.bind(null,st,!0,a),a.dispatch=r,[t,r]},useMemoCache:wu,useCacheRefresh:function(){return ki().memoizedState=bE.bind(null,st)},useEffectEvent:function(t){var r=ki(),a={impl:t};return r.memoizedState=a,function(){if((Mt&2)!==0)throw Error(o(440));return a.impl.apply(void 0,arguments)}}},Bu={readContext:Ti,use:rc,useCallback:Zp,useContext:Ti,useEffect:Nu,useImperativeHandle:$p,useInsertionEffect:Xp,useLayoutEffect:Jp,useMemo:em,useReducer:nc,useRef:qp,useState:function(){return nc(Yr)},useDebugValue:ku,useDeferredValue:function(t,r){var a=ii();return tm(a,Ut.memoizedState,t,r)},useTransition:function(){var t=nc(Yr)[0],r=ii().memoizedState;return[typeof t=="boolean"?t:xa(t),r]},useSyncExternalStore:Ip,useId:om,useHostTransitionStatus:Uu,useFormState:Fp,useActionState:Fp,useOptimistic:function(t,r){var a=ii();return Up(a,Ut,t,r)},useMemoCache:wu,useCacheRefresh:am};Bu.useEffectEvent=Yp;var dm={readContext:Ti,use:rc,useCallback:Zp,useContext:Ti,useEffect:Nu,useImperativeHandle:$p,useInsertionEffect:Xp,useLayoutEffect:Jp,useMemo:em,useReducer:Ou,useRef:qp,useState:function(){return Ou(Yr)},useDebugValue:ku,useDeferredValue:function(t,r){var a=ii();return Ut===null?Pu(a,t,r):tm(a,Ut.memoizedState,t,r)},useTransition:function(){var t=Ou(Yr)[0],r=ii().memoizedState;return[typeof t=="boolean"?t:xa(t),r]},useSyncExternalStore:Ip,useId:om,useHostTransitionStatus:Uu,useFormState:Wp,useActionState:Wp,useOptimistic:function(t,r){var a=ii();return Ut!==null?Up(a,Ut,t,r):(a.baseState=t,[t,a.queue.dispatch])},useMemoCache:wu,useCacheRefresh:am};dm.useEffectEvent=Yp;function Vu(t,r,a,f){r=t.memoizedState,a=a(f,r),a=a==null?r:S({},r,a),t.memoizedState=a,t.lanes===0&&(t.updateQueue.baseState=a)}var Hu={enqueueSetState:function(t,r,a){t=t._reactInternals;var f=tr(),D=vn(f);D.payload=r,a!=null&&(D.callback=a),r=yn(t,D,f),r!==null&&(Fi(r,t,f),ka(r,t,f))},enqueueReplaceState:function(t,r,a){t=t._reactInternals;var f=tr(),D=vn(f);D.tag=1,D.payload=r,a!=null&&(D.callback=a),r=yn(t,D,f),r!==null&&(Fi(r,t,f),ka(r,t,f))},enqueueForceUpdate:function(t,r){t=t._reactInternals;var a=tr(),f=vn(a);f.tag=2,r!=null&&(f.callback=r),r=yn(t,f,a),r!==null&&(Fi(r,t,a),ka(r,t,a))}};function hm(t,r,a,f,D,I,K){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(f,I,K):r.prototype&&r.prototype.isPureReactComponent?!Aa(a,f)||!Aa(D,I):!0}function fm(t,r,a,f){t=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(a,f),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(a,f),r.state!==t&&Hu.enqueueReplaceState(r,r.state,null)}function ro(t,r){var a=r;if("ref"in r){a={};for(var f in r)f!=="ref"&&(a[f]=r[f])}if(t=t.defaultProps){a===r&&(a=S({},a));for(var D in t)a[D]===void 0&&(a[D]=t[D])}return a}function pm(t){Vs(t)}function mm(t){console.error(t)}function gm(t){Vs(t)}function cc(t,r){try{var a=t.onUncaughtError;a(r.value,{componentStack:r.stack})}catch(f){setTimeout(function(){throw f})}}function vm(t,r,a){try{var f=t.onCaughtError;f(a.value,{componentStack:a.stack,errorBoundary:r.tag===1?r.stateNode:null})}catch(D){setTimeout(function(){throw D})}}function ju(t,r,a){return a=vn(a),a.tag=3,a.payload={element:null},a.callback=function(){cc(t,r)},a}function ym(t){return t=vn(t),t.tag=3,t}function Sm(t,r,a,f){var D=a.type.getDerivedStateFromError;if(typeof D=="function"){var I=f.value;t.payload=function(){return D(I)},t.callback=function(){vm(r,a,f)}}var K=a.stateNode;K!==null&&typeof K.componentDidCatch=="function"&&(t.callback=function(){vm(r,a,f),typeof D!="function"&&(Tn===null?Tn=new Set([this]):Tn.add(this));var ee=f.stack;this.componentDidCatch(f.value,{componentStack:ee!==null?ee:""})})}function RE(t,r,a,f,D){if(a.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){if(r=a.alternate,r!==null&&Uo(r,a,D,!0),a=Qi.current,a!==null){switch(a.tag){case 31:case 13:return hr===null?bc():a.alternate===null&&Zt===0&&(Zt=3),a.flags&=-257,a.flags|=65536,a.lanes=D,f===Xs?a.flags|=16384:(r=a.updateQueue,r===null?a.updateQueue=new Set([f]):r.add(f),hd(t,f,D)),!1;case 22:return a.flags|=65536,f===Xs?a.flags|=16384:(r=a.updateQueue,r===null?(r={transitions:null,markerInstances:null,retryQueue:new Set([f])},a.updateQueue=r):(a=r.retryQueue,a===null?r.retryQueue=new Set([f]):a.add(f)),hd(t,f,D)),!1}throw Error(o(435,a.tag))}return hd(t,f,D),bc(),!1}if(Tt)return r=Qi.current,r!==null?((r.flags&65536)===0&&(r.flags|=256),r.flags|=65536,r.lanes=D,f!==au&&(t=Error(o(422),{cause:f}),Da(cr(t,a)))):(f!==au&&(r=Error(o(423),{cause:f}),Da(cr(r,a))),t=t.current.alternate,t.flags|=65536,D&=-D,t.lanes|=D,f=cr(f,a),D=ju(t.stateNode,f,D),vu(t,D),Zt!==4&&(Zt=2)),!1;var I=Error(o(520),{cause:f});if(I=cr(I,a),Ka===null?Ka=[I]:Ka.push(I),Zt!==4&&(Zt=2),r===null)return!0;f=cr(f,a),a=r;do{switch(a.tag){case 3:return a.flags|=65536,t=D&-D,a.lanes|=t,t=ju(a.stateNode,f,t),vu(a,t),!1;case 1:if(r=a.type,I=a.stateNode,(a.flags&128)===0&&(typeof r.getDerivedStateFromError=="function"||I!==null&&typeof I.componentDidCatch=="function"&&(Tn===null||!Tn.has(I))))return a.flags|=65536,D&=-D,a.lanes|=D,D=ym(D),Sm(D,t,a,f),vu(a,D),!1}a=a.return}while(a!==null);return!1}var zu=Error(o(461)),ai=!1;function Ai(t,r,a,f){r.child=t===null?_p(r,null,a,f):to(r,t.child,a,f)}function bm(t,r,a,f,D){a=a.render;var I=r.ref;if("ref"in f){var K={};for(var ee in f)ee!=="ref"&&(K[ee]=f[ee])}else K=f;return Qn(r),f=_u(t,r,a,K,I,D),ee=Tu(),t!==null&&!ai?(Au(t,r,D),Xr(t,r,D)):(Tt&&ee&&nu(r),r.flags|=1,Ai(t,r,f,D),r.child)}function Em(t,r,a,f,D){if(t===null){var I=a.type;return typeof I=="function"&&!tu(I)&&I.defaultProps===void 0&&a.compare===null?(r.tag=15,r.type=I,Rm(t,r,I,f,D)):(t=Fs(a.type,null,f,r,r.mode,D),t.ref=r.ref,t.return=r,r.child=t)}if(I=t.child,!Ju(t,D)){var K=I.memoizedProps;if(a=a.compare,a=a!==null?a:Aa,a(K,f)&&t.ref===r.ref)return Xr(t,r,D)}return r.flags|=1,t=Fr(I,f),t.ref=r.ref,t.return=r,r.child=t}function Rm(t,r,a,f,D){if(t!==null){var I=t.memoizedProps;if(Aa(I,f)&&t.ref===r.ref)if(ai=!1,r.pendingProps=f=I,Ju(t,D))(t.flags&131072)!==0&&(ai=!0);else return r.lanes=t.lanes,Xr(t,r,D)}return Fu(t,r,a,f,D)}function _m(t,r,a,f){var D=f.children,I=t!==null?t.memoizedState:null;if(t===null&&r.stateNode===null&&(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),f.mode==="hidden"){if((r.flags&128)!==0){if(I=I!==null?I.baseLanes|a:a,t!==null){for(f=r.child=t.child,D=0;f!==null;)D=D|f.lanes|f.childLanes,f=f.sibling;f=D&~I}else f=0,r.child=null;return Tm(t,r,I,a,f)}if((a&536870912)!==0)r.memoizedState={baseLanes:0,cachePool:null},t!==null&&Ks(r,I!==null?I.cachePool:null),I!==null?Cp(r,I):Su(),wp(r);else return f=r.lanes=536870912,Tm(t,r,I!==null?I.baseLanes|a:a,a,f)}else I!==null?(Ks(r,I.cachePool),Cp(r,I),bn(),r.memoizedState=null):(t!==null&&Ks(r,null),Su(),bn());return Ai(t,r,D,a),r.child}function Ha(t,r){return t!==null&&t.tag===22||r.stateNode!==null||(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),r.sibling}function Tm(t,r,a,f,D){var I=fu();return I=I===null?null:{parent:ni._currentValue,pool:I},r.memoizedState={baseLanes:a,cachePool:I},t!==null&&Ks(r,null),Su(),wp(r),t!==null&&Uo(t,r,f,!0),r.childLanes=D,null}function lc(t,r){return r=dc({mode:r.mode,children:r.children},t.mode),r.ref=t.ref,t.child=r,r.return=t,r}function Am(t,r,a){return to(r,t.child,null,a),t=lc(r,r.pendingProps),t.flags|=2,$i(r),r.memoizedState=null,t}function _E(t,r,a){var f=r.pendingProps,D=(r.flags&128)!==0;if(r.flags&=-129,t===null){if(Tt){if(f.mode==="hidden")return t=lc(r,f),r.lanes=536870912,Ha(null,t);if(Eu(r),(t=Kt)?(t=xg(t,dr),t=t!==null&&t.data==="&"?t:null,t!==null&&(r.memoizedState={dehydrated:t,treeContext:hn!==null?{id:Ir,overflow:Mr}:null,retryLane:536870912,hydrationErrors:null},a=cp(t),a.return=r,r.child=a,_i=r,Kt=null)):t=null,t===null)throw pn(r);return r.lanes=536870912,null}return lc(r,f)}var I=t.memoizedState;if(I!==null){var K=I.dehydrated;if(Eu(r),D)if(r.flags&256)r.flags&=-257,r=Am(t,r,a);else if(r.memoizedState!==null)r.child=t.child,r.flags|=128,r=null;else throw Error(o(558));else if(ai||Uo(t,r,a,!1),D=(a&t.childLanes)!==0,ai||D){if(f=zt,f!==null&&(K=mf(f,a),K!==0&&K!==I.retryLane))throw I.retryLane=K,Kn(t,K),Fi(f,t,K),zu;bc(),r=Am(t,r,a)}else t=I.treeContext,Kt=fr(K.nextSibling),_i=r,Tt=!0,fn=null,dr=!1,t!==null&&dp(r,t),r=lc(r,f),r.flags|=4096;return r}return t=Fr(t.child,{mode:f.mode,children:f.children}),t.ref=r.ref,r.child=t,t.return=r,t}function uc(t,r){var a=r.ref;if(a===null)t!==null&&t.ref!==null&&(r.flags|=4194816);else{if(typeof a!="function"&&typeof a!="object")throw Error(o(284));(t===null||t.ref!==a)&&(r.flags|=4194816)}}function Fu(t,r,a,f,D){return Qn(r),a=_u(t,r,a,f,void 0,D),f=Tu(),t!==null&&!ai?(Au(t,r,D),Xr(t,r,D)):(Tt&&f&&nu(r),r.flags|=1,Ai(t,r,a,D),r.child)}function Cm(t,r,a,f,D,I){return Qn(r),r.updateQueue=null,a=Op(r,f,a,D),Dp(t),f=Tu(),t!==null&&!ai?(Au(t,r,I),Xr(t,r,I)):(Tt&&f&&nu(r),r.flags|=1,Ai(t,r,a,I),r.child)}function wm(t,r,a,f,D){if(Qn(r),r.stateNode===null){var I=No,K=a.contextType;typeof K=="object"&&K!==null&&(I=Ti(K)),I=new a(f,I),r.memoizedState=I.state!==null&&I.state!==void 0?I.state:null,I.updater=Hu,r.stateNode=I,I._reactInternals=r,I=r.stateNode,I.props=f,I.state=r.memoizedState,I.refs={},mu(r),K=a.contextType,I.context=typeof K=="object"&&K!==null?Ti(K):No,I.state=r.memoizedState,K=a.getDerivedStateFromProps,typeof K=="function"&&(Vu(r,a,K,f),I.state=r.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof I.getSnapshotBeforeUpdate=="function"||typeof I.UNSAFE_componentWillMount!="function"&&typeof I.componentWillMount!="function"||(K=I.state,typeof I.componentWillMount=="function"&&I.componentWillMount(),typeof I.UNSAFE_componentWillMount=="function"&&I.UNSAFE_componentWillMount(),K!==I.state&&Hu.enqueueReplaceState(I,I.state,null),La(r,f,I,D),Pa(),I.state=r.memoizedState),typeof I.componentDidMount=="function"&&(r.flags|=4194308),f=!0}else if(t===null){I=r.stateNode;var ee=r.memoizedProps,ce=ro(a,ee);I.props=ce;var Se=I.context,Me=a.contextType;K=No,typeof Me=="object"&&Me!==null&&(K=Ti(Me));var xe=a.getDerivedStateFromProps;Me=typeof xe=="function"||typeof I.getSnapshotBeforeUpdate=="function",ee=r.pendingProps!==ee,Me||typeof I.UNSAFE_componentWillReceiveProps!="function"&&typeof I.componentWillReceiveProps!="function"||(ee||Se!==K)&&fm(r,I,f,K),gn=!1;var Ee=r.memoizedState;I.state=Ee,La(r,f,I,D),Pa(),Se=r.memoizedState,ee||Ee!==Se||gn?(typeof xe=="function"&&(Vu(r,a,xe,f),Se=r.memoizedState),(ce=gn||hm(r,a,ce,f,Ee,Se,K))?(Me||typeof I.UNSAFE_componentWillMount!="function"&&typeof I.componentWillMount!="function"||(typeof I.componentWillMount=="function"&&I.componentWillMount(),typeof I.UNSAFE_componentWillMount=="function"&&I.UNSAFE_componentWillMount()),typeof I.componentDidMount=="function"&&(r.flags|=4194308)):(typeof I.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=f,r.memoizedState=Se),I.props=f,I.state=Se,I.context=K,f=ce):(typeof I.componentDidMount=="function"&&(r.flags|=4194308),f=!1)}else{I=r.stateNode,gu(t,r),K=r.memoizedProps,Me=ro(a,K),I.props=Me,xe=r.pendingProps,Ee=I.context,Se=a.contextType,ce=No,typeof Se=="object"&&Se!==null&&(ce=Ti(Se)),ee=a.getDerivedStateFromProps,(Se=typeof ee=="function"||typeof I.getSnapshotBeforeUpdate=="function")||typeof I.UNSAFE_componentWillReceiveProps!="function"&&typeof I.componentWillReceiveProps!="function"||(K!==xe||Ee!==ce)&&fm(r,I,f,ce),gn=!1,Ee=r.memoizedState,I.state=Ee,La(r,f,I,D),Pa();var we=r.memoizedState;K!==xe||Ee!==we||gn||t!==null&&t.dependencies!==null&&Ws(t.dependencies)?(typeof ee=="function"&&(Vu(r,a,ee,f),we=r.memoizedState),(Me=gn||hm(r,a,Me,f,Ee,we,ce)||t!==null&&t.dependencies!==null&&Ws(t.dependencies))?(Se||typeof I.UNSAFE_componentWillUpdate!="function"&&typeof I.componentWillUpdate!="function"||(typeof I.componentWillUpdate=="function"&&I.componentWillUpdate(f,we,ce),typeof I.UNSAFE_componentWillUpdate=="function"&&I.UNSAFE_componentWillUpdate(f,we,ce)),typeof I.componentDidUpdate=="function"&&(r.flags|=4),typeof I.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof I.componentDidUpdate!="function"||K===t.memoizedProps&&Ee===t.memoizedState||(r.flags|=4),typeof I.getSnapshotBeforeUpdate!="function"||K===t.memoizedProps&&Ee===t.memoizedState||(r.flags|=1024),r.memoizedProps=f,r.memoizedState=we),I.props=f,I.state=we,I.context=ce,f=Me):(typeof I.componentDidUpdate!="function"||K===t.memoizedProps&&Ee===t.memoizedState||(r.flags|=4),typeof I.getSnapshotBeforeUpdate!="function"||K===t.memoizedProps&&Ee===t.memoizedState||(r.flags|=1024),f=!1)}return I=f,uc(t,r),f=(r.flags&128)!==0,I||f?(I=r.stateNode,a=f&&typeof a.getDerivedStateFromError!="function"?null:I.render(),r.flags|=1,t!==null&&f?(r.child=to(r,t.child,null,D),r.child=to(r,null,a,D)):Ai(t,r,a,D),r.memoizedState=I.state,t=r.child):t=Xr(t,r,D),t}function Dm(t,r,a,f){return Xn(),r.flags|=256,Ai(t,r,a,f),r.child}var Gu={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Wu(t){return{baseLanes:t,cachePool:vp()}}function qu(t,r,a){return t=t!==null?t.childLanes&~a:0,r&&(t|=er),t}function Om(t,r,a){var f=r.pendingProps,D=!1,I=(r.flags&128)!==0,K;if((K=I)||(K=t!==null&&t.memoizedState===null?!1:(ti.current&2)!==0),K&&(D=!0,r.flags&=-129),K=(r.flags&32)!==0,r.flags&=-33,t===null){if(Tt){if(D?Sn(r):bn(),(t=Kt)?(t=xg(t,dr),t=t!==null&&t.data!=="&"?t:null,t!==null&&(r.memoizedState={dehydrated:t,treeContext:hn!==null?{id:Ir,overflow:Mr}:null,retryLane:536870912,hydrationErrors:null},a=cp(t),a.return=r,r.child=a,_i=r,Kt=null)):t=null,t===null)throw pn(r);return Dd(t)?r.lanes=32:r.lanes=536870912,null}var ee=f.children;return f=f.fallback,D?(bn(),D=r.mode,ee=dc({mode:"hidden",children:ee},D),f=Yn(f,D,a,null),ee.return=r,f.return=r,ee.sibling=f,r.child=ee,f=r.child,f.memoizedState=Wu(a),f.childLanes=qu(t,K,a),r.memoizedState=Gu,Ha(null,f)):(Sn(r),Ku(r,ee))}var ce=t.memoizedState;if(ce!==null&&(ee=ce.dehydrated,ee!==null)){if(I)r.flags&256?(Sn(r),r.flags&=-257,r=Yu(t,r,a)):r.memoizedState!==null?(bn(),r.child=t.child,r.flags|=128,r=null):(bn(),ee=f.fallback,D=r.mode,f=dc({mode:"visible",children:f.children},D),ee=Yn(ee,D,a,null),ee.flags|=2,f.return=r,ee.return=r,f.sibling=ee,r.child=f,to(r,t.child,null,a),f=r.child,f.memoizedState=Wu(a),f.childLanes=qu(t,K,a),r.memoizedState=Gu,r=Ha(null,f));else if(Sn(r),Dd(ee)){if(K=ee.nextSibling&&ee.nextSibling.dataset,K)var Se=K.dgst;K=Se,f=Error(o(419)),f.stack="",f.digest=K,Da({value:f,source:null,stack:null}),r=Yu(t,r,a)}else if(ai||Uo(t,r,a,!1),K=(a&t.childLanes)!==0,ai||K){if(K=zt,K!==null&&(f=mf(K,a),f!==0&&f!==ce.retryLane))throw ce.retryLane=f,Kn(t,f),Fi(K,t,f),zu;wd(ee)||bc(),r=Yu(t,r,a)}else wd(ee)?(r.flags|=192,r.child=t.child,r=null):(t=ce.treeContext,Kt=fr(ee.nextSibling),_i=r,Tt=!0,fn=null,dr=!1,t!==null&&dp(r,t),r=Ku(r,f.children),r.flags|=4096);return r}return D?(bn(),ee=f.fallback,D=r.mode,ce=t.child,Se=ce.sibling,f=Fr(ce,{mode:"hidden",children:f.children}),f.subtreeFlags=ce.subtreeFlags&65011712,Se!==null?ee=Fr(Se,ee):(ee=Yn(ee,D,a,null),ee.flags|=2),ee.return=r,f.return=r,f.sibling=ee,r.child=f,Ha(null,f),f=r.child,ee=t.child.memoizedState,ee===null?ee=Wu(a):(D=ee.cachePool,D!==null?(ce=ni._currentValue,D=D.parent!==ce?{parent:ce,pool:ce}:D):D=vp(),ee={baseLanes:ee.baseLanes|a,cachePool:D}),f.memoizedState=ee,f.childLanes=qu(t,K,a),r.memoizedState=Gu,Ha(t.child,f)):(Sn(r),a=t.child,t=a.sibling,a=Fr(a,{mode:"visible",children:f.children}),a.return=r,a.sibling=null,t!==null&&(K=r.deletions,K===null?(r.deletions=[t],r.flags|=16):K.push(t)),r.child=a,r.memoizedState=null,a)}function Ku(t,r){return r=dc({mode:"visible",children:r},t.mode),r.return=t,t.child=r}function dc(t,r){return t=Ji(22,t,null,r),t.lanes=0,t}function Yu(t,r,a){return to(r,t.child,null,a),t=Ku(r,r.pendingProps.children),t.flags|=2,r.memoizedState=null,t}function Im(t,r,a){t.lanes|=r;var f=t.alternate;f!==null&&(f.lanes|=r),lu(t.return,r,a)}function Xu(t,r,a,f,D,I){var K=t.memoizedState;K===null?t.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:f,tail:a,tailMode:D,treeForkCount:I}:(K.isBackwards=r,K.rendering=null,K.renderingStartTime=0,K.last=f,K.tail=a,K.tailMode=D,K.treeForkCount=I)}function Mm(t,r,a){var f=r.pendingProps,D=f.revealOrder,I=f.tail;f=f.children;var K=ti.current,ee=(K&2)!==0;if(ee?(K=K&1|2,r.flags|=128):K&=1,re(ti,K),Ai(t,r,f,a),f=Tt?wa:0,!ee&&t!==null&&(t.flags&128)!==0)e:for(t=r.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Im(t,a,r);else if(t.tag===19)Im(t,a,r);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===r)break e;for(;t.sibling===null;){if(t.return===null||t.return===r)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}switch(D){case"forwards":for(a=r.child,D=null;a!==null;)t=a.alternate,t!==null&&Zs(t)===null&&(D=a),a=a.sibling;a=D,a===null?(D=r.child,r.child=null):(D=a.sibling,a.sibling=null),Xu(r,!1,D,a,I,f);break;case"backwards":case"unstable_legacy-backwards":for(a=null,D=r.child,r.child=null;D!==null;){if(t=D.alternate,t!==null&&Zs(t)===null){r.child=D;break}t=D.sibling,D.sibling=a,a=D,D=t}Xu(r,!0,a,null,I,f);break;case"together":Xu(r,!1,null,null,void 0,f);break;default:r.memoizedState=null}return r.child}function Xr(t,r,a){if(t!==null&&(r.dependencies=t.dependencies),_n|=r.lanes,(a&r.childLanes)===0)if(t!==null){if(Uo(t,r,a,!1),(a&r.childLanes)===0)return null}else return null;if(t!==null&&r.child!==t.child)throw Error(o(153));if(r.child!==null){for(t=r.child,a=Fr(t,t.pendingProps),r.child=a,a.return=r;t.sibling!==null;)t=t.sibling,a=a.sibling=Fr(t,t.pendingProps),a.return=r;a.sibling=null}return r.child}function Ju(t,r){return(t.lanes&r)!==0?!0:(t=t.dependencies,!!(t!==null&&Ws(t)))}function TE(t,r,a){switch(r.tag){case 3:J(r,r.stateNode.containerInfo),mn(r,ni,t.memoizedState.cache),Xn();break;case 27:case 5:te(r);break;case 4:J(r,r.stateNode.containerInfo);break;case 10:mn(r,r.type,r.memoizedProps.value);break;case 31:if(r.memoizedState!==null)return r.flags|=128,Eu(r),null;break;case 13:var f=r.memoizedState;if(f!==null)return f.dehydrated!==null?(Sn(r),r.flags|=128,null):(a&r.child.childLanes)!==0?Om(t,r,a):(Sn(r),t=Xr(t,r,a),t!==null?t.sibling:null);Sn(r);break;case 19:var D=(t.flags&128)!==0;if(f=(a&r.childLanes)!==0,f||(Uo(t,r,a,!1),f=(a&r.childLanes)!==0),D){if(f)return Mm(t,r,a);r.flags|=128}if(D=r.memoizedState,D!==null&&(D.rendering=null,D.tail=null,D.lastEffect=null),re(ti,ti.current),f)break;return null;case 22:return r.lanes=0,_m(t,r,a,r.pendingProps);case 24:mn(r,ni,t.memoizedState.cache)}return Xr(t,r,a)}function Nm(t,r,a){if(t!==null)if(t.memoizedProps!==r.pendingProps)ai=!0;else{if(!Ju(t,a)&&(r.flags&128)===0)return ai=!1,TE(t,r,a);ai=(t.flags&131072)!==0}else ai=!1,Tt&&(r.flags&1048576)!==0&&up(r,wa,r.index);switch(r.lanes=0,r.tag){case 16:e:{var f=r.pendingProps;if(t=Zn(r.elementType),r.type=t,typeof t=="function")tu(t)?(f=ro(t,f),r.tag=1,r=wm(null,r,t,f,a)):(r.tag=0,r=Fu(null,r,t,f,a));else{if(t!=null){var D=t.$$typeof;if(D===E){r.tag=11,r=bm(null,r,t,f,a);break e}else if(D===C){r.tag=14,r=Em(null,r,t,f,a);break e}}throw r=x(t)||t,Error(o(306,r,""))}}return r;case 0:return Fu(t,r,r.type,r.pendingProps,a);case 1:return f=r.type,D=ro(f,r.pendingProps),wm(t,r,f,D,a);case 3:e:{if(J(r,r.stateNode.containerInfo),t===null)throw Error(o(387));f=r.pendingProps;var I=r.memoizedState;D=I.element,gu(t,r),La(r,f,null,a);var K=r.memoizedState;if(f=K.cache,mn(r,ni,f),f!==I.cache&&uu(r,[ni],a,!0),Pa(),f=K.element,I.isDehydrated)if(I={element:f,isDehydrated:!1,cache:K.cache},r.updateQueue.baseState=I,r.memoizedState=I,r.flags&256){r=Dm(t,r,f,a);break e}else if(f!==D){D=cr(Error(o(424)),r),Da(D),r=Dm(t,r,f,a);break e}else for(t=r.stateNode.containerInfo,t.nodeType===9?t=t.body:t=t.nodeName==="HTML"?t.ownerDocument.body:t,Kt=fr(t.firstChild),_i=r,Tt=!0,fn=null,dr=!0,a=_p(r,null,f,a),r.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling;else{if(Xn(),f===D){r=Xr(t,r,a);break e}Ai(t,r,f,a)}r=r.child}return r;case 26:return uc(t,r),t===null?(a=Fg(r.type,null,r.pendingProps,null))?r.memoizedState=a:Tt||(a=r.type,t=r.pendingProps,f=wc(q.current).createElement(a),f[Ri]=r,f[xi]=t,Ci(f,a,t),yi(f),r.stateNode=f):r.memoizedState=Fg(r.type,t.memoizedProps,r.pendingProps,t.memoizedState),null;case 27:return te(r),t===null&&Tt&&(f=r.stateNode=Hg(r.type,r.pendingProps,q.current),_i=r,dr=!0,D=Kt,Dn(r.type)?(Od=D,Kt=fr(f.firstChild)):Kt=D),Ai(t,r,r.pendingProps.children,a),uc(t,r),t===null&&(r.flags|=4194304),r.child;case 5:return t===null&&Tt&&((D=f=Kt)&&(f=e1(f,r.type,r.pendingProps,dr),f!==null?(r.stateNode=f,_i=r,Kt=fr(f.firstChild),dr=!1,D=!0):D=!1),D||pn(r)),te(r),D=r.type,I=r.pendingProps,K=t!==null?t.memoizedProps:null,f=I.children,Td(D,I)?f=null:K!==null&&Td(D,K)&&(r.flags|=32),r.memoizedState!==null&&(D=_u(t,r,mE,null,null,a),ts._currentValue=D),uc(t,r),Ai(t,r,f,a),r.child;case 6:return t===null&&Tt&&((t=a=Kt)&&(a=t1(a,r.pendingProps,dr),a!==null?(r.stateNode=a,_i=r,Kt=null,t=!0):t=!1),t||pn(r)),null;case 13:return Om(t,r,a);case 4:return J(r,r.stateNode.containerInfo),f=r.pendingProps,t===null?r.child=to(r,null,f,a):Ai(t,r,f,a),r.child;case 11:return bm(t,r,r.type,r.pendingProps,a);case 7:return Ai(t,r,r.pendingProps,a),r.child;case 8:return Ai(t,r,r.pendingProps.children,a),r.child;case 12:return Ai(t,r,r.pendingProps.children,a),r.child;case 10:return f=r.pendingProps,mn(r,r.type,f.value),Ai(t,r,f.children,a),r.child;case 9:return D=r.type._context,f=r.pendingProps.children,Qn(r),D=Ti(D),f=f(D),r.flags|=1,Ai(t,r,f,a),r.child;case 14:return Em(t,r,r.type,r.pendingProps,a);case 15:return Rm(t,r,r.type,r.pendingProps,a);case 19:return Mm(t,r,a);case 31:return _E(t,r,a);case 22:return _m(t,r,a,r.pendingProps);case 24:return Qn(r),f=Ti(ni),t===null?(D=fu(),D===null&&(D=zt,I=du(),D.pooledCache=I,I.refCount++,I!==null&&(D.pooledCacheLanes|=a),D=I),r.memoizedState={parent:f,cache:D},mu(r),mn(r,ni,D)):((t.lanes&a)!==0&&(gu(t,r),La(r,null,null,a),Pa()),D=t.memoizedState,I=r.memoizedState,D.parent!==f?(D={parent:f,cache:f},r.memoizedState=D,r.lanes===0&&(r.memoizedState=r.updateQueue.baseState=D),mn(r,ni,f)):(f=I.cache,mn(r,ni,f),f!==D.cache&&uu(r,[ni],a,!0))),Ai(t,r,r.pendingProps.children,a),r.child;case 29:throw r.pendingProps}throw Error(o(156,r.tag))}function Jr(t){t.flags|=4}function Qu(t,r,a,f,D){if((r=(t.mode&32)!==0)&&(r=!1),r){if(t.flags|=16777216,(D&335544128)===D)if(t.stateNode.complete)t.flags|=8192;else if(og())t.flags|=8192;else throw eo=Xs,pu}else t.flags&=-16777217}function km(t,r){if(r.type!=="stylesheet"||(r.state.loading&4)!==0)t.flags&=-16777217;else if(t.flags|=16777216,!Yg(r))if(og())t.flags|=8192;else throw eo=Xs,pu}function hc(t,r){r!==null&&(t.flags|=4),t.flags&16384&&(r=t.tag!==22?Ue():536870912,t.lanes|=r,Yo|=r)}function ja(t,r){if(!Tt)switch(t.tailMode){case"hidden":r=t.tail;for(var a=null;r!==null;)r.alternate!==null&&(a=r),r=r.sibling;a===null?t.tail=null:a.sibling=null;break;case"collapsed":a=t.tail;for(var f=null;a!==null;)a.alternate!==null&&(f=a),a=a.sibling;f===null?r||t.tail===null?t.tail=null:t.tail.sibling=null:f.sibling=null}}function Yt(t){var r=t.alternate!==null&&t.alternate.child===t.child,a=0,f=0;if(r)for(var D=t.child;D!==null;)a|=D.lanes|D.childLanes,f|=D.subtreeFlags&65011712,f|=D.flags&65011712,D.return=t,D=D.sibling;else for(D=t.child;D!==null;)a|=D.lanes|D.childLanes,f|=D.subtreeFlags,f|=D.flags,D.return=t,D=D.sibling;return t.subtreeFlags|=f,t.childLanes=a,r}function AE(t,r,a){var f=r.pendingProps;switch(ou(r),r.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Yt(r),null;case 1:return Yt(r),null;case 3:return a=r.stateNode,f=null,t!==null&&(f=t.memoizedState.cache),r.memoizedState.cache!==f&&(r.flags|=2048),qr(ni),$(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(t===null||t.child===null)&&(Lo(r)?Jr(r):t===null||t.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,su())),Yt(r),null;case 26:var D=r.type,I=r.memoizedState;return t===null?(Jr(r),I!==null?(Yt(r),km(r,I)):(Yt(r),Qu(r,D,null,f,a))):I?I!==t.memoizedState?(Jr(r),Yt(r),km(r,I)):(Yt(r),r.flags&=-16777217):(t=t.memoizedProps,t!==f&&Jr(r),Yt(r),Qu(r,D,t,f,a)),null;case 27:if(ie(r),a=q.current,D=r.type,t!==null&&r.stateNode!=null)t.memoizedProps!==f&&Jr(r);else{if(!f){if(r.stateNode===null)throw Error(o(166));return Yt(r),null}t=Q.current,Lo(r)?hp(r):(t=Hg(D,f,a),r.stateNode=t,Jr(r))}return Yt(r),null;case 5:if(ie(r),D=r.type,t!==null&&r.stateNode!=null)t.memoizedProps!==f&&Jr(r);else{if(!f){if(r.stateNode===null)throw Error(o(166));return Yt(r),null}if(I=Q.current,Lo(r))hp(r);else{var K=wc(q.current);switch(I){case 1:I=K.createElementNS("http://www.w3.org/2000/svg",D);break;case 2:I=K.createElementNS("http://www.w3.org/1998/Math/MathML",D);break;default:switch(D){case"svg":I=K.createElementNS("http://www.w3.org/2000/svg",D);break;case"math":I=K.createElementNS("http://www.w3.org/1998/Math/MathML",D);break;case"script":I=K.createElement("div"),I.innerHTML="<script><\/script>",I=I.removeChild(I.firstChild);break;case"select":I=typeof f.is=="string"?K.createElement("select",{is:f.is}):K.createElement("select"),f.multiple?I.multiple=!0:f.size&&(I.size=f.size);break;default:I=typeof f.is=="string"?K.createElement(D,{is:f.is}):K.createElement(D)}}I[Ri]=r,I[xi]=f;e:for(K=r.child;K!==null;){if(K.tag===5||K.tag===6)I.appendChild(K.stateNode);else if(K.tag!==4&&K.tag!==27&&K.child!==null){K.child.return=K,K=K.child;continue}if(K===r)break e;for(;K.sibling===null;){if(K.return===null||K.return===r)break e;K=K.return}K.sibling.return=K.return,K=K.sibling}r.stateNode=I;e:switch(Ci(I,D,f),D){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}f&&Jr(r)}}return Yt(r),Qu(r,r.type,t===null?null:t.memoizedProps,r.pendingProps,a),null;case 6:if(t&&r.stateNode!=null)t.memoizedProps!==f&&Jr(r);else{if(typeof f!="string"&&r.stateNode===null)throw Error(o(166));if(t=q.current,Lo(r)){if(t=r.stateNode,a=r.memoizedProps,f=null,D=_i,D!==null)switch(D.tag){case 27:case 5:f=D.memoizedProps}t[Ri]=r,t=!!(t.nodeValue===a||f!==null&&f.suppressHydrationWarning===!0||Og(t.nodeValue,a)),t||pn(r,!0)}else t=wc(t).createTextNode(f),t[Ri]=r,r.stateNode=t}return Yt(r),null;case 31:if(a=r.memoizedState,t===null||t.memoizedState!==null){if(f=Lo(r),a!==null){if(t===null){if(!f)throw Error(o(318));if(t=r.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(o(557));t[Ri]=r}else Xn(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;Yt(r),t=!1}else a=su(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=a),t=!0;if(!t)return r.flags&256?($i(r),r):($i(r),null);if((r.flags&128)!==0)throw Error(o(558))}return Yt(r),null;case 13:if(f=r.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(D=Lo(r),f!==null&&f.dehydrated!==null){if(t===null){if(!D)throw Error(o(318));if(D=r.memoizedState,D=D!==null?D.dehydrated:null,!D)throw Error(o(317));D[Ri]=r}else Xn(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;Yt(r),D=!1}else D=su(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=D),D=!0;if(!D)return r.flags&256?($i(r),r):($i(r),null)}return $i(r),(r.flags&128)!==0?(r.lanes=a,r):(a=f!==null,t=t!==null&&t.memoizedState!==null,a&&(f=r.child,D=null,f.alternate!==null&&f.alternate.memoizedState!==null&&f.alternate.memoizedState.cachePool!==null&&(D=f.alternate.memoizedState.cachePool.pool),I=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(I=f.memoizedState.cachePool.pool),I!==D&&(f.flags|=2048)),a!==t&&a&&(r.child.flags|=8192),hc(r,r.updateQueue),Yt(r),null);case 4:return $(),t===null&&Sd(r.stateNode.containerInfo),Yt(r),null;case 10:return qr(r.type),Yt(r),null;case 19:if(V(ti),f=r.memoizedState,f===null)return Yt(r),null;if(D=(r.flags&128)!==0,I=f.rendering,I===null)if(D)ja(f,!1);else{if(Zt!==0||t!==null&&(t.flags&128)!==0)for(t=r.child;t!==null;){if(I=Zs(t),I!==null){for(r.flags|=128,ja(f,!1),t=I.updateQueue,r.updateQueue=t,hc(r,t),r.subtreeFlags=0,t=a,a=r.child;a!==null;)sp(a,t),a=a.sibling;return re(ti,ti.current&1|2),Tt&&Gr(r,f.treeForkCount),r.child}t=t.sibling}f.tail!==null&&ze()>vc&&(r.flags|=128,D=!0,ja(f,!1),r.lanes=4194304)}else{if(!D)if(t=Zs(I),t!==null){if(r.flags|=128,D=!0,t=t.updateQueue,r.updateQueue=t,hc(r,t),ja(f,!0),f.tail===null&&f.tailMode==="hidden"&&!I.alternate&&!Tt)return Yt(r),null}else 2*ze()-f.renderingStartTime>vc&&a!==536870912&&(r.flags|=128,D=!0,ja(f,!1),r.lanes=4194304);f.isBackwards?(I.sibling=r.child,r.child=I):(t=f.last,t!==null?t.sibling=I:r.child=I,f.last=I)}return f.tail!==null?(t=f.tail,f.rendering=t,f.tail=t.sibling,f.renderingStartTime=ze(),t.sibling=null,a=ti.current,re(ti,D?a&1|2:a&1),Tt&&Gr(r,f.treeForkCount),t):(Yt(r),null);case 22:case 23:return $i(r),bu(),f=r.memoizedState!==null,t!==null?t.memoizedState!==null!==f&&(r.flags|=8192):f&&(r.flags|=8192),f?(a&536870912)!==0&&(r.flags&128)===0&&(Yt(r),r.subtreeFlags&6&&(r.flags|=8192)):Yt(r),a=r.updateQueue,a!==null&&hc(r,a.retryQueue),a=null,t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(a=t.memoizedState.cachePool.pool),f=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(f=r.memoizedState.cachePool.pool),f!==a&&(r.flags|=2048),t!==null&&V($n),null;case 24:return a=null,t!==null&&(a=t.memoizedState.cache),r.memoizedState.cache!==a&&(r.flags|=2048),qr(ni),Yt(r),null;case 25:return null;case 30:return null}throw Error(o(156,r.tag))}function CE(t,r){switch(ou(r),r.tag){case 1:return t=r.flags,t&65536?(r.flags=t&-65537|128,r):null;case 3:return qr(ni),$(),t=r.flags,(t&65536)!==0&&(t&128)===0?(r.flags=t&-65537|128,r):null;case 26:case 27:case 5:return ie(r),null;case 31:if(r.memoizedState!==null){if($i(r),r.alternate===null)throw Error(o(340));Xn()}return t=r.flags,t&65536?(r.flags=t&-65537|128,r):null;case 13:if($i(r),t=r.memoizedState,t!==null&&t.dehydrated!==null){if(r.alternate===null)throw Error(o(340));Xn()}return t=r.flags,t&65536?(r.flags=t&-65537|128,r):null;case 19:return V(ti),null;case 4:return $(),null;case 10:return qr(r.type),null;case 22:case 23:return $i(r),bu(),t!==null&&V($n),t=r.flags,t&65536?(r.flags=t&-65537|128,r):null;case 24:return qr(ni),null;case 25:return null;default:return null}}function Pm(t,r){switch(ou(r),r.tag){case 3:qr(ni),$();break;case 26:case 27:case 5:ie(r);break;case 4:$();break;case 31:r.memoizedState!==null&&$i(r);break;case 13:$i(r);break;case 19:V(ti);break;case 10:qr(r.type);break;case 22:case 23:$i(r),bu(),t!==null&&V($n);break;case 24:qr(ni)}}function za(t,r){try{var a=r.updateQueue,f=a!==null?a.lastEffect:null;if(f!==null){var D=f.next;a=D;do{if((a.tag&t)===t){f=void 0;var I=a.create,K=a.inst;f=I(),K.destroy=f}a=a.next}while(a!==D)}}catch(ee){Lt(r,r.return,ee)}}function En(t,r,a){try{var f=r.updateQueue,D=f!==null?f.lastEffect:null;if(D!==null){var I=D.next;f=I;do{if((f.tag&t)===t){var K=f.inst,ee=K.destroy;if(ee!==void 0){K.destroy=void 0,D=r;var ce=a,Se=ee;try{Se()}catch(Me){Lt(D,ce,Me)}}}f=f.next}while(f!==I)}}catch(Me){Lt(r,r.return,Me)}}function Lm(t){var r=t.updateQueue;if(r!==null){var a=t.stateNode;try{Ap(r,a)}catch(f){Lt(t,t.return,f)}}}function Um(t,r,a){a.props=ro(t.type,t.memoizedProps),a.state=t.memoizedState;try{a.componentWillUnmount()}catch(f){Lt(t,r,f)}}function Fa(t,r){try{var a=t.ref;if(a!==null){switch(t.tag){case 26:case 27:case 5:var f=t.stateNode;break;case 30:f=t.stateNode;break;default:f=t.stateNode}typeof a=="function"?t.refCleanup=a(f):a.current=f}}catch(D){Lt(t,r,D)}}function Nr(t,r){var a=t.ref,f=t.refCleanup;if(a!==null)if(typeof f=="function")try{f()}catch(D){Lt(t,r,D)}finally{t.refCleanup=null,t=t.alternate,t!=null&&(t.refCleanup=null)}else if(typeof a=="function")try{a(null)}catch(D){Lt(t,r,D)}else a.current=null}function xm(t){var r=t.type,a=t.memoizedProps,f=t.stateNode;try{e:switch(r){case"button":case"input":case"select":case"textarea":a.autoFocus&&f.focus();break e;case"img":a.src?f.src=a.src:a.srcSet&&(f.srcset=a.srcSet)}}catch(D){Lt(t,t.return,D)}}function $u(t,r,a){try{var f=t.stateNode;YE(f,t.type,a,r),f[xi]=r}catch(D){Lt(t,t.return,D)}}function Bm(t){return t.tag===5||t.tag===3||t.tag===26||t.tag===27&&Dn(t.type)||t.tag===4}function Zu(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Bm(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.tag===27&&Dn(t.type)||t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function ed(t,r,a){var f=t.tag;if(f===5||f===6)t=t.stateNode,r?(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a).insertBefore(t,r):(r=a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,r.appendChild(t),a=a._reactRootContainer,a!=null||r.onclick!==null||(r.onclick=jr));else if(f!==4&&(f===27&&Dn(t.type)&&(a=t.stateNode,r=null),t=t.child,t!==null))for(ed(t,r,a),t=t.sibling;t!==null;)ed(t,r,a),t=t.sibling}function fc(t,r,a){var f=t.tag;if(f===5||f===6)t=t.stateNode,r?a.insertBefore(t,r):a.appendChild(t);else if(f!==4&&(f===27&&Dn(t.type)&&(a=t.stateNode),t=t.child,t!==null))for(fc(t,r,a),t=t.sibling;t!==null;)fc(t,r,a),t=t.sibling}function Vm(t){var r=t.stateNode,a=t.memoizedProps;try{for(var f=t.type,D=r.attributes;D.length;)r.removeAttributeNode(D[0]);Ci(r,f,a),r[Ri]=t,r[xi]=a}catch(I){Lt(t,t.return,I)}}var Qr=!1,si=!1,td=!1,Hm=typeof WeakSet=="function"?WeakSet:Set,Si=null;function wE(t,r){if(t=t.containerInfo,Rd=Pc,t=$f(t),Yl(t)){if("selectionStart"in t)var a={start:t.selectionStart,end:t.selectionEnd};else e:{a=(a=t.ownerDocument)&&a.defaultView||window;var f=a.getSelection&&a.getSelection();if(f&&f.rangeCount!==0){a=f.anchorNode;var D=f.anchorOffset,I=f.focusNode;f=f.focusOffset;try{a.nodeType,I.nodeType}catch{a=null;break e}var K=0,ee=-1,ce=-1,Se=0,Me=0,xe=t,Ee=null;t:for(;;){for(var we;xe!==a||D!==0&&xe.nodeType!==3||(ee=K+D),xe!==I||f!==0&&xe.nodeType!==3||(ce=K+f),xe.nodeType===3&&(K+=xe.nodeValue.length),(we=xe.firstChild)!==null;)Ee=xe,xe=we;for(;;){if(xe===t)break t;if(Ee===a&&++Se===D&&(ee=K),Ee===I&&++Me===f&&(ce=K),(we=xe.nextSibling)!==null)break;xe=Ee,Ee=xe.parentNode}xe=we}a=ee===-1||ce===-1?null:{start:ee,end:ce}}else a=null}a=a||{start:0,end:0}}else a=null;for(_d={focusedElem:t,selectionRange:a},Pc=!1,Si=r;Si!==null;)if(r=Si,t=r.child,(r.subtreeFlags&1028)!==0&&t!==null)t.return=r,Si=t;else for(;Si!==null;){switch(r=Si,I=r.alternate,t=r.flags,r.tag){case 0:if((t&4)!==0&&(t=r.updateQueue,t=t!==null?t.events:null,t!==null))for(a=0;a<t.length;a++)D=t[a],D.ref.impl=D.nextImpl;break;case 11:case 15:break;case 1:if((t&1024)!==0&&I!==null){t=void 0,a=r,D=I.memoizedProps,I=I.memoizedState,f=a.stateNode;try{var Xe=ro(a.type,D);t=f.getSnapshotBeforeUpdate(Xe,I),f.__reactInternalSnapshotBeforeUpdate=t}catch(it){Lt(a,a.return,it)}}break;case 3:if((t&1024)!==0){if(t=r.stateNode.containerInfo,a=t.nodeType,a===9)Cd(t);else if(a===1)switch(t.nodeName){case"HEAD":case"HTML":case"BODY":Cd(t);break;default:t.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((t&1024)!==0)throw Error(o(163))}if(t=r.sibling,t!==null){t.return=r.return,Si=t;break}Si=r.return}}function jm(t,r,a){var f=a.flags;switch(a.tag){case 0:case 11:case 15:Zr(t,a),f&4&&za(5,a);break;case 1:if(Zr(t,a),f&4)if(t=a.stateNode,r===null)try{t.componentDidMount()}catch(K){Lt(a,a.return,K)}else{var D=ro(a.type,r.memoizedProps);r=r.memoizedState;try{t.componentDidUpdate(D,r,t.__reactInternalSnapshotBeforeUpdate)}catch(K){Lt(a,a.return,K)}}f&64&&Lm(a),f&512&&Fa(a,a.return);break;case 3:if(Zr(t,a),f&64&&(t=a.updateQueue,t!==null)){if(r=null,a.child!==null)switch(a.child.tag){case 27:case 5:r=a.child.stateNode;break;case 1:r=a.child.stateNode}try{Ap(t,r)}catch(K){Lt(a,a.return,K)}}break;case 27:r===null&&f&4&&Vm(a);case 26:case 5:Zr(t,a),r===null&&f&4&&xm(a),f&512&&Fa(a,a.return);break;case 12:Zr(t,a);break;case 31:Zr(t,a),f&4&&Gm(t,a);break;case 13:Zr(t,a),f&4&&Wm(t,a),f&64&&(t=a.memoizedState,t!==null&&(t=t.dehydrated,t!==null&&(a=UE.bind(null,a),i1(t,a))));break;case 22:if(f=a.memoizedState!==null||Qr,!f){r=r!==null&&r.memoizedState!==null||si,D=Qr;var I=si;Qr=f,(si=r)&&!I?en(t,a,(a.subtreeFlags&8772)!==0):Zr(t,a),Qr=D,si=I}break;case 30:break;default:Zr(t,a)}}function zm(t){var r=t.alternate;r!==null&&(t.alternate=null,zm(r)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(r=t.stateNode,r!==null&&Ml(r)),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}var Jt=null,Vi=!1;function $r(t,r,a){for(a=a.child;a!==null;)Fm(t,r,a),a=a.sibling}function Fm(t,r,a){if(yt&&typeof yt.onCommitFiberUnmount=="function")try{yt.onCommitFiberUnmount(jt,a)}catch{}switch(a.tag){case 26:si||Nr(a,r),$r(t,r,a),a.memoizedState?a.memoizedState.count--:a.stateNode&&(a=a.stateNode,a.parentNode.removeChild(a));break;case 27:si||Nr(a,r);var f=Jt,D=Vi;Dn(a.type)&&(Jt=a.stateNode,Vi=!1),$r(t,r,a),$a(a.stateNode),Jt=f,Vi=D;break;case 5:si||Nr(a,r);case 6:if(f=Jt,D=Vi,Jt=null,$r(t,r,a),Jt=f,Vi=D,Jt!==null)if(Vi)try{(Jt.nodeType===9?Jt.body:Jt.nodeName==="HTML"?Jt.ownerDocument.body:Jt).removeChild(a.stateNode)}catch(I){Lt(a,r,I)}else try{Jt.removeChild(a.stateNode)}catch(I){Lt(a,r,I)}break;case 18:Jt!==null&&(Vi?(t=Jt,Lg(t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t,a.stateNode),ia(t)):Lg(Jt,a.stateNode));break;case 4:f=Jt,D=Vi,Jt=a.stateNode.containerInfo,Vi=!0,$r(t,r,a),Jt=f,Vi=D;break;case 0:case 11:case 14:case 15:En(2,a,r),si||En(4,a,r),$r(t,r,a);break;case 1:si||(Nr(a,r),f=a.stateNode,typeof f.componentWillUnmount=="function"&&Um(a,r,f)),$r(t,r,a);break;case 21:$r(t,r,a);break;case 22:si=(f=si)||a.memoizedState!==null,$r(t,r,a),si=f;break;default:$r(t,r,a)}}function Gm(t,r){if(r.memoizedState===null&&(t=r.alternate,t!==null&&(t=t.memoizedState,t!==null))){t=t.dehydrated;try{ia(t)}catch(a){Lt(r,r.return,a)}}}function Wm(t,r){if(r.memoizedState===null&&(t=r.alternate,t!==null&&(t=t.memoizedState,t!==null&&(t=t.dehydrated,t!==null))))try{ia(t)}catch(a){Lt(r,r.return,a)}}function DE(t){switch(t.tag){case 31:case 13:case 19:var r=t.stateNode;return r===null&&(r=t.stateNode=new Hm),r;case 22:return t=t.stateNode,r=t._retryCache,r===null&&(r=t._retryCache=new Hm),r;default:throw Error(o(435,t.tag))}}function pc(t,r){var a=DE(t);r.forEach(function(f){if(!a.has(f)){a.add(f);var D=xE.bind(null,t,f);f.then(D,D)}})}function Hi(t,r){var a=r.deletions;if(a!==null)for(var f=0;f<a.length;f++){var D=a[f],I=t,K=r,ee=K;e:for(;ee!==null;){switch(ee.tag){case 27:if(Dn(ee.type)){Jt=ee.stateNode,Vi=!1;break e}break;case 5:Jt=ee.stateNode,Vi=!1;break e;case 3:case 4:Jt=ee.stateNode.containerInfo,Vi=!0;break e}ee=ee.return}if(Jt===null)throw Error(o(160));Fm(I,K,D),Jt=null,Vi=!1,I=D.alternate,I!==null&&(I.return=null),D.return=null}if(r.subtreeFlags&13886)for(r=r.child;r!==null;)qm(r,t),r=r.sibling}var _r=null;function qm(t,r){var a=t.alternate,f=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:Hi(r,t),ji(t),f&4&&(En(3,t,t.return),za(3,t),En(5,t,t.return));break;case 1:Hi(r,t),ji(t),f&512&&(si||a===null||Nr(a,a.return)),f&64&&Qr&&(t=t.updateQueue,t!==null&&(f=t.callbacks,f!==null&&(a=t.shared.hiddenCallbacks,t.shared.hiddenCallbacks=a===null?f:a.concat(f))));break;case 26:var D=_r;if(Hi(r,t),ji(t),f&512&&(si||a===null||Nr(a,a.return)),f&4){var I=a!==null?a.memoizedState:null;if(f=t.memoizedState,a===null)if(f===null)if(t.stateNode===null){e:{f=t.type,a=t.memoizedProps,D=D.ownerDocument||D;t:switch(f){case"title":I=D.getElementsByTagName("title")[0],(!I||I[ga]||I[Ri]||I.namespaceURI==="http://www.w3.org/2000/svg"||I.hasAttribute("itemprop"))&&(I=D.createElement(f),D.head.insertBefore(I,D.querySelector("head > title"))),Ci(I,f,a),I[Ri]=t,yi(I),f=I;break e;case"link":var K=qg("link","href",D).get(f+(a.href||""));if(K){for(var ee=0;ee<K.length;ee++)if(I=K[ee],I.getAttribute("href")===(a.href==null||a.href===""?null:a.href)&&I.getAttribute("rel")===(a.rel==null?null:a.rel)&&I.getAttribute("title")===(a.title==null?null:a.title)&&I.getAttribute("crossorigin")===(a.crossOrigin==null?null:a.crossOrigin)){K.splice(ee,1);break t}}I=D.createElement(f),Ci(I,f,a),D.head.appendChild(I);break;case"meta":if(K=qg("meta","content",D).get(f+(a.content||""))){for(ee=0;ee<K.length;ee++)if(I=K[ee],I.getAttribute("content")===(a.content==null?null:""+a.content)&&I.getAttribute("name")===(a.name==null?null:a.name)&&I.getAttribute("property")===(a.property==null?null:a.property)&&I.getAttribute("http-equiv")===(a.httpEquiv==null?null:a.httpEquiv)&&I.getAttribute("charset")===(a.charSet==null?null:a.charSet)){K.splice(ee,1);break t}}I=D.createElement(f),Ci(I,f,a),D.head.appendChild(I);break;default:throw Error(o(468,f))}I[Ri]=t,yi(I),f=I}t.stateNode=f}else Kg(D,t.type,t.stateNode);else t.stateNode=Wg(D,f,t.memoizedProps);else I!==f?(I===null?a.stateNode!==null&&(a=a.stateNode,a.parentNode.removeChild(a)):I.count--,f===null?Kg(D,t.type,t.stateNode):Wg(D,f,t.memoizedProps)):f===null&&t.stateNode!==null&&$u(t,t.memoizedProps,a.memoizedProps)}break;case 27:Hi(r,t),ji(t),f&512&&(si||a===null||Nr(a,a.return)),a!==null&&f&4&&$u(t,t.memoizedProps,a.memoizedProps);break;case 5:if(Hi(r,t),ji(t),f&512&&(si||a===null||Nr(a,a.return)),t.flags&32){D=t.stateNode;try{Ao(D,"")}catch(Xe){Lt(t,t.return,Xe)}}f&4&&t.stateNode!=null&&(D=t.memoizedProps,$u(t,D,a!==null?a.memoizedProps:D)),f&1024&&(td=!0);break;case 6:if(Hi(r,t),ji(t),f&4){if(t.stateNode===null)throw Error(o(162));f=t.memoizedProps,a=t.stateNode;try{a.nodeValue=f}catch(Xe){Lt(t,t.return,Xe)}}break;case 3:if(Ic=null,D=_r,_r=Dc(r.containerInfo),Hi(r,t),_r=D,ji(t),f&4&&a!==null&&a.memoizedState.isDehydrated)try{ia(r.containerInfo)}catch(Xe){Lt(t,t.return,Xe)}td&&(td=!1,Km(t));break;case 4:f=_r,_r=Dc(t.stateNode.containerInfo),Hi(r,t),ji(t),_r=f;break;case 12:Hi(r,t),ji(t);break;case 31:Hi(r,t),ji(t),f&4&&(f=t.updateQueue,f!==null&&(t.updateQueue=null,pc(t,f)));break;case 13:Hi(r,t),ji(t),t.child.flags&8192&&t.memoizedState!==null!=(a!==null&&a.memoizedState!==null)&&(gc=ze()),f&4&&(f=t.updateQueue,f!==null&&(t.updateQueue=null,pc(t,f)));break;case 22:D=t.memoizedState!==null;var ce=a!==null&&a.memoizedState!==null,Se=Qr,Me=si;if(Qr=Se||D,si=Me||ce,Hi(r,t),si=Me,Qr=Se,ji(t),f&8192)e:for(r=t.stateNode,r._visibility=D?r._visibility&-2:r._visibility|1,D&&(a===null||ce||Qr||si||no(t)),a=null,r=t;;){if(r.tag===5||r.tag===26){if(a===null){ce=a=r;try{if(I=ce.stateNode,D)K=I.style,typeof K.setProperty=="function"?K.setProperty("display","none","important"):K.display="none";else{ee=ce.stateNode;var xe=ce.memoizedProps.style,Ee=xe!=null&&xe.hasOwnProperty("display")?xe.display:null;ee.style.display=Ee==null||typeof Ee=="boolean"?"":(""+Ee).trim()}}catch(Xe){Lt(ce,ce.return,Xe)}}}else if(r.tag===6){if(a===null){ce=r;try{ce.stateNode.nodeValue=D?"":ce.memoizedProps}catch(Xe){Lt(ce,ce.return,Xe)}}}else if(r.tag===18){if(a===null){ce=r;try{var we=ce.stateNode;D?Ug(we,!0):Ug(ce.stateNode,!1)}catch(Xe){Lt(ce,ce.return,Xe)}}}else if((r.tag!==22&&r.tag!==23||r.memoizedState===null||r===t)&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break e;for(;r.sibling===null;){if(r.return===null||r.return===t)break e;a===r&&(a=null),r=r.return}a===r&&(a=null),r.sibling.return=r.return,r=r.sibling}f&4&&(f=t.updateQueue,f!==null&&(a=f.retryQueue,a!==null&&(f.retryQueue=null,pc(t,a))));break;case 19:Hi(r,t),ji(t),f&4&&(f=t.updateQueue,f!==null&&(t.updateQueue=null,pc(t,f)));break;case 30:break;case 21:break;default:Hi(r,t),ji(t)}}function ji(t){var r=t.flags;if(r&2){try{for(var a,f=t.return;f!==null;){if(Bm(f)){a=f;break}f=f.return}if(a==null)throw Error(o(160));switch(a.tag){case 27:var D=a.stateNode,I=Zu(t);fc(t,I,D);break;case 5:var K=a.stateNode;a.flags&32&&(Ao(K,""),a.flags&=-33);var ee=Zu(t);fc(t,ee,K);break;case 3:case 4:var ce=a.stateNode.containerInfo,Se=Zu(t);ed(t,Se,ce);break;default:throw Error(o(161))}}catch(Me){Lt(t,t.return,Me)}t.flags&=-3}r&4096&&(t.flags&=-4097)}function Km(t){if(t.subtreeFlags&1024)for(t=t.child;t!==null;){var r=t;Km(r),r.tag===5&&r.flags&1024&&r.stateNode.reset(),t=t.sibling}}function Zr(t,r){if(r.subtreeFlags&8772)for(r=r.child;r!==null;)jm(t,r.alternate,r),r=r.sibling}function no(t){for(t=t.child;t!==null;){var r=t;switch(r.tag){case 0:case 11:case 14:case 15:En(4,r,r.return),no(r);break;case 1:Nr(r,r.return);var a=r.stateNode;typeof a.componentWillUnmount=="function"&&Um(r,r.return,a),no(r);break;case 27:$a(r.stateNode);case 26:case 5:Nr(r,r.return),no(r);break;case 22:r.memoizedState===null&&no(r);break;case 30:no(r);break;default:no(r)}t=t.sibling}}function en(t,r,a){for(a=a&&(r.subtreeFlags&8772)!==0,r=r.child;r!==null;){var f=r.alternate,D=t,I=r,K=I.flags;switch(I.tag){case 0:case 11:case 15:en(D,I,a),za(4,I);break;case 1:if(en(D,I,a),f=I,D=f.stateNode,typeof D.componentDidMount=="function")try{D.componentDidMount()}catch(Se){Lt(f,f.return,Se)}if(f=I,D=f.updateQueue,D!==null){var ee=f.stateNode;try{var ce=D.shared.hiddenCallbacks;if(ce!==null)for(D.shared.hiddenCallbacks=null,D=0;D<ce.length;D++)Tp(ce[D],ee)}catch(Se){Lt(f,f.return,Se)}}a&&K&64&&Lm(I),Fa(I,I.return);break;case 27:Vm(I);case 26:case 5:en(D,I,a),a&&f===null&&K&4&&xm(I),Fa(I,I.return);break;case 12:en(D,I,a);break;case 31:en(D,I,a),a&&K&4&&Gm(D,I);break;case 13:en(D,I,a),a&&K&4&&Wm(D,I);break;case 22:I.memoizedState===null&&en(D,I,a),Fa(I,I.return);break;case 30:break;default:en(D,I,a)}r=r.sibling}}function id(t,r){var a=null;t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(a=t.memoizedState.cachePool.pool),t=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(t=r.memoizedState.cachePool.pool),t!==a&&(t!=null&&t.refCount++,a!=null&&Oa(a))}function rd(t,r){t=null,r.alternate!==null&&(t=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==t&&(r.refCount++,t!=null&&Oa(t))}function Tr(t,r,a,f){if(r.subtreeFlags&10256)for(r=r.child;r!==null;)Ym(t,r,a,f),r=r.sibling}function Ym(t,r,a,f){var D=r.flags;switch(r.tag){case 0:case 11:case 15:Tr(t,r,a,f),D&2048&&za(9,r);break;case 1:Tr(t,r,a,f);break;case 3:Tr(t,r,a,f),D&2048&&(t=null,r.alternate!==null&&(t=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==t&&(r.refCount++,t!=null&&Oa(t)));break;case 12:if(D&2048){Tr(t,r,a,f),t=r.stateNode;try{var I=r.memoizedProps,K=I.id,ee=I.onPostCommit;typeof ee=="function"&&ee(K,r.alternate===null?"mount":"update",t.passiveEffectDuration,-0)}catch(ce){Lt(r,r.return,ce)}}else Tr(t,r,a,f);break;case 31:Tr(t,r,a,f);break;case 13:Tr(t,r,a,f);break;case 23:break;case 22:I=r.stateNode,K=r.alternate,r.memoizedState!==null?I._visibility&2?Tr(t,r,a,f):Ga(t,r):I._visibility&2?Tr(t,r,a,f):(I._visibility|=2,Wo(t,r,a,f,(r.subtreeFlags&10256)!==0||!1)),D&2048&&id(K,r);break;case 24:Tr(t,r,a,f),D&2048&&rd(r.alternate,r);break;default:Tr(t,r,a,f)}}function Wo(t,r,a,f,D){for(D=D&&((r.subtreeFlags&10256)!==0||!1),r=r.child;r!==null;){var I=t,K=r,ee=a,ce=f,Se=K.flags;switch(K.tag){case 0:case 11:case 15:Wo(I,K,ee,ce,D),za(8,K);break;case 23:break;case 22:var Me=K.stateNode;K.memoizedState!==null?Me._visibility&2?Wo(I,K,ee,ce,D):Ga(I,K):(Me._visibility|=2,Wo(I,K,ee,ce,D)),D&&Se&2048&&id(K.alternate,K);break;case 24:Wo(I,K,ee,ce,D),D&&Se&2048&&rd(K.alternate,K);break;default:Wo(I,K,ee,ce,D)}r=r.sibling}}function Ga(t,r){if(r.subtreeFlags&10256)for(r=r.child;r!==null;){var a=t,f=r,D=f.flags;switch(f.tag){case 22:Ga(a,f),D&2048&&id(f.alternate,f);break;case 24:Ga(a,f),D&2048&&rd(f.alternate,f);break;default:Ga(a,f)}r=r.sibling}}var Wa=8192;function qo(t,r,a){if(t.subtreeFlags&Wa)for(t=t.child;t!==null;)Xm(t,r,a),t=t.sibling}function Xm(t,r,a){switch(t.tag){case 26:qo(t,r,a),t.flags&Wa&&t.memoizedState!==null&&p1(a,_r,t.memoizedState,t.memoizedProps);break;case 5:qo(t,r,a);break;case 3:case 4:var f=_r;_r=Dc(t.stateNode.containerInfo),qo(t,r,a),_r=f;break;case 22:t.memoizedState===null&&(f=t.alternate,f!==null&&f.memoizedState!==null?(f=Wa,Wa=16777216,qo(t,r,a),Wa=f):qo(t,r,a));break;default:qo(t,r,a)}}function Jm(t){var r=t.alternate;if(r!==null&&(t=r.child,t!==null)){r.child=null;do r=t.sibling,t.sibling=null,t=r;while(t!==null)}}function qa(t){var r=t.deletions;if((t.flags&16)!==0){if(r!==null)for(var a=0;a<r.length;a++){var f=r[a];Si=f,$m(f,t)}Jm(t)}if(t.subtreeFlags&10256)for(t=t.child;t!==null;)Qm(t),t=t.sibling}function Qm(t){switch(t.tag){case 0:case 11:case 15:qa(t),t.flags&2048&&En(9,t,t.return);break;case 3:qa(t);break;case 12:qa(t);break;case 22:var r=t.stateNode;t.memoizedState!==null&&r._visibility&2&&(t.return===null||t.return.tag!==13)?(r._visibility&=-3,mc(t)):qa(t);break;default:qa(t)}}function mc(t){var r=t.deletions;if((t.flags&16)!==0){if(r!==null)for(var a=0;a<r.length;a++){var f=r[a];Si=f,$m(f,t)}Jm(t)}for(t=t.child;t!==null;){switch(r=t,r.tag){case 0:case 11:case 15:En(8,r,r.return),mc(r);break;case 22:a=r.stateNode,a._visibility&2&&(a._visibility&=-3,mc(r));break;default:mc(r)}t=t.sibling}}function $m(t,r){for(;Si!==null;){var a=Si;switch(a.tag){case 0:case 11:case 15:En(8,a,r);break;case 23:case 22:if(a.memoizedState!==null&&a.memoizedState.cachePool!==null){var f=a.memoizedState.cachePool.pool;f!=null&&f.refCount++}break;case 24:Oa(a.memoizedState.cache)}if(f=a.child,f!==null)f.return=a,Si=f;else e:for(a=t;Si!==null;){f=Si;var D=f.sibling,I=f.return;if(zm(f),f===a){Si=null;break e}if(D!==null){D.return=I,Si=D;break e}Si=I}}}var OE={getCacheForType:function(t){var r=Ti(ni),a=r.data.get(t);return a===void 0&&(a=t(),r.data.set(t,a)),a},cacheSignal:function(){return Ti(ni).controller.signal}},IE=typeof WeakMap=="function"?WeakMap:Map,Mt=0,zt=null,mt=null,St=0,Pt=0,Zi=null,Rn=!1,Ko=!1,nd=!1,tn=0,Zt=0,_n=0,oo=0,od=0,er=0,Yo=0,Ka=null,zi=null,ad=!1,gc=0,Zm=0,vc=1/0,yc=null,Tn=null,pi=0,An=null,Xo=null,rn=0,sd=0,cd=null,eg=null,Ya=0,ld=null;function tr(){return(Mt&2)!==0&&St!==0?St&-St:N.T!==null?md():gf()}function tg(){if(er===0)if((St&536870912)===0||Tt){var t=oe;oe<<=1,(oe&3932160)===0&&(oe=262144),er=t}else er=536870912;return t=Qi.current,t!==null&&(t.flags|=32),er}function Fi(t,r,a){(t===zt&&(Pt===2||Pt===9)||t.cancelPendingCommit!==null)&&(Jo(t,0),Cn(t,St,er,!1)),Ke(t,a),((Mt&2)===0||t!==zt)&&(t===zt&&((Mt&2)===0&&(oo|=a),Zt===4&&Cn(t,St,er,!1)),kr(t))}function ig(t,r,a){if((Mt&6)!==0)throw Error(o(327));var f=!a&&(r&127)===0&&(r&t.expiredLanes)===0||Oe(t,r),D=f?kE(t,r):dd(t,r,!0),I=f;do{if(D===0){Ko&&!f&&Cn(t,r,0,!1);break}else{if(a=t.current.alternate,I&&!ME(a)){D=dd(t,r,!1),I=!1;continue}if(D===2){if(I=r,t.errorRecoveryDisabledLanes&I)var K=0;else K=t.pendingLanes&-536870913,K=K!==0?K:K&536870912?536870912:0;if(K!==0){r=K;e:{var ee=t;D=Ka;var ce=ee.current.memoizedState.isDehydrated;if(ce&&(Jo(ee,K).flags|=256),K=dd(ee,K,!1),K!==2){if(nd&&!ce){ee.errorRecoveryDisabledLanes|=I,oo|=I,D=4;break e}I=zi,zi=D,I!==null&&(zi===null?zi=I:zi.push.apply(zi,I))}D=K}if(I=!1,D!==2)continue}}if(D===1){Jo(t,0),Cn(t,r,0,!0);break}e:{switch(f=t,I=D,I){case 0:case 1:throw Error(o(345));case 4:if((r&4194048)!==r)break;case 6:Cn(f,r,er,!Rn);break e;case 2:zi=null;break;case 3:case 5:break;default:throw Error(o(329))}if((r&62914560)===r&&(D=gc+300-ze(),10<D)){if(Cn(f,r,er,!Rn),le(f,0,!0)!==0)break e;rn=r,f.timeoutHandle=kg(rg.bind(null,f,a,zi,yc,ad,r,er,oo,Yo,Rn,I,"Throttled",-0,0),D);break e}rg(f,a,zi,yc,ad,r,er,oo,Yo,Rn,I,null,-0,0)}}break}while(!0);kr(t)}function rg(t,r,a,f,D,I,K,ee,ce,Se,Me,xe,Ee,we){if(t.timeoutHandle=-1,xe=r.subtreeFlags,xe&8192||(xe&16785408)===16785408){xe={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:jr},Xm(r,I,xe);var Xe=(I&62914560)===I?gc-ze():(I&4194048)===I?Zm-ze():0;if(Xe=m1(xe,Xe),Xe!==null){rn=I,t.cancelPendingCommit=Xe(dg.bind(null,t,r,I,a,f,D,K,ee,ce,Me,xe,null,Ee,we)),Cn(t,I,K,!Se);return}}dg(t,r,I,a,f,D,K,ee,ce)}function ME(t){for(var r=t;;){var a=r.tag;if((a===0||a===11||a===15)&&r.flags&16384&&(a=r.updateQueue,a!==null&&(a=a.stores,a!==null)))for(var f=0;f<a.length;f++){var D=a[f],I=D.getSnapshot;D=D.value;try{if(!Xi(I(),D))return!1}catch{return!1}}if(a=r.child,r.subtreeFlags&16384&&a!==null)a.return=r,r=a;else{if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function Cn(t,r,a,f){r&=~od,r&=~oo,t.suspendedLanes|=r,t.pingedLanes&=~r,f&&(t.warmLanes|=r),f=t.expirationTimes;for(var D=r;0<D;){var I=31-kt(D),K=1<<I;f[I]=-1,D&=~K}a!==0&&Ni(t,a,r)}function Sc(){return(Mt&6)===0?(Xa(0),!1):!0}function ud(){if(mt!==null){if(Pt===0)var t=mt.return;else t=mt,Wr=Jn=null,Cu(t),Ho=null,Ma=0,t=mt;for(;t!==null;)Pm(t.alternate,t),t=t.return;mt=null}}function Jo(t,r){var a=t.timeoutHandle;a!==-1&&(t.timeoutHandle=-1,QE(a)),a=t.cancelPendingCommit,a!==null&&(t.cancelPendingCommit=null,a()),rn=0,ud(),zt=t,mt=a=Fr(t.current,null),St=r,Pt=0,Zi=null,Rn=!1,Ko=Oe(t,r),nd=!1,Yo=er=od=oo=_n=Zt=0,zi=Ka=null,ad=!1,(r&8)!==0&&(r|=r&32);var f=t.entangledLanes;if(f!==0)for(t=t.entanglements,f&=r;0<f;){var D=31-kt(f),I=1<<D;r|=t[D],f&=~I}return tn=r,Hs(),a}function ng(t,r){st=null,N.H=Va,r===Vo||r===Ys?(r=bp(),Pt=3):r===pu?(r=bp(),Pt=4):Pt=r===zu?8:r!==null&&typeof r=="object"&&typeof r.then=="function"?6:1,Zi=r,mt===null&&(Zt=1,cc(t,cr(r,t.current)))}function og(){var t=Qi.current;return t===null?!0:(St&4194048)===St?hr===null:(St&62914560)===St||(St&536870912)!==0?t===hr:!1}function ag(){var t=N.H;return N.H=Va,t===null?Va:t}function sg(){var t=N.A;return N.A=OE,t}function bc(){Zt=4,Rn||(St&4194048)!==St&&Qi.current!==null||(Ko=!0),(_n&134217727)===0&&(oo&134217727)===0||zt===null||Cn(zt,St,er,!1)}function dd(t,r,a){var f=Mt;Mt|=2;var D=ag(),I=sg();(zt!==t||St!==r)&&(yc=null,Jo(t,r)),r=!1;var K=Zt;e:do try{if(Pt!==0&&mt!==null){var ee=mt,ce=Zi;switch(Pt){case 8:ud(),K=6;break e;case 3:case 2:case 9:case 6:Qi.current===null&&(r=!0);var Se=Pt;if(Pt=0,Zi=null,Qo(t,ee,ce,Se),a&&Ko){K=0;break e}break;default:Se=Pt,Pt=0,Zi=null,Qo(t,ee,ce,Se)}}NE(),K=Zt;break}catch(Me){ng(t,Me)}while(!0);return r&&t.shellSuspendCounter++,Wr=Jn=null,Mt=f,N.H=D,N.A=I,mt===null&&(zt=null,St=0,Hs()),K}function NE(){for(;mt!==null;)cg(mt)}function kE(t,r){var a=Mt;Mt|=2;var f=ag(),D=sg();zt!==t||St!==r?(yc=null,vc=ze()+500,Jo(t,r)):Ko=Oe(t,r);e:do try{if(Pt!==0&&mt!==null){r=mt;var I=Zi;t:switch(Pt){case 1:Pt=0,Zi=null,Qo(t,r,I,1);break;case 2:case 9:if(yp(I)){Pt=0,Zi=null,lg(r);break}r=function(){Pt!==2&&Pt!==9||zt!==t||(Pt=7),kr(t)},I.then(r,r);break e;case 3:Pt=7;break e;case 4:Pt=5;break e;case 7:yp(I)?(Pt=0,Zi=null,lg(r)):(Pt=0,Zi=null,Qo(t,r,I,7));break;case 5:var K=null;switch(mt.tag){case 26:K=mt.memoizedState;case 5:case 27:var ee=mt;if(K?Yg(K):ee.stateNode.complete){Pt=0,Zi=null;var ce=ee.sibling;if(ce!==null)mt=ce;else{var Se=ee.return;Se!==null?(mt=Se,Ec(Se)):mt=null}break t}}Pt=0,Zi=null,Qo(t,r,I,5);break;case 6:Pt=0,Zi=null,Qo(t,r,I,6);break;case 8:ud(),Zt=6;break e;default:throw Error(o(462))}}PE();break}catch(Me){ng(t,Me)}while(!0);return Wr=Jn=null,N.H=f,N.A=D,Mt=a,mt!==null?0:(zt=null,St=0,Hs(),Zt)}function PE(){for(;mt!==null&&!$e();)cg(mt)}function cg(t){var r=Nm(t.alternate,t,tn);t.memoizedProps=t.pendingProps,r===null?Ec(t):mt=r}function lg(t){var r=t,a=r.alternate;switch(r.tag){case 15:case 0:r=Cm(a,r,r.pendingProps,r.type,void 0,St);break;case 11:r=Cm(a,r,r.pendingProps,r.type.render,r.ref,St);break;case 5:Cu(r);default:Pm(a,r),r=mt=sp(r,tn),r=Nm(a,r,tn)}t.memoizedProps=t.pendingProps,r===null?Ec(t):mt=r}function Qo(t,r,a,f){Wr=Jn=null,Cu(r),Ho=null,Ma=0;var D=r.return;try{if(RE(t,D,r,a,St)){Zt=1,cc(t,cr(a,t.current)),mt=null;return}}catch(I){if(D!==null)throw mt=D,I;Zt=1,cc(t,cr(a,t.current)),mt=null;return}r.flags&32768?(Tt||f===1?t=!0:Ko||(St&536870912)!==0?t=!1:(Rn=t=!0,(f===2||f===9||f===3||f===6)&&(f=Qi.current,f!==null&&f.tag===13&&(f.flags|=16384))),ug(r,t)):Ec(r)}function Ec(t){var r=t;do{if((r.flags&32768)!==0){ug(r,Rn);return}t=r.return;var a=AE(r.alternate,r,tn);if(a!==null){mt=a;return}if(r=r.sibling,r!==null){mt=r;return}mt=r=t}while(r!==null);Zt===0&&(Zt=5)}function ug(t,r){do{var a=CE(t.alternate,t);if(a!==null){a.flags&=32767,mt=a;return}if(a=t.return,a!==null&&(a.flags|=32768,a.subtreeFlags=0,a.deletions=null),!r&&(t=t.sibling,t!==null)){mt=t;return}mt=t=a}while(t!==null);Zt=6,mt=null}function dg(t,r,a,f,D,I,K,ee,ce){t.cancelPendingCommit=null;do Rc();while(pi!==0);if((Mt&6)!==0)throw Error(o(327));if(r!==null){if(r===t.current)throw Error(o(177));if(I=r.lanes|r.childLanes,I|=Zl,nt(t,a,I,K,ee,ce),t===zt&&(mt=zt=null,St=0),Xo=r,An=t,rn=a,sd=I,cd=D,eg=f,(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?(t.callbackNode=null,t.callbackPriority=0,BE(dt,function(){return gg(),null})):(t.callbackNode=null,t.callbackPriority=0),f=(r.flags&13878)!==0,(r.subtreeFlags&13878)!==0||f){f=N.T,N.T=null,D=k.p,k.p=2,K=Mt,Mt|=4;try{wE(t,r,a)}finally{Mt=K,k.p=D,N.T=f}}pi=1,hg(),fg(),pg()}}function hg(){if(pi===1){pi=0;var t=An,r=Xo,a=(r.flags&13878)!==0;if((r.subtreeFlags&13878)!==0||a){a=N.T,N.T=null;var f=k.p;k.p=2;var D=Mt;Mt|=4;try{qm(r,t);var I=_d,K=$f(t.containerInfo),ee=I.focusedElem,ce=I.selectionRange;if(K!==ee&&ee&&ee.ownerDocument&&Qf(ee.ownerDocument.documentElement,ee)){if(ce!==null&&Yl(ee)){var Se=ce.start,Me=ce.end;if(Me===void 0&&(Me=Se),"selectionStart"in ee)ee.selectionStart=Se,ee.selectionEnd=Math.min(Me,ee.value.length);else{var xe=ee.ownerDocument||document,Ee=xe&&xe.defaultView||window;if(Ee.getSelection){var we=Ee.getSelection(),Xe=ee.textContent.length,it=Math.min(ce.start,Xe),Bt=ce.end===void 0?it:Math.min(ce.end,Xe);!we.extend&&it>Bt&&(K=Bt,Bt=it,it=K);var me=Jf(ee,it),ue=Jf(ee,Bt);if(me&&ue&&(we.rangeCount!==1||we.anchorNode!==me.node||we.anchorOffset!==me.offset||we.focusNode!==ue.node||we.focusOffset!==ue.offset)){var ye=xe.createRange();ye.setStart(me.node,me.offset),we.removeAllRanges(),it>Bt?(we.addRange(ye),we.extend(ue.node,ue.offset)):(ye.setEnd(ue.node,ue.offset),we.addRange(ye))}}}}for(xe=[],we=ee;we=we.parentNode;)we.nodeType===1&&xe.push({element:we,left:we.scrollLeft,top:we.scrollTop});for(typeof ee.focus=="function"&&ee.focus(),ee=0;ee<xe.length;ee++){var Pe=xe[ee];Pe.element.scrollLeft=Pe.left,Pe.element.scrollTop=Pe.top}}Pc=!!Rd,_d=Rd=null}finally{Mt=D,k.p=f,N.T=a}}t.current=r,pi=2}}function fg(){if(pi===2){pi=0;var t=An,r=Xo,a=(r.flags&8772)!==0;if((r.subtreeFlags&8772)!==0||a){a=N.T,N.T=null;var f=k.p;k.p=2;var D=Mt;Mt|=4;try{jm(t,r.alternate,r)}finally{Mt=D,k.p=f,N.T=a}}pi=3}}function pg(){if(pi===4||pi===3){pi=0,Ne();var t=An,r=Xo,a=rn,f=eg;(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?pi=5:(pi=0,Xo=An=null,mg(t,t.pendingLanes));var D=t.pendingLanes;if(D===0&&(Tn=null),Ol(a),r=r.stateNode,yt&&typeof yt.onCommitFiberRoot=="function")try{yt.onCommitFiberRoot(jt,r,void 0,(r.current.flags&128)===128)}catch{}if(f!==null){r=N.T,D=k.p,k.p=2,N.T=null;try{for(var I=t.onRecoverableError,K=0;K<f.length;K++){var ee=f[K];I(ee.value,{componentStack:ee.stack})}}finally{N.T=r,k.p=D}}(rn&3)!==0&&Rc(),kr(t),D=t.pendingLanes,(a&261930)!==0&&(D&42)!==0?t===ld?Ya++:(Ya=0,ld=t):Ya=0,Xa(0)}}function mg(t,r){(t.pooledCacheLanes&=r)===0&&(r=t.pooledCache,r!=null&&(t.pooledCache=null,Oa(r)))}function Rc(){return hg(),fg(),pg(),gg()}function gg(){if(pi!==5)return!1;var t=An,r=sd;sd=0;var a=Ol(rn),f=N.T,D=k.p;try{k.p=32>a?32:a,N.T=null,a=cd,cd=null;var I=An,K=rn;if(pi=0,Xo=An=null,rn=0,(Mt&6)!==0)throw Error(o(331));var ee=Mt;if(Mt|=4,Qm(I.current),Ym(I,I.current,K,a),Mt=ee,Xa(0,!1),yt&&typeof yt.onPostCommitFiberRoot=="function")try{yt.onPostCommitFiberRoot(jt,I)}catch{}return!0}finally{k.p=D,N.T=f,mg(t,r)}}function vg(t,r,a){r=cr(a,r),r=ju(t.stateNode,r,2),t=yn(t,r,2),t!==null&&(Ke(t,2),kr(t))}function Lt(t,r,a){if(t.tag===3)vg(t,t,a);else for(;r!==null;){if(r.tag===3){vg(r,t,a);break}else if(r.tag===1){var f=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(Tn===null||!Tn.has(f))){t=cr(a,t),a=ym(2),f=yn(r,a,2),f!==null&&(Sm(a,f,r,t),Ke(f,2),kr(f));break}}r=r.return}}function hd(t,r,a){var f=t.pingCache;if(f===null){f=t.pingCache=new IE;var D=new Set;f.set(r,D)}else D=f.get(r),D===void 0&&(D=new Set,f.set(r,D));D.has(a)||(nd=!0,D.add(a),t=LE.bind(null,t,r,a),r.then(t,t))}function LE(t,r,a){var f=t.pingCache;f!==null&&f.delete(r),t.pingedLanes|=t.suspendedLanes&a,t.warmLanes&=~a,zt===t&&(St&a)===a&&(Zt===4||Zt===3&&(St&62914560)===St&&300>ze()-gc?(Mt&2)===0&&Jo(t,0):od|=a,Yo===St&&(Yo=0)),kr(t)}function yg(t,r){r===0&&(r=Ue()),t=Kn(t,r),t!==null&&(Ke(t,r),kr(t))}function UE(t){var r=t.memoizedState,a=0;r!==null&&(a=r.retryLane),yg(t,a)}function xE(t,r){var a=0;switch(t.tag){case 31:case 13:var f=t.stateNode,D=t.memoizedState;D!==null&&(a=D.retryLane);break;case 19:f=t.stateNode;break;case 22:f=t.stateNode._retryCache;break;default:throw Error(o(314))}f!==null&&f.delete(r),yg(t,a)}function BE(t,r){return Le(t,r)}var _c=null,$o=null,fd=!1,Tc=!1,pd=!1,wn=0;function kr(t){t!==$o&&t.next===null&&($o===null?_c=$o=t:$o=$o.next=t),Tc=!0,fd||(fd=!0,HE())}function Xa(t,r){if(!pd&&Tc){pd=!0;do for(var a=!1,f=_c;f!==null;){if(t!==0){var D=f.pendingLanes;if(D===0)var I=0;else{var K=f.suspendedLanes,ee=f.pingedLanes;I=(1<<31-kt(42|t)+1)-1,I&=D&~(K&~ee),I=I&201326741?I&201326741|1:I?I|2:0}I!==0&&(a=!0,Rg(f,I))}else I=St,I=le(f,f===zt?I:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),(I&3)===0||Oe(f,I)||(a=!0,Rg(f,I));f=f.next}while(a);pd=!1}}function VE(){Sg()}function Sg(){Tc=fd=!1;var t=0;wn!==0&&JE()&&(t=wn);for(var r=ze(),a=null,f=_c;f!==null;){var D=f.next,I=bg(f,r);I===0?(f.next=null,a===null?_c=D:a.next=D,D===null&&($o=a)):(a=f,(t!==0||(I&3)!==0)&&(Tc=!0)),f=D}pi!==0&&pi!==5||Xa(t),wn!==0&&(wn=0)}function bg(t,r){for(var a=t.suspendedLanes,f=t.pingedLanes,D=t.expirationTimes,I=t.pendingLanes&-62914561;0<I;){var K=31-kt(I),ee=1<<K,ce=D[K];ce===-1?((ee&a)===0||(ee&f)!==0)&&(D[K]=_e(ee,r)):ce<=r&&(t.expiredLanes|=ee),I&=~ee}if(r=zt,a=St,a=le(t,t===r?a:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),f=t.callbackNode,a===0||t===r&&(Pt===2||Pt===9)||t.cancelPendingCommit!==null)return f!==null&&f!==null&&Be(f),t.callbackNode=null,t.callbackPriority=0;if((a&3)===0||Oe(t,a)){if(r=a&-a,r===t.callbackPriority)return r;switch(f!==null&&Be(f),Ol(a)){case 2:case 8:a=It;break;case 32:a=dt;break;case 268435456:a=_t;break;default:a=dt}return f=Eg.bind(null,t),a=Le(a,f),t.callbackPriority=r,t.callbackNode=a,r}return f!==null&&f!==null&&Be(f),t.callbackPriority=2,t.callbackNode=null,2}function Eg(t,r){if(pi!==0&&pi!==5)return t.callbackNode=null,t.callbackPriority=0,null;var a=t.callbackNode;if(Rc()&&t.callbackNode!==a)return null;var f=St;return f=le(t,t===zt?f:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),f===0?null:(ig(t,f,r),bg(t,ze()),t.callbackNode!=null&&t.callbackNode===a?Eg.bind(null,t):null)}function Rg(t,r){if(Rc())return null;ig(t,r,!0)}function HE(){$E(function(){(Mt&6)!==0?Le(rt,VE):Sg()})}function md(){if(wn===0){var t=xo;t===0&&(t=ne,ne<<=1,(ne&261888)===0&&(ne=256)),wn=t}return wn}function _g(t){return t==null||typeof t=="symbol"||typeof t=="boolean"?null:typeof t=="function"?t:Ns(""+t)}function Tg(t,r){var a=r.ownerDocument.createElement("input");return a.name=r.name,a.value=r.value,t.id&&a.setAttribute("form",t.id),r.parentNode.insertBefore(a,r),t=new FormData(t),a.parentNode.removeChild(a),t}function jE(t,r,a,f,D){if(r==="submit"&&a&&a.stateNode===D){var I=_g((D[xi]||null).action),K=f.submitter;K&&(r=(r=K[xi]||null)?_g(r.formAction):K.getAttribute("formAction"),r!==null&&(I=r,K=null));var ee=new Us("action","action",null,f,D);t.push({event:ee,listeners:[{instance:null,listener:function(){if(f.defaultPrevented){if(wn!==0){var ce=K?Tg(D,K):new FormData(D);Lu(a,{pending:!0,data:ce,method:D.method,action:I},null,ce)}}else typeof I=="function"&&(ee.preventDefault(),ce=K?Tg(D,K):new FormData(D),Lu(a,{pending:!0,data:ce,method:D.method,action:I},I,ce))},currentTarget:D}]})}}for(var gd=0;gd<$l.length;gd++){var vd=$l[gd],zE=vd.toLowerCase(),FE=vd[0].toUpperCase()+vd.slice(1);Rr(zE,"on"+FE)}Rr(tp,"onAnimationEnd"),Rr(ip,"onAnimationIteration"),Rr(rp,"onAnimationStart"),Rr("dblclick","onDoubleClick"),Rr("focusin","onFocus"),Rr("focusout","onBlur"),Rr(oE,"onTransitionRun"),Rr(aE,"onTransitionStart"),Rr(sE,"onTransitionCancel"),Rr(np,"onTransitionEnd"),_o("onMouseEnter",["mouseout","mouseover"]),_o("onMouseLeave",["mouseout","mouseover"]),_o("onPointerEnter",["pointerout","pointerover"]),_o("onPointerLeave",["pointerout","pointerover"]),Fn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Fn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Fn("onBeforeInput",["compositionend","keypress","textInput","paste"]),Fn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Fn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Fn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ja="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),GE=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Ja));function Ag(t,r){r=(r&4)!==0;for(var a=0;a<t.length;a++){var f=t[a],D=f.event;f=f.listeners;e:{var I=void 0;if(r)for(var K=f.length-1;0<=K;K--){var ee=f[K],ce=ee.instance,Se=ee.currentTarget;if(ee=ee.listener,ce!==I&&D.isPropagationStopped())break e;I=ee,D.currentTarget=Se;try{I(D)}catch(Me){Vs(Me)}D.currentTarget=null,I=ce}else for(K=0;K<f.length;K++){if(ee=f[K],ce=ee.instance,Se=ee.currentTarget,ee=ee.listener,ce!==I&&D.isPropagationStopped())break e;I=ee,D.currentTarget=Se;try{I(D)}catch(Me){Vs(Me)}D.currentTarget=null,I=ce}}}}function gt(t,r){var a=r[Il];a===void 0&&(a=r[Il]=new Set);var f=t+"__bubble";a.has(f)||(Cg(r,t,2,!1),a.add(f))}function yd(t,r,a){var f=0;r&&(f|=4),Cg(a,t,f,r)}var Ac="_reactListening"+Math.random().toString(36).slice(2);function Sd(t){if(!t[Ac]){t[Ac]=!0,Sf.forEach(function(a){a!=="selectionchange"&&(GE.has(a)||yd(a,!1,t),yd(a,!0,t))});var r=t.nodeType===9?t:t.ownerDocument;r===null||r[Ac]||(r[Ac]=!0,yd("selectionchange",!1,r))}}function Cg(t,r,a,f){switch(tv(r)){case 2:var D=y1;break;case 8:D=S1;break;default:D=Pd}a=D.bind(null,r,a,t),D=void 0,!Vl||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(D=!0),f?D!==void 0?t.addEventListener(r,a,{capture:!0,passive:D}):t.addEventListener(r,a,!0):D!==void 0?t.addEventListener(r,a,{passive:D}):t.addEventListener(r,a,!1)}function bd(t,r,a,f,D){var I=f;if((r&1)===0&&(r&2)===0&&f!==null)e:for(;;){if(f===null)return;var K=f.tag;if(K===3||K===4){var ee=f.stateNode.containerInfo;if(ee===D)break;if(K===4)for(K=f.return;K!==null;){var ce=K.tag;if((ce===3||ce===4)&&K.stateNode.containerInfo===D)return;K=K.return}for(;ee!==null;){if(K=bo(ee),K===null)return;if(ce=K.tag,ce===5||ce===6||ce===26||ce===27){f=I=K;continue e}ee=ee.parentNode}}f=f.return}Mf(function(){var Se=I,Me=xl(a),xe=[];e:{var Ee=op.get(t);if(Ee!==void 0){var we=Us,Xe=t;switch(t){case"keypress":if(Ps(a)===0)break e;case"keydown":case"keyup":we=xb;break;case"focusin":Xe="focus",we=Fl;break;case"focusout":Xe="blur",we=Fl;break;case"beforeblur":case"afterblur":we=Fl;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":we=Pf;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":we=Ab;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":we=Hb;break;case tp:case ip:case rp:we=Db;break;case np:we=zb;break;case"scroll":case"scrollend":we=_b;break;case"wheel":we=Gb;break;case"copy":case"cut":case"paste":we=Ib;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":we=Uf;break;case"toggle":case"beforetoggle":we=qb}var it=(r&4)!==0,Bt=!it&&(t==="scroll"||t==="scrollend"),me=it?Ee!==null?Ee+"Capture":null:Ee;it=[];for(var ue=Se,ye;ue!==null;){var Pe=ue;if(ye=Pe.stateNode,Pe=Pe.tag,Pe!==5&&Pe!==26&&Pe!==27||ye===null||me===null||(Pe=ya(ue,me),Pe!=null&&it.push(Qa(ue,Pe,ye))),Bt)break;ue=ue.return}0<it.length&&(Ee=new we(Ee,Xe,null,a,Me),xe.push({event:Ee,listeners:it}))}}if((r&7)===0){e:{if(Ee=t==="mouseover"||t==="pointerover",we=t==="mouseout"||t==="pointerout",Ee&&a!==Ul&&(Xe=a.relatedTarget||a.fromElement)&&(bo(Xe)||Xe[So]))break e;if((we||Ee)&&(Ee=Me.window===Me?Me:(Ee=Me.ownerDocument)?Ee.defaultView||Ee.parentWindow:window,we?(Xe=a.relatedTarget||a.toElement,we=Se,Xe=Xe?bo(Xe):null,Xe!==null&&(Bt=g(Xe),it=Xe.tag,Xe!==Bt||it!==5&&it!==27&&it!==6)&&(Xe=null)):(we=null,Xe=Se),we!==Xe)){if(it=Pf,Pe="onMouseLeave",me="onMouseEnter",ue="mouse",(t==="pointerout"||t==="pointerover")&&(it=Uf,Pe="onPointerLeave",me="onPointerEnter",ue="pointer"),Bt=we==null?Ee:va(we),ye=Xe==null?Ee:va(Xe),Ee=new it(Pe,ue+"leave",we,a,Me),Ee.target=Bt,Ee.relatedTarget=ye,Pe=null,bo(Me)===Se&&(it=new it(me,ue+"enter",Xe,a,Me),it.target=ye,it.relatedTarget=Bt,Pe=it),Bt=Pe,we&&Xe)t:{for(it=WE,me=we,ue=Xe,ye=0,Pe=me;Pe;Pe=it(Pe))ye++;Pe=0;for(var et=ue;et;et=it(et))Pe++;for(;0<ye-Pe;)me=it(me),ye--;for(;0<Pe-ye;)ue=it(ue),Pe--;for(;ye--;){if(me===ue||ue!==null&&me===ue.alternate){it=me;break t}me=it(me),ue=it(ue)}it=null}else it=null;we!==null&&wg(xe,Ee,we,it,!1),Xe!==null&&Bt!==null&&wg(xe,Bt,Xe,it,!0)}}e:{if(Ee=Se?va(Se):window,we=Ee.nodeName&&Ee.nodeName.toLowerCase(),we==="select"||we==="input"&&Ee.type==="file")var Dt=Gf;else if(zf(Ee))if(Wf)Dt=iE;else{Dt=eE;var Ze=Zb}else we=Ee.nodeName,!we||we.toLowerCase()!=="input"||Ee.type!=="checkbox"&&Ee.type!=="radio"?Se&&Ll(Se.elementType)&&(Dt=Gf):Dt=tE;if(Dt&&(Dt=Dt(t,Se))){Ff(xe,Dt,a,Me);break e}Ze&&Ze(t,Ee,Se),t==="focusout"&&Se&&Ee.type==="number"&&Se.memoizedProps.value!=null&&Pl(Ee,"number",Ee.value)}switch(Ze=Se?va(Se):window,t){case"focusin":(zf(Ze)||Ze.contentEditable==="true")&&(Oo=Ze,Xl=Se,Ca=null);break;case"focusout":Ca=Xl=Oo=null;break;case"mousedown":Jl=!0;break;case"contextmenu":case"mouseup":case"dragend":Jl=!1,Zf(xe,a,Me);break;case"selectionchange":if(nE)break;case"keydown":case"keyup":Zf(xe,a,Me)}var lt;if(Wl)e:{switch(t){case"compositionstart":var bt="onCompositionStart";break e;case"compositionend":bt="onCompositionEnd";break e;case"compositionupdate":bt="onCompositionUpdate";break e}bt=void 0}else Do?Hf(t,a)&&(bt="onCompositionEnd"):t==="keydown"&&a.keyCode===229&&(bt="onCompositionStart");bt&&(xf&&a.locale!=="ko"&&(Do||bt!=="onCompositionStart"?bt==="onCompositionEnd"&&Do&&(lt=Nf()):(dn=Me,Hl="value"in dn?dn.value:dn.textContent,Do=!0)),Ze=Cc(Se,bt),0<Ze.length&&(bt=new Lf(bt,t,null,a,Me),xe.push({event:bt,listeners:Ze}),lt?bt.data=lt:(lt=jf(a),lt!==null&&(bt.data=lt)))),(lt=Yb?Xb(t,a):Jb(t,a))&&(bt=Cc(Se,"onBeforeInput"),0<bt.length&&(Ze=new Lf("onBeforeInput","beforeinput",null,a,Me),xe.push({event:Ze,listeners:bt}),Ze.data=lt)),jE(xe,t,Se,a,Me)}Ag(xe,r)})}function Qa(t,r,a){return{instance:t,listener:r,currentTarget:a}}function Cc(t,r){for(var a=r+"Capture",f=[];t!==null;){var D=t,I=D.stateNode;if(D=D.tag,D!==5&&D!==26&&D!==27||I===null||(D=ya(t,a),D!=null&&f.unshift(Qa(t,D,I)),D=ya(t,r),D!=null&&f.push(Qa(t,D,I))),t.tag===3)return f;t=t.return}return[]}function WE(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5&&t.tag!==27);return t||null}function wg(t,r,a,f,D){for(var I=r._reactName,K=[];a!==null&&a!==f;){var ee=a,ce=ee.alternate,Se=ee.stateNode;if(ee=ee.tag,ce!==null&&ce===f)break;ee!==5&&ee!==26&&ee!==27||Se===null||(ce=Se,D?(Se=ya(a,I),Se!=null&&K.unshift(Qa(a,Se,ce))):D||(Se=ya(a,I),Se!=null&&K.push(Qa(a,Se,ce)))),a=a.return}K.length!==0&&t.push({event:r,listeners:K})}var qE=/\r\n?/g,KE=/\u0000|\uFFFD/g;function Dg(t){return(typeof t=="string"?t:""+t).replace(qE,`
`).replace(KE,"")}function Og(t,r){return r=Dg(r),Dg(t)===r}function xt(t,r,a,f,D,I){switch(a){case"children":typeof f=="string"?r==="body"||r==="textarea"&&f===""||Ao(t,f):(typeof f=="number"||typeof f=="bigint")&&r!=="body"&&Ao(t,""+f);break;case"className":Is(t,"class",f);break;case"tabIndex":Is(t,"tabindex",f);break;case"dir":case"role":case"viewBox":case"width":case"height":Is(t,a,f);break;case"style":Of(t,f,I);break;case"data":if(r!=="object"){Is(t,"data",f);break}case"src":case"href":if(f===""&&(r!=="a"||a!=="href")){t.removeAttribute(a);break}if(f==null||typeof f=="function"||typeof f=="symbol"||typeof f=="boolean"){t.removeAttribute(a);break}f=Ns(""+f),t.setAttribute(a,f);break;case"action":case"formAction":if(typeof f=="function"){t.setAttribute(a,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof I=="function"&&(a==="formAction"?(r!=="input"&&xt(t,r,"name",D.name,D,null),xt(t,r,"formEncType",D.formEncType,D,null),xt(t,r,"formMethod",D.formMethod,D,null),xt(t,r,"formTarget",D.formTarget,D,null)):(xt(t,r,"encType",D.encType,D,null),xt(t,r,"method",D.method,D,null),xt(t,r,"target",D.target,D,null)));if(f==null||typeof f=="symbol"||typeof f=="boolean"){t.removeAttribute(a);break}f=Ns(""+f),t.setAttribute(a,f);break;case"onClick":f!=null&&(t.onclick=jr);break;case"onScroll":f!=null&&gt("scroll",t);break;case"onScrollEnd":f!=null&&gt("scrollend",t);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(o(61));if(a=f.__html,a!=null){if(D.children!=null)throw Error(o(60));t.innerHTML=a}}break;case"multiple":t.multiple=f&&typeof f!="function"&&typeof f!="symbol";break;case"muted":t.muted=f&&typeof f!="function"&&typeof f!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(f==null||typeof f=="function"||typeof f=="boolean"||typeof f=="symbol"){t.removeAttribute("xlink:href");break}a=Ns(""+f),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",a);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":f!=null&&typeof f!="function"&&typeof f!="symbol"?t.setAttribute(a,""+f):t.removeAttribute(a);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":f&&typeof f!="function"&&typeof f!="symbol"?t.setAttribute(a,""):t.removeAttribute(a);break;case"capture":case"download":f===!0?t.setAttribute(a,""):f!==!1&&f!=null&&typeof f!="function"&&typeof f!="symbol"?t.setAttribute(a,f):t.removeAttribute(a);break;case"cols":case"rows":case"size":case"span":f!=null&&typeof f!="function"&&typeof f!="symbol"&&!isNaN(f)&&1<=f?t.setAttribute(a,f):t.removeAttribute(a);break;case"rowSpan":case"start":f==null||typeof f=="function"||typeof f=="symbol"||isNaN(f)?t.removeAttribute(a):t.setAttribute(a,f);break;case"popover":gt("beforetoggle",t),gt("toggle",t),Os(t,"popover",f);break;case"xlinkActuate":Hr(t,"http://www.w3.org/1999/xlink","xlink:actuate",f);break;case"xlinkArcrole":Hr(t,"http://www.w3.org/1999/xlink","xlink:arcrole",f);break;case"xlinkRole":Hr(t,"http://www.w3.org/1999/xlink","xlink:role",f);break;case"xlinkShow":Hr(t,"http://www.w3.org/1999/xlink","xlink:show",f);break;case"xlinkTitle":Hr(t,"http://www.w3.org/1999/xlink","xlink:title",f);break;case"xlinkType":Hr(t,"http://www.w3.org/1999/xlink","xlink:type",f);break;case"xmlBase":Hr(t,"http://www.w3.org/XML/1998/namespace","xml:base",f);break;case"xmlLang":Hr(t,"http://www.w3.org/XML/1998/namespace","xml:lang",f);break;case"xmlSpace":Hr(t,"http://www.w3.org/XML/1998/namespace","xml:space",f);break;case"is":Os(t,"is",f);break;case"innerText":case"textContent":break;default:(!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(a=Eb.get(a)||a,Os(t,a,f))}}function Ed(t,r,a,f,D,I){switch(a){case"style":Of(t,f,I);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(o(61));if(a=f.__html,a!=null){if(D.children!=null)throw Error(o(60));t.innerHTML=a}}break;case"children":typeof f=="string"?Ao(t,f):(typeof f=="number"||typeof f=="bigint")&&Ao(t,""+f);break;case"onScroll":f!=null&&gt("scroll",t);break;case"onScrollEnd":f!=null&&gt("scrollend",t);break;case"onClick":f!=null&&(t.onclick=jr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!bf.hasOwnProperty(a))e:{if(a[0]==="o"&&a[1]==="n"&&(D=a.endsWith("Capture"),r=a.slice(2,D?a.length-7:void 0),I=t[xi]||null,I=I!=null?I[a]:null,typeof I=="function"&&t.removeEventListener(r,I,D),typeof f=="function")){typeof I!="function"&&I!==null&&(a in t?t[a]=null:t.hasAttribute(a)&&t.removeAttribute(a)),t.addEventListener(r,f,D);break e}a in t?t[a]=f:f===!0?t.setAttribute(a,""):Os(t,a,f)}}}function Ci(t,r,a){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":gt("error",t),gt("load",t);var f=!1,D=!1,I;for(I in a)if(a.hasOwnProperty(I)){var K=a[I];if(K!=null)switch(I){case"src":f=!0;break;case"srcSet":D=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(o(137,r));default:xt(t,r,I,K,a,null)}}D&&xt(t,r,"srcSet",a.srcSet,a,null),f&&xt(t,r,"src",a.src,a,null);return;case"input":gt("invalid",t);var ee=I=K=D=null,ce=null,Se=null;for(f in a)if(a.hasOwnProperty(f)){var Me=a[f];if(Me!=null)switch(f){case"name":D=Me;break;case"type":K=Me;break;case"checked":ce=Me;break;case"defaultChecked":Se=Me;break;case"value":I=Me;break;case"defaultValue":ee=Me;break;case"children":case"dangerouslySetInnerHTML":if(Me!=null)throw Error(o(137,r));break;default:xt(t,r,f,Me,a,null)}}Af(t,I,ee,ce,Se,K,D,!1);return;case"select":gt("invalid",t),f=K=I=null;for(D in a)if(a.hasOwnProperty(D)&&(ee=a[D],ee!=null))switch(D){case"value":I=ee;break;case"defaultValue":K=ee;break;case"multiple":f=ee;default:xt(t,r,D,ee,a,null)}r=I,a=K,t.multiple=!!f,r!=null?To(t,!!f,r,!1):a!=null&&To(t,!!f,a,!0);return;case"textarea":gt("invalid",t),I=D=f=null;for(K in a)if(a.hasOwnProperty(K)&&(ee=a[K],ee!=null))switch(K){case"value":f=ee;break;case"defaultValue":D=ee;break;case"children":I=ee;break;case"dangerouslySetInnerHTML":if(ee!=null)throw Error(o(91));break;default:xt(t,r,K,ee,a,null)}wf(t,f,D,I);return;case"option":for(ce in a)a.hasOwnProperty(ce)&&(f=a[ce],f!=null)&&(ce==="selected"?t.selected=f&&typeof f!="function"&&typeof f!="symbol":xt(t,r,ce,f,a,null));return;case"dialog":gt("beforetoggle",t),gt("toggle",t),gt("cancel",t),gt("close",t);break;case"iframe":case"object":gt("load",t);break;case"video":case"audio":for(f=0;f<Ja.length;f++)gt(Ja[f],t);break;case"image":gt("error",t),gt("load",t);break;case"details":gt("toggle",t);break;case"embed":case"source":case"link":gt("error",t),gt("load",t);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Se in a)if(a.hasOwnProperty(Se)&&(f=a[Se],f!=null))switch(Se){case"children":case"dangerouslySetInnerHTML":throw Error(o(137,r));default:xt(t,r,Se,f,a,null)}return;default:if(Ll(r)){for(Me in a)a.hasOwnProperty(Me)&&(f=a[Me],f!==void 0&&Ed(t,r,Me,f,a,void 0));return}}for(ee in a)a.hasOwnProperty(ee)&&(f=a[ee],f!=null&&xt(t,r,ee,f,a,null))}function YE(t,r,a,f){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var D=null,I=null,K=null,ee=null,ce=null,Se=null,Me=null;for(we in a){var xe=a[we];if(a.hasOwnProperty(we)&&xe!=null)switch(we){case"checked":break;case"value":break;case"defaultValue":ce=xe;default:f.hasOwnProperty(we)||xt(t,r,we,null,f,xe)}}for(var Ee in f){var we=f[Ee];if(xe=a[Ee],f.hasOwnProperty(Ee)&&(we!=null||xe!=null))switch(Ee){case"type":I=we;break;case"name":D=we;break;case"checked":Se=we;break;case"defaultChecked":Me=we;break;case"value":K=we;break;case"defaultValue":ee=we;break;case"children":case"dangerouslySetInnerHTML":if(we!=null)throw Error(o(137,r));break;default:we!==xe&&xt(t,r,Ee,we,f,xe)}}kl(t,K,ee,ce,Se,Me,I,D);return;case"select":we=K=ee=Ee=null;for(I in a)if(ce=a[I],a.hasOwnProperty(I)&&ce!=null)switch(I){case"value":break;case"multiple":we=ce;default:f.hasOwnProperty(I)||xt(t,r,I,null,f,ce)}for(D in f)if(I=f[D],ce=a[D],f.hasOwnProperty(D)&&(I!=null||ce!=null))switch(D){case"value":Ee=I;break;case"defaultValue":ee=I;break;case"multiple":K=I;default:I!==ce&&xt(t,r,D,I,f,ce)}r=ee,a=K,f=we,Ee!=null?To(t,!!a,Ee,!1):!!f!=!!a&&(r!=null?To(t,!!a,r,!0):To(t,!!a,a?[]:"",!1));return;case"textarea":we=Ee=null;for(ee in a)if(D=a[ee],a.hasOwnProperty(ee)&&D!=null&&!f.hasOwnProperty(ee))switch(ee){case"value":break;case"children":break;default:xt(t,r,ee,null,f,D)}for(K in f)if(D=f[K],I=a[K],f.hasOwnProperty(K)&&(D!=null||I!=null))switch(K){case"value":Ee=D;break;case"defaultValue":we=D;break;case"children":break;case"dangerouslySetInnerHTML":if(D!=null)throw Error(o(91));break;default:D!==I&&xt(t,r,K,D,f,I)}Cf(t,Ee,we);return;case"option":for(var Xe in a)Ee=a[Xe],a.hasOwnProperty(Xe)&&Ee!=null&&!f.hasOwnProperty(Xe)&&(Xe==="selected"?t.selected=!1:xt(t,r,Xe,null,f,Ee));for(ce in f)Ee=f[ce],we=a[ce],f.hasOwnProperty(ce)&&Ee!==we&&(Ee!=null||we!=null)&&(ce==="selected"?t.selected=Ee&&typeof Ee!="function"&&typeof Ee!="symbol":xt(t,r,ce,Ee,f,we));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var it in a)Ee=a[it],a.hasOwnProperty(it)&&Ee!=null&&!f.hasOwnProperty(it)&&xt(t,r,it,null,f,Ee);for(Se in f)if(Ee=f[Se],we=a[Se],f.hasOwnProperty(Se)&&Ee!==we&&(Ee!=null||we!=null))switch(Se){case"children":case"dangerouslySetInnerHTML":if(Ee!=null)throw Error(o(137,r));break;default:xt(t,r,Se,Ee,f,we)}return;default:if(Ll(r)){for(var Bt in a)Ee=a[Bt],a.hasOwnProperty(Bt)&&Ee!==void 0&&!f.hasOwnProperty(Bt)&&Ed(t,r,Bt,void 0,f,Ee);for(Me in f)Ee=f[Me],we=a[Me],!f.hasOwnProperty(Me)||Ee===we||Ee===void 0&&we===void 0||Ed(t,r,Me,Ee,f,we);return}}for(var me in a)Ee=a[me],a.hasOwnProperty(me)&&Ee!=null&&!f.hasOwnProperty(me)&&xt(t,r,me,null,f,Ee);for(xe in f)Ee=f[xe],we=a[xe],!f.hasOwnProperty(xe)||Ee===we||Ee==null&&we==null||xt(t,r,xe,Ee,f,we)}function Ig(t){switch(t){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function XE(){if(typeof performance.getEntriesByType=="function"){for(var t=0,r=0,a=performance.getEntriesByType("resource"),f=0;f<a.length;f++){var D=a[f],I=D.transferSize,K=D.initiatorType,ee=D.duration;if(I&&ee&&Ig(K)){for(K=0,ee=D.responseEnd,f+=1;f<a.length;f++){var ce=a[f],Se=ce.startTime;if(Se>ee)break;var Me=ce.transferSize,xe=ce.initiatorType;Me&&Ig(xe)&&(ce=ce.responseEnd,K+=Me*(ce<ee?1:(ee-Se)/(ce-Se)))}if(--f,r+=8*(I+K)/(D.duration/1e3),t++,10<t)break}}if(0<t)return r/t/1e6}return navigator.connection&&(t=navigator.connection.downlink,typeof t=="number")?t:5}var Rd=null,_d=null;function wc(t){return t.nodeType===9?t:t.ownerDocument}function Mg(t){switch(t){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Ng(t,r){if(t===0)switch(r){case"svg":return 1;case"math":return 2;default:return 0}return t===1&&r==="foreignObject"?0:t}function Td(t,r){return t==="textarea"||t==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.children=="bigint"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var Ad=null;function JE(){var t=window.event;return t&&t.type==="popstate"?t===Ad?!1:(Ad=t,!0):(Ad=null,!1)}var kg=typeof setTimeout=="function"?setTimeout:void 0,QE=typeof clearTimeout=="function"?clearTimeout:void 0,Pg=typeof Promise=="function"?Promise:void 0,$E=typeof queueMicrotask=="function"?queueMicrotask:typeof Pg<"u"?function(t){return Pg.resolve(null).then(t).catch(ZE)}:kg;function ZE(t){setTimeout(function(){throw t})}function Dn(t){return t==="head"}function Lg(t,r){var a=r,f=0;do{var D=a.nextSibling;if(t.removeChild(a),D&&D.nodeType===8)if(a=D.data,a==="/$"||a==="/&"){if(f===0){t.removeChild(D),ia(r);return}f--}else if(a==="$"||a==="$?"||a==="$~"||a==="$!"||a==="&")f++;else if(a==="html")$a(t.ownerDocument.documentElement);else if(a==="head"){a=t.ownerDocument.head,$a(a);for(var I=a.firstChild;I;){var K=I.nextSibling,ee=I.nodeName;I[ga]||ee==="SCRIPT"||ee==="STYLE"||ee==="LINK"&&I.rel.toLowerCase()==="stylesheet"||a.removeChild(I),I=K}}else a==="body"&&$a(t.ownerDocument.body);a=D}while(a);ia(r)}function Ug(t,r){var a=t;t=0;do{var f=a.nextSibling;if(a.nodeType===1?r?(a._stashedDisplay=a.style.display,a.style.display="none"):(a.style.display=a._stashedDisplay||"",a.getAttribute("style")===""&&a.removeAttribute("style")):a.nodeType===3&&(r?(a._stashedText=a.nodeValue,a.nodeValue=""):a.nodeValue=a._stashedText||""),f&&f.nodeType===8)if(a=f.data,a==="/$"){if(t===0)break;t--}else a!=="$"&&a!=="$?"&&a!=="$~"&&a!=="$!"||t++;a=f}while(a)}function Cd(t){var r=t.firstChild;for(r&&r.nodeType===10&&(r=r.nextSibling);r;){var a=r;switch(r=r.nextSibling,a.nodeName){case"HTML":case"HEAD":case"BODY":Cd(a),Ml(a);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(a.rel.toLowerCase()==="stylesheet")continue}t.removeChild(a)}}function e1(t,r,a,f){for(;t.nodeType===1;){var D=a;if(t.nodeName.toLowerCase()!==r.toLowerCase()){if(!f&&(t.nodeName!=="INPUT"||t.type!=="hidden"))break}else if(f){if(!t[ga])switch(r){case"meta":if(!t.hasAttribute("itemprop"))break;return t;case"link":if(I=t.getAttribute("rel"),I==="stylesheet"&&t.hasAttribute("data-precedence"))break;if(I!==D.rel||t.getAttribute("href")!==(D.href==null||D.href===""?null:D.href)||t.getAttribute("crossorigin")!==(D.crossOrigin==null?null:D.crossOrigin)||t.getAttribute("title")!==(D.title==null?null:D.title))break;return t;case"style":if(t.hasAttribute("data-precedence"))break;return t;case"script":if(I=t.getAttribute("src"),(I!==(D.src==null?null:D.src)||t.getAttribute("type")!==(D.type==null?null:D.type)||t.getAttribute("crossorigin")!==(D.crossOrigin==null?null:D.crossOrigin))&&I&&t.hasAttribute("async")&&!t.hasAttribute("itemprop"))break;return t;default:return t}}else if(r==="input"&&t.type==="hidden"){var I=D.name==null?null:""+D.name;if(D.type==="hidden"&&t.getAttribute("name")===I)return t}else return t;if(t=fr(t.nextSibling),t===null)break}return null}function t1(t,r,a){if(r==="")return null;for(;t.nodeType!==3;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!a||(t=fr(t.nextSibling),t===null))return null;return t}function xg(t,r){for(;t.nodeType!==8;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!r||(t=fr(t.nextSibling),t===null))return null;return t}function wd(t){return t.data==="$?"||t.data==="$~"}function Dd(t){return t.data==="$!"||t.data==="$?"&&t.ownerDocument.readyState!=="loading"}function i1(t,r){var a=t.ownerDocument;if(t.data==="$~")t._reactRetry=r;else if(t.data!=="$?"||a.readyState!=="loading")r();else{var f=function(){r(),a.removeEventListener("DOMContentLoaded",f)};a.addEventListener("DOMContentLoaded",f),t._reactRetry=f}}function fr(t){for(;t!=null;t=t.nextSibling){var r=t.nodeType;if(r===1||r===3)break;if(r===8){if(r=t.data,r==="$"||r==="$!"||r==="$?"||r==="$~"||r==="&"||r==="F!"||r==="F")break;if(r==="/$"||r==="/&")return null}}return t}var Od=null;function Bg(t){t=t.nextSibling;for(var r=0;t;){if(t.nodeType===8){var a=t.data;if(a==="/$"||a==="/&"){if(r===0)return fr(t.nextSibling);r--}else a!=="$"&&a!=="$!"&&a!=="$?"&&a!=="$~"&&a!=="&"||r++}t=t.nextSibling}return null}function Vg(t){t=t.previousSibling;for(var r=0;t;){if(t.nodeType===8){var a=t.data;if(a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"){if(r===0)return t;r--}else a!=="/$"&&a!=="/&"||r++}t=t.previousSibling}return null}function Hg(t,r,a){switch(r=wc(a),t){case"html":if(t=r.documentElement,!t)throw Error(o(452));return t;case"head":if(t=r.head,!t)throw Error(o(453));return t;case"body":if(t=r.body,!t)throw Error(o(454));return t;default:throw Error(o(451))}}function $a(t){for(var r=t.attributes;r.length;)t.removeAttributeNode(r[0]);Ml(t)}var pr=new Map,jg=new Set;function Dc(t){return typeof t.getRootNode=="function"?t.getRootNode():t.nodeType===9?t:t.ownerDocument}var nn=k.d;k.d={f:r1,r:n1,D:o1,C:a1,L:s1,m:c1,X:u1,S:l1,M:d1};function r1(){var t=nn.f(),r=Sc();return t||r}function n1(t){var r=Eo(t);r!==null&&r.tag===5&&r.type==="form"?nm(r):nn.r(t)}var Zo=typeof document>"u"?null:document;function zg(t,r,a){var f=Zo;if(f&&typeof r=="string"&&r){var D=ar(r);D='link[rel="'+t+'"][href="'+D+'"]',typeof a=="string"&&(D+='[crossorigin="'+a+'"]'),jg.has(D)||(jg.add(D),t={rel:t,crossOrigin:a,href:r},f.querySelector(D)===null&&(r=f.createElement("link"),Ci(r,"link",t),yi(r),f.head.appendChild(r)))}}function o1(t){nn.D(t),zg("dns-prefetch",t,null)}function a1(t,r){nn.C(t,r),zg("preconnect",t,r)}function s1(t,r,a){nn.L(t,r,a);var f=Zo;if(f&&t&&r){var D='link[rel="preload"][as="'+ar(r)+'"]';r==="image"&&a&&a.imageSrcSet?(D+='[imagesrcset="'+ar(a.imageSrcSet)+'"]',typeof a.imageSizes=="string"&&(D+='[imagesizes="'+ar(a.imageSizes)+'"]')):D+='[href="'+ar(t)+'"]';var I=D;switch(r){case"style":I=ea(t);break;case"script":I=ta(t)}pr.has(I)||(t=S({rel:"preload",href:r==="image"&&a&&a.imageSrcSet?void 0:t,as:r},a),pr.set(I,t),f.querySelector(D)!==null||r==="style"&&f.querySelector(Za(I))||r==="script"&&f.querySelector(es(I))||(r=f.createElement("link"),Ci(r,"link",t),yi(r),f.head.appendChild(r)))}}function c1(t,r){nn.m(t,r);var a=Zo;if(a&&t){var f=r&&typeof r.as=="string"?r.as:"script",D='link[rel="modulepreload"][as="'+ar(f)+'"][href="'+ar(t)+'"]',I=D;switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":I=ta(t)}if(!pr.has(I)&&(t=S({rel:"modulepreload",href:t},r),pr.set(I,t),a.querySelector(D)===null)){switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(a.querySelector(es(I)))return}f=a.createElement("link"),Ci(f,"link",t),yi(f),a.head.appendChild(f)}}}function l1(t,r,a){nn.S(t,r,a);var f=Zo;if(f&&t){var D=Ro(f).hoistableStyles,I=ea(t);r=r||"default";var K=D.get(I);if(!K){var ee={loading:0,preload:null};if(K=f.querySelector(Za(I)))ee.loading=5;else{t=S({rel:"stylesheet",href:t,"data-precedence":r},a),(a=pr.get(I))&&Id(t,a);var ce=K=f.createElement("link");yi(ce),Ci(ce,"link",t),ce._p=new Promise(function(Se,Me){ce.onload=Se,ce.onerror=Me}),ce.addEventListener("load",function(){ee.loading|=1}),ce.addEventListener("error",function(){ee.loading|=2}),ee.loading|=4,Oc(K,r,f)}K={type:"stylesheet",instance:K,count:1,state:ee},D.set(I,K)}}}function u1(t,r){nn.X(t,r);var a=Zo;if(a&&t){var f=Ro(a).hoistableScripts,D=ta(t),I=f.get(D);I||(I=a.querySelector(es(D)),I||(t=S({src:t,async:!0},r),(r=pr.get(D))&&Md(t,r),I=a.createElement("script"),yi(I),Ci(I,"link",t),a.head.appendChild(I)),I={type:"script",instance:I,count:1,state:null},f.set(D,I))}}function d1(t,r){nn.M(t,r);var a=Zo;if(a&&t){var f=Ro(a).hoistableScripts,D=ta(t),I=f.get(D);I||(I=a.querySelector(es(D)),I||(t=S({src:t,async:!0,type:"module"},r),(r=pr.get(D))&&Md(t,r),I=a.createElement("script"),yi(I),Ci(I,"link",t),a.head.appendChild(I)),I={type:"script",instance:I,count:1,state:null},f.set(D,I))}}function Fg(t,r,a,f){var D=(D=q.current)?Dc(D):null;if(!D)throw Error(o(446));switch(t){case"meta":case"title":return null;case"style":return typeof a.precedence=="string"&&typeof a.href=="string"?(r=ea(a.href),a=Ro(D).hoistableStyles,f=a.get(r),f||(f={type:"style",instance:null,count:0,state:null},a.set(r,f)),f):{type:"void",instance:null,count:0,state:null};case"link":if(a.rel==="stylesheet"&&typeof a.href=="string"&&typeof a.precedence=="string"){t=ea(a.href);var I=Ro(D).hoistableStyles,K=I.get(t);if(K||(D=D.ownerDocument||D,K={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},I.set(t,K),(I=D.querySelector(Za(t)))&&!I._p&&(K.instance=I,K.state.loading=5),pr.has(t)||(a={rel:"preload",as:"style",href:a.href,crossOrigin:a.crossOrigin,integrity:a.integrity,media:a.media,hrefLang:a.hrefLang,referrerPolicy:a.referrerPolicy},pr.set(t,a),I||h1(D,t,a,K.state))),r&&f===null)throw Error(o(528,""));return K}if(r&&f!==null)throw Error(o(529,""));return null;case"script":return r=a.async,a=a.src,typeof a=="string"&&r&&typeof r!="function"&&typeof r!="symbol"?(r=ta(a),a=Ro(D).hoistableScripts,f=a.get(r),f||(f={type:"script",instance:null,count:0,state:null},a.set(r,f)),f):{type:"void",instance:null,count:0,state:null};default:throw Error(o(444,t))}}function ea(t){return'href="'+ar(t)+'"'}function Za(t){return'link[rel="stylesheet"]['+t+"]"}function Gg(t){return S({},t,{"data-precedence":t.precedence,precedence:null})}function h1(t,r,a,f){t.querySelector('link[rel="preload"][as="style"]['+r+"]")?f.loading=1:(r=t.createElement("link"),f.preload=r,r.addEventListener("load",function(){return f.loading|=1}),r.addEventListener("error",function(){return f.loading|=2}),Ci(r,"link",a),yi(r),t.head.appendChild(r))}function ta(t){return'[src="'+ar(t)+'"]'}function es(t){return"script[async]"+t}function Wg(t,r,a){if(r.count++,r.instance===null)switch(r.type){case"style":var f=t.querySelector('style[data-href~="'+ar(a.href)+'"]');if(f)return r.instance=f,yi(f),f;var D=S({},a,{"data-href":a.href,"data-precedence":a.precedence,href:null,precedence:null});return f=(t.ownerDocument||t).createElement("style"),yi(f),Ci(f,"style",D),Oc(f,a.precedence,t),r.instance=f;case"stylesheet":D=ea(a.href);var I=t.querySelector(Za(D));if(I)return r.state.loading|=4,r.instance=I,yi(I),I;f=Gg(a),(D=pr.get(D))&&Id(f,D),I=(t.ownerDocument||t).createElement("link"),yi(I);var K=I;return K._p=new Promise(function(ee,ce){K.onload=ee,K.onerror=ce}),Ci(I,"link",f),r.state.loading|=4,Oc(I,a.precedence,t),r.instance=I;case"script":return I=ta(a.src),(D=t.querySelector(es(I)))?(r.instance=D,yi(D),D):(f=a,(D=pr.get(I))&&(f=S({},a),Md(f,D)),t=t.ownerDocument||t,D=t.createElement("script"),yi(D),Ci(D,"link",f),t.head.appendChild(D),r.instance=D);case"void":return null;default:throw Error(o(443,r.type))}else r.type==="stylesheet"&&(r.state.loading&4)===0&&(f=r.instance,r.state.loading|=4,Oc(f,a.precedence,t));return r.instance}function Oc(t,r,a){for(var f=a.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),D=f.length?f[f.length-1]:null,I=D,K=0;K<f.length;K++){var ee=f[K];if(ee.dataset.precedence===r)I=ee;else if(I!==D)break}I?I.parentNode.insertBefore(t,I.nextSibling):(r=a.nodeType===9?a.head:a,r.insertBefore(t,r.firstChild))}function Id(t,r){t.crossOrigin==null&&(t.crossOrigin=r.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=r.referrerPolicy),t.title==null&&(t.title=r.title)}function Md(t,r){t.crossOrigin==null&&(t.crossOrigin=r.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=r.referrerPolicy),t.integrity==null&&(t.integrity=r.integrity)}var Ic=null;function qg(t,r,a){if(Ic===null){var f=new Map,D=Ic=new Map;D.set(a,f)}else D=Ic,f=D.get(a),f||(f=new Map,D.set(a,f));if(f.has(t))return f;for(f.set(t,null),a=a.getElementsByTagName(t),D=0;D<a.length;D++){var I=a[D];if(!(I[ga]||I[Ri]||t==="link"&&I.getAttribute("rel")==="stylesheet")&&I.namespaceURI!=="http://www.w3.org/2000/svg"){var K=I.getAttribute(r)||"";K=t+K;var ee=f.get(K);ee?ee.push(I):f.set(K,[I])}}return f}function Kg(t,r,a){t=t.ownerDocument||t,t.head.insertBefore(a,r==="title"?t.querySelector("head > title"):null)}function f1(t,r,a){if(a===1||r.itemProp!=null)return!1;switch(t){case"meta":case"title":return!0;case"style":if(typeof r.precedence!="string"||typeof r.href!="string"||r.href==="")break;return!0;case"link":if(typeof r.rel!="string"||typeof r.href!="string"||r.href===""||r.onLoad||r.onError)break;return r.rel==="stylesheet"?(t=r.disabled,typeof r.precedence=="string"&&t==null):!0;case"script":if(r.async&&typeof r.async!="function"&&typeof r.async!="symbol"&&!r.onLoad&&!r.onError&&r.src&&typeof r.src=="string")return!0}return!1}function Yg(t){return!(t.type==="stylesheet"&&(t.state.loading&3)===0)}function p1(t,r,a,f){if(a.type==="stylesheet"&&(typeof f.media!="string"||matchMedia(f.media).matches!==!1)&&(a.state.loading&4)===0){if(a.instance===null){var D=ea(f.href),I=r.querySelector(Za(D));if(I){r=I._p,r!==null&&typeof r=="object"&&typeof r.then=="function"&&(t.count++,t=Mc.bind(t),r.then(t,t)),a.state.loading|=4,a.instance=I,yi(I);return}I=r.ownerDocument||r,f=Gg(f),(D=pr.get(D))&&Id(f,D),I=I.createElement("link"),yi(I);var K=I;K._p=new Promise(function(ee,ce){K.onload=ee,K.onerror=ce}),Ci(I,"link",f),a.instance=I}t.stylesheets===null&&(t.stylesheets=new Map),t.stylesheets.set(a,r),(r=a.state.preload)&&(a.state.loading&3)===0&&(t.count++,a=Mc.bind(t),r.addEventListener("load",a),r.addEventListener("error",a))}}var Nd=0;function m1(t,r){return t.stylesheets&&t.count===0&&kc(t,t.stylesheets),0<t.count||0<t.imgCount?function(a){var f=setTimeout(function(){if(t.stylesheets&&kc(t,t.stylesheets),t.unsuspend){var I=t.unsuspend;t.unsuspend=null,I()}},6e4+r);0<t.imgBytes&&Nd===0&&(Nd=62500*XE());var D=setTimeout(function(){if(t.waitingForImages=!1,t.count===0&&(t.stylesheets&&kc(t,t.stylesheets),t.unsuspend)){var I=t.unsuspend;t.unsuspend=null,I()}},(t.imgBytes>Nd?50:800)+r);return t.unsuspend=a,function(){t.unsuspend=null,clearTimeout(f),clearTimeout(D)}}:null}function Mc(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)kc(this,this.stylesheets);else if(this.unsuspend){var t=this.unsuspend;this.unsuspend=null,t()}}}var Nc=null;function kc(t,r){t.stylesheets=null,t.unsuspend!==null&&(t.count++,Nc=new Map,r.forEach(g1,t),Nc=null,Mc.call(t))}function g1(t,r){if(!(r.state.loading&4)){var a=Nc.get(t);if(a)var f=a.get(null);else{a=new Map,Nc.set(t,a);for(var D=t.querySelectorAll("link[data-precedence],style[data-precedence]"),I=0;I<D.length;I++){var K=D[I];(K.nodeName==="LINK"||K.getAttribute("media")!=="not all")&&(a.set(K.dataset.precedence,K),f=K)}f&&a.set(null,f)}D=r.instance,K=D.getAttribute("data-precedence"),I=a.get(K)||f,I===f&&a.set(null,D),a.set(K,D),this.count++,f=Mc.bind(this),D.addEventListener("load",f),D.addEventListener("error",f),I?I.parentNode.insertBefore(D,I.nextSibling):(t=t.nodeType===9?t.head:t,t.insertBefore(D,t.firstChild)),r.state.loading|=4}}var ts={$$typeof:A,Provider:null,Consumer:null,_currentValue:M,_currentValue2:M,_threadCount:0};function v1(t,r,a,f,D,I,K,ee,ce){this.tag=1,this.containerInfo=t,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Fe(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Fe(0),this.hiddenUpdates=Fe(null),this.identifierPrefix=f,this.onUncaughtError=D,this.onCaughtError=I,this.onRecoverableError=K,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ce,this.incompleteTransitions=new Map}function Xg(t,r,a,f,D,I,K,ee,ce,Se,Me,xe){return t=new v1(t,r,a,K,ce,Se,Me,xe,ee),r=1,I===!0&&(r|=24),I=Ji(3,null,null,r),t.current=I,I.stateNode=t,r=du(),r.refCount++,t.pooledCache=r,r.refCount++,I.memoizedState={element:f,isDehydrated:a,cache:r},mu(I),t}function Jg(t){return t?(t=No,t):No}function Qg(t,r,a,f,D,I){D=Jg(D),f.context===null?f.context=D:f.pendingContext=D,f=vn(r),f.payload={element:a},I=I===void 0?null:I,I!==null&&(f.callback=I),a=yn(t,f,r),a!==null&&(Fi(a,t,r),ka(a,t,r))}function $g(t,r){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var a=t.retryLane;t.retryLane=a!==0&&a<r?a:r}}function kd(t,r){$g(t,r),(t=t.alternate)&&$g(t,r)}function Zg(t){if(t.tag===13||t.tag===31){var r=Kn(t,67108864);r!==null&&Fi(r,t,67108864),kd(t,67108864)}}function ev(t){if(t.tag===13||t.tag===31){var r=tr();r=Dl(r);var a=Kn(t,r);a!==null&&Fi(a,t,r),kd(t,r)}}var Pc=!0;function y1(t,r,a,f){var D=N.T;N.T=null;var I=k.p;try{k.p=2,Pd(t,r,a,f)}finally{k.p=I,N.T=D}}function S1(t,r,a,f){var D=N.T;N.T=null;var I=k.p;try{k.p=8,Pd(t,r,a,f)}finally{k.p=I,N.T=D}}function Pd(t,r,a,f){if(Pc){var D=Ld(f);if(D===null)bd(t,r,f,Lc,a),iv(t,f);else if(E1(D,t,r,a,f))f.stopPropagation();else if(iv(t,f),r&4&&-1<b1.indexOf(t)){for(;D!==null;){var I=Eo(D);if(I!==null)switch(I.tag){case 3:if(I=I.stateNode,I.current.memoizedState.isDehydrated){var K=ve(I.pendingLanes);if(K!==0){var ee=I;for(ee.pendingLanes|=2,ee.entangledLanes|=2;K;){var ce=1<<31-kt(K);ee.entanglements[1]|=ce,K&=~ce}kr(I),(Mt&6)===0&&(vc=ze()+500,Xa(0))}}break;case 31:case 13:ee=Kn(I,2),ee!==null&&Fi(ee,I,2),Sc(),kd(I,2)}if(I=Ld(f),I===null&&bd(t,r,f,Lc,a),I===D)break;D=I}D!==null&&f.stopPropagation()}else bd(t,r,f,null,a)}}function Ld(t){return t=xl(t),Ud(t)}var Lc=null;function Ud(t){if(Lc=null,t=bo(t),t!==null){var r=g(t);if(r===null)t=null;else{var a=r.tag;if(a===13){if(t=c(r),t!==null)return t;t=null}else if(a===31){if(t=s(r),t!==null)return t;t=null}else if(a===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;t=null}else r!==t&&(t=null)}}return Lc=t,null}function tv(t){switch(t){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Je()){case rt:return 2;case It:return 8;case dt:case Ct:return 32;case _t:return 268435456;default:return 32}default:return 32}}var xd=!1,On=null,In=null,Mn=null,is=new Map,rs=new Map,Nn=[],b1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function iv(t,r){switch(t){case"focusin":case"focusout":On=null;break;case"dragenter":case"dragleave":In=null;break;case"mouseover":case"mouseout":Mn=null;break;case"pointerover":case"pointerout":is.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":rs.delete(r.pointerId)}}function ns(t,r,a,f,D,I){return t===null||t.nativeEvent!==I?(t={blockedOn:r,domEventName:a,eventSystemFlags:f,nativeEvent:I,targetContainers:[D]},r!==null&&(r=Eo(r),r!==null&&Zg(r)),t):(t.eventSystemFlags|=f,r=t.targetContainers,D!==null&&r.indexOf(D)===-1&&r.push(D),t)}function E1(t,r,a,f,D){switch(r){case"focusin":return On=ns(On,t,r,a,f,D),!0;case"dragenter":return In=ns(In,t,r,a,f,D),!0;case"mouseover":return Mn=ns(Mn,t,r,a,f,D),!0;case"pointerover":var I=D.pointerId;return is.set(I,ns(is.get(I)||null,t,r,a,f,D)),!0;case"gotpointercapture":return I=D.pointerId,rs.set(I,ns(rs.get(I)||null,t,r,a,f,D)),!0}return!1}function rv(t){var r=bo(t.target);if(r!==null){var a=g(r);if(a!==null){if(r=a.tag,r===13){if(r=c(a),r!==null){t.blockedOn=r,vf(t.priority,function(){ev(a)});return}}else if(r===31){if(r=s(a),r!==null){t.blockedOn=r,vf(t.priority,function(){ev(a)});return}}else if(r===3&&a.stateNode.current.memoizedState.isDehydrated){t.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Uc(t){if(t.blockedOn!==null)return!1;for(var r=t.targetContainers;0<r.length;){var a=Ld(t.nativeEvent);if(a===null){a=t.nativeEvent;var f=new a.constructor(a.type,a);Ul=f,a.target.dispatchEvent(f),Ul=null}else return r=Eo(a),r!==null&&Zg(r),t.blockedOn=a,!1;r.shift()}return!0}function nv(t,r,a){Uc(t)&&a.delete(r)}function R1(){xd=!1,On!==null&&Uc(On)&&(On=null),In!==null&&Uc(In)&&(In=null),Mn!==null&&Uc(Mn)&&(Mn=null),is.forEach(nv),rs.forEach(nv)}function xc(t,r){t.blockedOn===r&&(t.blockedOn=null,xd||(xd=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,R1)))}var Bc=null;function ov(t){Bc!==t&&(Bc=t,i.unstable_scheduleCallback(i.unstable_NormalPriority,function(){Bc===t&&(Bc=null);for(var r=0;r<t.length;r+=3){var a=t[r],f=t[r+1],D=t[r+2];if(typeof f!="function"){if(Ud(f||a)===null)continue;break}var I=Eo(a);I!==null&&(t.splice(r,3),r-=3,Lu(I,{pending:!0,data:D,method:a.method,action:f},f,D))}}))}function ia(t){function r(ce){return xc(ce,t)}On!==null&&xc(On,t),In!==null&&xc(In,t),Mn!==null&&xc(Mn,t),is.forEach(r),rs.forEach(r);for(var a=0;a<Nn.length;a++){var f=Nn[a];f.blockedOn===t&&(f.blockedOn=null)}for(;0<Nn.length&&(a=Nn[0],a.blockedOn===null);)rv(a),a.blockedOn===null&&Nn.shift();if(a=(t.ownerDocument||t).$$reactFormReplay,a!=null)for(f=0;f<a.length;f+=3){var D=a[f],I=a[f+1],K=D[xi]||null;if(typeof I=="function")K||ov(a);else if(K){var ee=null;if(I&&I.hasAttribute("formAction")){if(D=I,K=I[xi]||null)ee=K.formAction;else if(Ud(D)!==null)continue}else ee=K.action;typeof ee=="function"?a[f+1]=ee:(a.splice(f,3),f-=3),ov(a)}}}function av(){function t(I){I.canIntercept&&I.info==="react-transition"&&I.intercept({handler:function(){return new Promise(function(K){return D=K})},focusReset:"manual",scroll:"manual"})}function r(){D!==null&&(D(),D=null),f||setTimeout(a,20)}function a(){if(!f&&!navigation.transition){var I=navigation.currentEntry;I&&I.url!=null&&navigation.navigate(I.url,{state:I.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var f=!1,D=null;return navigation.addEventListener("navigate",t),navigation.addEventListener("navigatesuccess",r),navigation.addEventListener("navigateerror",r),setTimeout(a,100),function(){f=!0,navigation.removeEventListener("navigate",t),navigation.removeEventListener("navigatesuccess",r),navigation.removeEventListener("navigateerror",r),D!==null&&(D(),D=null)}}}function Bd(t){this._internalRoot=t}Vc.prototype.render=Bd.prototype.render=function(t){var r=this._internalRoot;if(r===null)throw Error(o(409));var a=r.current,f=tr();Qg(a,f,t,r,null,null)},Vc.prototype.unmount=Bd.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var r=t.containerInfo;Qg(t.current,2,null,t,null,null),Sc(),r[So]=null}};function Vc(t){this._internalRoot=t}Vc.prototype.unstable_scheduleHydration=function(t){if(t){var r=gf();t={blockedOn:null,target:t,priority:r};for(var a=0;a<Nn.length&&r!==0&&r<Nn[a].priority;a++);Nn.splice(a,0,t),a===0&&rv(t)}};var sv=e.version;if(sv!=="19.2.3")throw Error(o(527,sv,"19.2.3"));k.findDOMNode=function(t){var r=t._reactInternals;if(r===void 0)throw typeof t.render=="function"?Error(o(188)):(t=Object.keys(t).join(","),Error(o(268,t)));return t=l(r),t=t!==null?p(t):null,t=t===null?null:t.stateNode,t};var _1={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:N,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Hc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Hc.isDisabled&&Hc.supportsFiber)try{jt=Hc.inject(_1),yt=Hc}catch{}}return as.createRoot=function(t,r){if(!u(t))throw Error(o(299));var a=!1,f="",D=pm,I=mm,K=gm;return r!=null&&(r.unstable_strictMode===!0&&(a=!0),r.identifierPrefix!==void 0&&(f=r.identifierPrefix),r.onUncaughtError!==void 0&&(D=r.onUncaughtError),r.onCaughtError!==void 0&&(I=r.onCaughtError),r.onRecoverableError!==void 0&&(K=r.onRecoverableError)),r=Xg(t,1,!1,null,null,a,f,null,D,I,K,av),t[So]=r.current,Sd(t),new Bd(r)},as.hydrateRoot=function(t,r,a){if(!u(t))throw Error(o(299));var f=!1,D="",I=pm,K=mm,ee=gm,ce=null;return a!=null&&(a.unstable_strictMode===!0&&(f=!0),a.identifierPrefix!==void 0&&(D=a.identifierPrefix),a.onUncaughtError!==void 0&&(I=a.onUncaughtError),a.onCaughtError!==void 0&&(K=a.onCaughtError),a.onRecoverableError!==void 0&&(ee=a.onRecoverableError),a.formState!==void 0&&(ce=a.formState)),r=Xg(t,1,!0,r,a??null,f,D,ce,I,K,ee,av),r.context=Jg(null),a=r.current,f=tr(),f=Dl(f),D=vn(f),D.callback=null,yn(a,D,f),a=f,r.current.lanes=a,Ke(r,a),kr(r),t[So]=r.current,Sd(t),new Vc(r)},as.version="19.2.3",as}var vv;function P1(){if(vv)return jd.exports;vv=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),jd.exports=k1(),jd.exports}var L1=P1();const U1=({connected:i,agentInfo:e,statusLabel:n,agentStatus:o,onConnect:u,onDisconnect:g,onStatusChange:c})=>Ge.jsxs("section",{children:[Ge.jsx("h2",{children:""}),Ge.jsxs("p",{children:[": ",i?"":""]}),Ge.jsxs("p",{children:[": ",e?`${e.name} (${e.agentId})`:""]}),Ge.jsxs("p",{children:[": ",n]}),Ge.jsxs("div",{children:[Ge.jsx("button",{type:"button",onClick:u,disabled:i,children:""}),Ge.jsx("button",{type:"button",onClick:g,disabled:!i,children:""})]}),Ge.jsxs("div",{children:[Ge.jsx("button",{type:"button",onClick:()=>c("online"),disabled:!i||o==="online",children:""}),Ge.jsx("button",{type:"button",onClick:()=>c("busy"),disabled:!i||o==="busy",children:""}),Ge.jsx("button",{type:"button",onClick:()=>c("offline"),disabled:!i||o==="offline",children:""})]})]}),x1=({sessions:i,onAccept:e,onReject:n})=>i.length===0?Ge.jsx("p",{children:""}):Ge.jsxs("section",{children:[Ge.jsx("h3",{children:""}),Ge.jsx("ul",{style:{listStyle:"none",padding:0},children:i.map(o=>Ge.jsxs("li",{style:{border:"1px solid #ddd",borderRadius:"8px",padding:"15px",marginBottom:"15px",backgroundColor:"#fafafa"},children:[Ge.jsxs("div",{style:{marginBottom:"10px"},children:[Ge.jsxs("p",{style:{margin:"5px 0",fontSize:"12px",color:"#666"},children:[Ge.jsx("strong",{children:"ID:"})," ",o.sessionId.substring(0,8),"..."]}),Ge.jsxs("p",{style:{margin:"5px 0"},children:[Ge.jsx("strong",{children:"ID:"})," ",o.userId.substring(0,8),"..."]}),Ge.jsxs("p",{style:{margin:"5px 0"},children:[Ge.jsx("strong",{children:":"})," ",Ge.jsxs("span",{style:{padding:"2px 8px",borderRadius:"4px",backgroundColor:o.transferReason==="keyword_detected"?"#fff3e0":"#e3f2fd",color:o.transferReason==="keyword_detected"?"#e65100":"#1565c0",fontSize:"12px"},children:[o.transferReason==="user_requested"&&"",o.transferReason==="keyword_detected"&&`: ${o.keyword||""}`,o.transferReason==="ai_suggested"&&"AI",!o.transferReason&&""]})]})]}),o.conversationHistory&&o.conversationHistory.length>0&&Ge.jsxs("div",{style:{backgroundColor:"#fff",border:"1px solid #e0e0e0",borderRadius:"6px",padding:"10px",marginBottom:"10px",maxHeight:"150px",overflowY:"auto"},children:[Ge.jsxs("p",{style:{margin:"0 0 8px 0",fontSize:"12px",fontWeight:"bold",color:"#333"},children:[" AI  (",o.conversationHistory.length," )"]}),Ge.jsx("ul",{style:{listStyle:"none",padding:0,margin:0},children:o.conversationHistory.map(u=>Ge.jsxs("li",{style:{padding:"6px 10px",margin:"4px 0",borderRadius:"4px",backgroundColor:u.role==="user"?"#e3f2fd":"#f5f5f5",fontSize:"13px"},children:[Ge.jsxs("strong",{style:{color:u.role==="user"?"#1976d2":"#666"},children:[u.role==="user"?" ":" AI",":"]})," ",Ge.jsx("span",{style:{wordBreak:"break-word"},children:u.content.length>100?u.content.substring(0,100)+"...":u.content})]},u.id))})]}),(!o.conversationHistory||o.conversationHistory.length===0)&&Ge.jsx("p",{style:{color:"#999",fontSize:"12px",fontStyle:"italic",margin:"10px 0"},children:" AI "}),Ge.jsxs("div",{style:{display:"flex",gap:"10px",marginTop:"10px"},children:[Ge.jsx("button",{type:"button",onClick:()=>e(o.sessionId),style:{flex:1,padding:"10px 15px",backgroundColor:"#4CAF50",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"bold"},children:" "}),Ge.jsx("button",{type:"button",onClick:()=>n(o.sessionId),style:{flex:1,padding:"10px 15px",backgroundColor:"#f44336",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"bold"},children:" "})]})]},o.sessionId))})]}),B1=({activeCall:i,history:e,isMuted:n,rtcStatus:o,onHangup:u,onToggleMute:g})=>{const[c,s]=ot.useState(0);console.log("[CallPanel] Rendering with history:",{historyLength:e?.length||0,history:e}),ot.useEffect(()=>{if(!i||o!=="joined"){s(0);return}const l=setInterval(()=>{s(p=>p+1)},1e3);return()=>clearInterval(l)},[i,o]);const d=l=>{const p=Math.floor(l/60),S=l%60;return`${p.toString().padStart(2,"0")}:${S.toString().padStart(2,"0")}`};return i?Ge.jsxs("section",{style:{padding:"20px",border:"2px solid #4CAF50",borderRadius:"8px",marginTop:"20px",backgroundColor:"#f9fff9"},children:[Ge.jsx("h3",{style:{margin:"0 0 15px 0",color:"#4CAF50"},children:" "}),Ge.jsxs("div",{style:{backgroundColor:"#fff",padding:"15px",borderRadius:"6px",marginBottom:"15px"},children:[Ge.jsxs("p",{style:{margin:"5px 0"},children:[Ge.jsx("strong",{children:"ID:"})," ",i.sessionId]}),Ge.jsxs("p",{style:{margin:"5px 0"},children:[Ge.jsx("strong",{children:"ID:"})," ",i.userId]}),Ge.jsxs("p",{style:{margin:"5px 0"},children:[Ge.jsx("strong",{children:"RTC :"}),Ge.jsx("span",{style:{color:o==="joined"?"#4CAF50":"#ff9800",marginLeft:"10px"},children:o==="joined"?" ":` ${o}`})]}),Ge.jsxs("p",{style:{margin:"5px 0"},children:[Ge.jsx("strong",{children:":"}),Ge.jsx("span",{style:{fontSize:"18px",fontWeight:"bold",marginLeft:"10px",color:"#2196F3"},children:d(c)})]})]}),Ge.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"15px"},children:[Ge.jsx("button",{type:"button",onClick:g,disabled:o!=="joined",style:{flex:1,padding:"12px 20px",fontSize:"16px",border:"none",borderRadius:"6px",cursor:o==="joined"?"pointer":"not-allowed",backgroundColor:n?"#ff9800":"#2196F3",color:"white",fontWeight:"bold",opacity:o==="joined"?1:.5},children:n?" ":" "}),Ge.jsx("button",{type:"button",onClick:u,style:{flex:1,padding:"12px 20px",fontSize:"16px",border:"none",borderRadius:"6px",cursor:"pointer",backgroundColor:"#f44336",color:"white",fontWeight:"bold"},children:" "})]}),Ge.jsxs("div",{style:{backgroundColor:"#1a1a2e",padding:"15px",borderRadius:"6px",maxHeight:"300px",overflowY:"auto"},children:[Ge.jsx("h4",{style:{margin:"0 0 10px 0",fontSize:"16px",color:"#fff"},children:" "}),e.length===0?Ge.jsx("p",{style:{color:"#999",fontSize:"14px"},children:""}):Ge.jsx("ul",{style:{listStyle:"none",padding:0,margin:0},children:e.map(l=>Ge.jsxs("li",{style:{padding:"8px 12px",margin:"5px 0",borderRadius:"4px",backgroundColor:l.role==="user"?"#2196F3":"#4a4a6a",fontSize:"14px",color:"#fff"},children:[Ge.jsxs("strong",{style:{color:l.role==="user"?"#bbdefb":"#b0b0c0"},children:[l.role==="user"?" ":" AI",":"]})," ",l.content]},l.id))})]})]}):Ge.jsx("section",{style:{padding:"20px",border:"1px solid #ddd",borderRadius:"8px",marginTop:"20px"},children:Ge.jsx("p",{style:{color:"#666",textAlign:"center"},children:""})})},Br=Object.create(null);Br.open="0";Br.close="1";Br.ping="2";Br.pong="3";Br.message="4";Br.upgrade="5";Br.noop="6";const Xc=Object.create(null);Object.keys(Br).forEach(i=>{Xc[Br[i]]=i});const Ah={type:"error",data:"parser error"},qy=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Ky=typeof ArrayBuffer=="function",Yy=i=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(i):i&&i.buffer instanceof ArrayBuffer,Yh=({type:i,data:e},n,o)=>qy&&e instanceof Blob?n?o(e):yv(e,o):Ky&&(e instanceof ArrayBuffer||Yy(e))?n?o(e):yv(new Blob([e]),o):o(Br[i]+(e||"")),yv=(i,e)=>{const n=new FileReader;return n.onload=function(){const o=n.result.split(",")[1];e("b"+(o||""))},n.readAsDataURL(i)};function Sv(i){return i instanceof Uint8Array?i:i instanceof ArrayBuffer?new Uint8Array(i):new Uint8Array(i.buffer,i.byteOffset,i.byteLength)}let Wd;function V1(i,e){if(qy&&i.data instanceof Blob)return i.data.arrayBuffer().then(Sv).then(e);if(Ky&&(i.data instanceof ArrayBuffer||Yy(i.data)))return e(Sv(i.data));Yh(i,!1,n=>{Wd||(Wd=new TextEncoder),e(Wd.encode(n))})}const bv="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ds=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let i=0;i<bv.length;i++)ds[bv.charCodeAt(i)]=i;const H1=i=>{let e=i.length*.75,n=i.length,o,u=0,g,c,s,d;i[i.length-1]==="="&&(e--,i[i.length-2]==="="&&e--);const l=new ArrayBuffer(e),p=new Uint8Array(l);for(o=0;o<n;o+=4)g=ds[i.charCodeAt(o)],c=ds[i.charCodeAt(o+1)],s=ds[i.charCodeAt(o+2)],d=ds[i.charCodeAt(o+3)],p[u++]=g<<2|c>>4,p[u++]=(c&15)<<4|s>>2,p[u++]=(s&3)<<6|d&63;return l},j1=typeof ArrayBuffer=="function",Xh=(i,e)=>{if(typeof i!="string")return{type:"message",data:Xy(i,e)};const n=i.charAt(0);return n==="b"?{type:"message",data:z1(i.substring(1),e)}:Xc[n]?i.length>1?{type:Xc[n],data:i.substring(1)}:{type:Xc[n]}:Ah},z1=(i,e)=>{if(j1){const n=H1(i);return Xy(n,e)}else return{base64:!0,data:i}},Xy=(i,e)=>e==="blob"?i instanceof Blob?i:new Blob([i]):i instanceof ArrayBuffer?i:i.buffer,Jy="",F1=(i,e)=>{const n=i.length,o=new Array(n);let u=0;i.forEach((g,c)=>{Yh(g,!1,s=>{o[c]=s,++u===n&&e(o.join(Jy))})})},G1=(i,e)=>{const n=i.split(Jy),o=[];for(let u=0;u<n.length;u++){const g=Xh(n[u],e);if(o.push(g),g.type==="error")break}return o};function W1(){return new TransformStream({transform(i,e){V1(i,n=>{const o=n.length;let u;if(o<126)u=new Uint8Array(1),new DataView(u.buffer).setUint8(0,o);else if(o<65536){u=new Uint8Array(3);const g=new DataView(u.buffer);g.setUint8(0,126),g.setUint16(1,o)}else{u=new Uint8Array(9);const g=new DataView(u.buffer);g.setUint8(0,127),g.setBigUint64(1,BigInt(o))}i.data&&typeof i.data!="string"&&(u[0]|=128),e.enqueue(u),e.enqueue(n)})}})}let qd;function jc(i){return i.reduce((e,n)=>e+n.length,0)}function zc(i,e){if(i[0].length===e)return i.shift();const n=new Uint8Array(e);let o=0;for(let u=0;u<e;u++)n[u]=i[0][o++],o===i[0].length&&(i.shift(),o=0);return i.length&&o<i[0].length&&(i[0]=i[0].slice(o)),n}function q1(i,e){qd||(qd=new TextDecoder);const n=[];let o=0,u=-1,g=!1;return new TransformStream({transform(c,s){for(n.push(c);;){if(o===0){if(jc(n)<1)break;const d=zc(n,1);g=(d[0]&128)===128,u=d[0]&127,u<126?o=3:u===126?o=1:o=2}else if(o===1){if(jc(n)<2)break;const d=zc(n,2);u=new DataView(d.buffer,d.byteOffset,d.length).getUint16(0),o=3}else if(o===2){if(jc(n)<8)break;const d=zc(n,8),l=new DataView(d.buffer,d.byteOffset,d.length),p=l.getUint32(0);if(p>Math.pow(2,21)-1){s.enqueue(Ah);break}u=p*Math.pow(2,32)+l.getUint32(4),o=3}else{if(jc(n)<u)break;const d=zc(n,u);s.enqueue(Xh(g?d:qd.decode(d),e)),o=0}if(u===0||u>i){s.enqueue(Ah);break}}}})}const Qy=4;function hi(i){if(i)return K1(i)}function K1(i){for(var e in hi.prototype)i[e]=hi.prototype[e];return i}hi.prototype.on=hi.prototype.addEventListener=function(i,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+i]=this._callbacks["$"+i]||[]).push(e),this};hi.prototype.once=function(i,e){function n(){this.off(i,n),e.apply(this,arguments)}return n.fn=e,this.on(i,n),this};hi.prototype.off=hi.prototype.removeListener=hi.prototype.removeAllListeners=hi.prototype.removeEventListener=function(i,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks["$"+i];if(!n)return this;if(arguments.length==1)return delete this._callbacks["$"+i],this;for(var o,u=0;u<n.length;u++)if(o=n[u],o===e||o.fn===e){n.splice(u,1);break}return n.length===0&&delete this._callbacks["$"+i],this};hi.prototype.emit=function(i){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),n=this._callbacks["$"+i],o=1;o<arguments.length;o++)e[o-1]=arguments[o];if(n){n=n.slice(0);for(var o=0,u=n.length;o<u;++o)n[o].apply(this,e)}return this};hi.prototype.emitReserved=hi.prototype.emit;hi.prototype.listeners=function(i){return this._callbacks=this._callbacks||{},this._callbacks["$"+i]||[]};hi.prototype.hasListeners=function(i){return!!this.listeners(i).length};const gl=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,n)=>n(e,0),yr=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),Y1="arraybuffer";function $y(i,...e){return e.reduce((n,o)=>(i.hasOwnProperty(o)&&(n[o]=i[o]),n),{})}const X1=yr.setTimeout,J1=yr.clearTimeout;function vl(i,e){e.useNativeTimers?(i.setTimeoutFn=X1.bind(yr),i.clearTimeoutFn=J1.bind(yr)):(i.setTimeoutFn=yr.setTimeout.bind(yr),i.clearTimeoutFn=yr.clearTimeout.bind(yr))}const Q1=1.33;function $1(i){return typeof i=="string"?Z1(i):Math.ceil((i.byteLength||i.size)*Q1)}function Z1(i){let e=0,n=0;for(let o=0,u=i.length;o<u;o++)e=i.charCodeAt(o),e<128?n+=1:e<2048?n+=2:e<55296||e>=57344?n+=3:(o++,n+=4);return n}function Zy(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function eR(i){let e="";for(let n in i)i.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(i[n]));return e}function tR(i){let e={},n=i.split("&");for(let o=0,u=n.length;o<u;o++){let g=n[o].split("=");e[decodeURIComponent(g[0])]=decodeURIComponent(g[1])}return e}class iR extends Error{constructor(e,n,o){super(e),this.description=n,this.context=o,this.type="TransportError"}}class Jh extends hi{constructor(e){super(),this.writable=!1,vl(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,n,o){return super.emitReserved("error",new iR(e,n,o)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const n=Xh(e,this.socket.binaryType);this.onPacket(n)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,n={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(n)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(this.opts.port)!==443||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const n=eR(e);return n.length?"?"+n:""}}class rR extends Jh{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const n=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let o=0;this._polling&&(o++,this.once("pollComplete",function(){--o||n()})),this.writable||(o++,this.once("drain",function(){--o||n()}))}else n()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const n=o=>{if(this.readyState==="opening"&&o.type==="open"&&this.onOpen(),o.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(o)};G1(e,this.socket.binaryType).forEach(n),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,F1(e,n=>{this.doWrite(n,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",n=this.query||{};return this.opts.timestampRequests!==!1&&(n[this.opts.timestampParam]=Zy()),!this.supportsBinary&&!n.sid&&(n.b64=1),this.createUri(e,n)}}let eS=!1;try{eS=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const nR=eS;function oR(){}class aR extends rR{constructor(e){if(super(e),typeof location<"u"){const n=location.protocol==="https:";let o=location.port;o||(o=n?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||o!==e.port}}doWrite(e,n){const o=this.request({method:"POST",data:e});o.on("success",n),o.on("error",(u,g)=>{this.onError("xhr post error",u,g)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(n,o)=>{this.onError("xhr poll error",n,o)}),this.pollXhr=e}}let ca=class Jc extends hi{constructor(e,n,o){super(),this.createRequest=e,vl(this,o),this._opts=o,this._method=o.method||"GET",this._uri=n,this._data=o.data!==void 0?o.data:null,this._create()}_create(){var e;const n=$y(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this._opts.xd;const o=this._xhr=this.createRequest(n);try{o.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){o.setDisableHeaderCheck&&o.setDisableHeaderCheck(!0);for(let u in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(u)&&o.setRequestHeader(u,this._opts.extraHeaders[u])}}catch{}if(this._method==="POST")try{o.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{o.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(o),"withCredentials"in o&&(o.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(o.timeout=this._opts.requestTimeout),o.onreadystatechange=()=>{var u;o.readyState===3&&((u=this._opts.cookieJar)===null||u===void 0||u.parseCookies(o.getResponseHeader("set-cookie"))),o.readyState===4&&(o.status===200||o.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof o.status=="number"?o.status:0)},0))},o.send(this._data)}catch(u){this.setTimeoutFn(()=>{this._onError(u)},0);return}typeof document<"u"&&(this._index=Jc.requestsCount++,Jc.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=oR,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete Jc.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}};ca.requestsCount=0;ca.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Ev);else if(typeof addEventListener=="function"){const i="onpagehide"in yr?"pagehide":"unload";addEventListener(i,Ev,!1)}}function Ev(){for(let i in ca.requests)ca.requests.hasOwnProperty(i)&&ca.requests[i].abort()}const sR=(function(){const i=tS({xdomain:!1});return i&&i.responseType!==null})();class cR extends aR{constructor(e){super(e);const n=e&&e.forceBase64;this.supportsBinary=sR&&!n}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new ca(tS,this.uri(),e)}}function tS(i){const e=i.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||nR))return new XMLHttpRequest}catch{}if(!e)try{return new yr[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const iS=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class lR extends Jh{get name(){return"websocket"}doOpen(){const e=this.uri(),n=this.opts.protocols,o=iS?{}:$y(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(o.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,n,o)}catch(u){return this.emitReserved("error",u)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let n=0;n<e.length;n++){const o=e[n],u=n===e.length-1;Yh(o,this.supportsBinary,g=>{try{this.doWrite(o,g)}catch{}u&&gl(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",n=this.query||{};return this.opts.timestampRequests&&(n[this.opts.timestampParam]=Zy()),this.supportsBinary||(n.b64=1),this.createUri(e,n)}}const Kd=yr.WebSocket||yr.MozWebSocket;class uR extends lR{createSocket(e,n,o){return iS?new Kd(e,n,o):n?new Kd(e,n):new Kd(e)}doWrite(e,n){this.ws.send(n)}}class dR extends Jh{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const n=q1(Number.MAX_SAFE_INTEGER,this.socket.binaryType),o=e.readable.pipeThrough(n).getReader(),u=W1();u.readable.pipeTo(e.writable),this._writer=u.writable.getWriter();const g=()=>{o.read().then(({done:s,value:d})=>{s||(this.onPacket(d),g())}).catch(s=>{})};g();const c={type:"open"};this.query.sid&&(c.data=`{"sid":"${this.query.sid}"}`),this._writer.write(c).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let n=0;n<e.length;n++){const o=e[n],u=n===e.length-1;this._writer.write(o).then(()=>{u&&gl(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const hR={websocket:uR,webtransport:dR,polling:cR},fR=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,pR=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Ch(i){if(i.length>8e3)throw"URI too long";const e=i,n=i.indexOf("["),o=i.indexOf("]");n!=-1&&o!=-1&&(i=i.substring(0,n)+i.substring(n,o).replace(/:/g,";")+i.substring(o,i.length));let u=fR.exec(i||""),g={},c=14;for(;c--;)g[pR[c]]=u[c]||"";return n!=-1&&o!=-1&&(g.source=e,g.host=g.host.substring(1,g.host.length-1).replace(/;/g,":"),g.authority=g.authority.replace("[","").replace("]","").replace(/;/g,":"),g.ipv6uri=!0),g.pathNames=mR(g,g.path),g.queryKey=gR(g,g.query),g}function mR(i,e){const n=/\/{2,9}/g,o=e.replace(n,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&o.splice(0,1),e.slice(-1)=="/"&&o.splice(o.length-1,1),o}function gR(i,e){const n={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(o,u,g){u&&(n[u]=g)}),n}const wh=typeof addEventListener=="function"&&typeof removeEventListener=="function",Qc=[];wh&&addEventListener("offline",()=>{Qc.forEach(i=>i())},!1);class Hn extends hi{constructor(e,n){if(super(),this.binaryType=Y1,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(n=e,e=null),e){const o=Ch(e);n.hostname=o.host,n.secure=o.protocol==="https"||o.protocol==="wss",n.port=o.port,o.query&&(n.query=o.query)}else n.host&&(n.hostname=Ch(n.host).host);vl(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},n.transports.forEach(o=>{const u=o.prototype.name;this.transports.push(u),this._transportsByName[u]=o}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=tR(this.opts.query)),wh&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},Qc.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const n=Object.assign({},this.opts.query);n.EIO=Qy,n.transport=e,this.id&&(n.sid=this.id);const o=Object.assign({},this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](o)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&Hn.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const n=this.createTransport(e);n.open(),this.setTransport(n)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",n=>this._onClose("transport close",n))}onOpen(){this.readyState="open",Hn.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const n=new Error("server error");n.code=e.data,this._onError(n);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let o=0;o<this.writeBuffer.length;o++){const u=this.writeBuffer[o].data;if(u&&(n+=$1(u)),o>0&&n>this._maxPayload)return this.writeBuffer.slice(0,o);n+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,gl(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,n,o){return this._sendPacket("message",e,n,o),this}send(e,n,o){return this._sendPacket("message",e,n,o),this}_sendPacket(e,n,o,u){if(typeof n=="function"&&(u=n,n=void 0),typeof o=="function"&&(u=o,o=null),this.readyState==="closing"||this.readyState==="closed")return;o=o||{},o.compress=o.compress!==!1;const g={type:e,data:n,options:o};this.emitReserved("packetCreate",g),this.writeBuffer.push(g),u&&this.once("flush",u),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),e()},o=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?o():e()}):this.upgrading?o():e()),this}_onError(e){if(Hn.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,n){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),wh&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const o=Qc.indexOf(this._offlineEventListener);o!==-1&&Qc.splice(o,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,n),this.writeBuffer=[],this._prevBufferLen=0}}}Hn.protocol=Qy;class vR extends Hn{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let n=this.createTransport(e),o=!1;Hn.priorWebsocketSuccess=!1;const u=()=>{o||(n.send([{type:"ping",data:"probe"}]),n.once("packet",S=>{if(!o)if(S.type==="pong"&&S.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;Hn.priorWebsocketSuccess=n.name==="websocket",this.transport.pause(()=>{o||this.readyState!=="closed"&&(p(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const T=new Error("probe error");T.transport=n.name,this.emitReserved("upgradeError",T)}}))};function g(){o||(o=!0,p(),n.close(),n=null)}const c=S=>{const T=new Error("probe error: "+S);T.transport=n.name,g(),this.emitReserved("upgradeError",T)};function s(){c("transport closed")}function d(){c("socket closed")}function l(S){n&&S.name!==n.name&&g()}const p=()=>{n.removeListener("open",u),n.removeListener("error",c),n.removeListener("close",s),this.off("close",d),this.off("upgrading",l)};n.once("open",u),n.once("error",c),n.once("close",s),this.once("close",d),this.once("upgrading",l),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{o||n.open()},200):n.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const n=[];for(let o=0;o<e.length;o++)~this.transports.indexOf(e[o])&&n.push(e[o]);return n}}let yR=class extends vR{constructor(e,n={}){const o=typeof e=="object"?e:n;(!o.transports||o.transports&&typeof o.transports[0]=="string")&&(o.transports=(o.transports||["polling","websocket","webtransport"]).map(u=>hR[u]).filter(u=>!!u)),super(e,o)}};function SR(i,e="",n){let o=i;n=n||typeof location<"u"&&location,i==null&&(i=n.protocol+"//"+n.host),typeof i=="string"&&(i.charAt(0)==="/"&&(i.charAt(1)==="/"?i=n.protocol+i:i=n.host+i),/^(https?|wss?):\/\//.test(i)||(typeof n<"u"?i=n.protocol+"//"+i:i="https://"+i),o=Ch(i)),o.port||(/^(http|ws)$/.test(o.protocol)?o.port="80":/^(http|ws)s$/.test(o.protocol)&&(o.port="443")),o.path=o.path||"/";const g=o.host.indexOf(":")!==-1?"["+o.host+"]":o.host;return o.id=o.protocol+"://"+g+":"+o.port+e,o.href=o.protocol+"://"+g+(n&&n.port===o.port?"":":"+o.port),o}const bR=typeof ArrayBuffer=="function",ER=i=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(i):i.buffer instanceof ArrayBuffer,rS=Object.prototype.toString,RR=typeof Blob=="function"||typeof Blob<"u"&&rS.call(Blob)==="[object BlobConstructor]",_R=typeof File=="function"||typeof File<"u"&&rS.call(File)==="[object FileConstructor]";function Qh(i){return bR&&(i instanceof ArrayBuffer||ER(i))||RR&&i instanceof Blob||_R&&i instanceof File}function $c(i,e){if(!i||typeof i!="object")return!1;if(Array.isArray(i)){for(let n=0,o=i.length;n<o;n++)if($c(i[n]))return!0;return!1}if(Qh(i))return!0;if(i.toJSON&&typeof i.toJSON=="function"&&arguments.length===1)return $c(i.toJSON(),!0);for(const n in i)if(Object.prototype.hasOwnProperty.call(i,n)&&$c(i[n]))return!0;return!1}function TR(i){const e=[],n=i.data,o=i;return o.data=Dh(n,e),o.attachments=e.length,{packet:o,buffers:e}}function Dh(i,e){if(!i)return i;if(Qh(i)){const n={_placeholder:!0,num:e.length};return e.push(i),n}else if(Array.isArray(i)){const n=new Array(i.length);for(let o=0;o<i.length;o++)n[o]=Dh(i[o],e);return n}else if(typeof i=="object"&&!(i instanceof Date)){const n={};for(const o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=Dh(i[o],e));return n}return i}function AR(i,e){return i.data=Oh(i.data,e),delete i.attachments,i}function Oh(i,e){if(!i)return i;if(i&&i._placeholder===!0){if(typeof i.num=="number"&&i.num>=0&&i.num<e.length)return e[i.num];throw new Error("illegal attachments")}else if(Array.isArray(i))for(let n=0;n<i.length;n++)i[n]=Oh(i[n],e);else if(typeof i=="object")for(const n in i)Object.prototype.hasOwnProperty.call(i,n)&&(i[n]=Oh(i[n],e));return i}const nS=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],CR=5;var ut;(function(i){i[i.CONNECT=0]="CONNECT",i[i.DISCONNECT=1]="DISCONNECT",i[i.EVENT=2]="EVENT",i[i.ACK=3]="ACK",i[i.CONNECT_ERROR=4]="CONNECT_ERROR",i[i.BINARY_EVENT=5]="BINARY_EVENT",i[i.BINARY_ACK=6]="BINARY_ACK"})(ut||(ut={}));class wR{constructor(e){this.replacer=e}encode(e){return(e.type===ut.EVENT||e.type===ut.ACK)&&$c(e)?this.encodeAsBinary({type:e.type===ut.EVENT?ut.BINARY_EVENT:ut.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let n=""+e.type;return(e.type===ut.BINARY_EVENT||e.type===ut.BINARY_ACK)&&(n+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(n+=e.nsp+","),e.id!=null&&(n+=e.id),e.data!=null&&(n+=JSON.stringify(e.data,this.replacer)),n}encodeAsBinary(e){const n=TR(e),o=this.encodeAsString(n.packet),u=n.buffers;return u.unshift(o),u}}class $h extends hi{constructor(e){super(),this.reviver=e}add(e){let n;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");n=this.decodeString(e);const o=n.type===ut.BINARY_EVENT;o||n.type===ut.BINARY_ACK?(n.type=o?ut.EVENT:ut.ACK,this.reconstructor=new DR(n),n.attachments===0&&super.emitReserved("decoded",n)):super.emitReserved("decoded",n)}else if(Qh(e)||e.base64)if(this.reconstructor)n=this.reconstructor.takeBinaryData(e),n&&(this.reconstructor=null,super.emitReserved("decoded",n));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let n=0;const o={type:Number(e.charAt(0))};if(ut[o.type]===void 0)throw new Error("unknown packet type "+o.type);if(o.type===ut.BINARY_EVENT||o.type===ut.BINARY_ACK){const g=n+1;for(;e.charAt(++n)!=="-"&&n!=e.length;);const c=e.substring(g,n);if(c!=Number(c)||e.charAt(n)!=="-")throw new Error("Illegal attachments");o.attachments=Number(c)}if(e.charAt(n+1)==="/"){const g=n+1;for(;++n&&!(e.charAt(n)===","||n===e.length););o.nsp=e.substring(g,n)}else o.nsp="/";const u=e.charAt(n+1);if(u!==""&&Number(u)==u){const g=n+1;for(;++n;){const c=e.charAt(n);if(c==null||Number(c)!=c){--n;break}if(n===e.length)break}o.id=Number(e.substring(g,n+1))}if(e.charAt(++n)){const g=this.tryParse(e.substr(n));if($h.isPayloadValid(o.type,g))o.data=g;else throw new Error("invalid payload")}return o}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,n){switch(e){case ut.CONNECT:return sl(n);case ut.DISCONNECT:return n===void 0;case ut.CONNECT_ERROR:return typeof n=="string"||sl(n);case ut.EVENT:case ut.BINARY_EVENT:return Array.isArray(n)&&(typeof n[0]=="number"||typeof n[0]=="string"&&nS.indexOf(n[0])===-1);case ut.ACK:case ut.BINARY_ACK:return Array.isArray(n)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class DR{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const n=AR(this.reconPack,this.buffers);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function OR(i){return typeof i=="string"}const IR=Number.isInteger||function(i){return typeof i=="number"&&isFinite(i)&&Math.floor(i)===i};function MR(i){return i===void 0||IR(i)}function sl(i){return Object.prototype.toString.call(i)==="[object Object]"}function NR(i,e){switch(i){case ut.CONNECT:return e===void 0||sl(e);case ut.DISCONNECT:return e===void 0;case ut.EVENT:return Array.isArray(e)&&(typeof e[0]=="number"||typeof e[0]=="string"&&nS.indexOf(e[0])===-1);case ut.ACK:return Array.isArray(e);case ut.CONNECT_ERROR:return typeof e=="string"||sl(e);default:return!1}}function kR(i){return OR(i.nsp)&&MR(i.id)&&NR(i.type,i.data)}const PR=Object.freeze(Object.defineProperty({__proto__:null,Decoder:$h,Encoder:wR,get PacketType(){return ut},isPacketValid:kR,protocol:CR},Symbol.toStringTag,{value:"Module"}));function wr(i,e,n){return i.on(e,n),function(){i.off(e,n)}}const LR=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class oS extends hi{constructor(e,n,o){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=n,o&&o.auth&&(this.auth=o.auth),this._opts=Object.assign({},o),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[wr(e,"open",this.onopen.bind(this)),wr(e,"packet",this.onpacket.bind(this)),wr(e,"error",this.onerror.bind(this)),wr(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...n){var o,u,g;if(LR.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(n.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;const c={type:ut.EVENT,data:n};if(c.options={},c.options.compress=this.flags.compress!==!1,typeof n[n.length-1]=="function"){const p=this.ids++,S=n.pop();this._registerAckCallback(p,S),c.id=p}const s=(u=(o=this.io.engine)===null||o===void 0?void 0:o.transport)===null||u===void 0?void 0:u.writable,d=this.connected&&!(!((g=this.io.engine)===null||g===void 0)&&g._hasPingExpired());return this.flags.volatile&&!s||(d?(this.notifyOutgoingListeners(c),this.packet(c)):this.sendBuffer.push(c)),this.flags={},this}_registerAckCallback(e,n){var o;const u=(o=this.flags.timeout)!==null&&o!==void 0?o:this._opts.ackTimeout;if(u===void 0){this.acks[e]=n;return}const g=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let s=0;s<this.sendBuffer.length;s++)this.sendBuffer[s].id===e&&this.sendBuffer.splice(s,1);n.call(this,new Error("operation has timed out"))},u),c=(...s)=>{this.io.clearTimeoutFn(g),n.apply(this,s)};c.withError=!0,this.acks[e]=c}emitWithAck(e,...n){return new Promise((o,u)=>{const g=(c,s)=>c?u(c):o(s);g.withError=!0,n.push(g),this.emit(e,...n)})}_addToQueue(e){let n;typeof e[e.length-1]=="function"&&(n=e.pop());const o={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((u,...g)=>(this._queue[0],u!==null?o.tryCount>this._opts.retries&&(this._queue.shift(),n&&n(u)):(this._queue.shift(),n&&n(null,...g)),o.pending=!1,this._drainQueue())),this._queue.push(o),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const n=this._queue[0];n.pending&&!e||(n.pending=!0,n.tryCount++,this.flags=n.flags,this.emit.apply(this,n.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:ut.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,n){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,n),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(o=>String(o.id)===e)){const o=this.acks[e];delete this.acks[e],o.withError&&o.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case ut.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case ut.EVENT:case ut.BINARY_EVENT:this.onevent(e);break;case ut.ACK:case ut.BINARY_ACK:this.onack(e);break;case ut.DISCONNECT:this.ondisconnect();break;case ut.CONNECT_ERROR:this.destroy();const o=new Error(e.data.message);o.data=e.data.data,this.emitReserved("connect_error",o);break}}onevent(e){const n=e.data||[];e.id!=null&&n.push(this.ack(e.id)),this.connected?this.emitEvent(n):this.receiveBuffer.push(Object.freeze(n))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const n=this._anyListeners.slice();for(const o of n)o.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const n=this;let o=!1;return function(...u){o||(o=!0,n.packet({type:ut.ACK,id:e,data:u}))}}onack(e){const n=this.acks[e.id];typeof n=="function"&&(delete this.acks[e.id],n.withError&&e.data.unshift(null),n.apply(this,e.data))}onconnect(e,n){this.id=e,this.recovered=n&&this._pid===n,this._pid=n,this.connected=!0,this.emitBuffered(),this._drainQueue(!0),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:ut.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const n=this._anyListeners;for(let o=0;o<n.length;o++)if(e===n[o])return n.splice(o,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const n=this._anyOutgoingListeners;for(let o=0;o<n.length;o++)if(e===n[o])return n.splice(o,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const n=this._anyOutgoingListeners.slice();for(const o of n)o.apply(this,e.data)}}}function fa(i){i=i||{},this.ms=i.min||100,this.max=i.max||1e4,this.factor=i.factor||2,this.jitter=i.jitter>0&&i.jitter<=1?i.jitter:0,this.attempts=0}fa.prototype.duration=function(){var i=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*i);i=(Math.floor(e*10)&1)==0?i-n:i+n}return Math.min(i,this.max)|0};fa.prototype.reset=function(){this.attempts=0};fa.prototype.setMin=function(i){this.ms=i};fa.prototype.setMax=function(i){this.max=i};fa.prototype.setJitter=function(i){this.jitter=i};class Ih extends hi{constructor(e,n){var o;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(n=e,e=void 0),n=n||{},n.path=n.path||"/socket.io",this.opts=n,vl(this,n),this.reconnection(n.reconnection!==!1),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor((o=n.randomizationFactor)!==null&&o!==void 0?o:.5),this.backoff=new fa({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(n.timeout==null?2e4:n.timeout),this._readyState="closed",this.uri=e;const u=n.parser||PR;this.encoder=new u.Encoder,this.decoder=new u.Decoder,this._autoConnect=n.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var n;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(n=this.backoff)===null||n===void 0||n.setMin(e),this)}randomizationFactor(e){var n;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(n=this.backoff)===null||n===void 0||n.setJitter(e),this)}reconnectionDelayMax(e){var n;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(n=this.backoff)===null||n===void 0||n.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new yR(this.uri,this.opts);const n=this.engine,o=this;this._readyState="opening",this.skipReconnect=!1;const u=wr(n,"open",function(){o.onopen(),e&&e()}),g=s=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",s),e?e(s):this.maybeReconnectOnOpen()},c=wr(n,"error",g);if(this._timeout!==!1){const s=this._timeout,d=this.setTimeoutFn(()=>{u(),g(new Error("timeout")),n.close()},s);this.opts.autoUnref&&d.unref(),this.subs.push(()=>{this.clearTimeoutFn(d)})}return this.subs.push(u),this.subs.push(c),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(wr(e,"ping",this.onping.bind(this)),wr(e,"data",this.ondata.bind(this)),wr(e,"error",this.onerror.bind(this)),wr(e,"close",this.onclose.bind(this)),wr(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(n){this.onclose("parse error",n)}}ondecoded(e){gl(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,n){let o=this.nsps[e];return o?this._autoConnect&&!o.active&&o.connect():(o=new oS(this,e,n),this.nsps[e]=o),o}_destroy(e){const n=Object.keys(this.nsps);for(const o of n)if(this.nsps[o].active)return;this._close()}_packet(e){const n=this.encoder.encode(e);for(let o=0;o<n.length;o++)this.engine.write(n[o],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,n){var o;this.cleanup(),(o=this.engine)===null||o===void 0||o.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,n),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const n=this.backoff.duration();this._reconnecting=!0;const o=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(u=>{u?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",u)):e.onreconnect()}))},n);this.opts.autoUnref&&o.unref(),this.subs.push(()=>{this.clearTimeoutFn(o)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const ss={};function Zc(i,e){typeof i=="object"&&(e=i,i=void 0),e=e||{};const n=SR(i,e.path||"/socket.io"),o=n.source,u=n.id,g=n.path,c=ss[u]&&g in ss[u].nsps,s=e.forceNew||e["force new connection"]||e.multiplex===!1||c;let d;return s?d=new Ih(o,e):(ss[u]||(ss[u]=new Ih(o,e)),d=ss[u]),n.query&&!e.query&&(e.query=n.queryKey),d.socket(n.path,e)}Object.assign(Zc,{Manager:Ih,Socket:oS,io:Zc,connect:Zc});const UR=`https://${window.location.hostname}:3000`,xR=()=>{const i=ot.useRef(null),[e,n]=ot.useState(!1),[o,u]=ot.useState(null),[g,c]=ot.useState("offline"),[s,d]=ot.useState([]),[l,p]=ot.useState([]),[S,T]=ot.useState(null),y=ot.useCallback(P=>{p(U=>[P,...U].slice(0,20))},[]),R=ot.useCallback(P=>{d(P||[])},[]),v=ot.useCallback(P=>{d(U=>U.some(L=>L.sessionId===P.sessionId)?U:[P,...U]),y(`: ${P.sessionId}`)},[y]),h=ot.useCallback(P=>{d(U=>U.filter(B=>B.sessionId!==P))},[]),m=ot.useCallback(P=>{i.current&&i.current.disconnect();const U=Zc(UR,{transports:["websocket"]});i.current=U,U.on("connect",()=>{n(!0),y("Socket "),U.emit("agent-login",P),u(P)}),U.on("disconnect",()=>{n(!1),c("offline"),T(null),y("Socket ")}),U.on("pending-sessions",R),U.on("new-session",v),U.on("login-success",B=>{c("online"),u(B),y(` ${B.name} `)}),U.on("login-error",B=>{y(`: ${B.message}`)}),U.on("session-ended",B=>{h(B.sessionId),T(B.sessionId),y(`: ${B.sessionId}`)}),U.on("agent-disconnected",B=>{h(B.sessionId),T(B.sessionId),y(B.message||`: ${B.sessionId}`)}),U.on("session-timeout",B=>{h(B.sessionId),T(B.sessionId),y(B.message||`: ${B.sessionId}`)})},[v,R,y,h]),_=ot.useCallback(()=>{i.current?.disconnect(),i.current=null,n(!1),c("offline"),T(null)},[]),A=ot.useCallback(P=>{i.current&&(i.current.emit("agent-status-change",{status:P}),c(P),y(`: ${P}`))},[y]),E=ot.useCallback(P=>{i.current&&(i.current.emit("agent-accept-session",{sessionId:P}),h(P),y(`: ${P}`))},[y,h]),b=ot.useCallback((P,U)=>{i.current&&(i.current.emit("agent-reject-session",{sessionId:P,reason:U}),y(`: ${P}`))},[y]),w=ot.useCallback(P=>{i.current&&(i.current.emit("agent-hangup",{sessionId:P}),h(P),y(`: ${P}`))},[y,h]);ot.useEffect(()=>()=>{i.current?.disconnect()},[]);const C=ot.useMemo(()=>{switch(g){case"online":return"";case"busy":return"";default:return""}},[g]);return{connected:e,agentInfo:o,agentStatus:g,statusLabel:C,pendingSessions:s,events:l,lastEndedSessionId:S,connectAgent:m,disconnect:_,updateStatus:A,acceptSession:E,rejectSession:b,hangupSession:w,setPendingSessions:d}};var Yd={exports:{}};var Rv;function BR(){return Rv||(Rv=1,(function(i,e){(function(n,o){i.exports=o()})(self,(()=>(()=>{var n={280:g=>{var c;c=()=>(()=>{var s={775:S=>{var T=Object.prototype.hasOwnProperty;function y(v){return"[Throws: "+(v?v.message:"?")+"]"}function R(v){var h=[];return(function m(_){if(_===null||typeof _!="object")return _;if(h.indexOf(_)!==-1)return"[Circular]";if(h.push(_),typeof _.toJSON=="function")try{var A=m(_.toJSON());return h.pop(),A}catch(w){return y(w)}if(Array.isArray(_)){var E=_.map(m);return h.pop(),E}var b=Object.keys(_).reduce((function(w,C){return w[C]=m((function(P,U){if(T.call(P,U))try{return P[U]}catch(B){return y(B)}return P[U]})(_,C)),w}),{});return h.pop(),b})(v)}S.exports=function(v,h,m){return JSON.stringify(R(v),h,m)},S.exports.ensureProperties=R},692:S=>{var T=S.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(y){return y.encoding?"rtpmap:%d %s/%s/%s":y.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(y){return y.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(y){return y.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(y){return"extmap:%d"+(y.direction?"/%s":"%v")+(y["encrypt-uri"]?" %s":"%v")+" %s"+(y.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(y){return y.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(y){var R="candidate:%s %d %s %d %s %d typ %s";return R+=y.raddr!=null?" raddr %s rport %d":"%v%v",R+=y.tcptype!=null?" tcptype %s":"%v",y.generation!=null&&(R+=" generation %d"),(R+=y["network-id"]!=null?" network-id %d":"%v")+(y["network-cost"]!=null?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(y){var R="ssrc:%d";return y.attribute!=null&&(R+=" %s",y.value!=null&&(R+=":%s")),R}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(y){return y.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(y){return y.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(y){return"imageattr:%s %s %s"+(y.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(y){return"simulcast:%s %s"+(y.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(y){return"ts-refclk:%s"+(y.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(y){var R="mediaclk:";return R+=y.id!=null?"id=%s %s":"%v%s",R+=y.mediaClockValue!=null?"=%s":"",(R+=y.rateNumerator!=null?" rate=%s":"")+(y.rateDenominator!=null?"/%s":"")}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(T).forEach((function(y){T[y].forEach((function(R){R.reg||(R.reg=/(.*)/),R.format||(R.format="%s")}))}))},766:(S,T,y)=>{var R=y(962),v=y(627);T.write=v,T.parse=R.parse,T.parseParams=R.parseParams,T.parseFmtpConfig=R.parseFmtpConfig,T.parsePayloads=R.parsePayloads,T.parseRemoteCandidates=R.parseRemoteCandidates,T.parseImageAttributes=R.parseImageAttributes,T.parseSimulcastStreamList=R.parseSimulcastStreamList},962:(S,T,y)=>{var R=function(A){return String(Number(A))===A?Number(A):A},v=function(A,E,b){var w=A.name&&A.names;A.push&&!E[A.push]?E[A.push]=[]:w&&!E[A.name]&&(E[A.name]={});var C=A.push?{}:w?E[A.name]:E;(function(P,U,B,L){if(L&&!B)U[L]=R(P[1]);else for(var H=0;H<B.length;H+=1)P[H+1]!=null&&(U[B[H]]=R(P[H+1]))})(b.match(A.reg),C,A.names,A.name),A.push&&E[A.push].push(C)},h=y(692),m=RegExp.prototype.test.bind(/^([a-z])=(.*)/);T.parse=function(A){var E={},b=[],w=E;return A.split(/(\r\n|\r|\n)/).filter(m).forEach((function(C){var P=C[0],U=C.slice(2);P==="m"&&(b.push({rtp:[],fmtp:[]}),w=b[b.length-1]);for(var B=0;B<(h[P]||[]).length;B+=1){var L=h[P][B];if(L.reg.test(U))return v(L,w,U)}})),E.media=b,E};var _=function(A,E){var b=E.split(/=(.+)/,2);return b.length===2?A[b[0]]=R(b[1]):b.length===1&&E.length>1&&(A[b[0]]=void 0),A};T.parseParams=function(A){return A.split(/;\s?/).reduce(_,{})},T.parseFmtpConfig=T.parseParams,T.parsePayloads=function(A){return A.toString().split(" ").map(Number)},T.parseRemoteCandidates=function(A){for(var E=[],b=A.split(" ").map(R),w=0;w<b.length;w+=3)E.push({component:b[w],ip:b[w+1],port:b[w+2]});return E},T.parseImageAttributes=function(A){return A.split(" ").map((function(E){return E.substring(1,E.length-1).split(",").reduce(_,{})}))},T.parseSimulcastStreamList=function(A){return A.split(";").map((function(E){return E.split(",").map((function(b){var w,C=!1;return b[0]!=="~"?w=R(b):(w=R(b.substring(1,b.length)),C=!0),{scid:w,paused:C}}))}))}},627:(S,T,y)=>{var R=y(692),v=/%[sdv%]/g,h=function(E){var b=1,w=arguments,C=w.length;return E.replace(v,(function(P){if(b>=C)return P;var U=w[b];switch(b+=1,P){case"%%":return"%";case"%s":return String(U);case"%d":return Number(U);case"%v":return""}}))},m=function(E,b,w){var C=[E+"="+(b.format instanceof Function?b.format(b.push?w:w[b.name]):b.format)];if(b.names)for(var P=0;P<b.names.length;P+=1){var U=b.names[P];b.name?C.push(w[b.name][U]):C.push(w[b.names[P]])}else C.push(w[b.name]);return h.apply(null,C)},_=["v","o","s","i","u","e","p","c","b","t","r","z","a"],A=["i","c","b","a"];S.exports=function(E,b){b=b||{},E.version==null&&(E.version=0),E.name==null&&(E.name=" "),E.media.forEach((function(U){U.payloads==null&&(U.payloads="")}));var w=b.outerOrder||_,C=b.innerOrder||A,P=[];return w.forEach((function(U){R[U].forEach((function(B){B.name in E&&E[B.name]!=null?P.push(m(U,B,E)):B.push in E&&E[B.push]!=null&&E[B.push].forEach((function(L){P.push(m(U,B,L))}))}))})),E.media.forEach((function(U){P.push(m("m",R.m[0],U)),C.forEach((function(B){R[B].forEach((function(L){L.name in U&&U[L.name]!=null?P.push(m(B,L,U)):L.push in U&&U[L.push]!=null&&U[L.push].forEach((function(H){P.push(m(B,L,H))}))}))}))})),P.join(`\r
`)+`\r
`}},776:function(S,T,y){var R,v=this&&this.__extends||(R=function(Q,Z){return R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(q,Y){q.__proto__=Y}||function(q,Y){for(var J in Y)Object.prototype.hasOwnProperty.call(Y,J)&&(q[J]=Y[J])},R(Q,Z)},function(Q,Z){if(typeof Z!="function"&&Z!==null)throw new TypeError("Class extends value "+String(Z)+" is not a constructor or null");function q(){this.constructor=Q}R(Q,Z),Q.prototype=Z===null?Object.create(Z):(q.prototype=Z.prototype,new q)}),h=this&&this.__assign||function(){return h=Object.assign||function(Q){for(var Z,q=1,Y=arguments.length;q<Y;q++)for(var J in Z=arguments[q])Object.prototype.hasOwnProperty.call(Z,J)&&(Q[J]=Z[J]);return Q},h.apply(this,arguments)},m=this&&this.__awaiter||function(Q,Z,q,Y){return new(q||(q=Promise))((function(J,$){function te(he){try{se(Y.next(he))}catch(de){$(de)}}function ie(he){try{se(Y.throw(he))}catch(de){$(de)}}function se(he){var de;he.done?J(he.value):(de=he.value,de instanceof q?de:new q((function(be){be(de)}))).then(te,ie)}se((Y=Y.apply(Q,Z||[])).next())}))},_=this&&this.__generator||function(Q,Z){var q,Y,J,$,te={label:0,sent:function(){if(1&J[0])throw J[1];return J[1]},trys:[],ops:[]};return $={next:ie(0),throw:ie(1),return:ie(2)},typeof Symbol=="function"&&($[Symbol.iterator]=function(){return this}),$;function ie(se){return function(he){return(function(de){if(q)throw new TypeError("Generator is already executing.");for(;$&&($=0,de[0]&&(te=0)),te;)try{if(q=1,Y&&(J=2&de[0]?Y.return:de[0]?Y.throw||((J=Y.return)&&J.call(Y),0):Y.next)&&!(J=J.call(Y,de[1])).done)return J;switch(Y=0,J&&(de=[2&de[0],J.value]),de[0]){case 0:case 1:J=de;break;case 4:return te.label++,{value:de[1],done:!1};case 5:te.label++,Y=de[1],de=[0];continue;case 7:de=te.ops.pop(),te.trys.pop();continue;default:if(!((J=(J=te.trys).length>0&&J[J.length-1])||de[0]!==6&&de[0]!==2)){te=0;continue}if(de[0]===3&&(!J||de[1]>J[0]&&de[1]<J[3])){te.label=de[1];break}if(de[0]===6&&te.label<J[1]){te.label=J[1],J=de;break}if(J&&te.label<J[2]){te.label=J[2],te.ops.push(de);break}J[2]&&te.ops.pop(),te.trys.pop();continue}de=Z.call(Q,te)}catch(be){de=[6,be],Y=0}finally{q=J=0}if(5&de[0])throw de[1];return{value:de[0]?de[1]:void 0,done:!0}})([se,he])}}},A=this&&this.__spreadArray||function(Q,Z,q){if(q||arguments.length===2)for(var Y,J=0,$=Z.length;J<$;J++)!Y&&J in Z||(Y||(Y=Array.prototype.slice.call(Z,0,J)),Y[J]=Z[J]);return Q.concat(Y||Array.prototype.slice.call(Z))},E=this&&this.__importDefault||function(Q){return Q&&Q.__esModule?Q:{default:Q}};Object.defineProperty(T,"__esModule",{value:!0}),T.PeerConnectionCore=T.DEFAULT_HEARTBEAT_INTERVAL=T.EDatachannelStatus=void 0;var b=y(887),w=y(248),C=y(237),P=y(619),U=y(628),B=y(748),L=y(961),H=y(844),O=y(651);Object.defineProperty(T,"EDatachannelStatus",{enumerable:!0,get:function(){return O.EDatachannelStatus}});var x,F=y(854),N=E(y(885)),k=y(132),M=E(y(123)),j=y(125),G="rts video",z="rts audio";T.DEFAULT_HEARTBEAT_INTERVAL=2500,(function(Q){Q.SUB_ADD="subsribe add",Q.SUB_DELETE="subscribe delete",Q.SUB_ACTIVE="subscribe active",Q.SUB_STOP="subscribe stop",Q.PUB_ADD="publish add",Q.PUB_DELETE="publish delete",Q.PUB_REPLACE="publish replace",Q.PUB_STOP="publish stop",Q.DATACHANNEL_SUB_ADD="sub add datachannel",Q.DATACHANNEL_SUB_ACTIVE="sub active datachannel",Q.DATACHANNEL_SUB_DELETE="sub delete datachannel",Q.DATACHANNEL_SUB_STOP="sub stop datachannel",Q.DATACHANNEL_PUB_ADD="pub add datachannel",Q.DATACHANNEL_PUB_DELETE="pub delete datachannel",Q.DATACHANNEL_PUB_STOP="pub stop datachannel"})(x||(x={}));var V=(function(Q){function Z(q){var Y=Q.call(this)||this;return Y.PCCore=q,Y}return v(Z,Q),Z.prototype.excuteSignal=function(q,Y,J,$){var te=this;switch(q){case x.SUB_ADD:this.PCCore.proceedSubscribeAdd($.configList,$.reconnecting).then((function(ie){Y(ie)})).catch((function(ie){J(ie)})).finally((function(){te.emit("onSignalDone")}));break;case x.SUB_DELETE:this.PCCore.proceedSubscribeDeleteTracks($.configList,$.skipError).then((function(ie){Y(ie)})).catch((function(ie){J(ie)})).finally((function(){te.emit("onSignalDone")}));break;case x.SUB_ACTIVE:break;case x.SUB_STOP:this.PCCore.proceedSubscribeStop($.configList).then((function(ie){Y(ie)})).catch((function(ie){J(ie)})).finally((function(){te.emit("onSignalDone")}));break;case x.PUB_ADD:this.PCCore.proceedPublishAdd($.configList).then((function(ie){Y(ie)})).catch((function(ie){J(ie)})).finally((function(){te.emit("onSignalDone")}));break;case x.PUB_REPLACE:this.PCCore.proceedPublishReplaceTracks($.configList).then((function(ie){Y(ie)})).catch((function(ie){J(ie)})).finally((function(){te.emit("onSignalDone")}));break;case x.PUB_DELETE:this.PCCore.proceedPublishDeleteTracks($.configList).then((function(ie){Y(ie)})).catch((function(ie){J(ie)})).finally((function(){te.emit("onSignalDone")}));break;case x.PUB_STOP:this.PCCore.proceedPublishStop($.configList).then((function(ie){Y(ie)})).catch((function(ie){J(ie)})).finally((function(){te.emit("onSignalDone")}));break;case x.DATACHANNEL_SUB_ADD:this.PCCore.proceedSubscribeAddDatachannel($.configList).then((function(ie){Y(ie)})).catch((function(ie){J(ie)})).finally((function(){te.emit("onSignalDone")}));break;case x.DATACHANNEL_SUB_DELETE:this.PCCore.proceedSubscribeDeleteDatachannel($.configList).then((function(ie){Y(ie)})).catch((function(ie){J(ie)})).finally((function(){te.emit("onSignalDone")}));break;case x.DATACHANNEL_SUB_STOP:this.PCCore.proceedSubscribeStopDatachannel($.configList).then((function(ie){Y(ie)})).catch((function(ie){J(ie)})).finally((function(){te.emit("onSignalDone")}));break;case x.DATACHANNEL_PUB_ADD:this.PCCore.proceedPublishAddDatachannel($.configList).then((function(ie){Y(ie)})).catch((function(ie){J(ie)})).finally((function(){te.emit("onSignalDone")}));break;case x.DATACHANNEL_PUB_DELETE:this.PCCore.proceedPublishDeleteDatachannel($.configList).then((function(ie){Y(ie)})).catch((function(ie){J(ie)})).finally((function(){te.emit("onSignalDone")}));break;case x.DATACHANNEL_PUB_STOP:this.PCCore.proceedPublishStopDatachannel($.configList).then((function(ie){Y(ie)})).catch((function(ie){J(ie)})).finally((function(){te.emit("onSignalDone")}))}},Z})(N.default),re=(function(Q){function Z(q){var Y=Q.call(this)||this;return Y.heartbeatTimelineMap=new Map,Y.removeTwcc=!1,Y.mutex=!1,Y.eventQueue=new F.CacheBuffer("signal queue"),Y.rollbackController=new k.PeerConnectionRollbackController(Y),Y.onInnerSubscribeDelete=function(){},Y.receiverCodecPreferences={},Y.senderCodecPreferences={},Y.removeTrackListener=function(){},Y.heartbeatTimerHandle=null,Y.heartbeatTokenRing=0,Y.streamManager=new U.StreamManager,Y.datachannelManager=new B.DatachannelManager,q.pc?(Y.pc=q.pc,Y.signal=new P.Signal({pc:q.pc,onDatachannelEvent:q.onDatachannelEvent,delayOpen:q.delayOpen,initOptions:q.signalDatachannelInitOptions}),Y.heartbeatProcessor=new M.default(Y.streamManager,Y.datachannelManager),Y.initHeartbeatListener(),Y.notifyProcessor=new j.NotifyProcessor,Y.initNotifyListener(),Y.onInnerSubscribeDelete=q.onInnerSubscribeDelete||function(){},Y.offerSdpHook=q.offerSdpHook,Y.answerSdpHook=q.answerSdpHook,Y):(console.error("peerconnetion is required"),Y)}return v(Z,Q),Z.prototype.getStreamManager=function(){return this.streamManager},Z.prototype.getDatachannelManager=function(){return this.datachannelManager},Z.prototype.getSignal=function(){return this.signal},Z.prototype.setPrevOfferSdp=function(q){this.prevOfferSdp=q},Z.prototype.setPrevAnswerSdp=function(q){this.prevAnswerSdp=q},Z.prototype.setStreamManager=function(q){this.streamManager=q},Z.prototype.getTrackIds=function(q){return q.reduce((function(Y,J){return A(A([],Y,!0),[J.id],!1)}),[])},Z.prototype.setRemoveTwcc=function(q){this.removeTwcc=q},Z.prototype.setReceiverCodecPreferences=function(q){this.receiverCodecPreferences=h({},q)},Z.prototype.setSenderCodecPreferences=function(q){this.senderCodecPreferences=h({},q)},Z.prototype.subscribeAdd=function(q,Y){var J=this;return new Promise((function($,te){var ie=new V(J);if(J.mutex){var se={type:x.SUB_ADD,excuter:ie,res:$,rej:te,data:{configList:q}};J.eventQueue.cache(se)}else J.atomSignalExec(x.SUB_ADD,ie,$,te,{configList:q,reconnecting:Y})}))},Z.prototype.subscribeDeleteTracks=function(q,Y){var J=this;return new Promise((function($,te){var ie=new V(J);if(J.mutex){var se={type:x.SUB_DELETE,excuter:ie,res:$,rej:te,data:{configList:q,skipError:Y}};J.eventQueue.cache(se)}else J.atomSignalExec(x.SUB_DELETE,ie,$,te,{configList:q,skipError:Y})}))},Z.prototype.subscribeStop=function(q){var Y=this;return new Promise((function(J,$){var te=new V(Y);if(Y.mutex){var ie={type:x.SUB_STOP,excuter:te,res:J,rej:$,data:{configList:q}};Y.eventQueue.cache(ie)}else Y.atomSignalExec(x.SUB_STOP,te,J,$,{configList:q})}))},Z.prototype.publishAdd=function(q){var Y=this;return new Promise((function(J,$){var te=new V(Y);if(Y.mutex){var ie={type:x.PUB_ADD,excuter:te,res:J,rej:$,data:{configList:q}};Y.eventQueue.cache(ie)}else Y.atomSignalExec(x.PUB_ADD,te,J,$,{configList:q})}))},Z.prototype.publishReplaceTracks=function(q){var Y=this;return new Promise((function(J,$){var te=new V(Y);if(Y.mutex){var ie={type:x.PUB_REPLACE,excuter:te,res:J,rej:$,data:{configList:q}};Y.eventQueue.cache(ie)}else Y.atomSignalExec(x.PUB_REPLACE,te,J,$,{configList:q})}))},Z.prototype.publishDeleteTracks=function(q){var Y=this;return new Promise((function(J,$){var te=new V(Y);if(Y.mutex){var ie={type:x.PUB_DELETE,excuter:te,res:J,rej:$,data:{configList:q}};Y.eventQueue.cache(ie)}else Y.atomSignalExec(x.PUB_DELETE,te,J,$,{configList:q})}))},Z.prototype.publishStop=function(q){var Y=this;return new Promise((function(J,$){var te=new V(Y);if(Y.mutex){var ie={type:x.PUB_STOP,excuter:te,res:J,rej:$,data:{configList:q}};Y.eventQueue.cache(ie)}else Y.atomSignalExec(x.PUB_STOP,te,J,$,{configList:q})}))},Z.prototype.subscribeAddDatachannel=function(q){var Y=this;return new Promise((function(J,$){var te=new V(Y);if(Y.mutex){var ie={type:x.DATACHANNEL_SUB_ADD,excuter:te,res:J,rej:$,data:{configList:q}};Y.eventQueue.cache(ie)}else Y.atomSignalExec(x.DATACHANNEL_SUB_ADD,te,J,$,{configList:q})}))},Z.prototype.subscribeDeleteDatachannel=function(q){var Y=this;return new Promise((function(J,$){var te=new V(Y);if(Y.mutex){var ie={type:x.DATACHANNEL_SUB_DELETE,excuter:te,res:J,rej:$,data:{configList:q}};Y.eventQueue.cache(ie)}else Y.atomSignalExec(x.DATACHANNEL_SUB_DELETE,te,J,$,{configList:q})}))},Z.prototype.subscribeStopDatachannel=function(q){var Y=this;return new Promise((function(J,$){var te=new V(Y);if(Y.mutex){var ie={type:x.DATACHANNEL_SUB_STOP,excuter:te,res:J,rej:$,data:{configList:q}};Y.eventQueue.cache(ie)}else Y.atomSignalExec(x.DATACHANNEL_SUB_STOP,te,J,$,{configList:q})}))},Z.prototype.publishAddDatachannel=function(q){var Y=this;return new Promise((function(J,$){var te=new V(Y);if(Y.mutex){var ie={type:x.DATACHANNEL_PUB_ADD,excuter:te,res:J,rej:$,data:{configList:q}};Y.eventQueue.cache(ie)}else Y.atomSignalExec(x.DATACHANNEL_PUB_ADD,te,J,$,{configList:q})}))},Z.prototype.publishDeleteDatachannel=function(q){var Y=this;return new Promise((function(J,$){var te=new V(Y);if(Y.mutex){var ie={type:x.DATACHANNEL_PUB_DELETE,excuter:te,res:J,rej:$,data:{configList:q}};Y.eventQueue.cache(ie)}else Y.atomSignalExec(x.DATACHANNEL_PUB_DELETE,te,J,$,{configList:q})}))},Z.prototype.publishStopDatachannel=function(q){var Y=this;return new Promise((function(J,$){var te=new V(Y);if(Y.mutex){var ie={type:x.DATACHANNEL_PUB_STOP,excuter:te,res:J,rej:$,data:{configList:q}};Y.eventQueue.cache(ie)}else Y.atomSignalExec(x.DATACHANNEL_PUB_STOP,te,J,$,{configList:q})}))},Z.prototype.atomSignalExec=function(q,Y,J,$,te){var ie=this;this.mutex=!0,Y.once("onSignalDone",(function(){ie.eventQueue.isEmpty()?ie.mutex=!1:setTimeout((function(){var se=ie.eventQueue.getFirst();ie.atomSignalExec(se.type,se.excuter,se.res,se.rej,se.data)}))})),Y.excuteSignal(q,J,$,te)},Z.prototype.proceedSubscribeAdd=function(q,Y){return m(this,void 0,void 0,(function(){var J,$,te,ie,se,he,de,be,Re,Te=this;return _(this,(function(Ae){switch(Ae.label){case 0:if(J=new Date().getTime(),$=new Date().getTime(),te=new Date().getTime(),ie=this,se=this.extendUrl(q),he=se.map((function(Ie){var Le=Ie.urlData,Be=Ie.vMsid,$e=Ie.aMsid;if(Te.streamManager.has(Le.url)){var Ne=Te.streamManager.get(Le.url),ze=Ne.videoInfoList.map((function(dt){return dt.msid})),Je=Ne.audioInfoList.map((function(dt){return dt.msid})),rt=(0,b.intersection)(ze,Be),It=(0,b.intersection)(Je,$e);if(It.length||rt.length)return{url:Le.url,vMsid:rt,aMsid:It}}})).filter((function(Ie){return Ie})),de=[],!he?.length)return[3,4];Ae.label=1;case 1:return Ae.trys.push([1,3,,4]),[4,this.proceedSubscribeDeleteTracks(he,!0,Y)];case 2:return de=Ae.sent(),this.onInnerSubscribeDelete&&this.onInnerSubscribeDelete(he),[3,4];case 3:throw be=Ae.sent(),(Re=be).extraInfo=h(h({},Re.extraInfo),{api:"subscribeAdd",signal_api:"subscribeDeleteTracks",configList:q}),Re;case 4:return J=new Date().getTime(),[2,new Promise((function(Ie,Le){return m(Te,void 0,void 0,(function(){function Be(){return m(this,void 0,void 0,(function(){var ne,oe;return _(this,(function(fe){switch(fe.label){case 0:ie.removeTrackListener(),ne=ie.buildUrlStreamMap(se),fe.label=1;case 1:return fe.trys.push([1,3,,4]),[4,ie.subscribeActive(q)];case 2:return fe.sent(),[3,4];case 3:return(oe=fe.sent()).extraInfo=h(h({},oe.extraInfo),{api:"subscribeAdd",signal_api:"subscribeActive"}),ie.rollbackController.rollback({pcTransceiversRollback:!0,streamManagerRollback:!0}),[2,Le(oe)];case 4:return $=new Date().getTime(),Ie({deleteRspTime:J,subAddRspTime:te,activeRspTime:$,streamList:ne}),[2]}}))}))}var $e,Ne,ze,Je,rt,It,dt,Ct,_t,ft,pt,jt,yt,Nt,kt,fi,X,ae=this;return _(this,(function(ne){switch(ne.label){case 0:if(!this.pc)return[2,Le(new L.RtsError(H.ErrorCode.CORE_NO_PC_ERROR,"subscribeAdd: no peerconnection",""))];this.pc.addEventListener("track",Be),this.removeTrackListener=function(){var oe;(oe=ae.pc)===null||oe===void 0||oe.removeEventListener("track",Be)},this.rollbackController.saveStreamManager(this.streamManager),$e=[],se.forEach((function(oe){var fe,ve,le=oe.urlData,Oe=oe.vMsid,_e=oe.aMsid;if(ae.pc){if(ae.streamManager.init(le.url),le.subVideo&&!ae.streamManager.isMsidSubPubDone(le.url,{vMsid:Oe[0]})){var Ue=ae.pc.addTransceiver("video",{direction:"recvonly"});$e.push({type:"video",msid:Oe[0],trans:Ue});var Fe=(fe=de.find((function(nt){return nt.vMsid===Oe[0]})))===null||fe===void 0?void 0:fe.vStream;ae.streamManager.update(le.url,{vMsid:Oe[0],vTransceiver:Ue,stream:Fe,cumuDelay:ae.cumuDelay}),ae.setCodecPreferences(Ue,ae.receiverCodecPreferences.video)}if(le.subAudio&&!ae.streamManager.isMsidSubPubDone(le.url,{aMsid:_e[0]})){var Ke=ae.pc.addTransceiver("audio",{direction:"recvonly"});$e.push({type:"audio",msid:_e[0],trans:Ke}),Fe=(ve=de.find((function(nt){return nt.aMsid===_e[0]})))===null||ve===void 0?void 0:ve.aStream,ae.streamManager.update(le.url,{aMsid:_e[0],aTransceiver:Ke,stream:Fe}),ae.setCodecPreferences(Ke,ae.receiverCodecPreferences.audio)}}})),this.rollbackController.setFakeSdpMedias($e,"sub"),ne.label=1;case 1:return ne.trys.push([1,3,,4]),[4,this.pc.createOffer()];case 2:return Ne=ne.sent(),[3,4];case 3:return ze=ne.sent(),[2,Le(new L.RtsError(H.ErrorCode.DATACHANNEL_CREATE_OFFER_ERROR,"CreateOffer Error: ".concat(ze),"",{api:"subscribeAdd",err:ze}))];case 4:if(Je=new w.SdpUtil({sdp:Ne.sdp||""}),this.restorePublishedSsrc(Je),Je.addNack(),Je.updateBundle(),Ne=new RTCSessionDescription({type:"offer",sdp:Je.generate()}),rt=this.findNewSubPubMids(Ne?.sdp||"",this.prevOfferSdp||""),this.setPrevOfferSdp(Ne.sdp||""),this.rollbackController.setFakeSdpMids(rt),It=this.avoidMsidConflict(Ne.sdp),this.offerSdpHook)try{It=this.offerSdpHook(It)}catch(oe){console.log("offerSdpHook error: ",oe)}ne.label=5;case 5:return ne.trys.push([5,7,,9]),[4,this.pc.setLocalDescription(new RTCSessionDescription({type:"offer",sdp:It}))];case 6:return ne.sent(),[3,9];case 7:return dt=ne.sent(),[4,this.rollbackController.rollback({trackListnerRollback:!0,pcTransceiversRollback:!0,streamManagerRollback:!0,runSimulateSignal:!0})];case 8:return ne.sent(),[2,Le(new L.RtsError(H.ErrorCode.DATACHANNEL_SET_OFFER_ERROR,"SetLocalDescription error: ".concat(dt),"",{api:"subscribeAdd",sdp:Ne}))];case 9:if(Ct=[],_t=[],se.forEach((function(oe){var fe=new w.SdpUtil({sdp:Ne?.sdp||""}),ve=[],le=oe.vMsid.length!==0,Oe=oe.aMsid.length!==0,_e=!1,Ue=!1;fe.detail.media.forEach((function(Ke){var nt=String(Ke.mid);rt.includes(nt)&&(_t.includes(nt)||(Ke.type==="video"&&le&&!_e?(ve.push(String(Ke.mid)),_e=!0):Ke.type==="audio"&&Oe&&!Ue&&(ve.push(String(Ke.mid)),Ue=!0)))})),_t=A(A([],_t,!0),ve,!0),fe.keepMedia(ve);var Fe=fe.generate();ae.cumuDelay&&(Fe=Fe.replace(/(m=video[^\n]*\n)/,`$1a=cumudelay
`)),Ct.push(Fe)})),this.offerSdpHook)try{Ct=Ct.map((function(oe){return ae.offerSdpHook(oe)}))}catch(oe){console.log("offerSdpHook error: ",oe)}ne.label=10;case 10:return ne.trys.push([10,12,,14]),[4,(X=this.signal)===null||X===void 0?void 0:X.subscribeAdd(se,Ct,this.streamManager)];case 11:return ft=ne.sent(),[3,14];case 12:return pt=ne.sent(),[4,this.rollbackController.rollback({trackListnerRollback:!0,pcTransceiversRollback:!0,streamManagerRollback:!0,runSimulateSignal:!0})];case 13:return ne.sent(),pt.extraInfo=h({api:"subscribeAdd",signal_api:"subscribeAdd"},pt.extraInfo),[2,Le(pt)];case 14:if(jt=[],ft.streams.forEach((function(oe,fe){ae.log("Sub TraceId[".concat(fe,"]: "),oe.traceid);var ve=new w.SdpUtil({sdp:oe.sdp});jt=A(A([],jt,!0),ve.detail.media,!0);var le=se.find((function(Oe){return Oe.urlData.url===oe.url}));le&&(le.traceId=oe.traceid,le.urlTraceId=oe.url_traceid)})),(yt=new w.SdpUtil({sdp:this.prevAnswerSdp||""})).addOrUpdateMedia(jt),this.alignAnswerMidsWithOffer(yt),Nt=yt.generate(),this.setPrevAnswerSdp(Nt),kt=this.avoidMsidConflict(Nt),this.answerSdpHook)try{kt=this.answerSdpHook(kt)}catch(oe){console.log("answerSdpHook error: ",oe)}ne.label=15;case 15:return ne.trys.push([15,17,,19]),[4,this.pc.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:kt}))];case 16:return ne.sent(),se.forEach((function(oe){ae.streamManager.markAlreadySubPub(oe.urlData.url,{vMsid:oe.vMsid[0],aMsid:oe.aMsid[0]})})),[3,19];case 17:return fi=ne.sent(),[4,this.rollbackController.rollback({trackListnerRollback:!0,pcTransceiversRollback:!0,streamManagerRollback:!0})];case 18:return ne.sent(),[2,Le(new L.RtsError(H.ErrorCode.DATACHANNEL_SET_ANSWER_ERROR,"SetRemoteDescription error: ".concat(fi),"",{api:"subscribeAdd",sdp:Nt}))];case 19:return te=new Date().getTime(),[2]}}))}))}))]}}))}))},Z.prototype.subscribeActive=function(q){var Y;return m(this,void 0,void 0,(function(){return _(this,(function(J){return[2,(Y=this.signal)===null||Y===void 0?void 0:Y.subscribeActive(this.extendUrl(q))]}))}))},Z.prototype.proceedSubscribeDeleteTracks=function(q,Y,J){var $,te,ie,se;return m(this,void 0,void 0,(function(){var he,de,be,Re,Te,Ae,Ie,Le=this;return _(this,(function(Be){switch(Be.label){case 0:q.forEach((function($e){$e.rawUrl=$e.url,$e.url=Le.streamManager.getOriginUrl($e.url)})),he=!1,de=!!Y,be=void 0,Be.label=1;case 1:return Be.trys.push([1,3,,4]),[4,($=this.signal)===null||$===void 0?void 0:$.subscribeDelete(q)];case 2:return Be.sent(),[3,4];case 3:return Re=Be.sent(),he=(be=Re).errorCode===H.ErrorCode.DATACHANNEL_RESPONSE_ERROR&&((ie=(te=be.extraInfo)===null||te===void 0?void 0:te.parsedData)===null||ie===void 0?void 0:ie.streams)&&((se=be.extraInfo.parsedData.streams[0])===null||se===void 0?void 0:se.res_code)===404,[3,4];case 4:if(be&&!he)throw be.extraInfo=h({api:"subscribeDeleteTracks"},be.extraInfo),be;return Te=de&&he,Ae=[],Ie=q.map((function($e){var Ne=$e.url,ze=$e.vMsid,Je=$e.aMsid,rt=$e.rawUrl;return m(Le,void 0,void 0,(function(){var It,dt,Ct,_t,ft,pt,jt,yt,Nt,kt;return _(this,(function(fi){switch(fi.label){case 0:Ne=(0,b.pruneSubUrl)(Ne),this.streamManager.has(Ne)&&(ze&&(Ct=this.streamManager.getTransceiver(Ne,{vMsid:ze[0]}))&&(dt=Ct.receiver.track).stop(),Je&&(_t=this.streamManager.getTransceiver(Ne,{aMsid:Je[0]}))&&(It=_t.receiver.track).stop()),fi.label=1;case 1:return fi.trys.push([1,3,,4]),[4,this.simulateOfferAnswer()];case 2:return fi.sent(),[3,4];case 3:throw(ft=fi.sent()).extraInfo=h({api:"subscribeDeleteTracks"},ft.extraInfo),ft;case 4:return dt&&(pt=this.streamManager.getStreamByMsid({url:Ne,vMsid:ze?.[0]}),(Nt=pt?.mediastream)===null||Nt===void 0||Nt.removeTrack(dt)),It&&(jt=this.streamManager.getStreamByMsid({url:Ne,aMsid:Je?.[0]}),(kt=jt?.mediastream)===null||kt===void 0||kt.removeTrack(It)),J||this.streamManager.pruneStreamList(Ne),this.streamManager.removeMsid(Ne,{vMsid:ze?.length?this.unifyMsid(ze,"video"):void 0,aMsid:Je?.length?this.unifyMsid(Je,"audio"):void 0}),yt={url:rt||"",stream:this.streamManager.getStreamByMsid({url:Ne,vMsid:ze?.[0],aMsid:Je?.[0]})},J&&(yt=h(h({},yt),{vStream:pt,aStream:jt,vMsid:ze?.[0],aMsid:Je?.[0]})),Ae.push(yt),[2]}}))}))})),[4,Promise.all(Ie)];case 5:if(Be.sent(),!Te&&be)throw be.extraInfo=h({api:"subscribeDeleteTracks"},be.extraInfo),be;return[2,Ae]}}))}))},Z.prototype.proceedSubscribeStop=function(q){var Y;return m(this,void 0,void 0,(function(){var J,$,te=this;return _(this,(function(ie){switch(ie.label){case 0:return ie.trys.push([0,2,,3]),[4,(Y=this.signal)===null||Y===void 0?void 0:Y.subscribeStop(this.extendUrl(q))];case 1:return ie.sent(),[3,3];case 2:throw(J=ie.sent()).extraInfo=h({api:"subscribeStop"},J.extraInfo),J;case 3:return q.forEach((function(se){se.rawUrl=se.url,se.url=te.streamManager.getOriginUrl(se.url)})),$=q.map((function(se){var he=se.url;return se.rawUrl,se.targetStreams,m(te,void 0,void 0,(function(){var de;return _(this,(function(be){switch(be.label){case 0:he=(0,b.pruneSubUrl)(he),this.streamManager.getAllTransceivers(he).forEach((function(Re){var Te;(Te=Re?.receiver.track)===null||Te===void 0||Te.stop()})),this.streamManager.get(he).streamList.forEach((function(Re){return Re.release()})),this.streamManager.remove(he),be.label=1;case 1:return be.trys.push([1,3,,4]),[4,this.simulateOfferAnswer()];case 2:return be.sent(),[3,4];case 3:throw(de=be.sent()).extraInfo=h({api:"subscribeStop"},de.extraInfo),de;case 4:return[2]}}))}))})),[4,Promise.all($)];case 4:return ie.sent(),[2]}}))}))},Z.prototype.proceedPublishAdd=function(q){var Y;return m(this,void 0,void 0,(function(){var J,$,te,ie,se,he,de,be,Re,Te,Ae,Ie,Le,Be,$e,Ne,ze,Je,rt,It,dt,Ct,_t,ft,pt,jt,yt,Nt,kt,fi=this;return _(this,(function(X){switch(X.label){case 0:if(q.length>1)throw console.error("Only one stream is supported."),new L.RtsError(H.ErrorCode.CORE_PUBLIST_EXCEED_ERROR,"publishAdd: publishList exceed limit","",{api:"publishAdd"});if(!this.pc)throw new L.RtsError(H.ErrorCode.CORE_NO_PC_ERROR,"publishAdd: no peerconnection","",{api:"publishAdd"});J=q[0],$=J.stream,te=this.unifyMsid(J.aMsid,"audio"),ie=this.unifyMsid(J.vMsid,"video"),J.rawUrl=J.url,J.url=this.streamManager.getOriginUrl(J.url),typeof J.updateSourceStream!="boolean"&&(J.updateSourceStream=!0),se=$.videoTrack,he=$.audioTrack,this.rollbackController.saveStreamManager(this.streamManager),de=[],be=this.streamManager.getStreamByMsid({url:J.url,vMsid:ie,aMsid:te}),this.streamManager.init(J.url,U.EStreamType.Publish),se&&(Re=this.pc.addTransceiver($.videoTrack,{direction:"sendonly"}),this.streamManager.update(J.url,{vMsid:ie,vTransceiver:Re,stream:$,cumuDelay:this.cumuDelay}),de.push({type:"video",trans:Re,msid:ie}),this.setCodecPreferences(Re,this.senderCodecPreferences.video)),he&&(Re=this.pc.addTransceiver($.audioTrack,{direction:"sendonly"}),this.streamManager.update(J.url,{aMsid:te,aTransceiver:Re,stream:$}),de.push({type:"audio",trans:Re,msid:te}),this.setCodecPreferences(Re,this.senderCodecPreferences.audio)),this.rollbackController.setFakeSdpMedias(de,"pub"),X.label=1;case 1:return X.trys.push([1,3,,4]),[4,this.pc.createOffer()];case 2:return Te=X.sent(),[3,4];case 3:throw Ae=X.sent(),new L.RtsError(H.ErrorCode.DATACHANNEL_CREATE_OFFER_ERROR,"CreateOffer Error: ".concat(Ae),"",{api:"publishAdd",err:Ae});case 4:if(Ie=new w.SdpUtil({sdp:Te.sdp||""}),Le=this.parseMsidString(ie),Be=this.parseMsidString(te),$e=this.findNewSubPubMids(Te.sdp||"",this.prevOfferSdp||""),this.rollbackController.setFakeSdpMids($e),Le.stream&&Ie.detail.msidSemantic&&(Ie.detail.msidSemantic.token=Le.stream),Ne=Ie.detail.media.reduce((function(ae,ne){return ne.direction==="inactive"?A(A([],ae,!0),[String(ne.mid)],!1):ae}),[]),Ie.detail.media.forEach((function(ae){var ne;if(ae.direction!=="recvonly"&&ae.type!=="application"&&$e.includes(String(ae.mid))){var oe=ae.type==="video"?Le:Be,fe=fi.parseMsidString(ae.msid);fe.stream=oe.stream||fe.stream,fe.track=oe.track||fe.track;var ve=fi.stringifyMsid(fe);ae.msid=ve,(ne=ae.ssrcs)===null||ne===void 0||ne.forEach((function(le){switch(le.attribute){case"cname":case"label":le.value=oe.track||le.value;break;case"msid":le.value=ve;break;case"mslabel":le.value=oe.stream||le.value}}))}})),this.restorePublishedSsrc(Ie),this.restorePublishMsid(Ie),Ie.addNack(),ze=Ie.generate(),this.setPrevOfferSdp(ze),Je=this.avoidMsidConflict(ze),this.offerSdpHook)try{Je=this.offerSdpHook(Je)}catch(ae){console.log("offerSdoHook error: ",ae)}X.label=5;case 5:return X.trys.push([5,7,,8]),[4,this.pc.setLocalDescription(new RTCSessionDescription({type:"offer",sdp:Je}))];case 6:return X.sent(),[3,8];case 7:throw rt=X.sent(),this.rollbackController.rollback({streamManagerRollback:!0,runSimulateSignal:!0}),new L.RtsError(H.ErrorCode.DATACHANNEL_SET_OFFER_ERROR,"SetLocalDescription error: ".concat(rt),"",{api:"publishAdd",sdp:ze});case 8:if(Ie.keepMedia($e),this.updateTrackInfoList({url:J.rawUrl,stream:J.stream,vMsid:ie,aMsid:te,sdpMediaList:Ie.detail.media}),Je=Ie.generate(),this.offerSdpHook)try{Je=this.offerSdpHook(Je)}catch(ae){console.log("offerSdpHook error: ",ae)}X.label=9;case 9:return X.trys.push([9,11,,12]),[4,(Y=this.signal)===null||Y===void 0?void 0:Y.publishAdd([J.url],[Je],[se?[this.stringifyMsid(Le)]:[]],[he?[this.stringifyMsid(Be)]:[]])];case 10:return It=X.sent(),[3,12];case 11:throw dt=X.sent(),(Ct=dt).extraInfo=h({api:"publishAdd"},Ct.extraInfo),this.rollbackController.rollback({streamManagerRollback:!0,runSimulateSignal:!0}),Ct;case 12:if(_t=It.streams[0],J.traceId=_t.traceid,J.urlTraceId=_t.url_traceid,this.log("Pub TraceId: ",J.traceId),(ft=new w.SdpUtil({sdp:_t.sdp})).detail.media.forEach((function(ae){ae.type!=="application"&&ae.direction==="sendrecv"&&(ae.direction="recvonly")})),(pt=new w.SdpUtil({sdp:this.prevAnswerSdp||""})).detail.media.forEach((function(ae){ae.type==="application"&&(delete ae.candidates,delete ae.endOfCandidates)})),pt.setMediaInactive(Ne),pt.addOrUpdateMedia(ft.detail.media,{isPublish:!0}),this.alignAnswerMidsWithOffer(pt),this.removeTwcc&&(jt=["http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"],pt.detail.media.forEach((function(ae){var ne;ae.ext=(ne=ae.ext)===null||ne===void 0?void 0:ne.filter((function(oe){return!jt.includes(oe.uri)}))}))),yt=pt.generate(),this.setPrevAnswerSdp(yt),Nt=this.avoidMsidConflict(yt),this.answerSdpHook)try{Nt=this.answerSdpHook(Nt)}catch(ae){console.log("answerSdpHook error: ",ae)}X.label=13;case 13:return X.trys.push([13,15,,16]),[4,this.pc.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:Nt}))];case 14:return X.sent(),this.streamManager.markAlreadySubPub(J.url,{vMsid:ie,aMsid:te,isPub:!0}),[3,16];case 15:throw kt=X.sent(),this.rollbackController.rollback({streamManagerRollback:!0}),new L.RtsError(H.ErrorCode.DATACHANNEL_SET_ANSWER_ERROR,"SetRemoteDescription error: ".concat(kt),"",{api:"publishAdd",sdp:yt});case 16:return be&&J.updateSourceStream&&be.mergeStream($),[2,q.map((function(ae){return{url:ae.rawUrl,trackInfoList:fi.streamManager.getAllMediaInfoList(J.url),traceId:ae.traceId,urlTraceId:ae.urlTraceId}}))]}}))}))},Z.prototype.proceedPublishDeleteTracks=function(q){var Y,J,$,te,ie,se,he;return m(this,void 0,void 0,(function(){var de,be,Re,Te,Ae,Ie,Le,Be,$e,Ne,ze=this;return _(this,(function(Je){switch(Je.label){case 0:q.forEach((function(rt){rt.rawUrl=rt.url,rt.url=ze.streamManager.getOriginUrl(rt.url)})),Je.label=1;case 1:return Je.trys.push([1,3,,4]),[4,(Y=this.signal)===null||Y===void 0?void 0:Y.publishDelete(q)];case 2:return Je.sent(),[3,4];case 3:throw(de=Je.sent()).extraInfo=h({api:"publishDeleteTracks"},de.extraInfo),de;case 4:if(be=q[0],Re=(0,b.pruneSubUrl)(be.url),typeof be.updateSourceStream!="boolean"&&(be.updateSourceStream=!0),Te=!1,Ae=!1,!this.streamManager.has(Re))return[3,9];!((J=be.vMsid)===null||J===void 0)&&J.length&&((Ie=this.streamManager.getTransceiver(Re,{vMsid:be.vMsid[0]}))!=null&&Ie.sender&&(($=this.pc)===null||$===void 0||$.removeTrack(Ie?.sender)),Te=!0),!((te=be.aMsid)===null||te===void 0)&&te.length&&((Le=this.streamManager.getTransceiver(Re,{aMsid:be.aMsid[0]}))!=null&&Le.sender&&((ie=this.pc)===null||ie===void 0||ie.removeTrack(Le?.sender)),Ae=!0),Je.label=5;case 5:return Je.trys.push([5,7,,8]),[4,this.simulateOfferAnswer()];case 6:return Je.sent(),[3,8];case 7:throw(Be=Je.sent()).extraInfo=h({api:"publishDeleteTracks"},Be.extraInfo),Be;case 8:return($e=this.streamManager.getStreamByMsid({url:Re,vMsid:(se=be.vMsid)===null||se===void 0?void 0:se[0],aMsid:(he=be.aMsid)===null||he===void 0?void 0:he[0]}))&&be.updateSourceStream&&$e.deleteTracks({video:Te,audio:Ae}),this.streamManager.removeMsid(Re,{vMsid:Te?this.unifyMsid(be.vMsid,"video"):void 0,aMsid:Ae?this.unifyMsid(be.aMsid,"audio"):void 0}),this.streamManager.pruneStreamList(Re),Ne=this.streamManager.getAllMediaInfoList(be.url),[2,q.map((function(rt){return{url:rt.rawUrl,trackInfoList:Ne}}))];case 9:return[2]}}))}))},Z.prototype.proceedPublishReplaceTracks=function(q){var Y,J,$,te,ie;return m(this,void 0,void 0,(function(){var se,he,de,be,Re,Te,Ae,Ie,Le,Be,$e=this;return _(this,(function(Ne){switch(Ne.label){case 0:if(se=q[0],he=se.stream,de=se.vMsid,be=se.aMsid,se.rawUrl=se.url,se.url=this.streamManager.getOriginUrl(se.url),!this.streamManager.has(se.url))throw new L.RtsError(H.ErrorCode.CORE_PUB_REPLACE_URL_NOT_FOUND,"No stream found for this url: ".concat(se.url),"",{api:"publishReplaceTracks",configList:q});return typeof se.updateSourceStream!="boolean"&&(se.updateSourceStream=!0),Re=he.audioTrack,Te=he.videoTrack,Ae=this.streamManager.getAllMediaInfoList(se.url,!0),Re&&(Le=(Y=Ae.find((function(ze){return ze.type==="audio"&&(!be||ze.msid===be)})))===null||Y===void 0?void 0:Y.transceiver)&&Re.id!==(($=(J=Le.sender)===null||J===void 0?void 0:J.track)===null||$===void 0?void 0:$.id)?[4,Le.sender.replaceTrack(Re)]:[3,2];case 1:Ne.sent(),Ne.label=2;case 2:return Te?(Ie=Ae.find((function(ze){return ze.type==="video"&&(!de||ze.msid===de)})),(Le=Ie?.transceiver)&&Te.id!==((ie=(te=Le.sender)===null||te===void 0?void 0:te.track)===null||ie===void 0?void 0:ie.id)?[4,Le.sender.replaceTrack(Te)]:[3,4]):[3,4];case 3:Ne.sent(),he.isCustomStream||(Ie.from=he.hasScreen?"screen":"camera"),Ne.label=4;case 4:return(Be=this.streamManager.getStreamByMsid({url:se.url,vMsid:de,aMsid:be}))&&se.updateSourceStream&&Be.mergeStream(he),[2,q.map((function(ze){return{url:ze.rawUrl,trackInfoList:$e.streamManager.getAllMediaInfoList(se.url)}}))]}}))}))},Z.prototype.proceedPublishStop=function(q){var Y;return m(this,void 0,void 0,(function(){var J,$,te=this;return _(this,(function(ie){switch(ie.label){case 0:return ie.trys.push([0,2,,3]),[4,(Y=this.signal)===null||Y===void 0?void 0:Y.publishStop(q.map((function(se){return te.streamManager.getOriginUrl(se.url)})))];case 1:return ie.sent(),[3,3];case 2:throw(J=ie.sent()).extraInfo=h({api:"publishStop"},J.extraInfo),J;case 3:return $=q.map((function(se){var he=se.url;return m(te,void 0,void 0,(function(){var de,be=this;return _(this,(function(Re){switch(Re.label){case 0:he=(0,b.pruneSubUrl)(he),this.streamManager.getAllTransceivers(he).forEach((function(Te){var Ae;Te?.sender&&((Ae=be.pc)===null||Ae===void 0||Ae.removeTrack(Te?.sender))})),this.streamManager.get(he).streamList.forEach((function(Te){return Te.deleteTracks({video:!0,audio:!0})})),this.streamManager.remove(he),Re.label=1;case 1:return Re.trys.push([1,3,,4]),[4,this.simulateOfferAnswer()];case 2:return Re.sent(),[3,4];case 3:throw(de=Re.sent()).extraInfo=h({api:"publishStop"},de.extraInfo),de;case 4:return[2]}}))}))})),[4,Promise.all($)];case 4:return ie.sent(),[2]}}))}))},Z.prototype.proceedSubscribeAddDatachannel=function(q){return m(this,void 0,void 0,(function(){var Y,J,$,te=this;return _(this,(function(ie){switch(ie.label){case 0:if(!((Y=q.map((function(se){var he=te.datachannelManager.getByMsid({url:se.url,msid:se.msid});return he?(he.dispose(),{url:se.url,msid:se.msid}):null})).filter((function(se){return se}))).length>0))return[3,4];ie.label=1;case 1:return ie.trys.push([1,3,,4]),[4,this.proceedSubscribeDeleteDatachannel(Y)];case 2:return ie.sent(),[3,4];case 3:throw J=ie.sent(),($=J).extraInfo=h(h({},$.extraInfo),{api:"subscribeAddDatachannel",signal_api:"subscribeDeleteDatachannel",configList:q}),$;case 4:return this.rollbackController.saveDatachannelManager(this.datachannelManager),[2,new Promise((function(se,he){return m(te,void 0,void 0,(function(){var de,be,Re,Te,Ae,Ie=this;return _(this,(function(Le){switch(Le.label){case 0:return Le.trys.push([0,2,,3]),[4,(Te=this.signal)===null||Te===void 0?void 0:Te.subscribeAddDatachannel(q)];case 1:return Le.sent(),[3,3];case 2:return(de=Le.sent()).extraInfo=h({api:"subscribeAddDatachannel",signal_api:"subscribeAddDatachannel"},de.extraInfo),q.forEach((function(Be){return Be.datachannel.dispose()})),this.rollbackController.rollback({datachannelManagerRollback:!0}),[2,he(de)];case 3:be={},Le.label=4;case 4:return Le.trys.push([4,6,,7]),[4,(Ae=this.signal)===null||Ae===void 0?void 0:Ae.subscribeActiveDatachannel(q)];case 5:return be=Le.sent(),[3,7];case 6:return(Re=Le.sent()).extraInfo=h({api:"subscribeAddDatachannel",signal_api:"subscribeActiveDatachannel"},Re.extraInfo),console.log("Trying to rollback datachannel"),q.forEach((function(Be){return Be.datachannel.dispose()})),this.rollbackController.rollback({datachannelManagerRollback:!0}),[2,he(Re)];case 7:return q.forEach((function(Be){Ie.datachannelManager.update({type:"sub-data",url:(0,b.pruneSubUrl)(Be.url,!0),msids:[{name:Be.msid,id:Be.datachannelId,type:"data",label:Be.label,datachannel:Be.datachannel}],originUrl:Be.url,streams:[]})})),se(be),[2]}}))}))}))]}}))}))},Z.prototype.proceedSubscribeDeleteDatachannel=function(q){return m(this,void 0,void 0,(function(){var Y=this;return _(this,(function(J){return[2,new Promise((function($,te){return m(Y,void 0,void 0,(function(){var ie,se,he,de,be,Re,Te,Ae=this;return _(this,(function(Ie){switch(Ie.label){case 0:return Ie.trys.push([0,2,,3]),[4,(he=this.signal)===null||he===void 0?void 0:he.subscribeDeleteDatachannel(q)];case 1:return Ie.sent(),[3,3];case 2:return ie=Ie.sent(),((Te=(Re=(be=(de=(se=ie)==null?void 0:se.extraInfo)===null||de===void 0?void 0:de.parsedData)===null||be===void 0?void 0:be.streams)===null||Re===void 0?void 0:Re[0])===null||Te===void 0?void 0:Te.res_code)===404?[3,3]:(se.extraInfo=h({api:"subscribeDeleteDatachannel",signal_api:"subscribeDeleteDatachannel"},se.extraInfo),[2,te(ie)]);case 3:return q.forEach((function(Le){Ae.datachannelManager.remove({url:(0,b.pruneSubUrl)(Le.url,!0)})})),$(),[2]}}))}))}))]}))}))},Z.prototype.proceedSubscribeStopDatachannel=function(q){return m(this,void 0,void 0,(function(){var Y=this;return _(this,(function(J){return[2,new Promise((function($,te){return m(Y,void 0,void 0,(function(){var ie,se,he,de,be,Re,Te,Ae=this;return _(this,(function(Ie){switch(Ie.label){case 0:return Ie.trys.push([0,2,,3]),[4,(he=this.signal)===null||he===void 0?void 0:he.subscribeStopDatachannel(q)];case 1:return Ie.sent(),[3,3];case 2:return ie=Ie.sent(),((Te=(Re=(be=(de=(se=ie)==null?void 0:se.extraInfo)===null||de===void 0?void 0:de.parsedData)===null||be===void 0?void 0:be.streams)===null||Re===void 0?void 0:Re[0])===null||Te===void 0?void 0:Te.res_code)===404?[3,3]:(se.extraInfo=h({api:"subscribeStopDatachannel",signal_api:"subscribeStopDatachannel"},se.extraInfo),[2,te(ie)]);case 3:return q.forEach((function(Le){Ae.datachannelManager.remove({url:(0,b.pruneSubUrl)(Le.url,!0)})})),$(),[2]}}))}))}))]}))}))},Z.prototype.proceedPublishAddDatachannel=function(q){return m(this,void 0,void 0,(function(){var Y=this;return _(this,(function(J){return[2,new Promise((function($,te){return m(Y,void 0,void 0,(function(){var ie,se,he,de=this;return _(this,(function(be){switch(be.label){case 0:ie={},be.label=1;case 1:return be.trys.push([1,3,,4]),[4,(he=this.signal)===null||he===void 0?void 0:he.publishAddDatachannel(q)];case 2:return ie=be.sent(),[3,4];case 3:return(se=be.sent()).extraInfo=h({api:"publishAddDatachannel",signal_api:"publishAddDatachannel"},se.extraInfo),[2,te(se)];case 4:return q.forEach((function(Re){de.datachannelManager.update({type:"pub-data",url:(0,b.pruneSubUrl)(Re.url,!0),msids:[{name:Re.msid,id:Re.datachannelId,type:"data",label:Re.label,datachannel:Re.datachannel}],originUrl:Re.url,streams:[]})})),$(ie),[2]}}))}))}))]}))}))},Z.prototype.proceedPublishDeleteDatachannel=function(q){return m(this,void 0,void 0,(function(){var Y=this;return _(this,(function(J){return[2,new Promise((function($,te){return m(Y,void 0,void 0,(function(){var ie,se,he=this;return _(this,(function(de){switch(de.label){case 0:return de.trys.push([0,2,,3]),[4,(se=this.signal)===null||se===void 0?void 0:se.publishDeleteDatachannel(q)];case 1:return de.sent(),[3,3];case 2:return(ie=de.sent()).extraInfo=h({api:"publishDeleteDatachannel",signal_api:"publishDeleteDatachannel"},ie.extraInfo),[2,te(ie)];case 3:return q.forEach((function(be){he.datachannelManager.remove({url:(0,b.pruneSubUrl)(be.url,!0)})})),$(),[2]}}))}))}))]}))}))},Z.prototype.proceedPublishStopDatachannel=function(q){return m(this,void 0,void 0,(function(){var Y=this;return _(this,(function(J){return[2,new Promise((function($,te){return m(Y,void 0,void 0,(function(){var ie,se,he=this;return _(this,(function(de){switch(de.label){case 0:return de.trys.push([0,2,,3]),[4,(se=this.signal)===null||se===void 0?void 0:se.publishStopDatachannel(q)];case 1:return de.sent(),[3,3];case 2:return(ie=de.sent()).extraInfo=h({api:"publishStopDatachannel",signal_api:"publishStopDatachannel"},ie.extraInfo),[2,te(ie)];case 3:return q.forEach((function(be){he.datachannelManager.remove({url:(0,b.pruneSubUrl)(be.url,!0)})})),$(),[2]}}))}))}))]}))}))},Z.prototype.buildUrlStreamMap=function(q){var Y=this,J=[];return q.forEach((function($){var te=$.urlData,ie=$.traceId,se=$.urlTraceId,he=$.url,de=$.vMsid,be=$.aMsid,Re=te.url,Te=new MediaStream;Y.streamManager.getAllMediaInfoList(Re,!0).forEach((function(Ae){var Ie,Le;if(Ae.type==="video"&&Ae.msid===de[0]||Ae.type==="audio"&&Ae.msid===be[0]){var Be=(Le=(Ie=Ae.transceiver)===null||Ie===void 0?void 0:Ie.receiver)===null||Le===void 0?void 0:Le.track;Be&&Te.addTrack(Be)}})),J.push({url:he,stream:Te,traceId:ie,urlTraceId:se})})),J},Z.prototype.extendUrl=function(q){var Y=this;return q.map((function(J){var $=J.url,te=J.subAudio,ie=J.subVideo,se=J.aMsid,he=J.vMsid,de=Y.streamManager.getOriginUrl($),be=new C.UrlData({url:de,subAudio:te,subVideo:ie});return h(h({},J),{urlData:be,aMsid:be.subAudio?se||[z]:[],vMsid:be.subVideo?he||[G]:[]})}))},Z.prototype.parseSdp=function(q){return new w.SdpUtil({sdp:q})},Z.prototype.getTrackInfoList=function(q,Y,J){q===void 0&&(q=[]);var $=[];return q.forEach((function(te){var ie,se,he,de;if(te.type!=="application"){var be,Re=Number(te.ssrcs&&((ie=te.ssrcs[0])===null||ie===void 0?void 0:ie.id))||-1,Te=te.rtp.find((function(Ne){var ze;return["opus","h264"].includes((ze=Ne.codec)===null||ze===void 0?void 0:ze.toLowerCase())})),Ae=Te?.codec||"",Ie=Te?.payload||0;Y.isCustomStream||te.type==="video"&&(be=Y.hasScreen?"screen":"camera");var Le=te.msid;if(J?.aMsid||J?.vMsid){var Be=(te.type==="video"?J.vMsid:J.aMsid)||"";Be?.trim().includes(" ")||(Le=(se=te.msid)===null||se===void 0?void 0:se.split(" ")[1])}var $e=te.type==="video"?(he=Y.videoTrack)===null||he===void 0?void 0:he.id:(de=Y.audioTrack)===null||de===void 0?void 0:de.id;$.push({ssrc:Re,codec:Ae,type:te.type,pt:Ie,msid:Le,from:be,trackId:$e})}})),$},Z.prototype.patchSubscribeStreamManagerRecord=function(q,Y){var J=this;this.extendUrl([{url:q,vMsid:Y.vMsid,aMsid:Y.aMsid}]).forEach((function($){var te=$.urlData,ie=$.vMsid,se=$.aMsid;if(J.pc&&(J.cumuDelay=Y.cumuDelay,J.streamManager.remove(te.url),J.streamManager.init(te.url),J.pc.getTransceivers)){var he=J.pc.getTransceivers()||[];if(te.subVideo){var de=he.find((function(Re){return Re.receiver.track.kind==="video"}));J.streamManager.update(te.url,{vMsid:ie[0],vTransceiver:de,stream:Y.stream,cumuDelay:Y.cumuDelay})}if(te.subAudio){var be=he.find((function(Re){return Re.receiver.track.kind==="audio"}));J.streamManager.update(te.url,{aMsid:se[0],aTransceiver:be,stream:Y.stream})}J.streamManager.markAlreadySubPub(q,{vMsid:ie[0],aMsid:se[0],isPub:!1})}}))},Z.prototype.patchPublishStreamManagerRecord=function(q,Y){if(this.pc){var J=Y.stream,$=J.videoTrack,te=J.audioTrack,ie=this.unifyMsid(Y.aMsid,"audio"),se=this.unifyMsid(Y.vMsid,"video");if(this.streamManager.init(q,U.EStreamType.Publish),this.cumuDelay=Y.cumuDelay,this.pc.getTransceivers){var he=this.pc.getTransceivers()||[];if($){var de=he.find((function(Re){var Te,Ae;return((Ae=(Te=Re.sender)===null||Te===void 0?void 0:Te.track)===null||Ae===void 0?void 0:Ae.id)===$.id}));de&&this.streamManager.update(q,{vMsid:se,vTransceiver:de,stream:Y.stream,cumuDelay:Y.cumuDelay})}if(te){var be=he.find((function(Re){var Te,Ae;return((Ae=(Te=Re.sender)===null||Te===void 0?void 0:Te.track)===null||Ae===void 0?void 0:Ae.id)===te.id}));be&&this.streamManager.update(q,{aMsid:ie,aTransceiver:be,stream:Y.stream})}this.streamManager.markAlreadySubPub(q,{vMsid:se,aMsid:ie,isPub:!0})}}},Z.prototype.updateTrackInfoList=function(q){var Y=q.url,J=q.stream,$=q.vMsid,te=q.aMsid,ie=q.sdpMediaList;Y||console.error("[updateTrackInfoList] url is required");var se=this.getTrackInfoList(ie,J,{vMsid:$,aMsid:te}),he=se.find((function(be){return be.type==="video"})),de=se.find((function(be){return be.type==="audio"}));return $&&he&&this.streamManager.updateSdpInfo(Y,h({vMsid:$},he)),te&&de&&this.streamManager.updateSdpInfo(Y,h({aMsid:te},de)),se},Z.prototype.unifyMsid=function(q,Y){var J=Y==="video"?G:z;return q?.[0]||J},Z.prototype.startSignalHeartbeatTimer=function(q){var Y=this;q&&q<200?console.warn("PEER CORE: heartbeat interval ".concat(q," is too small and will not take effect. At least 200ms")):(this.stopSignalHeartbeatTimer(),this.heartbeatTimerHandle=setInterval((function(){var J=void 0,$=Y.streamManager.getSubOrPubDoneMediaMapSize(),te=$+Y.datachannelManager.getSize();if(Y.heartbeatTokenRing%=te,Y.heartbeatTokenRing<$){var ie=Y.heartbeatTokenRing,se=Y.streamManager.getPubOrSubDoneMediaUrlByIndex(ie);se&&(J=[]).push({url:se})}else if(Y.heartbeatTokenRing<te){ie=Y.heartbeatTokenRing-$;var he=Y.datachannelManager.getUrlByIndex(ie);he&&(J=[]).push(he)}Y.heartbeatTokenRing++,Y.heartbeatTokenRing%=te,Y.sendOnceHeartbeat(J)}),q||T.DEFAULT_HEARTBEAT_INTERVAL))},Z.prototype.stopSignalHeartbeatTimer=function(){this.heartbeatTimerHandle!==null&&clearInterval(this.heartbeatTimerHandle),this.heartbeatTimerHandle=null},Z.prototype.sendOnceHeartbeat=function(q){var Y,J,$=(Y=this.signal)===null||Y===void 0?void 0:Y.sendHeartbeat(q);$&&(this.hebtLog(">>> Send: heartbeat",$),this.heartbeatTimelineMap.set($.msg_id,performance.now()),(J=this.heartbeatProcessor)===null||J===void 0||J.setLatestHeartbeatMsgId($.msg_id))},Z.prototype.sendFalseHeartbeat=function(q){var Y,J=(Y=this.signal)===null||Y===void 0?void 0:Y.sendFalseHeartbeat(q);J&&(this.hebtLog(">>> Send: false heartbeat",q),this.heartbeatTimelineMap.set(J.msg_id,performance.now()))},Z.prototype.dispose=function(){var q,Y,J,$,te;this.pc=void 0,this.prevOfferSdp=void 0,this.prevAnswerSdp=void 0,(q=this.signal)===null||q===void 0||q.dispose(),(Y=this.streamManager)===null||Y===void 0||Y.dispose(),(J=this.datachannelManager)===null||J===void 0||J.dispose(),($=this.heartbeatProcessor)===null||$===void 0||$.dispose(),(te=this.notifyProcessor)===null||te===void 0||te.dispose(),this.stopSignalHeartbeatTimer(),this.heartbeatTimelineMap.clear(),this.eventQueue=new F.CacheBuffer("signal queue")},Z.prototype.initHeartbeatListener=function(){var q,Y,J,$,te,ie,se,he=this;(q=this.heartbeatProcessor)===null||q===void 0||q.on("pcReconnect",(function(de){he.emit("pcReconnect",de)})),(Y=this.heartbeatProcessor)===null||Y===void 0||Y.on("streamError",(function(de){he.emit("streamError",de)})),(J=this.heartbeatProcessor)===null||J===void 0||J.on("streamReconnect",(function(de){he.emit("streamReconnect",de)})),($=this.heartbeatProcessor)===null||$===void 0||$.on("traceIdUpdate",(function(de){he.emit("traceIdUpdate",de)})),(te=this.heartbeatProcessor)===null||te===void 0||te.on("hebtReceived",(function(de){if(de){var be=he.heartbeatTimelineMap.get(de.msg_id)||0;he.heartbeatTimelineMap.delete(de.msg_id),he.hebtLog("<<< Received: heartbeat","".concat(Math.ceil(performance.now()-be),"ms"),de)}he.emit("hebtReceived",de)})),(ie=this.heartbeatProcessor)===null||ie===void 0||ie.on("datachannelNotEnabled",(function(){he.emit("datachannelNotEnabled")})),(se=this.signal)===null||se===void 0||se.getDatachannelCore().on("message",(function(de){var be;(be=he.heartbeatProcessor)===null||be===void 0||be.process(de)}))},Z.prototype.initNotifyListener=function(){var q,Y,J,$=this;(q=this.notifyProcessor)===null||q===void 0||q.on("pcReconnect",(function(te){$.emit("pcReconnect",te)})),(Y=this.notifyProcessor)===null||Y===void 0||Y.on("message",(function(te){$.emit("message",te)})),(J=this.signal)===null||J===void 0||J.getDatachannelCore().on("message",(function(te){var ie,se;(ie=$.notifyProcessor)===null||ie===void 0||ie.processIpMigration(te),(se=$.notifyProcessor)===null||se===void 0||se.processInternalException(te)}))},Z.prototype.findNewSubPubMids=function(q,Y){var J=new w.SdpUtil({sdp:q}),$=new w.SdpUtil({sdp:Y}),te=J.detail.media.filter((function(se){return se.direction!=="inactive"})).map((function(se){return se.mid})),ie=$.detail.media.map((function(se){return se.mid}));return this.findDiff(te,ie).map((function(se){return String(se)}))},Z.prototype.findDiff=function(q,Y){return Array.from(new Set(A([],q,!0).filter((function(J){return!Y.includes(J)}))))},Z.prototype.parseMsidString=function(q){var Y={stream:"",track:""};if(!q)return Y;var J=q.trim().split(" "),$=J[0],te=J[1];return te?(Y.stream=$,Y.track=te):Y.track=$,Y},Z.prototype.stringifyMsid=function(q){var Y=q.stream,J=q.track;return"".concat(Y).concat(Y?" ":"").concat(J)},Z.prototype.restorePublishedSsrc=function(q){var Y=new w.SdpUtil({sdp:this.prevOfferSdp||""}).getPublishSsrcs();q.detail.media.forEach((function(J){var $;J.direction!=="recvonly"&&(($=J.ssrcs)===null||$===void 0||$.forEach((function(te){var ie,se=(ie=Y.find((function(he){return he.mid===String(J.mid)})))===null||ie===void 0?void 0:ie.ssrc;se&&(te.id=String(se))})))}))},Z.prototype.restorePublishMsid=function(q){var Y=this,J=new w.SdpUtil({sdp:this.prevOfferSdp||""}).getPublishMsids();J?.length&&q.detail.media.forEach((function($){var te,ie;if($.direction!=="recvonly"){var se=(te=J.find((function(de){return de.mid===String($.mid)})))===null||te===void 0?void 0:te.msid;if(!se)return;var he=Y.parseMsidString(se);$.msid=se||$.msid,(ie=$.ssrcs)===null||ie===void 0||ie.forEach((function(de){switch(de.attribute){case"cname":de.value=he.track||de.value;break;case"msid":de.value=se||de.value}}))}}))},Z.prototype.alignAnswerMidsWithOffer=function(q){var Y=new w.SdpUtil({sdp:this.prevOfferSdp||""}).detail.media.map((function(ie){return String(ie.mid)})),J=q.detail.media.map((function(ie){return String(ie.mid)})),$=this.findDiff(J,Y);q.removeMedia($);var te=[];Y.forEach((function(ie){var se=q.detail.media.find((function(he){return String(he.mid)===ie}));se&&te.push(se)})),q.detail.media=te.filter((function(ie){return ie}))},Z.prototype.simulateOfferAnswer=function(q){var Y,J,$;return m(this,void 0,void 0,(function(){var te,ie,se,he,de,be,Re,Te,Ae,Ie,Le,Be,$e;return _(this,(function(Ne){switch(Ne.label){case 0:return Ne.trys.push([0,2,,3]),[4,(Y=this.pc)===null||Y===void 0?void 0:Y.createOffer()];case 1:return te=Ne.sent(),ie=new w.SdpUtil({sdp:te?.sdp||""}),se=ie.detail.media.filter((function(ze){return ze.direction==="inactive"})).map((function(ze){return String(ze.mid)})),this.restorePublishedSsrc(ie),this.restorePublishMsid(ie),this.prevOfferSdp=ie.generate(),(he=new w.SdpUtil({sdp:this.prevAnswerSdp||""})).setMediaInactive(se),q&&(de=(0,w.generateFakeMediaSdpAnswer)(q))&&(be=new w.SdpUtil({sdp:de}),Re=A([],be.detail.media,!0),he.addOrUpdateMedia(Re),this.alignAnswerMidsWithOffer(he)),Te=he.generate(),this.setPrevAnswerSdp(Te),[3,3];case 2:throw Ae=Ne.sent(),new L.RtsError(H.ErrorCode.DATACHANNEL_CREATE_OFFER_ERROR,"CreateOffer error: ".concat(Ae),"",{pc:this.pc});case 3:if(Ie=this.avoidMsidConflict(this.prevOfferSdp),this.offerSdpHook)try{Ie=this.offerSdpHook(Ie)}catch(ze){console.log("offerSdoHook error: ",ze)}Ne.label=4;case 4:return Ne.trys.push([4,6,,7]),[4,(J=this.pc)===null||J===void 0?void 0:J.setLocalDescription(new RTCSessionDescription({type:"offer",sdp:Ie}))];case 5:return Ne.sent(),[3,7];case 6:throw Le=Ne.sent(),new L.RtsError(H.ErrorCode.DATACHANNEL_SET_OFFER_ERROR,"SetLocalDescription error: ".concat(Le),"",{sdp:this.prevOfferSdp});case 7:if(Ne.trys.push([7,10,,11]),!this.prevAnswerSdp)return[3,9];if(Be=this.avoidMsidConflict(this.prevAnswerSdp),this.answerSdpHook)try{Be=this.answerSdpHook(Be)}catch(ze){console.log("answerSdpHook error: ",ze)}return[4,($=this.pc)===null||$===void 0?void 0:$.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:Be}))];case 8:Ne.sent(),Ne.label=9;case 9:return[3,11];case 10:throw $e=Ne.sent(),new L.RtsError(H.ErrorCode.DATACHANNEL_SET_ANSWER_ERROR,"SetRemoteDescription error: ".concat($e),"",{sdp:this.prevAnswerSdp});case 11:return[2]}}))}))},Z.prototype.avoidMsidConflict=function(q){var Y=new w.SdpUtil({sdp:q});return Y.mungleMsid(),Y.generate()},Z.prototype.setCodecPreferences=function(q,Y){if(Y)try{q.setCodecPreferences(Y)}catch(J){console.warn("setCodecPreferences error",J)}},Z.prototype.log=function(){for(var q=[],Y=0;Y<arguments.length;Y++)q[Y]=arguments[Y];window.RTS_DATACHANNEL_DEBUG&&console.log.apply(console,A(["[PC-Core]"],q,!1))},Z.prototype.hebtLog=function(){for(var q,Y,J=[],$=0;$<arguments.length;$++)J[$]=arguments[$];window.RTS_HEBT_DEBUG&&console.log.apply(console,A(["".concat(this.now()," [datachannel|").concat((q=this.signal)===null||q===void 0?void 0:q.getDatachannelCore().label,"|").concat((Y=this.signal)===null||Y===void 0?void 0:Y.getDatachannelCore().id,"]")],J,!1))},Z.prototype.now=function(){var q=new Date;return"".concat(q.getHours(),":").concat(q.getMinutes(),":").concat(q.getSeconds(),".").concat(String(q.getMilliseconds()).padStart(3,"0"))},Z})(N.default);T.PeerConnectionCore=re},651:function(S,T,y){var R,v=this&&this.__extends||(R=function(L,H){return R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(O,x){O.__proto__=x}||function(O,x){for(var F in x)Object.prototype.hasOwnProperty.call(x,F)&&(O[F]=x[F])},R(L,H)},function(L,H){if(typeof H!="function"&&H!==null)throw new TypeError("Class extends value "+String(H)+" is not a constructor or null");function O(){this.constructor=L}R(L,H),L.prototype=H===null?Object.create(H):(O.prototype=H.prototype,new O)}),h=this&&this.__assign||function(){return h=Object.assign||function(L){for(var H,O=1,x=arguments.length;O<x;O++)for(var F in H=arguments[O])Object.prototype.hasOwnProperty.call(H,F)&&(L[F]=H[F]);return L},h.apply(this,arguments)},m=this&&this.__importDefault||function(L){return L&&L.__esModule?L:{default:L}};Object.defineProperty(T,"__esModule",{value:!0}),T.DataChannelCore=T.EDatachannelStatus=void 0;var _,A=y(844),E=y(961),b=y(854),w=m(y(885)),C=m(y(973)),P=m(y(775));function U(){}(function(L){L[L.DATACHANNEL_STATUS_CLOSE=0]="DATACHANNEL_STATUS_CLOSE",L[L.DATACHANNEL_STATUS_OPEN=1]="DATACHANNEL_STATUS_OPEN"})(_=T.EDatachannelStatus||(T.EDatachannelStatus={}));var B=(function(L){function H(O){var x=L.call(this)||this;return x.mutexSendData=!1,x.timerSendData=null,x.eventQueue=new b.CacheBuffer("send tasks"),x.idle=!1,x.datachannelList=[],x.pc=O.pc,x.eventHandler=O.onDatachannelEvent||U,x.datachannelList=O.datachannelList||[],x.createDatachannel(O.label,O.assignId,O.delayOpen,O.initOptions),x}return v(H,L),H.prototype.getWebrtcDatachannel=function(){return this.datachannel},Object.defineProperty(H.prototype,"isIdle",{get:function(){return this.idle},enumerable:!1,configurable:!0}),H.prototype.markAsIdle=function(){this.idle=!0},H.prototype.reuse=function(){var O=this;this.idle=!1,console.log("REUSEING datachannel",this.datachannel.id,this.datachannel.label,this.datachannel.readyState),setTimeout((function(){O.emit("statusChange",_.DATACHANNEL_STATUS_OPEN)}))},H.prototype.getNextId=function(){var O=0,x=this.datachannelList.reduce((function(F,N){return N.readyState==="open"?F+1:(O||(O=N.id),F)}),0);return O||2*(x+1)},H.prototype.createDatachannel=function(O,x,F,N){var k=this,M=h({ordered:!0},N);x&&this.pc.connectionState==="connected"&&(M.id=this.getNextId()),this.datachannel=this.pc.createDataChannel(O||"GRTN_RTC_DATACHANNEL"+"_".concat(Date.now()),M),this.datachannel.addEventListener("open",(function(){F?setTimeout((function(){k.eventHandler(_.DATACHANNEL_STATUS_OPEN),k.emit("statusChange",_.DATACHANNEL_STATUS_OPEN)}),200):(k.eventHandler(_.DATACHANNEL_STATUS_OPEN),k.emit("statusChange",_.DATACHANNEL_STATUS_OPEN))})),this.datachannel.addEventListener("close",(function(){k.eventHandler(_.DATACHANNEL_STATUS_CLOSE),k.emit("statusChange",_.DATACHANNEL_STATUS_CLOSE)})),this.datachannel.addEventListener("closing",(function(){})),this.datachannel.addEventListener("error",(function(j){console.log(">> error",j),k.emit("error",j)})),this.datachannel.addEventListener("bufferedamountlow",(function(){})),this.datachannel.addEventListener("message",(function(j){k.emit("message",j.data)}))},Object.defineProperty(H.prototype,"id",{get:function(){return this.datachannel.id},enumerable:!1,configurable:!0}),Object.defineProperty(H.prototype,"label",{get:function(){return this.datachannel.label},enumerable:!1,configurable:!0}),Object.defineProperty(H.prototype,"readyState",{get:function(){return this.datachannel.readyState},enumerable:!1,configurable:!0}),H.prototype.send=function(O){if(this.datachannel.readyState!=="open")throw new Error("Datachannel(label:".concat(this.datachannel.label,",id:").concat(this.datachannel.id,") is closed."));return this.datachannel.send(O)},H.prototype.sendAsync=function(O){if(this.datachannel.readyState==="open")return this.datachannel.send((0,P.default)(O)),!0;console.log("Async signal message failed. Datachannel(label:".concat(this.datachannel.label,",id:").concat(this.datachannel.id,") is closed."))},H.prototype.sendData=function(O){var x=this;return new Promise((function(F,N){var k=new C.default(x.datachannel);if(x.mutexSendData){var M={sender:k,res:F,rej:N,data:O};x.eventQueue.cache(M)}else x.atomSend(k,F,N,O)}))},H.prototype.dispose=function(O){var x;O===void 0&&(O=!1),this.emit("dispose"),this.mutexSendData=!1,this.timerSendData!==null&&clearTimeout(this.timerSendData),this.timerSendData=null,this.eventQueue=new b.CacheBuffer("send tasks"),this.markAsIdle(),this.removeAllListeners(),O&&((x=this.datachannel)===null||x===void 0||x.close())},H.prototype.atomSend=function(O,x,F,N){var k=this;this.mutexSendData=!0,O.on("onSendDataDone",(function(){if(O.dispose(),k.timerSendData!==null&&clearTimeout(k.timerSendData),k.timerSendData=null,k.mutexSendData=!1,!k.eventQueue.isEmpty()){var M=k.eventQueue.getFirst();k.atomSend(M.sender,M.res,M.rej,M.data)}})),this.timerSendData=setTimeout((function(){F(new E.RtsError(A.ErrorCode.DATACHANNEL_TIMEOUT_ERROR,"request timeout after ".concat(H.REQUEST_TIMEOUT,"ms"),"",N)),k.timerSendData=null,k.mutexSendData=!1,O.emit("onSendDataDone")}),H.REQUEST_TIMEOUT),O.sendingProcess(x,F,N)},H.REQUEST_TIMEOUT=5e3,H})(w.default);T.DataChannelCore=B},973:function(S,T,y){var R,v=this&&this.__extends||(R=function(U,B){return R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(L,H){L.__proto__=H}||function(L,H){for(var O in H)Object.prototype.hasOwnProperty.call(H,O)&&(L[O]=H[O])},R(U,B)},function(U,B){if(typeof B!="function"&&B!==null)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function L(){this.constructor=U}R(U,B),U.prototype=B===null?Object.create(B):(L.prototype=B.prototype,new L)}),h=this&&this.__spreadArray||function(U,B,L){if(L||arguments.length===2)for(var H,O=0,x=B.length;O<x;O++)!H&&O in B||(H||(H=Array.prototype.slice.call(B,0,O)),H[O]=B[O]);return U.concat(H||Array.prototype.slice.call(B))},m=this&&this.__importDefault||function(U){return U&&U.__esModule?U:{default:U}};Object.defineProperty(T,"__esModule",{value:!0}),T.EDatachannelSignalResCode=T.EMessageType=void 0;var _,A,E=y(844),b=y(961),w=m(y(885)),C=m(y(775));(function(U){U.HEBT="hebt",U.NOTI="NOTI"})(_=T.EMessageType||(T.EMessageType={})),(function(U){U[U.NGX_RTC_PUBLISH_ALREADY=402]="NGX_RTC_PUBLISH_ALREADY",U[U.NGX_RTC_REQUEST_FORBIDDEN=403]="NGX_RTC_REQUEST_FORBIDDEN",U[U.NGX_RTC_STREAM_NO_FOUND=404]="NGX_RTC_STREAM_NO_FOUND",U[U.NGX_RTC_SUBSCRIBE_ALREADY=410]="NGX_RTC_SUBSCRIBE_ALREADY",U[U.NGX_RTC_NORMAL_CLOSED=200]="NGX_RTC_NORMAL_CLOSED",U[U.NGX_RTC_LIMITED=508]="NGX_RTC_LIMITED",U[U.NGX_RTC_INTERNAL_SERVER_ERROR=500]="NGX_RTC_INTERNAL_SERVER_ERROR",U[U.NGX_RTC_BAD_REQUEST=400]="NGX_RTC_BAD_REQUEST",U[U.NGX_RTC_NEED_RETRY=213]="NGX_RTC_NEED_RETRY",U[U.NGX_RTC_DATACHANNEL_HEBT_MSID_NOT_FOUND=130]="NGX_RTC_DATACHANNEL_HEBT_MSID_NOT_FOUND"})(A=T.EDatachannelSignalResCode||(T.EDatachannelSignalResCode={}));var P=(function(U){function B(L){var H=U.call(this)||this;return H.datachannel=L,H}return v(B,U),B.prototype.sendingProcess=function(L,H,O){var x,F,N,k,M=this,j=performance.now(),G=this.sign(O);this.datachannel.onmessage=function(z){try{var V=JSON.parse(z.data),re=M.checkResponse(V,G);if(re.ignore)return;if(M.log("<<< Received:","".concat(Math.ceil(performance.now()-j),"ms"),V),re.pass)L(V);else{if(re.code===A.NGX_RTC_NEED_RETRY)return void setTimeout((function(){M.log(">>> Send:",O),M.datachannel.send((0,C.default)(O))}),200);H(new b.RtsError(E.ErrorCode.DATACHANNEL_RESPONSE_ERROR,"[code]".concat(re.code,"; [msg]").concat(re.msg),re.traceId,{parsedData:V}))}}catch(Q){H(new b.RtsError(E.ErrorCode.DATACHANNEL_PARSE_ERROR,"datachannel message parse error","",{data:z.data,err:Q}))}M.emit("onSendDataDone")};try{this.log(">>> Sent:","".concat(O.type,"-").concat(!((x=O.streams)===null||x===void 0)&&x.length?O.streams[0].method:"-"),(k=(N=(F=O.streams)===null||F===void 0?void 0:F[0])===null||N===void 0?void 0:N.msid)===null||k===void 0?void 0:k.reduce((function(z,V){return z+","+V.name}),""),O)}catch{}this.datachannel.send((0,C.default)(O))},B.prototype.dispose=function(){this.removeAllListeners(),this.datachannel.onmessage=null},B.prototype.checkResponse=function(L,H){var O={pass:!0,ignore:!1,code:0,msg:"",traceId:""};if([_.HEBT,_.NOTI].includes(L.type)||H&&this.sign(L)!==H)return O.ignore=!0,O.pass=!1,O;L.recode!==0&&(O.pass=!1,O.code=L.recode,O.msg=L.msg);var x=L.streams;return x&&x.length>0&&x.forEach((function(F){F.res_code!==200&&(O.pass=!1,O.code=F.res_code,O.msg=F.res_msg,O.traceId=F.traceid)})),O},B.prototype.sign=function(L){var H,O,x="";try{x="".concat(L.msg_id,"-").concat(L.type,"-").concat((O=(H=L.streams)===null||H===void 0?void 0:H[0])===null||O===void 0?void 0:O.method)}catch{x=""}return x},B.prototype.log=function(){for(var L=[],H=0;H<arguments.length;H++)L[H]=arguments[H];window.RTS_DATACHANNEL_DEBUG&&console.log.apply(console,h(["".concat(this.now()," [datachannel|").concat(this.datachannel.label,"|").concat(this.datachannel.id,"]")],L,!1))},B.prototype.now=function(){var L=new Date;return"".concat(L.getHours(),":").concat(L.getMinutes(),":").concat(L.getSeconds(),".").concat(String(L.getMilliseconds()).padStart(3,"0"))},B})(w.default);T.default=P},844:(S,T)=>{Object.defineProperty(T,"__esModule",{value:!0}),T.ErrorCode=void 0,(function(y){y[y.DATACHANNEL_SIGNAL_ERROR=15e3]="DATACHANNEL_SIGNAL_ERROR",y[y.DATACHANNEL_SET_OFFER_ERROR=15001]="DATACHANNEL_SET_OFFER_ERROR",y[y.DATACHANNEL_SET_ANSWER_ERROR=15002]="DATACHANNEL_SET_ANSWER_ERROR",y[y.DATACHANNEL_CREATE_OFFER_ERROR=15003]="DATACHANNEL_CREATE_OFFER_ERROR",y[y.DATACHANNEL_RESPONSE_ERROR=15004]="DATACHANNEL_RESPONSE_ERROR",y[y.DATACHANNEL_PARSE_ERROR=15005]="DATACHANNEL_PARSE_ERROR",y[y.DATACHANNEL_TIMEOUT_ERROR=15006]="DATACHANNEL_TIMEOUT_ERROR",y[y.CORE_NO_PC_ERROR=15007]="CORE_NO_PC_ERROR",y[y.CORE_PUBLIST_EXCEED_ERROR=15008]="CORE_PUBLIST_EXCEED_ERROR",y[y.CORE_PUB_REPLACE_URL_NOT_FOUND=15009]="CORE_PUB_REPLACE_URL_NOT_FOUND",y[y.CORE_TRANSCEIVERS_NOT_FOUND=15010]="CORE_TRANSCEIVERS_NOT_FOUND"})(T.ErrorCode||(T.ErrorCode={}))},961:(S,T,y)=>{Object.defineProperty(T,"__esModule",{value:!0}),T.RtsError=void 0;var R=y(844);T.RtsError=function(v,h,m,_){this.errorCode=v,this.errorCodeName=R.ErrorCode[v],this.message=h,this.traceId=m,_&&(this.extraInfo=_)}},854:(S,T)=>{Object.defineProperty(T,"__esModule",{value:!0}),T.CacheBuffer=void 0;var y=(function(){function R(v){this.data=[],this.tag=v||"unknown",this.maxBufferLength=90}return R.prototype.setMaxCapacity=function(v){this.maxBufferLength=90,v>=0&&(this.maxBufferLength=v),this.maxBufferLength>200&&(this.maxBufferLength=200)},R.prototype.cache=function(v){this.data.length>this.maxBufferLength&&(this.data.shift(),console.log(this.tag+" CACHE: Reach Max Capacity")),this.data.push(v)},R.prototype.getFirst=function(){return this.data.shift()},R.prototype.isEmpty=function(){return this.data.length<=0},R})();T.CacheBuffer=y},885:(S,T)=>{Object.defineProperty(T,"__esModule",{value:!0});var y=(function(){function R(){this._eventMap={}}return R.prototype.listeners=function(v){return this._eventMap[v]||[]},R.prototype.emit=function(v){for(var h=this,m=[],_=1;_<arguments.length;_++)m[_-1]=arguments[_];var A=this._eventMap[v];return!!Array.isArray(A)&&(A.forEach((function(E){return E.apply(h,m)})),!0)},R.prototype.off=function(v,h){var m=this._eventMap[v];return Array.isArray(m)&&(this._eventMap[v]=m.filter((function(_){return _!==h}))),this},R.prototype.removeAllListeners=function(v){return v===void 0?this._eventMap={}:this._eventMap[v]&&(this._eventMap[v]=[]),this},R.prototype.on=function(v,h){return this._eventMap[v]?this._eventMap[v].push(h):this._eventMap[v]=[h],this},R.prototype.once=function(v,h){var m=this,_=function(){for(var A=[],E=0;E<arguments.length;E++)A[E]=arguments[E];m.off(v,_),h.apply(m,A)};return this.on(v,_),this},R})();T.default=y},887:(S,T)=>{Object.defineProperty(T,"__esModule",{value:!0}),T.intersection=T.pruneSubUrl=T.parseUrlSubParams=void 0,T.parseUrlSubParams=function(y){var R={subVideo:!0,subAudio:!0};return y&&(y.includes("@subvideo=no")&&(R.subVideo=!1),y.includes("@subaudio=no")&&(R.subAudio=!1)),R},T.pruneSubUrl=function(y,R){var v=y||"";return v=v.replace("@subaudio=no","").replace("@subvideo=no",""),R&&(v=v.split("?")[0]),v},T.intersection=function(y,R){return y.filter((function(v){return R.includes(v)}))}},390:function(S,T){var y=this&&this.__spreadArray||function(v,h,m){if(m||arguments.length===2)for(var _,A=0,E=h.length;A<E;A++)!_&&A in h||(_||(_=Array.prototype.slice.call(h,0,A)),_[A]=h[A]);return v.concat(_||Array.prototype.slice.call(h))};Object.defineProperty(T,"__esModule",{value:!0}),T.Logger=void 0;var R=(function(){function v(h){this.switchName=h.switchName,this.displayName=h.displayName}return v.prototype.log=function(){for(var h=[],m=0;m<arguments.length;m++)h[m]=arguments[m];window[this.switchName||Math.random()]&&console.log.apply(console,y(["".concat(this.now()," [").concat(this.displayName,"]")],h,!1))},v.prototype.now=function(){var h=new Date;return"".concat(this.padStart(h.getHours()),":").concat(this.padStart(h.getMinutes()),":").concat(this.padStart(h.getSeconds()),".").concat(this.padStart(h.getMilliseconds(),3))},v.prototype.padStart=function(h,m,_){return m===void 0&&(m=2),_===void 0&&(_="0"),String(h).padStart(m,_)},v})();T.Logger=R},248:function(S,T,y){var R=this&&this.__assign||function(){return R=Object.assign||function(_){for(var A,E=1,b=arguments.length;E<b;E++)for(var w in A=arguments[E])Object.prototype.hasOwnProperty.call(A,w)&&(_[w]=A[w]);return _},R.apply(this,arguments)},v=this&&this.__spreadArray||function(_,A,E){if(E||arguments.length===2)for(var b,w=0,C=A.length;w<C;w++)!b&&w in A||(b||(b=Array.prototype.slice.call(A,0,w)),b[w]=A[w]);return _.concat(b||Array.prototype.slice.call(A))};Object.defineProperty(T,"__esModule",{value:!0}),T.generateFakeMediaSdpAnswer=T.SdpUtil=void 0;var h=y(766),m=(function(){function _(A){if(this.rawSdp=A.sdp,!A.sdp)throw new Error("No sdp to parse");this.sdpDetail=this.parse()}return Object.defineProperty(_.prototype,"detail",{get:function(){return this.sdpDetail},enumerable:!1,configurable:!0}),_.prototype.removeMedia=function(A){return this.removeMediaInner(A)},_.prototype.keepMedia=function(A){return this.removeMediaInner(A,{revert:!0})},_.prototype.removeMediaInner=function(A,E){E===void 0&&(E={revert:!1}),A.length&&this.sdpDetail.media&&this.sdpDetail.media.length&&(E.revert?this.sdpDetail.media=this.sdpDetail.media.filter((function(b){return A.includes(String(b.mid)||"")})):this.sdpDetail.media=this.sdpDetail.media.filter((function(b){return!A.includes(String(b.mid)||"")})),this.updateBundle())},_.prototype.addOrUpdateMedia=function(A,E){E===void 0&&(E={}),A=A.map((function(w){return R(R({},w),{setup:"passive"})}));var b=[];this.sdpDetail.media=this.sdpDetail.media.map((function(w){var C=A.find((function(B){return B.mid===w.mid}));if(C){b.push(w.mid);var P=C,U=w;return E.isPublish&&(P.ssrcs=U.ssrcs,P.ssrcGroups=U.ssrcGroups),C}return w})),this.sdpDetail.media=v(v([],this.sdpDetail.media,!0),A.filter((function(w){return!b.includes(w.mid)})),!0),this.updateBundle()},_.prototype.mungleMsid=function(){this.sdpDetail.media.forEach((function(A){if(A.msid){var E="";A.msid=A.msid.split(" ").map((function(b,w){return w===1?(E=b,b+"_"+A.mid):b})).join(" "),E&&A.ssrcs&&A.ssrcs.forEach((function(b){b.value&&(b.value=b.value.replace(E,E+"_"+A.mid))}))}}))},_.prototype.addMedia=function(A){var E;A=A.map((function(C){return R(R({},C),{setup:"passive"})})),this.sdpDetail.media=v(v([],this.sdpDetail.media,!0),A,!0);var b=A.reduce((function(C,P){return C+" "+P.mid}),""),w=(E=this.sdpDetail.groups)===null||E===void 0?void 0:E.find((function(C){return C.type==="BUNDLE"}));w&&(w.mids+="".concat(b))},_.prototype.setMediaInactive=function(A){this.sdpDetail.media.forEach((function(E){A.includes(String(E.mid))&&(E.direction="inactive")})),this.updateBundle()},_.prototype.getPublishSsrcs=function(){var A=[];return this.sdpDetail.media.forEach((function(E){E.direction!=="recvonly"&&E.ssrcs&&A.push({type:E.type,ssrc:E.ssrcs[0].id||"ERR_NOT_FOUND",mid:String(E.mid)})})),A},_.prototype.getPublishMsids=function(){var A=[];return this.sdpDetail.media.forEach((function(E){E.direction!=="recvonly"&&E.msid&&A.push({type:E.type,msid:E.msid,mid:String(E.mid)})})),A},_.prototype.generate=function(){return(0,h.write)(this.sdpDetail)},_.prototype.updateBundle=function(){var A,E=(A=this.sdpDetail.groups)===null||A===void 0?void 0:A.find((function(b){return b.type==="BUNDLE"}));E&&(E.mids=this.sdpDetail.media.reduce((function(b,w){return b+w.mid+" "}),"").trim())},_.prototype.addNack=function(){this.sdpDetail.media.forEach((function(A){var E,b,w;if(A.type==="audio"){if(!((E=A.rtcpFb)===null||E===void 0)&&E.some((function(P){return P.type==="nack"})))return;var C=(b=A.rtp.find((function(P){return P.codec==="opus"})))===null||b===void 0?void 0:b.payload;C&&((w=A.rtcpFb)===null||w===void 0||w.push({payload:C,type:"nack"}))}}))},_.prototype.parse=function(){var A=(0,h.parse)(this.rawSdp);return this.patchMsid(A)},_.prototype.getMids=function(A){return A?.length?A.reduce((function(E,b){return v(v([],E,!0),[String(b.mid)],!1)}),[]):[]},_.prototype.patchMsid=function(A){return A.media.forEach((function(E){var b,w;E.type==="application"||E.msid||(E.msid=(w=(b=E.ssrcs)===null||b===void 0?void 0:b.find((function(C){return C.attribute==="msid"})))===null||w===void 0?void 0:w.value)})),A},_})();T.SdpUtil=m,T.generateFakeMediaSdpAnswer=function(_){if(!_.mids.length||!_.medias.length||_.mids.length!==_.medias.length)return"";var A=`v=0
o=- 1710852399 2 IN IP4 127.0.0.1
s=-
t=0 0
a=group:BUNDLE`,E=`
a=end-of-candidates`;_.mids.forEach((function(w){A+=" ".concat(w)}));var b=(function(){for(var w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",C="",P=0;P<24;P++)C+=w.charAt(Math.floor(62*Math.random()));return C})();return _.medias.forEach((function(w,C){if(w.type==="video"){var P=(1e4*Math.random()).toFixed(0),U=w.msid||"rts video";A+=`
m=video 9 UDP/TLS/RTP/SAVPF 106 107
c=IN IP4 0.0.0.0
a=rtcp:9 IN IP4 0.0.0.0
a=ice-ufrag:ZmFrZV90b2tlbg==
a=ice-pwd:`.concat(b,`
a=ice-options:ice-lite
a=fingerprint:SHA-256 C3:E2:CD:1F:B8:E4:DA:77:D1:D2:36:F3:72:EA:83:CA:7A:F2:3B:26:07:C6:E0:3D:96:44:57:59:14:DE:F0:A4
a=setup:passive
a=sendonly
a=mid:`).concat(_.mids[C],`
a=rtcp-mux
a=rtpmap:106 H264/90000
a=fmtp:106 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f;sps-pps-idr-in-keyframe=1
a=rtcp-fb:106 goog-remb
a=rtcp-fb:106 transport-cc
a=rtcp-fb:106 ccm fir
a=rtcp-fb:106 nack
a=rtcp-fb:106 nack pli
a=rtpmap:107 rtx/90000
a=fmtp:107 apt=106
a=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01
a=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time
a=extmap:5 http://www.webrtc.org/experiments/rtp-hdrext/playout-delay`);var B=`
a=ssrc:`.concat(P,` cname:defaultcname
a=ssrc:`).concat(P," msid:").concat(U,`
a=ssrc:`).concat(P,` mslabel:rts
a=ssrc:`).concat(P," label:video");_.direction==="sub"&&(A+=B),A+=E}else w.type==="audio"&&(P=(1e4*Math.random()).toFixed(0),U=w.msid||"rts audio",A+=`
m=audio 9 UDP/TLS/RTP/SAVPF 111
c=IN IP4 0.0.0.0
a=rtcp:9 IN IP4 0.0.0.0
a=ice-ufrag:ZmFrZV90b2tlbg==
a=ice-pwd:`.concat(b,`
a=ice-options:ice-lite
a=fingerprint:SHA-256 C3:E2:CD:1F:B8:E4:DA:77:D1:D2:36:F3:72:EA:83:CA:7A:F2:3B:26:07:C6:E0:3D:96:44:57:59:14:DE:F0:A4
a=setup:passive
a=sendonly
a=mid:`).concat(_.mids[C],`
a=rtcp-mux
a=rtpmap:111 opus/48000/2
a=fmtp:111 minptime=10;stereo=1;useinbandfec=1
a=rtcp-fb:111 transport-cc
a=rtcp-fb:111 nack
a=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01
a=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time`),B=`
a=ssrc:`.concat(P,` cname:defaultcname
a=ssrc:`).concat(P," msid:").concat(U,`
a=ssrc:`).concat(P,` mslabel:rts
a=ssrc:`).concat(P," label:audio"),_.direction==="sub"&&(A+=B),A+=E)})),A}},237:(S,T,y)=>{Object.defineProperty(T,"__esModule",{value:!0}),T.UrlData=void 0;var R=y(887),v=(function(){function h(m){var _=(0,R.parseUrlSubParams)(m.url);this.data={url:m.url,subAudio:_.subAudio,subVideo:_.subVideo},typeof m.subAudio=="boolean"&&(this.data.subAudio=m.subAudio),typeof m.subVideo=="boolean"&&(this.data.subVideo=m.subVideo)}return Object.defineProperty(h.prototype,"subVideo",{get:function(){return this.data.subVideo},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"subAudio",{get:function(){return this.data.subAudio},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"url",{get:function(){return(0,R.pruneSubUrl)(this.data.url)},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"originalUrl",{get:function(){return this.data.url},enumerable:!1,configurable:!0}),h})();T.UrlData=v},123:function(S,T,y){var R,v=this&&this.__extends||(R=function(w,C){return R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(P,U){P.__proto__=U}||function(P,U){for(var B in U)Object.prototype.hasOwnProperty.call(U,B)&&(P[B]=U[B])},R(w,C)},function(w,C){if(typeof C!="function"&&C!==null)throw new TypeError("Class extends value "+String(C)+" is not a constructor or null");function P(){this.constructor=w}R(w,C),w.prototype=C===null?Object.create(C):(P.prototype=C.prototype,new P)}),h=this&&this.__spreadArray||function(w,C,P){if(P||arguments.length===2)for(var U,B=0,L=C.length;B<L;B++)!U&&B in C||(U||(U=Array.prototype.slice.call(C,0,B)),U[B]=C[B]);return w.concat(U||Array.prototype.slice.call(C))},m=this&&this.__importDefault||function(w){return w&&w.__esModule?w:{default:w}};Object.defineProperty(T,"__esModule",{value:!0});var _=m(y(885)),A=y(973),E=[A.EDatachannelSignalResCode.NGX_RTC_STREAM_NO_FOUND,A.EDatachannelSignalResCode.NGX_RTC_DATACHANNEL_HEBT_MSID_NOT_FOUND],b=(function(w){function C(P,U){var B=w.call(this)||this;return B.latestHeartbeatMsgId=-1,B.streamManager=P,B.datachannelManager=U,B}return v(C,w),C.prototype.process=function(P){var U=this,B=this.parseFormat(P);if(B)if(B.type===A.EMessageType.HEBT&&B.msg_id<this.latestHeartbeatMsgId)console.warn("",B.msg_id,"latest:",this.latestHeartbeatMsgId);else{var L=this.checkRecode(B),H=L.valid,O=L.error,x=L.reason;if(!H)return B.recode===3?void this.emit("datachannelNotEnabled"):void(O&&this.emit("pcReconnect",{recode:B.recode,reMsg:x}));this.emit("hebtReceived",B),this.checkStreams(B).forEach((function(F){var N={resCode:F.resCode,resMsg:F.resMsg,url:F.url,msids:F.msids,streams:F.streams,type:F.type,latestUrl:F.latestUrl};F.isReconnectable?U.emit("streamReconnect",N):U.emit("streamError",N)}))}},C.prototype.setLatestHeartbeatMsgId=function(P){this.latestHeartbeatMsgId=P},C.prototype.dispose=function(){this.removeAllListeners()},C.prototype.parseFormat=function(P){try{return JSON.parse(P)}catch{console.log("Heartbeat parse failed."," Response Data: ",P)}},C.prototype.checkRecode=function(P){var U={valid:!1,error:!1,reason:""};return P.type!==A.EMessageType.HEBT?(U.reason="not heartbeat signal, ignore",U):P.recode!==0?(U.reason=P.msg,U.error=!0,U):(U.valid=!0,U)},C.prototype.checkStreams=function(P){var U=this,B=[];return P.streams&&P.streams.length&&h(h([],this.streamManager.getAllStreamListWithMsids(),!0),this.datachannelManager.getAllList(),!0).forEach((function(L){var H,O=-1;if(P.streams.find((function(k,M){if(k.url===L.url)return O=M,!0}))&&O!==-1){var x=P.streams[O];if(x.method===A.EMessageType.HEBT&&x.res_code===200){x.traceid&&U.emit("traceIdUpdate",{url:x.url,traceId:x.traceid});var F=[];L.msids.forEach((function(k){x.msid.find((function(M){return M.name===k.name}))||F.push(k)}));var N=(H=L.streams)===null||H===void 0?void 0:H.filter((function(k){return!!F.find((function(M){return M.streamId===k.id}))}));F.length&&B.push({url:L.url,msids:F,streams:N,isReconnectable:!0,resMsg:"RTS heartbeat msid mismatch",resCode:404,type:L.type,latestUrl:L.latestUrl})}else B.push({url:L.url,msids:L.msids,streams:L.streams,isReconnectable:U.isReconnectableErrorCode(x.res_code),resMsg:x.res_msg,resCode:x.res_code,type:L.type,latestUrl:L.latestUrl})}})),B},C.prototype.isReconnectableErrorCode=function(P){return E.includes(P)},C})(_.default);T.default=b},619:function(S,T,y){var R=this&&this.__assign||function(){return R=Object.assign||function(P){for(var U,B=1,L=arguments.length;B<L;B++)for(var H in U=arguments[B])Object.prototype.hasOwnProperty.call(U,H)&&(P[H]=U[H]);return P},R.apply(this,arguments)},v=this&&this.__awaiter||function(P,U,B,L){return new(B||(B=Promise))((function(H,O){function x(k){try{N(L.next(k))}catch(M){O(M)}}function F(k){try{N(L.throw(k))}catch(M){O(M)}}function N(k){var M;k.done?H(k.value):(M=k.value,M instanceof B?M:new B((function(j){j(M)}))).then(x,F)}N((L=L.apply(P,U||[])).next())}))},h=this&&this.__generator||function(P,U){var B,L,H,O,x={label:0,sent:function(){if(1&H[0])throw H[1];return H[1]},trys:[],ops:[]};return O={next:F(0),throw:F(1),return:F(2)},typeof Symbol=="function"&&(O[Symbol.iterator]=function(){return this}),O;function F(N){return function(k){return(function(M){if(B)throw new TypeError("Generator is already executing.");for(;O&&(O=0,M[0]&&(x=0)),x;)try{if(B=1,L&&(H=2&M[0]?L.return:M[0]?L.throw||((H=L.return)&&H.call(L),0):L.next)&&!(H=H.call(L,M[1])).done)return H;switch(L=0,H&&(M=[2&M[0],H.value]),M[0]){case 0:case 1:H=M;break;case 4:return x.label++,{value:M[1],done:!1};case 5:x.label++,L=M[1],M=[0];continue;case 7:M=x.ops.pop(),x.trys.pop();continue;default:if(!((H=(H=x.trys).length>0&&H[H.length-1])||M[0]!==6&&M[0]!==2)){x=0;continue}if(M[0]===3&&(!H||M[1]>H[0]&&M[1]<H[3])){x.label=M[1];break}if(M[0]===6&&x.label<H[1]){x.label=H[1],H=M;break}if(H&&x.label<H[2]){x.label=H[2],x.ops.push(M);break}H[2]&&x.ops.pop(),x.trys.pop();continue}M=U.call(P,x)}catch(j){M=[6,j],L=0}finally{B=H=0}if(5&M[0])throw M[1];return{value:M[0]?M[1]:void 0,done:!0}})([N,k])}}},m=this&&this.__spreadArray||function(P,U,B){if(B||arguments.length===2)for(var L,H=0,O=U.length;H<O;H++)!L&&H in U||(L||(L=Array.prototype.slice.call(U,0,H)),L[H]=U[H]);return P.concat(L||Array.prototype.slice.call(U))};Object.defineProperty(T,"__esModule",{value:!0}),T.Signal=void 0;var _,A,E,b=y(651),w=y(887);(function(P){P.Sub="sub",P.Pub="pub",P.Hebt="hebt"})(_||(_={})),(function(P){P.Add="add",P.Active="active",P.Stop="stop",P.Delete="delete",P.Hebt="hebt"})(A||(A={})),(function(P){P.Audio="audio",P.Video="video",P.Data="data"})(E||(E={}));var C=(function(){function P(U){this.latestMsgId=0,this.latestSubAddMsgId=0,this.pc=U.pc,this.datachannel=new b.DataChannelCore({pc:this.pc,onDatachannelEvent:U.onDatachannelEvent,delayOpen:U.delayOpen,initOptions:U.initOptions})}return P.prototype.getDatachannelCore=function(){return this.datachannel},P.prototype.subscribeAdd=function(U,B,L){var H;return v(this,void 0,void 0,(function(){var O;return h(this,(function(x){switch(x.label){case 0:return O=R(R({},this.baseParams({type:_.Sub,method:A.Add})),{streams:U.map((function(F,N){var k=F.urlData,M=[];return k.subAudio&&!L.isMsidSubPubDone(k.url,{aMsid:F.aMsid[0]})&&M.push({type:E.Audio,name:F.aMsid[0]}),k.subVideo&&!L.isMsidSubPubDone(k.url,{vMsid:F.vMsid[0]})&&M.push({type:E.Video,name:F.vMsid[0]}),{method:A.Add,url:k.url,msid:M,sdp:B[N],ttl:300}}))}),[4,(H=this.datachannel)===null||H===void 0?void 0:H.sendData(O)];case 1:return[2,x.sent()]}}))}))},P.prototype.subscribeActive=function(U){var B;return v(this,void 0,void 0,(function(){var L;return h(this,(function(H){switch(H.label){case 0:return L=R(R({},this.baseParams({type:_.Sub,method:A.Active})),{streams:U.map((function(O){var x=O.urlData;return{method:A.Active,url:x.url}}))}),[4,(B=this.datachannel)===null||B===void 0?void 0:B.sendData(L)];case 1:return H.sent(),[2]}}))}))},P.prototype.subscribeDelete=function(U){var B;return v(this,void 0,void 0,(function(){var L;return h(this,(function(H){switch(H.label){case 0:return L=R(R({},this.baseParams()),{streams:U.map((function(O){var x=O.url,F=O.aMsid,N=O.vMsid,k=[];return F?.length&&(k=m(m([],k,!0),F.map((function(M){return{name:M}})),!0)),N?.length&&(k=m(m([],k,!0),N.map((function(M){return{name:M}})),!0)),{method:A.Delete,url:(0,w.pruneSubUrl)(x),msid:k}}))}),[4,(B=this.datachannel)===null||B===void 0?void 0:B.sendData(L)];case 1:return[2,H.sent()]}}))}))},P.prototype.subscribeStop=function(U){var B;return v(this,void 0,void 0,(function(){var L;return h(this,(function(H){switch(H.label){case 0:return L=R(R({},this.baseParams()),{streams:U.map((function(O){var x=O.urlData;return{method:A.Stop,url:x.url}}))}),[4,(B=this.datachannel)===null||B===void 0?void 0:B.sendData(L)];case 1:return[2,H.sent()]}}))}))},P.prototype.subscribeAddDatachannel=function(U){var B;return v(this,void 0,void 0,(function(){var L;return h(this,(function(H){switch(H.label){case 0:return L=R(R({},this.baseParams({type:_.Sub,method:A.Add})),{streams:U.map((function(O){var x=O.url,F=O.msid;return{method:A.Add,url:x,msid:[{type:E.Data,name:F}]}}))}),[4,(B=this.datachannel)===null||B===void 0?void 0:B.sendData(L)];case 1:return[2,H.sent()]}}))}))},P.prototype.subscribeActiveDatachannel=function(U){var B;return v(this,void 0,void 0,(function(){var L;return h(this,(function(H){switch(H.label){case 0:return L=R(R({},this.baseParams({type:_.Sub,method:A.Active})),{streams:U.map((function(O){var x=O.url,F=O.datachannelId,N=O.msid;return{method:A.Active,url:x,msid:[{type:E.Data,name:N,channel:F}]}}))}),[4,(B=this.datachannel)===null||B===void 0?void 0:B.sendData(L)];case 1:return[2,H.sent()]}}))}))},P.prototype.subscribeDeleteDatachannel=function(U){var B;return v(this,void 0,void 0,(function(){var L;return h(this,(function(H){switch(H.label){case 0:return L=R(R({},this.baseParams()),{streams:U.map((function(O){var x=O.url,F=O.msid;return{method:A.Delete,url:x,msid:[{name:F}]}}))}),[4,(B=this.datachannel)===null||B===void 0?void 0:B.sendData(L)];case 1:return[2,H.sent()]}}))}))},P.prototype.subscribeStopDatachannel=function(U){var B;return v(this,void 0,void 0,(function(){var L;return h(this,(function(H){switch(H.label){case 0:return L=R(R({},this.baseParams()),{streams:U.map((function(O){var x=O.url;return{method:A.Stop,url:x}}))}),[4,(B=this.datachannel)===null||B===void 0?void 0:B.sendData(L)];case 1:return[2,H.sent()]}}))}))},P.prototype.publishAdd=function(U,B,L,H){var O;return v(this,void 0,void 0,(function(){var x;return h(this,(function(F){return x=R(R({},this.baseParams({type:_.Pub})),{streams:U.map((function(N,k){var M=L[k],j=H[k],G=[];return M.length&&G.push({type:"video",name:M[0].trim()}),j.length&&G.push({type:"audio",name:j[0].trim()}),{method:A.Add,url:N,msid:G,sdp:B[k]}}))}),[2,(O=this.datachannel)===null||O===void 0?void 0:O.sendData(x)]}))}))},P.prototype.publishDelete=function(U){var B;return v(this,void 0,void 0,(function(){var L;return h(this,(function(H){return L=R(R({},this.baseParams({type:_.Pub})),{streams:U.map((function(O){var x=O.url,F=O.aMsid,N=O.vMsid,k=[];return F?.length&&(k=m(m([],k,!0),F.map((function(M){return{name:M}})),!0)),N?.length&&(k=m(m([],k,!0),N.map((function(M){return{name:M}})),!0)),{method:A.Delete,url:(0,w.pruneSubUrl)(x),msid:k}}))}),[2,(B=this.datachannel)===null||B===void 0?void 0:B.sendData(L)]}))}))},P.prototype.publishStop=function(U){var B;return v(this,void 0,void 0,(function(){var L;return h(this,(function(H){return L=R(R({},this.baseParams({type:_.Pub})),{streams:U.map((function(O){return{method:A.Stop,url:O}}))}),[2,(B=this.datachannel)===null||B===void 0?void 0:B.sendData(L)]}))}))},P.prototype.publishAddDatachannel=function(U){var B;return v(this,void 0,void 0,(function(){var L;return h(this,(function(H){switch(H.label){case 0:return L=R(R({},this.baseParams({type:_.Pub,method:A.Add})),{streams:U.map((function(O){var x=O.url,F=O.datachannelId,N=O.msid;return{method:A.Add,url:x,msid:[{type:E.Data,name:N,channel:F}]}}))}),[4,(B=this.datachannel)===null||B===void 0?void 0:B.sendData(L)];case 1:return[2,H.sent()]}}))}))},P.prototype.publishDeleteDatachannel=function(U){var B;return v(this,void 0,void 0,(function(){var L;return h(this,(function(H){switch(H.label){case 0:return L=R(R({},this.baseParams({type:_.Pub})),{streams:U.map((function(O){var x=O.url,F=O.msid;return{method:A.Delete,url:x,msid:[{name:F}]}}))}),[4,(B=this.datachannel)===null||B===void 0?void 0:B.sendData(L)];case 1:return[2,H.sent()]}}))}))},P.prototype.publishStopDatachannel=function(U){var B;return v(this,void 0,void 0,(function(){var L;return h(this,(function(H){switch(H.label){case 0:return L=R(R({},this.baseParams({type:_.Pub})),{streams:U.map((function(O){var x=O.url;return{method:A.Stop,url:x}}))}),[4,(B=this.datachannel)===null||B===void 0?void 0:B.sendData(L)];case 1:return[2,H.sent()]}}))}))},P.prototype.sendHeartbeat=function(U){U&&!U.map&&(U=void 0);var B=R(R({},this.baseParams({type:_.Hebt})),{streams:U?.map((function(L){var H=L.url;return{method:A.Hebt,url:H}}))});if(U||delete B.streams,this.datachannel.sendAsync(B))return B},P.prototype.sendFalseHeartbeat=function(U){var B=R(R({},this.baseParams({type:_.Hebt})),{streams:U?.map((function(L){return{method:"fake",url:L.url}}))});if(U||delete B.streams,this.datachannel.sendAsync(B))return B},P.prototype.dispose=function(){this.datachannel.dispose()},P.prototype.baseParams=function(U){U===void 0&&(U={type:_.Sub});var B=0;return U.type===_.Sub&&U.method===A.Add?(B=++this.latestMsgId,this.latestSubAddMsgId=this.latestMsgId):B=U.type===_.Sub&&U.method===A.Active?this.latestSubAddMsgId:++this.latestMsgId,{msg_id:B,version:2,type:U.type}},P})();T.Signal=C},125:function(S,T,y){var R,v=this&&this.__extends||(R=function(w,C){return R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(P,U){P.__proto__=U}||function(P,U){for(var B in U)Object.prototype.hasOwnProperty.call(U,B)&&(P[B]=U[B])},R(w,C)},function(w,C){if(typeof C!="function"&&C!==null)throw new TypeError("Class extends value "+String(C)+" is not a constructor or null");function P(){this.constructor=w}R(w,C),w.prototype=C===null?Object.create(C):(P.prototype=C.prototype,new P)}),h=this&&this.__importDefault||function(w){return w&&w.__esModule?w:{default:w}};Object.defineProperty(T,"__esModule",{value:!0}),T.NotifyProcessor=void 0;var m,_=y(973),A=h(y(885)),E=y(390);(function(w){w[w.NGX_RTC_H5_DELIVERY_INTERNAL_EXCEPTION=1]="NGX_RTC_H5_DELIVERY_INTERNAL_EXCEPTION",w[w.NGX_RTC_H5_ACCESS_IP_MIGRATION=2]="NGX_RTC_H5_ACCESS_IP_MIGRATION",w[w.NGX_RTC_H5_ACCESS_SUB_STREAMINFO=3]="NGX_RTC_H5_ACCESS_SUB_STREAMINFO"})(m||(m={}));var b=(function(w){function C(){var P=w.call(this)||this;return P.logger=new E.Logger({displayName:"NotifyProcessor",switchName:"RTS_NOTIFY_DEBUG"}),P}return v(C,w),C.prototype.processIpMigration=function(P){var U,B,L=this.parseFormat(P);if(L&&this.checkRelated(L)){this.logger.log("processIpMigrationparsedData",L),this.emit("message",{message:L});var H=this.parseIP(L.notify_msg);!((U=H.pull)===null||U===void 0)&&U.length||!((B=H.push)===null||B===void 0)&&B.length?(console.warn("processIpMigration",H),this.emit("pcReconnect",{ips:H})):this.logger.log("processIpMigrationNo valid ip found: ",L.notify_msg)}},C.prototype.processSubStreamInfo=function(P){var U=this.parseFormat(P);if(this.logger.log("processSubStreamInfoparsedData",U),U&&this.checkRelated(U,m.NGX_RTC_H5_ACCESS_SUB_STREAMINFO))return U},C.prototype.processInternalException=function(P){var U=this.parseFormat(P);if(U&&this.checkRelated(U,m.NGX_RTC_H5_DELIVERY_INTERNAL_EXCEPTION)){this.emit("message",{message:U}),this.logger.log("processInternalExceptionparsedData",U);var B=Number(U.res_code);B&&![200,204,205,207,221,403,404,405,429,504,616,409,601].includes(B)?(console.warn("processInternalException",B),this.emit("pcReconnect",{})):this.logger.log("processInternalExceptionError code should not retry ",B)}},C.prototype.dispose=function(){this.removeAllListeners()},C.prototype.parseFormat=function(P){try{return JSON.parse(P)}catch{console.warn("Notify parse failed."," Response Data: ",P)}},C.prototype.checkRelated=function(P,U){return U===void 0&&(U=m.NGX_RTC_H5_ACCESS_IP_MIGRATION),P.type===_.EMessageType.NOTI&&P.notify_type===U},C.prototype.parseIP=function(P){P===void 0&&(P=""),this.logger.log("Paring IP string: ".concat(P));var U=P.split(";"),B=/^(?:\d{1,3}\.){3}\d{1,3}$/,L=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,H=/^(push|pull)_ips:(.*)$/,O={};return U.forEach((function(x){var F=H.exec(x);if(F){var N=F[1],k=F[2].split(",").filter((function(M){return B.test(M)||L.test(M)}));O[N]=k}})),this.logger.log("Parsed IP:",O),O},C})(A.default);T.NotifyProcessor=b},132:function(S,T,y){var R=this&&this.__awaiter||function(E,b,w,C){return new(w||(w=Promise))((function(P,U){function B(O){try{H(C.next(O))}catch(x){U(x)}}function L(O){try{H(C.throw(O))}catch(x){U(x)}}function H(O){var x;O.done?P(O.value):(x=O.value,x instanceof w?x:new w((function(F){F(x)}))).then(B,L)}H((C=C.apply(E,b||[])).next())}))},v=this&&this.__generator||function(E,b){var w,C,P,U,B={label:0,sent:function(){if(1&P[0])throw P[1];return P[1]},trys:[],ops:[]};return U={next:L(0),throw:L(1),return:L(2)},typeof Symbol=="function"&&(U[Symbol.iterator]=function(){return this}),U;function L(H){return function(O){return(function(x){if(w)throw new TypeError("Generator is already executing.");for(;U&&(U=0,x[0]&&(B=0)),B;)try{if(w=1,C&&(P=2&x[0]?C.return:x[0]?C.throw||((P=C.return)&&P.call(C),0):C.next)&&!(P=P.call(C,x[1])).done)return P;switch(C=0,P&&(x=[2&x[0],P.value]),x[0]){case 0:case 1:P=x;break;case 4:return B.label++,{value:x[1],done:!1};case 5:B.label++,C=x[1],x=[0];continue;case 7:x=B.ops.pop(),B.trys.pop();continue;default:if(!((P=(P=B.trys).length>0&&P[P.length-1])||x[0]!==6&&x[0]!==2)){B=0;continue}if(x[0]===3&&(!P||x[1]>P[0]&&x[1]<P[3])){B.label=x[1];break}if(x[0]===6&&B.label<P[1]){B.label=P[1],P=x;break}if(P&&B.label<P[2]){B.label=P[2],B.ops.push(x);break}P[2]&&B.ops.pop(),B.trys.pop();continue}x=b.call(E,B)}catch(F){x=[6,F],C=0}finally{w=P=0}if(5&x[0])throw x[1];return{value:x[0]?x[1]:void 0,done:!0}})([H,O])}}},h=this&&this.__spreadArray||function(E,b,w){if(w||arguments.length===2)for(var C,P=0,U=b.length;P<U;P++)!C&&P in b||(C||(C=Array.prototype.slice.call(b,0,P)),C[P]=b[P]);return E.concat(C||Array.prototype.slice.call(b))},m=this&&this.__importDefault||function(E){return E&&E.__esModule?E:{default:E}};Object.defineProperty(T,"__esModule",{value:!0}),T.PeerConnectionRollbackController=void 0;var _=m(y(775)),A=(function(){function E(b){this.fakeSdpParams={direction:"sub",mids:[],medias:[]},this.pcCore=b}return E.prototype.setFakeSdpMids=function(b){this.fakeSdpParams.mids=b},E.prototype.setFakeSdpMedias=function(b,w){this.fakeSdpParams.medias=b,this.fakeSdpParams.direction=w},E.prototype.saveStreamManager=function(b){var w;this.streamManager=b,(w=this.streamManager)===null||w===void 0||w.backup()},E.prototype.saveDatachannelManager=function(b){var w;this.datachannelManager=b,(w=this.datachannelManager)===null||w===void 0||w.backup()},E.prototype.rollback=function(b){return R(this,void 0,void 0,(function(){var w;return v(this,(function(C){switch(C.label){case 0:if(b?.trackListnerRollback&&(this.pcCore.removeTrackListener(),this.log("Sub Track Listener Removed")),b?.streamManagerRollback&&this.streamManager){this.streamManager.restore();try{this.log("Stream Manager Restored",JSON.parse((0,_.default)(this.streamManager)))}catch{}}if(b?.datachannelManagerRollback&&this.datachannelManager){this.datachannelManager.restore();try{this.log("Datachannel Manager Restored",JSON.parse((0,_.default)(this.datachannelManager)))}catch{}}if(b?.pcTransceiversRollback&&(this.fakeSdpParams.medias.forEach((function(P){var U;(U=P.trans)===null||U===void 0||U.receiver.track.stop()})),this.log("Sub Track(s) Stopped",this.fakeSdpParams.medias)),!b?.runSimulateSignal)return[3,4];this.log("SDP Simulating...",this.fakeSdpParams),C.label=1;case 1:return C.trys.push([1,3,,4]),[4,this.pcCore.simulateOfferAnswer(this.fakeSdpParams)];case 2:return C.sent(),this.log("SDP Simulation Done"),[3,4];case 3:return w=C.sent(),this.log("SDP Simulation Failed",w),[3,4];case 4:return[2]}}))}))},E.prototype.log=function(){for(var b=[],w=0;w<arguments.length;w++)b[w]=arguments[w];window.RTS_DATACHANNEL_DEBUG&&console.log.apply(console,h(["[PC-Core-Rollback]"],b,!1))},E})();T.PeerConnectionRollbackController=A},748:function(S,T,y){var R=this&&this.__assign||function(){return R=Object.assign||function(_){for(var A,E=1,b=arguments.length;E<b;E++)for(var w in A=arguments[E])Object.prototype.hasOwnProperty.call(A,w)&&(_[w]=A[w]);return _},R.apply(this,arguments)},v=this&&this.__spreadArray||function(_,A,E){if(E||arguments.length===2)for(var b,w=0,C=A.length;w<C;w++)!b&&w in A||(b||(b=Array.prototype.slice.call(A,0,w)),b[w]=A[w]);return _.concat(b||Array.prototype.slice.call(A))};Object.defineProperty(T,"__esModule",{value:!0}),T.DatachannelManager=void 0;var h=y(887),m=(function(){function _(A){this.datachannelMap=new Map,this.datachannelMapBackup=new Map}return _.prototype.backup=function(){var A=this;this.datachannelMapBackup=new Map,this.datachannelMap.forEach((function(E,b){A.datachannelMapBackup.set(b,R(R({},E),{msids:v([],E.msids,!0),streams:v([],E.streams,!0)}))}))},_.prototype.restore=function(){var A=this;this.datachannelMap=new Map,this.datachannelMapBackup.forEach((function(E,b){A.datachannelMap.set(b,E)}))},_.prototype.update=function(A){var E=this.datachannelMap.get(A.url);E?A.msids.forEach((function(b){E.msids.find((function(w){if(w.id===b.id&&w.name===b.name)return!0}))?console.log("RTS [DATACHANNEL MANAGER]: duplicate msid for datachannel",A):E.msids.push(b)})):this.datachannelMap.set(A.url,A)},_.prototype.remove=function(A){this.datachannelMap.delete(A.url)},_.prototype.has=function(A){return this.datachannelMap.has((0,h.pruneSubUrl)(A,!0))},_.prototype.get=function(A){return this.datachannelMap.get((0,h.pruneSubUrl)(A,!0))},_.prototype.getByMsid=function(A){var E;if(A.url){var b=this.datachannelMap.get((0,h.pruneSubUrl)(A.url,!0));if(b)return A.msid?(E=b.msids.find((function(w){return w.name===A.msid})))===null||E===void 0?void 0:E.datachannel:b.msids[0].datachannel}else console.warn("[getByMsid] config.url is required.")},_.prototype.getAllList=function(){var A=[];return this.datachannelMap.forEach((function(E){A.push(R(R({},E),{latestUrl:E.latestUrl||E.originUrl}))})),A},_.prototype.getSize=function(){return this.datachannelMap.size},_.prototype.getUrlByIndex=function(A){var E=0,b=void 0;return this.datachannelMap.forEach((function(w){E===A&&(b={url:w.originUrl}),E++})),b},_.prototype.updateLatestUrl=function(A){var E=this.get(A);return!!E&&(E.latestUrl=A,!0)},_.prototype.dispose=function(){this.datachannelMap.clear(),this.datachannelMapBackup.clear()},_})();T.DatachannelManager=m},628:function(S,T,y){var R=this&&this.__assign||function(){return R=Object.assign||function(A){for(var E,b=1,w=arguments.length;b<w;b++)for(var C in E=arguments[b])Object.prototype.hasOwnProperty.call(E,C)&&(A[C]=E[C]);return A},R.apply(this,arguments)},v=this&&this.__spreadArray||function(A,E,b){if(b||arguments.length===2)for(var w,C=0,P=E.length;C<P;C++)!w&&C in E||(w||(w=Array.prototype.slice.call(E,0,C)),w[C]=E[C]);return A.concat(w||Array.prototype.slice.call(E))};Object.defineProperty(T,"__esModule",{value:!0}),T.StreamManager=T.EStreamType=void 0;var h,m=y(887);(function(A){A.Subscribe="sub",A.Publish="pub"})(h=T.EStreamType||(T.EStreamType={}));var _=(function(){function A(E){this.streamMap={},this.streamMapBackup={}}return A.prototype.backup=function(){var E=this,b={};Object.keys(this.streamMap).forEach((function(w){var C=E.streamMap[w];b[w]=R(R({},E.streamMap[w]),{videoInfoList:v([],C.videoInfoList,!0),audioInfoList:v([],C.audioInfoList,!0),streamList:v([],C.streamList,!0)})})),this.streamMapBackup=b},A.prototype.restore=function(){this.streamMap=R({},this.streamMapBackup)},A.prototype.init=function(E,b){b===void 0&&(b=h.Subscribe);var w=(0,m.pruneSubUrl)(E);E=(0,m.pruneSubUrl)(E,!0),this.has(E)||(this.streamMap[E]={type:b,videoInfoList:[],audioInfoList:[],streamList:[],originUrl:w})},A.prototype.remove=function(E){delete this.streamMap[(0,m.pruneSubUrl)(E,!0)]},A.prototype.update=function(E,b){var w=this.get(E);if(!w)throw new Error("No url found");if(b.aMsid){var C=w.audioInfoList.find((function(U){return U.msid===b.aMsid}))||this.createMediaItem(b.aMsid,"audio");b.aTransceiver&&(C.transceiver=b.aTransceiver),b.stream&&(C.streamId=b.stream.id),this.updateMediaInfoList(C,w.audioInfoList)}if(b.vMsid){var P=w.videoInfoList.find((function(U){return U.msid===b.vMsid}))||this.createMediaItem(b.vMsid,"video");b.vTransceiver&&(P.transceiver=b.vTransceiver),b.cumuDelay&&(P.cumuDelay=b.cumuDelay),b.stream&&(P.streamId=b.stream.id),this.updateMediaInfoList(P,w.videoInfoList)}b.stream&&(w.streamList.some((function(U){return U.id===b.stream.id}))||(w.streamList=v(v([],w.streamList,!0),[b.stream],!1)))},A.prototype.pruneStreamList=function(E){var b=this.get(E);b&&(b.streamList=b.streamList.filter((function(w){var C;return((C=w.mediaStream)===null||C===void 0?void 0:C.getTracks().length)>0})))},A.prototype.updateSdpInfo=function(E,b){var w,C=this.get(E);if(!C)throw new Error("No url found");if(b.aMsid?w=C.audioInfoList.find((function(P){return P.msid===b.aMsid})):b.vMsid&&(w=C.videoInfoList.find((function(P){return P.msid===b.vMsid}))),!w)throw new Error("No target media found");w.ssrc=b.ssrc,w.codec=b.codec,w.pt=b.pt,w.from=b.from},A.prototype.get=function(E){return this.streamMap[(0,m.pruneSubUrl)(E,!0)]},A.prototype.has=function(E){return!!this.get(E)},A.prototype.getSize=function(){return this.getSubOrPubDoneMediaMapSize()},A.prototype.getSubOrPubDoneMediaMapSize=function(){var E=this,b=0;return Object.keys(this.streamMap).forEach((function(w){var C=E.streamMap[w],P=!1;C.audioInfoList.forEach((function(U){P=P||C.type===h.Publish&&U.pubDone||C.type===h.Subscribe&&U.subDone})),C.videoInfoList.forEach((function(U){P=P||C.type===h.Publish&&U.pubDone||C.type===h.Subscribe&&U.subDone})),P&&b++})),b},A.prototype.removeMsid=function(E,b){E=(0,m.pruneSubUrl)(E,!0);var w=this.get(E);w&&(b.vMsid&&(w.videoInfoList=w.videoInfoList.filter((function(C){return C.msid!==b.vMsid}))),b.aMsid&&(w.audioInfoList=w.audioInfoList.filter((function(C){return C.msid!==b.aMsid}))))},A.prototype.getMids=function(E,b){b===void 0&&(b={filterSubDone:!1}),E=(0,m.pruneSubUrl)(E,!0);var w=this.streamMap[E];return w?v(v([],w.audioInfoList.reduce((function(C,P){return P.transceiver&&(!b.filterSubDone||b.filterSubDone&&!P.subDone)?v(v([],C,!0),[String(P.transceiver.mid)],!1):C}),[]),!0),w.videoInfoList.reduce((function(C,P){return P.transceiver&&(!b.filterSubDone||b.filterSubDone&&!P.subDone)?v(v([],C,!0),[String(P.transceiver.mid)],!1):C}),[]),!0):[]},A.prototype.getAllTransceivers=function(E){if(!E)return[];E=(0,m.pruneSubUrl)(E,!0);var b=this.get(E);return b?v(v([],b.videoInfoList.map((function(w){return w.transceiver})),!0),b.audioInfoList.map((function(w){return w.transceiver})),!0):[]},A.prototype.getTransceiver=function(E,b){if(b===void 0&&(b={}),E){E=(0,m.pruneSubUrl)(E,!0);var w=b.vMsid,C=b.aMsid,P=this.get(E);if(P){var U;if(w)return(U=P.videoInfoList.find((function(B){return B.msid===w})))==null?void 0:U.transceiver;if(C)return(U=P.audioInfoList.find((function(B){return B.msid===C})))==null?void 0:U.transceiver}}},A.prototype.getStreamByMsid=function(E){var b,w,C=this.get(E.url);if(C){if(E.vMsid){var P=(b=C.videoInfoList.find((function(B){return B.msid===E.vMsid})))===null||b===void 0?void 0:b.streamId;return C.streamList.find((function(B){return B.id===P}))}if(E.aMsid){var U=(w=C.audioInfoList.find((function(B){return B.msid===E.aMsid})))===null||w===void 0?void 0:w.streamId;return C.streamList.find((function(B){return B.id===U}))}return C.streamList[0]}},A.prototype.hasTransceiver=function(E,b){return b===void 0&&(b={}),!!this.getTransceiver(E,b)},A.prototype.removeTransceiver=function(E,b){E=(0,m.pruneSubUrl)(E,!0);var w,C=this.get(E);C&&(b.vMsid&&(w=C.videoInfoList.find((function(P){return P.msid===b.vMsid})))&&(w.transceiver=void 0),b.aMsid&&(w=C.audioInfoList.find((function(P){return P.msid===b.aMsid})))&&(w.transceiver=void 0))},A.prototype.markAlreadySubPub=function(E,b){b===void 0&&(b={}),E=(0,m.pruneSubUrl)(E,!0);var w,C=this.streamMap[E];C&&(b.vMsid&&(w=C.videoInfoList.find((function(P){return P.msid===b.vMsid})))&&(w[b.isPub?"pubDone":"subDone"]=!b.reset),b.aMsid&&(w=C.audioInfoList.find((function(P){return P.msid===b.aMsid})))&&(w[b.isPub?"pubDone":"subDone"]=!b.reset))},A.prototype.isMsidSubPubDone=function(E,b){b===void 0&&(b={}),E=(0,m.pruneSubUrl)(E,!0);var w=this.streamMap[E];if(!w)return!1;if(b.vMsid){var C=w.videoInfoList.find((function(P){return P.msid===b.vMsid}));return b.isPub?C?.pubDone:C?.subDone}return b.aMsid?(C=w.audioInfoList.find((function(P){return P.msid===b.aMsid})),b.isPub?C?.pubDone:C?.subDone):void 0},A.prototype.getAllMediaInfoList=function(E,b){var w=this.get(E);return w?v(v([],w.audioInfoList.map((function(C){var P,U,B,L,H=C.type,O=C.msid,x=C.ssrc,F=C.pt,N=C.codec,k=C.from,M=C.transceiver,j={type:H,msid:O,ssrc:x,pt:F,codec:N,from:k,trackId:w.type===h.Subscribe?(U=(P=M?.receiver)===null||P===void 0?void 0:P.track)===null||U===void 0?void 0:U.id:(L=(B=M?.sender)===null||B===void 0?void 0:B.track)===null||L===void 0?void 0:L.id};return b?R(R({},j),{transceiver:M}):j})),!0),w.videoInfoList.map((function(C){var P,U,B,L,H=C.type,O=C.msid,x=C.ssrc,F=C.pt,N=C.codec,k=C.from,M=C.transceiver,j={type:H,msid:O,ssrc:x,pt:F,codec:N,from:k,trackId:w.type===h.Subscribe?(U=(P=M?.receiver)===null||P===void 0?void 0:P.track)===null||U===void 0?void 0:U.id:(L=(B=M?.sender)===null||B===void 0?void 0:B.track)===null||L===void 0?void 0:L.id};return b?R(R({},j),{transceiver:M}):j})),!0):[]},A.prototype.getOriginUrl=function(E){var b=(0,m.pruneSubUrl)(E,!0),w=this.get(b);return w?w.originUrl:E},A.prototype.getAllTrackPairList=function(E){var b,w,C,P,U=[];for(var B in this.streamMap){var L=this.streamMap[B];if(L.type===E)for(var H=Math.max(L.audioInfoList.length,L.videoInfoList.length),O=0;O<H;O++){var x={url:B,originUrl:L.originUrl};O<L.audioInfoList.length&&(x.aTransceiver=E===h.Subscribe?(b=L.audioInfoList[O].transceiver)===null||b===void 0?void 0:b.receiver:(w=L.audioInfoList[O].transceiver)===null||w===void 0?void 0:w.sender,x.aMsid=L.audioInfoList[O].msid),O<L.videoInfoList.length&&(x.vTransceiver=E===h.Subscribe?(C=L.videoInfoList[O].transceiver)===null||C===void 0?void 0:C.receiver:(P=L.videoInfoList[O].transceiver)===null||P===void 0?void 0:P.sender,x.vMsid=L.videoInfoList[O].msid,x.cumuDelay=L.videoInfoList[O].cumuDelay),U.push(x)}}return U},A.prototype.getAllStreamListWithMsids=function(){var E,b=[];for(var w in this.streamMap){for(var C=this.streamMap[w],P=Math.max(C.audioInfoList.length,C.videoInfoList.length,C.streamList.length),U={url:w,msids:[],type:C.type,latestUrl:C.latestUrl||C.originUrl,streams:[]},B=0;B<P;B++){if(B<C.audioInfoList.length&&C.audioInfoList[B].msid){var L=C.audioInfoList[B];L.msid&&(C.type===h.Publish&&L.pubDone||C.type===h.Subscribe&&L.subDone)&&U.msids.push({name:L.msid||"",type:L.type||"audio",streamId:L.streamId})}if(B<C.videoInfoList.length&&C.videoInfoList[B].msid){var H=C.videoInfoList[B];H.msid&&(C.type===h.Publish&&H.pubDone||C.type===h.Subscribe&&H.subDone)&&U.msids.push({name:H.msid||"",type:H.type||"video",streamId:H.streamId})}B<C.streamList.length&&C.streamList[B]&&((E=U.streams)===null||E===void 0||E.push(C.streamList[B]))}U.msids.length&&b.push(U)}return b},A.prototype.getSender=function(E,b,w){var C,P,U=void 0,B=this.getAllMediaInfoList(E,!0);return w?B.forEach((function(L){var H,O,x,F=(O=(H=L.transceiver)===null||H===void 0?void 0:H.sender)===null||O===void 0?void 0:O.track;F?.kind===b&&L.msid===w&&(U=(x=L.transceiver)===null||x===void 0?void 0:x.sender)})):U=(P=(C=B?.find((function(L){var H,O,x;return((x=(O=(H=L.transceiver)===null||H===void 0?void 0:H.sender)===null||O===void 0?void 0:O.track)===null||x===void 0?void 0:x.kind)===b})))===null||C===void 0?void 0:C.transceiver)===null||P===void 0?void 0:P.sender,U},A.prototype.getReceiver=function(E,b,w){var C,P,U=void 0,B=this.getAllMediaInfoList(E,!0);return w?B.forEach((function(L){var H,O,x,F=(O=(H=L.transceiver)===null||H===void 0?void 0:H.receiver)===null||O===void 0?void 0:O.track;F?.kind===b&&L.msid===w&&(U=(x=L.transceiver)===null||x===void 0?void 0:x.receiver)})):U=(P=(C=B?.find((function(L){var H,O,x;return((x=(O=(H=L.transceiver)===null||H===void 0?void 0:H.receiver)===null||O===void 0?void 0:O.track)===null||x===void 0?void 0:x.kind)===b})))===null||C===void 0?void 0:C.transceiver)===null||P===void 0?void 0:P.receiver,U},A.prototype.dispose=function(){this.streamMap={},this.streamMapBackup={}},A.prototype.updateMediaInfoList=function(E,b){var w=b.findIndex((function(C){return C.msid===E.msid}));w!==-1?b.splice(w,1,E):b.push(E)},A.prototype.findMediaItemByMsid=function(E,b){return b.find((function(w){return w.msid===E}))},A.prototype.createMediaItem=function(E,b){return{msid:E,ssrc:void 0,transceiver:void 0,subDone:!1,pubDone:!1,type:b,streamId:void 0}},A.prototype.getPubOrSubDoneMediaUrlByIndex=function(E){var b=0,w=function(B){var L=C.streamMap[B],H=!1;if(L.audioInfoList.forEach((function(O){H=H||L.type===h.Publish&&O.pubDone||L.type===h.Subscribe&&O.subDone})),L.videoInfoList.forEach((function(O){H=H||L.type===h.Publish&&O.pubDone||L.type===h.Subscribe&&O.subDone})),H){if(b===E)return{value:B};b++}},C=this;for(var P in this.streamMap){var U=w(P);if(typeof U=="object")return U.value}},A.prototype.updateLatestUrl=function(E){var b=this.get(E);return!!b&&(b.latestUrl=E,!0)},A})();T.StreamManager=_}},d={};function l(S){var T=d[S];if(T!==void 0)return T.exports;var y=d[S]={exports:{}};return s[S].call(y.exports,y,y.exports,l),y.exports}var p={};return(()=>{var S=p;Object.defineProperty(S,"__esModule",{value:!0}),S.DataChannelCore=S.EDatachannelStatus=S.PeerConnectionCore=void 0;var T=l(776);Object.defineProperty(S,"PeerConnectionCore",{enumerable:!0,get:function(){return T.PeerConnectionCore}}),Object.defineProperty(S,"EDatachannelStatus",{enumerable:!0,get:function(){return T.EDatachannelStatus}});var y=l(651);Object.defineProperty(S,"DataChannelCore",{enumerable:!0,get:function(){return y.DataChannelCore}})})(),p})(),g.exports=c()},2505:(g,c,s)=>{g.exports=s(8015)},5592:(g,c,s)=>{var d=s(9516),l=s(7522),p=s(3948),S=s(9106),T=s(9615),y=s(2012),R=s(4202),v=s(7763);g.exports=function(h){return new Promise((function(m,_){var A=h.data,E=h.headers,b=h.responseType;d.isFormData(A)&&delete E["Content-Type"];var w=new XMLHttpRequest;if(h.auth){var C=h.auth.username||"",P=h.auth.password?unescape(encodeURIComponent(h.auth.password)):"";E.Authorization="Basic "+btoa(C+":"+P)}var U=T(h.baseURL,h.url);function B(){if(w){var H="getAllResponseHeaders"in w?y(w.getAllResponseHeaders()):null,O={data:b&&b!=="text"&&b!=="json"?w.response:w.responseText,status:w.status,statusText:w.statusText,headers:H,config:h,request:w};l(m,_,O),w=null}}if(w.open(h.method.toUpperCase(),S(U,h.params,h.paramsSerializer),!0),w.timeout=h.timeout,"onloadend"in w?w.onloadend=B:w.onreadystatechange=function(){w&&w.readyState===4&&(w.status!==0||w.responseURL&&w.responseURL.indexOf("file:")===0)&&setTimeout(B)},w.onabort=function(){w&&(_(v("Request aborted",h,"ECONNABORTED",w)),w=null)},w.onerror=function(){_(v("Network Error",h,null,w)),w=null},w.ontimeout=function(){var H="timeout of "+h.timeout+"ms exceeded";h.timeoutErrorMessage&&(H=h.timeoutErrorMessage),_(v(H,h,h.transitional&&h.transitional.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",w)),w=null},d.isStandardBrowserEnv()){var L=(h.withCredentials||R(U))&&h.xsrfCookieName?p.read(h.xsrfCookieName):void 0;L&&(E[h.xsrfHeaderName]=L)}"setRequestHeader"in w&&d.forEach(E,(function(H,O){A===void 0&&O.toLowerCase()==="content-type"?delete E[O]:w.setRequestHeader(O,H)})),d.isUndefined(h.withCredentials)||(w.withCredentials=!!h.withCredentials),b&&b!=="json"&&(w.responseType=h.responseType),typeof h.onDownloadProgress=="function"&&w.addEventListener("progress",h.onDownloadProgress),typeof h.onUploadProgress=="function"&&w.upload&&w.upload.addEventListener("progress",h.onUploadProgress),h.cancelToken&&h.cancelToken.promise.then((function(H){w&&(w.abort(),_(H),w=null)})),A||(A=null),w.send(A)}))}},8015:(g,c,s)=>{var d=s(9516),l=s(9012),p=s(5155),S=s(5343);function T(R){var v=new p(R),h=l(p.prototype.request,v);return d.extend(h,p.prototype,v),d.extend(h,v),h}var y=T(s(6987));y.Axios=p,y.create=function(R){return T(S(y.defaults,R))},y.Cancel=s(1928),y.CancelToken=s(3191),y.isCancel=s(3864),y.all=function(R){return Promise.all(R)},y.spread=s(7980),y.isAxiosError=s(5019),g.exports=y,g.exports.default=y},1928:g=>{function c(s){this.message=s}c.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},c.prototype.__CANCEL__=!0,g.exports=c},3191:(g,c,s)=>{var d=s(1928);function l(p){if(typeof p!="function")throw new TypeError("executor must be a function.");var S;this.promise=new Promise((function(y){S=y}));var T=this;p((function(y){T.reason||(T.reason=new d(y),S(T.reason))}))}l.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},l.source=function(){var p;return{token:new l((function(S){p=S})),cancel:p}},g.exports=l},3864:g=>{g.exports=function(c){return!(!c||!c.__CANCEL__)}},5155:(g,c,s)=>{var d=s(9516),l=s(9106),p=s(3471),S=s(4490),T=s(5343),y=s(4841),R=y.validators;function v(h){this.defaults=h,this.interceptors={request:new p,response:new p}}v.prototype.request=function(h){typeof h=="string"?(h=arguments[1]||{}).url=arguments[0]:h=h||{},(h=T(this.defaults,h)).method?h.method=h.method.toLowerCase():this.defaults.method?h.method=this.defaults.method.toLowerCase():h.method="get";var m=h.transitional;m!==void 0&&y.assertOptions(m,{silentJSONParsing:R.transitional(R.boolean,"1.0.0"),forcedJSONParsing:R.transitional(R.boolean,"1.0.0"),clarifyTimeoutError:R.transitional(R.boolean,"1.0.0")},!1);var _=[],A=!0;this.interceptors.request.forEach((function(B){typeof B.runWhen=="function"&&B.runWhen(h)===!1||(A=A&&B.synchronous,_.unshift(B.fulfilled,B.rejected))}));var E,b=[];if(this.interceptors.response.forEach((function(B){b.push(B.fulfilled,B.rejected)})),!A){var w=[S,void 0];for(Array.prototype.unshift.apply(w,_),w=w.concat(b),E=Promise.resolve(h);w.length;)E=E.then(w.shift(),w.shift());return E}for(var C=h;_.length;){var P=_.shift(),U=_.shift();try{C=P(C)}catch(B){U(B);break}}try{E=S(C)}catch(B){return Promise.reject(B)}for(;b.length;)E=E.then(b.shift(),b.shift());return E},v.prototype.getUri=function(h){return h=T(this.defaults,h),l(h.url,h.params,h.paramsSerializer).replace(/^\?/,"")},d.forEach(["delete","get","head","options"],(function(h){v.prototype[h]=function(m,_){return this.request(T(_||{},{method:h,url:m,data:(_||{}).data}))}})),d.forEach(["post","put","patch"],(function(h){v.prototype[h]=function(m,_,A){return this.request(T(A||{},{method:h,url:m,data:_}))}})),g.exports=v},3471:(g,c,s)=>{var d=s(9516);function l(){this.handlers=[]}l.prototype.use=function(p,S,T){return this.handlers.push({fulfilled:p,rejected:S,synchronous:!!T&&T.synchronous,runWhen:T?T.runWhen:null}),this.handlers.length-1},l.prototype.eject=function(p){this.handlers[p]&&(this.handlers[p]=null)},l.prototype.forEach=function(p){d.forEach(this.handlers,(function(S){S!==null&&p(S)}))},g.exports=l},9615:(g,c,s)=>{var d=s(9137),l=s(4680);g.exports=function(p,S){return p&&!d(S)?l(p,S):S}},7763:(g,c,s)=>{var d=s(5449);g.exports=function(l,p,S,T,y){var R=new Error(l);return d(R,p,S,T,y)}},4490:(g,c,s)=>{var d=s(9516),l=s(2881),p=s(3864),S=s(6987);function T(y){y.cancelToken&&y.cancelToken.throwIfRequested()}g.exports=function(y){return T(y),y.headers=y.headers||{},y.data=l.call(y,y.data,y.headers,y.transformRequest),y.headers=d.merge(y.headers.common||{},y.headers[y.method]||{},y.headers),d.forEach(["delete","get","head","post","put","patch","common"],(function(R){delete y.headers[R]})),(y.adapter||S.adapter)(y).then((function(R){return T(y),R.data=l.call(y,R.data,R.headers,y.transformResponse),R}),(function(R){return p(R)||(T(y),R&&R.response&&(R.response.data=l.call(y,R.response.data,R.response.headers,y.transformResponse))),Promise.reject(R)}))}},5449:g=>{g.exports=function(c,s,d,l,p){return c.config=s,d&&(c.code=d),c.request=l,c.response=p,c.isAxiosError=!0,c.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},c}},5343:(g,c,s)=>{var d=s(9516);g.exports=function(l,p){p=p||{};var S={},T=["url","method","data"],y=["headers","auth","proxy","params"],R=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],v=["validateStatus"];function h(E,b){return d.isPlainObject(E)&&d.isPlainObject(b)?d.merge(E,b):d.isPlainObject(b)?d.merge({},b):d.isArray(b)?b.slice():b}function m(E){d.isUndefined(p[E])?d.isUndefined(l[E])||(S[E]=h(void 0,l[E])):S[E]=h(l[E],p[E])}d.forEach(T,(function(E){d.isUndefined(p[E])||(S[E]=h(void 0,p[E]))})),d.forEach(y,m),d.forEach(R,(function(E){d.isUndefined(p[E])?d.isUndefined(l[E])||(S[E]=h(void 0,l[E])):S[E]=h(void 0,p[E])})),d.forEach(v,(function(E){E in p?S[E]=h(l[E],p[E]):E in l&&(S[E]=h(void 0,l[E]))}));var _=T.concat(y).concat(R).concat(v),A=Object.keys(l).concat(Object.keys(p)).filter((function(E){return _.indexOf(E)===-1}));return d.forEach(A,m),S}},7522:(g,c,s)=>{var d=s(7763);g.exports=function(l,p,S){var T=S.config.validateStatus;S.status&&T&&!T(S.status)?p(d("Request failed with status code "+S.status,S.config,null,S.request,S)):l(S)}},2881:(g,c,s)=>{var d=s(9516),l=s(6987);g.exports=function(p,S,T){var y=this||l;return d.forEach(T,(function(R){p=R.call(y,p,S)})),p}},6987:(g,c,s)=>{var d=s(9516),l=s(7018),p=s(5449),S={"Content-Type":"application/x-www-form-urlencoded"};function T(v,h){!d.isUndefined(v)&&d.isUndefined(v["Content-Type"])&&(v["Content-Type"]=h)}var y,R={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:((typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(y=s(5592)),y),transformRequest:[function(v,h){return l(h,"Accept"),l(h,"Content-Type"),d.isFormData(v)||d.isArrayBuffer(v)||d.isBuffer(v)||d.isStream(v)||d.isFile(v)||d.isBlob(v)?v:d.isArrayBufferView(v)?v.buffer:d.isURLSearchParams(v)?(T(h,"application/x-www-form-urlencoded;charset=utf-8"),v.toString()):d.isObject(v)||h&&h["Content-Type"]==="application/json"?(T(h,"application/json"),(function(m,_,A){if(d.isString(m))try{return(_||JSON.parse)(m),d.trim(m)}catch(E){if(E.name!=="SyntaxError")throw E}return(A||JSON.stringify)(m)})(v)):v}],transformResponse:[function(v){var h=this.transitional,m=h&&h.silentJSONParsing,_=h&&h.forcedJSONParsing,A=!m&&this.responseType==="json";if(A||_&&d.isString(v)&&v.length)try{return JSON.parse(v)}catch(E){if(A)throw E.name==="SyntaxError"?p(E,this,"E_JSON_PARSE"):E}return v}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(v){return v>=200&&v<300}};R.headers={common:{Accept:"application/json, text/plain, */*"}},d.forEach(["delete","get","head"],(function(v){R.headers[v]={}})),d.forEach(["post","put","patch"],(function(v){R.headers[v]=d.merge(S)})),g.exports=R},9012:g=>{g.exports=function(c,s){return function(){for(var d=new Array(arguments.length),l=0;l<d.length;l++)d[l]=arguments[l];return c.apply(s,d)}}},9106:(g,c,s)=>{var d=s(9516);function l(p){return encodeURIComponent(p).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}g.exports=function(p,S,T){if(!S)return p;var y;if(T)y=T(S);else if(d.isURLSearchParams(S))y=S.toString();else{var R=[];d.forEach(S,(function(h,m){h!=null&&(d.isArray(h)?m+="[]":h=[h],d.forEach(h,(function(_){d.isDate(_)?_=_.toISOString():d.isObject(_)&&(_=JSON.stringify(_)),R.push(l(m)+"="+l(_))})))})),y=R.join("&")}if(y){var v=p.indexOf("#");v!==-1&&(p=p.slice(0,v)),p+=(p.indexOf("?")===-1?"?":"&")+y}return p}},4680:g=>{g.exports=function(c,s){return s?c.replace(/\/+$/,"")+"/"+s.replace(/^\/+/,""):c}},3948:(g,c,s)=>{var d=s(9516);g.exports=d.isStandardBrowserEnv()?{write:function(l,p,S,T,y,R){var v=[];v.push(l+"="+encodeURIComponent(p)),d.isNumber(S)&&v.push("expires="+new Date(S).toGMTString()),d.isString(T)&&v.push("path="+T),d.isString(y)&&v.push("domain="+y),R===!0&&v.push("secure"),document.cookie=v.join("; ")},read:function(l){var p=document.cookie.match(new RegExp("(^|;\\s*)("+l+")=([^;]*)"));return p?decodeURIComponent(p[3]):null},remove:function(l){this.write(l,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},9137:g=>{g.exports=function(c){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(c)}},5019:g=>{g.exports=function(c){return typeof c=="object"&&c.isAxiosError===!0}},4202:(g,c,s)=>{var d=s(9516);g.exports=d.isStandardBrowserEnv()?(function(){var l,p=/(msie|trident)/i.test(navigator.userAgent),S=document.createElement("a");function T(y){var R=y;return p&&(S.setAttribute("href",R),R=S.href),S.setAttribute("href",R),{href:S.href,protocol:S.protocol?S.protocol.replace(/:$/,""):"",host:S.host,search:S.search?S.search.replace(/^\?/,""):"",hash:S.hash?S.hash.replace(/^#/,""):"",hostname:S.hostname,port:S.port,pathname:S.pathname.charAt(0)==="/"?S.pathname:"/"+S.pathname}}return l=T(window.location.href),function(y){var R=d.isString(y)?T(y):y;return R.protocol===l.protocol&&R.host===l.host}})():function(){return!0}},7018:(g,c,s)=>{var d=s(9516);g.exports=function(l,p){d.forEach(l,(function(S,T){T!==p&&T.toUpperCase()===p.toUpperCase()&&(l[p]=S,delete l[T])}))}},2012:(g,c,s)=>{var d=s(9516),l=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];g.exports=function(p){var S,T,y,R={};return p&&d.forEach(p.split(`
`),(function(v){if(y=v.indexOf(":"),S=d.trim(v.substr(0,y)).toLowerCase(),T=d.trim(v.substr(y+1)),S){if(R[S]&&l.indexOf(S)>=0)return;R[S]=S==="set-cookie"?(R[S]?R[S]:[]).concat([T]):R[S]?R[S]+", "+T:T}})),R}},7980:g=>{g.exports=function(c){return function(s){return c.apply(null,s)}}},4841:(g,c,s)=>{var d=s(4198),l={};["object","boolean","number","function","string","symbol"].forEach((function(y,R){l[y]=function(v){return typeof v===y||"a"+(R<1?"n ":" ")+y}}));var p={},S=d.version.split(".");function T(y,R){for(var v=R?R.split("."):S,h=y.split("."),m=0;m<3;m++){if(v[m]>h[m])return!0;if(v[m]<h[m])return!1}return!1}l.transitional=function(y,R,v){var h=R&&T(R);function m(_,A){return"[Axios v"+d.version+"] Transitional option '"+_+"'"+A+(v?". "+v:"")}return function(_,A,E){if(y===!1)throw new Error(m(A," has been removed in "+R));return h&&!p[A]&&(p[A]=!0,console.warn(m(A," has been deprecated since v"+R+" and will be removed in the near future"))),!y||y(_,A,E)}},g.exports={isOlderVersion:T,assertOptions:function(y,R,v){if(typeof y!="object")throw new TypeError("options must be an object");for(var h=Object.keys(y),m=h.length;m-- >0;){var _=h[m],A=R[_];if(A){var E=y[_],b=E===void 0||A(E,_,y);if(b!==!0)throw new TypeError("option "+_+" must be "+b)}else if(v!==!0)throw Error("Unknown option "+_)}},validators:l}},9516:(g,c,s)=>{var d=s(9012),l=Object.prototype.toString;function p(h){return l.call(h)==="[object Array]"}function S(h){return h===void 0}function T(h){return h!==null&&typeof h=="object"}function y(h){if(l.call(h)!=="[object Object]")return!1;var m=Object.getPrototypeOf(h);return m===null||m===Object.prototype}function R(h){return l.call(h)==="[object Function]"}function v(h,m){if(h!=null)if(typeof h!="object"&&(h=[h]),p(h))for(var _=0,A=h.length;_<A;_++)m.call(null,h[_],_,h);else for(var E in h)Object.prototype.hasOwnProperty.call(h,E)&&m.call(null,h[E],E,h)}g.exports={isArray:p,isArrayBuffer:function(h){return l.call(h)==="[object ArrayBuffer]"},isBuffer:function(h){return h!==null&&!S(h)&&h.constructor!==null&&!S(h.constructor)&&typeof h.constructor.isBuffer=="function"&&h.constructor.isBuffer(h)},isFormData:function(h){return typeof FormData<"u"&&h instanceof FormData},isArrayBufferView:function(h){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(h):h&&h.buffer&&h.buffer instanceof ArrayBuffer},isString:function(h){return typeof h=="string"},isNumber:function(h){return typeof h=="number"},isObject:T,isPlainObject:y,isUndefined:S,isDate:function(h){return l.call(h)==="[object Date]"},isFile:function(h){return l.call(h)==="[object File]"},isBlob:function(h){return l.call(h)==="[object Blob]"},isFunction:R,isStream:function(h){return T(h)&&R(h.pipe)},isURLSearchParams:function(h){return typeof URLSearchParams<"u"&&h instanceof URLSearchParams},isStandardBrowserEnv:function(){return(typeof navigator>"u"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window<"u"&&typeof document<"u"},forEach:v,merge:function h(){var m={};function _(b,w){y(m[w])&&y(b)?m[w]=h(m[w],b):y(b)?m[w]=h({},b):p(b)?m[w]=b.slice():m[w]=b}for(var A=0,E=arguments.length;A<E;A++)v(arguments[A],_);return m},extend:function(h,m,_){return v(m,(function(A,E){h[E]=_&&typeof A=="function"?d(A,_):A})),h},trim:function(h){return h.trim?h.trim():h.replace(/^\s+|\s+$/g,"")},stripBOM:function(h){return h.charCodeAt(0)===65279&&(h=h.slice(1)),h}}},3412:g=>{g.exports=(()=>{var c={304:(d,l,p)=>{Object.defineProperty(l,"__esModule",{value:!0}),l.BrowserDeviceManager=void 0;var S=p(101),T=p(853),y=p(62),R=p(913),v=p(331),h=p(1),m=p(935),_=p(603),A=(function(){function E(){this.systemUtil=new S.SystemUtil,this.deviceManager=this.createDeviceManager()}return E.prototype.getCameraList=function(){return this.deviceManager.getCameraList()},E.prototype.getMicList=function(){return this.deviceManager.getMicList()},E.prototype.getSpeakerList=function(){return this.deviceManager.getSpeakerList()},E.prototype.getAudioTrack=function(b){return this.deviceManager.getAudioTrack(b)},E.prototype.getVideoTrack=function(b){return this.deviceManager.getVideoTrack(b)},E.prototype.getAudioVideoTracks=function(b){return this.deviceManager.getAudioVideoTracks(b)},E.prototype.getScreenTrack=function(b){return this.deviceManager.getScreenTrack(b)},E.prototype.getAudioStream=function(b){return this.deviceManager.getAudioStream(b)},E.prototype.getVideoStream=function(b){return this.deviceManager.getVideoStream(b)},E.prototype.getScreenStream=function(b){return this.deviceManager.getScreenStream(b)},E.prototype.checkSupportScreenShare=function(){return this.deviceManager.checkSupportScreenShare()},E.prototype.createDeviceManager=function(){return this.systemUtil.isWindows?new m.WindowsDeviceManager:this.systemUtil.isAndroid?new T.AndroidDeviceManager:this.systemUtil.isIos?new R.IosDeviceManager:this.systemUtil.isMacOS?new h.MacDeviceManager:this.systemUtil.isLinux?new v.LinuxDeviceManager:new y.BaseDeviceManager},E.isDeviceManagerError=_.DeviceError.isDeviceManagerError,E})();l.BrowserDeviceManager=A},603:(d,l,p)=>{Object.defineProperty(l,"__esModule",{value:!0}),l.DeviceError=l.DeviceErrorDescription=l.DeviceErrorCode=void 0;var S=p(610);(function(y){y[y.ERROR_DEVICE_UNKNOWNERROR=1e4]="ERROR_DEVICE_UNKNOWNERROR",y[y.ERROR_DEVICE_AUDIODEVICE_NOTFOUND=10001]="ERROR_DEVICE_AUDIODEVICE_NOTFOUND",y[y.ERROR_DEVICE_VIDEODEVICE_NOTFOUND=10002]="ERROR_DEVICE_VIDEODEVICE_NOTFOUND",y[y.ERROR_DEVICE_NOTFOUND=10020]="ERROR_DEVICE_NOTFOUND",y[y.ERROR_DEVICE_AUDIODEVICE_NOTALLOWED=10003]="ERROR_DEVICE_AUDIODEVICE_NOTALLOWED",y[y.ERROR_DEVICE_VIDEODEVICE_NOTALLOWED=10004]="ERROR_DEVICE_VIDEODEVICE_NOTALLOWED",y[y.ERROR_DEVICE_NOTALLOWED=10021]="ERROR_DEVICE_NOTALLOWED",y[y.ERROR_DEVICE_AUDIODEVICE_NOTREADABLE=10005]="ERROR_DEVICE_AUDIODEVICE_NOTREADABLE",y[y.ERROR_DEVICE_VIDEODEVICE_NOTREADABLE=10006]="ERROR_DEVICE_VIDEODEVICE_NOTREADABLE",y[y.ERROR_DEVICE_NOTREADABLE=10022]="ERROR_DEVICE_NOTREADABLE",y[y.ERROR_DEIVCE_CONSTRAINEDERROR=10007]="ERROR_DEIVCE_CONSTRAINEDERROR",y[y.ERROR_SCREENSHARE_UNKNOWNERRO=10010]="ERROR_SCREENSHARE_UNKNOWNERRO",y[y.ERROR_SCREENSHARE_NOTALLOWED=10011]="ERROR_SCREENSHARE_NOTALLOWED",y[y.ERROR_SCREENSHARE_ENDED=10012]="ERROR_SCREENSHARE_ENDED",y[y.ERROR_SCREENSHARE_NOPERMISSION=10013]="ERROR_SCREENSHARE_NOPERMISSION",y[y.ERROR_SCREENSHARE_INVALIDACCESS=10014]="ERROR_SCREENSHARE_INVALIDACCESS",y[y.ERROR_SCREENSHARE_NOTSUPPORT=10018]="ERROR_SCREENSHARE_NOTSUPPORT",y[y.ERROR_DEVICE_NOTSUPPORT=10019]="ERROR_DEVICE_NOTSUPPORT"})(l.DeviceErrorCode||(l.DeviceErrorCode={})),(function(y){y.ERRORMESSAGE_DEVICENOTFOUND="Requested device not found",y.ERRORMESSAGE_DEVICENOTALLOWED="Permission denied",y.ERRORMESSAGE_MACCHROME_DEVICENOTREADABLE="Permission denied by system",y.ERRORMESSAGE_MACSAFARI_DEVICENOTALLOWED="The request is not allowed by the user agent or the platform in the current context, possibly because the user denied permission.",y.ERRORMESSAGE_MOBILEDEVICE_NOTALLOWED="video device not allowed",y.ERRORMESSAGE_AUDIODEVICENOTREADABLE="Could not start audio source",y.ERRORMESSAGE_VIDEODEVICENOTREADABLE="Could not start video source",y.ERRORNAME_DEVICENOTFOUND="NotFoundError",y.ERRORNAME_DEVICENOTALLOWED="NotAllowedError",y.ERRORNAME_DEVICENOTREADABLE="NotReadableError",y.ERRORNAME_DEVICEOVERCONSTRAINED="OverconstrainedError",y.ERRORNAME_INVALID_ACCESS="InvalidAccessError"})(l.DeviceErrorDescription||(l.DeviceErrorDescription={}));var T=(function(){function y(R,v){this.linkUtil=new S.LinkUtil,this.code=R,this.reason=v,this.relatedLink=this.linkUtil.getRelatedLink(R)}return y.isDeviceManagerError=function(R){return!!(R&&typeof R=="object"&&"code"in R&&"reason"in R)},y})();l.DeviceError=T},873:(d,l)=>{Object.defineProperty(l,"__esModule",{value:!0}),l.DeviceType=l.MobileCameraType=void 0,(function(p){p[p.USER=0]="USER",p[p.ENV=1]="ENV"})(l.MobileCameraType||(l.MobileCameraType={})),(function(p){p.Camera="videoinput",p.Mic="audioinput",p.Mixed="audiovideoinput",p.Screen="screen",p.Speaker="audiooutput"})(l.DeviceType||(l.DeviceType={}))},853:function(d,l,p){var S,T=this&&this.__extends||(S=function(R,v){return(S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,m){h.__proto__=m}||function(h,m){for(var _ in m)Object.prototype.hasOwnProperty.call(m,_)&&(h[_]=m[_])})(R,v)},function(R,v){function h(){this.constructor=R}S(R,v),R.prototype=v===null?Object.create(v):(h.prototype=v.prototype,new h)});Object.defineProperty(l,"__esModule",{value:!0}),l.AndroidDeviceManager=void 0;var y=(function(R){function v(){return R.call(this)||this}return T(v,R),v})(p(583).MobileDeviceManager);l.AndroidDeviceManager=y},62:(d,l,p)=>{Object.defineProperty(l,"__esModule",{value:!0}),l.BaseDeviceManager=void 0;var S=p(603),T=p(873),y=(function(){function R(){}return R.prototype.checkSupportScreenShare=function(){return!!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia&&navigator.mediaDevices.getDisplayMedia)},R.prototype.getCameraList=function(){var v=this;return new Promise((function(h,m){v.checkSupport()?v.getDeviceRight(T.DeviceType.Camera).then((function(){v.getDeviceList(T.DeviceType.Camera).then((function(_){h(_)})).catch((function(_){m(v.parseError(T.DeviceType.Camera,_))}))})).catch((function(_){m(v.parseError(T.DeviceType.Camera,_))})):m(new S.DeviceError(S.DeviceErrorCode.ERROR_DEVICE_NOTSUPPORT,"not support navigator.mediaDevices"))}))},R.prototype.getMicList=function(){var v=this;return new Promise((function(h,m){v.checkSupport()?v.getDeviceRight(T.DeviceType.Mic).then((function(){v.getDeviceList(T.DeviceType.Mic).then((function(_){h(_)})).catch((function(_){m(v.parseError(T.DeviceType.Mic,_))}))})).catch((function(_){m(v.parseError(T.DeviceType.Mic,_))})):m(new S.DeviceError(S.DeviceErrorCode.ERROR_DEVICE_NOTSUPPORT,"not support navigator.mediaDevices"))}))},R.prototype.getSpeakerList=function(){var v=this;return new Promise((function(h,m){v.checkSupport()?v.getDeviceRight(T.DeviceType.Speaker).then((function(){v.getDeviceList(T.DeviceType.Speaker).then((function(_){h(_)})).catch((function(_){m(v.parseError(T.DeviceType.Speaker,_))}))})).catch((function(_){m(v.parseError(T.DeviceType.Speaker,_))})):m(new S.DeviceError(S.DeviceErrorCode.ERROR_DEVICE_NOTSUPPORT,"not support navigator.mediaDevices"))}))},R.prototype.getAudioTrack=function(v){return this.getAudioStream(v).then((function(h){return h.getAudioTracks()[0]}))},R.prototype.getAudioStream=function(v){var h=this;return new Promise((function(m,_){if(h.checkSupport()){var A=h.createAudioConstraints(v);navigator.mediaDevices.getUserMedia(A).then((function(E){m(E)})).catch((function(E){_(h.parseError(T.DeviceType.Mic,E))}))}else _(new S.DeviceError(S.DeviceErrorCode.ERROR_DEVICE_NOTSUPPORT,"not support navigator.mediaDevices"))}))},R.prototype.getVideoTrack=function(v){return this.getVideoStream(v).then((function(h){return h.getVideoTracks()[0]}))},R.prototype.getVideoStream=function(v){var h=this;return new Promise((function(m,_){if(h.checkSupport()){var A=h.createVideoConstraints(v);navigator.mediaDevices.getUserMedia(A).then((function(E){m(E)})).catch((function(E){_(h.parseError(T.DeviceType.Camera,E))}))}else _(new S.DeviceError(S.DeviceErrorCode.ERROR_DEVICE_NOTSUPPORT,"not support navigator.mediaDevices"))}))},R.prototype.getAudioVideoTracks=function(v){return this.getMixedStream(v).then((function(h){return h.getTracks()}))},R.prototype.getMixedStream=function(v){var h=this;return new Promise((function(m,_){if(h.checkSupport()){var A=h.createMixedConstraints(v);navigator.mediaDevices.getUserMedia(A).then((function(E){m(E)})).catch((function(E){_(h.parseError(T.DeviceType.Mixed,E))}))}else _(new S.DeviceError(S.DeviceErrorCode.ERROR_DEVICE_NOTSUPPORT,"not support navigator.mediaDevices"))}))},R.prototype.getScreenTrack=function(v){return this.getScreenStream(v).then((function(h){return h.getTracks()}))},R.prototype.getScreenStream=function(v){var h=this;return new Promise((function(m,_){h.checkSupportScreenShare()?navigator.mediaDevices.getDisplayMedia(v).then((function(A){m(A)})).catch((function(A){_(h.parseError(T.DeviceType.Screen,A))})):_(new S.DeviceError(S.DeviceErrorCode.ERROR_SCREENSHARE_NOTSUPPORT,"browser not support screenshare"))}))},R.prototype.checkSupport=function(){return!!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&navigator.mediaDevices.getUserMedia)},R.prototype.getDeviceList=function(v){return new Promise((function(h,m){navigator.mediaDevices.enumerateDevices().then((function(_){var A=[];_.forEach((function(E){E.kind===v&&A.push(E)})),h(A)})).catch((function(_){m(_)}))}))},R.prototype.getDeviceRight=function(v){return new Promise((function(h,m){var _;T.DeviceType.Camera===v?_={video:!0}:T.DeviceType.Mic!==v&&T.DeviceType.Speaker!==v||(_={audio:!0}),navigator.mediaDevices.getUserMedia(_).then((function(A){A.getTracks().forEach((function(E){E.stop()})),h(void 0)})).catch((function(A){h(void 0)}))}))},R.prototype.parseError=function(v,h){var m=null;return T.DeviceType.Mic===v?m=this.parseAudioError(h):T.DeviceType.Camera===v?m=this.parseVideoError(h):T.DeviceType.Mixed===v?m=this.parseMixedError(h):T.DeviceType.Screen===v&&(m=this.parseScreenError(h)),m===null?new S.DeviceError(S.DeviceErrorCode.ERROR_DEVICE_UNKNOWNERROR,""):m},R.prototype.parseAudioError=function(v){return v.message===S.DeviceErrorDescription.ERRORMESSAGE_DEVICENOTFOUND||v.name===S.DeviceErrorDescription.ERRORNAME_DEVICENOTFOUND?new S.DeviceError(S.DeviceErrorCode.ERROR_DEVICE_AUDIODEVICE_NOTFOUND,"audio device not found"):v.message===S.DeviceErrorDescription.ERRORMESSAGE_DEVICENOTALLOWED||v.message===S.DeviceErrorDescription.ERRORMESSAGE_MACSAFARI_DEVICENOTALLOWED?new S.DeviceError(S.DeviceErrorCode.ERROR_DEVICE_AUDIODEVICE_NOTALLOWED,"audio device not allowed"):v.message===S.DeviceErrorDescription.ERRORMESSAGE_MACCHROME_DEVICENOTREADABLE||v.message===S.DeviceErrorDescription.ERRORMESSAGE_AUDIODEVICENOTREADABLE||v.message===S.DeviceErrorDescription.ERRORNAME_DEVICENOTREADABLE?new S.DeviceError(S.DeviceErrorCode.ERROR_DEVICE_AUDIODEVICE_NOTREADABLE,"audio device not readable"):null},R.prototype.parseVideoError=function(v){return v.message===S.DeviceErrorDescription.ERRORMESSAGE_DEVICENOTFOUND||v.name===S.DeviceErrorDescription.ERRORNAME_DEVICENOTFOUND?new S.DeviceError(S.DeviceErrorCode.ERROR_DEVICE_VIDEODEVICE_NOTFOUND,"video device not found"):v.message===S.DeviceErrorDescription.ERRORMESSAGE_DEVICENOTALLOWED||v.message===S.DeviceErrorDescription.ERRORMESSAGE_MOBILEDEVICE_NOTALLOWED||v.message===S.DeviceErrorDescription.ERRORMESSAGE_MACSAFARI_DEVICENOTALLOWED?new S.DeviceError(S.DeviceErrorCode.ERROR_DEVICE_VIDEODEVICE_NOTALLOWED,"video device not allowed"):v.message===S.DeviceErrorDescription.ERRORMESSAGE_MACCHROME_DEVICENOTREADABLE||v.message===S.DeviceErrorDescription.ERRORMESSAGE_VIDEODEVICENOTREADABLE||v.name===S.DeviceErrorDescription.ERRORNAME_DEVICENOTREADABLE?new S.DeviceError(S.DeviceErrorCode.ERROR_DEVICE_VIDEODEVICE_NOTREADABLE,"video device not readable"):null},R.prototype.parseMixedError=function(v){return v.message===S.DeviceErrorDescription.ERRORMESSAGE_DEVICENOTFOUND||v.name===S.DeviceErrorDescription.ERRORNAME_DEVICENOTFOUND?new S.DeviceError(S.DeviceErrorCode.ERROR_DEVICE_NOTFOUND,"audio or video device not found"):v.message===S.DeviceErrorDescription.ERRORMESSAGE_DEVICENOTALLOWED||v.message===S.DeviceErrorDescription.ERRORMESSAGE_MACSAFARI_DEVICENOTALLOWED?new S.DeviceError(S.DeviceErrorCode.ERROR_DEVICE_NOTALLOWED,"audio or video device not allowed"):v.message===S.DeviceErrorDescription.ERRORMESSAGE_MOBILEDEVICE_NOTALLOWED?new S.DeviceError(S.DeviceErrorCode.ERROR_DEVICE_VIDEODEVICE_NOTALLOWED,"video device not allowed"):v.message===S.DeviceErrorDescription.ERRORMESSAGE_MACCHROME_DEVICENOTREADABLE||v.name===S.DeviceErrorDescription.ERRORNAME_DEVICENOTREADABLE?new S.DeviceError(S.DeviceErrorCode.ERROR_DEVICE_NOTREADABLE,"audio or video device not readable"):v.message===S.DeviceErrorDescription.ERRORMESSAGE_AUDIODEVICENOTREADABLE?new S.DeviceError(S.DeviceErrorCode.ERROR_DEVICE_AUDIODEVICE_NOTREADABLE,"audio device not readable"):v.message===S.DeviceErrorDescription.ERRORMESSAGE_VIDEODEVICENOTREADABLE?new S.DeviceError(S.DeviceErrorCode.ERROR_DEVICE_VIDEODEVICE_NOTREADABLE,"video device not readable"):null},R.prototype.parseScreenError=function(v){return v.name===S.DeviceErrorDescription.ERRORNAME_DEVICENOTALLOWED?v.message===S.DeviceErrorDescription.ERRORMESSAGE_DEVICENOTALLOWED?new S.DeviceError(S.DeviceErrorCode.ERROR_SCREENSHARE_NOTALLOWED,v.message):new S.DeviceError(S.DeviceErrorCode.ERROR_SCREENSHARE_NOPERMISSION,v.message):v.name===S.DeviceErrorDescription.ERRORNAME_INVALID_ACCESS?new S.DeviceError(S.DeviceErrorCode.ERROR_SCREENSHARE_INVALIDACCESS,v.message):null},R.prototype.createVideoConstraints=function(v){typeof v.deviceId=="string"&&(v.deviceId={exact:v.deviceId});var h={video:v};return Object.keys(v).length===0&&(h={video:!0}),h},R.prototype.createAudioConstraints=function(v){typeof v.deviceId=="string"&&(v.deviceId={exact:v.deviceId});var h={audio:v};return Object.keys(v).length===0&&(h={audio:!0}),h},R.prototype.createMixedConstraints=function(v){if(console.log("createMixedConstraints"),v.video&&typeof v.video=="object"){var h=v.video;typeof h.deviceId=="string"&&(h.deviceId={exact:h.deviceId})}if(v.audio&&typeof v.audio=="object"){var m=v.audio;typeof m.deviceId=="string"&&(m.deviceId={exact:m.deviceId})}return v},R})();l.BaseDeviceManager=y},913:function(d,l,p){var S,T=this&&this.__extends||(S=function(R,v){return(S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,m){h.__proto__=m}||function(h,m){for(var _ in m)Object.prototype.hasOwnProperty.call(m,_)&&(h[_]=m[_])})(R,v)},function(R,v){function h(){this.constructor=R}S(R,v),R.prototype=v===null?Object.create(v):(h.prototype=v.prototype,new h)});Object.defineProperty(l,"__esModule",{value:!0}),l.IosDeviceManager=void 0;var y=(function(R){function v(){return R.call(this)||this}return T(v,R),v})(p(583).MobileDeviceManager);l.IosDeviceManager=y},331:function(d,l,p){var S,T=this&&this.__extends||(S=function(R,v){return(S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,m){h.__proto__=m}||function(h,m){for(var _ in m)Object.prototype.hasOwnProperty.call(m,_)&&(h[_]=m[_])})(R,v)},function(R,v){function h(){this.constructor=R}S(R,v),R.prototype=v===null?Object.create(v):(h.prototype=v.prototype,new h)});Object.defineProperty(l,"__esModule",{value:!0}),l.LinuxDeviceManager=void 0;var y=(function(R){function v(){return R.call(this)||this}return T(v,R),v})(p(62).BaseDeviceManager);l.LinuxDeviceManager=y},1:function(d,l,p){var S,T=this&&this.__extends||(S=function(R,v){return(S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,m){h.__proto__=m}||function(h,m){for(var _ in m)Object.prototype.hasOwnProperty.call(m,_)&&(h[_]=m[_])})(R,v)},function(R,v){function h(){this.constructor=R}S(R,v),R.prototype=v===null?Object.create(v):(h.prototype=v.prototype,new h)});Object.defineProperty(l,"__esModule",{value:!0}),l.MacDeviceManager=void 0;var y=(function(R){function v(){return R.call(this)||this}return T(v,R),v})(p(62).BaseDeviceManager);l.MacDeviceManager=y},583:function(d,l,p){var S,T=this&&this.__extends||(S=function(v,h){return(S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,_){m.__proto__=_}||function(m,_){for(var A in _)Object.prototype.hasOwnProperty.call(_,A)&&(m[A]=_[A])})(v,h)},function(v,h){function m(){this.constructor=v}S(v,h),v.prototype=h===null?Object.create(h):(m.prototype=h.prototype,new m)});Object.defineProperty(l,"__esModule",{value:!0}),l.MobileDeviceManager=void 0;var y=p(603),R=(function(v){function h(){return v.call(this)||this}return T(h,v),h.prototype.checkSupportScreenShare=function(){return!1},h.prototype.getScreenTrack=function(m){return new Promise((function(_,A){A(new y.DeviceError(y.DeviceErrorCode.ERROR_SCREENSHARE_NOTSUPPORT,"mobile not support screenshare"))}))},h.prototype.getScreenStream=function(m){return new Promise((function(_,A){A(new y.DeviceError(y.DeviceErrorCode.ERROR_SCREENSHARE_NOTSUPPORT,"mobile not support screenshare"))}))},h})(p(62).BaseDeviceManager);l.MobileDeviceManager=R},935:function(d,l,p){var S,T=this&&this.__extends||(S=function(R,v){return(S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,m){h.__proto__=m}||function(h,m){for(var _ in m)Object.prototype.hasOwnProperty.call(m,_)&&(h[_]=m[_])})(R,v)},function(R,v){function h(){this.constructor=R}S(R,v),R.prototype=v===null?Object.create(v):(h.prototype=v.prototype,new h)});Object.defineProperty(l,"__esModule",{value:!0}),l.WindowsDeviceManager=void 0;var y=(function(R){function v(){return R.call(this)||this}return T(v,R),v})(p(62).BaseDeviceManager);l.WindowsDeviceManager=y},607:function(d,l,p){var S=this&&this.__createBinding||(Object.create?function(R,v,h,m){m===void 0&&(m=h),Object.defineProperty(R,m,{enumerable:!0,get:function(){return v[h]}})}:function(R,v,h,m){m===void 0&&(m=h),R[m]=v[h]}),T=this&&this.__exportStar||function(R,v){for(var h in R)h==="default"||Object.prototype.hasOwnProperty.call(v,h)||S(v,R,h)};Object.defineProperty(l,"__esModule",{value:!0}),l.BrowserDeviceManager=void 0;var y=p(304);Object.defineProperty(l,"BrowserDeviceManager",{enumerable:!0,get:function(){return y.BrowserDeviceManager}}),T(p(873),l),window&&(window.BrowserDeviceManager=y.BrowserDeviceManager)},610:(d,l,p)=>{Object.defineProperty(l,"__esModule",{value:!0}),l.LinkUtil=void 0;var S,T=p(603),y=p(261),R=p(54);(function(A){A[A.Windows=0]="Windows",A[A.MacOS=1]="MacOS",A[A.Other=2]="Other"})(S||(S={}));var v="ms-settings:",h="x-apple.systempreferences:com.apple.preference.security?",m={SYS_MIC:[v+"privacy-microphone",h+"Privacy_Microphone"],SYS_CAMERA:[v+"privacy-webcam",h+"Privacy_Camera"],SYS_SCREENSHARE:["",h+"Privacy_ScreenCapture"]},_=(function(){function A(){y||console.error("SystemUtil is not found"),this.systemType=this.getSystemType()}return A.prototype.getRelatedLink=function(E){var b="",w=this.systemType;switch(E){case T.DeviceErrorCode.ERROR_DEVICE_AUDIODEVICE_NOTFOUND:case T.DeviceErrorCode.ERROR_DEVICE_AUDIODEVICE_NOTREADABLE:b=m.SYS_MIC[w];break;case T.DeviceErrorCode.ERROR_DEVICE_VIDEODEVICE_NOTFOUND:case T.DeviceErrorCode.ERROR_DEVICE_VIDEODEVICE_NOTREADABLE:b=m.SYS_CAMERA[w];break;case T.DeviceErrorCode.ERROR_SCREENSHARE_UNKNOWNERRO:case T.DeviceErrorCode.ERROR_SCREENSHARE_NOPERMISSION:b=m.SYS_SCREENSHARE[w];break;case T.DeviceErrorCode.ERROR_DEVICE_AUDIODEVICE_NOTALLOWED:case T.DeviceErrorCode.ERROR_DEVICE_VIDEODEVICE_NOTALLOWED:case T.DeviceErrorCode.ERROR_DEVICE_NOTALLOWED:R.isChrome?b=this.getChromeResetLink():R.isEdge&&(b=this.getEdgeResetLink());break;default:b=""}return b},A.prototype.getSystemType=function(){return y.isWindows?S.Windows:y.isMacOS?S.MacOS:S.Other},A.prototype.getChromeResetLink=function(){return"chrome://settings/content/siteDetails?site="+encodeURIComponent(window.location.origin)},A.prototype.getEdgeResetLink=function(){return"edge://settings/content/siteDetails?site="+encodeURIComponent(window.location.origin)},A})();l.LinkUtil=_},101:(d,l)=>{var p;Object.defineProperty(l,"__esModule",{value:!0}),l.SystemUtil=void 0,(function(T){T[T.Unknown=0]="Unknown",T[T.MacOS=1]="MacOS",T[T.Windows=2]="Windows",T[T.Android=3]="Android",T[T.Iphone=4]="Iphone",T[T.Ipad=5]="Ipad",T[T.Linux=6]="Linux"})(p||(p={}));var S=(function(){function T(){this.systemType=p.Unknown,this.getSystemInfo()}return Object.defineProperty(T.prototype,"isIos",{get:function(){return this.systemType===p.Ipad||this.systemType===p.Iphone},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"isAndroid",{get:function(){return this.systemType===p.Android},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"isMacOS",{get:function(){return this.systemType===p.MacOS},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"isWindows",{get:function(){return this.systemType===p.Windows},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"isLinux",{get:function(){return this.systemType===p.Linux},enumerable:!1,configurable:!0}),T.prototype.getSystemInfo=function(){if(navigator&&navigator.userAgent){var y=navigator.userAgent.toLocaleLowerCase();y.indexOf("ipad")>-1?this.systemType=p.Ipad:y.indexOf("iphone")>-1?this.systemType=p.Iphone:y.indexOf("android")>-1?this.systemType=p.Android:y.indexOf("win")>-1?this.systemType=p.Windows:y.indexOf("mac")>-1?this.systemType=p.MacOS:y.indexOf("linux")>-1?this.systemType=p.Linux:y.indexOf("")>-1&&(this.systemType=p.Unknown)}},T})();l.SystemUtil=S},54:d=>{d.exports=window.BrowserUtil},261:d=>{d.exports=window.SystemUtil}},s={};return(function d(l){if(s[l])return s[l].exports;var p=s[l]={exports:{}};return c[l].call(p.exports,p,p.exports,d),p.exports})(607)})()},6677:(g,c,s)=>{var d=s(7963);function l(R,v,h,m,_){var A=d.writeRtpDescription(R.kind,v);if(A+=d.writeIceParameters(R.iceGatherer.getLocalParameters()),A+=d.writeDtlsParameters(R.dtlsTransport.getLocalParameters(),h==="offer"?"actpass":_||"active"),A+="a=mid:"+R.mid+`\r
`,R.rtpSender&&R.rtpReceiver?A+=`a=sendrecv\r
`:R.rtpSender?A+=`a=sendonly\r
`:R.rtpReceiver?A+=`a=recvonly\r
`:A+=`a=inactive\r
`,R.rtpSender){var E=R.rtpSender._initialTrackId||R.rtpSender.track.id;R.rtpSender._initialTrackId=E;var b="msid:"+(m?m.id:"-")+" "+E+`\r
`;A+="a="+b,A+="a=ssrc:"+R.sendEncodingParameters[0].ssrc+" "+b,R.sendEncodingParameters[0].rtx&&(A+="a=ssrc:"+R.sendEncodingParameters[0].rtx.ssrc+" "+b,A+="a=ssrc-group:FID "+R.sendEncodingParameters[0].ssrc+" "+R.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return A+="a=ssrc:"+R.sendEncodingParameters[0].ssrc+" cname:"+d.localCName+`\r
`,R.rtpSender&&R.sendEncodingParameters[0].rtx&&(A+="a=ssrc:"+R.sendEncodingParameters[0].rtx.ssrc+" cname:"+d.localCName+`\r
`),A}function p(R,v){var h={codecs:[],headerExtensions:[],fecMechanisms:[]},m=function(A,E){A=parseInt(A,10);for(var b=0;b<E.length;b++)if(E[b].payloadType===A||E[b].preferredPayloadType===A)return E[b]},_=function(A,E,b,w){var C=m(A.parameters.apt,b),P=m(E.parameters.apt,w);return C&&P&&C.name.toLowerCase()===P.name.toLowerCase()};return R.codecs.forEach((function(A){for(var E=0;E<v.codecs.length;E++){var b=v.codecs[E];if(A.name.toLowerCase()===b.name.toLowerCase()&&A.clockRate===b.clockRate){if(A.name.toLowerCase()==="rtx"&&A.parameters&&b.parameters.apt&&!_(A,b,R.codecs,v.codecs))continue;(b=JSON.parse(JSON.stringify(b))).numChannels=Math.min(A.numChannels,b.numChannels),h.codecs.push(b),b.rtcpFeedback=b.rtcpFeedback.filter((function(w){for(var C=0;C<A.rtcpFeedback.length;C++)if(A.rtcpFeedback[C].type===w.type&&A.rtcpFeedback[C].parameter===w.parameter)return!0;return!1}));break}}})),R.headerExtensions.forEach((function(A){for(var E=0;E<v.headerExtensions.length;E++){var b=v.headerExtensions[E];if(A.uri===b.uri){h.headerExtensions.push(b);break}}})),h}function S(R,v,h){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[v][R].indexOf(h)!==-1}function T(R,v){var h=R.getRemoteCandidates().find((function(m){return v.foundation===m.foundation&&v.ip===m.ip&&v.port===m.port&&v.priority===m.priority&&v.protocol===m.protocol&&v.type===m.type}));return h||R.addRemoteCandidate(v),!h}function y(R,v){var h=new Error(v);return h.name=R,h.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[R],h}g.exports=function(R,v){function h(E,b){b.addTrack(E),b.dispatchEvent(new R.MediaStreamTrackEvent("addtrack",{track:E}))}function m(E,b,w,C){var P=new Event("track");P.track=b,P.receiver=w,P.transceiver={receiver:w},P.streams=C,R.setTimeout((function(){E._dispatchEvent("track",P)}))}var _=function(E){var b=this,w=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach((function(P){b[P]=w[P].bind(w)})),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",E=JSON.parse(JSON.stringify(E||{})),this.usingBundle=E.bundlePolicy==="max-bundle",E.rtcpMuxPolicy==="negotiate")throw y("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(E.rtcpMuxPolicy||(E.rtcpMuxPolicy="require"),E.iceTransportPolicy){case"all":case"relay":break;default:E.iceTransportPolicy="all"}switch(E.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:E.bundlePolicy="balanced"}if(E.iceServers=(function(P,U){var B=!1;return(P=JSON.parse(JSON.stringify(P))).filter((function(L){if(L&&(L.urls||L.url)){var H=L.urls||L.url;L.url&&!L.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var O=typeof H=="string";return O&&(H=[H]),H=H.filter((function(x){return x.indexOf("turn:")!==0||x.indexOf("transport=udp")===-1||x.indexOf("turn:[")!==-1||B?x.indexOf("stun:")===0&&U>=14393&&x.indexOf("?transport=udp")===-1:(B=!0,!0)})),delete L.url,L.urls=O?H[0]:H,!!H.length}}))})(E.iceServers||[],v),this._iceGatherers=[],E.iceCandidatePoolSize)for(var C=E.iceCandidatePoolSize;C>0;C--)this._iceGatherers.push(new R.RTCIceGatherer({iceServers:E.iceServers,gatherPolicy:E.iceTransportPolicy}));else E.iceCandidatePoolSize=0;this._config=E,this.transceivers=[],this._sdpSessionId=d.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(_.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(_.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),_.prototype.onicecandidate=null,_.prototype.onaddstream=null,_.prototype.ontrack=null,_.prototype.onremovestream=null,_.prototype.onsignalingstatechange=null,_.prototype.oniceconnectionstatechange=null,_.prototype.onconnectionstatechange=null,_.prototype.onicegatheringstatechange=null,_.prototype.onnegotiationneeded=null,_.prototype.ondatachannel=null,_.prototype._dispatchEvent=function(E,b){this._isClosed||(this.dispatchEvent(b),typeof this["on"+E]=="function"&&this["on"+E](b))},_.prototype._emitGatheringStateChange=function(){var E=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",E)},_.prototype.getConfiguration=function(){return this._config},_.prototype.getLocalStreams=function(){return this.localStreams},_.prototype.getRemoteStreams=function(){return this.remoteStreams},_.prototype._createTransceiver=function(E,b){var w=this.transceivers.length>0,C={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:E,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&w)C.iceTransport=this.transceivers[0].iceTransport,C.dtlsTransport=this.transceivers[0].dtlsTransport;else{var P=this._createIceAndDtlsTransports();C.iceTransport=P.iceTransport,C.dtlsTransport=P.dtlsTransport}return b||this.transceivers.push(C),C},_.prototype.addTrack=function(E,b){if(this._isClosed)throw y("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var w;if(this.transceivers.find((function(P){return P.track===E})))throw y("InvalidAccessError","Track already exists.");for(var C=0;C<this.transceivers.length;C++)this.transceivers[C].track||this.transceivers[C].kind!==E.kind||(w=this.transceivers[C]);return w||(w=this._createTransceiver(E.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(b)===-1&&this.localStreams.push(b),w.track=E,w.stream=b,w.rtpSender=new R.RTCRtpSender(E,w.dtlsTransport),w.rtpSender},_.prototype.addStream=function(E){var b=this;if(v>=15025)E.getTracks().forEach((function(C){b.addTrack(C,E)}));else{var w=E.clone();E.getTracks().forEach((function(C,P){var U=w.getTracks()[P];C.addEventListener("enabled",(function(B){U.enabled=B.enabled}))})),w.getTracks().forEach((function(C){b.addTrack(C,w)}))}},_.prototype.removeTrack=function(E){if(this._isClosed)throw y("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(E instanceof R.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var b=this.transceivers.find((function(C){return C.rtpSender===E}));if(!b)throw y("InvalidAccessError","Sender was not created by this connection.");var w=b.stream;b.rtpSender.stop(),b.rtpSender=null,b.track=null,b.stream=null,this.transceivers.map((function(C){return C.stream})).indexOf(w)===-1&&this.localStreams.indexOf(w)>-1&&this.localStreams.splice(this.localStreams.indexOf(w),1),this._maybeFireNegotiationNeeded()},_.prototype.removeStream=function(E){var b=this;E.getTracks().forEach((function(w){var C=b.getSenders().find((function(P){return P.track===w}));C&&b.removeTrack(C)}))},_.prototype.getSenders=function(){return this.transceivers.filter((function(E){return!!E.rtpSender})).map((function(E){return E.rtpSender}))},_.prototype.getReceivers=function(){return this.transceivers.filter((function(E){return!!E.rtpReceiver})).map((function(E){return E.rtpReceiver}))},_.prototype._createIceGatherer=function(E,b){var w=this;if(b&&E>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var C=new R.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(C,"state",{value:"new",writable:!0}),this.transceivers[E].bufferedCandidateEvents=[],this.transceivers[E].bufferCandidates=function(P){var U=!P.candidate||Object.keys(P.candidate).length===0;C.state=U?"completed":"gathering",w.transceivers[E].bufferedCandidateEvents!==null&&w.transceivers[E].bufferedCandidateEvents.push(P)},C.addEventListener("localcandidate",this.transceivers[E].bufferCandidates),C},_.prototype._gather=function(E,b){var w=this,C=this.transceivers[b].iceGatherer;if(!C.onlocalcandidate){var P=this.transceivers[b].bufferedCandidateEvents;this.transceivers[b].bufferedCandidateEvents=null,C.removeEventListener("localcandidate",this.transceivers[b].bufferCandidates),C.onlocalcandidate=function(U){if(!(w.usingBundle&&b>0)){var B=new Event("icecandidate");B.candidate={sdpMid:E,sdpMLineIndex:b};var L=U.candidate,H=!L||Object.keys(L).length===0;if(H)C.state!=="new"&&C.state!=="gathering"||(C.state="completed");else{C.state==="new"&&(C.state="gathering"),L.component=1,L.ufrag=C.getLocalParameters().usernameFragment;var O=d.writeCandidate(L);B.candidate=Object.assign(B.candidate,d.parseCandidate(O)),B.candidate.candidate=O,B.candidate.toJSON=function(){return{candidate:B.candidate.candidate,sdpMid:B.candidate.sdpMid,sdpMLineIndex:B.candidate.sdpMLineIndex,usernameFragment:B.candidate.usernameFragment}}}var x=d.getMediaSections(w._localDescription.sdp);x[B.candidate.sdpMLineIndex]+=H?`a=end-of-candidates\r
`:"a="+B.candidate.candidate+`\r
`,w._localDescription.sdp=d.getDescription(w._localDescription.sdp)+x.join("");var F=w.transceivers.every((function(N){return N.iceGatherer&&N.iceGatherer.state==="completed"}));w.iceGatheringState!=="gathering"&&(w.iceGatheringState="gathering",w._emitGatheringStateChange()),H||w._dispatchEvent("icecandidate",B),F&&(w._dispatchEvent("icecandidate",new Event("icecandidate")),w.iceGatheringState="complete",w._emitGatheringStateChange())}},R.setTimeout((function(){P.forEach((function(U){C.onlocalcandidate(U)}))}),0)}},_.prototype._createIceAndDtlsTransports=function(){var E=this,b=new R.RTCIceTransport(null);b.onicestatechange=function(){E._updateIceConnectionState(),E._updateConnectionState()};var w=new R.RTCDtlsTransport(b);return w.ondtlsstatechange=function(){E._updateConnectionState()},w.onerror=function(){Object.defineProperty(w,"state",{value:"failed",writable:!0}),E._updateConnectionState()},{iceTransport:b,dtlsTransport:w}},_.prototype._disposeIceAndDtlsTransports=function(E){var b=this.transceivers[E].iceGatherer;b&&(delete b.onlocalcandidate,delete this.transceivers[E].iceGatherer);var w=this.transceivers[E].iceTransport;w&&(delete w.onicestatechange,delete this.transceivers[E].iceTransport);var C=this.transceivers[E].dtlsTransport;C&&(delete C.ondtlsstatechange,delete C.onerror,delete this.transceivers[E].dtlsTransport)},_.prototype._transceive=function(E,b,w){var C=p(E.localCapabilities,E.remoteCapabilities);b&&E.rtpSender&&(C.encodings=E.sendEncodingParameters,C.rtcp={cname:d.localCName,compound:E.rtcpParameters.compound},E.recvEncodingParameters.length&&(C.rtcp.ssrc=E.recvEncodingParameters[0].ssrc),E.rtpSender.send(C)),w&&E.rtpReceiver&&C.codecs.length>0&&(E.kind==="video"&&E.recvEncodingParameters&&v<15019&&E.recvEncodingParameters.forEach((function(P){delete P.rtx})),E.recvEncodingParameters.length?C.encodings=E.recvEncodingParameters:C.encodings=[{}],C.rtcp={compound:E.rtcpParameters.compound},E.rtcpParameters.cname&&(C.rtcp.cname=E.rtcpParameters.cname),E.sendEncodingParameters.length&&(C.rtcp.ssrc=E.sendEncodingParameters[0].ssrc),E.rtpReceiver.receive(C))},_.prototype.setLocalDescription=function(E){var b,w,C=this;if(["offer","answer"].indexOf(E.type)===-1)return Promise.reject(y("TypeError",'Unsupported type "'+E.type+'"'));if(!S("setLocalDescription",E.type,C.signalingState)||C._isClosed)return Promise.reject(y("InvalidStateError","Can not set local "+E.type+" in state "+C.signalingState));if(E.type==="offer")b=d.splitSections(E.sdp),w=b.shift(),b.forEach((function(U,B){var L=d.parseRtpParameters(U);C.transceivers[B].localCapabilities=L})),C.transceivers.forEach((function(U,B){C._gather(U.mid,B)}));else if(E.type==="answer"){b=d.splitSections(C._remoteDescription.sdp),w=b.shift();var P=d.matchPrefix(w,"a=ice-lite").length>0;b.forEach((function(U,B){var L=C.transceivers[B],H=L.iceGatherer,O=L.iceTransport,x=L.dtlsTransport,F=L.localCapabilities,N=L.remoteCapabilities;if(!(d.isRejected(U)&&d.matchPrefix(U,"a=bundle-only").length===0)&&!L.rejected){var k=d.getIceParameters(U,w),M=d.getDtlsParameters(U,w);P&&(M.role="server"),C.usingBundle&&B!==0||(C._gather(L.mid,B),O.state==="new"&&O.start(H,k,P?"controlling":"controlled"),x.state==="new"&&x.start(M));var j=p(F,N);C._transceive(L,j.codecs.length>0,!1)}}))}return C._localDescription={type:E.type,sdp:E.sdp},E.type==="offer"?C._updateSignalingState("have-local-offer"):C._updateSignalingState("stable"),Promise.resolve()},_.prototype.setRemoteDescription=function(E){var b=this;if(["offer","answer"].indexOf(E.type)===-1)return Promise.reject(y("TypeError",'Unsupported type "'+E.type+'"'));if(!S("setRemoteDescription",E.type,b.signalingState)||b._isClosed)return Promise.reject(y("InvalidStateError","Can not set remote "+E.type+" in state "+b.signalingState));var w={};b.remoteStreams.forEach((function(O){w[O.id]=O}));var C=[],P=d.splitSections(E.sdp),U=P.shift(),B=d.matchPrefix(U,"a=ice-lite").length>0,L=d.matchPrefix(U,"a=group:BUNDLE ").length>0;b.usingBundle=L;var H=d.matchPrefix(U,"a=ice-options:")[0];return b.canTrickleIceCandidates=!!H&&H.substr(14).split(" ").indexOf("trickle")>=0,P.forEach((function(O,x){var F=d.splitLines(O),N=d.getKind(O),k=d.isRejected(O)&&d.matchPrefix(O,"a=bundle-only").length===0,M=F[0].substr(2).split(" ")[2],j=d.getDirection(O,U),G=d.parseMsid(O),z=d.getMid(O)||d.generateIdentifier();if(k||N==="application"&&(M==="DTLS/SCTP"||M==="UDP/DTLS/SCTP"))b.transceivers[x]={mid:z,kind:N,protocol:M,rejected:!0};else{var V,re,Q,Z,q,Y,J,$,te;!k&&b.transceivers[x]&&b.transceivers[x].rejected&&(b.transceivers[x]=b._createTransceiver(N,!0));var ie,se,he=d.parseRtpParameters(O);k||(ie=d.getIceParameters(O,U),(se=d.getDtlsParameters(O,U)).role="client"),J=d.parseRtpEncodingParameters(O);var de=d.parseRtcpParameters(O),be=d.matchPrefix(O,"a=end-of-candidates",U).length>0,Re=d.matchPrefix(O,"a=candidate:").map((function(Ie){return d.parseCandidate(Ie)})).filter((function(Ie){return Ie.component===1}));if((E.type==="offer"||E.type==="answer")&&!k&&L&&x>0&&b.transceivers[x]&&(b._disposeIceAndDtlsTransports(x),b.transceivers[x].iceGatherer=b.transceivers[0].iceGatherer,b.transceivers[x].iceTransport=b.transceivers[0].iceTransport,b.transceivers[x].dtlsTransport=b.transceivers[0].dtlsTransport,b.transceivers[x].rtpSender&&b.transceivers[x].rtpSender.setTransport(b.transceivers[0].dtlsTransport),b.transceivers[x].rtpReceiver&&b.transceivers[x].rtpReceiver.setTransport(b.transceivers[0].dtlsTransport)),E.type!=="offer"||k)E.type==="answer"&&!k&&(re=(V=b.transceivers[x]).iceGatherer,Q=V.iceTransport,Z=V.dtlsTransport,q=V.rtpReceiver,Y=V.sendEncodingParameters,$=V.localCapabilities,b.transceivers[x].recvEncodingParameters=J,b.transceivers[x].remoteCapabilities=he,b.transceivers[x].rtcpParameters=de,Re.length&&Q.state==="new"&&(!B&&!be||L&&x!==0?Re.forEach((function(Ie){T(V.iceTransport,Ie)})):Q.setRemoteCandidates(Re)),L&&x!==0||(Q.state==="new"&&Q.start(re,ie,"controlling"),Z.state==="new"&&Z.start(se)),!p(V.localCapabilities,V.remoteCapabilities).codecs.filter((function(Ie){return Ie.name.toLowerCase()==="rtx"})).length&&V.sendEncodingParameters[0].rtx&&delete V.sendEncodingParameters[0].rtx,b._transceive(V,j==="sendrecv"||j==="recvonly",j==="sendrecv"||j==="sendonly"),!q||j!=="sendrecv"&&j!=="sendonly"?delete V.rtpReceiver:(te=q.track,G?(w[G.stream]||(w[G.stream]=new R.MediaStream),h(te,w[G.stream]),C.push([te,q,w[G.stream]])):(w.default||(w.default=new R.MediaStream),h(te,w.default),C.push([te,q,w.default]))));else{(V=b.transceivers[x]||b._createTransceiver(N)).mid=z,V.iceGatherer||(V.iceGatherer=b._createIceGatherer(x,L)),Re.length&&V.iceTransport.state==="new"&&(!be||L&&x!==0?Re.forEach((function(Ie){T(V.iceTransport,Ie)})):V.iceTransport.setRemoteCandidates(Re)),$=R.RTCRtpReceiver.getCapabilities(N),v<15019&&($.codecs=$.codecs.filter((function(Ie){return Ie.name!=="rtx"}))),Y=V.sendEncodingParameters||[{ssrc:1001*(2*x+2)}];var Te,Ae=!1;j==="sendrecv"||j==="sendonly"?(Ae=!V.rtpReceiver,q=V.rtpReceiver||new R.RTCRtpReceiver(V.dtlsTransport,N),Ae&&(te=q.track,G&&G.stream==="-"||(G?(w[G.stream]||(w[G.stream]=new R.MediaStream,Object.defineProperty(w[G.stream],"id",{get:function(){return G.stream}})),Object.defineProperty(te,"id",{get:function(){return G.track}}),Te=w[G.stream]):(w.default||(w.default=new R.MediaStream),Te=w.default)),Te&&(h(te,Te),V.associatedRemoteMediaStreams.push(Te)),C.push([te,q,Te]))):V.rtpReceiver&&V.rtpReceiver.track&&(V.associatedRemoteMediaStreams.forEach((function(Ie){var Le=Ie.getTracks().find((function(Be){return Be.id===V.rtpReceiver.track.id}));Le&&(function(Be,$e){$e.removeTrack(Be),$e.dispatchEvent(new R.MediaStreamTrackEvent("removetrack",{track:Be}))})(Le,Ie)})),V.associatedRemoteMediaStreams=[]),V.localCapabilities=$,V.remoteCapabilities=he,V.rtpReceiver=q,V.rtcpParameters=de,V.sendEncodingParameters=Y,V.recvEncodingParameters=J,b._transceive(b.transceivers[x],!1,Ae)}}})),b._dtlsRole===void 0&&(b._dtlsRole=E.type==="offer"?"active":"passive"),b._remoteDescription={type:E.type,sdp:E.sdp},E.type==="offer"?b._updateSignalingState("have-remote-offer"):b._updateSignalingState("stable"),Object.keys(w).forEach((function(O){var x=w[O];if(x.getTracks().length){if(b.remoteStreams.indexOf(x)===-1){b.remoteStreams.push(x);var F=new Event("addstream");F.stream=x,R.setTimeout((function(){b._dispatchEvent("addstream",F)}))}C.forEach((function(N){var k=N[0],M=N[1];x.id===N[2].id&&m(b,k,M,[x])}))}})),C.forEach((function(O){O[2]||m(b,O[0],O[1],[])})),R.setTimeout((function(){b&&b.transceivers&&b.transceivers.forEach((function(O){O.iceTransport&&O.iceTransport.state==="new"&&O.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),O.iceTransport.addRemoteCandidate({}))}))}),4e3),Promise.resolve()},_.prototype.close=function(){this.transceivers.forEach((function(E){E.iceTransport&&E.iceTransport.stop(),E.dtlsTransport&&E.dtlsTransport.stop(),E.rtpSender&&E.rtpSender.stop(),E.rtpReceiver&&E.rtpReceiver.stop()})),this._isClosed=!0,this._updateSignalingState("closed")},_.prototype._updateSignalingState=function(E){this.signalingState=E;var b=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",b)},_.prototype._maybeFireNegotiationNeeded=function(){var E=this;this.signalingState==="stable"&&this.needNegotiation!==!0&&(this.needNegotiation=!0,R.setTimeout((function(){if(E.needNegotiation){E.needNegotiation=!1;var b=new Event("negotiationneeded");E._dispatchEvent("negotiationneeded",b)}}),0))},_.prototype._updateIceConnectionState=function(){var E,b={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(C){C.iceTransport&&!C.rejected&&b[C.iceTransport.state]++})),E="new",b.failed>0?E="failed":b.checking>0?E="checking":b.disconnected>0?E="disconnected":b.new>0?E="new":b.connected>0?E="connected":b.completed>0&&(E="completed"),E!==this.iceConnectionState){this.iceConnectionState=E;var w=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",w)}},_.prototype._updateConnectionState=function(){var E,b={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(C){C.iceTransport&&C.dtlsTransport&&!C.rejected&&(b[C.iceTransport.state]++,b[C.dtlsTransport.state]++)})),b.connected+=b.completed,E="new",b.failed>0?E="failed":b.connecting>0?E="connecting":b.disconnected>0?E="disconnected":b.new>0?E="new":b.connected>0&&(E="connected"),E!==this.connectionState){this.connectionState=E;var w=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",w)}},_.prototype.createOffer=function(){var E=this;if(E._isClosed)return Promise.reject(y("InvalidStateError","Can not call createOffer after close"));var b=E.transceivers.filter((function(B){return B.kind==="audio"})).length,w=E.transceivers.filter((function(B){return B.kind==="video"})).length,C=arguments[0];if(C){if(C.mandatory||C.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");C.offerToReceiveAudio!==void 0&&(b=C.offerToReceiveAudio===!0?1:C.offerToReceiveAudio===!1?0:C.offerToReceiveAudio),C.offerToReceiveVideo!==void 0&&(w=C.offerToReceiveVideo===!0?1:C.offerToReceiveVideo===!1?0:C.offerToReceiveVideo)}for(E.transceivers.forEach((function(B){B.kind==="audio"?--b<0&&(B.wantReceive=!1):B.kind==="video"&&--w<0&&(B.wantReceive=!1)}));b>0||w>0;)b>0&&(E._createTransceiver("audio"),b--),w>0&&(E._createTransceiver("video"),w--);var P=d.writeSessionBoilerplate(E._sdpSessionId,E._sdpSessionVersion++);E.transceivers.forEach((function(B,L){var H=B.track,O=B.kind,x=B.mid||d.generateIdentifier();B.mid=x,B.iceGatherer||(B.iceGatherer=E._createIceGatherer(L,E.usingBundle));var F=R.RTCRtpSender.getCapabilities(O);v<15019&&(F.codecs=F.codecs.filter((function(k){return k.name!=="rtx"}))),F.codecs.forEach((function(k){k.name==="H264"&&k.parameters["level-asymmetry-allowed"]===void 0&&(k.parameters["level-asymmetry-allowed"]="1"),B.remoteCapabilities&&B.remoteCapabilities.codecs&&B.remoteCapabilities.codecs.forEach((function(M){k.name.toLowerCase()===M.name.toLowerCase()&&k.clockRate===M.clockRate&&(k.preferredPayloadType=M.payloadType)}))})),F.headerExtensions.forEach((function(k){(B.remoteCapabilities&&B.remoteCapabilities.headerExtensions||[]).forEach((function(M){k.uri===M.uri&&(k.id=M.id)}))}));var N=B.sendEncodingParameters||[{ssrc:1001*(2*L+1)}];H&&v>=15019&&O==="video"&&!N[0].rtx&&(N[0].rtx={ssrc:N[0].ssrc+1}),B.wantReceive&&(B.rtpReceiver=new R.RTCRtpReceiver(B.dtlsTransport,O)),B.localCapabilities=F,B.sendEncodingParameters=N})),E._config.bundlePolicy!=="max-compat"&&(P+="a=group:BUNDLE "+E.transceivers.map((function(B){return B.mid})).join(" ")+`\r
`),P+=`a=ice-options:trickle\r
`,E.transceivers.forEach((function(B,L){P+=l(B,B.localCapabilities,"offer",B.stream,E._dtlsRole),P+=`a=rtcp-rsize\r
`,!B.iceGatherer||E.iceGatheringState==="new"||L!==0&&E.usingBundle||(B.iceGatherer.getLocalCandidates().forEach((function(H){H.component=1,P+="a="+d.writeCandidate(H)+`\r
`})),B.iceGatherer.state==="completed"&&(P+=`a=end-of-candidates\r
`))}));var U=new R.RTCSessionDescription({type:"offer",sdp:P});return Promise.resolve(U)},_.prototype.createAnswer=function(){var E=this;if(E._isClosed)return Promise.reject(y("InvalidStateError","Can not call createAnswer after close"));if(E.signalingState!=="have-remote-offer"&&E.signalingState!=="have-local-pranswer")return Promise.reject(y("InvalidStateError","Can not call createAnswer in signalingState "+E.signalingState));var b=d.writeSessionBoilerplate(E._sdpSessionId,E._sdpSessionVersion++);E.usingBundle&&(b+="a=group:BUNDLE "+E.transceivers.map((function(P){return P.mid})).join(" ")+`\r
`),b+=`a=ice-options:trickle\r
`;var w=d.getMediaSections(E._remoteDescription.sdp).length;E.transceivers.forEach((function(P,U){if(!(U+1>w)){if(P.rejected)return P.kind==="application"?P.protocol==="DTLS/SCTP"?b+=`m=application 0 DTLS/SCTP 5000\r
`:b+="m=application 0 "+P.protocol+` webrtc-datachannel\r
`:P.kind==="audio"?b+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:P.kind==="video"&&(b+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),void(b+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+P.mid+`\r
`);var B;P.stream&&(P.kind==="audio"?B=P.stream.getAudioTracks()[0]:P.kind==="video"&&(B=P.stream.getVideoTracks()[0]),B&&v>=15019&&P.kind==="video"&&!P.sendEncodingParameters[0].rtx&&(P.sendEncodingParameters[0].rtx={ssrc:P.sendEncodingParameters[0].ssrc+1}));var L=p(P.localCapabilities,P.remoteCapabilities);!L.codecs.filter((function(H){return H.name.toLowerCase()==="rtx"})).length&&P.sendEncodingParameters[0].rtx&&delete P.sendEncodingParameters[0].rtx,b+=l(P,L,"answer",P.stream,E._dtlsRole),P.rtcpParameters&&P.rtcpParameters.reducedSize&&(b+=`a=rtcp-rsize\r
`)}}));var C=new R.RTCSessionDescription({type:"answer",sdp:b});return Promise.resolve(C)},_.prototype.addIceCandidate=function(E){var b,w=this;return E&&E.sdpMLineIndex===void 0&&!E.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise((function(C,P){if(!w._remoteDescription)return P(y("InvalidStateError","Can not add ICE candidate without a remote description"));if(E&&E.candidate!==""){var U=E.sdpMLineIndex;if(E.sdpMid){for(var B=0;B<w.transceivers.length;B++)if(w.transceivers[B].mid===E.sdpMid){U=B;break}}var L=w.transceivers[U];if(!L)return P(y("OperationError","Can not add ICE candidate"));if(L.rejected)return C();var H=Object.keys(E.candidate).length>0?d.parseCandidate(E.candidate):{};if(H.protocol==="tcp"&&(H.port===0||H.port===9)||H.component&&H.component!==1)return C();if((U===0||U>0&&L.iceTransport!==w.transceivers[0].iceTransport)&&!T(L.iceTransport,H))return P(y("OperationError","Can not add ICE candidate"));var O=E.candidate.trim();O.indexOf("a=")===0&&(O=O.substr(2)),(b=d.getMediaSections(w._remoteDescription.sdp))[U]+="a="+(H.type?O:"end-of-candidates")+`\r
`,w._remoteDescription.sdp=d.getDescription(w._remoteDescription.sdp)+b.join("")}else for(var x=0;x<w.transceivers.length&&(w.transceivers[x].rejected||(w.transceivers[x].iceTransport.addRemoteCandidate({}),(b=d.getMediaSections(w._remoteDescription.sdp))[x]+=`a=end-of-candidates\r
`,w._remoteDescription.sdp=d.getDescription(w._remoteDescription.sdp)+b.join(""),!w.usingBundle));x++);C()}))},_.prototype.getStats=function(E){if(E&&E instanceof R.MediaStreamTrack){var b=null;if(this.transceivers.forEach((function(C){C.rtpSender&&C.rtpSender.track===E?b=C.rtpSender:C.rtpReceiver&&C.rtpReceiver.track===E&&(b=C.rtpReceiver)})),!b)throw y("InvalidAccessError","Invalid selector.");return b.getStats()}var w=[];return this.transceivers.forEach((function(C){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach((function(P){C[P]&&w.push(C[P].getStats())}))})),Promise.all(w).then((function(C){var P=new Map;return C.forEach((function(U){U.forEach((function(B){P.set(B.id,B)}))})),P}))},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach((function(E){var b=R[E];if(b&&b.prototype&&b.prototype.getStats){var w=b.prototype.getStats;b.prototype.getStats=function(){return w.apply(this).then((function(C){var P=new Map;return Object.keys(C).forEach((function(U){var B;C[U].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(B=C[U]).type]||B.type,P.set(U,C[U])})),P}))}}}));var A=["createOffer","createAnswer"];return A.forEach((function(E){var b=_.prototype[E];_.prototype[E]=function(){var w=arguments;return typeof w[0]=="function"||typeof w[1]=="function"?b.apply(this,[arguments[2]]).then((function(C){typeof w[0]=="function"&&w[0].apply(null,[C])}),(function(C){typeof w[1]=="function"&&w[1].apply(null,[C])})):b.apply(this,arguments)}})),(A=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach((function(E){var b=_.prototype[E];_.prototype[E]=function(){var w=arguments;return typeof w[1]=="function"||typeof w[2]=="function"?b.apply(this,arguments).then((function(){typeof w[1]=="function"&&w[1].apply(null)}),(function(C){typeof w[2]=="function"&&w[2].apply(null,[C])})):b.apply(this,arguments)}})),["getStats"].forEach((function(E){var b=_.prototype[E];_.prototype[E]=function(){var w=arguments;return typeof w[1]=="function"?b.apply(this,arguments).then((function(){typeof w[1]=="function"&&w[1].apply(null)})):b.apply(this,arguments)}})),_}},1401:g=>{var c=Object.prototype.hasOwnProperty;function s(l){return"[Throws: "+(l?l.message:"?")+"]"}function d(l){var p=[];return(function S(T){if(T===null||typeof T!="object")return T;if(p.indexOf(T)!==-1)return"[Circular]";if(p.push(T),typeof T.toJSON=="function")try{var y=S(T.toJSON());return p.pop(),y}catch(h){return s(h)}if(Array.isArray(T)){var R=T.map(S);return p.pop(),R}var v=Object.keys(T).reduce((function(h,m){return h[m]=S((function(_,A){if(c.call(_,A))try{return _[A]}catch(E){return s(E)}return _[A]})(T,m)),h}),{});return p.pop(),v})(l)}g.exports=function(l,p,S){return JSON.stringify(d(l),p,S)},g.exports.ensureProperties=d},7963:g=>{var c={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};c.localCName=c.generateIdentifier(),c.splitLines=function(s){return s.trim().split(`
`).map((function(d){return d.trim()}))},c.splitSections=function(s){return s.split(`
m=`).map((function(d,l){return(l>0?"m="+d:d).trim()+`\r
`}))},c.getDescription=function(s){var d=c.splitSections(s);return d&&d[0]},c.getMediaSections=function(s){var d=c.splitSections(s);return d.shift(),d},c.matchPrefix=function(s,d){return c.splitLines(s).filter((function(l){return l.indexOf(d)===0}))},c.parseCandidate=function(s){for(var d,l={foundation:(d=s.indexOf("a=candidate:")===0?s.substring(12).split(" "):s.substring(10).split(" "))[0],component:parseInt(d[1],10),protocol:d[2].toLowerCase(),priority:parseInt(d[3],10),ip:d[4],address:d[4],port:parseInt(d[5],10),type:d[7]},p=8;p<d.length;p+=2)switch(d[p]){case"raddr":l.relatedAddress=d[p+1];break;case"rport":l.relatedPort=parseInt(d[p+1],10);break;case"tcptype":l.tcpType=d[p+1];break;case"ufrag":l.ufrag=d[p+1],l.usernameFragment=d[p+1];break;default:l[d[p]]=d[p+1]}return l},c.writeCandidate=function(s){var d=[];d.push(s.foundation),d.push(s.component),d.push(s.protocol.toUpperCase()),d.push(s.priority),d.push(s.address||s.ip),d.push(s.port);var l=s.type;return d.push("typ"),d.push(l),l!=="host"&&s.relatedAddress&&s.relatedPort&&(d.push("raddr"),d.push(s.relatedAddress),d.push("rport"),d.push(s.relatedPort)),s.tcpType&&s.protocol.toLowerCase()==="tcp"&&(d.push("tcptype"),d.push(s.tcpType)),(s.usernameFragment||s.ufrag)&&(d.push("ufrag"),d.push(s.usernameFragment||s.ufrag)),"candidate:"+d.join(" ")},c.parseIceOptions=function(s){return s.substr(14).split(" ")},c.parseRtpMap=function(s){var d=s.substr(9).split(" "),l={payloadType:parseInt(d.shift(),10)};return d=d[0].split("/"),l.name=d[0],l.clockRate=parseInt(d[1],10),l.channels=d.length===3?parseInt(d[2],10):1,l.numChannels=l.channels,l},c.writeRtpMap=function(s){var d=s.payloadType;s.preferredPayloadType!==void 0&&(d=s.preferredPayloadType);var l=s.channels||s.numChannels||1;return"a=rtpmap:"+d+" "+s.name+"/"+s.clockRate+(l!==1?"/"+l:"")+`\r
`},c.parseExtmap=function(s){var d=s.substr(9).split(" ");return{id:parseInt(d[0],10),direction:d[0].indexOf("/")>0?d[0].split("/")[1]:"sendrecv",uri:d[1]}},c.writeExtmap=function(s){return"a=extmap:"+(s.id||s.preferredId)+(s.direction&&s.direction!=="sendrecv"?"/"+s.direction:"")+" "+s.uri+`\r
`},c.parseFmtp=function(s){for(var d,l={},p=s.substr(s.indexOf(" ")+1).split(";"),S=0;S<p.length;S++)l[(d=p[S].trim().split("="))[0].trim()]=d[1];return l},c.writeFmtp=function(s){var d="",l=s.payloadType;if(s.preferredPayloadType!==void 0&&(l=s.preferredPayloadType),s.parameters&&Object.keys(s.parameters).length){var p=[];Object.keys(s.parameters).forEach((function(S){s.parameters[S]?p.push(S+"="+s.parameters[S]):p.push(S)})),d+="a=fmtp:"+l+" "+p.join(";")+`\r
`}return d},c.parseRtcpFb=function(s){var d=s.substr(s.indexOf(" ")+1).split(" ");return{type:d.shift(),parameter:d.join(" ")}},c.writeRtcpFb=function(s){var d="",l=s.payloadType;return s.preferredPayloadType!==void 0&&(l=s.preferredPayloadType),s.rtcpFeedback&&s.rtcpFeedback.length&&s.rtcpFeedback.forEach((function(p){d+="a=rtcp-fb:"+l+" "+p.type+(p.parameter&&p.parameter.length?" "+p.parameter:"")+`\r
`})),d},c.parseSsrcMedia=function(s){var d=s.indexOf(" "),l={ssrc:parseInt(s.substr(7,d-7),10)},p=s.indexOf(":",d);return p>-1?(l.attribute=s.substr(d+1,p-d-1),l.value=s.substr(p+1)):l.attribute=s.substr(d+1),l},c.parseSsrcGroup=function(s){var d=s.substr(13).split(" ");return{semantics:d.shift(),ssrcs:d.map((function(l){return parseInt(l,10)}))}},c.getMid=function(s){var d=c.matchPrefix(s,"a=mid:")[0];if(d)return d.substr(6)},c.parseFingerprint=function(s){var d=s.substr(14).split(" ");return{algorithm:d[0].toLowerCase(),value:d[1]}},c.getDtlsParameters=function(s,d){return{role:"auto",fingerprints:c.matchPrefix(s+d,"a=fingerprint:").map(c.parseFingerprint)}},c.writeDtlsParameters=function(s,d){var l="a=setup:"+d+`\r
`;return s.fingerprints.forEach((function(p){l+="a=fingerprint:"+p.algorithm+" "+p.value+`\r
`})),l},c.parseCryptoLine=function(s){var d=s.substr(9).split(" ");return{tag:parseInt(d[0],10),cryptoSuite:d[1],keyParams:d[2],sessionParams:d.slice(3)}},c.writeCryptoLine=function(s){return"a=crypto:"+s.tag+" "+s.cryptoSuite+" "+(typeof s.keyParams=="object"?c.writeCryptoKeyParams(s.keyParams):s.keyParams)+(s.sessionParams?" "+s.sessionParams.join(" "):"")+`\r
`},c.parseCryptoKeyParams=function(s){if(s.indexOf("inline:")!==0)return null;var d=s.substr(7).split("|");return{keyMethod:"inline",keySalt:d[0],lifeTime:d[1],mkiValue:d[2]?d[2].split(":")[0]:void 0,mkiLength:d[2]?d[2].split(":")[1]:void 0}},c.writeCryptoKeyParams=function(s){return s.keyMethod+":"+s.keySalt+(s.lifeTime?"|"+s.lifeTime:"")+(s.mkiValue&&s.mkiLength?"|"+s.mkiValue+":"+s.mkiLength:"")},c.getCryptoParameters=function(s,d){return c.matchPrefix(s+d,"a=crypto:").map(c.parseCryptoLine)},c.getIceParameters=function(s,d){var l=c.matchPrefix(s+d,"a=ice-ufrag:")[0],p=c.matchPrefix(s+d,"a=ice-pwd:")[0];return l&&p?{usernameFragment:l.substr(12),password:p.substr(10)}:null},c.writeIceParameters=function(s){return"a=ice-ufrag:"+s.usernameFragment+`\r
a=ice-pwd:`+s.password+`\r
`},c.parseRtpParameters=function(s){for(var d={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},l=c.splitLines(s)[0].split(" "),p=3;p<l.length;p++){var S=l[p],T=c.matchPrefix(s,"a=rtpmap:"+S+" ")[0];if(T){var y=c.parseRtpMap(T),R=c.matchPrefix(s,"a=fmtp:"+S+" ");switch(y.parameters=R.length?c.parseFmtp(R[0]):{},y.rtcpFeedback=c.matchPrefix(s,"a=rtcp-fb:"+S+" ").map(c.parseRtcpFb),d.codecs.push(y),y.name.toUpperCase()){case"RED":case"ULPFEC":d.fecMechanisms.push(y.name.toUpperCase())}}}return c.matchPrefix(s,"a=extmap:").forEach((function(v){d.headerExtensions.push(c.parseExtmap(v))})),d},c.writeRtpDescription=function(s,d){var l="";l+="m="+s+" ",l+=d.codecs.length>0?"9":"0",l+=" UDP/TLS/RTP/SAVPF ",l+=d.codecs.map((function(S){return S.preferredPayloadType!==void 0?S.preferredPayloadType:S.payloadType})).join(" ")+`\r
`,l+=`c=IN IP4 0.0.0.0\r
`,l+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,d.codecs.forEach((function(S){l+=c.writeRtpMap(S),l+=c.writeFmtp(S),l+=c.writeRtcpFb(S)}));var p=0;return d.codecs.forEach((function(S){S.maxptime>p&&(p=S.maxptime)})),p>0&&(l+="a=maxptime:"+p+`\r
`),l+=`a=rtcp-mux\r
`,d.headerExtensions&&d.headerExtensions.forEach((function(S){l+=c.writeExtmap(S)})),l},c.parseRtpEncodingParameters=function(s){var d,l=[],p=c.parseRtpParameters(s),S=p.fecMechanisms.indexOf("RED")!==-1,T=p.fecMechanisms.indexOf("ULPFEC")!==-1,y=c.matchPrefix(s,"a=ssrc:").map((function(m){return c.parseSsrcMedia(m)})).filter((function(m){return m.attribute==="cname"})),R=y.length>0&&y[0].ssrc,v=c.matchPrefix(s,"a=ssrc-group:FID").map((function(m){return m.substr(17).split(" ").map((function(_){return parseInt(_,10)}))}));v.length>0&&v[0].length>1&&v[0][0]===R&&(d=v[0][1]),p.codecs.forEach((function(m){if(m.name.toUpperCase()==="RTX"&&m.parameters.apt){var _={ssrc:R,codecPayloadType:parseInt(m.parameters.apt,10)};R&&d&&(_.rtx={ssrc:d}),l.push(_),S&&((_=JSON.parse(JSON.stringify(_))).fec={ssrc:R,mechanism:T?"red+ulpfec":"red"},l.push(_))}})),l.length===0&&R&&l.push({ssrc:R});var h=c.matchPrefix(s,"b=");return h.length&&(h=h[0].indexOf("b=TIAS:")===0?parseInt(h[0].substr(7),10):h[0].indexOf("b=AS:")===0?1e3*parseInt(h[0].substr(5),10)*.95-16e3:void 0,l.forEach((function(m){m.maxBitrate=h}))),l},c.parseRtcpParameters=function(s){var d={},l=c.matchPrefix(s,"a=ssrc:").map((function(T){return c.parseSsrcMedia(T)})).filter((function(T){return T.attribute==="cname"}))[0];l&&(d.cname=l.value,d.ssrc=l.ssrc);var p=c.matchPrefix(s,"a=rtcp-rsize");d.reducedSize=p.length>0,d.compound=p.length===0;var S=c.matchPrefix(s,"a=rtcp-mux");return d.mux=S.length>0,d},c.parseMsid=function(s){var d,l=c.matchPrefix(s,"a=msid:");if(l.length===1)return{stream:(d=l[0].substr(7).split(" "))[0],track:d[1]};var p=c.matchPrefix(s,"a=ssrc:").map((function(S){return c.parseSsrcMedia(S)})).filter((function(S){return S.attribute==="msid"}));return p.length>0?{stream:(d=p[0].value.split(" "))[0],track:d[1]}:void 0},c.parseSctpDescription=function(s){var d,l=c.parseMLine(s),p=c.matchPrefix(s,"a=max-message-size:");p.length>0&&(d=parseInt(p[0].substr(19),10)),isNaN(d)&&(d=65536);var S=c.matchPrefix(s,"a=sctp-port:");if(S.length>0)return{port:parseInt(S[0].substr(12),10),protocol:l.fmt,maxMessageSize:d};if(c.matchPrefix(s,"a=sctpmap:").length>0){var T=c.matchPrefix(s,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(T[0],10),protocol:T[1],maxMessageSize:d}}},c.writeSctpDescription=function(s,d){var l=[];return l=s.protocol!=="DTLS/SCTP"?["m="+s.kind+" 9 "+s.protocol+" "+d.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+d.port+`\r
`]:["m="+s.kind+" 9 "+s.protocol+" "+d.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+d.port+" "+d.protocol+` 65535\r
`],d.maxMessageSize!==void 0&&l.push("a=max-message-size:"+d.maxMessageSize+`\r
`),l.join("")},c.generateSessionId=function(){return Math.random().toString().substr(2,21)},c.writeSessionBoilerplate=function(s,d,l){var p=d!==void 0?d:2;return`v=0\r
o=`+(l||"thisisadapterortc")+" "+(s||c.generateSessionId())+" "+p+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},c.writeMediaSection=function(s,d,l,p){var S=c.writeRtpDescription(s.kind,d);if(S+=c.writeIceParameters(s.iceGatherer.getLocalParameters()),S+=c.writeDtlsParameters(s.dtlsTransport.getLocalParameters(),l==="offer"?"actpass":"active"),S+="a=mid:"+s.mid+`\r
`,s.direction?S+="a="+s.direction+`\r
`:s.rtpSender&&s.rtpReceiver?S+=`a=sendrecv\r
`:s.rtpSender?S+=`a=sendonly\r
`:s.rtpReceiver?S+=`a=recvonly\r
`:S+=`a=inactive\r
`,s.rtpSender){var T="msid:"+p.id+" "+s.rtpSender.track.id+`\r
`;S+="a="+T,S+="a=ssrc:"+s.sendEncodingParameters[0].ssrc+" "+T,s.sendEncodingParameters[0].rtx&&(S+="a=ssrc:"+s.sendEncodingParameters[0].rtx.ssrc+" "+T,S+="a=ssrc-group:FID "+s.sendEncodingParameters[0].ssrc+" "+s.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return S+="a=ssrc:"+s.sendEncodingParameters[0].ssrc+" cname:"+c.localCName+`\r
`,s.rtpSender&&s.sendEncodingParameters[0].rtx&&(S+="a=ssrc:"+s.sendEncodingParameters[0].rtx.ssrc+" cname:"+c.localCName+`\r
`),S},c.getDirection=function(s,d){for(var l=c.splitLines(s),p=0;p<l.length;p++)switch(l[p]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return l[p].substr(2)}return d?c.getDirection(d):"sendrecv"},c.getKind=function(s){return c.splitLines(s)[0].split(" ")[0].substr(2)},c.isRejected=function(s){return s.split(" ",2)[1]==="0"},c.parseMLine=function(s){var d=c.splitLines(s)[0].substr(2).split(" ");return{kind:d[0],port:parseInt(d[1],10),protocol:d[2],fmt:d.slice(3).join(" ")}},c.parseOLine=function(s){var d=c.matchPrefix(s,"o=")[0].substr(2).split(" ");return{username:d[0],sessionId:d[1],sessionVersion:parseInt(d[2],10),netType:d[3],addressType:d[4],address:d[5]}},c.isValidSDP=function(s){if(typeof s!="string"||s.length===0)return!1;for(var d=c.splitLines(s),l=0;l<d.length;l++)if(d[l].length<2||d[l].charAt(1)!=="=")return!1;return!0},g.exports=c},4845:function(g,c,s){var d=this&&this.__assign||function(){return d=Object.assign||function(b){for(var w,C=1,P=arguments.length;C<P;C++)for(var U in w=arguments[C])Object.prototype.hasOwnProperty.call(w,U)&&(b[U]=w[U]);return b},d.apply(this,arguments)},l=this&&this.__importDefault||function(b){return b&&b.__esModule?b:{default:b}};Object.defineProperty(c,"__esModule",{value:!0}),c.AliRTS=void 0;var p=s(2550),S=s(9428),T=s(3412),y=s(7668),R=s(233),v=l(s(2818)),h=s(5259),m=s(7989),_=s(6420),A=s(1698),E=(function(){function b(){}return b.createClient=function(w){var C=w||{};return C.customReporter||(C.customReporter=b.customReporter),C.trackLog===void 0&&(C.trackLog=b.trackLog),A.configProvider.setContext(C),new y.RtsClient(C)},b.getMicList=function(){var w=this;return new Promise((function(C,P){w.deviceManager.getMicList().then((function(U){C(U)})).catch((function(U){P(U)}))}))},b.getCameraList=function(){var w=this;return new Promise((function(C,P){w.deviceManager.getCameraList().then((function(U){C(U)})).catch((function(U){P(U)}))}))},b.getSpeakerList=function(){var w=this;return new Promise((function(C,P){w.deviceManager.getSpeakerList().then((function(U){C(U)})).catch((function(U){P(U)}))}))},b.createStream=function(w){return new Promise((function(C,P){var U=new p.LocalStream,B=new v.default({customReporter:b.customReporter,trackLog:b.trackLog});U.init(w).then((function(){C(U),B.reportStreamCreated(w,{videoTrack:!!U.videoTrack,audioTrack:!!U.audioTrack,screenAudio:!!U.screenAudioTrack,surface:U.screenSurfaceType})})).catch((function(L){var H=d(d({},L),{relatedLink:L.extraInfo});delete H.extraInfo,P(H),B.reportErrorInfo(S.ErrorCode.ERROR_INIT_LOCAL_FAIL,L.message,L.traceId,{config:w,originErr:L})}))}))},b.deviceManager=new T.BrowserDeviceManager,b.BrowserUtil=R.BrowserUtil,b.SystenUtil=R.SystemUtil,b.SupportUtil=m.SupportUtil,b.Clock=_.Clock,b.VideoProfileMap=h.VideoProfileMap,b.ScreenProfileMap=h.ScreenProfileMap,b.AudioProfileMap=h.AudioProfileMap,b.ErrorCode=S.ErrorCode,b.customReporter=function(){},b.trackLog=!0,b})();c.AliRTS=E},7028:(g,c)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.default={version:"2.13.7",protocol_version:2,sdk_version:"0.0.1"}},9428:(g,c)=>{var s,d;Object.defineProperty(c,"__esModule",{value:!0}),c.PUB_RECONNECT_ERROR_LIST=c.RECONNECT_ERROR_EXCLUDE_LIST=c.SUB_RECONNECT_ERROR_LIST=c.DeviceErrorCode=c.ErrorCode=void 0,(function(l){l[l.ERROR_DEVICE_UNKNOWNERROR=1e4]="ERROR_DEVICE_UNKNOWNERROR",l[l.ERROR_DEVICE_AUDIODEVICE_NOTFOUND=10001]="ERROR_DEVICE_AUDIODEVICE_NOTFOUND",l[l.ERROR_DEVICE_VIDEODEVICE_NOTFOUND=10002]="ERROR_DEVICE_VIDEODEVICE_NOTFOUND",l[l.ERROR_DEVICE_NOTFOUND=10020]="ERROR_DEVICE_NOTFOUND",l[l.ERROR_DEVICE_AUDIODEVICE_NOTALLOWED=10003]="ERROR_DEVICE_AUDIODEVICE_NOTALLOWED",l[l.ERROR_DEVICE_VIDEODEVICE_NOTALLOWED=10004]="ERROR_DEVICE_VIDEODEVICE_NOTALLOWED",l[l.ERROR_DEVICE_NOTALLOWED=10021]="ERROR_DEVICE_NOTALLOWED",l[l.ERROR_DEVICE_AUDIODEVICE_NOTREADABLE=10005]="ERROR_DEVICE_AUDIODEVICE_NOTREADABLE",l[l.ERROR_DEVICE_VIDEODEVICE_NOTREADABLE=10006]="ERROR_DEVICE_VIDEODEVICE_NOTREADABLE",l[l.ERROR_DEVICE_NOTREADABLE=10022]="ERROR_DEVICE_NOTREADABLE",l[l.ERROR_DEIVCE_CONSTRAINEDERROR=10007]="ERROR_DEIVCE_CONSTRAINEDERROR",l[l.ERROR_SCREENSHARE_UNKNOWNERRO=10010]="ERROR_SCREENSHARE_UNKNOWNERRO",l[l.ERROR_SCREENSHARE_NOTALLOWED=10011]="ERROR_SCREENSHARE_NOTALLOWED",l[l.ERROR_SCREENSHARE_ENDED=10012]="ERROR_SCREENSHARE_ENDED",l[l.ERROR_SCREENSHARE_NOPERMISSION=10013]="ERROR_SCREENSHARE_NOPERMISSION",l[l.ERROR_SCREENSHARE_INVALIDACCESS=10014]="ERROR_SCREENSHARE_INVALIDACCESS",l[l.ERROR_SCREENSHARE_NOTSUPPORT=10018]="ERROR_SCREENSHARE_NOTSUPPORT",l[l.ERROR_DEVICE_NOTSUPPORT=10019]="ERROR_DEVICE_NOTSUPPORT",l[l.ERROR_SIGNAL_ERROR=10101]="ERROR_SIGNAL_ERROR",l[l.ERROR_PLAY_FAILED=10102]="ERROR_PLAY_FAILED",l[l.ERROR_NOTSUPPORT_WEBRTC=10110]="ERROR_NOTSUPPORT_WEBRTC",l[l.ERROR_BROWSER_NOTSUPPORT=10111]="ERROR_BROWSER_NOTSUPPORT",l[l.ERROR_BROWSER_VERSIONLOW=10112]="ERROR_BROWSER_VERSIONLOW",l[l.ERROR_NOTSUPPORT_H264=10113]="ERROR_NOTSUPPORT_H264",l[l.ERROR_CREATEOFFER=10114]="ERROR_CREATEOFFER",l[l.ERROR_NO_DATACHANNEL=10115]="ERROR_NO_DATACHANNEL",l[l.ERROR_INIT_LOCAL_FAIL=10116]="ERROR_INIT_LOCAL_FAIL",l[l.ERROR_HEMLELEMENT_NOTMATCH=10125]="ERROR_HEMLELEMENT_NOTMATCH",l[l.ERROR_AUTOPLAY_ERROR=10201]="ERROR_AUTOPLAY_ERROR",l[l.ERROR_PLAY_URL=10202]="ERROR_PLAY_URL",l[l.ERROR_SUBSCRIBE_NOTHING=10203]="ERROR_SUBSCRIBE_NOTHING",l[l.ERROR_HTMLELEMENT_ERROR=10204]="ERROR_HTMLELEMENT_ERROR",l[l.ERROR_HTTPREQUEST_ERROR=10205]="ERROR_HTTPREQUEST_ERROR",l[l.ERROR_ANSWER_ERROR=10206]="ERROR_ANSWER_ERROR",l[l.ERROR_INBOUND_TIMEOUT=10207]="ERROR_INBOUND_TIMEOUT",l[l.ERROR_STREAM_ENDED=10208]="ERROR_STREAM_ENDED",l[l.ERROR_PC_DISCONNECTED=10209]="ERROR_PC_DISCONNECTED",l[l.ERROR_TRANSPORT_CLOSED=10210]="ERROR_TRANSPORT_CLOSED",l[l.ERROR_SIGNAL_URL=10211]="ERROR_SIGNAL_URL",l[l.ERROR_IP_MIGRATE=10212]="ERROR_IP_MIGRATE",l[l.ERROR_PUBLISH_URL=10300]="ERROR_PUBLISH_URL",l[l.ERROR_PUBLISH_NOAUDIO=10301]="ERROR_PUBLISH_NOAUDIO",l[l.ERROR_PUBLISH_NOSTREAM=10302]="ERROR_PUBLISH_NOSTREAM",l[l.ERROR_DATACHANNEL_PARAM=10500]="ERROR_DATACHANNEL_PARAM",l[l.ERROR_DATACHANNEL_OPEN=10501]="ERROR_DATACHANNEL_OPEN",l[l.ERROR_MEDIASTREAMTRACK_TYPE_ERROR=11e3]="ERROR_MEDIASTREAMTRACK_TYPE_ERROR",l[l.ERROR_MEDIASTREAMTRACK_KIND_ERROR=11001]="ERROR_MEDIASTREAMTRACK_KIND_ERROR",l[l.ERROR_MEDIASTREAMTRACK_AUDIO_NONE=11002]="ERROR_MEDIASTREAMTRACK_AUDIO_NONE",l[l.ERROR_CUSTOMSTREAM_NONE=11003]="ERROR_CUSTOMSTREAM_NONE",l[l.ERROR_CUSTOMSTREAM_INVALID=11004]="ERROR_CUSTOMSTREAM_INVALID",l[l.ERROR_CUSTOMSTREAM_TRACK_NONE=11005]="ERROR_CUSTOMSTREAM_TRACK_NONE",l[l.ERROR_PREERCONNECTION_UNKNOWN=12e3]="ERROR_PREERCONNECTION_UNKNOWN",l[l.ERROR_SUBADD_NO_RESULT=13e3]="ERROR_SUBADD_NO_RESULT",l[l.ERROR_PUBADD_NO_RESULT=13001]="ERROR_PUBADD_NO_RESULT",l[l.ERROR_SINGLE_PC_STREAM_ERROR=13100]="ERROR_SINGLE_PC_STREAM_ERROR",l[l.ERROR_SINGLE_PC_STREAM_RECONNECT_FAILED=13101]="ERROR_SINGLE_PC_STREAM_RECONNECT_FAILED",l[l.ERROR_SINGLE_PC_FULL_RECONNECT=13102]="ERROR_SINGLE_PC_FULL_RECONNECT",l[l.ERROR_SINGLE_PC_FULL_RECONNECT_HTTP_FAILED=13103]="ERROR_SINGLE_PC_FULL_RECONNECT_HTTP_FAILED"})(s||(c.ErrorCode=s={})),(function(l){l[l.ERROR_DEVICE_UNKNOWNERROR=1e4]="ERROR_DEVICE_UNKNOWNERROR",l[l.ERROR_DEVICE_AUDIODEVICE_NOTFOUND=10001]="ERROR_DEVICE_AUDIODEVICE_NOTFOUND",l[l.ERROR_DEVICE_VIDEODEVICE_NOTFOUND=10002]="ERROR_DEVICE_VIDEODEVICE_NOTFOUND",l[l.ERROR_DEVICE_AUDIODEVICE_NOTALLOWED=10003]="ERROR_DEVICE_AUDIODEVICE_NOTALLOWED",l[l.ERROR_DEVICE_VIDEODEVICE_NOTALLOWED=10004]="ERROR_DEVICE_VIDEODEVICE_NOTALLOWED",l[l.ERROR_DEVICE_AUDIODEVICE_NOTREADABLE=10005]="ERROR_DEVICE_AUDIODEVICE_NOTREADABLE",l[l.ERROR_DEVICE_VIDEODEVICE_NOTREADABLE=10006]="ERROR_DEVICE_VIDEODEVICE_NOTREADABLE",l[l.ERROR_SCREENSHARE_NOTSUPPORT=10010]="ERROR_SCREENSHARE_NOTSUPPORT",l[l.ERROR_SCREENSHARE_NOTALLOWED=10011]="ERROR_SCREENSHARE_NOTALLOWED",l[l.ERROR_SCREENSHARE_ENDED=10012]="ERROR_SCREENSHARE_ENDED",l[l.ERROR_SCREENSHARE_NOPERMISSION=10013]="ERROR_SCREENSHARE_NOPERMISSION",l[l.ERROR_SCREENSHARE_SAFARI_INVALIDACCESS=10014]="ERROR_SCREENSHARE_SAFARI_INVALIDACCESS",l[l.ERROR_SCREENSHARE_UNKNOWNERRO=10019]="ERROR_SCREENSHARE_UNKNOWNERRO",l[l.ERROR_DEVICE_NOTSUPPORT=2e4]="ERROR_DEVICE_NOTSUPPORT"})(d||(c.DeviceErrorCode=d={})),c.SUB_RECONNECT_ERROR_LIST=[s.ERROR_INBOUND_TIMEOUT,s.ERROR_STREAM_ENDED,s.ERROR_PC_DISCONNECTED],c.RECONNECT_ERROR_EXCLUDE_LIST=[s.ERROR_AUTOPLAY_ERROR,s.ERROR_PLAY_URL,s.ERROR_SUBSCRIBE_NOTHING,s.ERROR_HTMLELEMENT_ERROR,s.ERROR_HEMLELEMENT_NOTMATCH,s.ERROR_PUBLISH_URL,s.ERROR_PUBLISH_NOAUDIO,s.ERROR_PUBLISH_NOSTREAM],c.PUB_RECONNECT_ERROR_LIST=[s.ERROR_PC_DISCONNECTED,s.ERROR_TRANSPORT_CLOSED]},5044:(g,c,s)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.RtsError=void 0;var d=s(9428),l=(function(){function p(S,T,y,R){this.errorCode=S,this.errorCodeName=d.ErrorCode[S],this.message=T,this.traceId=y,R&&(this.extraInfo=R)}return p.prototype.renameCode=function(S){this.errorCode=S,this.errorCodeName=d.ErrorCode[S]},p})();c.RtsError=l},6091:(g,c)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.PlayEvent=c.PlayType=void 0,c.PlayType={PLAY_CANPLAY:"canplay",PLAY_WAITING:"waiting",PLAY_PLAYING:"playing",PLAY_MEDIA:"media",PLAY_ENDED:"ended",PLAY_TIMEOUT:"timeout"};var s=function(d){this.event=d};c.PlayEvent=s},5917:(g,c)=>{var s,d,l,p;Object.defineProperty(c,"__esModule",{value:!0}),c.DEFAULT_RETRY_DATACHANNEL_TIMEOUT=c.DEFAULT_HEARTBEAT_TIMEOUT=c.DEFAULT_RETRY_PUBLISH_INTERVAL=c.DEFAULT_RETRY_SUBSCRIBE_INTERVAL=c.DEFAULT_RETRY_PUBLISH_LIMIT=c.DEFAULT_RETRY_SUBSCRIBE_LIMIT=c.EWorkerAction=c.EWorkerSource=c.EConnectStatus=c.TrackType=void 0,(function(S){S.AUDIO="audio",S.VIDEO="video"})(s||(c.TrackType=s={})),(function(S){S[S.CONNECT_STATUS_DISCONNECTED=0]="CONNECT_STATUS_DISCONNECTED",S[S.CONNECT_STATUS_CONNECTING=1]="CONNECT_STATUS_CONNECTING",S[S.CONNECT_STATUS_CONNECTED=2]="CONNECT_STATUS_CONNECTED",S[S.CONNECT_STATUS_RECONNECTING=3]="CONNECT_STATUS_RECONNECTING"})(d||(c.EConnectStatus=d={})),(function(S){S.Sender="sender",S.Receiver="receiver"})(l||(c.EWorkerSource=l={})),(function(S){S.Setup="setup",S.InserSEI="insertSEI",S.UpdatePubStats="updatePubStats",S.UpdateSubStats="updateSubStats",S.SwitchCumuDelay="switchCumuDelay"})(p||(c.EWorkerAction=p={})),c.DEFAULT_RETRY_SUBSCRIBE_LIMIT=5,c.DEFAULT_RETRY_PUBLISH_LIMIT=5,c.DEFAULT_RETRY_SUBSCRIBE_INTERVAL=2e3,c.DEFAULT_RETRY_PUBLISH_INTERVAL=2e3,c.DEFAULT_HEARTBEAT_TIMEOUT=8,c.DEFAULT_RETRY_DATACHANNEL_TIMEOUT=8e3},6600:function(g,c,s){var d,l=this&&this.__extends||(d=function(x,F){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(N,k){N.__proto__=k}||function(N,k){for(var M in k)Object.prototype.hasOwnProperty.call(k,M)&&(N[M]=k[M])},d(x,F)},function(x,F){if(typeof F!="function"&&F!==null)throw new TypeError("Class extends value "+String(F)+" is not a constructor or null");function N(){this.constructor=x}d(x,F),x.prototype=F===null?Object.create(F):(N.prototype=F.prototype,new N)}),p=this&&this.__assign||function(){return p=Object.assign||function(x){for(var F,N=1,k=arguments.length;N<k;N++)for(var M in F=arguments[N])Object.prototype.hasOwnProperty.call(F,M)&&(x[M]=F[M]);return x},p.apply(this,arguments)},S=this&&this.__awaiter||function(x,F,N,k){return new(N||(N=Promise))((function(M,j){function G(re){try{V(k.next(re))}catch(Q){j(Q)}}function z(re){try{V(k.throw(re))}catch(Q){j(Q)}}function V(re){var Q;re.done?M(re.value):(Q=re.value,Q instanceof N?Q:new N((function(Z){Z(Q)}))).then(G,z)}V((k=k.apply(x,F||[])).next())}))},T=this&&this.__generator||function(x,F){var N,k,M,j,G={label:0,sent:function(){if(1&M[0])throw M[1];return M[1]},trys:[],ops:[]};return j={next:z(0),throw:z(1),return:z(2)},typeof Symbol=="function"&&(j[Symbol.iterator]=function(){return this}),j;function z(V){return function(re){return(function(Q){if(N)throw new TypeError("Generator is already executing.");for(;j&&(j=0,Q[0]&&(G=0)),G;)try{if(N=1,k&&(M=2&Q[0]?k.return:Q[0]?k.throw||((M=k.return)&&M.call(k),0):k.next)&&!(M=M.call(k,Q[1])).done)return M;switch(k=0,M&&(Q=[2&Q[0],M.value]),Q[0]){case 0:case 1:M=Q;break;case 4:return G.label++,{value:Q[1],done:!1};case 5:G.label++,k=Q[1],Q=[0];continue;case 7:Q=G.ops.pop(),G.trys.pop();continue;default:if(M=G.trys,!((M=M.length>0&&M[M.length-1])||Q[0]!==6&&Q[0]!==2)){G=0;continue}if(Q[0]===3&&(!M||Q[1]>M[0]&&Q[1]<M[3])){G.label=Q[1];break}if(Q[0]===6&&G.label<M[1]){G.label=M[1],M=Q;break}if(M&&G.label<M[2]){G.label=M[2],G.ops.push(Q);break}M[2]&&G.ops.pop(),G.trys.pop();continue}Q=F.call(x,G)}catch(Z){Q=[6,Z],k=0}finally{N=M=0}if(5&Q[0])throw Q[1];return{value:Q[0]?Q[1]:void 0,done:!0}})([V,re])}}},y=this&&this.__importDefault||function(x){return x&&x.__esModule?x:{default:x}};Object.defineProperty(c,"__esModule",{value:!0}),c.CommonController=void 0;var R=s(771),v=s(5917),h=y(s(102)),m=s(9594),_=s(2718),A=s(1698),E=s(5044),b=s(9428),w=s(6091),C=s(5788),P=s(280),U=y(s(1401)),B=s(5649),L=(function(x){function F(N){var k=x.call(this)||this;return k.datachannelPool=new H,k.receiverCodecPreferences={},k.senderCodecPreferences={},k.canAutoAssignDcId=!0,k.reporter=N,k.signalChannel=new C.SignalChannel({reporter:N}),k.proxySignalChannelEvents(),k}return l(F,x),F.prototype.dispose=function(){var N;this.removeAllListeners(),this.signalChannel.dispose(),this.datachannelPool.dispose(),this.waitForOpenPms=void 0,this.receiverCodecPreferences={},this.senderCodecPreferences={},this.canAutoAssignDcId=!0,this.config=void 0,!((N=this.peerconnection)===null||N===void 0)&&N.isConnected&&this.peerconnection.reset()},F.prototype.setConfig=function(N){this.config=N},F.prototype.setPeerconnection=function(N){var k=this;N!==this.peerconnection&&(this.peerconnection&&this.peerconnection.removeAllListeners(),this.peerconnection=N,this.signalChannel.isOpen||(this.waitForOpenPms=new Promise((function(M,j){k.peerconnection.on("datachannelStatusChange",(function(G){var z;k.emit("datachannelStatusChange",G),G.status===P.EDatachannelStatus.DATACHANNEL_STATUS_OPEN&&(k.signalChannel.setPeerConnection(N),k.canAutoAssignDcId=typeof((z=k.signalChannel.datachannelCore)===null||z===void 0?void 0:z.id)=="number",M())}))}))),this.peerconnection.on("cumuDelayNotSupported",(function(){var M;k.emit("cumuDelayNotSupported"),(M=k.reporter)===null||M===void 0||M.reportCumuDelayNotSupported()})),this.peerconnection.on("innerSubscribeDeleteTracks",(function(M){k.handleWorkerSubDelete(M)})),this.peerconnection.on("encodedFrame",(function(M){var j;k.emit("encodedFrame",M),M.kind==="video"&&(0,m.parseSei)((j=M.frame)===null||j===void 0?void 0:j.data).forEach((function(G){var z;if(G.payloadType===B.CUMU_DELAY_SEI_PAYLOAD_TYPE){var V={pub:{},sub:{},grtn:{},AIPub:{},AISub:{},AIAgent:{},AIGrtn:{},other:{}},re=new B.CumuDelaySeiPayloadParser(G.data);V.pub=re.pub||{},V.sub=M.subStats||{},V.grtn=re.grtn||{},V.AIPub=re.AIPub||{},V.AISub=re.AISub||{},V.AIAgent=re.AIAgent||{},V.AIGrtn=re.AIGrtn||{},V.other=re.other||{},Object.keys(V.pub).forEach((function(Z){var q=V.pub[Z];delete V.pub[Z],V.pub[(0,_.lowercaseFirstLetter)(Z)]=q})),Object.keys(V.sub).forEach((function(Z){var q=V.sub[Z];delete V.sub[Z],V.sub[(0,_.lowercaseFirstLetter)(Z)]=q})),Object.keys(V.AIPub).forEach((function(Z){var q=V.AIPub[Z];delete V.AIPub[Z],V.AIPub[(0,_.lowercaseFirstLetter)(Z)]=q})),Object.keys(V.AISub).forEach((function(Z){var q=V.AISub[Z];delete V.AISub[Z],V.AISub[(0,_.lowercaseFirstLetter)(Z)]=q})),Object.keys(V.AIAgent).forEach((function(Z){var q=V.AIAgent[Z];delete V.AIAgent[Z],V.AIAgent[(0,_.underlineToCamelCase)(Z.toLowerCase())]=q})),Object.keys(V.AIGrtn).forEach((function(Z){var q=V.AIGrtn[Z];delete V.AIGrtn[Z],V.AIGrtn[(0,_.underlineToCamelCase)(Z.toLowerCase())]=q})),Object.keys(V.grtn).forEach((function(Z){var q=V.grtn[Z];delete V.grtn[Z],V.grtn[(0,_.underlineToCamelCase)(Z.toLowerCase())]=q}));var Q=void 0;try{Q=(0,U.default)(V)}catch(Z){console.warn(Z,V)}Q&&(G.data=new TextEncoder().encode(Q),(z=k.reporter)===null||z===void 0||z.updateCumuDelayInfo({json:Q}))}k.emit("receivedSEI",{url:M.url,vMsid:M.vMsid,sei:G})}))})),this.peerconnection.on("message",(function(M){var j;(j=k.reporter)===null||j===void 0||j.reportNotifyMessage(M)})),this.peerconnection.on("hebtReceived",(function(M){k.emit("heartbeat",M)})),this.peerconnection.on("streamError",(function(M){k.emit("onError",new E.RtsError(b.ErrorCode.ERROR_SINGLE_PC_STREAM_ERROR,M.resMsg,"",p({},M)))})),this.peerconnection.on("streamReconnect",(function(M){k.emit("reconnect",{type:M.type,reason:new E.RtsError(b.ErrorCode.ERROR_SINGLE_PC_STREAM_ERROR,M.resMsg,"",p({},M)),retryTimes:1,extraInfo:p({},M)}),k.singleStreamReconnect(M).then((function(){k.emit("reconnectFinish",{type:M.type,latestUrl:M.latestUrl,msids:M.msids})})).catch((function(j){k.emit("onError",new E.RtsError(b.ErrorCode.ERROR_SINGLE_PC_STREAM_RECONNECT_FAILED,"single stream reconnect failed","",{originError:j}))}))})),this.peerconnection.on("traceIdUpdate",(function(M){k.emit("traceId",M)})),this.peerconnection.on("pcReconnect",(function(M){k.emit("reconnect",{type:"pc",reason:new E.RtsError(b.ErrorCode.ERROR_SINGLE_PC_FULL_RECONNECT,M.reMsg,"",p({},M)),retryTimes:1,extraInfo:p({},M)})})),(this.receiverCodecPreferences.video||this.receiverCodecPreferences.audio)&&this.peerconnection.setReceiverCodecPreferences(this.receiverCodecPreferences),(this.senderCodecPreferences.video||this.senderCodecPreferences.audio)&&this.peerconnection.setSenderCodecPreferences(this.senderCodecPreferences))},Object.defineProperty(F.prototype,"peerCore",{get:function(){var N;return(N=this.peerconnection)===null||N===void 0?void 0:N.getPeerCore()},enumerable:!1,configurable:!0}),Object.defineProperty(F.prototype,"streamManager",{get:function(){var N;return(N=this.peerCore)===null||N===void 0?void 0:N.getStreamManager()},enumerable:!1,configurable:!0}),Object.defineProperty(F.prototype,"datachannelManager",{get:function(){var N;return(N=this.peerCore)===null||N===void 0?void 0:N.getDatachannelManager()},enumerable:!1,configurable:!0}),F.prototype.subscribeAdd=function(N,k){return S(this,void 0,void 0,(function(){var M,j,G,z,V,re,Q,Z,q=this;return T(this,(function(Y){switch(Y.label){case 0:if(N.forEach((function(J){var $;($=q.reporter)===null||$===void 0||$.reportSubscribeStart(J.url,"",J.vMsid,J.aMsid,!0)})),!this.peerconnection)throw this.makeRtsError("subscribeAdd");this.peerconnection.isReused=!0,M=new Date().getTime(),Y.label=1;case 1:return Y.trys.push([1,3,,4]),[4,this.peerconnection.subAdd(N,k)];case 2:if(!(j=Y.sent()).streamList)throw new E.RtsError(b.ErrorCode.ERROR_SUBADD_NO_RESULT,"subAdd streamList not found","",{api:"subscribeAdd",configList:N,response:j});return[3,4];case 3:throw G=Y.sent(),z=G,(Z=this.reporter)===null||Z===void 0||Z.reportErrorInfo(z.errorCode,z.message,z.traceId,z.extraInfo),z;case 4:return V=j.deleteRspTime-M,re=j.subAddRspTime-j.deleteRspTime,Q=j.activeRspTime-j.subAddRspTime,j.streamList.forEach((function(J,$){var te,ie,se,he;(te=q.reporter)===null||te===void 0||te.reportSubscribeOk({vurl:J.url||void 0,isSubAdd:!0});var de,be=N[$]||{},Re=be.targetStream,Te=be.vMsid,Ae=be.aMsid,Ie=J.stream;if(Re)return Re.mergeStream(Ie),(ie=q.streamManager)===null||ie===void 0||ie.update(J.url,{stream:Re,vMsid:Te?.[0],aMsid:Ae?.[0]}),void(J.stream=Re);var Le=(se=q.streamManager)===null||se===void 0?void 0:se.getStreamByMsid({url:J.url,vMsid:Te?.[0],aMsid:Ae?.[0]});if(Le)Le.mergeStream(Ie),de=Le;else{(de=new R.RemoteStream).updateMediaStream(Ie),(he=q.streamManager)===null||he===void 0||he.update(J.url,{stream:de,vMsid:Te?.[0],aMsid:Ae?.[0]}),de.on("onCanPlay",(function(){var $e,Ne,ze=new Date().getTime();($e=q.reporter)===null||$e===void 0||$e.reportFirstFrameTime(J.url,J.traceId,-1,-1,ze-M,0,-1,{},V,re,Q,Te,Ae,!0),(Ne=q.peerconnection)===null||Ne===void 0||Ne.playStart()}));var Be=new w.PlayEvent(w.PlayType.PLAY_CANPLAY);Be.data={url:J.url,vMsid:Te?.[0]||"vMsid unknown",aMsid:Ae?.[0]||"aMsid unknown"},q.emit("onPlayEvent",Be)}J.stream=de})),[2,j.streamList]}}))}))},F.prototype.subscribeActive=function(N){return S(this,void 0,void 0,(function(){var k;return T(this,(function(M){if(!this.peerconnection)throw this.makeRtsError("subscribeActive");return[2,(k=this.peerconnection)===null||k===void 0?void 0:k.subActive(N)]}))}))},F.prototype.subscribeStop=function(N){return S(this,void 0,void 0,(function(){var k,M,j,G,z;return T(this,(function(V){switch(V.label){case 0:if(!this.peerconnection)throw this.makeRtsError("subscribeStop");V.label=1;case 1:return V.trys.push([1,3,,4]),[4,this.peerconnection.subStop(N)];case 2:return k=V.sent(),this.peerconnection.getSubMonitor().updateTranceiversController(),M=this.peerconnection.getWorkerManager(),N.forEach((function(re){M.removeByUrl({url:re.url,source:v.EWorkerSource.Receiver})})),[3,4];case 3:throw j=V.sent(),G=j,(z=this.reporter)===null||z===void 0||z.reportErrorInfo(G.errorCode,G.message,G.traceId,G.extraInfo),j;case 4:return[2,k]}}))}))},F.prototype.subscribeDeleteTracks=function(N){return S(this,void 0,void 0,(function(){var k,M,j,G;return T(this,(function(z){switch(z.label){case 0:if(!this.peerconnection)throw this.makeRtsError("subscribeDeleteTracks");z.label=1;case 1:return z.trys.push([1,3,,4]),[4,this.peerconnection.subDeleteTracks(N)];case 2:if(!(k=z.sent()))throw this.makeRtsError("subscribeDeleteTracks");return this.peerconnection.getSubMonitor().updateTranceiversController(),this.handleWorkerSubDelete(N),[3,4];case 3:throw M=z.sent(),j=M,(G=this.reporter)===null||G===void 0||G.reportErrorInfo(j.errorCode,j.message,j.traceId,j.extraInfo),M;case 4:return[2,k]}}))}))},F.prototype.handleWorkerSubDelete=function(N){if(this.peerconnection){var k=this.peerconnection.getWorkerManager();N.forEach((function(M){var j,G;!((j=M.vMsid)===null||j===void 0)&&j.length&&k.removeByMsid({url:M.url,source:v.EWorkerSource.Receiver,kind:"video",msid:M.vMsid[0]}),!((G=M.aMsid)===null||G===void 0)&&G.length&&k.removeByMsid({url:M.url,source:v.EWorkerSource.Receiver,kind:"audio",msid:M.aMsid[0]})}))}},F.prototype.publishAdd=function(N){return S(this,void 0,void 0,(function(){var k,M,j,G,z,V,re,Q,Z,q,Y,J,$=this;return T(this,(function(te){switch(te.label){case 0:if(N.forEach((function(ie){var se;(se=$.reporter)===null||se===void 0||se.reportStartPublish(ie.url,"",!0)})),k=new Date().getTime(),!this.peerconnection)throw this.makeRtsError("publishAdd");te.label=1;case 1:return te.trys.push([1,3,,4]),[4,(Z=this.peerconnection)===null||Z===void 0?void 0:Z.pubAdd(N)];case 2:if(!(M=te.sent()))throw new E.RtsError(b.ErrorCode.ERROR_PUBADD_NO_RESULT,"pubAdd streamList not found","",{api:"publishAdd",publishInfoList:N});return[3,4];case 3:throw j=te.sent(),G=j,(q=this.reporter)===null||q===void 0||q.reportErrorInfo(G.errorCode,G.message,G.traceId,G.extraInfo),G;case 4:return this.peerconnection.isReused=!0,z=new Date().getTime(),V=z-k,M.forEach((function(ie){var se;(se=$.reporter)===null||se===void 0||se.reportPublishOk(ie.url||"","",-1,-1,-1,ie.traceId||"",V,!0)})),(re=(Y=this.peerconnection)===null||Y===void 0?void 0:Y.getPc())&&(N.forEach((function(ie){$.peerconnection&&ie.stream.setEncodeParam(re)})),this.peerCore&&((J=this.peerconnection)===null||J===void 0||J.getPubMonitor().startHeartbeat(re,this.peerCore)),Q=new Set,N.forEach((function(ie){ie.stream.audioTrack&&Q.add(ie.stream.audioTrack.id),ie.stream.videoTrack&&Q.add(ie.stream.videoTrack.id)})),re.getSenders().forEach((function(ie){var se;ie.track&&Q.has(ie.track.id)&&((se=$.peerconnection)===null||se===void 0||se.handleEncodedInsertableStreams({sender:ie}))}))),[2,M]}}))}))},F.prototype.publishDeleteTracks=function(N){return S(this,void 0,void 0,(function(){var k,M,j,G,z;return T(this,(function(V){switch(V.label){case 0:if(!this.peerconnection)throw this.makeRtsError("publishDeleteTracks");V.label=1;case 1:return V.trys.push([1,3,,4]),[4,this.peerconnection.pubDeleteTracks(N)];case 2:if(!(k=V.sent()))throw this.makeRtsError("publishDeleteTracks");return this.peerconnection.getPubMonitor().updateSenders(),M=this.peerconnection.getWorkerManager(),N.forEach((function(re){var Q,Z;!((Q=re.vMsid)===null||Q===void 0)&&Q.length&&M.removeByMsid({url:re.url,source:v.EWorkerSource.Sender,kind:"video",msid:re.vMsid[0]}),!((Z=re.aMsid)===null||Z===void 0)&&Z.length&&M.removeByMsid({url:re.url,source:v.EWorkerSource.Sender,kind:"audio",msid:re.aMsid[0]})})),[3,4];case 3:throw j=V.sent(),G=j,(z=this.reporter)===null||z===void 0||z.reportErrorInfo(G.errorCode,G.message,G.traceId,G.extraInfo),j;case 4:return[2,k]}}))}))},F.prototype.publishReplaceTracks=function(N){return S(this,void 0,void 0,(function(){var k,M,j,G;return T(this,(function(z){switch(z.label){case 0:if(!this.peerconnection)throw this.makeRtsError("publishReplaceTracks");z.label=1;case 1:return z.trys.push([1,3,,4]),[4,this.peerconnection.pubReplaceTracks(N)];case 2:if(!(k=z.sent()))throw this.makeRtsError("publishReplaceTracks");return this.peerconnection.getPubMonitor().updateSenders(),[3,4];case 3:throw M=z.sent(),j=M,(G=this.reporter)===null||G===void 0||G.reportErrorInfo(j.errorCode,j.message,j.traceId,j.extraInfo),M;case 4:return[2,k]}}))}))},F.prototype.publishStop=function(N){return S(this,void 0,void 0,(function(){var k,M,j,G,z,V=this;return T(this,(function(re){switch(re.label){case 0:if(N.forEach((function(Q){var Z;(Z=V.reporter)===null||Z===void 0||Z.reportStopPublish(Q.url,!0)})),!this.peerconnection)throw this.makeRtsError("publishStop");re.label=1;case 1:return re.trys.push([1,3,,4]),[4,this.peerconnection.pubStop(N)];case 2:return k=re.sent(),this.peerconnection.getPubMonitor().updateSenders(),M=this.peerconnection.getWorkerManager(),N.forEach((function(Q){M.removeByUrl({url:Q.url,source:v.EWorkerSource.Sender})})),[3,4];case 3:throw j=re.sent(),G=j,(z=this.reporter)===null||z===void 0||z.reportErrorInfo(G.errorCode,G.message,G.traceId,G.extraInfo),j;case 4:return[2,k]}}))}))},F.prototype.handleAddDatachannel=function(N){return S(this,void 0,void 0,(function(){var k,M,j,G,z,V,re,Q,Z,q,Y,J,$=this;return T(this,(function(te){switch(te.label){case 0:if(!N.url||!N.signalUrl||!N.msid)throw M=new E.RtsError(b.ErrorCode.ERROR_DATACHANNEL_PARAM,"url, signalUrl, msid is required by subscribe(publish)AddDatachannel",""),(re=this.reporter)===null||re===void 0||re.reportErrorInfo(M.errorCode,M.message,M.traceId,M.extraInfo),M;return k=N.type==="sub",this.waitForOpenPms?[4,this.waitForOpenPms]:[3,2];case 1:te.sent(),this.waitForOpenPms=void 0,te.label=2;case 2:if(this.signalChannel.isOpen)return[3,4];if(console.warn("Creating a new signal channel"),!N.signalUrl)throw M=new E.RtsError(b.ErrorCode.ERROR_SIGNAL_URL,"signal url is required",""),(Q=this.reporter)===null||Q===void 0||Q.reportErrorInfo(M.errorCode,M.message,M.traceId,M.extraInfo),M;return[4,this.initSignalChannel(N)];case 3:te.sent(),this.setPeerconnection(this.signalChannel.getPeerConnection()),this.canAutoAssignDcId=typeof((Z=this.signalChannel.datachannelCore)===null||Z===void 0?void 0:Z.id)=="number",te.label=4;case 4:if(j=performance.now(),G={url:N.url,label:N.label,surl:N.signalUrl,msid:N.msid},k?(q=this.reporter)===null||q===void 0||q.reportDatachannelSubAdd(G):(Y=this.reporter)===null||Y===void 0||Y.reportDatachannelPubAdd(G),!(z=(J=this.peerconnection)===null||J===void 0?void 0:J.getPc()))throw new Error("No avaliable peerconnection");return(V=this.datachannelPool.getIdleItem())?V.reuse():(V=new P.DataChannelCore({pc:z,label:N.label,datachannelList:this.datachannelPool.list,assignId:!this.canAutoAssignDcId,delayOpen:A.configProvider.getContext().datachannelDelayOpen,initOptions:N.initOptions}),this.datachannelPool.update(V)),[2,new Promise((function(ie,se){return S($,void 0,void 0,(function(){var he,de,be,Re,Te,Ae,Ie,Le,Be,$e,Ne,ze,Je,rt,It,dt,Ct=this;return T(this,(function(_t){switch(_t.label){case 0:he="",de=!1,be=!1,V.on("statusChange",(function(ft){var pt;(pt=Ct.reporter)===null||pt===void 0||pt.reportDatachannelStatusChange({state:P.EDatachannelStatus[ft],url:N.url,label:V.label,id:V.id,msid:N.msid}),ft===P.EDatachannelStatus.DATACHANNEL_STATUS_OPEN&&(de=!0,be&&ie({datachannel:V,traceId:he}))})),V.on("dispose",(function(){var ft;(ft=Ct.reporter)===null||ft===void 0||ft.reportDatachannelDispose({url:N.url,label:V.label,id:V.id,msid:N.msid})})),_t.label=1;case 1:return _t.trys.push([1,6,,7]),Re=[{url:N.url,msid:N.msid,datachannelId:V.id,label:N.label,datachannel:V}],k?[4,($e=this.peerCore)===null||$e===void 0?void 0:$e.subscribeAddDatachannel(Re)]:[3,3];case 2:return Ae=_t.sent(),[3,5];case 3:return[4,(Ne=this.peerCore)===null||Ne===void 0?void 0:Ne.publishAddDatachannel(Re)];case 4:Ae=_t.sent(),_t.label=5;case 5:return he=(Je=(ze=(Te=Ae)==null?void 0:Te.streams)===null||ze===void 0?void 0:ze[0])===null||Je===void 0?void 0:Je.traceid,[3,7];case 6:return Ie=_t.sent(),Le=Ie,(rt=this.reporter)===null||rt===void 0||rt.reportErrorInfo(Le.errorCode,Le.message||"datachannel ".concat(k?"sub":"pub"," add error"),Le.traceId,Le.extraInfo),[2,se(Ie)];case 7:return Be={url:N.url,drct:Math.floor(performance.now()-j),tcid:he,label:V.label,id:V.id,msid:N.msid},k?(It=this.reporter)===null||It===void 0||It.reportDatachannelSubAddOk(Be):(dt=this.reporter)===null||dt===void 0||dt.reportDatachannelPubAddOk(Be),be=!0,de&&ie({datachannel:V,traceId:he}),[2]}}))}))}))]}}))}))},F.prototype.handleDeleteDatachannel=function(N){return S(this,void 0,void 0,(function(){var k,M,j,G,z,V,re,Q,Z,q,Y,J;return T(this,(function($){switch($.label){case 0:if(!N.url||!N.datachannel)throw k=new E.RtsError(b.ErrorCode.ERROR_DATACHANNEL_PARAM,"url, datachannel is required by subscribe(publish)DeleteDatachannel",""),(z=this.reporter)===null||z===void 0||z.reportErrorInfo(k.errorCode,k.message,k.traceId,k.extraInfo),k;if(!this.signalChannel.isOpen)throw k=new E.RtsError(b.ErrorCode.ERROR_NO_DATACHANNEL,"Signal channel is closed",""),(V=this.reporter)===null||V===void 0||V.reportErrorInfo(k.errorCode,k.message,k.traceId,k.extraInfo),k;M=N.type==="sub",j=[{url:N.url,msid:N.msid}],G={url:N.url,msid:N.msid,label:N.datachannel.label,id:N.datachannel.id},M?(re=this.reporter)===null||re===void 0||re.reportDatachannelSubDelete(G):(Q=this.reporter)===null||Q===void 0||Q.reportDatachannelPubDelete(G),$.label=1;case 1:return $.trys.push([1,6,,7]),M?[4,(Z=this.peerCore)===null||Z===void 0?void 0:Z.subscribeDeleteDatachannel(j)]:[3,3];case 2:return $.sent(),[3,5];case 3:return[4,(q=this.peerCore)===null||q===void 0?void 0:q.publishDeleteDatachannel(j)];case 4:$.sent(),$.label=5;case 5:return[3,7];case 6:throw $.sent();case 7:return M?(Y=this.reporter)===null||Y===void 0||Y.reportDatachannelSubDeleteOk(G):(J=this.reporter)===null||J===void 0||J.reportDatachannelPubDeleteOk(G),N.datachannel.dispose(),[2]}}))}))},F.prototype.handleStopDatachannel=function(N){return S(this,void 0,void 0,(function(){var k,M,j,G,z,V,re,Q,Z,q,Y,J;return T(this,(function($){switch($.label){case 0:if(!N.url||!N.datachannel)throw k=new E.RtsError(b.ErrorCode.ERROR_DATACHANNEL_PARAM,"url, datachannel is required by subscribe(publish)StopDatachannel",""),(z=this.reporter)===null||z===void 0||z.reportErrorInfo(k.errorCode,k.message,k.traceId,k.extraInfo),k;if(!this.signalChannel.isOpen)throw k=new E.RtsError(b.ErrorCode.ERROR_NO_DATACHANNEL,"Signal channel is closed",""),(V=this.reporter)===null||V===void 0||V.reportErrorInfo(k.errorCode,k.message,k.traceId,k.extraInfo),k;M=N.type==="sub",j=[{url:N.url}],G={url:N.url,label:N.datachannel.label,id:N.datachannel.id},M?(re=this.reporter)===null||re===void 0||re.reportDatachannelSubStop(G):(Q=this.reporter)===null||Q===void 0||Q.reportDatachannelPubStop(G),$.label=1;case 1:return $.trys.push([1,6,,7]),M?[4,(Z=this.peerCore)===null||Z===void 0?void 0:Z.subscribeStopDatachannel(j)]:[3,3];case 2:return $.sent(),[3,5];case 3:return[4,(q=this.peerCore)===null||q===void 0?void 0:q.publishStopDatachannel(j)];case 4:$.sent(),$.label=5;case 5:return[3,7];case 6:throw $.sent();case 7:return M?(Y=this.reporter)===null||Y===void 0||Y.reportDatachannelSubStopOk(G):(J=this.reporter)===null||J===void 0||J.reportDatachannelPubStopOk(G),N.datachannel.dispose(),[2]}}))}))},F.prototype.subscribeAddDatachannel=function(N){return S(this,void 0,void 0,(function(){return T(this,(function(k){return[2,this.handleAddDatachannel(p(p({},N),{type:"sub"}))]}))}))},F.prototype.publishAddDatachannel=function(N){return S(this,void 0,void 0,(function(){return T(this,(function(k){return[2,this.handleAddDatachannel(p(p({},N),{type:"pub"}))]}))}))},F.prototype.subscribeDeleteDatachannel=function(N){return S(this,void 0,void 0,(function(){return T(this,(function(k){return[2,this.handleDeleteDatachannel(p(p({},N),{type:"sub"}))]}))}))},F.prototype.publishDeleteDatachannel=function(N){return S(this,void 0,void 0,(function(){return T(this,(function(k){return[2,this.handleDeleteDatachannel(p(p({},N),{type:"pub"}))]}))}))},F.prototype.subscribeStopDatachannel=function(N){return S(this,void 0,void 0,(function(){return T(this,(function(k){return[2,this.handleStopDatachannel(p(p({},N),{type:"sub"}))]}))}))},F.prototype.publishStopDatachannel=function(N){return S(this,void 0,void 0,(function(){return T(this,(function(k){return[2,this.handleStopDatachannel(p(p({},N),{type:"pub"}))]}))}))},F.prototype.getSubscribeVideoStats=function(N,k){return this.getSubscribeMediaStats(N,"video",k)},F.prototype.getSubscribeAudioStats=function(N,k){return this.getSubscribeMediaStats(N,"audio",k)},F.prototype.getPublishVideoStats=function(N,k){return this.getPublishMediaStats(N,"video",k)},F.prototype.getPublishAudioStats=function(N,k){return this.getPublishMediaStats(N,"audio",k)},F.prototype.sendSEI=function(N){var k,M;if(!((k=this.peerconnection)===null||k===void 0)&&k.isReused)return(M=this.peerconnection)===null||M===void 0?void 0:M.sendSEI(N)},F.prototype.setReceiverCodecPreferences=function(N){this.receiverCodecPreferences=p({},N)},F.prototype.setSenderCodecPreferences=function(N){this.senderCodecPreferences=p({},N)},F.prototype.getSubscribeMediaStats=function(N,k,M){var j=this;return new Promise((function(G){return S(j,void 0,void 0,(function(){var z,V,re,Q,Z;return T(this,(function(q){switch(q.label){case 0:return this.streamManager?(z=void 0,V=this.streamManager.getAllMediaInfoList(N,!0),M?V.forEach((function(Y){var J,$,te,ie=($=(J=Y.transceiver)===null||J===void 0?void 0:J.receiver)===null||$===void 0?void 0:$.track;ie?.kind===k&&Y.msid===M&&(z=(te=Y.transceiver)===null||te===void 0?void 0:te.receiver)})):z=(Z=(Q=V?.find((function(Y){var J,$,te;return((te=($=(J=Y.transceiver)===null||J===void 0?void 0:J.receiver)===null||$===void 0?void 0:$.track)===null||te===void 0?void 0:te.kind)===k})))===null||Q===void 0?void 0:Q.transceiver)===null||Z===void 0?void 0:Z.receiver,z?(re=!1,[4,z.getStats()]):[2,G({})]):[2,G({})];case 1:return q.sent().forEach((function(Y){Y.type==="inbound-rtp"&&(re=!0,G(Y))})),re||G({}),[2]}}))}))}))},F.prototype.getPublishMediaStats=function(N,k,M){var j=this;return new Promise((function(G){return S(j,void 0,void 0,(function(){var z,V,re,Q,Z;return T(this,(function(q){switch(q.label){case 0:return this.streamManager?(z=void 0,V=this.streamManager.getAllMediaInfoList(N,!0),M?V.forEach((function(Y){var J,$,te,ie=($=(J=Y.transceiver)===null||J===void 0?void 0:J.sender)===null||$===void 0?void 0:$.track;ie?.kind===k&&Y.msid===M&&(z=(te=Y.transceiver)===null||te===void 0?void 0:te.sender)})):z=(Z=(Q=V?.find((function(Y){var J,$,te;return((te=($=(J=Y.transceiver)===null||J===void 0?void 0:J.sender)===null||$===void 0?void 0:$.track)===null||te===void 0?void 0:te.kind)===k})))===null||Q===void 0?void 0:Q.transceiver)===null||Z===void 0?void 0:Z.sender,z?(re=!1,[4,z.getStats()]):[2,G({})]):[2,G({})];case 1:return q.sent().forEach((function(Y){Y.type==="outbound-rtp"&&G(Y)})),re||G({}),[2]}}))}))}))},F.prototype.proxySignalChannelEvents=function(){var N=this;this.signalChannel.on("connectStatusChange",(function(k){N.emit("connectStatusChange",k)})),this.signalChannel.on("onError",(function(k){N.emit("onError",k)}))},F.prototype.initSignalChannel=function(N){return this.signalChannel.createDatachannel(N)},F.prototype.makeRtsError=function(N){var k,M=new E.RtsError(b.ErrorCode.ERROR_NO_DATACHANNEL,"No avaliable datachannel, you should subscribe/publish first.","",{api:N});return(k=this.reporter)===null||k===void 0||k.reportErrorInfo(M.errorCode,M.message,M.traceId,M.extraInfo),M},F.prototype.singleStreamReconnect=function(N){var k=this;return new Promise((function(M,j){var G,z,V=N.type,re=void 0,Q=void 0;switch(V){case"sub":(G=N.streams)===null||G===void 0||G.forEach((function(q){var Y=[],J=[],$=!0,te=!0;N.msids.forEach((function(ie){ie.streamId===q.id&&(ie.type==="video"?J.push(ie.name):ie.type==="audio"&&Y.push(ie.name))})),Y.length||($=!1),J.length||(te=!1),k.subscribeAddWithRetry({url:N.latestUrl,subAudio:$,subVideo:te,vMsid:J,aMsid:Y,targetStream:q}).then(M).catch(j)}));break;case"pub":(z=N.streams)===null||z===void 0||z.forEach((function(q){var Y=[],J=[];N.msids.forEach((function($){$.streamId===q.id&&($.type==="video"?J.push($.name):$.type==="audio"&&Y.push($.name))})),k.publishAddWithRetry([{url:N.latestUrl,vMsid:J,aMsid:Y,stream:q}]).then(M).catch(j)}));break;case"pub-data":if(N.msids.forEach((function(q){re=q.name,Q=q.label})),re&&Q){var Z=N.latestUrl;k.publishAddDatachannelWithRetry({url:Z,signalUrl:Z,msid:re,label:Q}).then(M).catch(j)}break;case"sub-data":N.msids.forEach((function(q){re=q.name,Q=q.label})),re&&Q&&(Z=N.latestUrl,k.subscribeAddDatachannelWithRetry({url:Z,signalUrl:Z,msid:re,label:Q}).then(M).catch(j));break;default:console.warn("RTS PC STREAM RECONNECT: Unknown signal")}}))},F.prototype.updateAuth=function(N){var k,M,j=(k=this.streamManager)===null||k===void 0?void 0:k.updateLatestUrl(N),G=(M=this.datachannelManager)===null||M===void 0?void 0:M.updateLatestUrl(N);return j||G},F.prototype.subscribeAddWithRetry=function(N,k){var M=this;return k===void 0&&(k=0),new Promise((function(j,G){M.subscribeAdd([N],!0).then((function(){j()})).catch((function(z){return S(M,void 0,void 0,(function(){var V,re;return T(this,(function(Q){switch(Q.label){case 0:return k<(((V=this.config)===null||V===void 0?void 0:V.retryTimes)||0)?[4,O(((re=this.config)===null||re===void 0?void 0:re.retryInterval)||0)]:[3,2];case 1:return Q.sent(),[2,this.subscribeAddWithRetry(N,k+1).then(j).catch(G)];case 2:G(z),Q.label=3;case 3:return[2]}}))}))}))}))},F.prototype.publishAddWithRetry=function(N,k){var M=this;return k===void 0&&(k=0),new Promise((function(j,G){M.publishAdd(N).then((function(){j()})).catch((function(z){return S(M,void 0,void 0,(function(){var V,re;return T(this,(function(Q){switch(Q.label){case 0:return k<(((V=this.config)===null||V===void 0?void 0:V.retryTimes)||0)?[4,O(((re=this.config)===null||re===void 0?void 0:re.retryInterval)||0)]:[3,2];case 1:return Q.sent(),[2,this.publishAddWithRetry(N,k+1).then(j).catch(G)];case 2:G(z),Q.label=3;case 3:return[2]}}))}))}))}))},F.prototype.subscribeAddDatachannelWithRetry=function(N,k){var M=this;return k===void 0&&(k=0),new Promise((function(j,G){M.subscribeAddDatachannel(N).then((function(){j()})).catch((function(z){return S(M,void 0,void 0,(function(){var V,re;return T(this,(function(Q){switch(Q.label){case 0:return k<(((V=this.config)===null||V===void 0?void 0:V.retryTimes)||0)?[4,O(((re=this.config)===null||re===void 0?void 0:re.retryInterval)||0)]:[3,2];case 1:return Q.sent(),[2,this.subscribeAddDatachannelWithRetry(N,k+1).then(j).catch(G)];case 2:G(z),Q.label=3;case 3:return[2]}}))}))}))}))},F.prototype.publishAddDatachannelWithRetry=function(N,k){var M=this;return k===void 0&&(k=0),new Promise((function(j,G){M.publishAddDatachannel(N).then((function(){j()})).catch((function(z){return S(M,void 0,void 0,(function(){var V,re;return T(this,(function(Q){switch(Q.label){case 0:return k<(((V=this.config)===null||V===void 0?void 0:V.retryTimes)||0)?[4,O(((re=this.config)===null||re===void 0?void 0:re.retryInterval)||0)]:[3,2];case 1:return Q.sent(),[2,this.publishAddDatachannelWithRetry(N,k+1).then(j).catch(G)];case 2:G(z),Q.label=3;case 3:return[2]}}))}))}))}))},F})(h.default);c.CommonController=L;var H=(function(){function x(){this._list=[]}return Object.defineProperty(x.prototype,"list",{get:function(){return this._list},enumerable:!1,configurable:!0}),x.prototype.update=function(F){var N=this._list.findIndex((function(k){return k.id===F.id}));N!==-1?this._list.splice(N,1,F):this._list.push(F)},x.prototype.getIdleItem=function(){return this._list.find((function(F){return F.isIdle}))},x.prototype.dispose=function(){this._list=[]},x})();function O(x){return x===void 0&&(x=1e3),new Promise((function(F){setTimeout(F,x)}))}},9796:function(g,c,s){var d,l=this&&this.__extends||(d=function(U,B){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(L,H){L.__proto__=H}||function(L,H){for(var O in H)Object.prototype.hasOwnProperty.call(H,O)&&(L[O]=H[O])},d(U,B)},function(U,B){if(typeof B!="function"&&B!==null)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function L(){this.constructor=U}d(U,B),U.prototype=B===null?Object.create(B):(L.prototype=B.prototype,new L)}),p=this&&this.__assign||function(){return p=Object.assign||function(U){for(var B,L=1,H=arguments.length;L<H;L++)for(var O in B=arguments[L])Object.prototype.hasOwnProperty.call(B,O)&&(U[O]=B[O]);return U},p.apply(this,arguments)},S=this&&this.__awaiter||function(U,B,L,H){return new(L||(L=Promise))((function(O,x){function F(M){try{k(H.next(M))}catch(j){x(j)}}function N(M){try{k(H.throw(M))}catch(j){x(j)}}function k(M){var j;M.done?O(M.value):(j=M.value,j instanceof L?j:new L((function(G){G(j)}))).then(F,N)}k((H=H.apply(U,B||[])).next())}))},T=this&&this.__generator||function(U,B){var L,H,O,x,F={label:0,sent:function(){if(1&O[0])throw O[1];return O[1]},trys:[],ops:[]};return x={next:N(0),throw:N(1),return:N(2)},typeof Symbol=="function"&&(x[Symbol.iterator]=function(){return this}),x;function N(k){return function(M){return(function(j){if(L)throw new TypeError("Generator is already executing.");for(;x&&(x=0,j[0]&&(F=0)),F;)try{if(L=1,H&&(O=2&j[0]?H.return:j[0]?H.throw||((O=H.return)&&O.call(H),0):H.next)&&!(O=O.call(H,j[1])).done)return O;switch(H=0,O&&(j=[2&j[0],O.value]),j[0]){case 0:case 1:O=j;break;case 4:return F.label++,{value:j[1],done:!1};case 5:F.label++,H=j[1],j=[0];continue;case 7:j=F.ops.pop(),F.trys.pop();continue;default:if(O=F.trys,!((O=O.length>0&&O[O.length-1])||j[0]!==6&&j[0]!==2)){F=0;continue}if(j[0]===3&&(!O||j[1]>O[0]&&j[1]<O[3])){F.label=j[1];break}if(j[0]===6&&F.label<O[1]){F.label=O[1],O=j;break}if(O&&F.label<O[2]){F.label=O[2],F.ops.push(j);break}O[2]&&F.ops.pop(),F.trys.pop();continue}j=B.call(U,F)}catch(G){j=[6,G],H=0}finally{L=O=0}if(5&j[0])throw j[1];return{value:j[0]?j[1]:void 0,done:!0}})([k,M])}}},y=this&&this.__importDefault||function(U){return U&&U.__esModule?U:{default:U}};Object.defineProperty(c,"__esModule",{value:!0}),c.Publisher=void 0;var R=s(5917),v=s(4865),h=y(s(7028)),m=s(9428),_=s(5044),A=s(7989),E=y(s(102)),b=y(s(8219)),w=s(2718),C=y(s(1401)),P=(function(U){function B(L){var H=U.call(this)||this;return H.publishStartTimeStamp=0,H.pubReconnectTimes=0,H.isConnecting=!1,H.reconnectTimerHandle=null,H.reportMonitorTimes=0,H.reportSubFlag=!1,H.reporter=L,H.peerconnection=new v.RtsPeerconnection,H.peerconnection.on("connectStatusChange",(function(O){O.status!==R.EConnectStatus.CONNECT_STATUS_DISCONNECTED&&O.status!==R.EConnectStatus.CONNECT_STATUS_RECONNECTING||!H.hasRetries()?H.emit("connectStatusChange",O):H.emit("onError",new _.RtsError(m.ErrorCode.ERROR_PC_DISCONNECTED,"PC disconnected",""))})),H.peerconnection.on("onMonitorEvent",(function(O){var x,F=O.eventList;(x=H.peerconnection)===null||x===void 0||x.updateStatsForSEI(F,O.type),O.type==="pub"?(H.reportMonitorTimes++,H.reportMonitorTimes%4==0&&(F.forEach((function(N){H.reporter.reportPushStats(N)})),H.reportSubFlag=!0,H.reportMonitorTimes=0)):O.type==="sub"&&H.reportSubFlag&&(H.handleSubMonitorEvent(F),H.reportSubFlag=!1)})),H.peerconnection.on("onTransportStateEvent",(function(O){var x;H.peerconnection.isReused||((x=H.peerconnection.getPc())===null||x===void 0?void 0:x.connectionState)!=="closed"&&O.state==="closed"&&H.hasRetries()&&H.emit("onError",new _.RtsError(m.ErrorCode.ERROR_TRANSPORT_CLOSED,"Transport has been closed. ".concat(O.kind,"|").concat(O.type,"|").concat(O.url),"",{protocol:O.protocol}))})),H.peerconnection.on("pcReconnect",(function(O){var x,F;O.ips?(x="Migrate with ips: ".concat((0,C.default)(O.ips)),F=m.ErrorCode.ERROR_IP_MIGRATE):(x="PC disconnected",F=m.ErrorCode.ERROR_PC_DISCONNECTED),H.emit("onError",new _.RtsError(F,x,"",{pcErrorInfo:O}))})),H.signalingUrl="",H.publishUrl="",H.publishConfig={},H}return l(B,U),B.prototype.publish=function(L,H,O){var x=this;return new Promise((function(F,N){if(x.unpublish(),O?.cumuDelay&&(O.encodedInsertableStreams=!0),x.localStream=H,x.publishUrl=L,x.publishConfig=O||{},x.checkPublishUrl())if(H)if(H.audioTrack===null)N(new _.RtsError(m.ErrorCode.ERROR_PUBLISH_NOAUDIO,"publish need audiotrack",""));else{var k=O?.signalUrl;x.signalingUrl=k||x.signalingUrl,x.publishStartTimeStamp=new Date().getTime(),H.setReporter(x.reporter),x.peerconnection.createOffer(H.hasAudio,H.hasVideo||H.hasScreen,H,p(p({},O),{publishUrl:L})).then((function(M){var j=M.desp,G=M.publishTrackInfoList;x.publishTrackInfoList=G;var z=new Date().getTime();x.reporter.reportStartPublish(x.publishUrl,x.signalingUrl),x.excuteSignal(j).then((function(V){var re=new Date().getTime();x.peerconnection.recvAnswer(V.data,{answerSdpHook:O?.answerSdpHook,tcpOnly:O?.tcpOnly}).then((function(){x.reporter.reportPublishOk(x.publishUrl,x.signalingUrl,z-x.publishStartTimeStamp,re-z,new Date().getTime()-re,V.data.trace_id),F(V.data.trace_id),x.pubReconnectTimes=0,x.peerconnection.pushStart()})).catch((function(Q){Q.traceid=V.data?V.data.trace_id:"";var Z=new _.RtsError(Q.errorCode||m.ErrorCode.ERROR_ANSWER_ERROR,Q.message||"set answer error",Q.traceid,{sdp:Q.sdp});N(Z)}))})).catch((function(V){var re=new _.RtsError(V.errorCode||m.ErrorCode.ERROR_HTTPREQUEST_ERROR,V.message||"","",{response:V.response,sdp:V.sdp});N(re)}))})).catch((function(M){var j=new _.RtsError(M.errorCode||m.ErrorCode.ERROR_CREATEOFFER,M.message||"","");N(j)}))}else N(new _.RtsError(m.ErrorCode.ERROR_PUBLISH_NOSTREAM,"publish stream not found",""));else N(new _.RtsError(m.ErrorCode.ERROR_PUBLISH_URL,"url need artc://",""))}))},B.prototype.unpublish=function(){this.peerconnection.reset(),this.reporter.reportStopPublish(),this.signalingUrl="",this.publishUrl="",this.publishTrackInfoList=null},B.prototype.dispose=function(){this.removeAllListeners(),this.unpublish()},B.prototype.getTrackInfoList=function(){return this.publishTrackInfoList||[]},B.prototype.getPeerConnection=function(){return this.peerconnection},B.prototype.replaceTrack=function(L,H){return this.peerconnection.replaceTrack(this.publishUrl,L,H)},B.prototype.excuteSignal=function(L){var H,O=this,x={type:L.type,sdp:L.sdp};return this.isSingleMsid()&&(x.sdp=x.sdp.replace(/msid\:-? /g,"msid:")),!((H=this.publishConfig)===null||H===void 0)&&H.cumuDelay&&(x.sdp=x.sdp.replace(/(m=video[^\n]*\n)/,`$1a=cumudelay
`)),new Promise((function(F,N){b.default.post(O.signalingUrl,{version:h.default.protocol_version,sdk_version:h.default.sdk_version,mode:"rtc",push_stream:O.publishUrl,jsep:x}).then((function(k){var M,j,G,z;if(k&&k.status===200){F(k);try{!((M=O.publishConfig)===null||M===void 0)&&M.cumuDelay&&!(!((G=(j=k.data)===null||j===void 0?void 0:j.jsep)===null||G===void 0)&&G.sdp.includes("a=cumudelay"))&&(console.warn("Not found cumudelay in server sdp"),(z=O.reporter)===null||z===void 0||z.reportCumuDelayAnswerNotFound())}catch{}}else N({message:k?"response status:"+k.status:"response is null",sdp:x.sdp})})).catch((function(k){return S(O,void 0,void 0,(function(){var M,j;return T(this,(function(G){switch(G.label){case 0:if(![400,500].includes((j=k.response)===null||j===void 0?void 0:j.status))return[3,4];k.sdp=L.sdp,G.label=1;case 1:return G.trys.push([1,3,,4]),[4,new A.SupportUtil().isSupport({isReceiveVideo:!0})];case 2:return G.sent(),[3,4];case 3:return M=G.sent(),k.errorCode=M?.errorCode,k.message=M?.message,this.pubReconnectTimes=1/0,[3,4];case 4:return N(k),[2]}}))}))}))}))},B.prototype.checkPublishUrl=function(){if(!this.publishUrl||this.publishUrl.indexOf("artc://")!==0)return!1;var L=window.location.protocol,H=(["http:","https:"].indexOf(L)>-1?L:"https:")+"//";return this.signalingUrl=this.publishUrl.replace("artc://",H),!0},B.prototype.isSingleMsid=function(){if(!this.publishConfig)return!1;var L=this.publishConfig,H=L.vMsid,O=L.aMsid;return!(!H||!H[0]||H[0].indexOf(" ")!==-1)||!(!O||!O[0]||O[0].indexOf(" ")!==-1)},B.prototype.retryPublish=function(L,H){return S(this,void 0,void 0,(function(){var O,x,F,N,k,M,j;return T(this,(function(G){switch(G.label){case 0:if(L.extraInfo=p(p({},L.extraInfo),{retryTimes:this.pubReconnectTimes}),!this.hasRetries())return[2,!1];if(typeof(O=this.publishConfig).beforeRetry!="function")return[3,4];G.label=1;case 1:return G.trys.push([1,3,,4]),[4,O.beforeRetry({url:this.publishUrl,stream:this.localStream,vMsid:O.vMsid,aMsid:O.aMsid,useTcp:H})];case 2:return(x=G.sent())?(F=x.url,N=x.stream,k=x.vMsid,M=x.aMsid,N||(console.error("Stream is not returned by beforeRetry function."),this.pubReconnectTimes=1/0),this.reporter.reportReconnectParams("pub",F,k,M,x.useTcp,N?.id),this.publishUrl=F,this.localStream=N,this.publishConfig.vMsid=k,this.publishConfig.aMsid=M,typeof x.useTcp=="boolean"&&(H=x.useTcp),console.log(`Retry with: 
[URL] `.concat(F,`
[STREAM] `).concat(N?.id,`
[VMSID]`).concat(k," [AMSID]").concat(M,`
[PROTOCOL] `).concat(H?"TCP":"UDP"))):(this.reporter.reportReconnectParams("pub"),this.pubReconnectTimes=1/0),[3,4];case 3:return j=G.sent(),console.error("Error in beforeRetry",j),[3,4];case 4:return this.hasRetries()&&this.localStream?(this.emit("connectStatusChange",{status:R.EConnectStatus.CONNECT_STATUS_RECONNECTING}),this.incrementReconnectTimes(),L.extraInfo.retryTimes=this.pubReconnectTimes,L.extraInfo.tcpOnly=!!H,this.publishWithReconnect(this.publishUrl,this.localStream,p(p({},this.publishConfig),{tcpOnly:!!H})).catch((function(z){})),[2,!0]):(L.extraInfo.retryTimes=this.pubReconnectTimes,[2,!1])}}))}))},B.prototype.publishWithReconnect=function(L,H,O,x,F){var N=this;return new Promise((function(k,M){k=x||k,M=F||M,N.isConnecting=!0,N.publish(L,H,O).then((function(j){N.isConnecting=!1,k(j)})).catch((function(j){var G;if(N.peerconnection.reset(),!N.isConnecting)return M(j);if(!m.RECONNECT_ERROR_EXCLUDE_LIST.includes(j.errorCode)&&N.hasRetries(!0)){var z=((G=N.publishConfig)===null||G===void 0?void 0:G.retryInterval)||R.DEFAULT_RETRY_PUBLISH_INTERVAL;N.reconnectTimerHandle=setTimeout((function(){j.extraInfo=p(p({},j.extraInfo),{retryTimes:N.pubReconnectTimes}),N.emit("reconnect",j),N.publishWithReconnect(L,H,O,k,M)}),z)}else M(j),j.extraInfo=p(p({},j.extraInfo),{retryTimes:N.pubReconnectTimes}),N.isConnecting=!1,N.emit("onError",j)}))}))},B.prototype.sendSEI=function(L){var H;(H=this.peerconnection)===null||H===void 0||H.sendSEI(L)},B.prototype.hasRetries=function(L){var H,O,x=R.DEFAULT_RETRY_PUBLISH_LIMIT;typeof((H=this.publishConfig)===null||H===void 0?void 0:H.retryTimes)=="number"&&(x=Math.floor((O=this.publishConfig)===null||O===void 0?void 0:O.retryTimes));var F=this.pubReconnectTimes<x;return L&&F&&this.incrementReconnectTimes(),F},B.prototype.resetRepublishStatus=function(){this.pubReconnectTimes=0,this.isConnecting=!1,this.reporter.updateTid(),this.reconnectTimerHandle!==null&&(clearTimeout(this.reconnectTimerHandle),this.reconnectTimerHandle=null)},B.prototype.handleSubMonitorEvent=function(L){var H=this;L.forEach((function(O){var x={ct:0,tt:4e3,url:O.url},F=O.video,N=O.audio;if(F){var k=F.transportStats,M=F.inboundRtpStats,j=F.inboundRtpStatsPerSec,G=F.localCandidate,z=F.remoteCandidate;x=p(p({},x),{rtt:k?.rtt!==-1?1e3*(k?.rtt||0):-1,cand_re_prot:z.protocol,cand_lo_prot:G.protocol,cand_re_addr:"".concat(z.ip||z.address,":").concat(z.port),cand_lo_addr:"".concat(G.ip||G.address,":").concat(G.port),w:M?.frameWidth,h:M?.frameHeight,vbps:Math.floor(8*j.bytesReceivedPerSecond),fps:M?.framesPerSecond,dfps:Math.floor(j?.framesDecodedPerSecond),vjb:Math.floor((0,w.getJitterBufferDelayAvg)(M?.jitterBufferDelay,M?.jitterBufferEmittedCount)),vMsid:O.vMsid})}N&&(k=N.transportStats,M=N.inboundRtpStats,j=N.inboundRtpStatsPerSec,G=N.localCandidate,z=N.remoteCandidate,x=p(p({},x),{rtt:k?.rtt!==-1?1e3*(k?.rtt||0):-1,cand_re_prot:z.protocol,cand_lo_prot:G.protocol,cand_re_addr:"".concat(z.ip||z.address,":").concat(z.port),cand_lo_addr:"".concat(G.ip||G.address,":").concat(G.port),abps:Math.floor(8*j.bytesReceivedPerSecond),ajb:Math.floor((0,w.getJitterBufferDelayAvg)(M?.jitterBufferDelay,M.jitterBufferEmittedCount)),aMsid:O.aMsid})),H.reporter.reportPullStats(x)}))},B.prototype.incrementReconnectTimes=function(){this.pubReconnectTimes++},B.prototype.getPublishConfig=function(){return this.publishConfig},B})(E.default);c.Publisher=P},5788:function(g,c,s){var d,l=this&&this.__extends||(d=function(b,w){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(C,P){C.__proto__=P}||function(C,P){for(var U in P)Object.prototype.hasOwnProperty.call(P,U)&&(C[U]=P[U])},d(b,w)},function(b,w){if(typeof w!="function"&&w!==null)throw new TypeError("Class extends value "+String(w)+" is not a constructor or null");function C(){this.constructor=b}d(b,w),b.prototype=w===null?Object.create(w):(C.prototype=w.prototype,new C)}),p=this&&this.__awaiter||function(b,w,C,P){return new(C||(C=Promise))((function(U,B){function L(x){try{O(P.next(x))}catch(F){B(F)}}function H(x){try{O(P.throw(x))}catch(F){B(F)}}function O(x){var F;x.done?U(x.value):(F=x.value,F instanceof C?F:new C((function(N){N(F)}))).then(L,H)}O((P=P.apply(b,w||[])).next())}))},S=this&&this.__generator||function(b,w){var C,P,U,B,L={label:0,sent:function(){if(1&U[0])throw U[1];return U[1]},trys:[],ops:[]};return B={next:H(0),throw:H(1),return:H(2)},typeof Symbol=="function"&&(B[Symbol.iterator]=function(){return this}),B;function H(O){return function(x){return(function(F){if(C)throw new TypeError("Generator is already executing.");for(;B&&(B=0,F[0]&&(L=0)),L;)try{if(C=1,P&&(U=2&F[0]?P.return:F[0]?P.throw||((U=P.return)&&U.call(P),0):P.next)&&!(U=U.call(P,F[1])).done)return U;switch(P=0,U&&(F=[2&F[0],U.value]),F[0]){case 0:case 1:U=F;break;case 4:return L.label++,{value:F[1],done:!1};case 5:L.label++,P=F[1],F=[0];continue;case 7:F=L.ops.pop(),L.trys.pop();continue;default:if(U=L.trys,!((U=U.length>0&&U[U.length-1])||F[0]!==6&&F[0]!==2)){L=0;continue}if(F[0]===3&&(!U||F[1]>U[0]&&F[1]<U[3])){L.label=F[1];break}if(F[0]===6&&L.label<U[1]){L.label=U[1],U=F;break}if(U&&L.label<U[2]){L.label=U[2],L.ops.push(F);break}U[2]&&L.ops.pop(),L.trys.pop();continue}F=w.call(b,L)}catch(N){F=[6,N],P=0}finally{C=U=0}if(5&F[0])throw F[1];return{value:F[0]?F[1]:void 0,done:!0}})([O,x])}}},T=this&&this.__importDefault||function(b){return b&&b.__esModule?b:{default:b}};Object.defineProperty(c,"__esModule",{value:!0}),c.SignalChannel=void 0;var y=T(s(7028)),R=s(4865),v=T(s(102)),h=T(s(8219)),m=s(9428),_=s(5044),A=s(280),E=(function(b){function w(C){var P=b.call(this)||this;return P.reporter=C.reporter,P}return l(w,b),Object.defineProperty(w.prototype,"isOpen",{get:function(){return this.readyState==="open"},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"readyState",{get:function(){var C,P;return((C=this.peerconnection)===null||C===void 0?void 0:C.isConnected)&&((P=this.datachannelCore)===null||P===void 0?void 0:P.readyState)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"datachannelCore",{get:function(){var C,P,U;return(U=(P=(C=this.peerconnection)===null||C===void 0?void 0:C.getPeerCore())===null||P===void 0?void 0:P.getSignal())===null||U===void 0?void 0:U.getDatachannelCore()},enumerable:!1,configurable:!0}),w.prototype.getPeerConnection=function(){return this.peerconnection},w.prototype.setPeerConnection=function(C){this.peerconnection=C},w.prototype.createDatachannel=function(C){return p(this,void 0,void 0,(function(){var P,U,B,L,H,O,x,F,N,k,M,j;return S(this,(function(G){switch(G.label){case 0:if(P=C.signalUrl,!this.checkUrl(P))throw new _.RtsError(m.ErrorCode.ERROR_DATACHANNEL_PARAM,"url need artc://","");this.closeDatachannel(),this.createPC(),this.reporter.updateUrl(P),this.reporter.reportDatachannelHttpConnect(P),U=performance.now(),G.label=1;case 1:return G.trys.push([1,3,,4]),[4,(k=this.peerconnection)===null||k===void 0?void 0:k.createOffer(!1,!1,void 0,C)];case 2:return B=G.sent(),[3,4];case 3:return L=G.sent(),this.throwRtsError(new _.RtsError(L.errorCode||m.ErrorCode.ERROR_CREATEOFFER,L.message||"","")),[3,4];case 4:O="",G.label=5;case 5:return G.trys.push([5,7,,8]),[4,this.excuteSignal(B.desp)];case 6:return H=G.sent(),O=((M=H?.data)===null||M===void 0?void 0:M.trace_id)||"",this.reporter.reportDatachannelHttpConnectOk({url:P,hrct:Math.floor(performance.now()-U),tcid:O}),[3,8];case 7:return x=G.sent(),this.throwRtsError(new _.RtsError(x.errorCode||m.ErrorCode.ERROR_HTTPREQUEST_ERROR,x.message||"",O)),[3,8];case 8:return G.trys.push([8,10,,11]),[4,(j=this.peerconnection)===null||j===void 0?void 0:j.recvAnswer(H?.data,{answerSdpHook:C.answerSdpHook})];case 9:return G.sent(),[3,11];case 10:return F=G.sent(),this.throwRtsError(new _.RtsError(F.errorCode||m.ErrorCode.ERROR_ANSWER_ERROR,F.message||"set answer error",O)),[3,11];case 11:return G.trys.push([11,13,,14]),[4,this.waitForOpen()];case 12:return G.sent(),[3,14];case 13:return N=G.sent(),this.throwRtsError(new _.RtsError(m.ErrorCode.ERROR_DATACHANNEL_OPEN,"datachannel open failed: ".concat(N),O)),[3,14];case 14:return[2,O]}}))}))},w.prototype.waitForOpen=function(){var C,P=this;return new Promise((function(U,B){var L;C=window.setTimeout((function(){var O;(O=P.peerconnection)===null||O===void 0||O.off("datachannelStatusChange",H),C=void 0,B("timeout")}),5e3);var H=function(O){C&&(clearTimeout(C),C=void 0),O.status===A.EDatachannelStatus.DATACHANNEL_STATUS_OPEN?U(!0):B("status is ".concat(O.status))};(L=P.peerconnection)===null||L===void 0||L.once("datachannelStatusChange",H)}))},w.prototype.excuteSignal=function(C){return p(this,void 0,void 0,(function(){var P;return S(this,(function(U){switch(U.label){case 0:return[4,h.default.post(this.signalUrl,{version:y.default.protocol_version,sdk_version:y.default.sdk_version,mode:"live",jsep:C})];case 1:if(((P=U.sent())==null?void 0:P.status)!==200)throw new _.RtsError(m.ErrorCode.ERROR_SIGNAL_ERROR,P?"response status:"+P.status:"response is null","");return[2,P]}}))}))},w.prototype.closeDatachannel=function(){var C;(C=this.peerconnection)===null||C===void 0||C.reset()},w.prototype.dispose=function(){this.removeAllListeners()},w.prototype.checkUrl=function(C){var P="artc://";if(C&&C.indexOf(P)===0){var U=window.location.protocol,B=(["http:","https:"].indexOf(U)>-1?U:"https:")+"//";return this.signalUrl=C.replace(P,B),!0}},w.prototype.throwRtsError=function(C){throw this.emit("onError",C),C},w.prototype.createPC=function(){var C=this;this.peerconnection=new R.RtsPeerconnection,this.peerconnection.on("connectStatusChange",(function(P){C.emit("connectStatusChange",P)}))},w})(v.default);c.SignalChannel=E},2550:function(g,c,s){var d,l=this&&this.__extends||(d=function(U,B){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(L,H){L.__proto__=H}||function(L,H){for(var O in H)Object.prototype.hasOwnProperty.call(H,O)&&(L[O]=H[O])},d(U,B)},function(U,B){if(typeof B!="function"&&B!==null)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function L(){this.constructor=U}d(U,B),U.prototype=B===null?Object.create(B):(L.prototype=B.prototype,new L)}),p=this&&this.__assign||function(){return p=Object.assign||function(U){for(var B,L=1,H=arguments.length;L<H;L++)for(var O in B=arguments[L])Object.prototype.hasOwnProperty.call(B,O)&&(U[O]=B[O]);return U},p.apply(this,arguments)},S=this&&this.__awaiter||function(U,B,L,H){return new(L||(L=Promise))((function(O,x){function F(M){try{k(H.next(M))}catch(j){x(j)}}function N(M){try{k(H.throw(M))}catch(j){x(j)}}function k(M){var j;M.done?O(M.value):(j=M.value,j instanceof L?j:new L((function(G){G(j)}))).then(F,N)}k((H=H.apply(U,B||[])).next())}))},T=this&&this.__generator||function(U,B){var L,H,O,x,F={label:0,sent:function(){if(1&O[0])throw O[1];return O[1]},trys:[],ops:[]};return x={next:N(0),throw:N(1),return:N(2)},typeof Symbol=="function"&&(x[Symbol.iterator]=function(){return this}),x;function N(k){return function(M){return(function(j){if(L)throw new TypeError("Generator is already executing.");for(;x&&(x=0,j[0]&&(F=0)),F;)try{if(L=1,H&&(O=2&j[0]?H.return:j[0]?H.throw||((O=H.return)&&O.call(H),0):H.next)&&!(O=O.call(H,j[1])).done)return O;switch(H=0,O&&(j=[2&j[0],O.value]),j[0]){case 0:case 1:O=j;break;case 4:return F.label++,{value:j[1],done:!1};case 5:F.label++,H=j[1],j=[0];continue;case 7:j=F.ops.pop(),F.trys.pop();continue;default:if(O=F.trys,!((O=O.length>0&&O[O.length-1])||j[0]!==6&&j[0]!==2)){F=0;continue}if(j[0]===3&&(!O||j[1]>O[0]&&j[1]<O[3])){F.label=j[1];break}if(j[0]===6&&F.label<O[1]){F.label=O[1],O=j;break}if(O&&F.label<O[2]){F.label=O[2],F.ops.push(j);break}O[2]&&F.ops.pop(),F.trys.pop();continue}j=B.call(U,F)}catch(G){j=[6,G],H=0}finally{L=O=0}if(5&j[0])throw j[1];return{value:j[0]?j[1]:void 0,done:!0}})([k,M])}}},y=this&&this.__rest||function(U,B){var L={};for(var H in U)Object.prototype.hasOwnProperty.call(U,H)&&B.indexOf(H)<0&&(L[H]=U[H]);if(U!=null&&typeof Object.getOwnPropertySymbols=="function"){var O=0;for(H=Object.getOwnPropertySymbols(U);O<H.length;O++)B.indexOf(H[O])<0&&Object.prototype.propertyIsEnumerable.call(U,H[O])&&(L[H[O]]=U[H[O]])}return L},R=this&&this.__importDefault||function(U){return U&&U.__esModule?U:{default:U}};Object.defineProperty(c,"__esModule",{value:!0}),c.LocalStream=void 0;var v=s(5805),h=s(3412),m=s(5044),_=s(9428),A=s(5259),E=s(233),b=R(s(335)),w=s(6295),C=s(2718),P=(function(U){function B(){var L=U.call(this)||this;return L.screenSurfaceType="",L.VideoProfileMap=new Map(A.VideoProfileMap),L.ScreenProfileMap=new Map(A.ScreenProfileMap),L.AudioProfileMap=new Map(A.AudioProfileMap),L.deviceManager=new h.BrowserDeviceManager,L.mediastream=new MediaStream,L.hasVideo=!1,L.hasScreen=!1,L.videoProfile="360p_1",L.screenProfile="720p_1",L.audioProfile="standard",L.isCustomStream=!1,L.handleVideoTrackEnded=L.handleVideoTrackEnded.bind(L),L.handleAudioTrackEnded=L.handleAudioTrackEnded.bind(L),L}return l(B,U),Object.defineProperty(B.prototype,"mediaStream",{get:function(){return this.mediastream},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"audioTrack",{get:function(){return this.audiotrack},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"videoTrack",{get:function(){return this.videotrack},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"hasAudio",{get:function(){return!!this.audioTrack},enumerable:!1,configurable:!0}),B.prototype.getVideoProfile=function(){if(this.hasVideo)return this.videoProfile},B.prototype.getScreenProfile=function(){if(this.hasScreen)return this.screenProfile},B.prototype.getAudioProfile=function(){if(this.hasAudio)return this.audioProfile},B.prototype.init=function(L){return L.custom?this.createCustomStream(L.mediaStream):this.initWithRetry(L)},B.prototype.initWithRetry=function(L,H,O){var x=this;return new Promise((function(F,N){F=H||F,N=O||N;var k=[];L.audio&&L.video?k.push(x.initMicCamera(L)):(k.push(x.initMicAudio(L)),k.push(x.initCameraVideo(L))),L.video||k.push(x.initScreenVideoAudio(L)),Promise.all(k).then((function(){x.tryMixMicAndScreenAudio(L),x.initTracks(L),L.skipProfile?F():x.tryToSetProfile(L).then((function(){F()})).catch((function(M){console.log(M),x.resetLocalStream(),x.initWithRetry(p(p({},L),{skipProfile:!0}),F,N)}))})).catch((function(M){x.stopAllTracks(),N(M)}))}))},B.prototype.initMicAudio=function(L){var H=this;return new Promise((function(O,x){if(!L||!L.audio)return O();var F=typeof L.audio=="boolean"?{}:L.audio;H.deviceManager.getAudioTrack(F).then((function(N){H.micAudioTrack=N,H.audiotrack=N,O()})).catch((function(N){x(new m.RtsError(N.code,N.reason,"",N.relatedLink))}))}))},B.prototype.initCameraVideo=function(L){var H=this;return new Promise((function(O,x){if(!L||!L.video)return O();var F=typeof L.video=="boolean"?{}:L.video;H.deviceManager.getVideoTrack(F).then((function(N){H.videotrack=N,H.hasVideo=!0,O()})).catch((function(N){x(new m.RtsError(N.code,N.reason,"",N.relatedLink))}))}))},B.prototype.initMicCamera=function(L){var H=this;return new Promise((function(O,x){var F={video:L.video,audio:L.audio};H.deviceManager.getAudioVideoTracks(F).then((function(N){H.videotrack=N.find((function(k){return k.kind==="video"})),H.hasVideo=!!H.videotrack,H.audiotrack=H.micAudioTrack=N.find((function(k){return k.kind==="audio"})),O()})).catch((function(N){x(new m.RtsError(N.code,N.reason,"",N.relatedLink))}))}))},B.prototype.initScreenVideoAudio=function(L){var H=this;return new Promise((function(O,x){if(!L||!L.screen)return O();var F=!0,N=!1,k={};if(typeof L.screen!="boolean"){var M=L.screen,j=M.video,G=M.audio;k=y(M,["video","audio"]),F=typeof j!="object"||j,typeof G!="boolean"&&typeof G!="object"||(N=G)}E.SystemUtil.isMacOS&&E.BrowserUtil.isSafari&&["16.1","16.2","16.3"].indexOf(E.BrowserUtil.browserVersion)>-1&&typeof F=="object"&&(typeof F.width=="number"&&(F.width={max:F.width}),typeof F.height=="number"&&(F.height={max:F.height})),H.deviceManager.getScreenStream(p({video:F,audio:N},k)).then((function(z){H.videotrack=z.getVideoTracks()[0],H.videotrack&&H.videotrack.getSettings&&(H.screenSurfaceType=H.videotrack.getSettings().displaySurface),H.hasScreen=!0;var V=z.getAudioTracks()[0];V&&(H.screenAudioTrack=V),O()})).catch((function(z){x(new m.RtsError(z.code,z.reason,"",z.relatedLink))}))}))},B.prototype.tryMixMicAndScreenAudio=function(L){L.audio&&this.micAudioTrack&&this.hasScreenAudioConfig(L)&&this.screenAudioTrack?(this.audioMixer||(this.audioMixer=new b.default({useGainNode:!1,trackList:[]})),this.audioMixer.updateTrackList([this.screenAudioTrack,this.micAudioTrack]),this.audiotrack=this.audioMixer.getMixedAudioTrack()):L.audio&&this.micAudioTrack?this.audiotrack=this.micAudioTrack:this.hasScreenAudioConfig(L)&&this.screenAudioTrack&&(this.audiotrack=this.screenAudioTrack)},B.prototype.initTracks=function(L){this.hasAudioTrackReady(L)&&this.audiotrack&&this.mediastream.addTrack(this.audiotrack),this.hasVideoTrackReady(L)&&this.videotrack&&this.mediastream.addTrack(this.videotrack),this.addTrackListener()},B.prototype.tryToSetProfile=function(L){var H=this;return new Promise((function(O,x){return S(H,void 0,void 0,(function(){var F;return T(this,(function(N){switch(N.label){case 0:return N.trys.push([0,4,,5]),L.video?[4,this.setVideoProfile(this.videoProfile)]:[3,2];case 1:return N.sent(),[3,3];case 2:L.screen&&this.setScreenProfile(this.screenProfile).catch((function(k){console.log(k)})),N.label=3;case 3:return O(),[3,5];case 4:return F=N.sent(),x(new m.RtsError(_.ErrorCode.ERROR_DEIVCE_CONSTRAINEDERROR,"apply constraint failed","",{originErr:F,config:L})),[3,5];case 5:return[2]}}))}))}))},B.prototype.stopAllTracks=function(){this.screenAudioTrack&&(this.screenAudioTrack.stop(),this.screenAudioTrack=void 0),this.micAudioTrack&&(this.micAudioTrack.stop(),this.micAudioTrack=void 0),this.audioTrack&&(this.audioTrack.stop(),this.audiotrack=void 0),this.videoTrack&&(this.videoTrack.stop(),this.videotrack=void 0)},B.prototype.resetLocalStream=function(){this.deviceManager=new h.BrowserDeviceManager,this.mediastream=new MediaStream,this.hasVideo=!1,this.hasScreen=!1,this.videoProfile="360p_1",this.screenProfile="720p_1",this.isCustomStream=!1,this.stopAllTracks(),this.audioMixer=void 0,this.screenSurfaceType=""},B.prototype.setEncodeParam=function(L,H){var O=this;this.pc=L;var x=!1,F=!1;H?H==="video"?x=!0:H==="audio"&&(F=!0):x=F=!0,L.getSenders().forEach((function(N){var k=N.track;!k||k.kind!=="video"&&k.kind!=="audio"||(k.kind==="video"&&x&&O.setVideoEncodeParams(N),k.kind==="audio"&&F&&O.setAudioEncodeParams(N))}))},B.prototype.setVideoEncodeParams=function(L){var H,O,x;if(((H=L.track)===null||H===void 0?void 0:H.id)===((O=this.videoTrack)===null||O===void 0?void 0:O.id)&&(this.hasVideo?x=this.VideoProfileMap.get(this.videoProfile):this.hasScreen&&(x=this.ScreenProfileMap.get(this.screenProfile)),x&&L.setParameters&&L.getParameters)){var F=L.getParameters();F.degradationPreference="maintain-resolution",F.encodings.forEach((function(N){x?.maxBitrate&&(N.maxBitrate=1024*x.maxBitrate),x?.frameRate&&(N.maxFramerate=x.frameRate)})),L.setParameters(F)}},B.prototype.setAudioEncodeParams=function(L){var H,O;if(((H=L.track)===null||H===void 0?void 0:H.id)===((O=this.audioTrack)===null||O===void 0?void 0:O.id)){var x=this.AudioProfileMap.get(this.audioProfile);if(x&&L.setParameters&&L.getParameters){var F=L.getParameters();F.encodings.forEach((function(N){x.maxBitrate&&(N.maxBitrate=1024*x.maxBitrate)})),L.setParameters(F)}}},B.prototype.play=function(L,H){var O,x=this;if((O=this.reporter)===null||O===void 0||O.reportPlay(L?L.nodeName:String(L)),L&&(this.element=L,this.mediastream)){if(this.element.srcObject=this.mediastream,(E.SystemUtil.isIos&&E.SystemUtil.systemVersion.indexOf("15.1")===0&&(E.BrowserUtil.isSafari||E.BrowserUtil.isChrome||E.BrowserUtil.isMicroMessenger)||H?.canvasStream)&&this.hasVideo){if(this.canvasRenderer)return;this.canvasRenderer=new w.CanvasRenderer({video:this.element});var F=this;this.element.addEventListener("loadeddata",(function N(){if(F.element&&(F.element.removeEventListener("loadeddata",N),F.canvasRenderer)){F.canvasRenderer.start();var k=F.canvasRenderer.mediaStream;k&&(F.mediastream=k,F.videotrack=k.getVideoTracks()[0])}})),this.element.addEventListener("resize",(function(){var N;if(x){var k=x.element;k&&((N=x.canvasRenderer)===null||N===void 0||N.resize(k.videoWidth,k.videoHeight))}}))}if(H&&H.autoplay===!1)return;this.element.play()}},B.prototype.setVideoProfile=function(L){var H=this;return new Promise((function(O,x){return S(H,void 0,void 0,(function(){var F,N,k;return T(this,(function(M){switch(M.label){case 0:if((k=this.reporter)===null||k===void 0||k.reportVideoProfile(L),!(F=this.VideoProfileMap.get(L)))return[3,5];if(this.isCustomStream||!this.hasVideo||!this.videotrack||!this.videotrack.applyConstraints)return[3,4];M.label=1;case 1:return M.trys.push([1,3,,4]),[4,this.videotrack.applyConstraints(F)];case 2:return M.sent(),[3,4];case 3:return N=M.sent(),[2,x(N)];case 4:return this.videoProfile=L,this.pc&&this.setEncodeParam(this.pc,"video"),O(this.videoProfile),[3,6];case 5:x("Profile not found"),M.label=6;case 6:return[2]}}))}))}))},B.prototype.setScreenProfile=function(L){var H=this;return new Promise((function(O,x){return S(H,void 0,void 0,(function(){var F,N,k;return T(this,(function(M){switch(M.label){case 0:if((k=this.reporter)===null||k===void 0||k.reportScreenProfile(L),!(F=this.ScreenProfileMap.get(L)))return[3,5];if(!(this.hasScreen&&this.videotrack&&this.videotrack.applyConstraints))return[3,4];M.label=1;case 1:return M.trys.push([1,3,,4]),[4,this.videotrack.applyConstraints(F)];case 2:return M.sent(),[3,4];case 3:return N=M.sent(),[2,x(N)];case 4:return this.screenProfile=L,this.pc&&this.setEncodeParam(this.pc,"video"),O(this.screenProfile),[3,6];case 5:x("Profile not found"),M.label=6;case 6:return[2]}}))}))}))},B.prototype.setAudioProfile=function(L){var H=this;return new Promise((function(O,x){return S(H,void 0,void 0,(function(){var F,N,k;return T(this,(function(M){switch(M.label){case 0:if((k=this.reporter)===null||k===void 0||k.reportAudioProfile(L),!(F=this.AudioProfileMap.get(L)))return[3,5];if(this.isCustomStream||!this.hasAudio||!this.audioTrack||!this.audioTrack.applyConstraints)return[3,4];M.label=1;case 1:return M.trys.push([1,3,,4]),[4,this.audioTrack.applyConstraints(F)];case 2:return M.sent(),[3,4];case 3:return N=M.sent(),[2,x(N)];case 4:return this.audioProfile=L,this.pc&&this.setEncodeParam(this.pc,"audio"),O(this.audioProfile),[3,6];case 5:x("Profile not found"),M.label=6;case 6:return[2]}}))}))}))},B.prototype.enableAudio=function(){var L;return(L=this.reporter)===null||L===void 0||L.reportEnableAudio(),!!this.audiotrack&&(this.audiotrack.enabled=!0,!0)},B.prototype.disableAudio=function(){var L;return(L=this.reporter)===null||L===void 0||L.reportDisableAudio(),!!this.audiotrack&&(this.audiotrack.enabled=!1,!0)},B.prototype.enableVideo=function(){var L;return(L=this.reporter)===null||L===void 0||L.reportEnableVideo(),!!this.videotrack&&(this.videotrack.enabled=!0,!0)},B.prototype.disableVideo=function(){var L;return(L=this.reporter)===null||L===void 0||L.reportDisableVideo(),!!this.videotrack&&(this.videotrack.enabled=!1,!0)},B.prototype.stop=function(){var L;U.prototype.stop.call(this),this.hasVideo=!1,this.hasScreen=!1,this.isCustomStream=!1,this.canvasRenderer&&(this.canvasRenderer.stop(),this.canvasRenderer=void 0),this.audiotrack&&(this.audiotrack.stop(),this.audiotrack=void 0),this.videotrack&&(this.videotrack.stop(),this.videotrack=void 0),this.micAudioTrack&&(this.micAudioTrack.stop(),this.micAudioTrack=void 0),this.screenAudioTrack&&(this.screenAudioTrack.stop(),this.screenAudioTrack=void 0),(L=this.reporter)===null||L===void 0||L.reportStop(0)},B.prototype.mergeStream=function(L){var H=L.videoTrack,O=L.audioTrack;H&&(this.videoTrack&&(this.videoTrack.removeEventListener("ended",this.handleVideoTrackEnded),this.mediaStream.removeTrack(this.videoTrack)),this.mediaStream.addTrack(H),this.videotrack=H,this.listenVideoEnded(),this.hasVideo=L.hasVideo,this.hasScreen=L.hasScreen,this.isCustomStream=L.isCustomStream,this.hasVideo&&(this.videoProfile=L.videoProfile),this.hasScreen&&(this.screenProfile=L.screenProfile)),O&&(this.audioTrack&&(this.audioTrack.removeEventListener("ended",this.handleAudioTrackEnded),this.mediaStream.removeTrack(this.audioTrack)),this.mediaStream.addTrack(O),this.audiotrack=O,this.listenAudioEnded())},B.prototype.deleteTracks=function(L){L.audio&&this.audioTrack&&(this.mediaStream.removeTrack(this.audioTrack),this.audiotrack=void 0),L.video&&this.videoTrack&&(this.mediaStream.removeTrack(this.videoTrack),this.videotrack=void 0,this.hasScreen=!1,this.hasVideo=!1)},B.prototype.createCustomStream=function(L){var H=this;return new Promise((function(O,x){if(!L)return x(new m.RtsError(_.ErrorCode.ERROR_CUSTOMSTREAM_NONE,"MediaStream is required.",""));if(!(L instanceof MediaStream))return x(new m.RtsError(_.ErrorCode.ERROR_CUSTOMSTREAM_INVALID,"MediaStream is invalid.",""));if(L.getTracks().length===0)return x(new m.RtsError(_.ErrorCode.ERROR_CUSTOMSTREAM_TRACK_NONE,"MediaStream has no track.",""));var F=(0,C.getVideoTrack)(L),N=(0,C.getAudioTrack)(L);F&&(H.hasVideo=!0,H.videotrack=F,H.mediastream.addTrack(F)),N&&(H.audiotrack=N,H.mediastream.addTrack(N)),H.isCustomStream=!0,H.setVideoProfile(H.videoProfile),H.addTrackListener(),O()}))},B.prototype.releaseMediaStream=function(){var L=this;this.mediastream.getTracks().forEach((function(H){H.stop(),L.mediastream.removeTrack(H)}))},B.prototype.hasVideoTrackReady=function(L){return!(!L.video&&!L.screen||!this.videotrack)||!L.video&&!L.screen},B.prototype.hasScreenAudioConfig=function(L){return typeof L.screen=="object"&&L.screen.audio},B.prototype.hasAudioTrackReady=function(L){return!(L.audio&&(!this.hasMicAudioAndReady(L)&&!this.hasScreenAudioAndReady(L)||!this.audiotrack))},B.prototype.hasMicAudioAndReady=function(L){return L.audio&&this.micAudioTrack},B.prototype.hasScreenAudioAndReady=function(L){return this.hasScreenAudioConfig(L)&&this.screenAudioTrack},B.prototype.addTrackListener=function(){this.listenVideoEnded(),this.listenAudioEnded()},B.prototype.listenVideoEnded=function(){var L=this;this.videotrack&&this.videotrack.addEventListener("ended",this.handleVideoTrackEnded),this.micAudioTrack&&this.micAudioTrack.addEventListener("ended",(function(){var H;L.emit("micAudioTrackEnded"),L.screenAudioTrack&&L.screenAudioTrack.readyState==="ended"&&((H=L.audioMixer)===null||H===void 0||H.destroy(),L.emit("audioTrackEnded"))})),this.screenAudioTrack&&this.screenAudioTrack.addEventListener("ended",(function(){var H;L.emit("screenAudioTrackEnded"),L.micAudioTrack&&L.micAudioTrack.readyState==="ended"&&((H=L.audioMixer)===null||H===void 0||H.destroy(),L.emit("audioTrackEnded"))}))},B.prototype.listenAudioEnded=function(){this.audiotrack&&this.audiotrack.addEventListener("ended",this.handleAudioTrackEnded)},B.prototype.handleVideoTrackEnded=function(){this.hasScreen=!1,this.hasVideo=!1,this.emit("videoTrackEnded")},B.prototype.handleAudioTrackEnded=function(){this.emit("audioTrackEnded")},B})(v.Stream);c.LocalStream=P},771:function(g,c,s){var d,l=this&&this.__extends||(d=function(v,h){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,_){m.__proto__=_}||function(m,_){for(var A in _)Object.prototype.hasOwnProperty.call(_,A)&&(m[A]=_[A])},d(v,h)},function(v,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");function m(){this.constructor=v}d(v,h),v.prototype=h===null?Object.create(h):(m.prototype=h.prototype,new m)});Object.defineProperty(c,"__esModule",{value:!0}),c.RemoteStream=void 0;var p=s(5805),S=s(233),T=s(5044),y=s(9428),R=(function(v){function h(){var m=v.call(this)||this;return m.recvCanPlay=!1,m.autoplay=!0,m.onCanPlay=m.onCanPlay.bind(m),m}return l(h,v),Object.defineProperty(h.prototype,"muted",{get:function(){return!!this.element&&this.element.muted},set:function(m){this.element&&(this.element.muted=m)},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"audioTrack",{get:function(){var m;return(m=this.mediastream)===null||m===void 0?void 0:m.getAudioTracks()[0]},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"videoTrack",{get:function(){var m;return(m=this.mediastream)===null||m===void 0?void 0:m.getVideoTracks()[0]},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"hasVideo",{get:function(){return!!this.videoTrack},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"hasAudio",{get:function(){return!!this.audioTrack},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"mediaStream",{get:function(){return this.mediastream},enumerable:!1,configurable:!0}),h.prototype.updateMediaStream=function(m){var _=this.mediastream||new MediaStream;m.getTracks().forEach((function(A){return _.addTrack(A)})),this.mediastream=_,this.element&&this.play(this.element)},h.prototype.getMediaStream=function(){return this.mediastream},h.prototype.mergeStream=function(m){if(this.mediaStream){var _=m.getVideoTracks()[0],A=m.getAudioTracks()[0];_&&(this.videoTrack&&this.mediaStream.removeTrack(this.videoTrack),this.mediaStream.addTrack(_),this.videotrack=_),A&&(this.audioTrack&&this.mediaStream.removeTrack(this.audioTrack),this.mediaStream.addTrack(A),this.audiotrack=A)}},h.prototype.play=function(m,_){if(this.autoplay=!!(!_||_.autoplay),m){if(!(m instanceof HTMLMediaElement))throw new T.RtsError(y.ErrorCode.ERROR_HTMLELEMENT_ERROR,"Param is not a HTMLMediaElement","",{element:m});this.recvCanPlay=!1,this.emit("mediaElementBinded"),this.element=m,this.element.addEventListener("canplay",this.onCanPlay);var A=this.mediaStream;this.element.addEventListener("playing",(function E(){m.removeEventListener("playing",E),S.SystemUtil.isIos&&parseInt(S.SystemUtil.systemVersion)<=13&&!m.muted&&A?.getAudioTracks().length&&(m.pause(),m.play())})),this.element.nodeName==="VIDEO"&&(this.element.setAttribute("playsinline",""),S.BrowserUtil.isMicroMessenger&&(this.element.setAttribute("x5-video-player-type","h5-page"),this.element.setAttribute("x5-playsinline",""),S.SystemUtil.isAndroid||S.SystemUtil.isIos&&this.element.setAttribute("x-webkit-airplay","allow"))),this.autoplay&&S.BrowserUtil.isSafari&&this.element.setAttribute("autoplay",""),this.mediastream&&this.bindMediaStream(this.mediastream)}else this.release()},h.prototype.disableVideo=function(){var m=this.getMediaStream();m&&m.getVideoTracks().forEach((function(_){_.enabled&&(_.enabled=!1)}))},h.prototype.enableVideo=function(){var m=this.getMediaStream();m&&m.getVideoTracks().forEach((function(_){_.enabled||(_.enabled=!0)}))},h.prototype.disableAudio=function(){var m=this.getMediaStream();m&&m.getAudioTracks().forEach((function(_){_.enabled&&(_.enabled=!1)}))},h.prototype.enableAudio=function(){var m=this.getMediaStream();m&&m.getAudioTracks().forEach((function(_){_.enabled||(_.enabled=!0)}))},h.prototype.stop=function(){v.prototype.stop.call(this),this.release()},h.prototype.onCanPlay=function(){var m=this;if(!this.recvCanPlay&&(this.emit("onCanPlay"),this.recvCanPlay=!0,this.autoplay))if(this.element)if(S.BrowserUtil.isMicroMessenger){var _=window.top!==window.self,A=window.WeixinJSBridge||window.top.WeixinJSBridge;A?A.invoke("getNetworkType",{},(function(){m.tryToPlay()})):(_?window.top.document:document).addEventListener("WeixinJSBridgeReady",(function(){A.invoke("getNetworkType",{},(function(){m.tryToPlay()}))}))}else this.tryToPlay();else this.tryToPlay()},h.prototype.release=function(){this.element&&(this.element.pause(),this.element.srcObject=null,this.element.load(),this.element.removeEventListener("canplay",this.onCanPlay)),this.recvCanPlay=!1,this.mediastream=void 0},h.prototype.bindMediaStream=function(m){this.element&&(this.element.nodeName==="AUDIO"&&m.getVideoTracks()[0]&&m.removeTrack(m.getVideoTracks()[0]),this.element.srcObject=m),this.mediastream=m},h.prototype.tryToPlay=function(){var m=this;if(this.element){var _=this.element.play();_!==void 0&&_.then((function(){})).catch((function(A){console.log("playPromise err",A),m.element&&m.element.srcObject&&m.emit("onAutoPlayError")}))}},h})(p.Stream);c.RemoteStream=R},5805:function(g,c,s){var d,l=this&&this.__extends||(d=function(y,R){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,h){v.__proto__=h}||function(v,h){for(var m in h)Object.prototype.hasOwnProperty.call(h,m)&&(v[m]=h[m])},d(y,R)},function(y,R){if(typeof R!="function"&&R!==null)throw new TypeError("Class extends value "+String(R)+" is not a constructor or null");function v(){this.constructor=y}d(y,R),y.prototype=R===null?Object.create(R):(v.prototype=R.prototype,new v)}),p=this&&this.__importDefault||function(y){return y&&y.__esModule?y:{default:y}};Object.defineProperty(c,"__esModule",{value:!0}),c.Stream=void 0;var S=s(233),T=(function(y){function R(){var v=y.call(this)||this;return v.traceid="",v.id=S.Guid.create(32),v}return l(R,y),Object.defineProperty(R.prototype,"traceId",{get:function(){return this.traceid},set:function(v){this.traceid=v},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"mediaElement",{get:function(){return this.element},enumerable:!1,configurable:!0}),R.prototype.setReporter=function(v){this.reporter=v},R.prototype.play=function(v){},R.prototype.stop=function(){this.traceid="",this.reporter=void 0},R})(p(s(102)).default);c.Stream=T},5676:function(g,c,s){var d,l=this&&this.__extends||(d=function(x,F){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(N,k){N.__proto__=k}||function(N,k){for(var M in k)Object.prototype.hasOwnProperty.call(k,M)&&(N[M]=k[M])},d(x,F)},function(x,F){if(typeof F!="function"&&F!==null)throw new TypeError("Class extends value "+String(F)+" is not a constructor or null");function N(){this.constructor=x}d(x,F),x.prototype=F===null?Object.create(F):(N.prototype=F.prototype,new N)}),p=this&&this.__assign||function(){return p=Object.assign||function(x){for(var F,N=1,k=arguments.length;N<k;N++)for(var M in F=arguments[N])Object.prototype.hasOwnProperty.call(F,M)&&(x[M]=F[M]);return x},p.apply(this,arguments)},S=this&&this.__awaiter||function(x,F,N,k){return new(N||(N=Promise))((function(M,j){function G(re){try{V(k.next(re))}catch(Q){j(Q)}}function z(re){try{V(k.throw(re))}catch(Q){j(Q)}}function V(re){var Q;re.done?M(re.value):(Q=re.value,Q instanceof N?Q:new N((function(Z){Z(Q)}))).then(G,z)}V((k=k.apply(x,F||[])).next())}))},T=this&&this.__generator||function(x,F){var N,k,M,j,G={label:0,sent:function(){if(1&M[0])throw M[1];return M[1]},trys:[],ops:[]};return j={next:z(0),throw:z(1),return:z(2)},typeof Symbol=="function"&&(j[Symbol.iterator]=function(){return this}),j;function z(V){return function(re){return(function(Q){if(N)throw new TypeError("Generator is already executing.");for(;j&&(j=0,Q[0]&&(G=0)),G;)try{if(N=1,k&&(M=2&Q[0]?k.return:Q[0]?k.throw||((M=k.return)&&M.call(k),0):k.next)&&!(M=M.call(k,Q[1])).done)return M;switch(k=0,M&&(Q=[2&Q[0],M.value]),Q[0]){case 0:case 1:M=Q;break;case 4:return G.label++,{value:Q[1],done:!1};case 5:G.label++,k=Q[1],Q=[0];continue;case 7:Q=G.ops.pop(),G.trys.pop();continue;default:if(M=G.trys,!((M=M.length>0&&M[M.length-1])||Q[0]!==6&&Q[0]!==2)){G=0;continue}if(Q[0]===3&&(!M||Q[1]>M[0]&&Q[1]<M[3])){G.label=Q[1];break}if(Q[0]===6&&G.label<M[1]){G.label=M[1],M=Q;break}if(M&&G.label<M[2]){G.label=M[2],G.ops.push(Q);break}M[2]&&G.ops.pop(),G.trys.pop();continue}Q=F.call(x,G)}catch(Z){Q=[6,Z],k=0}finally{N=M=0}if(5&Q[0])throw Q[1];return{value:Q[0]?Q[1]:void 0,done:!0}})([V,re])}}},y=this&&this.__importDefault||function(x){return x&&x.__esModule?x:{default:x}};Object.defineProperty(c,"__esModule",{value:!0}),c.Subscriber=void 0;var R,v=s(4865),h=s(5917),m=s(9428),_=y(s(8219)),A=y(s(102)),E=s(5044),b=s(7989),w=s(492),C=y(s(2818)),P=y(s(7028)),U=s(6091),B=s(771),L=s(2718),H=y(s(1401));(function(x){x[x.Init=0]="Init",x[x.Requesting=1]="Requesting",x[x.Playing=2]="Playing",x[x.Waiting=3]="Waiting"})(R||(R={}));var O=(function(x){function F(N,k){var M=x.call(this)||this;return M.monitorStatsHistory=[],M.playTimeIndex=0,M.playCatonIndex=0,M.reportPubFlag=!1,M.state=R.Init,M.subscribeAudio=!0,M.subscribeVideo=!0,M.signalingUrl="",M.pullStreamUrl="",M.noParsePullStreamUrl="",M.subReconnectTimes=0,M.isConnecting=!1,M.reconnectTimerHandle=null,M.reporter=N,M.playTimer=0,M.config=k||{playTimeOut:5e3},M.remoteStream=new B.RemoteStream,M.remoteStream.on("onAutoPlayError",(function(){M.emit("onError",new E.RtsError(m.ErrorCode.ERROR_AUTOPLAY_ERROR,"auto play failed",""))})),M.remoteStream.on("onCanPlay",(function(){return S(M,void 0,void 0,(function(){var j,G,z,V,re,Q,Z,q,Y,J,$;return T(this,(function(te){switch(te.label){case 0:return j=new Date().getTime(),[4,this.peerconnection.sample()];case 1:return te.sent(),G=-1,z=[],V=-1,this.monitorStatsHistory&&this.monitorStatsHistory.length&&(re=this.monitorStatsHistory[this.monitorStatsHistory.length-1],this.monitorStatsHistory.forEach((function(ie){var se=ie.rtt;se&&se>0&&z.push(se)})),G=Number((z.reduce((function(ie,se){return ie+se}),0)/z.length).toFixed(3)),V=re.packetsLost,this.monitorStatsHistory=null),this.stopPlayTimer(),this.peerconnection.playStart(),this.subReconnectTimes=0,Q=this._cnend||j,this.reporter.reportFirstFrameTime(this.noParsePullStreamUrl,this.remoteStream.traceId,this._cpend-this._cpstart,this._hrend-this._cpend,j-this._cpstart,0,Q-this._hrend,{rttAvg:G,packetsLost:V},-1,-1,-1,(q=this.subscribeConfig)===null||q===void 0?void 0:q.vMsid,(Y=this.subscribeConfig)===null||Y===void 0?void 0:Y.aMsid),(Z=new U.PlayEvent(U.PlayType.PLAY_CANPLAY)).data={url:this.noParsePullStreamUrl,vMsid:(J=this.subscribeConfig)===null||J===void 0?void 0:J.vMsid,aMsid:($=this.subscribeConfig)===null||$===void 0?void 0:$.aMsid},this.emit("onPlayEvent",Z),[2]}}))}))})),M.peerconnection=new v.RtsPeerconnection,M.peerconnection.on("onConnected",(function(){M._cnend=new Date().getTime()})),M.peerconnection.on("streamEnded",(function(j){var G=new U.PlayEvent(U.PlayType.PLAY_ENDED);G.data=p({},j),M.emit("onPlayEvent",G),M.emit("onError",new E.RtsError(m.ErrorCode.ERROR_STREAM_ENDED,"Stream Receiver Transport is Closed",M.remoteStream.traceId))})),M.peerconnection.on("onTrackEvent",(function(j){j.streams&&j.streams.length&&(M.remoteStream.updateMediaStream(j.streams[0]),M.onTrackFunction&&M.onTrackFunction())})),M.peerconnection.on("connectStatusChange",(function(j){j.status!==h.EConnectStatus.CONNECT_STATUS_DISCONNECTED&&j.status!==h.EConnectStatus.CONNECT_STATUS_RECONNECTING||!M.hasRetries()?M.emit("connectStatusChange",j):M.emit("onError",new E.RtsError(m.ErrorCode.ERROR_PC_DISCONNECTED,"PC disconnected",M.remoteStream.traceId))})),M.peerconnection.on("pcReconnect",(function(j){var G,z;j.ips?(G="Migrate with ips: ".concat((0,H.default)(j.ips)),z=m.ErrorCode.ERROR_IP_MIGRATE):(G="PC disconnected",z=m.ErrorCode.ERROR_PC_DISCONNECTED),M.emit("onError",new E.RtsError(z,G,"",{pcErrorInfo:j}))})),M.mediaObserver=new w.MediaObserver({handler:function(j,G,z){var V,re=new U.PlayEvent(U.PlayType.PLAY_TIMEOUT),Q={url:j};G&&(Q.vMsid=G),z&&(Q.aMsid=z),re.data=Q,M.emit("onPlayEvent",re);var Z=new E.RtsError(m.ErrorCode.ERROR_INBOUND_TIMEOUT,"Media data timeout after ".concat((V=M.mediaObserver)===null||V===void 0?void 0:V.actTimeout," ms."),M.remoteStream.traceId);M.emit("onError",Z)}}),M.peerconnection.on("onMonitorEvent",(function(j){var G,z=j.eventList;if((G=M.peerconnection)===null||G===void 0||G.updateStatsForSEI(z,j.type),j.type!=="pub"){if(z.length){for(var V=void 0,re=0;re<z.length;re++)if(z[re].url===(0,L.pruneSubUrl)(M.noParsePullStreamUrl,!0)){V=z[re];break}if(V){M.lastMeidaEventData=V;var Q=V.video,Z=V.audio;Q&&M.monitorStatsHistory?M.monitorStatsHistory.push({rtt:Q.transportStats.rtt,packetsLost:Q.inboundRtpStats.packetsLost}):Z&&M.monitorStatsHistory&&M.monitorStatsHistory.push({rtt:Z.transportStats.rtt,packetsLost:Z.inboundRtpStats.packetsLost}),R.Requesting===M.state?V.video?V.video.inboundRtpStatsPerSec.framesDecodedPerSecond>1&&(M.state=R.Playing):V.audio&&V.audio.inboundRtpStatsPerSec.bytesReceivedPerSecond>0&&(M.state=R.Playing):M.state!==R.Playing&&M.state!==R.Waiting||(++M.playTimeIndex,V.video&&(V.video.inboundRtpStatsPerSec.framesDecodedPerSecond<=1?(++M.playCatonIndex,R.Waiting!==M.state&&(M.state=R.Waiting,M.emit("onPlayEvent",new U.PlayEvent(U.PlayType.PLAY_WAITING)))):R.Waiting===M.state&&(M.state=R.Playing,M.emit("onPlayEvent",new U.PlayEvent(U.PlayType.PLAY_PLAYING)))),C.default.HEARTHEAT_INTERVAL===M.playTimeIndex&&(M.reportPubFlag=!0,z.forEach((function(Y){M.doReportPullStats(Y)})),M.playTimeIndex=0,M.playCatonIndex=0))}var q=new U.PlayEvent(U.PlayType.PLAY_MEDIA);q.data=[],z.forEach((function(Y){var J={};J.url=Y.url;var $=M.calcStreamPullStats(Y);if(Y.audio&&(J.audio={bytesReceivedPerSecond:Y.audio.inboundRtpStatsPerSec.bytesReceivedPerSecond,rtt:Y.audio.transportStats.rtt,lossRate:$.aloss,jitterBufferDelayAvg:Y.audio.inboundRtpStatsPerSec.jitterBufferDelayAvg},J.aMsid=Y.aMsid),Y.video){var te=Y.video,ie=te.inboundRtpStats,se=te.inboundRtpStatsPerSec,he=te.transportStats;J.video={bytesReceivedPerSecond:se.bytesReceivedPerSecond,fps:ie.framesPerSecond||se.framesDecodedPerSecond,framesDecodedPerSecond:se.framesDecodedPerSecond,rtt:he.rtt,width:ie.frameWidth,height:ie.frameHeight,lossRate:$.vloss,jitterBufferDelayAvg:se.jitterBufferDelayAvg},J.vMsid=Y.vMsid}J.networkQuality=$.net_qual||0,q.data.push(J)})),q.data&&q.data.length&&(q.data.forEach((function(Y){var J;(J=M.mediaObserver)===null||J===void 0||J.check({audio:Y.audio,video:Y.video},Y.url,Y.vMsid,Y.aMsid)})),q.data.length===1&&(q.data[0].audio||q.data[0].video)&&(q.data=p({},q.data[0])),M.emit("onPlayEvent",q))}}else M.reportPubFlag&&(M.reportPubFlag=!1)})),M.playTimer=0,M._cpstart=0,M._cpend=0,M._hrend=0,M._cnend=0,M.subscribeConfig={},M}return l(F,x),F.prototype.getPeerConnection=function(){return this.peerconnection},F.prototype.subscribe=function(N,k,M){var j=this;return new Promise((function(G,z){return S(j,void 0,void 0,(function(){var V,re,Q=this;return T(this,(function(Z){switch(Z.label){case 0:return this.monitorStatsHistory=[],this.unsubscribe(),k?.cumuDelay&&(k.encodedInsertableStreams=!0),this.subscribeConfig=k||{},this.state=R.Requesting,this.noParsePullStreamUrl=N,this.parseUrl(N),(re=this.mediaObserver)===null||re===void 0||re.updateConfig({timeout:k?.mediaTimeout}),V=k?.signalUrl,this.signalingUrl=V||this.signalingUrl,this.checkPullUrl()?[3,1]:(z(new E.RtsError(m.ErrorCode.ERROR_PLAY_URL,"url need artc://","")),[3,8]);case 1:return this.subscribeAudio||this.subscribeVideo?[3,2]:(z(new E.RtsError(m.ErrorCode.ERROR_SUBSCRIBE_NOTHING,"subscribe nothing","")),[3,8]);case 2:if(this._cpstart=new Date().getTime(),!this.subscribeVideo||k?.isH264Checked)return[3,7];Z.label=3;case 3:return Z.trys.push([3,5,,6]),[4,new b.SupportUtil().loadH264(3)];case 4:return Z.sent(),[3,6];case 5:return Z.sent(),[3,6];case 6:Z.label=7;case 7:this.peerconnection.createOffer(this.subscribeAudio,this.subscribeVideo,void 0,{offerSdpHook:k?.offerSdpHook,answerSdpHook:k?.answerSdpHook,encodedInsertableStreams:k?.encodedInsertableStreams,disableStereo:k?.disableStereo,disableHeartbeat:k?.disableHeartbeat,cumuDelay:k?.cumuDelay}).then((function(q){var Y=q.desp;Q._cpend=new Date().getTime(),Q.reporter.reportSubscribeStart(Q.noParsePullStreamUrl,Q.signalingUrl,k?.vMsid,k?.aMsid),Q.excuteSignal(Y,{innerTcpOnly:!!M?.innerTcpOnly}).then((function(J){var $;Q.remoteStream.traceId=J,G(Q.remoteStream);try{($=Q.peerconnection.getPeerCore())===null||$===void 0||$.patchSubscribeStreamManagerRecord(Q.noParsePullStreamUrl,p(p({},Q.subscribeConfig),{stream:Q.remoteStream}))}catch(te){console.log(te)}Q.peerconnection.getSubMonitor().updateTranceiversController()})).catch((function(J){Q._hrend=new Date().getTime();var $=new E.RtsError(J.errorCode?J.errorCode:m.ErrorCode.ERROR_HTTPREQUEST_ERROR,J.message,J?J.traceid:"",{response:J.response,sdp:J.sdp});z($)}))})).catch((function(q){Q._cpend=new Date().getTime();var Y=new E.RtsError(m.ErrorCode.ERROR_CREATEOFFER,q.message,"");z(Y)})),Z.label=8;case 8:return[2]}}))}))}))},F.prototype.unsubscribe=function(){var N;this.lastMeidaEventData&&this.doReportPullStats(this.lastMeidaEventData),this.stopPlayTimer(),this.peerconnection.reset(),this.remoteStream.stop(),this.subscribeVideo=!0,this.subscribeAudio=!0,this.state=R.Init,this.signalingUrl="",this.pullStreamUrl="",this.noParsePullStreamUrl="",this.onTrackFunction=void 0,this.playTimer=0,this._cpstart=0,this._cpend=0,this._hrend=0,this._cnend=0,this.monitorStatsHistory=[],(N=this.mediaObserver)===null||N===void 0||N.reset()},F.prototype.dispose=function(){this.removeAllListeners(),this.unsubscribe()},F.prototype.startLiveStream=function(N,k,M){var j=this;return console.error("APIsubscribe"),new Promise((function(G,z){j.unsubscribe(),j.state=R.Requesting,j.noParsePullStreamUrl=N,j.parseUrl(N);var V=M?.signalUrl;j.signalingUrl=V||j.signalingUrl,j.pullStreamUrl===""?z(new E.RtsError(m.ErrorCode.ERROR_PLAY_URL,"url need artc://","")):j.subscribeAudio||j.subscribeVideo?!k||k.nodeName!=="AUDIO"&&k.nodeName!=="VIDEO"?z(new E.RtsError(m.ErrorCode.ERROR_HTMLELEMENT_ERROR,"need htmlaudioelement or htmlvideoelement","")):(j.subscribeAudio&&j.subscribeVideo?k.nodeName!=="VIDEO"&&j.emit("onError",new E.RtsError(m.ErrorCode.ERROR_HEMLELEMENT_NOTMATCH,"need htmlvideoelement","")):j.subscribeAudio?k.nodeName!=="AUDIO"&&j.emit("onError",new E.RtsError(m.ErrorCode.ERROR_HEMLELEMENT_NOTMATCH,"need htmlaudioelement","")):k.nodeName!=="VIDEO"&&j.emit("onError",new E.RtsError(m.ErrorCode.ERROR_HEMLELEMENT_NOTMATCH,"need htmlvieoelement","")),j._cpstart=new Date().getTime(),j.reporter.updateTid(),j.peerconnection.createOffer(j.subscribeAudio,j.subscribeVideo).then((function(re){var Q=re.desp;j._cpend=new Date().getTime(),j.excuteSignal(Q).then((function(Z){j.remoteStream.traceId=Z,j._hrend=new Date().getTime(),j.remoteStream.play(k),G(Z)})).catch((function(Z){j._hrend=new Date().getTime(),j.reporter.reportFirstFrameTime(j.noParsePullStreamUrl,Z?Z.traceid:"",j._cpend-j._cpstart,j._hrend-j._cpend,-1,-1,j._cnend-j._hrend),z(new E.RtsError(Z.errorCode?Z.errorCode:m.ErrorCode.ERROR_HTTPREQUEST_ERROR,Z.message,""))}))})).catch((function(re){j._cpend=new Date().getTime(),j.reporter.reportFirstFrameTime(j.noParsePullStreamUrl,re?re.traceid:"",j._cpend-j._cpstart,-1,-1,-1,j._cnend-j._hrend),z(new E.RtsError(m.ErrorCode.ERROR_CREATEOFFER,re.message,""))}))):z(new E.RtsError(m.ErrorCode.ERROR_SUBSCRIBE_NOTHING,"subscribe nothing",""))}))},F.prototype.stopLiveStream=function(){this.unsubscribe()},F.prototype.muteLiveStream=function(N){return this.remoteStream.muted=N,!0},F.prototype.excuteSignal=function(N,k){var M=this,j={type:N.type,sdp:N.sdp};return new Promise((function(G,z){var V,re,Q,Z,q,Y={url:M.pullStreamUrl,amsid:((V=M.subscribeConfig)===null||V===void 0?void 0:V.aMsid)||["rts audio"],vmsid:((re=M.subscribeConfig)===null||re===void 0?void 0:re.vMsid)||["rts video"]};M.subscribeAudio||delete Y.amsid,M.subscribeVideo||delete Y.vmsid,!((Q=M.subscribeConfig)===null||Q===void 0)&&Q.cumuDelay&&(j.sdp=j.sdp.replace(/(m=video[^\n]*\n)/,`$1a=cumudelay
`)),_.default.post(M.signalingUrl,{version:((Z=M.subscribeConfig)===null||Z===void 0?void 0:Z.signalVersion)||P.default.protocol_version,sdk_version:P.default.sdk_version,mode:((q=M.subscribeConfig)===null||q===void 0?void 0:q.signalMode)||"live",pull_streams:[Y],jsep:j}).then((function(J){var $,te,ie,se,he,de,be,Re,Te;if(J&&J.status===200){M._hrend=new Date().getTime();try{!(($=M.subscribeConfig)===null||$===void 0)&&$.cumuDelay&&!(!((ie=(te=J.data)===null||te===void 0?void 0:te.jsep)===null||ie===void 0)&&ie.sdp.includes("a=cumudelay"))&&(console.warn("Not found cumudelay in server sdp"),(se=M.reporter)===null||se===void 0||se.reportCumuDelayAnswerNotFound())}catch{}var Ae=(he=J.data)===null||he===void 0?void 0:he.trace_id;M.reporter.reportSubscribeOk({vurl:M.noParsePullStreamUrl,surl:M.signalingUrl,traceId:Ae,hrct:M._hrend-M._cpend,rslt:(de=J.data)===null||de===void 0?void 0:de.code});var Ie=typeof((be=M.subscribeConfig)===null||be===void 0?void 0:be.tcpOnly)=="boolean"?M.subscribeConfig.tcpOnly:k?.innerTcpOnly;M.peerconnection.recvAnswer(J.data,{answerSdpHook:(Re=M.subscribeConfig)===null||Re===void 0?void 0:Re.answerSdpHook,tcpOnly:Ie}).then((function(){G(Ae)})).catch((function(Le){Le.traceid=J.data?J.data.trace_id:"",z({errorCode:m.ErrorCode.ERROR_ANSWER_ERROR,message:Le.message?Le.message:"set answer error",traceid:Le.traceid,sdp:Le.sdp})}))}else z({message:J?"response status:"+J.status:"response is null",traceid:(Te=J?.data)===null||Te===void 0?void 0:Te.trace_id,sdp:N.sdp})})).catch((function(J){return S(M,void 0,void 0,(function(){var $,te;return T(this,(function(ie){switch(ie.label){case 0:if(![400,500].includes((te=J.response)===null||te===void 0?void 0:te.status))return[3,4];J.sdp=N.sdp,ie.label=1;case 1:return ie.trys.push([1,3,,4]),[4,new b.SupportUtil().isSupport({isReceiveVideo:!0})];case 2:return ie.sent(),[3,4];case 3:return $=ie.sent(),J.errorCode=$?.errorCode,J.message=$?.message,this.subReconnectTimes=1/0,[3,4];case 4:return z(J),[2]}}))}))}))}))},F.prototype.checkPullUrl=function(){return!!this.noParsePullStreamUrl&&this.noParsePullStreamUrl.indexOf("artc://")===0},F.prototype.parseUrl=function(N){if(N===void 0&&(N=""),N?.indexOf("artc://")===0){N.indexOf("@subaudio=no")>-1&&(this.subscribeAudio=!1,N=N.replace("@subaudio=no","")),N.indexOf("@subvideo=no")>-1&&(this.subscribeVideo=!1,N=N.replace("@subvideo=no","")),this.pullStreamUrl=N;var k=window.location.protocol,M=(["http:","https:"].indexOf(k)>-1?k:"https:")+"//";this.signalingUrl=this.pullStreamUrl.replace("artc://",M)}},F.prototype.stopPlayTimer=function(){this.playTimer&&clearTimeout(this.playTimer),this.playTimer=0},F.prototype.calcStreamPullStats=function(N){var k={},M=N.video,j=N.audio;if(M){var G=M.transportStats,z=M.inboundRtpStats,V=M.inboundRtpStatsPerSec,re=M.localCandidate,Q=M.remoteCandidate;k=p(p({},k),{rtt:G?.rtt!==-1?1e3*(G?.rtt||0):-1,cand_re_prot:Q.protocol,cand_lo_prot:re.protocol,cand_re_addr:"".concat(Q.ip||Q.address,":").concat(Q.port),cand_lo_addr:"".concat(re.ip||re.address,":").concat(re.port),w:z?.frameWidth,h:z?.frameHeight,vbps:Math.floor(8*V.bytesReceivedPerSecond),fps:z?.framesPerSecond,dfps:Math.floor(V?.framesDecodedPerSecond),vjb:Math.floor((0,L.getJitterBufferDelayAvg)(z?.jitterBufferDelay,z?.jitterBufferEmittedCount)),vMsid:N.vMsid,vloss:V.packetsLostRate})}return j&&(G=j.transportStats,z=j.inboundRtpStats,V=j.inboundRtpStatsPerSec,re=j.localCandidate,Q=j.remoteCandidate,k=p(p({},k),{rtt:G?.rtt!==-1?1e3*(G?.rtt||0):-1,cand_re_prot:Q.protocol,cand_lo_prot:re.protocol,cand_re_addr:"".concat(Q.ip||Q.address,":").concat(Q.port),cand_lo_addr:"".concat(re.ip||re.address,":").concat(re.port),abps:Math.floor(8*V.bytesReceivedPerSecond),ajb:Math.floor((0,L.getJitterBufferDelayAvg)(z?.jitterBufferDelay,z.jitterBufferEmittedCount)),aMsid:N.aMsid,aloss:V.packetsLostRate})),k=p(p({},k),{net_qual:(0,L.evaluateNetworkCondition)(k.rtt,k.aloss,k.vloss,k.ajb,k.vjb)})},F.prototype.doReportPullStats=function(N){var k=this.calcStreamPullStats(N),M={ct:1e3*this.playCatonIndex,tt:1e3*this.playTimeIndex,url:N.url};M.tt&&(M=p(p({},M),k),this.reporter.reportPullStats(M),this.lastMeidaEventData=void 0)},F.prototype.retrySubscribe=function(N,k){return S(this,void 0,void 0,(function(){var M,j,G,z,V,re,Q;return T(this,(function(Z){switch(Z.label){case 0:if(N.extraInfo=p(p({},N.extraInfo),{retryTimes:this.subReconnectTimes}),!this.hasRetries())return[2,!1];if(typeof((M=this.subscribeConfig)==null?void 0:M.beforeRetry)!="function")return[3,4];Z.label=1;case 1:return Z.trys.push([1,3,,4]),[4,M.beforeRetry({url:this.noParsePullStreamUrl,vMsid:M.vMsid,aMsid:M.aMsid,useTcp:k?.innerTcpOnly})];case 2:return(j=Z.sent())?(G=j.url,z=j.vMsid,V=j.aMsid,re=j.useTcp,this.reporter.reportReconnectParams("sub",G,z,V,re),this.noParsePullStreamUrl=G,this.subscribeConfig.vMsid=z,this.subscribeConfig.aMsid=V,typeof re=="boolean"&&(k=p(p({},k),{innerTcpOnly:re})),console.log(`retry with: 
[URL] `.concat(G,`
[VMSID]`).concat(z," [AMSID]").concat(V,`
[PROTOCOL] `).concat(re?"TCP":"UDP"))):(this.reporter.reportReconnectParams("sub"),this.subReconnectTimes=1/0),[3,4];case 3:return Q=Z.sent(),console.error("Error in beforeRetry",Q),[3,4];case 4:return this.hasRetries()?(this.emit("connectStatusChange",{status:h.EConnectStatus.CONNECT_STATUS_RECONNECTING}),this.incrementReconnectTimes(),N.extraInfo.retryTimes=this.subReconnectTimes,N.extraInfo.tcpOnly=k?.innerTcpOnly,this.subscribeWithReconnect(this.noParsePullStreamUrl,p({innerTcpOnly:k?.innerTcpOnly},this.subscribeConfig)).catch((function(q){})),[2,!0]):(N.extraInfo.retryTimes=this.subReconnectTimes,[2,!1])}}))}))},F.prototype.subscribeWithReconnect=function(N,k,M,j){var G=this;return new Promise((function(z,V){z=M||z,V=j||V,G.isConnecting=!0;var re=(k||{}).innerTcpOnly;k==null||delete k.innerTcpOnly,G.subscribe(N,k,{innerTcpOnly:re}).then((function(Q){G.isConnecting=!1,z(Q)})).catch((function(Q){var Z;if(G.peerconnection.reset(),!G.isConnecting)return V(Q);if(!m.RECONNECT_ERROR_EXCLUDE_LIST.includes(Q.errorCode)&&G.hasRetries(!0)){var q=((Z=G.subscribeConfig)===null||Z===void 0?void 0:Z.retryInterval)||h.DEFAULT_RETRY_SUBSCRIBE_INTERVAL;G.reconnectTimerHandle=setTimeout((function(){Q.extraInfo=p(p({},Q.extraInfo),{retryTimes:G.subReconnectTimes}),G.emit("reconnect",Q),G.subscribeWithReconnect(N,k,z,V)}),q)}else V(Q),Q.extraInfo=p(p({},Q.extraInfo),{retryTimes:G.subReconnectTimes}),G.isConnecting=!1,G.emit("onError",Q)}))}))},F.prototype.hasRetries=function(N){var k,M,j=h.DEFAULT_RETRY_SUBSCRIBE_LIMIT;typeof((k=this.subscribeConfig)===null||k===void 0?void 0:k.retryTimes)=="number"&&(j=Math.floor((M=this.subscribeConfig)===null||M===void 0?void 0:M.retryTimes));var G=this.subReconnectTimes<j;return N&&G&&this.incrementReconnectTimes(),G},F.prototype.resetResubscribeStatus=function(){this.subReconnectTimes=0,this.isConnecting=!1,this.reporter.updateTid(),this.reconnectTimerHandle!==null&&(clearTimeout(this.reconnectTimerHandle),this.reconnectTimerHandle=null)},F.prototype.handlePubMonitorEvent=function(N){var k=this;N.forEach((function(M){k.reporter.reportPushStats(M)}))},F.prototype.incrementReconnectTimes=function(){this.subReconnectTimes++},F.prototype.getSubscribeConfig=function(){return this.subscribeConfig},F})(A.default);c.Subscriber=O},6901:function(g,c,s){var d,l=this&&this.__extends||(d=function(T,y){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,v){R.__proto__=v}||function(R,v){for(var h in v)Object.prototype.hasOwnProperty.call(v,h)&&(R[h]=v[h])},d(T,y)},function(T,y){if(typeof y!="function"&&y!==null)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");function R(){this.constructor=T}d(T,y),T.prototype=y===null?Object.create(y):(R.prototype=y.prototype,new R)});Object.defineProperty(c,"__esModule",{value:!0}),c.AudioReceiverMonitorData=void 0;var p=s(1353),S=(function(T){function y(){return T.call(this,p.ReceiverMonitorType.AUDIO)||this}return l(y,T),y})(p.ReceiverMonitorData);c.AudioReceiverMonitorData=S},1353:function(g,c,s){var d,l=this&&this.__extends||(d=function(m,_){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,E){A.__proto__=E}||function(A,E){for(var b in E)Object.prototype.hasOwnProperty.call(E,b)&&(A[b]=E[b])},d(m,_)},function(m,_){if(typeof _!="function"&&_!==null)throw new TypeError("Class extends value "+String(_)+" is not a constructor or null");function A(){this.constructor=m}d(m,_),m.prototype=_===null?Object.create(_):(A.prototype=_.prototype,new A)}),p=this&&this.__importDefault||function(m){return m&&m.__esModule?m:{default:m}};Object.defineProperty(c,"__esModule",{value:!0}),c.ReceiverMonitorData=c.ReceiverMonitorType=void 0;var S,T=s(233),y=p(s(102)),R=s(2688),v=s(2718);(function(m){m.AUDIO="audio",m.VIDEO="video"})(S||(c.ReceiverMonitorType=S={}));var h=(function(m){function _(A){var E=m.call(this)||this;return E.streamEnded=!1,E.currentTimeGap=0,E.lastTimeStamp=0,E.transportStats={},E.remoteCandidate={},E.localCandidate={},E.inboundRtpStreamStats={},E.inboundRtpStreamStatsDiff={},E.receiver=null,E.pc=null,E.canplay=!1,E.type=A,E}return l(_,m),Object.defineProperty(_.prototype,"rtpReceiver",{set:function(A){this.receiver=A},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"RTCPeerconnection",{set:function(A){this.pc=A},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"isExist",{get:function(){return this.receiver!=null},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"isPlaying",{get:function(){return this.canplay},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"isStreamEnded",{get:function(){return this.streamEnded},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"monitorData",{get:function(){var A=this.inboundRtpStreamStatsDiff||{},E=(this.inboundRtpStreamStats,this.currentTimeGap),b=0;return A.nackCount!==void 0&&A.packetsReceived!==void 0&&(b=Math.round(A.nackCount/(A.packetsReceived+A.nackCount)*1e3)/1e3),{inboundRtpStats:this.inboundRtpStreamStats,inboundRtpStatsPerSec:{bytesReceivedPerSecond:A.bytesReceived/E||0,framesDecodedPerSecond:A.framesDecoded/E||0,packetsLostRate:b>0?b:0,decodeTimeAvg:A.totalDecodeTime&&A.framesDecoded?1e3*(A.totalDecodeTime/A.framesDecoded||0):0,jitterBufferDelayAvg:A.jitterBufferDelay&&A.jitterBufferEmittedCount?(0,v.getJitterBufferDelayAvg)(A.jitterBufferDelay,A.jitterBufferEmittedCount):0,totalProcessingDelayAvg:A.totalProcessingDelay&&A.framesDecoded?A.totalProcessingDelay/A.framesDecoded*1e3:0,totalAssemblyTimeAvg:A.totalAssemblyTime&&A.framesAssembledFromMultiplePackets?A.totalAssemblyTime/A.framesAssembledFromMultiplePackets*1e3:0},transportStats:this.transportStats,remoteCandidate:this.remoteCandidate,localCandidate:this.localCandidate}},enumerable:!1,configurable:!0}),_.prototype.getInfo=function(){var A=this;if(this.receiver&&this.receiver.transport&&this.receiver.transport.state==="closed"&&this.canplay&&(this.streamEnded=!0,this.emit("streamEnded"),this.canplay=!1),this.receiver&&"getStats"in this.receiver||this.pc&&"getStats"in this.pc)return new Promise((function(E,b){var w=null,C=!1;A.receiver&&"getStats"in A.receiver?w=A.receiver.getStats():A.pc&&"getStats"in A.pc&&(w=A.pc.getStats(),C=!0),w?.then((function(P){P.forEach((function(U){var B,L;if(U)switch(U.type){case R.RTCStatsType.CandidatePair:A.onCandidatePair(U);break;case R.RTCStatsType.InboundRtp:T.SystemUtil.isIos&&C?!((B=U.id)===null||B===void 0)&&B.toLowerCase().includes(A.type)&&A.onInBoundRtp(U):T.BrowserUtil.isFirefox?U.kind===A.type&&A.onInBoundRtp(U):A.onInBoundRtp(U);break;case R.RTCStatsType.RemoteCandidate:A.onRemoteCandidate(U);break;case R.RTCStatsType.LocalCandidate:A.onLocalCandidate(U);break;case R.RTCStatsType.Track:if(A.type!==S.VIDEO)break;T.SystemUtil.isIos&&C?(!((L=U.id)===null||L===void 0)&&L.toLowerCase().includes(A.type)||U.trackIdentifier.toLowerCase()===A.type)&&A.onTrack(U):A.onTrack(U)}})),E("")})).catch((function(P){b(P)}))}))},_.prototype.dispose=function(){this.reset()},_.prototype.onCandidatePair=function(A){(A.state==="succeeded"||A.bytesReceived)&&(this.transportStats={timestamp:Math.floor(A.timestamp),rtt:A.currentRoundTripTime||-1,bytesReceived:A.bytesReceived,bytesSent:A.bytesSent})},_.prototype.onInBoundRtp=function(A){this.currentTimeGap=(A.timestamp-this.lastTimeStamp)/1e3,this.lastTimeStamp=A.timestamp,this.inboundRtpStreamStatsDiff=this.calcDiff(A,this.inboundRtpStreamStats,["bytesReceived","framesDecoded","packetsReceived","nackCount","totalDecodeTime","jitterBufferDelay","jitterBufferEmittedCount","totalProcessingDelay","totalAssemblyTime","framesAssembledFromMultiplePackets"]),this.inboundRtpStreamStats=A,!this.canplay&&Number(A.bytesReceived)>0&&(this.canplay=!0,this.emit("canPlay"))},_.prototype.calcDiff=function(A,E,b){var w={};return b.forEach((function(C){w[C]=Number(A[C]||0)-Number(E[C]||0)})),w},_.prototype.onRemoteCandidate=function(A){this.remoteCandidate=A||{}},_.prototype.onLocalCandidate=function(A){this.localCandidate=A||{}},_.prototype.onTrack=function(A){A.frameWidth&&(this.inboundRtpStreamStats.frameWidth=A.frameWidth,this.inboundRtpStreamStats.frameHeight=A.frameHeight)},_.prototype.reset=function(){this.currentTimeGap=0,this.lastTimeStamp=0,this.transportStats={},this.remoteCandidate={},this.localCandidate={},this.inboundRtpStreamStats={},this.inboundRtpStreamStatsDiff={},this.receiver=null,this.canplay=!1,this.streamEnded=!1},_})(y.default);c.ReceiverMonitorData=h},5250:function(g,c,s){var d,l=this&&this.__extends||(d=function(T,y){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,v){R.__proto__=v}||function(R,v){for(var h in v)Object.prototype.hasOwnProperty.call(v,h)&&(R[h]=v[h])},d(T,y)},function(T,y){if(typeof y!="function"&&y!==null)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");function R(){this.constructor=T}d(T,y),T.prototype=y===null?Object.create(y):(R.prototype=y.prototype,new R)});Object.defineProperty(c,"__esModule",{value:!0}),c.VideoReceiverMonitorData=void 0;var p=s(1353),S=(function(T){function y(){return T.call(this,p.ReceiverMonitorType.VIDEO)||this}return l(y,T),y})(p.ReceiverMonitorData);c.VideoReceiverMonitorData=S},2688:(g,c)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.RTCStatsType=void 0;var s=(function(){function d(){}return d.CandidatePair="candidate-pair",d.Certificate="certificate",d.Codec="codec",d.Csrc="csrc",d.DataCahnnel="data-channel",d.InboundRtp="inbound-rtp",d.LocalCandidate="local-candidate",d.OutboundRtp="outbound-rtp",d.PeerConnection="peer-connection",d.Receiver="receiver",d.RemoteCandidate="remote-candidate",d.RemoteInboundRtp="remote-inbound-rtp",d.RemoteOutboundRtp="remote-outbound-rtp",d.Sender="sender",d.Stream="stream",d.Track="track",d.Transport="transport",d.MediaSource="media-source",d})();c.RTCStatsType=s},5657:(g,c,s)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.SenderMonitorData=void 0;var d=s(2688),l=(function(){function p(){this._audiosender=null,this._videosender=null,this.timeStamp=0,this.curTimeStamp=0,this.audioBytesSent=0,this.curAudioBytesSent=0,this.videoBytesSent=0,this.curVideoBytesSent=0,this.audioRetransmittedBytesSent=0,this.curAudioRetransmittedBytesSent=0,this.videoRetransmiitedBytesSent=0,this.curVideoRetransmiitedBytesSent=0,this.framesSent=0,this.curFramesSent=0,this.framesEncoded=0,this.curFramesEncoded=0,this.totalEncodeTime=0,this.curTotalEncodeTime=0,this.totalPacketSendDelay=0,this.curTotalPacketSendDelay=0,this.packetsSent=0,this.curPacketsSent=0,this.rtt=0,this.localProtocol="",this.remoteProtocol="",this.localTransportAddr="",this.remoteTransportAddr="",this.frameHeight=0,this.frameWidth=0,this.efps=0,this.sfps=0,this.timeGap=0,this.abps=0,this.vbps=0,this.rt_abps=0,this.rt_vbps=0,this.encodeTimeAvg=0,this.packetSendDelayAvg=0,this.stashedData={}}return Object.defineProperty(p.prototype,"videoSender",{set:function(S){this._videosender=S},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"audioSender",{set:function(S){this._audiosender=S},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"monitorData",{get:function(){return this.doCalc(),{tt:parseFloat(this.timeGap.toFixed(0)),rtt:this.rtt,cand_re_prot:this.remoteProtocol,cand_lo_prot:this.localProtocol,cand_re_addr:this.remoteTransportAddr,cand_lo_addr:this.localTransportAddr,w:this.frameWidth,h:this.frameHeight,efps:parseFloat(this.efps.toFixed(0)),fps:parseFloat(this.sfps.toFixed(0)),abps:parseFloat(this.abps.toFixed(0)),vbps:parseFloat(this.vbps.toFixed(0)),rt_abps:parseFloat(this.rt_abps.toFixed(0)),rt_vbps:parseFloat(this.rt_vbps.toFixed(0)),v_encode_time_avg:parseFloat(this.encodeTimeAvg.toFixed(2)),v_packet_send_delay_avg:parseFloat(this.packetSendDelayAvg.toFixed(2))}},enumerable:!1,configurable:!0}),p.prototype.doCalc=function(){this.timeStamp!==0&&(this.timeGap=this.curTimeStamp-this.timeStamp,this.timeGap>0&&(this.efps=1e3*(this.curFramesEncoded-this.framesEncoded)/this.timeGap,this.sfps=1e3*(this.curFramesSent-this.framesSent)/this.timeGap,this.abps=1e3*(this.curAudioBytesSent-this.audioBytesSent)/this.timeGap,this.vbps=1e3*(this.curVideoBytesSent-this.videoBytesSent)/this.timeGap,this.rt_abps=1e3*(this.curAudioRetransmittedBytesSent-this.audioRetransmittedBytesSent)/this.timeGap,this.rt_vbps=1e3*(this.curVideoRetransmiitedBytesSent-this.videoRetransmiitedBytesSent)/this.timeGap,this.encodeTimeAvg=(this.curTotalEncodeTime-this.totalEncodeTime)/(this.curFramesEncoded-this.framesEncoded)*1e3,this.packetSendDelayAvg=(this.curTotalPacketSendDelay-this.totalPacketSendDelay)/(this.curPacketsSent-this.packetsSent)*1e3)),this.timeStamp=this.curTimeStamp,this.audioBytesSent=this.curAudioBytesSent,this.videoBytesSent=this.curVideoBytesSent,this.audioRetransmittedBytesSent=this.curAudioRetransmittedBytesSent,this.videoRetransmiitedBytesSent=this.curVideoRetransmiitedBytesSent,this.framesSent=this.curFramesSent,this.framesEncoded=this.curFramesEncoded,this.totalEncodeTime=this.curTotalEncodeTime,this.packetsSent=this.curPacketsSent,this.totalPacketSendDelay=this.curTotalPacketSendDelay},p.prototype.getInfo=function(){var S=this,T=new Promise((function(R,v){S._videosender&&S._videosender.getStats?S._videosender.getStats().then((function(h){h.forEach((function(m){if(m)switch(m.type){case d.RTCStatsType.CandidatePair:S.onCandidatePair(m);break;case d.RTCStatsType.OutboundRtp:S.onOutBoundRtp(m,"video");break;case d.RTCStatsType.RemoteCandidate:S.onRemoteCandidate(m);break;case d.RTCStatsType.LocalCandidate:S.onLocalCandidate(m)}})),R()})).catch((function(h){v(h)})):v("no video sender")})),y=new Promise((function(R,v){S._audiosender&&S._audiosender.getStats?S._audiosender.getStats().then((function(h){h.forEach((function(m){if(m)switch(m.type){case d.RTCStatsType.CandidatePair:S.onCandidatePair(m);break;case d.RTCStatsType.OutboundRtp:S.onOutBoundRtp(m,"audio");break;case d.RTCStatsType.RemoteCandidate:S.onRemoteCandidate(m);break;case d.RTCStatsType.LocalCandidate:S.onLocalCandidate(m)}})),R()})).catch((function(h){v(h)})):v("no audio sender")}));return Promise.all([T,y])},p.prototype.onCandidatePair=function(S){this.curTimeStamp=S.timestamp,this.rtt=S.currentRoundTripTime},p.prototype.onOutBoundRtp=function(S,T){this.curTimeStamp=S.timestamp,T==="video"?(this.curVideoBytesSent=S.bytesSent,this.curVideoRetransmiitedBytesSent=S.retransmittedBytesSent,this.curFramesEncoded=S.framesEncoded,this.curFramesSent=S.framesSent,this.frameWidth=S.frameWidth,this.frameHeight=S.frameHeight,this.curTotalEncodeTime=S.totalEncodeTime,this.curTotalPacketSendDelay=S.totalPacketSendDelay,this.curPacketsSent=S.packetsSent):T==="audio"&&(this.curAudioBytesSent=S.bytesSent,this.curAudioRetransmittedBytesSent=S.retransmittedBytesSent)},p.prototype.onRemoteCandidate=function(S){this.curTimeStamp=S.timestamp,this.remoteProtocol=S.protocol,this.remoteTransportAddr=(S.ip||S.address)+(S.port?":"+S.port.toFixed(0):"")},p.prototype.onLocalCandidate=function(S){this.curTimeStamp=S.timestamp,this.localProtocol=S.protocol,this.localTransportAddr=(S.ip||S.address)+(S.port?":"+S.port.toFixed(0):"")},p})();c.SenderMonitorData=l},9752:function(g,c,s){var d,l=this&&this.__extends||(d=function(h,m){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_,A){_.__proto__=A}||function(_,A){for(var E in A)Object.prototype.hasOwnProperty.call(A,E)&&(_[E]=A[E])},d(h,m)},function(h,m){if(typeof m!="function"&&m!==null)throw new TypeError("Class extends value "+String(m)+" is not a constructor or null");function _(){this.constructor=h}d(h,m),h.prototype=m===null?Object.create(m):(_.prototype=m.prototype,new _)}),p=this&&this.__assign||function(){return p=Object.assign||function(h){for(var m,_=1,A=arguments.length;_<A;_++)for(var E in m=arguments[_])Object.prototype.hasOwnProperty.call(m,E)&&(h[E]=m[E]);return h},p.apply(this,arguments)},S=this&&this.__spreadArray||function(h,m,_){if(_||arguments.length===2)for(var A,E=0,b=m.length;E<b;E++)!A&&E in m||(A||(A=Array.prototype.slice.call(m,0,E)),A[E]=m[E]);return h.concat(A||Array.prototype.slice.call(m))},T=this&&this.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(c,"__esModule",{value:!0}),c.PubMonitor=void 0;var y=T(s(102)),R=s(5657),v=(function(h){function m(){var _=h.call(this)||this;return _.heartbeatHandle=null,_.pc=null,_.pcCore=null,_.senderMonitorDataList=[],_}return l(m,h),m.prototype.startHeartbeat=function(_,A,E){var b=this;this.pc=_,this.pcCore=A,this.updateSenders(),this.stopHeartbeat(),this.heartbeatHandle=setInterval((function(){b.emitHeartBeat()}),E||1e3)},m.prototype.stopHeartbeat=function(){this.heartbeatHandle!==null&&clearInterval(this.heartbeatHandle),this.heartbeatHandle=null},m.prototype.addTrackPair=function(_,A,E,b,w){var C=this;if(_){var P=new R.SenderMonitorData;if(A){P.videoSender=A;var U=A.transport;U&&(U.onstatechange=function(){var L,H,O,x;C.emit("onTransportStateEvent",{url:_,type:"pub",kind:"video",state:U.state,protocol:(x=(O=(H=(L=U.iceTransport)===null||L===void 0?void 0:L.getSelectedCandidatePair)===null||H===void 0?void 0:H.call(L))===null||O===void 0?void 0:O.local)===null||x===void 0?void 0:x.protocol})})}if(E){P.audioSender=E;var B=E.transport;B&&(B.onstatechange=function(){var L,H,O,x;C.emit("onTransportStateEvent",{url:_,type:"pub",kind:"audio",state:B.state,protocol:(x=(O=(H=(L=B.iceTransport)===null||L===void 0?void 0:L.getSelectedCandidatePair)===null||H===void 0?void 0:H.call(L))===null||O===void 0?void 0:O.local)===null||x===void 0?void 0:x.protocol})})}this.senderMonitorDataList.push({url:_,vMsid:b,aMsid:w,senderData:P})}},m.prototype.updateSenders=function(){var _,A=this,E=(_=this.pcCore)===null||_===void 0?void 0:_.getStreamManager().getAllTrackPairList("pub");this.senderMonitorDataList=[],E?.forEach((function(b){A.addTrackPair(b.url,b.vTransceiver,b.aTransceiver,b.vMsid,b.aMsid)}))},m.prototype.emitHeartBeat=function(){var _=this;Promise.all(this.senderMonitorDataList.reduce((function(A,E){return S(S([],A,!0),[E.senderData.getInfo()],!1)}),[])).then((function(){})).catch((function(A){})).finally((function(){var A=_.senderMonitorDataList.map((function(E){return p(p({},E.senderData.monitorData),{url:E.url,vMsid:E.vMsid,aMsid:E.aMsid})}));_.emit("onMonitorEvent",{eventList:A,type:"pub"})}))},m})(y.default);c.PubMonitor=v},4699:function(g,c,s){var d,l=this&&this.__extends||(d=function(A,E){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,w){b.__proto__=w}||function(b,w){for(var C in w)Object.prototype.hasOwnProperty.call(w,C)&&(b[C]=w[C])},d(A,E)},function(A,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");function b(){this.constructor=A}d(A,E),A.prototype=E===null?Object.create(E):(b.prototype=E.prototype,new b)}),p=this&&this.__awaiter||function(A,E,b,w){return new(b||(b=Promise))((function(C,P){function U(H){try{L(w.next(H))}catch(O){P(O)}}function B(H){try{L(w.throw(H))}catch(O){P(O)}}function L(H){var O;H.done?C(H.value):(O=H.value,O instanceof b?O:new b((function(x){x(O)}))).then(U,B)}L((w=w.apply(A,E||[])).next())}))},S=this&&this.__generator||function(A,E){var b,w,C,P,U={label:0,sent:function(){if(1&C[0])throw C[1];return C[1]},trys:[],ops:[]};return P={next:B(0),throw:B(1),return:B(2)},typeof Symbol=="function"&&(P[Symbol.iterator]=function(){return this}),P;function B(L){return function(H){return(function(O){if(b)throw new TypeError("Generator is already executing.");for(;P&&(P=0,O[0]&&(U=0)),U;)try{if(b=1,w&&(C=2&O[0]?w.return:O[0]?w.throw||((C=w.return)&&C.call(w),0):w.next)&&!(C=C.call(w,O[1])).done)return C;switch(w=0,C&&(O=[2&O[0],C.value]),O[0]){case 0:case 1:C=O;break;case 4:return U.label++,{value:O[1],done:!1};case 5:U.label++,w=O[1],O=[0];continue;case 7:O=U.ops.pop(),U.trys.pop();continue;default:if(C=U.trys,!((C=C.length>0&&C[C.length-1])||O[0]!==6&&O[0]!==2)){U=0;continue}if(O[0]===3&&(!C||O[1]>C[0]&&O[1]<C[3])){U.label=O[1];break}if(O[0]===6&&U.label<C[1]){U.label=C[1],C=O;break}if(C&&U.label<C[2]){U.label=C[2],U.ops.push(O);break}C[2]&&U.ops.pop(),U.trys.pop();continue}O=E.call(A,U)}catch(x){O=[6,x],w=0}finally{b=C=0}if(5&O[0])throw O[1];return{value:O[0]?O[1]:void 0,done:!0}})([L,H])}}},T=this&&this.__spreadArray||function(A,E,b){if(b||arguments.length===2)for(var w,C=0,P=E.length;C<P;C++)!w&&C in E||(w||(w=Array.prototype.slice.call(E,0,C)),w[C]=E[C]);return A.concat(w||Array.prototype.slice.call(E))},y=this&&this.__importDefault||function(A){return A&&A.__esModule?A:{default:A}};Object.defineProperty(c,"__esModule",{value:!0}),c.SubMonitor=void 0;var R=s(6901),v=s(5250),h=y(s(102)),m=(function(){function A(){this.trackPairDataList=[]}return A.prototype.reset=function(){this.trackPairDataList=[]},A.prototype.addTrackPair=function(E,b,w,C,P,U){var B=new R.AudioReceiverMonitorData,L=new v.VideoReceiverMonitorData;C&&(L.rtpReceiver=C),P&&(B.rtpReceiver=P),U&&(L.RTCPeerconnection=U,B.RTCPeerconnection=U),this.trackPairDataList.push({url:E,vMsid:b,aMsid:w,audioReceiverMonitorData:B,videoReceiverMonitorData:L})},A})(),_=(function(A){function E(){var b=A.call(this)||this;return b.canplay=!1,b.pc=null,b.pcCore=null,b.monitorTimerId=null,b.audioReceiverMonitorData=new R.AudioReceiverMonitorData,b.videoReceiverMonitorData=new v.VideoReceiverMonitorData,b.receiverMonitorController=new m,b}return l(E,A),E.prototype.start=function(b,w){this.pc=b,this.pcCore=w,this.updateTranceiversController(),this.startMonitorTimer(200)},E.prototype.updateTranceiversController=function(){var b=this;if(this.pc&&this.pcCore){var w=this.pcCore.getStreamManager().getAllTrackPairList("sub");this.receiverMonitorController.reset(),w.forEach((function(C){C.url&&b.receiverMonitorController.addTrackPair(C.url,C.vMsid,C.aMsid,C.vTransceiver,C.aTransceiver,b.pc)})),this.receiverMonitorController.trackPairDataList.forEach((function(C){b.initEvent(C)}))}},E.prototype.resetTimer=function(b){this.updateTranceiversController(),this.stopMonitorTimer(),this.startMonitorTimer(b)},E.prototype.stop=function(){this.canplay=!1,this.stopMonitorTimer(),this.audioReceiverMonitorData.dispose(),this.videoReceiverMonitorData.dispose()},E.prototype.startMonitorTimer=function(b){var w=this;this.monitorTimerId||(this.monitorTimerId=window.setInterval((function(){w.onMonitorTimer()}),b))},E.prototype.stopMonitorTimer=function(){this.monitorTimerId&&clearInterval(this.monitorTimerId),this.monitorTimerId=null},E.prototype.onMonitorTimer=function(){return p(this,void 0,void 0,(function(){var b;return S(this,(function(w){switch(w.label){case 0:return[4,this.updateMonitorData()];case 1:return w.sent(),b=[],this.receiverMonitorController.trackPairDataList.forEach((function(C){var P,U;if(C.url){var B={url:C.url};C.audioReceiverMonitorData.isExist&&(B.audio=(P=C.audioReceiverMonitorData)===null||P===void 0?void 0:P.monitorData,B.aMsid=C.aMsid),C.videoReceiverMonitorData.isExist&&(B.video=(U=C.videoReceiverMonitorData)===null||U===void 0?void 0:U.monitorData,B.vMsid=C.vMsid),b.push(B)}})),this.emit("onMonitorEvent",{eventList:b,type:"sub"}),[2]}}))}))},E.prototype.initEvent=function(b){var w=this,C={url:b.url||"url unknown",vMsid:b.vMsid||"vMsid unknown",aMsid:b.aMsid||"aMsid unknown"};b.audioReceiverMonitorData.isExist&&(b.audioReceiverMonitorData.on("streamEnded",(function(){b.videoReceiverMonitorData&&!b.videoReceiverMonitorData.isStreamEnded||(w.emit("streamEnded",C),w.stopMonitorTimer())})),b.audioReceiverMonitorData.on("canPlay",(function(){w.emitCanPlay()}))),b.videoReceiverMonitorData.isExist&&(b.videoReceiverMonitorData.on("streamEnded",(function(){b.audioReceiverMonitorData&&!b.audioReceiverMonitorData.isStreamEnded||(w.emit("streamEnded",C),w.stopMonitorTimer())})),b.videoReceiverMonitorData.on("canPlay",(function(){w.emitCanPlay()})))},E.prototype.updateMonitorData=function(){return Promise.all(this.receiverMonitorController.trackPairDataList.reduce((function(b,w){var C,P;return T(T([],b,!0),[(C=w.audioReceiverMonitorData)===null||C===void 0?void 0:C.getInfo(),(P=w.videoReceiverMonitorData)===null||P===void 0?void 0:P.getInfo()],!1)}),[]))},E.prototype.emitCanPlay=function(){this.canplay||(this.canplay=!0,this.emit("canPlay"))},E.prototype.copyMonitorData=function(){var b,w;!((w=(b=this.receiverMonitorController)===null||b===void 0?void 0:b.trackPairDataList)===null||w===void 0)&&w.length&&(this.audioReceiverMonitorData=this.receiverMonitorController.trackPairDataList[0].audioReceiverMonitorData,this.videoReceiverMonitorData=this.receiverMonitorController.trackPairDataList[0].videoReceiverMonitorData)},E.prototype.getTransportStats=function(){return p(this,void 0,void 0,(function(){var b;return S(this,(function(w){switch(w.label){case 0:return[4,this.updateMonitorData()];case 1:return w.sent(),this.copyMonitorData(),b={},this.videoReceiverMonitorData.isExist?b=this.videoReceiverMonitorData.monitorData.transportStats:this.audioReceiverMonitorData.isExist&&(b=this.audioReceiverMonitorData.monitorData.transportStats),[2,b]}}))}))},E.prototype.getRemoteVideoStats=function(){return p(this,void 0,void 0,(function(){var b,w;return S(this,(function(C){switch(C.label){case 0:return[4,this.updateMonitorData()];case 1:return C.sent(),this.copyMonitorData(),b={},this.videoReceiverMonitorData.isExist&&(w=this.videoReceiverMonitorData.monitorData.inboundRtpStats,b={timestamp:Math.floor(w.timestamp||0),framesDecodedPerSecond:w.framesPerSecond,framesDecoded:w.framesDecoded,frameWidth:w.frameWidth,frameHeight:w.frameHeight,bytesReceived:w.bytesReceived,jitter:w.jitter,jitterBufferDelayAvg:Number(w.jitterBufferDelay)/Number(w.jitterBufferEmittedCount),packetsLost:w.packetsLost,packetsReceived:w.packetsReceived}),[2,b]}}))}))},E.prototype.getRemoteAudioStats=function(){return p(this,void 0,void 0,(function(){var b,w;return S(this,(function(C){switch(C.label){case 0:return[4,this.updateMonitorData()];case 1:return C.sent(),this.copyMonitorData(),b={},this.audioReceiverMonitorData.isExist&&(w=this.audioReceiverMonitorData.monitorData.inboundRtpStats,b={timestamp:Math.floor(w.timestamp||0),bytesReceived:w.bytesReceived,jitter:w.jitter,jitterBufferDelayAvg:Number(w.jitterBufferDelay)/Number(w.jitterBufferEmittedCount),packetsLost:w.packetsLost,packetsReceived:w.packetsReceived}),[2,b]}}))}))},E})(h.default);c.SubMonitor=_},5259:(g,c)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.AudioProfileMap=c.VideoProfileMap=c.ScreenProfileMap=void 0,c.ScreenProfileMap=new Map,c.ScreenProfileMap.set("480p_1",{width:640,height:480,frameRate:5,maxBitrate:300}),c.ScreenProfileMap.set("480p_2",{width:640,height:480,frameRate:30,maxBitrate:1e3}),c.ScreenProfileMap.set("720p_1",{width:1280,height:720,frameRate:5,maxBitrate:800}),c.ScreenProfileMap.set("720p_2",{width:1280,height:720,frameRate:30,maxBitrate:2e3}),c.ScreenProfileMap.set("1080p_1",{width:1920,height:1080,frameRate:5,maxBitrate:1e3}),c.ScreenProfileMap.set("1080p_2",{width:1920,height:1080,frameRate:30,maxBitrate:3e3}),c.VideoProfileMap=new Map,c.VideoProfileMap.set("120p_1",{width:160,height:120,frameRate:15,maxBitrate:65}),c.VideoProfileMap.set("120p_3",{width:120,height:120,frameRate:15,maxBitrate:50}),c.VideoProfileMap.set("180p_1",{width:320,height:180,frameRate:15,maxBitrate:140}),c.VideoProfileMap.set("180p_3",{width:180,height:180,frameRate:15,maxBitrate:100}),c.VideoProfileMap.set("180p_4",{width:240,height:180,frameRate:15,maxBitrate:120}),c.VideoProfileMap.set("240p_1",{width:320,height:240,frameRate:15,maxBitrate:200}),c.VideoProfileMap.set("240p_3",{width:240,height:240,frameRate:15,maxBitrate:140}),c.VideoProfileMap.set("240p_4",{width:424,height:240,frameRate:15,maxBitrate:220}),c.VideoProfileMap.set("360p_1",{width:640,height:360,frameRate:15,maxBitrate:400}),c.VideoProfileMap.set("360p_3",{width:360,height:360,frameRate:15,maxBitrate:260}),c.VideoProfileMap.set("360p_4",{width:640,height:360,frameRate:30,maxBitrate:600}),c.VideoProfileMap.set("360p_6",{width:360,height:360,frameRate:30,maxBitrate:400}),c.VideoProfileMap.set("360p_7",{width:480,height:360,frameRate:15,maxBitrate:320}),c.VideoProfileMap.set("360p_8",{width:480,height:360,frameRate:30,maxBitrate:490}),c.VideoProfileMap.set("360p_9",{width:640,height:360,frameRate:15,maxBitrate:800}),c.VideoProfileMap.set("360p_10",{width:640,height:360,frameRate:24,maxBitrate:800}),c.VideoProfileMap.set("360p_11",{width:640,height:360,frameRate:24,maxBitrate:1e3}),c.VideoProfileMap.set("480p_1",{width:640,height:480,frameRate:15,maxBitrate:500}),c.VideoProfileMap.set("480p_2",{width:640,height:480,frameRate:30,maxBitrate:1e3}),c.VideoProfileMap.set("480p_3",{width:480,height:480,frameRate:15,maxBitrate:400}),c.VideoProfileMap.set("480p_4",{width:640,height:480,frameRate:30,maxBitrate:750}),c.VideoProfileMap.set("480p_6",{width:480,height:480,frameRate:30,maxBitrate:600}),c.VideoProfileMap.set("480p_8",{width:848,height:480,frameRate:15,maxBitrate:610}),c.VideoProfileMap.set("480p_9",{width:848,height:480,frameRate:30,maxBitrate:930}),c.VideoProfileMap.set("480p_10",{width:640,height:480,frameRate:10,maxBitrate:400}),c.VideoProfileMap.set("720p_1",{width:1280,height:720,frameRate:15,maxBitrate:1130}),c.VideoProfileMap.set("720p_2",{width:1280,height:720,frameRate:30,maxBitrate:2e3}),c.VideoProfileMap.set("720p_3",{width:1280,height:720,frameRate:30,maxBitrate:1710}),c.VideoProfileMap.set("720p_5",{width:960,height:720,frameRate:15,maxBitrate:910}),c.VideoProfileMap.set("720p_6",{width:960,height:720,frameRate:30,maxBitrate:1380}),c.VideoProfileMap.set("1080p_1",{width:1920,height:1080,frameRate:15,maxBitrate:2080}),c.VideoProfileMap.set("1080p_2",{width:1920,height:1080,frameRate:30,maxBitrate:3e3}),c.VideoProfileMap.set("1080p_3",{width:1920,height:1080,frameRate:30,maxBitrate:3150}),c.VideoProfileMap.set("1080p_5",{width:1920,height:1080,frameRate:60,maxBitrate:4780}),c.VideoProfileMap.set("1440p_1",{width:2560,height:1440,frameRate:30,maxBitrate:4850}),c.VideoProfileMap.set("1440p_2",{width:2560,height:1440,frameRate:60,maxBitrate:7350}),c.VideoProfileMap.set("4K_1",{width:3840,height:2160,frameRate:30,maxBitrate:8910}),c.VideoProfileMap.set("4K_3",{width:3840,height:2160,frameRate:60,maxBitrate:13500}),c.AudioProfileMap=new Map,c.AudioProfileMap.set("standard",{sampleRate:48e3,channelCount:1,maxBitrate:64}),c.AudioProfileMap.set("high",{sampleRate:48e3,channelCount:1,maxBitrate:128}),c.AudioProfileMap.set("standard-stereo",{sampleRate:48e3,channelCount:2,maxBitrate:80}),c.AudioProfileMap.set("high-stereo",{sampleRate:48e3,channelCount:2,maxBitrate:192})},5553:(g,c)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.Datachannel=void 0;var s=(function(){function d(l){this.pc=l,this.messageId=1,this.dataChannel=this.pc.createDataChannel("GRTNDataChannel"),this.dataChannel.onopen=function(p){},this.dataChannel.onmessage=function(p){p.data},this.dataChannel.onclose=function(p){},this.dataChannel.onerror=function(p){}}return d.prototype.addTrack=function(l,p){return new Promise((function(S,T){}))},d.prototype.removeTrack=function(l,p){return new Promise((function(S,T){}))},d.prototype.createPublishPacket=function(){var l={type:"pub",version:1,msg_id:this.messageId,streams:[]};return++this.messageId,l},d})();c.Datachannel=s},2470:function(g,c,s){var d,l=this&&this.__extends||(d=function(E,b){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,C){w.__proto__=C}||function(w,C){for(var P in C)Object.prototype.hasOwnProperty.call(C,P)&&(w[P]=C[P])},d(E,b)},function(E,b){if(typeof b!="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function w(){this.constructor=E}d(E,b),E.prototype=b===null?Object.create(b):(w.prototype=b.prototype,new w)}),p=this&&this.__assign||function(){return p=Object.assign||function(E){for(var b,w=1,C=arguments.length;w<C;w++)for(var P in b=arguments[w])Object.prototype.hasOwnProperty.call(b,P)&&(E[P]=b[P]);return E},p.apply(this,arguments)},S=this&&this.__awaiter||function(E,b,w,C){return new(w||(w=Promise))((function(P,U){function B(O){try{H(C.next(O))}catch(x){U(x)}}function L(O){try{H(C.throw(O))}catch(x){U(x)}}function H(O){var x;O.done?P(O.value):(x=O.value,x instanceof w?x:new w((function(F){F(x)}))).then(B,L)}H((C=C.apply(E,b||[])).next())}))},T=this&&this.__generator||function(E,b){var w,C,P,U,B={label:0,sent:function(){if(1&P[0])throw P[1];return P[1]},trys:[],ops:[]};return U={next:L(0),throw:L(1),return:L(2)},typeof Symbol=="function"&&(U[Symbol.iterator]=function(){return this}),U;function L(H){return function(O){return(function(x){if(w)throw new TypeError("Generator is already executing.");for(;U&&(U=0,x[0]&&(B=0)),B;)try{if(w=1,C&&(P=2&x[0]?C.return:x[0]?C.throw||((P=C.return)&&P.call(C),0):C.next)&&!(P=P.call(C,x[1])).done)return P;switch(C=0,P&&(x=[2&x[0],P.value]),x[0]){case 0:case 1:P=x;break;case 4:return B.label++,{value:x[1],done:!1};case 5:B.label++,C=x[1],x=[0];continue;case 7:x=B.ops.pop(),B.trys.pop();continue;default:if(P=B.trys,!((P=P.length>0&&P[P.length-1])||x[0]!==6&&x[0]!==2)){B=0;continue}if(x[0]===3&&(!P||x[1]>P[0]&&x[1]<P[3])){B.label=x[1];break}if(x[0]===6&&B.label<P[1]){B.label=P[1],P=x;break}if(P&&B.label<P[2]){B.label=P[2],B.ops.push(x);break}P[2]&&B.ops.pop(),B.trys.pop();continue}x=b.call(E,B)}catch(F){x=[6,F],C=0}finally{w=P=0}if(5&x[0])throw x[1];return{value:x[0]?x[1]:void 0,done:!0}})([H,O])}}},y=this&&this.__importDefault||function(E){return E&&E.__esModule?E:{default:E}};Object.defineProperty(c,"__esModule",{value:!0}),c.PcRestorer=void 0;var R=y(s(102)),v=s(5917),h=s(280),m=s(9428),_=s(5044),A=(function(E){function b(w){var C=E.call(this)||this;return C.restoring=!1,C.subscriber=w.subscriber,C.publisher=w.publisher,C.commonController=w.commonController,C}return l(b,E),b.prototype.isReconnecting=function(){return this.restoring},b.prototype.restore=function(w){var C,P=this;if(!this.restoring)return new Promise((function(U,B){return S(P,void 0,void 0,(function(){var L,H,O,x,F,N,k,M,j,G,z,V,re=this;return T(this,(function(Q){switch(Q.label){case 0:if(this.restoring=!0,!(L=this.restructureStreams())||!L.length)return[3,9];switch(this.subscriber.unsubscribe(),this.publisher.unpublish(),H=Promise.reject().catch((function(){})),O=L[0],x={retryTimes:v.DEFAULT_RETRY_SUBSCRIBE_LIMIT,retryInterval:v.DEFAULT_RETRY_SUBSCRIBE_INTERVAL},F=O.url,w&&(F=this.makeIpQuery(F,w,O.type)),O.type){case"sub":this.commonController.setPeerconnection(this.subscriber.getPeerConnection()),this.subscriber.incrementReconnectTimes(),x.retryTimes=this.subscriber.getSubscribeConfig().retryTimes||v.DEFAULT_RETRY_SUBSCRIBE_LIMIT,x.retryInterval=this.subscriber.getSubscribeConfig().retryInterval||v.DEFAULT_RETRY_SUBSCRIBE_INTERVAL,H=this.subscriber.subscribeWithReconnect(F,p(p({},this.subscriber.getSubscribeConfig()),{vMsid:O.vMsid,aMsid:O.aMsid}));break;case"pub":O.targetStream&&(this.commonController.setPeerconnection(this.publisher.getPeerConnection()),this.publisher.incrementReconnectTimes(),x.retryTimes=this.publisher.getPublishConfig().retryTimes||v.DEFAULT_RETRY_PUBLISH_LIMIT,x.retryInterval=this.publisher.getPublishConfig().retryInterval||v.DEFAULT_RETRY_PUBLISH_INTERVAL,H=this.publisher.publishWithReconnect(F,O.targetStream,p(p({},this.publisher.getPublishConfig()),{vMsid:O.vMsid,aMsid:O.aMsid})));break;case"sub-data":O.msid&&O.label&&(H=this.commonController.subscribeAddDatachannel({signalUrl:F,url:F,label:O.label,msid:O.msid}));break;case"pub-data":O.msid&&O.label&&(H=this.commonController.publishAddDatachannel({signalUrl:O.url,url:O.url,label:O.label,msid:O.msid}));break;default:console.log("RTS [PC RESTORER] unknown http reconnect type",O.type)}Q.label=1;case 1:return Q.trys.push([1,3,,4]),[4,H];case 2:return N=Q.sent(),C=typeof N=="string"?N:N?.traceId,[3,4];case 3:return k=Q.sent(),B(k),this.restoring=!1,[2];case 4:M=new Promise((function(Z,q){clearTimeout(re.dcOpenTimer),re.dcOpenTimer=setTimeout((function(){var Y=new _.RtsError(m.ErrorCode.ERROR_DATACHANNEL_OPEN,"reconnect pc datachannel open timeout after ".concat(v.DEFAULT_RETRY_DATACHANNEL_TIMEOUT,"ms"),"",{});q(Y)}),v.DEFAULT_RETRY_DATACHANNEL_TIMEOUT),re.commonController.on("datachannelStatusChange",(function(Y){Y.status===h.EDatachannelStatus.DATACHANNEL_STATUS_OPEN&&(clearTimeout(re.dcOpenTimer),Z())}))})),Q.label=5;case 5:return Q.trys.push([5,7,,8]),[4,M];case 6:return Q.sent(),[3,8];case 7:return j=Q.sent(),B(j),this.restoring=!1,[2];case 8:for(G=[],z=1;z<L.length;z++)if(V=L[z])switch(V.type){case"sub":G.push(this.commonController.subscribeAdd([{url:V.url,vMsid:V.vMsid,aMsid:V.aMsid,targetStream:V.targetStream,subAudio:!(!V.aMsid||!V.aMsid.length),subVideo:!(!V.vMsid||!V.vMsid.length)}],!0).catch((function(Z){re.emit("onError",re.makeSingleStreamReconnectError(Z))})));break;case"pub":G.push(this.commonController.publishAdd([{url:V.url,stream:V.targetStream,vMsid:V.vMsid,aMsid:V.aMsid}]).catch((function(Z){re.emit("onError",re.makeSingleStreamReconnectError(Z))})));break;case"sub-data":V.label&&V.msid&&G.push(this.commonController.subscribeAddDatachannel({signalUrl:V.url,url:V.url,label:V.label,msid:V.msid}).catch((function(Z){re.emit("onError",re.makeSingleStreamReconnectError(Z))})));break;case"pub-data":V.label&&V.msid&&G.push(this.commonController.publishAddDatachannel({signalUrl:V.url,url:V.url,label:V.label,msid:V.msid}).catch((function(Z){re.emit("onError",re.makeSingleStreamReconnectError(Z))})));break;default:console.log("RTS [PC RESTORER] unknown pc reconnect type")}Promise.allSettled(G).then((function(Z){var q,Y,J=Z.find((function($){return $.status==="fulfilled"}));C=((Y=(q=J?.value)===null||q===void 0?void 0:q[0])===null||Y===void 0?void 0:Y.traceId)||C,U({traceId:C,latestUrl:F})})),Q.label=9;case 9:return this.restoring=!1,[2]}}))}))}))},b.prototype.restructureStreams=function(){var w,C,P=(w=this.commonController.peerCore)===null||w===void 0?void 0:w.getStreamManager(),U=(C=this.commonController.peerCore)===null||C===void 0?void 0:C.getDatachannelManager(),B=P?.getAllStreamListWithMsids(),L=U?.getAllList(),H=[];return B?.forEach((function(O){var x;(x=O.streams)===null||x===void 0||x.forEach((function(F){var N=[],k=[],M=O.type,j=O.latestUrl,G=F;O.msids.forEach((function(z){z.streamId===F.id&&(z.type==="video"?k.push(z.name):z.type==="audio"&&N.push(z.name))})),H.push({aMsid:N,vMsid:k,type:M,url:j,targetStream:G})}))})),L?.forEach((function(O){O.msids.forEach((function(x){if(x.name&&x.label){var F=x.name,N=x.label,k=O.type,M=O.latestUrl;H.push({msid:F,type:k,label:N,url:M})}}))})),H},b.prototype.dispose=function(){this.removeAllListeners()},b.prototype.makeSingleStreamReconnectError=function(w){return new _.RtsError(m.ErrorCode.ERROR_SINGLE_PC_STREAM_RECONNECT_FAILED,"single stream reconnect failed","",{originError:w})},b.prototype.makeIpQuery=function(w,C,P){var U,B,L,H="ali_prefer_media_server",O="ip_migration",x=w,F="";if(P.indexOf("sub")===0&&(!((B=C.pull)===null||B===void 0)&&B.length)?F=C.pull[0]:P.indexOf("pub")===0&&(!((L=C.push)===null||L===void 0)&&L.length)&&(F=C.push[0]),F){var N=w.split("?"),k=N[0],M=N[1],j=void 0;M?((j=new URLSearchParams(M)).has(H)?j.set(H,F):j.append(H,F),!j.has(O)&&j.append(O,"on")):j=new URLSearchParams(((U={})[H]=F,U[O]="on",U)),x="".concat(k,"?").concat(j.toString())}return x},b})(R.default);c.PcRestorer=A},4865:function(g,c,s){var d,l=this&&this.__extends||(d=function(N,k){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(M,j){M.__proto__=j}||function(M,j){for(var G in j)Object.prototype.hasOwnProperty.call(j,G)&&(M[G]=j[G])},d(N,k)},function(N,k){if(typeof k!="function"&&k!==null)throw new TypeError("Class extends value "+String(k)+" is not a constructor or null");function M(){this.constructor=N}d(N,k),N.prototype=k===null?Object.create(k):(M.prototype=k.prototype,new M)}),p=this&&this.__assign||function(){return p=Object.assign||function(N){for(var k,M=1,j=arguments.length;M<j;M++)for(var G in k=arguments[M])Object.prototype.hasOwnProperty.call(k,G)&&(N[G]=k[G]);return N},p.apply(this,arguments)},S=this&&this.__awaiter||function(N,k,M,j){return new(M||(M=Promise))((function(G,z){function V(Z){try{Q(j.next(Z))}catch(q){z(q)}}function re(Z){try{Q(j.throw(Z))}catch(q){z(q)}}function Q(Z){var q;Z.done?G(Z.value):(q=Z.value,q instanceof M?q:new M((function(Y){Y(q)}))).then(V,re)}Q((j=j.apply(N,k||[])).next())}))},T=this&&this.__generator||function(N,k){var M,j,G,z,V={label:0,sent:function(){if(1&G[0])throw G[1];return G[1]},trys:[],ops:[]};return z={next:re(0),throw:re(1),return:re(2)},typeof Symbol=="function"&&(z[Symbol.iterator]=function(){return this}),z;function re(Q){return function(Z){return(function(q){if(M)throw new TypeError("Generator is already executing.");for(;z&&(z=0,q[0]&&(V=0)),V;)try{if(M=1,j&&(G=2&q[0]?j.return:q[0]?j.throw||((G=j.return)&&G.call(j),0):j.next)&&!(G=G.call(j,q[1])).done)return G;switch(j=0,G&&(q=[2&q[0],G.value]),q[0]){case 0:case 1:G=q;break;case 4:return V.label++,{value:q[1],done:!1};case 5:V.label++,j=q[1],q=[0];continue;case 7:q=V.ops.pop(),V.trys.pop();continue;default:if(G=V.trys,!((G=G.length>0&&G[G.length-1])||q[0]!==6&&q[0]!==2)){V=0;continue}if(q[0]===3&&(!G||q[1]>G[0]&&q[1]<G[3])){V.label=q[1];break}if(q[0]===6&&V.label<G[1]){V.label=G[1],G=q;break}if(G&&V.label<G[2]){V.label=G[2],V.ops.push(q);break}G[2]&&V.ops.pop(),V.trys.pop();continue}q=k.call(N,V)}catch(Y){q=[6,Y],j=0}finally{M=G=0}if(5&q[0])throw q[1];return{value:q[0]?q[1]:void 0,done:!0}})([Q,Z])}}},y=this&&this.__importDefault||function(N){return N&&N.__esModule?N:{default:N}};Object.defineProperty(c,"__esModule",{value:!0}),c.RtsPeerconnection=void 0;var R,v=s(280),h=s(233),m=s(4315),_=s(2718),A=y(s(102)),E=s(1698),b=s(5917),w=s(4699),C=s(9752),P=s(5553),U=s(9428),B=s(5044),L=y(s(6834));(function(N){N.Subscribe="sub",N.Publish="pub"})(R||(R={}));var H=window.RTCRtpReceiver&&"createEncodedStreams"in RTCRtpReceiver.prototype,O=window.RTCRtpReceiver&&"transform"in RTCRtpReceiver.prototype&&"RTCRtpScriptTransform"in window,x=(function(N){function k(){var M=N.call(this)||this;return M.connectingEventSent=!1,M.reused=!1,M.transformWorkerList=new F,M.receiverCodecPreferences={},M.senderCodecPreferences={},M.heartbeatTimeoutHandler=null,M.noHeartbeatCount=0,M.subMonitor=new w.SubMonitor,M.subMonitor.on("onMonitorEvent",(function(j){M.emit("onMonitorEvent",j)})),M.subMonitor.on("streamEnded",(function(){M.emit("streamEnded")})),M.subMonitor.on("canPlay",(function(){})),M.pubMonitor=new C.PubMonitor,M.pubMonitor.on("onMonitorEvent",(function(j){M.emit("onMonitorEvent",j)})),M.pubMonitor.on("onTransportStateEvent",(function(j){M.emit("onTransportStateEvent",j)})),M}return l(k,N),Object.defineProperty(k.prototype,"isConnected",{get:function(){var M;return((M=this.pc)===null||M===void 0?void 0:M.connectionState)==="connected"},enumerable:!1,configurable:!0}),Object.defineProperty(k.prototype,"isReused",{get:function(){return this.reused},set:function(M){this.reused=!!M},enumerable:!1,configurable:!0}),k.prototype.getWorkerManager=function(){return this.transformWorkerList},k.prototype.getPc=function(){return this.pc},k.prototype.getPeerCore=function(){return this.peerCore},k.prototype.getSubMonitor=function(){return this.subMonitor},k.prototype.getPubMonitor=function(){return this.pubMonitor},k.prototype.playStart=function(){this.subMonitor.resetTimer(1e3)},k.prototype.pushStart=function(){this.pc&&this.peerCore&&this.pubMonitor.startHeartbeat(this.pc,this.peerCore)},k.prototype.sample=function(){return S(this,void 0,void 0,(function(){return T(this,(function(M){switch(M.label){case 0:return[4,this.subMonitor.onMonitorTimer()];case 1:return M.sent(),[2]}}))}))},k.prototype.subAdd=function(M,j){var G;return(G=this.peerCore)===null||G===void 0?void 0:G.subscribeAdd(M,j)},k.prototype.subActive=function(M){var j;return(j=this.peerCore)===null||j===void 0?void 0:j.subscribeActive(M)},k.prototype.subStop=function(M){var j;return(j=this.peerCore)===null||j===void 0?void 0:j.subscribeStop(M)},k.prototype.subDeleteTracks=function(M){var j;return(j=this.peerCore)===null||j===void 0?void 0:j.subscribeDeleteTracks(M)},k.prototype.pubAdd=function(M){var j;return(j=this.peerCore)===null||j===void 0?void 0:j.publishAdd(M)},k.prototype.pubDeleteTracks=function(M){var j;return(j=this.peerCore)===null||j===void 0?void 0:j.publishDeleteTracks(M)},k.prototype.pubReplaceTracks=function(M){var j;return(j=this.peerCore)===null||j===void 0?void 0:j.publishReplaceTracks(M)},k.prototype.pubStop=function(M){var j;return(j=this.peerCore)===null||j===void 0?void 0:j.publishStop(M)},k.prototype.createOffer=function(M,j,G,z){var V=this;return z===void 0&&(z={publishUrl:""}),new Promise((function(re,Q){var Z;(Z=V.cancelable)===null||Z===void 0||Z.cancel();var q={googCpuOveruseDetection:!1,sdpSemantics:"unified-plan",encodedInsertableStreams:z.encodedInsertableStreams,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"};if(h.BrowserUtil.isChrome&&Number(h.BrowserUtil.browserMainVersion)<=55&&(q.iceServers=[]),V.pc=new RTCPeerConnection(q),V.encodedInsertableStreams=z.encodedInsertableStreams,V.peerCore=new v.PeerConnectionCore({pc:V.pc,onDatachannelEvent:function(te){var ie,se;V.emit("datachannelStatusChange",{status:te}),z.disableHeartbeat||(te===v.EDatachannelStatus.DATACHANNEL_STATUS_OPEN?((0,_.hebtLog)("DATACHANNEL OPEN"," heartbeat send scheduler started"),(ie=V.peerCore)===null||ie===void 0||ie.startSignalHeartbeatTimer()):te===v.EDatachannelStatus.DATACHANNEL_STATUS_CLOSE&&((0,_.hebtLog)("DATACHANNEL CLOSE"," heartbeats from now on will fail"),(se=V.peerCore)===null||se===void 0||se.stopSignalHeartbeatTimer()))},onInnerSubscribeDelete:function(te){V.emit("innerSubscribeDeleteTracks",te)},offerSdpHook:z.offerSdpHook,answerSdpHook:z.answerSdpHook,delayOpen:E.configProvider.getContext().datachannelDelayOpen,signalDatachannelInitOptions:E.configProvider.getContext().signalDatachannelInitOptions}),V.registerPeerCoreListeners(z),V.peerCore.setReceiverCodecPreferences(V.receiverCodecPreferences),V.peerCore.setSenderCodecPreferences(V.senderCodecPreferences),V.pc.onconnectionstatechange=function(){var te=(V.pc||{}).connectionState;switch(V.connectingEventSent||(V.connectingEventSent=!0,V.emit("connectStatusChange",{status:b.EConnectStatus.CONNECT_STATUS_CONNECTING})),te!=="connecting"&&V.clearStatusTimer(),te){case"connected":V.emit("onConnected"),V.emit("connectStatusChange",{status:b.EConnectStatus.CONNECT_STATUS_CONNECTED});break;case"disconnected":V.emit("connectStatusChange",{status:b.EConnectStatus.CONNECT_STATUS_RECONNECTING});break;case"failed":case"closed":V.handleClosed()}},V.clearStatusTimer(),V.statusTimer=window.setTimeout((function(){V.handleClosed()}),k.CONNECT_TIMEOUT),G){V.localStream=G,V.sdpUtil=new m.SdpUtil(V.localStream);var Y=V.addStream();if(Y!==0)return V.pc=void 0,void Q(new B.RtsError(Y,Y===U.ErrorCode.ERROR_MEDIASTREAMTRACK_AUDIO_NONE?"need audio track":"",""))}else V.sdpUtil=new m.SdpUtil;var J={};G||(J=V.handleSubTransceiver(M,j).added?{}:{offerToReceiveAudio:M,offerToReceiveVideo:j});var $=V.pc.createOffer(J);V.cancelable=(0,_.makeCancelable)($),V.cancelable.promise.then((function(te){var ie,se,he,de,be,Re,Te;if(V.cancelable=void 0,V.sdpUtil){if(V.sdpUtil.init(String(te.sdp)),V.sdpUtil.addNack(),V.sdpUtil.addSps(),z.disableStereo||V.sdpUtil.addStereo(),z.cumuDelay&&(V.sdpUtil.setSingleNaluPackMode()||V.emit("cumuDelayNotSupported")),G&&V.sdpUtil.modifyTrackName({vMsid:z.vMsid&&z.vMsid[0],aMsid:z.aMsid&&z.aMsid[0]}),V.pc){if(te.sdp=V.sdpUtil.sdp,G&&G.sdpHook&&typeof G.sdpHook=="function")try{te.sdp=G.sdpHook(te.sdp)}catch(Le){console.log("Error in sdp hook",Le)}(ie=V.peerCore)===null||ie===void 0||ie.setPrevOfferSdp(te.sdp||"");var Ae=[];if(G)try{(se=V.peerCore)===null||se===void 0||se.patchPublishStreamManagerRecord(z.publishUrl||"",p(p({},z),{stream:G,cumuDelay:z.cumuDelay}));var Ie=(he=V.peerCore)===null||he===void 0?void 0:he.parseSdp(te.sdp||"");Ae=(de=V.peerCore)===null||de===void 0?void 0:de.updateTrackInfoList({url:z.publishUrl||"",stream:G,vMsid:(be=V.peerCore)===null||be===void 0?void 0:be.unifyMsid(z.vMsid,"video"),aMsid:(Re=V.peerCore)===null||Re===void 0?void 0:Re.unifyMsid(z.aMsid,"audio"),sdpMediaList:(Te=Ie?.detail)===null||Te===void 0?void 0:Te.media})}catch(Le){console.log(Le)}if(z.offerSdpHook&&typeof z.offerSdpHook=="function")try{te.sdp=z.offerSdpHook(te.sdp||"")}catch(Le){console.log("Error in offerSdpHook",Le)}V.pc.setLocalDescription(te).then((function(){V.pc?re({desp:V.pc.localDescription,publishTrackInfoList:Ae}):Q(new B.RtsError(U.ErrorCode.ERROR_CREATEOFFER,"no pc",""))})).catch((function(Le){Q(new B.RtsError(U.ErrorCode.ERROR_CREATEOFFER,"setLocalDescription error "+Le.message,""))}))}}else Q(new B.RtsError(U.ErrorCode.ERROR_CREATEOFFER,"no sdp",""))})).catch((function(te){te.isCanceled||Q(new B.RtsError(U.ErrorCode.ERROR_CREATEOFFER,te.message?te.message:"create offer error",""))}))}))},k.prototype.recvAnswer=function(M,j){var G,z,V=this;return j===void 0&&(j={}),(G=this.peerCore)===null||G===void 0||G.setPrevAnswerSdp((z=M?.jsep)===null||z===void 0?void 0:z.sdp),new Promise((function(re,Q){var Z,q,Y,J,$,te;if(V.pc){if(V.pc.ontrack=function(se){V.pc&&V.peerCore&&V.subMonitor.start(V.pc,V.peerCore),setTimeout((function(){V.handleEncodedInsertableStreams({receiver:se.receiver})})),V.isReused||V.emit("onTrackEvent",se)},V.pc.signalingState==="closed")return void Q({message:"PeerConnection signalingState is closed"});if(!((Z=M.jsep)===null||Z===void 0)&&Z.sdp){var ie=new m.SdpUtil;ie.init(String((q=M.jsep)===null||q===void 0?void 0:q.sdp)),V.localStream&&(V.localStream.audioTrack&&!V.localStream.videoTrack&&(ie.removeTwccRtcpFb(),(Y=V.peerCore)===null||Y===void 0||Y.setRemoveTwcc(!0)),ie.setDirection()),j.tcpOnly&&ie.hasTcpCandidate&&ie.removeUdpCandidate(),M.jsep.sdp=ie.sdp,(J=V.peerCore)===null||J===void 0||J.setPrevAnswerSdp(($=M?.jsep)===null||$===void 0?void 0:$.sdp)}if(!((te=M.jsep)===null||te===void 0)&&te.sdp&&j.answerSdpHook&&typeof j.answerSdpHook=="function")try{M.jsep.sdp=j.answerSdpHook(M.jsep.sdp)}catch(se){console.log("Error in answerSdpHook",se)}V.pc.setRemoteDescription(new RTCSessionDescription(M.jsep)).then((function(se){var he;V.pc&&V.localStream&&(V.localStream.setEncodeParam(V.pc),(he=V.pc)===null||he===void 0||he.getSenders().forEach((function(de){V.handleEncodedInsertableStreams({sender:de})}))),re(se)})).catch((function(se){se.sdp=M.jsep.sdp,Q(se)}))}else Q({message:"no PeerConnection"})}))},k.prototype.setReceiverCodecPreferences=function(M){var j;this.receiverCodecPreferences=p({},M),(j=this.peerCore)===null||j===void 0||j.setReceiverCodecPreferences(this.receiverCodecPreferences)},k.prototype.setSenderCodecPreferences=function(M){var j;this.senderCodecPreferences=p({},M),(j=this.peerCore)===null||j===void 0||j.setSenderCodecPreferences(this.senderCodecPreferences)},k.prototype.removeTrack=function(M,j){var G=this;return new Promise((function(z,V){G.pc&&G.dataChannel&&G.dataChannel.removeTrack(M,j).then((function(){})).catch((function(re){V(re)}))}))},k.prototype.replaceTrack=function(M,j,G){var z=this;return new Promise((function(V,re){G||z.pc&&z.dataChannel&&z.dataChannel.removeTrack(M,j).then((function(){})).catch((function(Q){re(Q)}))}))},k.prototype.sendSEI=function(M){var j;if(!M.data)throw new Error("No data to send, please check your params.");if(!(M.data instanceof ArrayBuffer))throw new Error("data should be ArrayBuffer, please check your params.");if(!M.url)throw new Error("url is required, please check your params.");if(!M.vMsid)throw new Error("vMsid is required, please check your params.");if(H||O){var G=this.transformWorkerList.findByMsid({url:M.url,kind:b.TrackType.VIDEO,source:b.EWorkerSource.Sender,msid:M.vMsid});if(!G)throw new Error("No published stream found, please check your url: "+M.url);(j=G?.worker)===null||j===void 0||j.postMessage({operation:b.EWorkerAction.InserSEI,payloadType:M.payloadType,repeatCount:M.repeatCount,keyframeOnly:M.keyframeOnly,sei:M.data})}},k.prototype.updateStatsForSEI=function(M,j){var G=this,z=j==="pub";this.encodedInsertableStreams&&(H||O)&&M.forEach((function(V){var re,Q=G.transformWorkerList.findByMsid({url:V.url,kind:b.TrackType.VIDEO,source:z?b.EWorkerSource.Sender:b.EWorkerSource.Receiver,msid:V.vMsid});Q&&((re=Q?.worker)===null||re===void 0||re.postMessage({operation:z?b.EWorkerAction.UpdatePubStats:b.EWorkerAction.UpdateSubStats,stats:V}))}))},k.prototype.reset=function(){this.cancelable&&(this.cancelable.cancel(),this.cancelable=void 0),this.peerCore&&(this.peerCore.dispose(),this.peerCore=void 0),this.pc&&(this.pc.onconnectionstatechange=function(){},this.pc.ontrack=function(){},this.pc.close(),this.pc=void 0,this.clearStatusTimer()),this.sdpUtil&&(this.sdpUtil.dispose(),this.sdpUtil=void 0),this.localStream&&(this.localStream=void 0),this.transformWorkerList.dispose(),this.subMonitor.stop(),this.pubMonitor.stopHeartbeat(),this.isReused=!1,this.encodedInsertableStreams=void 0,this.stopHeartbeatTimeoutChecker()},k.prototype.addStream=function(){if(this.localStream){if(this.pc){if(this.localStream.audioTrack){var M=this.pc.addTransceiver(this.localStream.audioTrack,{direction:"sendonly",streams:[this.localStream.mediaStream]});if(this.senderCodecPreferences.audio)try{M.setCodecPreferences(this.senderCodecPreferences.audio)}catch(G){console.warn("setCodecPreferences error",G)}}if(this.localStream.videoTrack){var j=this.pc.addTransceiver(this.localStream.videoTrack,{direction:"sendonly",streams:[this.localStream.mediaStream]});if(this.senderCodecPreferences.video)try{j.setCodecPreferences(this.senderCodecPreferences.video)}catch(G){console.warn("setCodecPreferences error",G)}}return 0}return U.ErrorCode.ERROR_PREERCONNECTION_UNKNOWN}return U.ErrorCode.ERROR_MEDIASTREAMTRACK_AUDIO_NONE},k.prototype.handleEncodedInsertableStreams=function(M){var j,G,z=this;if(this.encodedInsertableStreams){var V=M.receiver,re=M.sender,Q=V?b.EWorkerSource.Receiver:b.EWorkerSource.Sender,Z=V||re,q=Z.track;if(!q)return console.warn("no track in senderReceiver!");var Y=q.kind,J=(G=(j=this.peerCore)===null||j===void 0?void 0:j.getStreamManager())===null||G===void 0?void 0:G.getAllTrackPairList(Q===b.EWorkerSource.Receiver?R.Subscribe:R.Publish),$=J?.find((function(Re){var Te,Ae;return((Ae=(Te=Re[Y===b.TrackType.VIDEO?"vTransceiver":"aTransceiver"])===null||Te===void 0?void 0:Te.track)===null||Ae===void 0?void 0:Ae.id)===q.id}));if(!$)return console.warn("no existing stream info found");var te=new L.default;if(this.transformWorkerList.removeByMsid({url:$.url||"",kind:Y,source:Q,msid:(Y===b.TrackType.VIDEO?$.vMsid:$.aMsid)||""}),!this.transformWorkerList.add({worker:te,kind:Y,source:Q,info:$,receiver:V,sender:re}))return console.log("worker existing, skip.",Y);var ie=b.EWorkerAction.Setup,se=performance.timeOrigin;if(H){var he=Z.createEncodedStreams(),de=he.readable,be=he.writable;te.postMessage({source:Q,readable:de,writable:be,operation:ie},[de,be])}else O&&(Z.transform=new RTCRtpScriptTransform(te,{source:Q,operation:ie,windowTimeOrigin:se}));$.cumuDelay&&Y==="video"&&(te.postMessage({operation:b.EWorkerAction.SwitchCumuDelay,enable:!0,windowTimeOrigin:se}),H||O||this.emit("cumuDelayNotSupported")),te.onmessage=function(Re){var Te=Re.data,Ae=Te.type,Ie=Te.data,Le=Te.frameInfo;Ae==="encodedFrame"&&z.emit("encodedFrame",{kind:Y,url:$.originUrl,vMsid:Y==="video"?$?.vMsid:void 0,aMsid:Y==="audio"?$?.aMsid:void 0,frame:p({data:Ie},Le),subStats:Re.data.subStats})}}},k.prototype.handleSubTransceiver=function(M,j){var G,z,V,re=!1;if(!((G=this.pc)===null||G===void 0)&&G.addTransceiver){if(M&&(z=this.pc.addTransceiver("audio",{direction:"recvonly"}),this.receiverCodecPreferences.audio))try{z.setCodecPreferences(this.receiverCodecPreferences.audio)}catch(Q){console.warn("setCodecPreferences error",Q)}if(j&&(V=this.pc.addTransceiver("video",{direction:"recvonly"}),this.receiverCodecPreferences.video))try{V.setCodecPreferences(this.receiverCodecPreferences.video)}catch(Q){console.warn("setCodecPreferences error",Q)}re=!0}return{added:re,aTransceiver:z,vTransceiver:V}},k.prototype.initDataChannel=function(){!this.dataChannel&&this.pc&&(this.dataChannel=new P.Datachannel(this.pc))},k.prototype.handleClosed=function(){this.subMonitor.stop(),this.emit("connectStatusChange",{status:b.EConnectStatus.CONNECT_STATUS_DISCONNECTED}),this.emit("onEnd")},k.prototype.clearStatusTimer=function(){this.statusTimer&&clearTimeout(this.statusTimer),this.statusTimer=void 0},k.prototype.registerPeerCoreListeners=function(M){var j=this;this.peerCore?(M.disableHeartbeat||((0,_.hebtLog)("heartbeat [timeout checker] started"),this.startHeartbeatTimeoutChecker()),this.peerCore.on("message",(function(G){j.emit("message",G)})),this.peerCore.on("hebtReceived",(function(G){(0,_.hebtLog)("EVENT: HEBT RECV",G),j.noHeartbeatCount=0,j.emit("hebtReceived",G)})),this.peerCore.on("streamError",(function(G){(0,_.hebtLog)("EVENT: ",G),j.emit("streamError",G)})),this.peerCore.on("streamReconnect",(function(G){(0,_.hebtLog)("EVENT: ",G),j.emit("streamReconnect",G)})),this.peerCore.on("traceIdUpdate",(function(G){j.emit("traceIdUpdate",G)})),this.peerCore.on("pcReconnect",(function(G){(0,_.hebtLog)("EVENT: PC",G),j.emit("pcReconnect",G)})),this.peerCore.on("datachannelNotEnabled",(function(){var G;(0,_.hebtLog)("EVENT: "),j.stopHeartbeatTimeoutChecker(),(G=j.peerCore)===null||G===void 0||G.stopSignalHeartbeatTimer()}))):(0,_.hebtLog)("PeerCore listeners registration failed.")},k.prototype.startHeartbeatTimeoutChecker=function(){var M=this;this.stopHeartbeatTimeoutChecker(),this.heartbeatTimeoutHandler=setInterval((function(){M.noHeartbeatCount++,M.noHeartbeatCount>=b.DEFAULT_HEARTBEAT_TIMEOUT&&((0,_.hebtLog)("EVENT: , PC"),M.stopHeartbeatTimeoutChecker(),M.emit("pcReconnect",{recode:"",reMsg:"heartbeat timeout"}))}),1e3)},k.prototype.stopHeartbeatTimeoutChecker=function(){this.heartbeatTimeoutHandler!==null&&clearInterval(this.heartbeatTimeoutHandler),this.heartbeatTimeoutHandler=null,this.noHeartbeatCount=0},k.CONNECT_TIMEOUT=1e4,k})(A.default);c.RtsPeerconnection=x;var F=(function(){function N(){this.workerList=[]}return N.prototype.add=function(k){return!this.findByMsid({url:k.info.url,source:k.source,kind:k.kind,msid:k.kind===b.TrackType.VIDEO?k.info.vMsid:k.info.aMsid})&&(this.workerList.push(k),!0)},N.prototype.removeByUrl=function(k){var M=this;this.workerList.filter((function(j){return j.info.url.split("?")[0]===k.url.split("?")[0]&&j.source===k.source})).forEach((function(j){j.worker.terminate(),M.workerList=M.workerList.filter((function(G){return G!==j}))}))},N.prototype.removeByMsid=function(k){var M=this.findByMsid(k);M&&(M.worker.terminate(),this.workerList=this.workerList.filter((function(j){return j!==M})))},N.prototype.findByUrl=function(k,M){return this.workerList.find((function(j){return j.info.url.split("?")[0]===k.split("?")[0]&&j.kind===M}))},N.prototype.findByMsid=function(k){var M=k.url,j=k.kind,G=k.source,z=k.msid,V=j===b.TrackType.VIDEO?"vMsid":"aMsid";return this.workerList.find((function(re){return re.info.url.split("?")[0]===M.split("?")[0]&&re.source===G&&re.kind===j&&re.info[V]===z}))},N.prototype.dispose=function(){this.workerList.forEach((function(k){k.worker.terminate()})),this.workerList=[]},N})()},2825:(g,c)=>{Object.defineProperty(c,"__esModule",{value:!0})},8156:function(g,c,s){var d=this&&this.__createBinding||(Object.create?function(y,R,v,h){h===void 0&&(h=v);var m=Object.getOwnPropertyDescriptor(R,v);m&&!("get"in m?!R.__esModule:m.writable||m.configurable)||(m={enumerable:!0,get:function(){return R[v]}}),Object.defineProperty(y,h,m)}:function(y,R,v,h){h===void 0&&(h=v),y[h]=R[v]}),l=this&&this.__exportStar||function(y,R){for(var v in y)v==="default"||Object.prototype.hasOwnProperty.call(R,v)||d(R,y,v)};Object.defineProperty(c,"__esModule",{value:!0}),c.EDatachannelStatus=c.EConnectStatus=c.AliRTS=void 0,s(9543);var p=s(4845);Object.defineProperty(c,"AliRTS",{enumerable:!0,get:function(){return p.AliRTS}}),window&&(window.AliRTS=p.AliRTS);var S=s(5917);Object.defineProperty(c,"EConnectStatus",{enumerable:!0,get:function(){return S.EConnectStatus}});var T=s(280);Object.defineProperty(c,"EDatachannelStatus",{enumerable:!0,get:function(){return T.EDatachannelStatus}}),l(s(2825),c)},2672:(g,c)=>{var s;Object.defineProperty(c,"__esModule",{value:!0}),c.EN=void 0,(function(d){d.MESSAGE_NOTSUPPORT_WEBRTC="not support webrtc",d.MESSAGE_BROWSER_NOTSUPPORT="browser not support",d.MESSAGE_BROWSER_VERSIONLOW="browser version too low",d.MESSAGE_NOTSUPPORT_H264="not support h264",d.MESSAGE_CREATEOFFER="create offer error"})(s||(c.EN=s={}))},2818:function(g,c,s){var d=this&&this.__assign||function(){return d=Object.assign||function(m){for(var _,A=1,E=arguments.length;A<E;A++)for(var b in _=arguments[A])Object.prototype.hasOwnProperty.call(_,b)&&(m[b]=_[b]);return m},d.apply(this,arguments)},l=this&&this.__importDefault||function(m){return m&&m.__esModule?m:{default:m}};Object.defineProperty(c,"__esModule",{value:!0});var p,S=s(233),T=l(s(7028)),y=s(9428),R=l(s(2632)),v=l(s(1401));(function(m){m[m.UA=101]="UA",m[m.SUB_STATS=107]="SUB_STATS",m[m.PUB_STATS=108]="PUB_STATS",m[m.CONNECT_STATE_CHANGE=109]="CONNECT_STATE_CHANGE",m[m.START_PLAY=120]="START_PLAY",m[m.STOP_PLAY=121]="STOP_PLAY",m[m.SUBSCRIBE_START=125]="SUBSCRIBE_START",m[m.SUBSCRIBE_OK=126]="SUBSCRIBE_OK",m[m.FIRST_FRAME_TIME=137]="FIRST_FRAME_TIME",m[m.DC_HTTP_CONNECT=140]="DC_HTTP_CONNECT",m[m.DC_HTTP_CONNECT_OK=141]="DC_HTTP_CONNECT_OK",m[m.DC_SUB_ADD=142]="DC_SUB_ADD",m[m.DC_SUB_ADD_OK=143]="DC_SUB_ADD_OK",m[m.DC_CONNECT_STATE_CHANGE=144]="DC_CONNECT_STATE_CHANGE",m[m.DC_SUB_STOP=145]="DC_SUB_STOP",m[m.DC_SUB_STOP_OK=146]="DC_SUB_STOP_OK",m[m.DC_DISPOSE=147]="DC_DISPOSE",m[m.DC_SUB_DELETE=148]="DC_SUB_DELETE",m[m.DC_SUB_DELETE_OK=149]="DC_SUB_DELETE_OK",m[m.ERROR_INFO=150]="ERROR_INFO",m[m.DC_PUB_ADD=152]="DC_PUB_ADD",m[m.DC_PUB_ADD_OK=153]="DC_PUB_ADD_OK",m[m.DC_PUB_STOP=155]="DC_PUB_STOP",m[m.DC_PUB_STOP_OK=156]="DC_PUB_STOP_OK",m[m.DC_PUB_DELETE=157]="DC_PUB_DELETE",m[m.DC_PUB_DELETE_OK=158]="DC_PUB_DELETE_OK",m[m.RECONNECT=160]="RECONNECT",m[m.RECONNECT_PARAMS=161]="RECONNECT_PARAMS",m[m.RECONNECT_FINISH=162]="RECONNECT_FINISH",m[m.NOTIFY_MESSAGE=170]="NOTIFY_MESSAGE",m[m.CUMU_DELAY_NOT_SUPPORTED=180]="CUMU_DELAY_NOT_SUPPORTED",m[m.CUMU_DELAY_ANSWER_NOT_FOUND=181]="CUMU_DELAY_ANSWER_NOT_FOUND",m[m.CREATE_CLIENT=200]="CREATE_CLIENT",m[m.LOCALSTREAM_INITED=201]="LOCALSTREAM_INITED",m[m.START_PUBLISH=220]="START_PUBLISH",m[m.STOP_PUBLISH=221]="STOP_PUBLISH",m[m.PUBLISH_OK=222]="PUBLISH_OK",m[m.SET_VIDEOPROFILE=230]="SET_VIDEOPROFILE",m[m.SET_SCREENPROFILE=231]="SET_SCREENPROFILE",m[m.SET_AUDIOPROFILE=238]="SET_AUDIOPROFILE",m[m.ENABLE_AUDIO=232]="ENABLE_AUDIO",m[m.DISABLE_AUDIO=233]="DISABLE_AUDIO",m[m.ENABLE_VIDEO=234]="ENABLE_VIDEO",m[m.DISABLE_VIDEO=235]="DISABLE_VIDEO",m[m.STOP=236]="STOP",m[m.PLAY=237]="PLAY"})(p||(p={}));var h=(function(){function m(_){this.customReporter=_?.customReporter,this.ct=_&&_.customTag?_.customTag:"",this.enableLog=!_||_.trackLog!=0,this._initParam(),this.slsTracker=new R.default({host:"cn-hangzhou.log.aliyuncs.com",project:"videocloud",logstore:"live-client-log",time:10,count:10})}return m.prototype.dispose=function(){this.ct="",this.enableLog=!0,this.slsTracker=null,this.cumuDelayInfo=void 0,this.customReporter=void 0},m.prototype.updateTid=function(){this.param?this.param.tid=S.Guid.create(32):this._initParam()},m.prototype.updateUrl=function(_){this.param&&(this.param.pu=_)},m.prototype.reportUA=function(_){this.reporter({msgid:p.UA,args:(0,v.default)({ua:_})})},m.prototype.reportPullStats=function(_){var A,E=d(d({},_),{cumu:""});if(this.cumuDelayInfo)try{A=JSON.parse(this.cumuDelayInfo)}catch{}A&&(this.cumuDelayInfo=void 0,E.cumu=A),this.reporter({msgid:p.SUB_STATS,args:(0,v.default)(d({},E))})},m.prototype.reportPushStats=function(_){this.reporter({msgid:p.PUB_STATS,args:(0,v.default)(d({},_))})},m.prototype.reportStartPlay=function(_){this.reporter({msgid:p.START_PLAY,args:(0,v.default)({vurl:_})})},m.prototype.reportStopPlay=function(){this.reporter({msgid:p.STOP_PLAY})},m.prototype.reportSubscribeStart=function(_,A,E,b,w){this.reporter({msgid:p.SUBSCRIBE_START,args:(0,v.default)({vurl:_,surl:A,vMsid:E?E.join(", "):"",aMsid:b?b.join(", "):"",isSubAdd:!!w})})},m.prototype.reportSubscribeOk=function(_){_===void 0&&(_={}),this.reporter({msgid:p.SUBSCRIBE_OK,args:(0,v.default)({vurl:_.vurl||"",surl:_.surl||"",hrct:_.hrct,tcid:_.traceId,rslt:_.rslt,isSubAdd:!!_.isSubAdd})})},m.prototype.reportFirstFrameTime=function(_,A,E,b,w,C,P,U,B,L,H,O,x,F){this.reporter({msgid:p.FIRST_FRAME_TIME,args:(0,v.default)({vurl:_,cpct:E,hrct:b,tcid:A,ffct:w,rslt:C,cnct:P,stats:U,delct:B,addct:L,actct:H,vMsid:O?O.join(", "):"",aMsid:x?x.join(", "):"",isSubAdd:!!F})})},m.prototype.reportErrorInfo=function(_,A,E,b){_!==y.ErrorCode.ERROR_AUTOPLAY_ERROR&&this.reporter({msgid:p.ERROR_INFO,args:(0,v.default)({errorCode:_,message:A,tcid:E,extraInfo:b})})},m.prototype.reportReconnect=function(_,A,E,b,w){this.reporter({msgid:p.RECONNECT,args:(0,v.default)({errorCode:_,message:A,tcid:E,retryTimes:b,useTcp:w})})},m.prototype.reportReconnectParams=function(_,A,E,b,w,C){this.reporter({msgid:p.RECONNECT_PARAMS,args:(0,v.default)({type:_,url:A,vMsid:(E||[]).join(","),aMsid:(b||[]).join(","),useTcp:w,streamId:C})})},m.prototype.reportReconnectFinish=function(_){_===void 0&&(_={}),this.reporter({msgid:p.RECONNECT_FINISH,args:(0,v.default)(d({},_))})},m.prototype.reportCreateClient=function(){this.reporter({msgid:p.CREATE_CLIENT})},m.prototype.reportStartPublish=function(_,A,E){this.reporter({msgid:p.START_PUBLISH,args:(0,v.default)({purl:_,surl:A,isPubAdd:!!E})})},m.prototype.reportPublishOk=function(_,A,E,b,w,C,P,U){this.reporter({msgid:p.PUBLISH_OK,args:(0,v.default)({purl:_,surl:A,coct:E,hrct:b,act:w,tcid:C,totalct:P||E+b+w,isPubAdd:!!U})})},m.prototype.reportStopPublish=function(_,A){this.reporter({msgid:p.STOP_PUBLISH,args:(0,v.default)({url:_,isPubStop:!!A})})},m.prototype.reportVideoProfile=function(_){this.reporter({msgid:p.SET_VIDEOPROFILE,args:(0,v.default)({vp:_})})},m.prototype.reportScreenProfile=function(_){this.reporter({msgid:p.SET_SCREENPROFILE,args:(0,v.default)({sp:_})})},m.prototype.reportAudioProfile=function(_){this.reporter({msgid:p.SET_AUDIOPROFILE,args:(0,v.default)({vp:_})})},m.prototype.reportEnableAudio=function(){this.reporter({msgid:p.ENABLE_AUDIO})},m.prototype.reportDisableAudio=function(){this.reporter({msgid:p.DISABLE_AUDIO})},m.prototype.reportEnableVideo=function(){this.reporter({msgid:p.ENABLE_VIDEO})},m.prototype.reportDisableVideo=function(){this.reporter({msgid:p.DISABLE_VIDEO})},m.prototype.reportStop=function(_){this.reporter({msgid:p.STOP,args:(0,v.default)({tp:_})})},m.prototype.reportPlay=function(_){this.reporter({msgid:p.PLAY,args:(0,v.default)({tp:_})})},m.prototype.reportStreamCreated=function(_,A){this.reporter({msgid:p.LOCALSTREAM_INITED,args:(0,v.default)({userConfig:_,localStreamInfo:A})})},m.prototype.reportConnectionChange=function(_,A){this.reporter({msgid:p.CONNECT_STATE_CHANGE,args:(0,v.default)({connectionState:_,direction:A})})},m.prototype.reportDatachannelHttpConnect=function(_){this.reporter({msgid:p.DC_HTTP_CONNECT,args:(0,v.default)({url:_})})},m.prototype.reportDatachannelHttpConnectOk=function(_){this.reporter({msgid:p.DC_HTTP_CONNECT_OK,args:(0,v.default)(d({},_))})},m.prototype.reportDatachannelSubAdd=function(_){this.reporter({msgid:p.DC_SUB_ADD,args:(0,v.default)(d({},_))})},m.prototype.reportDatachannelPubAdd=function(_){this.reporter({msgid:p.DC_PUB_ADD,args:(0,v.default)(d({},_))})},m.prototype.reportDatachannelSubAddOk=function(_){this.reporter({msgid:p.DC_SUB_ADD_OK,args:(0,v.default)(d({},_))})},m.prototype.reportDatachannelPubAddOk=function(_){this.reporter({msgid:p.DC_PUB_ADD_OK,args:(0,v.default)(d({},_))})},m.prototype.reportDatachannelStatusChange=function(_){this.reporter({msgid:p.DC_CONNECT_STATE_CHANGE,args:(0,v.default)(d({},_))})},m.prototype.reportDatachannelSubDelete=function(_){this.reporter({msgid:p.DC_SUB_DELETE,args:(0,v.default)(d({},_))})},m.prototype.reportDatachannelPubDelete=function(_){this.reporter({msgid:p.DC_PUB_DELETE,args:(0,v.default)(d({},_))})},m.prototype.reportDatachannelSubDeleteOk=function(_){this.reporter({msgid:p.DC_SUB_DELETE_OK,args:(0,v.default)(d({},_))})},m.prototype.reportDatachannelPubDeleteOk=function(_){this.reporter({msgid:p.DC_PUB_DELETE_OK,args:(0,v.default)(d({},_))})},m.prototype.reportDatachannelSubStop=function(_){this.reporter({msgid:p.DC_SUB_STOP,args:(0,v.default)(d({},_))})},m.prototype.reportDatachannelPubStop=function(_){this.reporter({msgid:p.DC_PUB_STOP,args:(0,v.default)(d({},_))})},m.prototype.reportDatachannelSubStopOk=function(_){this.reporter({msgid:p.DC_SUB_STOP_OK,args:(0,v.default)(d({},_))})},m.prototype.reportDatachannelPubStopOk=function(_){this.reporter({msgid:p.DC_PUB_STOP_OK,args:(0,v.default)(d({},_))})},m.prototype.reportDatachannelDispose=function(_){this.reporter({msgid:p.DC_DISPOSE,args:(0,v.default)(d({},_))})},m.prototype.reportNotifyMessage=function(_){this.reporter({msgid:p.NOTIFY_MESSAGE,args:(0,v.default)(d({},_))})},m.prototype.reportCumuDelayNotSupported=function(){this.reporter({msgid:p.CUMU_DELAY_NOT_SUPPORTED})},m.prototype.reportCumuDelayAnswerNotFound=function(){this.reporter({msgid:p.CUMU_DELAY_ANSWER_NOT_FOUND})},m.prototype.updateCumuDelayInfo=function(_){this.cumuDelayInfo=_.json},m.prototype._initParam=function(){this.param||(this.param={APIVersion:"0.6.0",os:S.SystemUtil.platform,osv:S.SystemUtil.systemVersion,bt:S.BrowserUtil.browserName,bv:S.BrowserUtil.browserVersion,host:window.location.origin,page:window.location.href,uid:S.LocalStorage.uuid,tid:S.Guid.create(32),ver:T.default.version,ct:this.ct,dt:"",lv:"1.0.0",ua:navigator&&navigator.userAgent||"",pu:""})},m.prototype.reporter=function(_){var A,E=d(d(d(d({},this.param||{}),{tm:new Date().getTime()}),_||{}),{msgname:p[_.msgid]});if(this.customReporter&&typeof this.customReporter=="function")try{this.customReporter(E)}catch(b){console.error("[Error in customReporter] ",b)}this.enableLog&&((A=this.slsTracker)===null||A===void 0||A.send(E))},m.prototype.data2String=function(_){var A="";for(var E in _)_.hasOwnProperty(E)&&(A.length&&(A+="&"),A+=E+"="+_[E]);return A},m.HEARTHEAT_INTERVAL=4,m})();c.default=h},7668:function(g,c,s){var d,l=this&&this.__extends||(d=function(H,O){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(x,F){x.__proto__=F}||function(x,F){for(var N in F)Object.prototype.hasOwnProperty.call(F,N)&&(x[N]=F[N])},d(H,O)},function(H,O){if(typeof O!="function"&&O!==null)throw new TypeError("Class extends value "+String(O)+" is not a constructor or null");function x(){this.constructor=H}d(H,O),H.prototype=O===null?Object.create(O):(x.prototype=O.prototype,new x)}),p=this&&this.__assign||function(){return p=Object.assign||function(H){for(var O,x=1,F=arguments.length;x<F;x++)for(var N in O=arguments[x])Object.prototype.hasOwnProperty.call(O,N)&&(H[N]=O[N]);return H},p.apply(this,arguments)},S=this&&this.__awaiter||function(H,O,x,F){return new(x||(x=Promise))((function(N,k){function M(z){try{G(F.next(z))}catch(V){k(V)}}function j(z){try{G(F.throw(z))}catch(V){k(V)}}function G(z){var V;z.done?N(z.value):(V=z.value,V instanceof x?V:new x((function(re){re(V)}))).then(M,j)}G((F=F.apply(H,O||[])).next())}))},T=this&&this.__generator||function(H,O){var x,F,N,k,M={label:0,sent:function(){if(1&N[0])throw N[1];return N[1]},trys:[],ops:[]};return k={next:j(0),throw:j(1),return:j(2)},typeof Symbol=="function"&&(k[Symbol.iterator]=function(){return this}),k;function j(G){return function(z){return(function(V){if(x)throw new TypeError("Generator is already executing.");for(;k&&(k=0,V[0]&&(M=0)),M;)try{if(x=1,F&&(N=2&V[0]?F.return:V[0]?F.throw||((N=F.return)&&N.call(F),0):F.next)&&!(N=N.call(F,V[1])).done)return N;switch(F=0,N&&(V=[2&V[0],N.value]),V[0]){case 0:case 1:N=V;break;case 4:return M.label++,{value:V[1],done:!1};case 5:M.label++,F=V[1],V=[0];continue;case 7:V=M.ops.pop(),M.trys.pop();continue;default:if(N=M.trys,!((N=N.length>0&&N[N.length-1])||V[0]!==6&&V[0]!==2)){M=0;continue}if(V[0]===3&&(!N||V[1]>N[0]&&V[1]<N[3])){M.label=V[1];break}if(V[0]===6&&M.label<N[1]){M.label=N[1],N=V;break}if(N&&M.label<N[2]){M.label=N[2],M.ops.push(V);break}N[2]&&M.ops.pop(),M.trys.pop();continue}V=O.call(H,M)}catch(re){V=[6,re],F=0}finally{x=N=0}if(5&V[0])throw V[1];return{value:V[0]?V[1]:void 0,done:!0}})([G,z])}}},y=this&&this.__rest||function(H,O){var x={};for(var F in H)Object.prototype.hasOwnProperty.call(H,F)&&O.indexOf(F)<0&&(x[F]=H[F]);if(H!=null&&typeof Object.getOwnPropertySymbols=="function"){var N=0;for(F=Object.getOwnPropertySymbols(H);N<F.length;N++)O.indexOf(F[N])<0&&Object.prototype.propertyIsEnumerable.call(H,F[N])&&(x[F[N]]=H[F[N]])}return x},R=this&&this.__importDefault||function(H){return H&&H.__esModule?H:{default:H}};Object.defineProperty(c,"__esModule",{value:!0}),c.RtsClient=void 0;var v=R(s(102)),h=s(5917),m=s(5676),_=s(9796),A=s(6600),E=R(s(2818)),b=R(s(7028)),w=s(7989),C=s(280),P=s(9428),U=s(5044),B=s(2470),L=(function(H){function O(x){var F,N=H.call(this)||this;return N.pullH264Checked=!1,N.lastProtocol="udp",N.usePcReconnect=!1,N.reporter=new E.default(x),N.subscriber=new m.Subscriber(N.reporter,x?x.playConfig:void 0),N.publisher=new _.Publisher(N.reporter),N.commonController=new A.CommonController(N.reporter),N.pcRestorer=new B.PcRestorer({subscriber:N.subscriber,publisher:N.publisher,commonController:N.commonController}),N.usePcReconnect=!!(!((F=x?.singlePcConfig)===null||F===void 0)&&F.usePcReconnect),N.subscriber.on("onError",(function(k){return S(N,void 0,void 0,(function(){var M,j,G,z,V,re,Q,Z,q,Y,J=this;return T(this,(function($){switch($.label){case 0:return M=(G=k.extraInfo)===null||G===void 0?void 0:G.response,this.reporter.reportErrorInfo(k.errorCode,k.message,k.traceId,{sdp:(z=k.extraInfo)===null||z===void 0?void 0:z.sdp,response:{status:M?.status,data:M?.data},pcErrorInfo:(V=k.extraInfo)===null||V===void 0?void 0:V.pcErrorInfo}),this.usePcReconnect?[3,5]:P.SUB_RECONNECT_ERROR_LIST.includes(k.errorCode)?this.subscriber.isConnecting?[3,2]:(j=this.lastProtocol==="udp",this.lastProtocol=j?"tcp":"udp",console.log("retrying with",this.lastProtocol),[4,this.subscriber.retrySubscribe(k,{innerTcpOnly:j})]):[3,3];case 1:$.sent()?(this.reporter.reportReconnect(k.errorCode,k.message,k.traceId,(re=k.extraInfo)===null||re===void 0?void 0:re.retryTimes,j),this.emit("reconnect",this.makeReconnectEvent("sub",k))):this.emit("onError",k),$.label=2;case 2:return[3,4];case 3:this.emit("onError",k),$.label=4;case 4:return[3,6];case 5:[P.ErrorCode.ERROR_PC_DISCONNECTED,P.ErrorCode.ERROR_IP_MIGRATE].includes(k.errorCode)&&(this.pcRestorer.isReconnecting()||(k.extraInfo=p(p({},k.extraInfo),{retryTimes:1}),this.reporter.reportReconnect(k.errorCode,k.message,k.traceId,(Q=k.extraInfo)===null||Q===void 0?void 0:Q.retryTimes),this.emit("reconnect",this.makeReconnectEvent("sub",k)),this.emit("connectStatusChange",{status:h.EConnectStatus.CONNECT_STATUS_RECONNECTING}),(Y=(q=this.pcRestorer.restore((Z=k.extraInfo.pcErrorInfo)===null||Z===void 0?void 0:Z.ips))===null||q===void 0?void 0:q.then((function(te){J.reporter.reportReconnectFinish({level:"pc"}),J.emit("reconnectFinish",{type:"all",traceId:te.traceId,latestUrl:te.latestUrl})})))===null||Y===void 0||Y.catch((function(te){var ie=new U.RtsError(P.ErrorCode.ERROR_SINGLE_PC_FULL_RECONNECT_HTTP_FAILED,"pc full reconnect failed","",{originError:te});J.emit("onError",ie),J.reporter.reportErrorInfo(ie.errorCode,ie.message)})))),$.label=6;case 6:return[2]}}))}))})),N.subscriber.on("reconnect",(function(k){var M;N.reporter.reportReconnect(k.errorCode,k.message,k.traceId,(M=k.extraInfo)===null||M===void 0?void 0:M.retryTimes),N.emit("reconnect",N.makeReconnectEvent("sub",k))})),N.subscriber.on("onPlayEvent",(function(k){N.emit("onPlayEvent",k)})),N.subscriber.on("connectStatusChange",(function(k){N.emit("connectStatusChange",k),N.reporter.reportConnectionChange(h.EConnectStatus[k.status],"sub")})),N.publisher.on("connectStatusChange",(function(k){N.emit("connectStatusChange",k),N.reporter.reportConnectionChange(h.EConnectStatus[k.status],"pub")})),N.publisher.on("onError",(function(k){return S(N,void 0,void 0,(function(){var M,j,G,z,V,re,Q,Z,q,Y,J,$=this;return T(this,(function(te){switch(te.label){case 0:return M=(G=k.extraInfo)===null||G===void 0?void 0:G.response,this.reporter.reportErrorInfo(k.errorCode,k.message,k.traceId,{sdp:(z=k.extraInfo)===null||z===void 0?void 0:z.sdp,response:{status:M?.status,data:M?.data},pcErrorInfo:(V=k.extraInfo)===null||V===void 0?void 0:V.pcErrorInfo}),this.usePcReconnect?[3,5]:P.PUB_RECONNECT_ERROR_LIST.includes(k.errorCode)?this.publisher.isConnecting?[3,2]:(j=k.errorCode===P.ErrorCode.ERROR_TRANSPORT_CLOSED&&((re=k.extraInfo)===null||re===void 0?void 0:re.protocol)!=="tcp",console.log("Retrying with ",j?"TCP":"UDP"),[4,this.publisher.retryPublish(k,j)]):[3,3];case 1:te.sent()?(this.reporter.reportReconnect(k.errorCode,k.message,k.traceId,(Q=k.extraInfo)===null||Q===void 0?void 0:Q.retryTimes,j),this.emit("reconnect",this.makeReconnectEvent("pub",k))):this.emit("onError",k),te.label=2;case 2:return[3,4];case 3:this.emit("onError",k),te.label=4;case 4:return[3,6];case 5:[P.ErrorCode.ERROR_PC_DISCONNECTED,P.ErrorCode.ERROR_IP_MIGRATE].includes(k.errorCode)&&(this.pcRestorer.isReconnecting()||(k.extraInfo=p(p({},k.extraInfo),{retryTimes:1}),this.reporter.reportReconnect(k.errorCode,k.message,k.traceId,(Z=k.extraInfo)===null||Z===void 0?void 0:Z.retryTimes),this.emit("reconnect",this.makeReconnectEvent("pub",k)),this.emit("connectStatusChange",{status:h.EConnectStatus.CONNECT_STATUS_RECONNECTING}),(J=(Y=this.pcRestorer.restore((q=k.extraInfo.pcErrorInfo)===null||q===void 0?void 0:q.ips))===null||Y===void 0?void 0:Y.then((function(ie){$.reporter.reportReconnectFinish({level:"pc"}),$.emit("reconnectFinish",{type:"all",traceId:ie.traceId,latestUrl:ie.latestUrl})})))===null||J===void 0||J.catch((function(ie){var se=new U.RtsError(P.ErrorCode.ERROR_SINGLE_PC_FULL_RECONNECT_HTTP_FAILED,"pc full reconnect failed","",{originError:ie});$.emit("onError",se),$.reporter.reportErrorInfo(se.errorCode,se.message)})))),te.label=6;case 6:return[2]}}))}))})),N.publisher.on("reconnect",(function(k){var M;N.reporter.reportReconnect(k.errorCode,k.message,k.traceId,(M=k.extraInfo)===null||M===void 0?void 0:M.retryTimes),N.emit("reconnect",N.makeReconnectEvent("pub",k))})),N.commonController.on("connectStatusChange",(function(k){N.emit("connectStatusChange",k),N.reporter.reportConnectionChange(h.EConnectStatus[k.status],"signalChannel")})),N.commonController.on("onError",(function(k){N.reporter.reportErrorInfo(k.errorCode,k.message,k.traceId),N.emit("onError",k)})),N.commonController.on("datachannelStatusChange",(function(k){N.emit("datachannelStatusChange",k),N.reporter.reportDatachannelStatusChange({state:C.EDatachannelStatus[k.status],url:"",label:"SIGNAL",id:-1,msid:""})})),N.commonController.on("encodedFrame",(function(k){N.emit("encodedFrame",k)})),N.commonController.on("receivedSEI",(function(k){N.emit("receivedSEI",k)})),N.commonController.on("onPlayEvent",(function(k){N.emit("onPlayEvent",k)})),N.commonController.on("reconnect",(function(k){k.type!=="pc"&&N.emit("reconnect",k)})),N.commonController.on("reconnectFinish",(function(k){N.reporter.reportReconnectFinish(k),N.emit("reconnectFinish",k)})),N.commonController.on("traceId",(function(k){N.emit("traceId",k)})),N.commonController.on("heartbeat",(function(k){N.emit("heartbeat",k)})),N.commonController.on("cumuDelayNotSupported",(function(){N.emit("cumuDelayNotSupported")})),N.reporter.reportCreateClient(),N}return l(O,H),O.prototype.getVersion=function(){return b.default.version},O.prototype.isSupport=function(x){var F=new w.SupportUtil;return this.pullH264Checked=!0,F.isSupport(x)},O.prototype.checkPublishSupport=function(){return new w.SupportUtil().checkPublishSupport()},O.prototype.checkEncodedTransformSupport=function(){return new w.SupportUtil().checkEncodedTransformSupport()},O.prototype.subscribe=function(x,F){return this.reporter.updateUrl(x),this.commonController.setConfig(F),this.commonController.setPeerconnection(this.subscriber.getPeerConnection()),this.subscriber.resetResubscribeStatus(),this.subscriber.subscribeWithReconnect(x,p(p({},F),{isH264Checked:this.pullH264Checked}))},O.prototype.subscribeAdd=function(x){return this.commonController.subscribeAdd(x)},O.prototype.subscribeActive=function(x){return this.commonController.subscribeActive(x)},O.prototype.subscribeDeleteTracks=function(x){return this.commonController.subscribeDeleteTracks(x)},O.prototype.subscribeStop=function(x){return this.commonController.subscribeStop(x)},O.prototype.publishAdd=function(x){return this.commonController.publishAdd(x)},O.prototype.publishDeleteTracks=function(x){return this.commonController.publishDeleteTracks(x)},O.prototype.publishReplaceTracks=function(x){return this.commonController.publishReplaceTracks(x)},O.prototype.publishStop=function(x){return this.commonController.publishStop(x)},O.prototype.subscribeAddDatachannel=function(x){return this.commonController.subscribeAddDatachannel(x)},O.prototype.subscribeDeleteDatachannel=function(x){return this.commonController.subscribeDeleteDatachannel(x)},O.prototype.publishDeleteDatachannel=function(x){return this.commonController.publishDeleteDatachannel(x)},O.prototype.subscribeStopDatachannel=function(x){return this.commonController.subscribeStopDatachannel(x)},O.prototype.publishAddDatachannel=function(x){return this.commonController.publishAddDatachannel(x)},O.prototype.publishStopDatachannel=function(x){return this.commonController.publishStopDatachannel(x)},O.prototype.unsubscribe=function(){this.subscriber.resetResubscribeStatus(),this.subscriber.unsubscribe()},O.prototype.startLiveStream=function(x,F,N){return this.reporter.reportStartPlay(x),this.subscriber.startLiveStream(x,F,N)},O.prototype.stopLiveStream=function(){this.reporter.reportStopPlay(),this.subscriber.stopLiveStream()},O.prototype.muteLiveStream=function(x){this.subscriber.muteLiveStream(x)},O.prototype.publish=function(x,F,N){return S(this,void 0,void 0,(function(){return T(this,(function(k){return this.reporter.updateUrl(x),this.commonController.setConfig(N),this.commonController.setPeerconnection(this.publisher.getPeerConnection()),this.publisher.resetRepublishStatus(),[2,this.publisher.publishWithReconnect(x,F,N)]}))}))},O.prototype.unpublish=function(){return this.publisher.resetRepublishStatus(),this.publisher.unpublish()},O.prototype.sendSEI=function(x){this.publisher.sendSEI(x),this.commonController.sendSEI(x)},O.prototype.getPublishTrackInfoList=function(){return this.publisher.getTrackInfoList()},O.prototype.getTransportStats=function(){return this.subscriber.getPeerConnection().getSubMonitor().getTransportStats()},O.prototype.getRemoteVideoStats=function(){return this.subscriber.getPeerConnection().getSubMonitor().getRemoteVideoStats()},O.prototype.getRemoteAudioStats=function(){return this.subscriber.getPeerConnection().getSubMonitor().getRemoteAudioStats()},O.prototype.getSubscribeVideoStats=function(x,F){return this.commonController.getSubscribeVideoStats(x,F)},O.prototype.getSubscribeAudioStats=function(x,F){return this.commonController.getSubscribeAudioStats(x,F)},O.prototype.getPublishVideoStats=function(x,F){return this.commonController.getPublishVideoStats(x,F)},O.prototype.getPublishAudioStats=function(x,F){return this.commonController.getPublishAudioStats(x,F)},O.prototype.setReceiverCodecPreferences=function(x){return this.commonController.setReceiverCodecPreferences(x)},O.prototype.setSenderCodecPreferences=function(x){return this.commonController.setSenderCodecPreferences(x)},O.prototype.makeReconnectEvent=function(x,F){var N=F||{},k=N.extraInfo,M=y(N,["extraInfo"]),j=k||{},G=j.retryTimes,z=y(j,["retryTimes"]),V=x;return{type:this.usePcReconnect?"pc":V,reason:M,retryTimes:G,extraInfo:z}},O.prototype.heartbeat=function(x){var F;(F=this.commonController.peerCore)===null||F===void 0||F.sendOnceHeartbeat(x)},O.prototype.setAutoHeartbeat=function(x){var F;(F=this.commonController.peerCore)===null||F===void 0||F.startSignalHeartbeatTimer(x)},O.prototype.clearAutoHeartbeat=function(){var x;(x=this.commonController.peerCore)===null||x===void 0||x.stopSignalHeartbeatTimer()},O.prototype.sendFalseHeartbeat=function(x){var F;(F=this.commonController.peerCore)===null||F===void 0||F.sendFalseHeartbeat(x)},O.prototype.updateAuth=function(x){return this.commonController.updateAuth(x)},O.prototype.dispose=function(){this.removeAllListeners(),this.reporter.dispose(),this.subscriber.dispose(),this.publisher.dispose(),this.commonController.dispose(),this.pcRestorer.dispose()},O})(v.default);c.RtsClient=L},335:(g,c)=>{Object.defineProperty(c,"__esModule",{value:!0});var s=(function(){function d(l){this.useGainNode=!0,this.audioContext=new AudioContext,this.audioDestination=this.audioContext.createMediaStreamDestination(),this.audioSource=[],this.gainNode=null,this.audioTrack=null,this.audioTrackArr=l.trackList||[],this.useGainNode=typeof l.useGainNode!="boolean"||l.useGainNode,this.useGainNode&&(this.gainNode=this.audioContext.createGain(),this.gainNode.connect(this.audioContext.destination),this.gainNode.gain.value=0),this.getMixedAudioTrack()}return d.prototype.destroy=function(){var l;(l=this.getMixedAudioTrack())===null||l===void 0||l.stop(),this.disconnectSourceNode(),this.audioContext.close(),this.audioTrackArr=[]},d.prototype.updateTrackList=function(l){l.length&&(this.disconnectSourceNode(),this.audioTrackArr=l,this.connectNode())},d.prototype.getMixedAudioTrack=function(){return this.audioTrack||(this.connectNode(),this.audioTrack=this.audioDestination.stream.getAudioTracks()[0]),this.audioTrack},d.prototype.connectNode=function(){var l=this;this.audioTrackArr.forEach((function(p){var S=new MediaStream;S.addTrack(p);var T=l.audioContext.createMediaStreamSource(S);l.gainNode&&T.connect(l.gainNode),l.audioSource.push(T)})),this.audioSource.forEach((function(p){p.connect(l.audioDestination)}))},d.prototype.disconnectSourceNode=function(){var l=this;this.audioSource.forEach((function(p){l.gainNode&&p.disconnect(l.gainNode),p.disconnect(l.audioDestination)})),this.audioSource=[]},d})();c.default=s},1893:(g,c)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.TwoDRenderer=void 0;var s=(function(){function d(l){this.video=l.video,this.canvas=l.canvas,this.ctx=this.canvas.getContext("2d")}return d.prototype.render=function(){var l,p,S=this.video,T=this.canvas;S&&T&&((l=this.ctx)===null||l===void 0||l.clearRect(0,0,T.width,T.height),(p=this.ctx)===null||p===void 0||p.drawImage(S,0,0,1*S.videoWidth,1*S.videoHeight),this.requestId=requestAnimationFrame(this.render.bind(this)))},d.prototype.stop=function(){this.requestId&&cancelAnimationFrame(this.requestId)},d})();c.TwoDRenderer=s},6295:(g,c,s)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.CanvasRenderer=void 0;var d=s(1893),l=(function(){function p(S){this.video=S.video,this.canvas=this.initCanvas(),this.activeRenderer=this.initRenderer()}return Object.defineProperty(p.prototype,"mediaStream",{get:function(){var S;return this.ms||(this.ms=((S=this.canvas)===null||S===void 0?void 0:S.captureStream())||void 0),this.ms},enumerable:!1,configurable:!0}),p.prototype.start=function(){this.render()},p.prototype.stop=function(){this.activeRenderer.stop()},p.prototype.initCanvas=function(){var S=document.createElement("canvas"),T=this.video;return S.width=1*T.videoWidth,S.height=1*T.videoHeight,S},p.prototype.initRenderer=function(){return new d.TwoDRenderer({video:this.video,canvas:this.canvas})},p.prototype.render=function(){this.activeRenderer.render()},p.prototype.resize=function(S,T){this.canvas&&(this.canvas.width=S,this.canvas.height=T)},p})();c.CanvasRenderer=l},6420:function(g,c,s){var d=this&&this.__awaiter||function(y,R,v,h){return new(v||(v=Promise))((function(m,_){function A(w){try{b(h.next(w))}catch(C){_(C)}}function E(w){try{b(h.throw(w))}catch(C){_(C)}}function b(w){var C;w.done?m(w.value):(C=w.value,C instanceof v?C:new v((function(P){P(C)}))).then(A,E)}b((h=h.apply(y,R||[])).next())}))},l=this&&this.__generator||function(y,R){var v,h,m,_,A={label:0,sent:function(){if(1&m[0])throw m[1];return m[1]},trys:[],ops:[]};return _={next:E(0),throw:E(1),return:E(2)},typeof Symbol=="function"&&(_[Symbol.iterator]=function(){return this}),_;function E(b){return function(w){return(function(C){if(v)throw new TypeError("Generator is already executing.");for(;_&&(_=0,C[0]&&(A=0)),A;)try{if(v=1,h&&(m=2&C[0]?h.return:C[0]?h.throw||((m=h.return)&&m.call(h),0):h.next)&&!(m=m.call(h,C[1])).done)return m;switch(h=0,m&&(C=[2&C[0],m.value]),C[0]){case 0:case 1:m=C;break;case 4:return A.label++,{value:C[1],done:!1};case 5:A.label++,h=C[1],C=[0];continue;case 7:C=A.ops.pop(),A.trys.pop();continue;default:if(m=A.trys,!((m=m.length>0&&m[m.length-1])||C[0]!==6&&C[0]!==2)){A=0;continue}if(C[0]===3&&(!m||C[1]>m[0]&&C[1]<m[3])){A.label=C[1];break}if(C[0]===6&&A.label<m[1]){A.label=m[1],m=C;break}if(m&&A.label<m[2]){A.label=m[2],A.ops.push(C);break}m[2]&&A.ops.pop(),A.trys.pop();continue}C=R.call(y,A)}catch(P){C=[6,P],h=0}finally{v=m=0}if(5&C[0])throw C[1];return{value:C[0]?C[1]:void 0,done:!0}})([b,w])}}},p=this&&this.__importDefault||function(y){return y&&y.__esModule?y:{default:y}};Object.defineProperty(c,"__esModule",{value:!0}),c.Clock=void 0;var S=p(s(2505)),T=(function(){function y(){this.request=S.default.create({timeout:6e4}),this.offset=0,this.nextAttemptMs=y.DEFAULT_ATTEMPT_INTERVAL,this.attemptCount=0,this.random=Math.random(),this.startSyncClock()}return y.prototype.now=function(){if(this.offset&&!Number.isNaN(this.offset)){var R=Date.now()+this.offset;return Math.round(R)}return Date.now()},y.prototype.syncClock=function(){return d(this,void 0,void 0,(function(){var R,v,h,m,_;return l(this,(function(A){switch(A.label){case 0:return R=!1,v=Date.now(),[4,this.fetchServerTime()];case 1:return h=A.sent(),m=Date.now(),h?(_=new Date(h).getTime(),Number.isNaN(_)||(this.offset=this.calculateOffset(v+this.fixRequestStartTime(),m,_),R=!0)):console.warn("Failed to fetch server time, should try again"),[2,R]}}))}))},y.prototype.startSyncClock=function(){return d(this,void 0,void 0,(function(){var R,v=this;return l(this,(function(h){switch(h.label){case 0:return[4,this.syncClock()];case 1:return R=h.sent(),this.nextAttemptMs=R?y.DEFAULT_ATTEMPT_INTERVAL:y.DEFAULT_ATTEMPT_RETRY_INTERVAL,this.stopSyncClock(),this.attemptTimer=setTimeout((function(){v.startSyncClock()}),this.nextAttemptMs),[2]}}))}))},y.prototype.stopSyncClock=function(){this.attemptTimer&&clearTimeout(this.attemptTimer),this.attemptTimer=void 0},y.prototype.fetchServerTime=function(){return d(this,void 0,void 0,(function(){var R,v,h;return l(this,(function(m){switch(m.label){case 0:this.attemptCount++,m.label=1;case 1:return m.trys.push([1,3,,4]),[4,this.request.get(this.attachCount(y.DEFAULT_TIME_SOURCE))];case 2:return R=(h=m.sent())===null||h===void 0?void 0:h.data,[3,4];case 3:return v=m.sent(),console.log("GetServerTime error",v),[3,4];case 4:return[2,R]}}))}))},y.prototype.calculateOffset=function(R,v,h){return h-(v-(v-R)/2)},y.prototype.fixRequestStartTime=function(){var R=0,v=performance.getEntriesByName(this.attachCount(y.DEFAULT_TIME_SOURCE),"resource");if(v?.length)if(v.length>1)console.warn("multiple resource entries found");else try{var h=v[0];R=h.requestStart-h.startTime,h.domainLookupEnd,h.domainLookupStart,h.secureConnectionStart,h.connectStart,h.requestStart,h.secureConnectionStart}catch(m){console.log(m)}else console.warn("no resource entry found"),window.RTS_DISABLE_CLEAR_RESOURCE_TIMINGS||performance.clearResourceTimings();return Math.max(0,R||0)},y.prototype.attachCount=function(R){return"".concat(R,"&count=").concat(this.random,"_").concat(this.attemptCount)},y.DEFAULT_TIME_SOURCE="https://time.akamai.com/?iso&ms",y.DEFAULT_ATTEMPT_INTERVAL=3e4,y.DEFAULT_ATTEMPT_RETRY_INTERVAL=5e3,y})();c.Clock=T},1698:function(g,c){var s=this&&this.__assign||function(){return s=Object.assign||function(l){for(var p,S=1,T=arguments.length;S<T;S++)for(var y in p=arguments[S])Object.prototype.hasOwnProperty.call(p,y)&&(l[y]=p[y]);return l},s.apply(this,arguments)};Object.defineProperty(c,"__esModule",{value:!0}),c.configProvider=void 0;var d=(function(){function l(){this.context={},this.subscribers=new Set}return l.prototype.setContext=function(p){this.context=s(s({},this.context),p),this.notifySubscribers()},l.prototype.getContext=function(){return this.context},l.prototype.subscribe=function(p){var S=this;return this.subscribers.add(p),function(){return S.subscribers.delete(p)}},l.prototype.notifySubscribers=function(){var p=this;this.subscribers.forEach((function(S){return S(p.context)}))},l})();c.configProvider=new d},5649:function(g,c,s){var d,l,p=this&&this.__assign||function(){return p=Object.assign||function(O){for(var x,F=1,N=arguments.length;F<N;F++)for(var k in x=arguments[F])Object.prototype.hasOwnProperty.call(x,k)&&(O[k]=x[k]);return O},p.apply(this,arguments)},S=this&&this.__importDefault||function(O){return O&&O.__esModule?O:{default:O}};Object.defineProperty(c,"__esModule",{value:!0}),c.CumuDelaySeiPayloadParser=c.CumuDelaySeiPayload=c.ECumuDelayGrtnKey=c.ECumuDelayPubSdkKey=c.ECumuDelayAVCommonKey=c.ECumuDelayVideoKey=c.ECumuDelayGrtnExportKey=c.ECumuDelaySubKey=c.CUMU_DELAY_UUID=c.CUMU_DELAY_SEI_PAYLOAD_TYPE=void 0;var T,y,R,v,h=S(s(7028));c.CUMU_DELAY_SEI_PAYLOAD_TYPE=99,c.CUMU_DELAY_UUID=[32,36,16,9,16,23,7,1,150,117,25,212,25,129,3,7],(function(O){O.SophonAudioDual="sophon_audio_dual",O.SophonVideoCamera="sophon_video_camera",O.SophonVideoCameraSmall="sophon_video_camera_small",O.SophonVideoCameraSuper="sophon_video_camera_super",O.SophonVideoScreenShare="sophon_video_screen_share",O.SophonAudio="sophon_audio",O.SophonVideoCameraLarge="sophon_video_camera_large",O.RtsAudio="rts audio",O.RtsVideo="rts video"})(T||(T={})),(function(O){O[O.Web=0]="Web",O[O.iOS=1]="iOS",O[O.Android=2]="Android"})(y||(y={})),(function(O){O.VTotalCost="VTotalCost",O.VAssemblyCost="VAssemblyCost",O.VJitterBufferDelay="VJitterBufferDelay",O.VDecPlugCost="VDecPlugCost",O.DownRTTHalf="DownRTTHalf"})(R||(c.ECumuDelaySubKey=R={})),(function(O){O.TOTAL_COST="TOTAL_COST",O.ENTER_GRTN_TIMESTAMP="ENTER_GRTN_TIMESTAMP",O.LEAVE_GRTN_TIMESTAMP="LEAVE_GRTN_TIMESTAMP"})(v||(c.ECumuDelayGrtnExportKey=v={}));var m,_,A,E,b,w,C,P=((d={})[T.SophonAudioDual]=4,d[T.SophonVideoCamera]=5,d[T.SophonVideoCameraSmall]=6,d[T.SophonVideoCameraSuper]=7,d[T.SophonVideoScreenShare]=8,d[T.SophonAudio]=9,d[T.SophonVideoCameraLarge]=10,d[T.RtsAudio]=11,d[T.RtsVideo]=12,d);(l={})[P[T.SophonAudioDual]]=T.SophonAudioDual,l[P[T.SophonVideoCamera]]=T.SophonVideoCamera,l[P[T.SophonVideoCameraSmall]]=T.SophonVideoCameraSmall,l[P[T.SophonVideoCameraSuper]]=T.SophonVideoCameraSuper,l[P[T.SophonVideoScreenShare]]=T.SophonVideoScreenShare,l[P[T.SophonAudio]]=T.SophonAudio,l[P[T.SophonVideoCameraLarge]]=T.SophonVideoCameraLarge,l[P[T.RtsAudio]]=T.RtsAudio,l[P[T.RtsVideo]]=T.RtsVideo,(function(O){O[O.VTotalCost=4]="VTotalCost",O[O.CapDeviceCost=5]="CapDeviceCost",O[O.PushExtCost=6]="PushExtCost",O[O.CapPlugCost=7]="CapPlugCost",O[O.PrepThrCost=8]="PrepThrCost",O[O.PrepPlugCost=9]="PrepPlugCost",O[O.DispThrCost=10]="DispThrCost",O[O.DispPlugCost=11]="DispPlugCost",O[O.VEncThrCost=12]="VEncThrCost",O[O.VEncPlugCost=13]="VEncPlugCost"})(m||(c.ECumuDelayVideoKey=m={})),(function(O){O[O.ATotalCost=24]="ATotalCost",O[O.ASourceCCost=25]="ASourceCCost",O[O.AMixerCost=26]="AMixerCost",O[O.AEncodeCCost=27]="AEncodeCCost",O[O.AAIClientQuestionTimestampHEAD=28]="AAIClientQuestionTimestampHEAD",O[O.AAIClientQuestionTimestampTAIL=29]="AAIClientQuestionTimestampTAIL",O[O.AAIClientAnswerTimestampHEAD=30]="AAIClientAnswerTimestampHEAD",O[O.AAIClientAnswerTimestampTAIL=31]="AAIClientAnswerTimestampTAIL",O[O.AAIClientScentenceId=32]="AAIClientScentenceId",O[O.AAIClientSourceCost=33]="AAIClientSourceCost",O[O.AAIClientMixerCost=34]="AAIClientMixerCost",O[O.AAIClientEncoderCost=35]="AAIClientEncoderCost",O[O.AAILinuxReceiveCost=36]="AAILinuxReceiveCost",O[O.AAILinuxNeteqCost=37]="AAILinuxNeteqCost",O[O.AAILinuxRemoteSourceCost=38]="AAILinuxRemoteSourceCost",O[O.AAILinuxPlayMixerCost=39]="AAILinuxPlayMixerCost",O[O.AAILinuxPlayCost=40]="AAILinuxPlayCost",O[O.AAIClientQuestionUidDigestHEAD=41]="AAIClientQuestionUidDigestHEAD",O[O.AAIClientQuestionUidDigestTAIL=42]="AAIClientQuestionUidDigestTAIL",O[O.AIClinetSmartDenoise=43]="AIClinetSmartDenoise"})(_||(_={})),(function(O){O[O.NetsdkThrCost=44]="NetsdkThrCost",O[O.QosThrCost=45]="QosThrCost",O[O.PacerCost=46]="PacerCost",O[O.UpRTTHalf=47]="UpRTTHalf",O[O.AIClientNetsdkThrCost=48]="AIClientNetsdkThrCost",O[O.AIClientQosThrCost=49]="AIClientQosThrCost",O[O.AIClientPacerCost=50]="AIClientPacerCost",O[O.AIClientUpRTTHalf=51]="AIClientUpRTTHalf"})(A||(c.ECumuDelayAVCommonKey=A={})),(function(O){O[O.AIAsrCost=64]="AIAsrCost",O[O.AILlmCost=65]="AILlmCost",O[O.AITtsCost=66]="AITtsCost",O[O.AIMuteCost=67]="AIMuteCost",O[O.AIAgentTotalCost=68]="AIAgentTotalCost",O[O.AIAgentExtraAvatarCost=69]="AIAgentExtraAvatarCost"})(E||(E={})),(function(O){O[O.PubSdkType=100]="PubSdkType",O[O.PubSdkVersion=101]="PubSdkVersion"})(b||(c.ECumuDelayPubSdkKey=b={})),(function(O){O[O.NGX_RTC_SEI_CUMULATIVE_DELAY_KEY_INTERNAL_RTT_HALF=121]="NGX_RTC_SEI_CUMULATIVE_DELAY_KEY_INTERNAL_RTT_HALF",O[O.NGX_RTC_SEI_CUMULATIVE_DELAY_KEY_GRTN_NODE_BEF_PACER=122]="NGX_RTC_SEI_CUMULATIVE_DELAY_KEY_GRTN_NODE_BEF_PACER",O[O.NGX_RTC_SEI_CUMULATIVE_DELAY_KEY_GRTN_NODE_PACER_COST=123]="NGX_RTC_SEI_CUMULATIVE_DELAY_KEY_GRTN_NODE_PACER_COST",O[O.NGX_RTC_SEI_CUMULATIVE_DELAY_KEY_DOWN_RTT_HALF=124]="NGX_RTC_SEI_CUMULATIVE_DELAY_KEY_DOWN_RTT_HALF"})(w||(c.ECumuDelayGrtnKey=w={})),(function(O){O[O.AIGRTNInternalRTTHalf=104]="AIGRTNInternalRTTHalf",O[O.AIGRTNBeforePacer=105]="AIGRTNBeforePacer",O[O.AIGRTNPacerCost=106]="AIGRTNPacerCost",O[O.AIGRTNDownRTTHalf=107]="AIGRTNDownRTTHalf"})(C||(C={}));var U=function(O){O.msid=T.SophonAudio;var x=P[O.msid];x||console.warn("No mapped msid for cumuDelay",O.msid);var F=new ArrayBuffer(O.sendTs?8:4);if(O.sendTs){var N=Math.floor(performance.now()+performance.timeOrigin-O.windowTimeOrigin);N>=Math.pow(2,32)-1&&(N=0);var k=new DataView(F);k.setUint8(0,8),k.setUint8(1,0),k.setUint8(2,x),k.setUint8(3,5),k.setUint32(4,N)}else new Uint8Array(F).set([0,0,x,1]);O.kv[b.PubSdkType]=y.Web,O.kv[b.PubSdkVersion]=Number(h.default.version.split(".").join("").split("-")[0]);var M=Object.keys(O.kv).length;M>256&&console.warn("Too much kv");var j,G,z,V,re=1+3*M+1,Q=new ArrayBuffer(re),Z=new DataView(Q);Z.setInt8(0,M),Object.keys(O.kv).forEach((function(q,Y){q in p(p(p({},m),A),b)||console.warn("Unknown CumuDelay key: ".concat(q));var J=O.kv[q],$=1+3*Y;Z.setUint8($,parseInt(q)),Z.setUint16($+1,J)})),Z.setUint8(re-1,128),this.buffer=(j=F,G=Q,z=new ArrayBuffer(j.byteLength+G.byteLength),(V=new Uint8Array(z)).set(new Uint8Array(j),0),V.set(new Uint8Array(G),j.byteLength),z)};c.CumuDelaySeiPayload=U;var B=function(O){var x;this.pub={},this.grtn={},this.AIPub={},this.AISub={},this.AIAgent={},this.AIGrtn={},this.other={};var F,N,k=new H(O),M=(k.readBits(3),k.readBits()),j=k.readBits(),G=k.readBits(),z=k.readBits(),V=k.readBits();if(k.readBits(8),k.readBits(8),k.readBits(8),M===1&&k.readBits(16),j===1){var re=k.readBits(32);this.pub.timestamp=re,this.pub.timestampRecv=Math.floor(performance.now())}G===1&&k.readBits(16),z===1&&(F=k.readBits(32)),V===1&&(N=k.readBits(32)),F&&N&&(this.grtn=((x={})[v.TOTAL_COST]=N-F,x[v.ENTER_GRTN_TIMESTAMP]=F,x[v.LEAVE_GRTN_TIMESTAMP]=N,x));for(var Q=k.readBits(8),Z=0;Z<Q;Z++){var q=k.readBits(8),Y=k.readBits(16);if(L(q,[m.VTotalCost,m.VEncPlugCost])||L(q,[_.ATotalCost,_.AEncodeCCost])||L(q,[A.NetsdkThrCost,A.UpRTTHalf])||L(q,[b.PubSdkType,b.PubSdkVersion])){var J=m[q]||_[q]||A[q]||b[q];this.pub[J]=Y}else if(L(q,[_.AAIClientQuestionTimestampHEAD,_.AAIClientEncoderCost])||L(q,[A.AIClientNetsdkThrCost,A.AIClientUpRTTHalf]))J=_[q]||A[q],this.AIPub[J]=Y;else if(L(q,[_.AAILinuxReceiveCost,_.AIClinetSmartDenoise]))J=_[q],this.AISub[J]=Y;else if(L(q,[E.AIAsrCost,E.AIAgentExtraAvatarCost]))J=E[q],this.AIAgent[J]=Y;else if(L(q,[C.AIGRTNInternalRTTHalf,C.AIGRTNDownRTTHalf])){J=C[q];for(var $=0,te="".concat(J,"_").concat($);this.AIGrtn.hasOwnProperty(te);)te="".concat(J,"_").concat($++);this.AIGrtn[te]=Y}else if(L(q,[w.NGX_RTC_SEI_CUMULATIVE_DELAY_KEY_INTERNAL_RTT_HALF,w.NGX_RTC_SEI_CUMULATIVE_DELAY_KEY_DOWN_RTT_HALF])){for(J=w[q],$=0,te="".concat(J,"_").concat($);this.grtn.hasOwnProperty(te);)te="".concat(J,"_").concat($++);this.grtn[te]=Y}else this.other[q]=Y}};function L(O,x){return O>=x[0]&&O<=x[1]}c.CumuDelaySeiPayloadParser=B;var H=(function(){function O(x){this.byteOffset=0,this.bitOffset=0;var F=new Uint8Array(x);this.buffer=F}return O.prototype.readBits=function(x){x===void 0&&(x=1);for(var F=0,N=0;N<x;){if(this.byteOffset>=this.buffer.byteLength)throw new Error("readBits out of range");var k=8-this.bitOffset,M=Math.min(k,x-N);F=F<<M|this.getBitsFromByte(this.buffer,this.byteOffset,this.bitOffset,this.bitOffset+M-1),this.bitOffset+=M,N+=M,this.bitOffset===8&&(this.byteOffset++,this.bitOffset=0)}return x===32&&(F>>>=0),F},O.prototype.hasNext=function(){return this.byteOffset<this.buffer.byteLength},O.prototype.getBitsFromByte=function(x,F,N,k){if(F<0||F>=x.byteLength||N<0||k>7||N>k)throw new Error("Invalid parameters");return x[F]>>7-k&(1<<k-N+1)-1},O})()},102:(g,c)=>{Object.defineProperty(c,"__esModule",{value:!0});var s=(function(){function d(){this._eventMap={}}return d.prototype.listeners=function(l){return this._eventMap[l]||[]},d.prototype.emit=function(l){for(var p=this,S=[],T=1;T<arguments.length;T++)S[T-1]=arguments[T];var y=this._eventMap[l];return!!Array.isArray(y)&&(y.forEach((function(R){return R.apply(p,S)})),!0)},d.prototype.off=function(l,p){var S=this._eventMap[l];return Array.isArray(S)&&(this._eventMap[l]=S.filter((function(T){return T!==p}))),this},d.prototype.removeAllListeners=function(l){return l===void 0?this._eventMap={}:this._eventMap[l]&&(this._eventMap[l]=[]),this},d.prototype.on=function(l,p){return this._eventMap[l]?this._eventMap[l].push(p):this._eventMap[l]=[p],this},d.prototype.once=function(l,p){var S=this,T=function(){for(var y=[],R=0;R<arguments.length;R++)y[R]=arguments[R];S.off(l,T),p.apply(S,y)};return this.on(l,T),this},d})();c.default=s},492:(g,c)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.MediaObserver=void 0;var s=(function(){function d(l){this.timeout=l.timeout||d.DEFAULT_TIMEOUT,this.handler=l.handler||function(){},this.watchTimer=null}return Object.defineProperty(d.prototype,"actTimeout",{get:function(){return this.timeout},enumerable:!1,configurable:!0}),d.prototype.check=function(l,p,S,T){var y=this;this.hasNoData(l)?this.watchTimer||(this.watchTimer=window.setTimeout((function(){y.handler(p,S,T)}),this.timeout)):this.watchTimer&&(clearTimeout(this.watchTimer),this.watchTimer=null)},d.prototype.hasNoData=function(l){return!l||(l.video?!(Number(l.video.bytesReceivedPerSecond)>0):!l.audio||!(Number(l.audio.bytesReceivedPerSecond)>0))},d.prototype.updateConfig=function(l){this.timeout=l.timeout||this.timeout,this.handler=l.handler||this.handler},d.prototype.reset=function(){this.watchTimer&&(clearTimeout(this.watchTimer),this.watchTimer=null)},d.prototype.dispose=function(){this.timeout=d.DEFAULT_TIMEOUT,this.handler=function(){},this.watchTimer&&(clearTimeout(this.watchTimer),this.watchTimer=null)},d.DEFAULT_TIMEOUT=6e3,d})();c.MediaObserver=s},9594:(g,c,s)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.readUUID=c.discardEPB=c.insertEPB=c.SODBtoRBSP=c.convertPayloadSize=c.NALU=c.SEI=c.parseSei=c.insertSei=void 0;var d=s(5649);c.insertSei=function(T,y,R,v){R===void 0&&(R=5);for(var h=T.data,m=new DataView(h),_=0;;){if(m.getUint32(_)===1){m.getUint8(_+4);var A=new l(y,R,v).buffer,E=new p(A).buffer,b=new ArrayBuffer(E.byteLength+h.byteLength),w=new Uint8Array(b),C=new Uint8Array(E);w.set(C);var P=new Uint8Array(h);w.set(P,E.byteLength),T.data=b,_+=1;break}if((_+=1)+4>=m.byteLength)break}},c.parseSei=function(T){for(var y=[],R=new DataView(T),v=0;;){var h=v,m=R.getUint32(h);if(h+=4,m===1){if((31&R.getUint8(h++))===6){for(var _=R.getUint8(h++),A=S(_)?16:0,E=0;R.getUint8(h)==255;)h++,E+=255;if((E+=R.getUint8(h++))>0&&R.byteLength>h+E){var b=new Uint8Array(R.buffer),w="";if(S(_)){var C=b.slice(h,h+A);w=(0,c.readUUID)((0,c.discardEPB)(C))}var P=b.slice(h+A,h+E);h+=E,y.push({payloadType:_,uuid:w,data:P.buffer})}}v=h}else v+=1;if(v+4>=R.byteLength)break}return y};var l=function(T,y,R){y===void 0&&(y=5);var v=S(y)?16:0,h=T.byteLength+v,m=(0,c.convertPayloadSize)(h),_=m.buffer.byteLength,A=new ArrayBuffer(1+_+v+T.byteLength),E=new Uint8Array(A),b=0;if(E[b++]=y,E.set(m,b),b+=m.byteLength,S(y)){R=(R||"00000000-0000-0000-0000-000000000000").replace(/-/g,"");for(var w=0;w<16;w++)E[b+w]=parseInt(R.substr(2*w,2),16);b+=16}var C=new Uint8Array(T);E.set(C,b);var P=(0,c.SODBtoRBSP)(E);this.buffer=P.buffer};c.SEI=l;var p=function(T){var y=new Uint8Array([0,0,0,1]),R=new Uint8Array([6]),v=new ArrayBuffer(y.byteLength+R.byteLength+T.byteLength),h=new Uint8Array(v);h.set(y),h.set(R,y.byteLength),h.set(new Uint8Array(T),y.byteLength+R.byteLength),this.buffer=v};c.NALU=p,c.convertPayloadSize=function(T){if(T<=0)throw new Error("payloadSize must be a positive integer.");for(var y=Math.ceil(T/255),R=new ArrayBuffer(y),v=new DataView(R),h=0;h<y-1;h++)v.setUint8(h,255);return v.setUint8(y-1,T%255&255),new Uint8Array(R)},c.SODBtoRBSP=function(T){for(var y=new Uint8Array(T),R="",v=0;v<y.length;v++)R+=y[v].toString(2).padStart(8,"0");for(R+="1";R.length%8!=0;)R+="0";var h=R.length/8,m=new Uint8Array(h);for(v=0;v<h;v++)m[v]=parseInt(R.slice(8*v,8*v+8),2);return(0,c.insertEPB)(m)},c.insertEPB=function(T){for(var y=[],R=0,v=0;v<T.length;v++)y.push(T[v]),T[v]===0?++R===2&&v<T.length-1&&T[v+1]<=3&&(y.push(3),R=0):R=0;return new Uint8Array(y)},c.discardEPB=function(T){for(var y=T.byteLength,R=[],v=1;v<y-2;)T[v]===0&&T[v+1]===0&&T[v+2]===3?(R.push(v+2),v+=2):v++;if(R.length===0)return T;var h=y-R.length,m=new Uint8Array(h),_=0;for(v=0;v<h;_++,v++)_===R[0]&&(_++,R.shift()),m[v]=T[_];return m},c.readUUID=function(T){if(T.length!==16)throw new Error("UUID must be 16 bytes long.");var y=T.reduce((function(R,v){return R+v.toString(16).padStart(2,"0")}),"");return"".concat(y.slice(0,8),"-").concat(y.slice(8,12),"-").concat(y.slice(12,16),"-").concat(y.slice(16,20),"-").concat(y.slice(20))};var S=function(T){return T===5||T===d.CUMU_DELAY_SEI_PAYLOAD_TYPE}},8219:function(g,c,s){var d=this&&this.__importDefault||function(p){return p&&p.__esModule?p:{default:p}};Object.defineProperty(c,"__esModule",{value:!0});var l=d(s(2505));c.default=l.default.create({baseURL:"",timeout:5e3,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}})},4315:function(g,c,s){var d=this&&this.__spreadArray||function(T,y,R){if(R||arguments.length===2)for(var v,h=0,m=y.length;h<m;h++)!v&&h in y||(v||(v=Array.prototype.slice.call(y,0,h)),v[h]=y[h]);return T.concat(v||Array.prototype.slice.call(y))};Object.defineProperty(c,"__esModule",{value:!0}),c.SdpUtil=void 0;var l=s(233),p=function(){this.stramId="",this.audioTrackId="",this.videoTrackId="",this.screenTrackId="",this.customTrackId=""},S=(function(){function T(y){this.sdpLines=new Array,this.localStream=y,this.publishStreamInfo=new p}return Object.defineProperty(T.prototype,"sdp",{get:function(){return this.sdpLines.join(`\r
`)},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"videoTrackId",{get:function(){return this.publishStreamInfo.videoTrackId},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"screenTrackId",{get:function(){return this.publishStreamInfo.videoTrackId},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"videoName",{get:function(){return"rts video"},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"screenName",{get:function(){return"rts screen"},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"hasTcpCandidate",{get:function(){return this.sdpLines.some((function(y){return y.indexOf("tcptype")!==-1}))},enumerable:!1,configurable:!0}),T.prototype.init=function(y){this.sdpLines=y.split(`\r
`)},T.prototype.addNack=function(){for(var y=0;y<this.sdpLines.length;++y)if(this.sdpLines[y].indexOf("opus")!=-1&&this.sdpLines[y+1].indexOf("rtcp-fb")!=-1){var R=this.sdpLines[y+1].split(" ");R.length==2&&(this.sdpLines[y+2].indexOf("rtcp-fb")!=-1?this.sdpLines.splice(y+3,0,R[0]+" nack"):this.sdpLines.splice(y+2,0,R[0]+" nack"))}},T.prototype.parseCustomMsid=function(y){var R={stream:"",track:""};if(!y)return R;var v=y.trim().split(" ");return v.length==2?(R.stream=v[0],R.track=v[1]):R.track=v[0],R},T.prototype.modifyTrackName=function(y){y===void 0&&(y={});var R=y.vMsid,v=y.aMsid,h=R?this.parseCustomMsid(R):{stream:"rts",track:"video"},m=v?this.parseCustomMsid(v):{stream:"rts",track:"audio"},_="";if(this.localStream){this.publishStreamInfo.stramId=this.localStream.mediaStream.id,this.localStream.audioTrack&&(this.publishStreamInfo.audioTrackId=this.localStream.audioTrack.id,_=m.stream||"-"),this.localStream.videoTrack&&(this.publishStreamInfo.videoTrackId=this.localStream.videoTrack.id,_=h.stream||"-");for(var A=!1,E=!1,b=0;b<this.sdpLines.length;++b){var w=this.sdpLines[b],C=w.indexOf(this.publishStreamInfo.stramId);this.publishStreamInfo.stramId&&C!=-1&&(this.sdpLines[b]=this.sdpLines[b].replace(this.publishStreamInfo.stramId,_),l.BrowserUtil.isFirefox&&(A?this.sdpLines[b]=this.sdpLines[b].substring(0,C+_.length+1)+m.track:E&&(this.sdpLines[b]=this.sdpLines[b].substring(0,C+_.length+1)+h.track))),this.publishStreamInfo.audioTrackId&&w.indexOf(this.publishStreamInfo.audioTrackId)!=-1?this.sdpLines[b]=this.sdpLines[b].replace(this.publishStreamInfo.audioTrackId,m.track):this.publishStreamInfo.videoTrackId&&w.indexOf(this.publishStreamInfo.videoTrackId)!=-1&&(this.sdpLines[b]=this.sdpLines[b].replace(this.publishStreamInfo.videoTrackId,h.track)),w.indexOf("m=audio")!=-1?(A=!0,E=!1):w.indexOf("m=video")!=-1&&(E=!0,A=!1),w.indexOf("a=ssrc")!=-1&&(C=w.indexOf("cname:"))!==-1&&(A?this.sdpLines[b]=w.substr(0,C+6)+m.track:E&&(this.sdpLines[b]=w.substr(0,C+6)+h.track))}}},T.prototype.getPublishVideoSdp=function(){for(var y=-1,R=-1,v=!1,h=0;h<this.sdpLines.length;++h){if(v&&this.sdpLines[h].indexOf("m=application")>-1){R=h-1;break}if(this.sdpLines[h].indexOf("m=video")>-1){if(v){R=h-1;break}y=h}this.sdpLines[h].indexOf("rts video")>-1&&(v=!0)}return v?(R===-1&&(R=this.sdpLines.length-1),this.sdpLines.splice(y,R-y).join(`\r
`)):""},T.prototype.removeVideoTrack=function(y){for(var R="rts "+y,v=-1,h=-1,m=!1,_=0;_<this.sdpLines.length;++_){if(m&&this.sdpLines[_].indexOf("m=application")>-1){h=_-1;break}if(this.sdpLines[_].indexOf("m=video")>-1){if(m){h=_-1;break}v=_}this.sdpLines[_].indexOf(R)>-1&&(m=!0)}return!!m&&(h===-1&&(h=this.sdpLines.length-1),this.sdpLines.splice(v,h-v),!0)},T.prototype.ios15PushHack=function(){var y=!1,R=-1;if(this.sdpLines.forEach((function(m,_){m.includes("m=video")&&(y=!0),y&&R===-1&&m.includes("a=")&&(R=_)})),R!==-1){var v=this.getExtmapIds(),h=Math.max.apply(Math,v)+1;this.sdpLines.splice(R,0,"a=extmap:".concat(h," urn:3gpp:video-orientation"))}},T.prototype.addSps=function(){this.sdpLines=this.sdpLines.map((function(y){return y.includes("a=fmtp:")&&y.includes("level-asymmetry-allowed")?y+=";sps-pps-idr-in-keyframe=1":y}))},T.prototype.removeTwccRtcpFb=function(){this.sdpLines=this.sdpLines.filter((function(y){return!y.includes("http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")}))},T.prototype.removeUdpCandidate=function(){this.sdpLines=this.sdpLines.filter((function(y){return!y.includes("a=candidate:")||!y.includes("UDP")}))},T.prototype.setDirection=function(y){y===void 0&&(y={direction:"recvonly"});var R=["sendonly","recvonly","sendrecv"].filter((function(m){return m!==y.direction})),v=!1,h=!1;this.sdpLines=this.sdpLines.map((function(m,_){if(m.includes("m=video"))v=!0,h=!1;else if(m.includes("m=audio"))h=!0,v=!1;else if(m.includes("m=application"))v=!1,h=!1;else if(v||h){var A;if(R.some((function(E){if(m.includes(E))return A=E,!0}))&&A)return m.replace(A,y.direction)}return m}))},T.prototype.removeSDES=function(){var y=["urn:ietf:params:rtp-hdrext:sdes:mid","urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id","urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id"];this.sdpLines=this.sdpLines.filter((function(R){return!y.some((function(v){return R.includes(v)}))}))},T.prototype.addStereo=function(){var y=this;this.getPayloadType("opus").map(this.getFmtpIndex.bind(this)).filter((function(R){return R!==void 0})).forEach((function(R){y.sdpLines[R].indexOf("stereo=1")>-1||(y.sdpLines[R]=y.sdpLines[R]+";stereo=1")}))},T.prototype.setSingleNaluPackMode__legacy=function(){this.sdpLines=this.sdpLines.filter((function(y){return!y.includes("a=fmtp:")||!y.includes("packetization-mode=1")}))},T.prototype.setSingleNaluPackMode=function(){var y=this,R=[],v=[],h=!1;if(this.sdpLines.forEach((function(w){if(w.includes("packetization-mode=0")&&(h=!0),w.includes("packetization-mode=1")){var C=y.parseFmtpValue(w);R.push(C||"NULL")}R.length&&new RegExp("apt=(".concat(R.join("|"),")")).test(w)&&(C=y.parseFmtpValue(w),v.push(C||"NULL"))})),!h)return!1;var m=d(d([],R,!0),v,!0).join("|"),_=new RegExp("(rtpmap|rtcp-fb|fmtp):.*?(".concat(m,")"));this.sdpLines=this.sdpLines.filter((function(w){return!_.test(w)}));for(var A=0;A<this.sdpLines.length;A++){var E=this.sdpLines[A];if(E.includes("m=video")){var b=new RegExp("( ".concat(d(d([],R,!0),v,!0).join("| "),")"),"g");this.sdpLines[A]=E.replace(b,"");break}}return!0},T.prototype.dispose=function(){this.localStream&&(this.localStream=void 0),this.sdpLines=new Array,this.publishStreamInfo=new p},T.prototype.getExtmapIds=function(){return this.sdpLines.reduce((function(y,R){if(R.includes("a=extmap")){var v=Number(R.replace("a=extmap:","").split(" ")[0]);return d(d([],y,!0),[v],!1)}return y}),[]).filter((function(y){return y}))},T.prototype.getPayloadType=function(y){for(var R=[],v=new RegExp("a\\=rtpmap\\:(\\d+) ".concat(y,".*"),"i"),h=0;h<this.sdpLines.length;h++){var m=this.sdpLines[h],_=v.exec(m);_?.length&&R.push(_[1])}return R},T.prototype.getFmtpIndex=function(y){for(var R=new RegExp("a\\=fmtp\\:".concat(y," .*"),"i"),v=0;v<this.sdpLines.length;v++){var h=this.sdpLines[v];if(R.test(h))return v}},T.prototype.parseFmtpValue=function(y){var R=y.match(/a=fmtp:(\d+)/);return R?R[1]:null},T})();c.SdpUtil=S},7989:function(g,c,s){var d=this&&this.__awaiter||function(h,m,_,A){return new(_||(_=Promise))((function(E,b){function w(U){try{P(A.next(U))}catch(B){b(B)}}function C(U){try{P(A.throw(U))}catch(B){b(B)}}function P(U){var B;U.done?E(U.value):(B=U.value,B instanceof _?B:new _((function(L){L(B)}))).then(w,C)}P((A=A.apply(h,m||[])).next())}))},l=this&&this.__generator||function(h,m){var _,A,E,b,w={label:0,sent:function(){if(1&E[0])throw E[1];return E[1]},trys:[],ops:[]};return b={next:C(0),throw:C(1),return:C(2)},typeof Symbol=="function"&&(b[Symbol.iterator]=function(){return this}),b;function C(P){return function(U){return(function(B){if(_)throw new TypeError("Generator is already executing.");for(;b&&(b=0,B[0]&&(w=0)),w;)try{if(_=1,A&&(E=2&B[0]?A.return:B[0]?A.throw||((E=A.return)&&E.call(A),0):A.next)&&!(E=E.call(A,B[1])).done)return E;switch(A=0,E&&(B=[2&B[0],E.value]),B[0]){case 0:case 1:E=B;break;case 4:return w.label++,{value:B[1],done:!1};case 5:w.label++,A=B[1],B=[0];continue;case 7:B=w.ops.pop(),w.trys.pop();continue;default:if(E=w.trys,!((E=E.length>0&&E[E.length-1])||B[0]!==6&&B[0]!==2)){w=0;continue}if(B[0]===3&&(!E||B[1]>E[0]&&B[1]<E[3])){w.label=B[1];break}if(B[0]===6&&w.label<E[1]){w.label=E[1],E=B;break}if(E&&w.label<E[2]){w.label=E[2],w.ops.push(B);break}E[2]&&w.ops.pop(),w.trys.pop();continue}B=m.call(h,w)}catch(L){B=[6,L],A=0}finally{_=E=0}if(5&B[0])throw B[1];return{value:B[0]?B[1]:void 0,done:!0}})([P,U])}}};Object.defineProperty(c,"__esModule",{value:!0}),c.SupportUtil=void 0;var p=s(233),S=s(3412),T=s(9428),y=s(2672),R=function(){this.errorCode=0,this.message=""},v=(function(){function h(){this.deviceManager=new S.BrowserDeviceManager}return h.prototype.isSupport=function(m){var _=this;return new Promise((function(A,E){return d(_,void 0,void 0,(function(){var b,w,C,P;return l(this,(function(U){switch(U.label){case 0:return b=new R,this.checkWebRtcSupport()?m.onlyCheckUA?this.checkBrowser(b)?[3,3]:[2,E(b)]:[3,1]:(b.errorCode=T.ErrorCode.ERROR_NOTSUPPORT_WEBRTC,b.message=y.EN.MESSAGE_NOTSUPPORT_WEBRTC,[2,E(b)]);case 1:return[4,this.checkWebrtcAbilities()];case 2:if(w=U.sent(),C=w[0],w[1],w[2],P=w[3],!C)return b.errorCode=T.ErrorCode.ERROR_NOTSUPPORT_WEBRTC,b.message=y.EN.MESSAGE_NOTSUPPORT_WEBRTC,[2,E(b)];if(P)return b.errorCode=T.ErrorCode.ERROR_BROWSER_NOTSUPPORT,b.message=y.EN.MESSAGE_BROWSER_NOTSUPPORT,[2,E(b)];U.label=3;case 3:return m.isReceiveVideo?this.checkH264Decode(b).then((function(){A(b)})).catch((function(){E(b)})):A(b),[2]}}))}))}))},h.prototype.checkEncodedTransformSupport=function(){var m=window.RTCRtpReceiver&&"createEncodedStreams"in RTCRtpReceiver.prototype,_=window.RTCRtpReceiver&&"transform"in RTCRtpReceiver.prototype&&"RTCRtpScriptTransform"in window;return m||_},h.prototype.checkWebrtcAbilities=function(m){return d(this,void 0,void 0,(function(){var _,A,E,b,w,C,P,U,B;return l(this,(function(L){switch(L.label){case 0:_=window.RTCPeerConnection,A=!1,E=!1,b=null,w=!1,L.label=1;case 1:return L.trys.push([1,4,,5]),_?(C=new _,E="createDataChannel"in C,m&&(P=this.createBlankStream()).getTracks().forEach((function(H){C?.addTrack(H,P)})),[4,C.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0,iceRestart:!0})]):[3,3];case 2:U=L.sent(),B=(U||{}).sdp,b=m?!!(B&&B.indexOf("a=sendrecv")>-1):null,C.close(),C=void 0,A=!0,L.label=3;case 3:return[3,5];case 4:return L.sent(),A=!1,E=!1,b=!1,[3,5];case 5:return w=this.checkBlackList(),[2,[A,E,b,w]]}}))}))},h.prototype.checkPublishSupport=function(){return d(this,void 0,void 0,(function(){var m,_,A,E,b,w,C,P;return l(this,(function(U){switch(U.label){case 0:return m={isWebRTCSupported:!1,isH264EncodeSupported:!1,isMediaDevicesSupported:!1,isScreenCaptureSupported:!1,isAudioMixSupported:!1,cameraList:[],micList:[],speakerList:[]},this.checkWebRtcSupport()?[3,1]:(m.isWebRTCSupported=!1,m.isH264EncodeSupported=!1,[3,5]);case 1:return[4,this.checkWebrtcAbilities(!0)];case 2:return _=U.sent(),A=_[0],_[1],E=_[2],m.isWebRTCSupported=!(!A||!E),m.isWebRTCSupported?[3,3]:(m.isH264EncodeSupported=!1,[3,5]);case 3:return b=m,[4,this.checkH264Encode()];case 4:b.isH264EncodeSupported=U.sent(),U.label=5;case 5:if(m.isMediaDevicesSupported=this.checkMediaDevices(),m.isScreenCaptureSupported=this.checkScreenCapture(),m.isAudioMixSupported=this.checkAudioMix(),!m.isMediaDevicesSupported)return[3,11];U.label=6;case 6:return U.trys.push([6,10,,11]),w=m,[4,this.deviceManager.getCameraList()];case 7:return w.cameraList=U.sent().filter((function(B){return B.deviceId})),C=m,[4,this.deviceManager.getMicList()];case 8:return C.micList=U.sent().filter((function(B){return B.deviceId})),P=m,[4,this.deviceManager.getSpeakerList()];case 9:return P.speakerList=U.sent().filter((function(B){return B.deviceId})),[3,11];case 10:return U.sent(),[3,11];case 11:return[2,m]}}))}))},h.prototype.checkWebRtcSupport=function(){return!!window.RTCPeerConnection},h.prototype.checkMediaDevices=function(){return!(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)},h.prototype.checkScreenCapture=function(){return!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia)},h.prototype.checkAudioMix=function(){if(!window.AudioContext)return!1;var m=new AudioContext;return!!m.createMediaStreamDestination&&!!m.createMediaStreamSource},h.prototype.checkBlackList=function(){var m=!1;if(p.BrowserUtil.isOppoBrowser&&p.SystemUtil.isAndroid){var _=(this.getUa().toLowerCase().match(/heytapbrowser\/([\d.]+)/)||[])[1]||"";m=!this.compareVersion(_,"40.7.39.1")}else(p.BrowserUtil.isUCBrowser||p.BrowserUtil.isQuarkBrowser)&&p.SystemUtil.isIos?m=!0:p.BrowserUtil.isWebView&&p.SystemUtil.isAndroid&&(m=!(p.BrowserUtil.browserMainVersion>=79));return m},h.prototype.checkBrowser=function(m){if(p.SystemUtil.isIos){if(p.BrowserUtil.isUCBrowser||p.BrowserUtil.isQuarkBrowser)return m.errorCode=T.ErrorCode.ERROR_BROWSER_NOTSUPPORT,m.message=y.EN.MESSAGE_BROWSER_NOTSUPPORT,!1;if(p.BrowserUtil.isSafari||p.BrowserUtil.isQQBrowser)return p.BrowserUtil.browserMainVersion>=11||(m.errorCode=T.ErrorCode.ERROR_BROWSER_VERSIONLOW,m.message=y.EN.MESSAGE_BROWSER_VERSIONLOW,!1);if(p.BrowserUtil.isEdge||p.BrowserUtil.isChrome)return p.BrowserUtil.browserMainVersion>=79||(m.errorCode=T.ErrorCode.ERROR_BROWSER_VERSIONLOW,m.message=y.EN.MESSAGE_BROWSER_VERSIONLOW,!1);if(p.BrowserUtil.isMicroMessenger)return!!this.compareVersion(p.SystemUtil.systemVersion,"12.1.4")||(m.errorCode=T.ErrorCode.ERROR_BROWSER_VERSIONLOW,m.message=y.EN.MESSAGE_BROWSER_VERSIONLOW,!1);if(p.BrowserUtil.isDingTalk)return!!p.SystemUtil.compareVersion("11.2.5")||(m.errorCode=T.ErrorCode.ERROR_BROWSER_VERSIONLOW,m.message=y.EN.MESSAGE_BROWSER_VERSIONLOW,!1);if(p.BrowserUtil.isWebView)return!!this.compareVersion(p.SystemUtil.systemVersion,"14.3")||(m.errorCode=T.ErrorCode.ERROR_BROWSER_VERSIONLOW,m.message=y.EN.MESSAGE_BROWSER_VERSIONLOW,!1)}else if(p.SystemUtil.isAndroid){if(this.checkPrivateUcWebview())return!0;if(p.BrowserUtil.isChrome||p.BrowserUtil.isQQBrowser||p.BrowserUtil.isHuaweiBrowser||p.BrowserUtil.isSamsungBrowser)return p.BrowserUtil.browserMainVersion>=63||(m.errorCode=T.ErrorCode.ERROR_BROWSER_VERSIONLOW,m.message=y.EN.MESSAGE_BROWSER_VERSIONLOW,!1);if(p.BrowserUtil.isEdge)return p.BrowserUtil.browserMainVersion>=79||(m.errorCode=T.ErrorCode.ERROR_BROWSER_VERSIONLOW,m.message=y.EN.MESSAGE_BROWSER_VERSIONLOW,!1);if(p.BrowserUtil.isMicroMessenger)return!!this.compareVersion(this.getChromeCoreVersion(),"63")||(m.errorCode=T.ErrorCode.ERROR_BROWSER_VERSIONLOW,m.message=y.EN.MESSAGE_BROWSER_VERSIONLOW,!1);if(p.BrowserUtil.isDingTalk)return!!this.compareVersion(this.getChromeCoreVersion(),"69")||(m.errorCode=T.ErrorCode.ERROR_BROWSER_VERSIONLOW,m.message=y.EN.MESSAGE_BROWSER_VERSIONLOW,!1);if(p.BrowserUtil.isOppoBrowser){var _=(this.getUa().toLowerCase().match(/heytapbrowser\/([\d.]+)/)||[])[1]||"";return!!this.compareVersion(_,"40.7.39.1")||(m.errorCode=T.ErrorCode.ERROR_BROWSER_VERSIONLOW,m.message=y.EN.MESSAGE_BROWSER_VERSIONLOW,!1)}if(p.BrowserUtil.isX5Core)return!0;if(p.BrowserUtil.isWebView)return p.BrowserUtil.browserMainVersion>=79||(m.errorCode=T.ErrorCode.ERROR_BROWSER_VERSIONLOW,m.message=y.EN.MESSAGE_BROWSER_VERSIONLOW,!1)}else if(p.SystemUtil.isMacOS){if(p.BrowserUtil.isElectron)return!0;if(p.BrowserUtil.isSafari)return p.BrowserUtil.browserMainVersion>=11||(m.errorCode=T.ErrorCode.ERROR_BROWSER_VERSIONLOW,m.message=y.EN.MESSAGE_BROWSER_VERSIONLOW,!1);if(p.BrowserUtil.isChrome)return p.BrowserUtil.browserMainVersion>=63||(m.errorCode=T.ErrorCode.ERROR_BROWSER_VERSIONLOW,m.message=y.EN.MESSAGE_BROWSER_VERSIONLOW,!1);if(p.BrowserUtil.isEdge)return p.BrowserUtil.browserMainVersion>=79||(m.errorCode=T.ErrorCode.ERROR_BROWSER_VERSIONLOW,m.message=y.EN.MESSAGE_BROWSER_VERSIONLOW,!1);if(p.BrowserUtil.isFirefox)return p.BrowserUtil.browserMainVersion>=62||(m.errorCode=T.ErrorCode.ERROR_BROWSER_VERSIONLOW,m.message=y.EN.MESSAGE_BROWSER_VERSIONLOW,!1);if(p.BrowserUtil.isOpera)return p.BrowserUtil.browserMainVersion>=15||(m.errorCode=T.ErrorCode.ERROR_BROWSER_VERSIONLOW,m.message=y.EN.MESSAGE_BROWSER_VERSIONLOW,!1)}else if(p.SystemUtil.isWindows){if(p.BrowserUtil.isElectron||p.BrowserUtil.isMicroMessenger)return!0;if(p.BrowserUtil.isChrome||p.BrowserUtil.isQQBrowser)return p.BrowserUtil.browserMainVersion>=63||(m.errorCode=T.ErrorCode.ERROR_BROWSER_VERSIONLOW,m.message=y.EN.MESSAGE_BROWSER_VERSIONLOW,!1);if(p.BrowserUtil.isEdge)return p.BrowserUtil.browserMainVersion>=79||(m.errorCode=T.ErrorCode.ERROR_BROWSER_VERSIONLOW,m.message=y.EN.MESSAGE_BROWSER_VERSIONLOW,!1);if(p.BrowserUtil.isFirefox)return p.BrowserUtil.browserMainVersion>=62||(m.errorCode=T.ErrorCode.ERROR_BROWSER_VERSIONLOW,m.message=y.EN.MESSAGE_BROWSER_VERSIONLOW,!1);if(p.BrowserUtil.isOpera)return p.BrowserUtil.browserMainVersion>=15||(m.errorCode=T.ErrorCode.ERROR_BROWSER_VERSIONLOW,m.message=y.EN.MESSAGE_BROWSER_VERSIONLOW,!1)}else if(p.SystemUtil.isLinux){if(p.BrowserUtil.isChrome)return p.BrowserUtil.browserMainVersion>=63||(m.errorCode=T.ErrorCode.ERROR_BROWSER_VERSIONLOW,m.message=y.EN.MESSAGE_BROWSER_VERSIONLOW,!1);if(p.BrowserUtil.isEdge)return p.BrowserUtil.browserMainVersion>=79||(m.errorCode=T.ErrorCode.ERROR_BROWSER_VERSIONLOW,m.message=y.EN.MESSAGE_BROWSER_VERSIONLOW,!1);if(p.BrowserUtil.isFirefox)return p.BrowserUtil.browserMainVersion>=62||(m.errorCode=T.ErrorCode.ERROR_BROWSER_VERSIONLOW,m.message=y.EN.MESSAGE_BROWSER_VERSIONLOW,!1)}return m.errorCode===0&&(m.errorCode=T.ErrorCode.ERROR_BROWSER_NOTSUPPORT,m.message=y.EN.MESSAGE_BROWSER_NOTSUPPORT),!1},h.prototype.checkH264Decode=function(m){var _=this;return new Promise((function(A,E){return d(_,void 0,void 0,(function(){var b;return l(this,(function(w){switch(w.label){case 0:return[4,this.tryFindH264FromSdp(m)];case 1:if(b=w.sent())return A(!0),[2];w.label=2;case 2:return w.trys.push([2,4,,5]),[4,this.loadH264(3)];case 3:return b=w.sent(),[3,5];case 4:return w.sent(),[3,5];case 5:return b?A(!0):(m&&m.errorCode===0&&(m.errorCode=T.ErrorCode.ERROR_NOTSUPPORT_H264,m.message=y.EN.MESSAGE_NOTSUPPORT_H264),E(!1)),[2]}}))}))}))},h.prototype.checkSDPSupportH264=function(m){return m.indexOf("H264")>0||m.indexOf("h264")>0||m.indexOf("H.264")>0||m.indexOf("h.264")>0},h.prototype.checkPrivateUcWebview=function(){return this.getUa().indexOf("UniqueCode")>0},h.prototype.getUa=function(){return navigator&&navigator.userAgent||""},h.prototype.getChromeCoreVersion=function(){return(this.getUa().toLowerCase().match(/chrome\/([\d.]+)/)||[])[1]||""},h.prototype.compareVersion=function(m,_){m===void 0&&(m=""),_===void 0&&(_="");for(var A=(m||"").split("."),E=(_||"").split("."),b=0,w=0,C=0;C<A.length&&C<E.length;++C){if((b=isNaN(parseInt(A[C],10))?0:parseInt(A[C],10))<(w=isNaN(parseInt(E[C],10))?0:parseInt(E[C],10)))return!1;if(b>w)return!0}return!0},h.prototype.tryFindH264FromSdp=function(m){return d(this,void 0,void 0,(function(){var _,A,E;return l(this,(function(b){switch(b.label){case 0:if(_=!1,!RTCPeerConnection)return[2,_];A=new RTCPeerConnection,E=void 0,b.label=1;case 1:return b.trys.push([1,3,,4]),[4,A.createOffer({offerToReceiveVideo:!0,offerToReceiveAudio:!0})];case 2:return(E=b.sent())&&E.sdp&&(_=this.checkSDPSupportH264(E.sdp)),[3,4];case 3:return b.sent(),_=!1,m&&(m.errorCode=T.ErrorCode.ERROR_CREATEOFFER,m.message=y.EN.MESSAGE_CREATEOFFER),[3,4];case 4:return A.close(),A=void 0,[2,_]}}))}))},h.prototype.loadH264=function(m){var _=this;return new Promise((function(A,E){return d(_,void 0,void 0,(function(){var b,w,C,P,U=this;return l(this,(function(B){if(!p.SystemUtil.isAndroid||!p.BrowserUtil.isChrome&&!p.BrowserUtil.isWebView)return A(!1),[2];for(b=0,w=[],C=0;b<m;)P=setTimeout((function(){return d(U,void 0,void 0,(function(){return l(this,(function(L){switch(L.label){case 0:return C++,[4,this.tryFindH264FromSdp()];case 1:return L.sent()?(w.forEach((function(H){clearTimeout(H)})),w=[],A(!0),[2]):(C===m&&A(!1),[2])}}))}))}),1e3*b),w.push(P),b++;return[2]}))}))}))},h.prototype.checkH264Encode=function(){return d(this,void 0,void 0,(function(){var m,_;return l(this,(function(A){switch(A.label){case 0:return[4,this.loadH264(3)];case 1:A.sent(),(m=new RTCPeerConnection).addTransceiver("video",{direction:"sendonly"}),A.label=2;case 2:return A.trys.push([2,4,,5]),[4,m.createOffer()];case 3:return _=A.sent(),[2,this.checkSDPSupportH264(_.sdp||"")];case 4:return A.sent(),[2,!1];case 5:return[2]}}))}))},h.prototype.createBlankStream=function(){var m,_,A,E=(m=new AudioContext,_=m.createOscillator(),A=_.connect(m.createMediaStreamDestination()),_.start(),Object.assign(A.stream.getAudioTracks()[0],{enabled:!1}));E.stop();var b=(function(w){var C,P={},U=P.width,B=U===void 0?160:U,L=P.height,H=L===void 0?90:L,O=document.createElement("canvas");O.width=B,O.height=H,(C=O.getContext("2d"))===null||C===void 0||C.fillRect(0,0,B,H);var x=O.captureStream();return Object.assign(x.getVideoTracks()[0],{enabled:!1})})();return b.stop(),new MediaStream([E,b])},h})();c.SupportUtil=v},2718:function(g,c){var s=this&&this.__spreadArray||function(d,l,p){if(p||arguments.length===2)for(var S,T=0,y=l.length;T<y;T++)!S&&T in l||(S||(S=Array.prototype.slice.call(l,0,T)),S[T]=l[T]);return d.concat(S||Array.prototype.slice.call(l))};Object.defineProperty(c,"__esModule",{value:!0}),c.hebtLog=c.createUUID=c.evaluateNetworkCondition=c.makeCancelable=c.hasVideoTrack=c.hasAudioTrack=c.getVideoTrack=c.getAudioTrack=c.pruneSubUrl=c.getJitterBufferDelayAvg=void 0,c.lowercaseFirstLetter=function(d){return d.replace(/([A-Za-z])/,(function(l){return l.toLowerCase()}))},c.underlineToCamelCase=function(d){return d.replace(/_([a-z])/g,(function(l,p){return p.toUpperCase()}))},c.getJitterBufferDelayAvg=function(d,l){return d&&l?Number(d)/Number(l)*1e3:-1},c.pruneSubUrl=function(d,l){var p=d||"";return p=p.replace("@subaudio=no","").replace("@subvideo=no",""),l&&(p=p.split("?")[0]),p},c.getAudioTrack=function(d){return d.getAudioTracks()[0]},c.getVideoTrack=function(d){return d.getVideoTracks()[0]},c.hasAudioTrack=function(d){return d.getAudioTracks().length>0},c.hasVideoTrack=function(d){return d.getVideoTracks().length>0},c.makeCancelable=function(d){var l=!1;return{promise:new Promise((function(p,S){d.then((function(T){return l?S({isCanceled:!0}):p(T)})),d.catch((function(T){return S(l?{isCanceled:!0}:T)}))})),cancel:function(){l=!0}}},c.evaluateNetworkCondition=function(d,l,p,S,T){var y=0;if(!navigator.onLine)return y=6;var R=[{loss:0,rtt:0,jbd:1},{loss:0,rtt:1,jbd:0},{loss:0,rtt:.5,jbd:.5},{loss:1,rtt:0,jbd:0},{loss:.8,rtt:0,jbd:.2},{loss:.8,rtt:.2,jbd:0},{loss:.6,rtt:.2,jbd:.2}],v=-1,h=-1,m=-1;if(typeof l=="number"&&l>=0||typeof p=="number"&&p>=0){v=0;var _=!1,A=!1;typeof l=="number"&&l>=0&&(v+=l,_=!0),typeof p=="number"&&p>=0&&(v+=p,A=!0),_&&!A&&(v*=2),A&&!_&&(v*=1.8)}typeof d=="number"&&d>=0&&(m=d),(typeof S=="number"&&S>=0||typeof T=="number"&&T>=0)&&(h=0,typeof S=="number"&&S>=0&&(h+=S),typeof T=="number"&&T>=0&&(h+=T));var E;if((E=4*(v!==-1?1:0)+2*(m!==-1?1:0)+(h!==-1?1:0))>0){var b=1.2*v*R[E-1].loss+m/1500*R[E-1].rtt+h/3e3*R[E-1].jbd;y=b<=.1?1:b<=.23?2:b<=.36?3:b<=.49?4:5}else y=0;return y},c.createUUID=function(d,l){var p,S="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),T=[];if(l=l||S.length,d)for(p=0;p<d;p++)T[p]=S[0|Math.random()*l];else{var y=void 0;for(T[8]=T[13]=T[18]=T[23]="-",T[14]="4",p=0;p<36;p++)T[p]||(y=0|16*Math.random(),T[p]=S[p==19?3&y|8:y])}return T.join("")},c.hebtLog=function(){for(var d=[],l=0;l<arguments.length;l++)d[l]=arguments[l];window.RTS_HEBT_DEBUG&&console.log.apply(console,s(["[rts hebt]"],d,!1))}},233:g=>{g.exports=(()=>{var c={622:(p,S,T)=>{Object.defineProperty(S,"__esModule",{value:!0}),S.BrowserUtil=S.BrowserType=void 0;var y,R=T(101);(function(h){h.IE="IE",h.Chrome="Chrome",h.Safari="Safari",h.Firefox="Firefox",h.Opera="Opera",h.Edge="Edge",h.MicroMessenger="MicroMessenger",h.X5Core="X5Core",h.Quark="Quark",h.QQ="QQ",h.QQBrowser="QQBrowser",h.DingTalk="DingTalk",h.Electron="Electron",h.Sogou="Sogou",h.Vivo="VivoBrowser",h.Oppo="OppoBrowser",h.UC="UCBrowser",h.MI="MiBrowser",h.Lenovo="SLBrowser",h.Maxthon="Maxthon",h.Liebao="Liebao",h.Huawei="Huawei",h.Meizu="MZBrowser",h.Finger="FingerBrowser",h.Samsung="SamsungBrowser",h.WebVeiw="WebVeiw",h.Unknown="unknown"})(y=S.BrowserType||(S.BrowserType={}));var v=(function(){function h(){}return Object.defineProperty(h,"isBrowser",{get:function(){return typeof document<"u"},enumerable:!1,configurable:!0}),Object.defineProperty(h,"domain",{get:function(){return window.location.protocol+window.location.host},enumerable:!1,configurable:!0}),Object.defineProperty(h,"isHttps",{get:function(){return this.isBrowser&&document.location&&(document.location.protocol=="https:"||document.location.host.indexOf("127.0.0.1:")===0||document.location.host.indexOf("localhost:")===0)},enumerable:!1,configurable:!0}),Object.defineProperty(h,"isSupportScreenShare",{get:function(){return!!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)},enumerable:!1,configurable:!0}),Object.defineProperty(h,"isChrome",{get:function(){return h._getBrowserInfo(),y.Chrome===h._browserName},enumerable:!1,configurable:!0}),Object.defineProperty(h,"isSafari",{get:function(){return h._getBrowserInfo(),y.Safari===h._browserName},enumerable:!1,configurable:!0}),Object.defineProperty(h,"isIE",{get:function(){return h._getBrowserInfo(),y.IE===h._browserName},enumerable:!1,configurable:!0}),Object.defineProperty(h,"isFirefox",{get:function(){return h._getBrowserInfo(),y.Firefox===h._browserName},enumerable:!1,configurable:!0}),Object.defineProperty(h,"isEdge",{get:function(){return h._getBrowserInfo(),y.Edge===h.browserName},enumerable:!1,configurable:!0}),Object.defineProperty(h,"isSogou",{get:function(){return h._getBrowserInfo(),y.Sogou===h.browserName},enumerable:!1,configurable:!0}),Object.defineProperty(h,"isVivoBroswer",{get:function(){return h._getBrowserInfo(),y.Vivo===h.browserName},enumerable:!1,configurable:!0}),Object.defineProperty(h,"isOppoBrowser",{get:function(){return h._getBrowserInfo(),y.Oppo===h.browserName},enumerable:!1,configurable:!0}),Object.defineProperty(h,"isMiBrowser",{get:function(){return h._getBrowserInfo(),y.MI===h.browserName},enumerable:!1,configurable:!0}),Object.defineProperty(h,"isLenovoBrowser",{get:function(){return h._getBrowserInfo(),y.Lenovo===h.browserName},enumerable:!1,configurable:!0}),Object.defineProperty(h,"isMaxthonBrowser",{get:function(){return h._getBrowserInfo(),y.Maxthon===h.browserName},enumerable:!1,configurable:!0}),Object.defineProperty(h,"isLiebaoBrowser",{get:function(){return h._getBrowserInfo(),y.Liebao===h.browserName},enumerable:!1,configurable:!0}),Object.defineProperty(h,"isHuaweiBrowser",{get:function(){return h._getBrowserInfo(),y.Huawei===h.browserName},enumerable:!1,configurable:!0}),Object.defineProperty(h,"isMZBrowser",{get:function(){return h._getBrowserInfo(),y.Meizu===h._browserName},enumerable:!1,configurable:!0}),Object.defineProperty(h,"isSamsungBrowser",{get:function(){return h._getBrowserInfo(),y.Samsung===h._browserName},enumerable:!1,configurable:!0}),Object.defineProperty(h,"isOpera",{get:function(){return h._getBrowserInfo(),y.Opera===h._browserName},enumerable:!1,configurable:!0}),Object.defineProperty(h,"isMicroMessenger",{get:function(){return h._getBrowserInfo(),h._browserName===y.MicroMessenger},enumerable:!1,configurable:!0}),Object.defineProperty(h,"isQQ",{get:function(){return h._getBrowserInfo(),y.QQ===h.browserName},enumerable:!1,configurable:!0}),Object.defineProperty(h,"isQQBrowser",{get:function(){return h._getBrowserInfo(),y.QQBrowser===h.browserName},enumerable:!1,configurable:!0}),Object.defineProperty(h,"isX5Core",{get:function(){return h._getBrowserInfo(),h._browserName===y.X5Core},enumerable:!1,configurable:!0}),Object.defineProperty(h,"isUCBrowser",{get:function(){return h._getBrowserInfo(),h._browserName===y.UC},enumerable:!1,configurable:!0}),Object.defineProperty(h,"isQuarkBrowser",{get:function(){return h._getBrowserInfo(),h._browserName===y.Quark},enumerable:!1,configurable:!0}),Object.defineProperty(h,"isFingerBrowser",{get:function(){return h._getBrowserInfo(),h._browserName===y.Finger},enumerable:!1,configurable:!0}),Object.defineProperty(h,"isChromeCore",{get:function(){return h._getBrowserInfo(),h._core==="Chrome"},enumerable:!1,configurable:!0}),Object.defineProperty(h,"isWebView",{get:function(){return h._getBrowserInfo(),h._browserName===y.WebVeiw},enumerable:!1,configurable:!0}),Object.defineProperty(h,"isDingTalk",{get:function(){return h._getBrowserInfo(),h._browserName===y.DingTalk},enumerable:!1,configurable:!0}),Object.defineProperty(h,"isUnknown",{get:function(){return h._getBrowserInfo(),y.Unknown===h.browserName},enumerable:!1,configurable:!0}),Object.defineProperty(h,"browserName",{get:function(){return h._getBrowserInfo(),h._browserName},enumerable:!1,configurable:!0}),Object.defineProperty(h,"browserVersion",{get:function(){return h._getBrowserInfo(),h._browserVersion},enumerable:!1,configurable:!0}),Object.defineProperty(h,"browserMainVersion",{get:function(){return h._getBrowserInfo(),h._browserVersion?parseInt(h._browserVersion.split(".")[0],10):0},enumerable:!1,configurable:!0}),Object.defineProperty(h,"browserCoreVersion",{get:function(){return navigator.userAgent.toLowerCase(),R.SystemUtil.isIos||R.SystemUtil.isMacOS,h.browserMainVersion},enumerable:!1,configurable:!0}),Object.defineProperty(h,"isElectron",{get:function(){return h._getBrowserInfo(),y.Electron===h.browserName},enumerable:!1,configurable:!0}),Object.defineProperty(h,"userAgent",{get:function(){var m=navigator.userAgent.toLowerCase(),_=m.indexOf("gecko");if(_>-1){_=m.indexOf(" ",_);var A=(m=m.substring(_+1,m.length)).split(" ");m="";for(var E=0;E<A.length;++E){var b=A[E].split("/");b&&b.length&&(m+=b[0]+" ")}}return m},enumerable:!1,configurable:!0}),h.compareVersion=function(m){if(h._getBrowserInfo(),h._browserVersion){for(var _=h._browserVersion.split("."),A=m.split("."),E=0,b=0,w=0;w<_.length&&w<A.length;++w){if((E=isNaN(parseInt(_[w],10))?0:parseInt(_[w],10))<(b=isNaN(parseInt(A[w],10))?0:parseInt(A[w],10)))return!1;if(E>b)return!0}return!0}return!0},h._getBrowserInfo=function(){if(!h._browserName||!h._browserVersion)if(navigator&&navigator.userAgent){var m=navigator.userAgent.toLowerCase(),_=void 0;(_=m.match(/edg[e|a]?\/([\d.]+)/))||(_=m.match(/edgios\/([\d.]+)/))?h._updateBrowserInfo(y.Edge,m,_[1]):(_=m.match(/rv:([\d.]+)\) like gecko/))||(_=m.match(/msie ([\d.]+)/))?h._updateBrowserInfo(y.IE,m,_[1]):(_=m.match(/vivobrowser\/([\d.]+)/))?h._updateBrowserInfo(y.Vivo,m,_[1]):(_=m.match(/miuibrowser\/([\d.]+)/))?h._updateBrowserInfo(y.MI,m,_[1]):(_=m.match(/samsungbrowser\/([\d.]+)/))?h._updateBrowserInfo(y.Samsung,m,_[1]):(_=m.match(/heytapbrowser\/([\d.]+)/))?h._updateBrowserInfo(y.Oppo,m,_[1]):(_=m.match(/mzbrowser\/([\d.]+)/))?h._updateBrowserInfo(y.Meizu,m,_[1]):(_=m.match(/ucbrowser\/([\d.]+)/))?h._updateBrowserInfo(y.UC,m,_[1]):(_=m.match(/quark\/([\d.]+)/))?h._updateBrowserInfo(y.Quark,m,_[1]):(_=m.match(/slbrowser\/([\d.]+)/))?h._updateBrowserInfo(y.Lenovo,m,_[1]):(_=m.match(/lbbrowser\/([\d.]+)/))?h._updateBrowserInfo(y.Liebao,m,_[1]):(_=m.match(/fingerbrowser\/([\d.]+)/))?h._updateBrowserInfo(y.Finger,m,_[1]):(_=m.match(/huaweibrowser\/([\d.]+)/))?h._updateBrowserInfo(y.Huawei,m,_[1]):(_=m.match(/maxthon\/([\d.]+)/))?h._updateBrowserInfo(y.Maxthon,m,_[1]):(_=m.match(/firefox\/([\d.]+)/))?h._updateBrowserInfo(y.Firefox,m,_[1]):(_=m.match(/electron\/([\d.]+)/))?h._updateBrowserInfo(y.Electron,m,_[1]):(_=m.match(/chrome\/([\d.]+)/))&&this._isChrome(m)||(_=m.match(/crios\/([\d.]+)/))&&this._isChrome(m)?h._updateBrowserInfo(y.Chrome,m,_[1]):(_=m.match(/metasr\s([\d.]+)/))||(_=m.match(/sogoumobilebrowser\/([\d.]+)/))?h._updateBrowserInfo(y.Sogou,m,_[1]):(_=m.match(/opr.([\d.]+)/))?h._updateBrowserInfo(y.Opera,m,_[1]):(_=m.match(/micromessenger.([\d.]+)/))?h._updateBrowserInfo(y.MicroMessenger,m,_[1]):(_=m.match(/qq\/([\d.]+)/))?h._updateBrowserInfo(y.QQ,m,_[1]):(_=m.match(/m?qqbrowser\/([\d.]+)/))||(_=m.match(/qqbrowserlite\/([\d.]+)/))?h._updateBrowserInfo(y.QQBrowser,m,_[1]):(_=m.match(/dingtalk.([\d.]+)/))?h._updateBrowserInfo(y.DingTalk,m,_[1]):(_=m.match(/tbs\/([\d.]+)/))?h._updateBrowserInfo(y.X5Core,m,_[1]):(_=m.match(/version\/([\d.]+).*safari/))&&this._isSafari(m)&&h._updateBrowserInfo(y.Safari,m,_[1]),h._browserName===y.Unknown&&h._isWebview(m)&&h._updateBrowserInfo(y.WebVeiw,m,"")}else h._browserName=y.Unknown,h._browserVersion="0.0"},h._isChrome=function(m){var _=m.split(/\(|\)/);if(h._core="Chrome",_.length===5){var A=_[4].trim().split(" ");if(A.length===2){if(A[0].indexOf("chrome")>-1&&A[1].indexOf("safari")>-1)return!0}else if(A.length===3){if(A[1].indexOf("mobile")>-1&&A[2].indexOf("safari")>-1&&(A[0].indexOf("chrome")>-1||A[0].indexOf("crios")>-1))return!0}else if(m.indexOf("qianniu")>-1)return!0}return!1},h._isSafari=function(m){var _=m.split(/\(|\)/);if(_.length===5){var A=_[4].trim().split(" ");if(A.length===2){if(A[0].indexOf("version")>-1&&A[1].indexOf("safari")>-1)return!0}else if(A.length===3&&A[0].indexOf("version")>-1&&A[1].indexOf("mobile")>-1&&A[2].indexOf("safari")>-1)return!0}return!1},h._isWebview=function(m){if(m){var _=new RegExp("("+["WebView","(iPhone|iPod|iPad)(?!.*Safari)","Android.*(wv|.0.0.0)","Linux; U; Android"].join("|")+")","ig"),A=new RegExp("("+["VivoBrowser","MZBrowser","MiuiBrowser"].join("|")+")","ig");return!!m.match(_)&&!m.match(A)}},h._updateBrowserInfo=function(m,_,A){h._browserName=m;var E=null;switch(m){case y.QQBrowser:R.SystemUtil.isIos||R.SystemUtil.isMacOS?(E=_.match(/version\/([\d.]+).*safari/),h._browserVersion=E?E[1]:"0.0"):(E=_.match(/chrome\/([\d.]+)/),h._browserVersion=E?E[1]:"0.0");break;case y.Vivo:case y.Oppo:case y.Meizu:case y.Huawei:case y.Sogou:case y.Samsung:E=_.match(/chrome\/([\d.]+)/),h._browserVersion=E?E[1]:"0.0";break;case y.WebVeiw:R.SystemUtil.isAndroid?(E=_.match(/chrome\/([\d.]+)/),h._browserVersion=E?E[1]:"0.0"):R.SystemUtil.isIos&&(h._browserVersion=R.SystemUtil.systemVersion);break;default:h._browserVersion=A}},h._browserName=y.Unknown,h._browserVersion="",h._core="",h})();S.BrowserUtil=v},864:(p,S)=>{Object.defineProperty(S,"__esModule",{value:!0}),S.Guid=void 0;var T=(function(){function y(){}return y.create=function(R,v){v===void 0&&(v=16);var h,m,_="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),A=[];if(v=v||_.length,R)for(h=0;h<R;h++)A[h]=_[0|Math.random()*v];else for(A[8]=A[13]=A[18]=A[23]="-",A[14]="4",h=0;h<36;h++)A[h]||(m=0|16*Math.random(),A[h]=_[h==19?3&m|8:m]);return A.join("")},y})();S.Guid=T},442:(p,S,T)=>{Object.defineProperty(S,"__esModule",{value:!0}),S.LocalStorage=void 0;var y=T(864),R=(function(){function v(){}return Object.defineProperty(v,"uuid",{get:function(){var h="alirtc_uuid",m=v.get(h);return m||(m=y.Guid.create(32),v.set(h,m)),m},enumerable:!1,configurable:!0}),v.get=function(h){var m="";return window&&window.localStorage&&(m=window.localStorage.getItem(h)||""),m},v.set=function(h,m){h&&window&&window.localStorage&&window.localStorage.setItem(h,m)},v})();S.LocalStorage=R},72:(p,S)=>{Object.defineProperty(S,"__esModule",{value:!0}),S.ApiRequest=void 0;var T=(function(){function y(){}return y.postBody=function(R,v,h){R=y._getUrl(R,v);var m,_={};return _.headers||(_.headers={}),_.headers.Accept="application/json",_.headers["Content-Type"]="application/json",new Promise((function(A,E){y.requestBody("POST",R,h).then((function(b){return m=b,b.ok?b.json():b.text()})).then((function(b){m.ok?b.code?(b=y._intercept(b),E(b)):A(b.data):E(y._httpErrorMessage(m,b))})).catch((function(b){b=y._httpErrorMessage(b),E(b)}))}))},y.get=function(R,v,h){var m;return h===void 0&&(h={}),R=y._getUrl(R,v),h.headers||(h.headers={}),h.headers["Content-Type"]="application/json",new Promise((function(_,A){y.request("GET",R,h).then((function(E){return m=E,E.ok?E.json():E.text()})).then((function(E){m.ok?E.code?(E=y._intercept(E),A(E)):_(E.data):A(y._httpErrorMessage(m,E))})).catch((function(E){E=y._httpErrorMessage(E),A(E)}))}))},y.post=function(R,v,h,m){var _;return m===void 0&&(m={}),R=y._getUrl(R,v),m.headers||(m.headers={}),m.body=h,m.headers.Accept="application/json",m.headers["Content-Type"]="application/json",new Promise((function(A,E){y.request("POST",R,m).then((function(b){return _=b,b.ok?b.json():b.text()})).then((function(b){_.ok?b.code?(b=y._intercept(b),E(b)):A(b.data):E(y._httpErrorMessage(_,b))})).catch((function(b){b=y._httpErrorMessage(b),E(b)}))}))},y.request=function(R,v,h){R===void 0&&(R="GET");var m=new Headers(h.headers),_=new Request(v,{method:R,headers:m});return fetch(_)},y.requestBody=function(R,v,h){return R===void 0&&(R="GET"),fetch(v,{method:R,body:h,headers:new Headers({"Content-Type":"application/json"})})},y.ajaxPost=function(R,v,h,m){return m===void 0&&(m={}),R=y._getUrl(R,v),m.headers||(m.headers={}),m.headers.Accept="application/json",m.headers["Content-Type"]="application/json",y.ajax("POST",R,h,m)},y.ajax=function(R,v,h,m){R===void 0&&(R="GET"),m===void 0&&(m={});var _=new XMLHttpRequest;return new Promise((function(A,E){_.onreadystatechange=function(){if(_.readyState===4)if(_.status===200){var w=JSON.parse(_.responseText);w.code?(w=y._intercept(w),E(w)):A(w)}else E({message:_.responseText||":"+v})},_.open(R,v,!0);try{if(m.withCredentials&&(_.withCredentials=!0),m.headers)for(var b in m.headers)_.setRequestHeader(b,m.headers[b])}catch(w){return void E(w)}try{_.send(h)}catch(w){E(w)}}))},y._getUrl=function(R,v){var h=[];if(v)for(var m in v)h.push(m+"="+v[m]);var _=h.join("&");return(R.indexOf("?")!=-1?R:R+"?")+_},y._httpErrorMessage=function(R,v){return R.message||(R.message="HTTP "+R.status+"("+R.statusText+") : "+v),R},y._intercept=function(R){var v=R.data;return R.code&&((v=v||{}).data=R.data,v.code=R.code,v.description=R.description,v.message="0x"+Number(R.code).toString(16)+", "+R.description,v.tid&&(v.message+=", tid="+v.tid)),v},y})();S.ApiRequest=T},101:(p,S)=>{var T,y;Object.defineProperty(S,"__esModule",{value:!0}),S.SystemUtil=S.WindowsType=S.SystemType=void 0,(function(v){v.Unknown="Unknown",v.MacOS="Mac",v.Windows="Windows",v.Android="Android",v.Iphone="iphone",v.Ipad="ipad",v.iOS="iOS",v.Linux="Linux",v.ChromeOS="ChromeOS"})(T=S.SystemType||(S.SystemType={})),(function(v){v.Windows10="Windows 10",v.Windows7="Windows 7",v.WindowsVista="Windows vista",v.WindowsXP="Windows xp"})(y=S.WindowsType||(S.WindowsType={}));var R=(function(){function v(){}return Object.defineProperty(v,"isMacOS",{get:function(){return T.MacOS===v.systemName},enumerable:!1,configurable:!0}),Object.defineProperty(v,"isWindows",{get:function(){return v.systemName.indexOf(T.Windows)>-1},enumerable:!1,configurable:!0}),Object.defineProperty(v,"isIos",{get:function(){return T.Iphone===v.systemName||T.Ipad===v.systemName},enumerable:!1,configurable:!0}),Object.defineProperty(v,"isAndroid",{get:function(){return T.Android===v.systemName},enumerable:!1,configurable:!0}),Object.defineProperty(v,"isLinux",{get:function(){return T.Linux===v.systemName||T.Linux===v._platform},enumerable:!1,configurable:!0}),Object.defineProperty(v,"systemName",{get:function(){return v._getSystemInfo(),v._systemName},enumerable:!1,configurable:!0}),Object.defineProperty(v,"systemVersion",{get:function(){return v._getSystemInfo(),v._systemVersion},enumerable:!1,configurable:!0}),Object.defineProperty(v,"platform",{get:function(){return v._getSystemInfo(),v._platform},enumerable:!1,configurable:!0}),Object.defineProperty(v,"isUnknown",{get:function(){return!v.platform||v.platform===T.Unknown},enumerable:!1,configurable:!0}),v.compareVersion=function(h){if(v._getSystemInfo(),v._systemVersion){for(var m=v._systemVersion.split("."),_=h.split("."),A=0,E=0,b=0;b<m.length&&b<_.length;++b){if((A=isNaN(parseInt(m[b],10))?0:parseInt(m[b],10))<(E=isNaN(parseInt(_[b],10))?0:parseInt(_[b],10)))return!1;if(A>E)return!0}return!0}return!0},v._getSystemInfo=function(){if(!v._systemName||!v._systemVersion||!v._platform)if(navigator&&navigator.userAgent){var h=navigator.userAgent.toLowerCase();h.indexOf("ipad")>-1?(v._systemName=T.Ipad,v._platform=T.iOS,v._systemVersion=v._getIosSystemVersion(h)):h.indexOf("iphone")>-1?(v._systemName=T.Iphone,v._platform=T.iOS,v._systemVersion=v._getIosSystemVersion(h)):h.indexOf("android")>-1?(v._platform=T.Android,v._systemName=T.Android,v._systemVersion=v._getAndroidSystemVersion(h)):h.indexOf("win")>-1?h.indexOf("windwos nt 10")>-1||h.indexOf("windows 10")?(v._systemName=y.Windows10,v._platform=T.Windows,v._systemVersion="10"):h.indexOf("windows nt 6.1")>-1||h.indexOf("windows 7")>-1?(v._systemName=y.Windows7,v._platform=T.Windows,v._systemVersion="7"):h.indexOf("windows nt 6.0")>-1||h.indexOf("windows vista")>-1?(v._systemName=y.WindowsVista,v._platform=T.Windows,v._systemVersion="vista"):h.indexOf("widows nt 5.1")>-1||h.indexOf("windows xp")>-1?(v._systemName=y.WindowsXP,v._platform=T.Windows,v._systemVersion="xp"):(v._platform=T.Windows,v._systemName=T.Windows,v._systemVersion="0.0"):h.indexOf("mac")>-1?navigator&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0?(v._systemName=T.Ipad,v._platform=T.iOS,v._systemVersion=v._getIosSystemVersion(h)):(v._platform=T.MacOS,v._systemName=T.MacOS,v._systemVersion=v._getMacSystemVersion(h)):h.indexOf("linux")>-1?(v._platform=T.Linux,v._systemName=T.Linux,v._systemVersion="0.0"):h.indexOf("cros")>-1?(v._platform=T.Linux,v._systemName=T.ChromeOS,v._systemVersion="0.0"):(v._systemName=T.Unknown,v._platform=T.Windows,v._systemVersion="0.0")}else v._systemName=T.Unknown,v._platform=T.Unknown,v._systemVersion="0.0"},v._getIosSystemVersion=function(h){return(h.match(/OS [\d._]*/gi)+"").replace(/[^0-9|_.]/gi,"").replace(/_/gi,".")},v._getMacSystemVersion=function(h){return(h.match(/OS X [\d._]*/gi)+"").replace(/[^0-9|_.]/gi,"").replace(/_/gi,".")},v._getAndroidSystemVersion=function(h){return h.substr(h.indexOf("android")+8,h.indexOf(";",h.indexOf("android"))-h.indexOf("android")-8)},v._systemName="",v._systemVersion="",v._platform=T.Unknown,v})();S.SystemUtil=R}},s={};function d(p){if(s[p])return s[p].exports;var S=s[p]={exports:{}};return c[p](S,S.exports,d),S.exports}var l={};return(()=>{var p=l;Object.defineProperty(p,"__esModule",{value:!0}),p.ApiRequest=p.LocalStorage=p.Guid=p.BrowserUtil=p.SystemUtil=void 0;var S=d(101);Object.defineProperty(p,"SystemUtil",{enumerable:!0,get:function(){return S.SystemUtil}});var T=d(622);Object.defineProperty(p,"BrowserUtil",{enumerable:!0,get:function(){return T.BrowserUtil}});var y=d(864);Object.defineProperty(p,"Guid",{enumerable:!0,get:function(){return y.Guid}});var R=d(442);Object.defineProperty(p,"LocalStorage",{enumerable:!0,get:function(){return R.LocalStorage}});var v=d(72);Object.defineProperty(p,"ApiRequest",{enumerable:!0,get:function(){return v.ApiRequest}}),window&&(window.SystemUtil=S.SystemUtil,window.BrowserUtil=T.BrowserUtil,window.Guid=y.Guid,window.LocalStorage=R.LocalStorage,window.ApiRequest=v.ApiRequest)})(),l})()},9543:(g,c,s)=>{s.r(c),s.d(c,{default:()=>fi});var d={};s.r(d),s.d(d,{fixNegotiationNeeded:()=>G,shimAddTrackRemoveTrack:()=>M,shimAddTrackRemoveTrackWithNative:()=>k,shimGetDisplayMedia:()=>L,shimGetSendersWithDtmf:()=>x,shimGetStats:()=>F,shimGetUserMedia:()=>B,shimMediaStream:()=>H,shimOnTrack:()=>O,shimPeerConnection:()=>j,shimSenderReceiverGetStats:()=>N});var l={};s.r(l),s.d(l,{shimGetDisplayMedia:()=>Q,shimGetUserMedia:()=>re,shimPeerConnection:()=>Z,shimReplaceTrack:()=>q});var p={};s.r(p),s.d(p,{shimAddTransceiver:()=>be,shimCreateAnswer:()=>Ae,shimCreateOffer:()=>Te,shimGetDisplayMedia:()=>J,shimGetParameters:()=>Re,shimGetUserMedia:()=>Y,shimOnTrack:()=>$,shimPeerConnection:()=>te,shimRTCDataChannel:()=>de,shimReceiverGetStats:()=>se,shimRemoveStream:()=>he,shimSenderGetStats:()=>ie});var S={};s.r(S),s.d(S,{shimAudioContext:()=>It,shimCallbacksAPI:()=>Be,shimConstraints:()=>Ne,shimCreateOfferLegacy:()=>rt,shimGetUserMedia:()=>$e,shimLocalStreamsAPI:()=>Ie,shimRTCIceServerUrls:()=>ze,shimRemoteStreamsAPI:()=>Le,shimTrackEventTransceiver:()=>Je});var T={};s.r(T),s.d(T,{removeExtmapAllowMixed:()=>yt,shimAddIceCandidateNullOrEmpty:()=>Nt,shimConnectionState:()=>jt,shimMaxMessageSize:()=>ft,shimRTCIceCandidate:()=>_t,shimSendThrowTypeError:()=>pt});let y=!0,R=!0;function v(X,ae,ne){const oe=X.match(ae);return oe&&oe.length>=ne&&parseInt(oe[ne],10)}function h(X,ae,ne){if(!X.RTCPeerConnection)return;const oe=X.RTCPeerConnection.prototype,fe=oe.addEventListener;oe.addEventListener=function(le,Oe){if(le!==ae)return fe.apply(this,arguments);const _e=Ue=>{const Fe=ne(Ue);Fe&&(Oe.handleEvent?Oe.handleEvent(Fe):Oe(Fe))};return this._eventMap=this._eventMap||{},this._eventMap[ae]||(this._eventMap[ae]=new Map),this._eventMap[ae].set(Oe,_e),fe.apply(this,[le,_e])};const ve=oe.removeEventListener;oe.removeEventListener=function(le,Oe){if(le!==ae||!this._eventMap||!this._eventMap[ae])return ve.apply(this,arguments);if(!this._eventMap[ae].has(Oe))return ve.apply(this,arguments);const _e=this._eventMap[ae].get(Oe);return this._eventMap[ae].delete(Oe),this._eventMap[ae].size===0&&delete this._eventMap[ae],Object.keys(this._eventMap).length===0&&delete this._eventMap,ve.apply(this,[le,_e])},Object.defineProperty(oe,"on"+ae,{get(){return this["_on"+ae]},set(le){this["_on"+ae]&&(this.removeEventListener(ae,this["_on"+ae]),delete this["_on"+ae]),le&&this.addEventListener(ae,this["_on"+ae]=le)},enumerable:!0,configurable:!0})}function m(X){return typeof X!="boolean"?new Error("Argument type: "+typeof X+". Please use a boolean."):(y=X,X?"adapter.js logging disabled":"adapter.js logging enabled")}function _(X){return typeof X!="boolean"?new Error("Argument type: "+typeof X+". Please use a boolean."):(R=!X,"adapter.js deprecation warnings "+(X?"disabled":"enabled"))}function A(){if(typeof window=="object"){if(y)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function E(X,ae){R&&console.warn(X+" is deprecated, please use "+ae+" instead.")}function b(X){return Object.prototype.toString.call(X)==="[object Object]"}function w(X){return b(X)?Object.keys(X).reduce((function(ae,ne){const oe=b(X[ne]),fe=oe?w(X[ne]):X[ne],ve=oe&&!Object.keys(fe).length;return fe===void 0||ve?ae:Object.assign(ae,{[ne]:fe})}),{}):X}function C(X,ae,ne){ae&&!ne.has(ae.id)&&(ne.set(ae.id,ae),Object.keys(ae).forEach((oe=>{oe.endsWith("Id")?C(X,X.get(ae[oe]),ne):oe.endsWith("Ids")&&ae[oe].forEach((fe=>{C(X,X.get(fe),ne)}))})))}function P(X,ae,ne){const oe=ne?"outbound-rtp":"inbound-rtp",fe=new Map;if(ae===null)return fe;const ve=[];return X.forEach((le=>{le.type==="track"&&le.trackIdentifier===ae.id&&ve.push(le)})),ve.forEach((le=>{X.forEach((Oe=>{Oe.type===oe&&Oe.trackId===le.id&&C(X,Oe,fe)}))})),fe}const U=A;function B(X,ae){const ne=X&&X.navigator;if(!ne.mediaDevices)return;const oe=function(le){if(typeof le!="object"||le.mandatory||le.optional)return le;const Oe={};return Object.keys(le).forEach((_e=>{if(_e==="require"||_e==="advanced"||_e==="mediaSource")return;const Ue=typeof le[_e]=="object"?le[_e]:{ideal:le[_e]};Ue.exact!==void 0&&typeof Ue.exact=="number"&&(Ue.min=Ue.max=Ue.exact);const Fe=function(Ke,nt){return Ke?Ke+nt.charAt(0).toUpperCase()+nt.slice(1):nt==="deviceId"?"sourceId":nt};if(Ue.ideal!==void 0){Oe.optional=Oe.optional||[];let Ke={};typeof Ue.ideal=="number"?(Ke[Fe("min",_e)]=Ue.ideal,Oe.optional.push(Ke),Ke={},Ke[Fe("max",_e)]=Ue.ideal,Oe.optional.push(Ke)):(Ke[Fe("",_e)]=Ue.ideal,Oe.optional.push(Ke))}Ue.exact!==void 0&&typeof Ue.exact!="number"?(Oe.mandatory=Oe.mandatory||{},Oe.mandatory[Fe("",_e)]=Ue.exact):["min","max"].forEach((Ke=>{Ue[Ke]!==void 0&&(Oe.mandatory=Oe.mandatory||{},Oe.mandatory[Fe(Ke,_e)]=Ue[Ke])}))})),le.advanced&&(Oe.optional=(Oe.optional||[]).concat(le.advanced)),Oe},fe=function(le,Oe){if(ae.version>=61)return Oe(le);if((le=JSON.parse(JSON.stringify(le)))&&typeof le.audio=="object"){const _e=function(Ue,Fe,Ke){Fe in Ue&&!(Ke in Ue)&&(Ue[Ke]=Ue[Fe],delete Ue[Fe])};_e((le=JSON.parse(JSON.stringify(le))).audio,"autoGainControl","googAutoGainControl"),_e(le.audio,"noiseSuppression","googNoiseSuppression"),le.audio=oe(le.audio)}if(le&&typeof le.video=="object"){let _e=le.video.facingMode;_e=_e&&(typeof _e=="object"?_e:{ideal:_e});const Ue=ae.version<66;if(_e&&(_e.exact==="user"||_e.exact==="environment"||_e.ideal==="user"||_e.ideal==="environment")&&(!ne.mediaDevices.getSupportedConstraints||!ne.mediaDevices.getSupportedConstraints().facingMode||Ue)){let Fe;if(delete le.video.facingMode,_e.exact==="environment"||_e.ideal==="environment"?Fe=["back","rear"]:_e.exact!=="user"&&_e.ideal!=="user"||(Fe=["front"]),Fe)return ne.mediaDevices.enumerateDevices().then((Ke=>{let nt=(Ke=Ke.filter((Ni=>Ni.kind==="videoinput"))).find((Ni=>Fe.some((Ds=>Ni.label.toLowerCase().includes(Ds)))));return!nt&&Ke.length&&Fe.includes("back")&&(nt=Ke[Ke.length-1]),nt&&(le.video.deviceId=_e.exact?{exact:nt.deviceId}:{ideal:nt.deviceId}),le.video=oe(le.video),U("chrome: "+JSON.stringify(le)),Oe(le)}))}le.video=oe(le.video)}return U("chrome: "+JSON.stringify(le)),Oe(le)},ve=function(le){return ae.version>=64?le:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[le.name]||le.name,message:le.message,constraint:le.constraint||le.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(ne.getUserMedia=(function(le,Oe,_e){fe(le,(Ue=>{ne.webkitGetUserMedia(Ue,Oe,(Fe=>{_e&&_e(ve(Fe))}))}))}).bind(ne),ne.mediaDevices.getUserMedia){const le=ne.mediaDevices.getUserMedia.bind(ne.mediaDevices);ne.mediaDevices.getUserMedia=function(Oe){return fe(Oe,(_e=>le(_e).then((Ue=>{if(_e.audio&&!Ue.getAudioTracks().length||_e.video&&!Ue.getVideoTracks().length)throw Ue.getTracks().forEach((Fe=>{Fe.stop()})),new DOMException("","NotFoundError");return Ue}),(Ue=>Promise.reject(ve(Ue))))))}}}function L(X,ae){X.navigator.mediaDevices&&"getDisplayMedia"in X.navigator.mediaDevices||X.navigator.mediaDevices&&(typeof ae=="function"?X.navigator.mediaDevices.getDisplayMedia=function(ne){return ae(ne).then((oe=>{const fe=ne.video&&ne.video.width,ve=ne.video&&ne.video.height,le=ne.video&&ne.video.frameRate;return ne.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:oe,maxFrameRate:le||3}},fe&&(ne.video.mandatory.maxWidth=fe),ve&&(ne.video.mandatory.maxHeight=ve),X.navigator.mediaDevices.getUserMedia(ne)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function H(X){X.MediaStream=X.MediaStream||X.webkitMediaStream}function O(X){if(typeof X=="object"&&X.RTCPeerConnection&&!("ontrack"in X.RTCPeerConnection.prototype)){Object.defineProperty(X.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(ne){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=ne)},enumerable:!0,configurable:!0});const ae=X.RTCPeerConnection.prototype.setRemoteDescription;X.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=ne=>{ne.stream.addEventListener("addtrack",(oe=>{let fe;fe=X.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((le=>le.track&&le.track.id===oe.track.id)):{track:oe.track};const ve=new Event("track");ve.track=oe.track,ve.receiver=fe,ve.transceiver={receiver:fe},ve.streams=[ne.stream],this.dispatchEvent(ve)})),ne.stream.getTracks().forEach((oe=>{let fe;fe=X.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((le=>le.track&&le.track.id===oe.id)):{track:oe};const ve=new Event("track");ve.track=oe,ve.receiver=fe,ve.transceiver={receiver:fe},ve.streams=[ne.stream],this.dispatchEvent(ve)}))},this.addEventListener("addstream",this._ontrackpoly)),ae.apply(this,arguments)}}else h(X,"track",(ae=>(ae.transceiver||Object.defineProperty(ae,"transceiver",{value:{receiver:ae.receiver}}),ae)))}function x(X){if(typeof X=="object"&&X.RTCPeerConnection&&!("getSenders"in X.RTCPeerConnection.prototype)&&"createDTMFSender"in X.RTCPeerConnection.prototype){const ae=function(fe,ve){return{track:ve,get dtmf(){return this._dtmf===void 0&&(ve.kind==="audio"?this._dtmf=fe.createDTMFSender(ve):this._dtmf=null),this._dtmf},_pc:fe}};if(!X.RTCPeerConnection.prototype.getSenders){X.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const fe=X.RTCPeerConnection.prototype.addTrack;X.RTCPeerConnection.prototype.addTrack=function(le,Oe){let _e=fe.apply(this,arguments);return _e||(_e=ae(this,le),this._senders.push(_e)),_e};const ve=X.RTCPeerConnection.prototype.removeTrack;X.RTCPeerConnection.prototype.removeTrack=function(le){ve.apply(this,arguments);const Oe=this._senders.indexOf(le);Oe!==-1&&this._senders.splice(Oe,1)}}const ne=X.RTCPeerConnection.prototype.addStream;X.RTCPeerConnection.prototype.addStream=function(fe){this._senders=this._senders||[],ne.apply(this,[fe]),fe.getTracks().forEach((ve=>{this._senders.push(ae(this,ve))}))};const oe=X.RTCPeerConnection.prototype.removeStream;X.RTCPeerConnection.prototype.removeStream=function(fe){this._senders=this._senders||[],oe.apply(this,[fe]),fe.getTracks().forEach((ve=>{const le=this._senders.find((Oe=>Oe.track===ve));le&&this._senders.splice(this._senders.indexOf(le),1)}))}}else if(typeof X=="object"&&X.RTCPeerConnection&&"getSenders"in X.RTCPeerConnection.prototype&&"createDTMFSender"in X.RTCPeerConnection.prototype&&X.RTCRtpSender&&!("dtmf"in X.RTCRtpSender.prototype)){const ae=X.RTCPeerConnection.prototype.getSenders;X.RTCPeerConnection.prototype.getSenders=function(){const ne=ae.apply(this,[]);return ne.forEach((oe=>oe._pc=this)),ne},Object.defineProperty(X.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function F(X){if(!X.RTCPeerConnection)return;const ae=X.RTCPeerConnection.prototype.getStats;X.RTCPeerConnection.prototype.getStats=function(){const[ne,oe,fe]=arguments;if(arguments.length>0&&typeof ne=="function")return ae.apply(this,arguments);if(ae.length===0&&(arguments.length===0||typeof ne!="function"))return ae.apply(this,[]);const ve=function(Oe){const _e={};return Oe.result().forEach((Ue=>{const Fe={id:Ue.id,timestamp:Ue.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[Ue.type]||Ue.type};Ue.names().forEach((Ke=>{Fe[Ke]=Ue.stat(Ke)})),_e[Fe.id]=Fe})),_e},le=function(Oe){return new Map(Object.keys(Oe).map((_e=>[_e,Oe[_e]])))};if(arguments.length>=2){const Oe=function(_e){oe(le(ve(_e)))};return ae.apply(this,[Oe,ne])}return new Promise(((Oe,_e)=>{ae.apply(this,[function(Ue){Oe(le(ve(Ue)))},_e])})).then(oe,fe)}}function N(X){if(!(typeof X=="object"&&X.RTCPeerConnection&&X.RTCRtpSender&&X.RTCRtpReceiver))return;if(!("getStats"in X.RTCRtpSender.prototype)){const ne=X.RTCPeerConnection.prototype.getSenders;ne&&(X.RTCPeerConnection.prototype.getSenders=function(){const fe=ne.apply(this,[]);return fe.forEach((ve=>ve._pc=this)),fe});const oe=X.RTCPeerConnection.prototype.addTrack;oe&&(X.RTCPeerConnection.prototype.addTrack=function(){const fe=oe.apply(this,arguments);return fe._pc=this,fe}),X.RTCRtpSender.prototype.getStats=function(){const fe=this;return this._pc.getStats().then((ve=>P(ve,fe.track,!0)))}}if(!("getStats"in X.RTCRtpReceiver.prototype)){const ne=X.RTCPeerConnection.prototype.getReceivers;ne&&(X.RTCPeerConnection.prototype.getReceivers=function(){const oe=ne.apply(this,[]);return oe.forEach((fe=>fe._pc=this)),oe}),h(X,"track",(oe=>(oe.receiver._pc=oe.srcElement,oe))),X.RTCRtpReceiver.prototype.getStats=function(){const oe=this;return this._pc.getStats().then((fe=>P(fe,oe.track,!1)))}}if(!("getStats"in X.RTCRtpSender.prototype)||!("getStats"in X.RTCRtpReceiver.prototype))return;const ae=X.RTCPeerConnection.prototype.getStats;X.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof X.MediaStreamTrack){const ne=arguments[0];let oe,fe,ve;return this.getSenders().forEach((le=>{le.track===ne&&(oe?ve=!0:oe=le)})),this.getReceivers().forEach((le=>(le.track===ne&&(fe?ve=!0:fe=le),le.track===ne))),ve||oe&&fe?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):oe?oe.getStats():fe?fe.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return ae.apply(this,arguments)}}function k(X){X.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((ve=>this._shimmedLocalStreams[ve][0]))};const ae=X.RTCPeerConnection.prototype.addTrack;X.RTCPeerConnection.prototype.addTrack=function(ve,le){if(!le)return ae.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const Oe=ae.apply(this,arguments);return this._shimmedLocalStreams[le.id]?this._shimmedLocalStreams[le.id].indexOf(Oe)===-1&&this._shimmedLocalStreams[le.id].push(Oe):this._shimmedLocalStreams[le.id]=[le,Oe],Oe};const ne=X.RTCPeerConnection.prototype.addStream;X.RTCPeerConnection.prototype.addStream=function(ve){this._shimmedLocalStreams=this._shimmedLocalStreams||{},ve.getTracks().forEach((_e=>{if(this.getSenders().find((Ue=>Ue.track===_e)))throw new DOMException("Track already exists.","InvalidAccessError")}));const le=this.getSenders();ne.apply(this,arguments);const Oe=this.getSenders().filter((_e=>le.indexOf(_e)===-1));this._shimmedLocalStreams[ve.id]=[ve].concat(Oe)};const oe=X.RTCPeerConnection.prototype.removeStream;X.RTCPeerConnection.prototype.removeStream=function(ve){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[ve.id],oe.apply(this,arguments)};const fe=X.RTCPeerConnection.prototype.removeTrack;X.RTCPeerConnection.prototype.removeTrack=function(ve){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},ve&&Object.keys(this._shimmedLocalStreams).forEach((le=>{const Oe=this._shimmedLocalStreams[le].indexOf(ve);Oe!==-1&&this._shimmedLocalStreams[le].splice(Oe,1),this._shimmedLocalStreams[le].length===1&&delete this._shimmedLocalStreams[le]})),fe.apply(this,arguments)}}function M(X,ae){if(!X.RTCPeerConnection)return;if(X.RTCPeerConnection.prototype.addTrack&&ae.version>=65)return k(X);const ne=X.RTCPeerConnection.prototype.getLocalStreams;X.RTCPeerConnection.prototype.getLocalStreams=function(){const _e=ne.apply(this);return this._reverseStreams=this._reverseStreams||{},_e.map((Ue=>this._reverseStreams[Ue.id]))};const oe=X.RTCPeerConnection.prototype.addStream;X.RTCPeerConnection.prototype.addStream=function(_e){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},_e.getTracks().forEach((Ue=>{if(this.getSenders().find((Fe=>Fe.track===Ue)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[_e.id]){const Ue=new X.MediaStream(_e.getTracks());this._streams[_e.id]=Ue,this._reverseStreams[Ue.id]=_e,_e=Ue}oe.apply(this,[_e])};const fe=X.RTCPeerConnection.prototype.removeStream;function ve(_e,Ue){let Fe=Ue.sdp;return Object.keys(_e._reverseStreams||[]).forEach((Ke=>{const nt=_e._reverseStreams[Ke],Ni=_e._streams[nt.id];Fe=Fe.replace(new RegExp(Ni.id,"g"),nt.id)})),new RTCSessionDescription({type:Ue.type,sdp:Fe})}X.RTCPeerConnection.prototype.removeStream=function(_e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},fe.apply(this,[this._streams[_e.id]||_e]),delete this._reverseStreams[this._streams[_e.id]?this._streams[_e.id].id:_e.id],delete this._streams[_e.id]},X.RTCPeerConnection.prototype.addTrack=function(_e,Ue){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const Fe=[].slice.call(arguments,1);if(Fe.length!==1||!Fe[0].getTracks().find((nt=>nt===_e)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((nt=>nt.track===_e)))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const Ke=this._streams[Ue.id];if(Ke)Ke.addTrack(_e),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const nt=new X.MediaStream([_e]);this._streams[Ue.id]=nt,this._reverseStreams[nt.id]=Ue,this.addStream(nt)}return this.getSenders().find((nt=>nt.track===_e))},["createOffer","createAnswer"].forEach((function(_e){const Ue=X.RTCPeerConnection.prototype[_e],Fe={[_e](){const Ke=arguments;return arguments.length&&typeof arguments[0]=="function"?Ue.apply(this,[nt=>{const Ni=ve(this,nt);Ke[0].apply(null,[Ni])},nt=>{Ke[1]&&Ke[1].apply(null,nt)},arguments[2]]):Ue.apply(this,arguments).then((nt=>ve(this,nt)))}};X.RTCPeerConnection.prototype[_e]=Fe[_e]}));const le=X.RTCPeerConnection.prototype.setLocalDescription;X.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=(function(_e,Ue){let Fe=Ue.sdp;return Object.keys(_e._reverseStreams||[]).forEach((Ke=>{const nt=_e._reverseStreams[Ke],Ni=_e._streams[nt.id];Fe=Fe.replace(new RegExp(nt.id,"g"),Ni.id)})),new RTCSessionDescription({type:Ue.type,sdp:Fe})})(this,arguments[0]),le.apply(this,arguments)):le.apply(this,arguments)};const Oe=Object.getOwnPropertyDescriptor(X.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(X.RTCPeerConnection.prototype,"localDescription",{get(){const _e=Oe.get.apply(this);return _e.type===""?_e:ve(this,_e)}}),X.RTCPeerConnection.prototype.removeTrack=function(_e){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!_e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(_e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let Ue;this._streams=this._streams||{},Object.keys(this._streams).forEach((Fe=>{this._streams[Fe].getTracks().find((Ke=>_e.track===Ke))&&(Ue=this._streams[Fe])})),Ue&&(Ue.getTracks().length===1?this.removeStream(this._reverseStreams[Ue.id]):Ue.removeTrack(_e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function j(X,ae){!X.RTCPeerConnection&&X.webkitRTCPeerConnection&&(X.RTCPeerConnection=X.webkitRTCPeerConnection),X.RTCPeerConnection&&ae.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(ne){const oe=X.RTCPeerConnection.prototype[ne],fe={[ne](){return arguments[0]=new(ne==="addIceCandidate"?X.RTCIceCandidate:X.RTCSessionDescription)(arguments[0]),oe.apply(this,arguments)}};X.RTCPeerConnection.prototype[ne]=fe[ne]}))}function G(X,ae){h(X,"negotiationneeded",(ne=>{const oe=ne.target;if(!(ae.version<72||oe.getConfiguration&&oe.getConfiguration().sdpSemantics==="plan-b")||oe.signalingState==="stable")return ne}))}var z=s(6677),V=s.n(z);function re(X){const ae=X&&X.navigator,ne=ae.mediaDevices.getUserMedia.bind(ae.mediaDevices);ae.mediaDevices.getUserMedia=function(oe){return ne(oe).catch((fe=>Promise.reject((function(ve){return{name:{PermissionDeniedError:"NotAllowedError"}[ve.name]||ve.name,message:ve.message,constraint:ve.constraint,toString(){return this.name}}})(fe))))}}function Q(X){"getDisplayMedia"in X.navigator&&X.navigator.mediaDevices&&(X.navigator.mediaDevices&&"getDisplayMedia"in X.navigator.mediaDevices||(X.navigator.mediaDevices.getDisplayMedia=X.navigator.getDisplayMedia.bind(X.navigator)))}function Z(X,ae){if(X.RTCIceGatherer&&(X.RTCIceCandidate||(X.RTCIceCandidate=function(oe){return oe}),X.RTCSessionDescription||(X.RTCSessionDescription=function(oe){return oe}),ae.version<15025)){const oe=Object.getOwnPropertyDescriptor(X.MediaStreamTrack.prototype,"enabled");Object.defineProperty(X.MediaStreamTrack.prototype,"enabled",{set(fe){oe.set.call(this,fe);const ve=new Event("enabled");ve.enabled=fe,this.dispatchEvent(ve)}})}X.RTCRtpSender&&!("dtmf"in X.RTCRtpSender.prototype)&&Object.defineProperty(X.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new X.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),X.RTCDtmfSender&&!X.RTCDTMFSender&&(X.RTCDTMFSender=X.RTCDtmfSender);const ne=V()(X,ae.version);X.RTCPeerConnection=function(oe){return oe&&oe.iceServers&&(oe.iceServers=(function(fe){let ve=!1;return(fe=JSON.parse(JSON.stringify(fe))).filter((le=>{if(le&&(le.urls||le.url)){let Oe=le.urls||le.url;le.url&&!le.urls&&E("RTCIceServer.url","RTCIceServer.urls");const _e=typeof Oe=="string";return _e&&(Oe=[Oe]),Oe=Oe.filter((Ue=>{if(Ue.indexOf("stun:")===0)return!1;const Fe=Ue.startsWith("turn")&&!Ue.startsWith("turn:[")&&Ue.includes("transport=udp");return Fe&&!ve?(ve=!0,!0):Fe&&!ve})),delete le.url,le.urls=_e?Oe[0]:Oe,!!Oe.length}}))})(oe.iceServers,ae.version),A("ICE servers after filtering:",oe.iceServers)),new ne(oe)},X.RTCPeerConnection.prototype=ne.prototype}function q(X){X.RTCRtpSender&&!("replaceTrack"in X.RTCRtpSender.prototype)&&(X.RTCRtpSender.prototype.replaceTrack=X.RTCRtpSender.prototype.setTrack)}function Y(X,ae){const ne=X&&X.navigator,oe=X&&X.MediaStreamTrack;if(ne.getUserMedia=function(fe,ve,le){E("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),ne.mediaDevices.getUserMedia(fe).then(ve,le)},!(ae.version>55&&"autoGainControl"in ne.mediaDevices.getSupportedConstraints())){const fe=function(le,Oe,_e){Oe in le&&!(_e in le)&&(le[_e]=le[Oe],delete le[Oe])},ve=ne.mediaDevices.getUserMedia.bind(ne.mediaDevices);if(ne.mediaDevices.getUserMedia=function(le){return typeof le=="object"&&typeof le.audio=="object"&&(le=JSON.parse(JSON.stringify(le)),fe(le.audio,"autoGainControl","mozAutoGainControl"),fe(le.audio,"noiseSuppression","mozNoiseSuppression")),ve(le)},oe&&oe.prototype.getSettings){const le=oe.prototype.getSettings;oe.prototype.getSettings=function(){const Oe=le.apply(this,arguments);return fe(Oe,"mozAutoGainControl","autoGainControl"),fe(Oe,"mozNoiseSuppression","noiseSuppression"),Oe}}if(oe&&oe.prototype.applyConstraints){const le=oe.prototype.applyConstraints;oe.prototype.applyConstraints=function(Oe){return this.kind==="audio"&&typeof Oe=="object"&&(Oe=JSON.parse(JSON.stringify(Oe)),fe(Oe,"autoGainControl","mozAutoGainControl"),fe(Oe,"noiseSuppression","mozNoiseSuppression")),le.apply(this,[Oe])}}}}function J(X,ae){X.navigator.mediaDevices&&"getDisplayMedia"in X.navigator.mediaDevices||X.navigator.mediaDevices&&(X.navigator.mediaDevices.getDisplayMedia=function(ne){if(!ne||!ne.video){const oe=new DOMException("getDisplayMedia without video constraints is undefined");return oe.name="NotFoundError",oe.code=8,Promise.reject(oe)}return ne.video===!0?ne.video={mediaSource:ae}:ne.video.mediaSource=ae,X.navigator.mediaDevices.getUserMedia(ne)})}function $(X){typeof X=="object"&&X.RTCTrackEvent&&"receiver"in X.RTCTrackEvent.prototype&&!("transceiver"in X.RTCTrackEvent.prototype)&&Object.defineProperty(X.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function te(X,ae){if(typeof X!="object"||!X.RTCPeerConnection&&!X.mozRTCPeerConnection)return;!X.RTCPeerConnection&&X.mozRTCPeerConnection&&(X.RTCPeerConnection=X.mozRTCPeerConnection),ae.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(fe){const ve=X.RTCPeerConnection.prototype[fe],le={[fe](){return arguments[0]=new(fe==="addIceCandidate"?X.RTCIceCandidate:X.RTCSessionDescription)(arguments[0]),ve.apply(this,arguments)}};X.RTCPeerConnection.prototype[fe]=le[fe]}));const ne={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},oe=X.RTCPeerConnection.prototype.getStats;X.RTCPeerConnection.prototype.getStats=function(){const[fe,ve,le]=arguments;return oe.apply(this,[fe||null]).then((Oe=>{if(ae.version<53&&!ve)try{Oe.forEach((_e=>{_e.type=ne[_e.type]||_e.type}))}catch(_e){if(_e.name!=="TypeError")throw _e;Oe.forEach(((Ue,Fe)=>{Oe.set(Fe,Object.assign({},Ue,{type:ne[Ue.type]||Ue.type}))}))}return Oe})).then(ve,le)}}function ie(X){if(typeof X!="object"||!X.RTCPeerConnection||!X.RTCRtpSender||X.RTCRtpSender&&"getStats"in X.RTCRtpSender.prototype)return;const ae=X.RTCPeerConnection.prototype.getSenders;ae&&(X.RTCPeerConnection.prototype.getSenders=function(){const oe=ae.apply(this,[]);return oe.forEach((fe=>fe._pc=this)),oe});const ne=X.RTCPeerConnection.prototype.addTrack;ne&&(X.RTCPeerConnection.prototype.addTrack=function(){const oe=ne.apply(this,arguments);return oe._pc=this,oe}),X.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function se(X){if(typeof X!="object"||!X.RTCPeerConnection||!X.RTCRtpSender||X.RTCRtpSender&&"getStats"in X.RTCRtpReceiver.prototype)return;const ae=X.RTCPeerConnection.prototype.getReceivers;ae&&(X.RTCPeerConnection.prototype.getReceivers=function(){const ne=ae.apply(this,[]);return ne.forEach((oe=>oe._pc=this)),ne}),h(X,"track",(ne=>(ne.receiver._pc=ne.srcElement,ne))),X.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function he(X){X.RTCPeerConnection&&!("removeStream"in X.RTCPeerConnection.prototype)&&(X.RTCPeerConnection.prototype.removeStream=function(ae){E("removeStream","removeTrack"),this.getSenders().forEach((ne=>{ne.track&&ae.getTracks().includes(ne.track)&&this.removeTrack(ne)}))})}function de(X){X.DataChannel&&!X.RTCDataChannel&&(X.RTCDataChannel=X.DataChannel)}function be(X){if(typeof X!="object"||!X.RTCPeerConnection)return;const ae=X.RTCPeerConnection.prototype.addTransceiver;ae&&(X.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const ne=arguments[1],oe=ne&&"sendEncodings"in ne;oe&&ne.sendEncodings.forEach((ve=>{if("rid"in ve&&!/^[a-z0-9]{0,16}$/i.test(ve.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in ve&&!(parseFloat(ve.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in ve&&!(parseFloat(ve.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const fe=ae.apply(this,arguments);if(oe){const{sender:ve}=fe,le=ve.getParameters();(!("encodings"in le)||le.encodings.length===1&&Object.keys(le.encodings[0]).length===0)&&(le.encodings=ne.sendEncodings,ve.sendEncodings=ne.sendEncodings,this.setParametersPromises.push(ve.setParameters(le).then((()=>{delete ve.sendEncodings})).catch((()=>{delete ve.sendEncodings}))))}return fe})}function Re(X){if(typeof X!="object"||!X.RTCRtpSender)return;const ae=X.RTCRtpSender.prototype.getParameters;ae&&(X.RTCRtpSender.prototype.getParameters=function(){const ne=ae.apply(this,arguments);return"encodings"in ne||(ne.encodings=[].concat(this.sendEncodings||[{}])),ne})}function Te(X){if(typeof X!="object"||!X.RTCPeerConnection)return;const ae=X.RTCPeerConnection.prototype.createOffer;X.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>ae.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):ae.apply(this,arguments)}}function Ae(X){if(typeof X!="object"||!X.RTCPeerConnection)return;const ae=X.RTCPeerConnection.prototype.createAnswer;X.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>ae.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):ae.apply(this,arguments)}}function Ie(X){if(typeof X=="object"&&X.RTCPeerConnection){if("getLocalStreams"in X.RTCPeerConnection.prototype||(X.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in X.RTCPeerConnection.prototype)){const ae=X.RTCPeerConnection.prototype.addTrack;X.RTCPeerConnection.prototype.addStream=function(ne){this._localStreams||(this._localStreams=[]),this._localStreams.includes(ne)||this._localStreams.push(ne),ne.getAudioTracks().forEach((oe=>ae.call(this,oe,ne))),ne.getVideoTracks().forEach((oe=>ae.call(this,oe,ne)))},X.RTCPeerConnection.prototype.addTrack=function(ne,...oe){return oe&&oe.forEach((fe=>{this._localStreams?this._localStreams.includes(fe)||this._localStreams.push(fe):this._localStreams=[fe]})),ae.apply(this,arguments)}}"removeStream"in X.RTCPeerConnection.prototype||(X.RTCPeerConnection.prototype.removeStream=function(ae){this._localStreams||(this._localStreams=[]);const ne=this._localStreams.indexOf(ae);if(ne===-1)return;this._localStreams.splice(ne,1);const oe=ae.getTracks();this.getSenders().forEach((fe=>{oe.includes(fe.track)&&this.removeTrack(fe)}))})}}function Le(X){if(typeof X=="object"&&X.RTCPeerConnection&&("getRemoteStreams"in X.RTCPeerConnection.prototype||(X.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in X.RTCPeerConnection.prototype))){Object.defineProperty(X.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(ne){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=ne),this.addEventListener("track",this._onaddstreampoly=oe=>{oe.streams.forEach((fe=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(fe))return;this._remoteStreams.push(fe);const ve=new Event("addstream");ve.stream=fe,this.dispatchEvent(ve)}))})}});const ae=X.RTCPeerConnection.prototype.setRemoteDescription;X.RTCPeerConnection.prototype.setRemoteDescription=function(){const ne=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(oe){oe.streams.forEach((fe=>{if(ne._remoteStreams||(ne._remoteStreams=[]),ne._remoteStreams.indexOf(fe)>=0)return;ne._remoteStreams.push(fe);const ve=new Event("addstream");ve.stream=fe,ne.dispatchEvent(ve)}))}),ae.apply(ne,arguments)}}}function Be(X){if(typeof X!="object"||!X.RTCPeerConnection)return;const ae=X.RTCPeerConnection.prototype,ne=ae.createOffer,oe=ae.createAnswer,fe=ae.setLocalDescription,ve=ae.setRemoteDescription,le=ae.addIceCandidate;ae.createOffer=function(_e,Ue){const Fe=arguments.length>=2?arguments[2]:arguments[0],Ke=ne.apply(this,[Fe]);return Ue?(Ke.then(_e,Ue),Promise.resolve()):Ke},ae.createAnswer=function(_e,Ue){const Fe=arguments.length>=2?arguments[2]:arguments[0],Ke=oe.apply(this,[Fe]);return Ue?(Ke.then(_e,Ue),Promise.resolve()):Ke};let Oe=function(_e,Ue,Fe){const Ke=fe.apply(this,[_e]);return Fe?(Ke.then(Ue,Fe),Promise.resolve()):Ke};ae.setLocalDescription=Oe,Oe=function(_e,Ue,Fe){const Ke=ve.apply(this,[_e]);return Fe?(Ke.then(Ue,Fe),Promise.resolve()):Ke},ae.setRemoteDescription=Oe,Oe=function(_e,Ue,Fe){const Ke=le.apply(this,[_e]);return Fe?(Ke.then(Ue,Fe),Promise.resolve()):Ke},ae.addIceCandidate=Oe}function $e(X){const ae=X&&X.navigator;if(ae.mediaDevices&&ae.mediaDevices.getUserMedia){const ne=ae.mediaDevices,oe=ne.getUserMedia.bind(ne);ae.mediaDevices.getUserMedia=fe=>oe(Ne(fe))}!ae.getUserMedia&&ae.mediaDevices&&ae.mediaDevices.getUserMedia&&(ae.getUserMedia=(function(ne,oe,fe){ae.mediaDevices.getUserMedia(ne).then(oe,fe)}).bind(ae))}function Ne(X){return X&&X.video!==void 0?Object.assign({},X,{video:w(X.video)}):X}function ze(X){if(!X.RTCPeerConnection)return;const ae=X.RTCPeerConnection;X.RTCPeerConnection=function(ne,oe){if(ne&&ne.iceServers){const fe=[];for(let ve=0;ve<ne.iceServers.length;ve++){let le=ne.iceServers[ve];!le.hasOwnProperty("urls")&&le.hasOwnProperty("url")?(E("RTCIceServer.url","RTCIceServer.urls"),le=JSON.parse(JSON.stringify(le)),le.urls=le.url,delete le.url,fe.push(le)):fe.push(ne.iceServers[ve])}ne.iceServers=fe}return new ae(ne,oe)},X.RTCPeerConnection.prototype=ae.prototype,"generateCertificate"in ae&&Object.defineProperty(X.RTCPeerConnection,"generateCertificate",{get:()=>ae.generateCertificate})}function Je(X){typeof X=="object"&&X.RTCTrackEvent&&"receiver"in X.RTCTrackEvent.prototype&&!("transceiver"in X.RTCTrackEvent.prototype)&&Object.defineProperty(X.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function rt(X){const ae=X.RTCPeerConnection.prototype.createOffer;X.RTCPeerConnection.prototype.createOffer=function(ne){if(ne){ne.offerToReceiveAudio!==void 0&&(ne.offerToReceiveAudio=!!ne.offerToReceiveAudio);const oe=this.getTransceivers().find((ve=>ve.receiver.track.kind==="audio"));ne.offerToReceiveAudio===!1&&oe?oe.direction==="sendrecv"?oe.setDirection?oe.setDirection("sendonly"):oe.direction="sendonly":oe.direction==="recvonly"&&(oe.setDirection?oe.setDirection("inactive"):oe.direction="inactive"):ne.offerToReceiveAudio!==!0||oe||this.addTransceiver("audio"),ne.offerToReceiveVideo!==void 0&&(ne.offerToReceiveVideo=!!ne.offerToReceiveVideo);const fe=this.getTransceivers().find((ve=>ve.receiver.track.kind==="video"));ne.offerToReceiveVideo===!1&&fe?fe.direction==="sendrecv"?fe.setDirection?fe.setDirection("sendonly"):fe.direction="sendonly":fe.direction==="recvonly"&&(fe.setDirection?fe.setDirection("inactive"):fe.direction="inactive"):ne.offerToReceiveVideo!==!0||fe||this.addTransceiver("video")}return ae.apply(this,arguments)}}function It(X){typeof X!="object"||X.AudioContext||(X.AudioContext=X.webkitAudioContext)}var dt=s(7963),Ct=s.n(dt);function _t(X){if(!X.RTCIceCandidate||X.RTCIceCandidate&&"foundation"in X.RTCIceCandidate.prototype)return;const ae=X.RTCIceCandidate;X.RTCIceCandidate=function(ne){if(typeof ne=="object"&&ne.candidate&&ne.candidate.indexOf("a=")===0&&((ne=JSON.parse(JSON.stringify(ne))).candidate=ne.candidate.substr(2)),ne.candidate&&ne.candidate.length){const oe=new ae(ne),fe=Ct().parseCandidate(ne.candidate),ve=Object.assign(oe,fe);return ve.toJSON=function(){return{candidate:ve.candidate,sdpMid:ve.sdpMid,sdpMLineIndex:ve.sdpMLineIndex,usernameFragment:ve.usernameFragment}},ve}return new ae(ne)},X.RTCIceCandidate.prototype=ae.prototype,h(X,"icecandidate",(ne=>(ne.candidate&&Object.defineProperty(ne,"candidate",{value:new X.RTCIceCandidate(ne.candidate),writable:"false"}),ne)))}function ft(X,ae){if(!X.RTCPeerConnection)return;"sctp"in X.RTCPeerConnection.prototype||Object.defineProperty(X.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const ne=X.RTCPeerConnection.prototype.setRemoteDescription;X.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,ae.browser==="chrome"&&ae.version>=76){const{sdpSemantics:oe}=this.getConfiguration();oe==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if((function(oe){if(!oe||!oe.sdp)return!1;const fe=Ct().splitSections(oe.sdp);return fe.shift(),fe.some((ve=>{const le=Ct().parseMLine(ve);return le&&le.kind==="application"&&le.protocol.indexOf("SCTP")!==-1}))})(arguments[0])){const oe=(function(_e){const Ue=_e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(Ue===null||Ue.length<2)return-1;const Fe=parseInt(Ue[1],10);return Fe!=Fe?-1:Fe})(arguments[0]),fe=(function(_e){let Ue=65536;return ae.browser==="firefox"&&(Ue=ae.version<57?_e===-1?16384:2147483637:ae.version<60?ae.version===57?65535:65536:2147483637),Ue})(oe),ve=(function(_e,Ue){let Fe=65536;ae.browser==="firefox"&&ae.version===57&&(Fe=65535);const Ke=Ct().matchPrefix(_e.sdp,"a=max-message-size:");return Ke.length>0?Fe=parseInt(Ke[0].substr(19),10):ae.browser==="firefox"&&Ue!==-1&&(Fe=2147483637),Fe})(arguments[0],oe);let le;le=fe===0&&ve===0?Number.POSITIVE_INFINITY:fe===0||ve===0?Math.max(fe,ve):Math.min(fe,ve);const Oe={};Object.defineProperty(Oe,"maxMessageSize",{get:()=>le}),this._sctp=Oe}return ne.apply(this,arguments)}}function pt(X){if(!X.RTCPeerConnection||!("createDataChannel"in X.RTCPeerConnection.prototype))return;function ae(oe,fe){const ve=oe.send;oe.send=function(){const le=arguments[0],Oe=le.length||le.size||le.byteLength;if(oe.readyState==="open"&&fe.sctp&&Oe>fe.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+fe.sctp.maxMessageSize+" bytes)");return ve.apply(oe,arguments)}}const ne=X.RTCPeerConnection.prototype.createDataChannel;X.RTCPeerConnection.prototype.createDataChannel=function(){const oe=ne.apply(this,arguments);return ae(oe,this),oe},h(X,"datachannel",(oe=>(ae(oe.channel,oe.target),oe)))}function jt(X){if(!X.RTCPeerConnection||"connectionState"in X.RTCPeerConnection.prototype)return;const ae=X.RTCPeerConnection.prototype;Object.defineProperty(ae,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(ae,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(ne){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),ne&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=ne)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((ne=>{const oe=ae[ne];ae[ne]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=fe=>{const ve=fe.target;if(ve._lastConnectionState!==ve.connectionState){ve._lastConnectionState=ve.connectionState;const le=new Event("connectionstatechange",fe);ve.dispatchEvent(le)}return fe},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),oe.apply(this,arguments)}}))}function yt(X,ae){if(!X.RTCPeerConnection||ae.browser==="chrome"&&ae.version>=71||ae.browser==="safari"&&ae.version>=605)return;const ne=X.RTCPeerConnection.prototype.setRemoteDescription;X.RTCPeerConnection.prototype.setRemoteDescription=function(oe){if(oe&&oe.sdp&&oe.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const fe=oe.sdp.split(`
`).filter((ve=>ve.trim()!=="a=extmap-allow-mixed")).join(`
`);X.RTCSessionDescription&&oe instanceof X.RTCSessionDescription?arguments[0]=new X.RTCSessionDescription({type:oe.type,sdp:fe}):oe.sdp=fe}return ne.apply(this,arguments)}}function Nt(X,ae){if(!X.RTCPeerConnection||!X.RTCPeerConnection.prototype)return;const ne=X.RTCPeerConnection.prototype.addIceCandidate;ne&&ne.length!==0&&(X.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(ae.browser==="chrome"&&ae.version<78||ae.browser==="firefox"&&ae.version<68||ae.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():ne.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}const kt=(function({window:X}={},ae={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const ne=A,oe=(function(ve){const le={browser:null,version:null};if(ve===void 0||!ve.navigator)return le.browser="Not a browser.",le;const{navigator:Oe}=ve;if(Oe.mozGetUserMedia)le.browser="firefox",le.version=v(Oe.userAgent,/Firefox\/(\d+)\./,1);else if(Oe.webkitGetUserMedia||ve.isSecureContext===!1&&ve.webkitRTCPeerConnection&&!ve.RTCIceGatherer)le.browser="chrome",le.version=v(Oe.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(Oe.mediaDevices&&Oe.userAgent.match(/Edge\/(\d+).(\d+)$/))le.browser="edge",le.version=v(Oe.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!ve.RTCPeerConnection||!Oe.userAgent.match(/AppleWebKit\/(\d+)\./))return le.browser="Not a supported browser.",le;le.browser="safari",le.version=v(Oe.userAgent,/AppleWebKit\/(\d+)\./,1),le.supportsUnifiedPlan=ve.RTCRtpTransceiver&&"currentDirection"in ve.RTCRtpTransceiver.prototype}return le})(X),fe={browserDetails:oe,commonShim:T,extractVersion:v,disableLog:m,disableWarnings:_};switch(oe.browser){case"chrome":if(!d||!j||!ae.shimChrome)return ne("Chrome shim is not included in this adapter release."),fe;if(oe.version===null)return ne("Chrome shim can not determine version, not shimming."),fe;ne("adapter.js shimming chrome."),fe.browserShim=d,Nt(X,oe),B(X,oe),H(X),j(X,oe),O(X),M(X,oe),x(X),F(X),N(X),G(X,oe),_t(X),jt(X),ft(X,oe),pt(X),yt(X,oe);break;case"firefox":if(!p||!te||!ae.shimFirefox)return ne("Firefox shim is not included in this adapter release."),fe;ne("adapter.js shimming firefox."),fe.browserShim=p,Nt(X,oe),Y(X,oe),te(X,oe),$(X),he(X),ie(X),se(X),de(X),be(X),Re(X),Te(X),Ae(X),_t(X),jt(X),ft(X,oe),pt(X);break;case"edge":if(!l||!Z||!ae.shimEdge)return ne("MS edge shim is not included in this adapter release."),fe;ne("adapter.js shimming edge."),fe.browserShim=l,re(X),Q(X),Z(X,oe),q(X),ft(X,oe),pt(X);break;case"safari":if(!S||!ae.shimSafari)return ne("Safari shim is not included in this adapter release."),fe;ne("adapter.js shimming safari."),fe.browserShim=S,Nt(X,oe),ze(X),rt(X),Be(X),Ie(X),Le(X),Je(X),$e(X),It(X),_t(X),ft(X,oe),pt(X),yt(X,oe);break;default:ne("Unsupported browser!")}return fe})({window:typeof window>"u"?void 0:window}),fi=kt},6834:(g,c,s)=>{s.r(c),s.d(c,{default:()=>p});var d=s(5512),l=s.n(d);function p(){return l()('/*! aliyun rts sdk - ver2.13.7 created:2025/12/30 10:11:23 */(()=>{"use strict";var e={28:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});t.default={version:"2.13.7",protocol_version:2,sdk_version:"0.0.1"}},917:(e,t)=>{var r,o,n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_RETRY_DATACHANNEL_TIMEOUT=t.DEFAULT_HEARTBEAT_TIMEOUT=t.DEFAULT_RETRY_PUBLISH_INTERVAL=t.DEFAULT_RETRY_SUBSCRIBE_INTERVAL=t.DEFAULT_RETRY_PUBLISH_LIMIT=t.DEFAULT_RETRY_SUBSCRIBE_LIMIT=t.EWorkerAction=t.EWorkerSource=t.EConnectStatus=t.TrackType=void 0,function(e){e.AUDIO="audio",e.VIDEO="video"}(r||(t.TrackType=r={})),function(e){e[e.CONNECT_STATUS_DISCONNECTED=0]="CONNECT_STATUS_DISCONNECTED",e[e.CONNECT_STATUS_CONNECTING=1]="CONNECT_STATUS_CONNECTING",e[e.CONNECT_STATUS_CONNECTED=2]="CONNECT_STATUS_CONNECTED",e[e.CONNECT_STATUS_RECONNECTING=3]="CONNECT_STATUS_RECONNECTING"}(o||(t.EConnectStatus=o={})),function(e){e.Sender="sender",e.Receiver="receiver"}(n||(t.EWorkerSource=n={})),function(e){e.Setup="setup",e.InserSEI="insertSEI",e.UpdatePubStats="updatePubStats",e.UpdateSubStats="updateSubStats",e.SwitchCumuDelay="switchCumuDelay"}(i||(t.EWorkerAction=i={})),t.DEFAULT_RETRY_SUBSCRIBE_LIMIT=5,t.DEFAULT_RETRY_PUBLISH_LIMIT=5,t.DEFAULT_RETRY_SUBSCRIBE_INTERVAL=2e3,t.DEFAULT_RETRY_PUBLISH_INTERVAL=2e3,t.DEFAULT_HEARTBEAT_TIMEOUT=8,t.DEFAULT_RETRY_DATACHANNEL_TIMEOUT=8e3},649:function(e,t,r){var o,n,i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},i.apply(this,arguments)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CumuDelaySeiPayloadParser=t.CumuDelaySeiPayload=t.ECumuDelayGrtnKey=t.ECumuDelayPubSdkKey=t.ECumuDelayAVCommonKey=t.ECumuDelayVideoKey=t.ECumuDelayGrtnExportKey=t.ECumuDelaySubKey=t.CUMU_DELAY_UUID=t.CUMU_DELAY_SEI_PAYLOAD_TYPE=void 0;var s,u,l,A,C=a(r(28));t.CUMU_DELAY_SEI_PAYLOAD_TYPE=99,t.CUMU_DELAY_UUID=[32,36,16,9,16,23,7,1,150,117,25,212,25,129,3,7],function(e){e.SophonAudioDual="sophon_audio_dual",e.SophonVideoCamera="sophon_video_camera",e.SophonVideoCameraSmall="sophon_video_camera_small",e.SophonVideoCameraSuper="sophon_video_camera_super",e.SophonVideoScreenShare="sophon_video_screen_share",e.SophonAudio="sophon_audio",e.SophonVideoCameraLarge="sophon_video_camera_large",e.RtsAudio="rts audio",e.RtsVideo="rts video"}(s||(s={})),function(e){e[e.Web=0]="Web",e[e.iOS=1]="iOS",e[e.Android=2]="Android"}(u||(u={})),function(e){e.VTotalCost="VTotalCost",e.VAssemblyCost="VAssemblyCost",e.VJitterBufferDelay="VJitterBufferDelay",e.VDecPlugCost="VDecPlugCost",e.DownRTTHalf="DownRTTHalf"}(l||(t.ECumuDelaySubKey=l={})),function(e){e.TOTAL_COST="TOTAL_COST",e.ENTER_GRTN_TIMESTAMP="ENTER_GRTN_TIMESTAMP",e.LEAVE_GRTN_TIMESTAMP="LEAVE_GRTN_TIMESTAMP"}(A||(t.ECumuDelayGrtnExportKey=A={}));var c,T,f,d,E,_,y,S=((o={})[s.SophonAudioDual]=4,o[s.SophonVideoCamera]=5,o[s.SophonVideoCameraSmall]=6,o[s.SophonVideoCameraSuper]=7,o[s.SophonVideoScreenShare]=8,o[s.SophonAudio]=9,o[s.SophonVideoCameraLarge]=10,o[s.RtsAudio]=11,o[s.RtsVideo]=12,o);(n={})[S[s.SophonAudioDual]]=s.SophonAudioDual,n[S[s.SophonVideoCamera]]=s.SophonVideoCamera,n[S[s.SophonVideoCameraSmall]]=s.SophonVideoCameraSmall,n[S[s.SophonVideoCameraSuper]]=s.SophonVideoCameraSuper,n[S[s.SophonVideoScreenShare]]=s.SophonVideoScreenShare,n[S[s.SophonAudio]]=s.SophonAudio,n[S[s.SophonVideoCameraLarge]]=s.SophonVideoCameraLarge,n[S[s.RtsAudio]]=s.RtsAudio,n[S[s.RtsVideo]]=s.RtsVideo;!function(e){e[e.VTotalCost=4]="VTotalCost",e[e.CapDeviceCost=5]="CapDeviceCost",e[e.PushExtCost=6]="PushExtCost",e[e.CapPlugCost=7]="CapPlugCost",e[e.PrepThrCost=8]="PrepThrCost",e[e.PrepPlugCost=9]="PrepPlugCost",e[e.DispThrCost=10]="DispThrCost",e[e.DispPlugCost=11]="DispPlugCost",e[e.VEncThrCost=12]="VEncThrCost",e[e.VEncPlugCost=13]="VEncPlugCost"}(c||(t.ECumuDelayVideoKey=c={})),function(e){e[e.ATotalCost=24]="ATotalCost",e[e.ASourceCCost=25]="ASourceCCost",e[e.AMixerCost=26]="AMixerCost",e[e.AEncodeCCost=27]="AEncodeCCost",e[e.AAIClientQuestionTimestampHEAD=28]="AAIClientQuestionTimestampHEAD",e[e.AAIClientQuestionTimestampTAIL=29]="AAIClientQuestionTimestampTAIL",e[e.AAIClientAnswerTimestampHEAD=30]="AAIClientAnswerTimestampHEAD",e[e.AAIClientAnswerTimestampTAIL=31]="AAIClientAnswerTimestampTAIL",e[e.AAIClientScentenceId=32]="AAIClientScentenceId",e[e.AAIClientSourceCost=33]="AAIClientSourceCost",e[e.AAIClientMixerCost=34]="AAIClientMixerCost",e[e.AAIClientEncoderCost=35]="AAIClientEncoderCost",e[e.AAILinuxReceiveCost=36]="AAILinuxReceiveCost",e[e.AAILinuxNeteqCost=37]="AAILinuxNeteqCost",e[e.AAILinuxRemoteSourceCost=38]="AAILinuxRemoteSourceCost",e[e.AAILinuxPlayMixerCost=39]="AAILinuxPlayMixerCost",e[e.AAILinuxPlayCost=40]="AAILinuxPlayCost",e[e.AAIClientQuestionUidDigestHEAD=41]="AAIClientQuestionUidDigestHEAD",e[e.AAIClientQuestionUidDigestTAIL=42]="AAIClientQuestionUidDigestTAIL",e[e.AIClinetSmartDenoise=43]="AIClinetSmartDenoise"}(T||(T={})),function(e){e[e.NetsdkThrCost=44]="NetsdkThrCost",e[e.QosThrCost=45]="QosThrCost",e[e.PacerCost=46]="PacerCost",e[e.UpRTTHalf=47]="UpRTTHalf",e[e.AIClientNetsdkThrCost=48]="AIClientNetsdkThrCost",e[e.AIClientQosThrCost=49]="AIClientQosThrCost",e[e.AIClientPacerCost=50]="AIClientPacerCost",e[e.AIClientUpRTTHalf=51]="AIClientUpRTTHalf"}(f||(t.ECumuDelayAVCommonKey=f={})),function(e){e[e.AIAsrCost=64]="AIAsrCost",e[e.AILlmCost=65]="AILlmCost",e[e.AITtsCost=66]="AITtsCost",e[e.AIMuteCost=67]="AIMuteCost",e[e.AIAgentTotalCost=68]="AIAgentTotalCost",e[e.AIAgentExtraAvatarCost=69]="AIAgentExtraAvatarCost"}(d||(d={})),function(e){e[e.PubSdkType=100]="PubSdkType",e[e.PubSdkVersion=101]="PubSdkVersion"}(E||(t.ECumuDelayPubSdkKey=E={})),function(e){e[e.NGX_RTC_SEI_CUMULATIVE_DELAY_KEY_INTERNAL_RTT_HALF=121]="NGX_RTC_SEI_CUMULATIVE_DELAY_KEY_INTERNAL_RTT_HALF",e[e.NGX_RTC_SEI_CUMULATIVE_DELAY_KEY_GRTN_NODE_BEF_PACER=122]="NGX_RTC_SEI_CUMULATIVE_DELAY_KEY_GRTN_NODE_BEF_PACER",e[e.NGX_RTC_SEI_CUMULATIVE_DELAY_KEY_GRTN_NODE_PACER_COST=123]="NGX_RTC_SEI_CUMULATIVE_DELAY_KEY_GRTN_NODE_PACER_COST",e[e.NGX_RTC_SEI_CUMULATIVE_DELAY_KEY_DOWN_RTT_HALF=124]="NGX_RTC_SEI_CUMULATIVE_DELAY_KEY_DOWN_RTT_HALF"}(_||(t.ECumuDelayGrtnKey=_={})),function(e){e[e.AIGRTNInternalRTTHalf=104]="AIGRTNInternalRTTHalf",e[e.AIGRTNBeforePacer=105]="AIGRTNBeforePacer",e[e.AIGRTNPacerCost=106]="AIGRTNPacerCost",e[e.AIGRTNDownRTTHalf=107]="AIGRTNDownRTTHalf"}(y||(y={}));var p=function(e){e.msid=s.SophonAudio;var t=S[e.msid];t||console.warn("No mapped msid for cumuDelay",e.msid);var r=new ArrayBuffer(e.sendTs?8:4);if(e.sendTs){var o=Math.floor(performance.now()+performance.timeOrigin-e.windowTimeOrigin);o>=Math.pow(2,32)-1&&(o=0);var n=new DataView(r);n.setUint8(0,8),n.setUint8(1,0),n.setUint8(2,t),n.setUint8(3,5),n.setUint32(4,o)}else new Uint8Array(r).set([0,0,t,1]);e.kv[E.PubSdkType]=u.Web,e.kv[E.PubSdkVersion]=Number(C.default.version.split(".").join("").split("-")[0]);var a=Object.keys(e.kv).length;a>256&&console.warn("Too much kv");var l,A,T,d,_=1+3*a+1,y=new ArrayBuffer(_),p=new DataView(y);p.setInt8(0,a),Object.keys(e.kv).forEach((function(t,r){t in i(i(i({},c),f),E)||console.warn("Unknown CumuDelay key: ".concat(t));var o=e.kv[t],n=1+3*r;p.setUint8(n,parseInt(t)),p.setUint16(n+1,o)})),p.setUint8(_-1,128),this.buffer=(l=r,A=y,T=new ArrayBuffer(l.byteLength+A.byteLength),(d=new Uint8Array(T)).set(new Uint8Array(l),0),d.set(new Uint8Array(A),l.byteLength),T)};t.CumuDelaySeiPayload=p;var h=function(e){var t;this.pub={},this.grtn={},this.AIPub={},this.AISub={},this.AIAgent={},this.AIGrtn={},this.other={};var r,o,n=new v(e),i=(n.readBits(3),n.readBits()),a=n.readBits(),s=n.readBits(),u=n.readBits(),l=n.readBits();n.readBits(8),n.readBits(8),n.readBits(8),1===i&&n.readBits(16);if(1===a){var C=n.readBits(32);this.pub.timestamp=C,this.pub.timestampRecv=Math.floor(performance.now())}1===s&&n.readBits(16);1===u&&(r=n.readBits(32)),1===l&&(o=n.readBits(32)),r&&o&&(this.grtn=((t={})[A.TOTAL_COST]=o-r,t[A.ENTER_GRTN_TIMESTAMP]=r,t[A.LEAVE_GRTN_TIMESTAMP]=o,t));for(var S=n.readBits(8),p=0;p<S;p++){var h=n.readBits(8),m=n.readBits(16);if(I(h,[c.VTotalCost,c.VEncPlugCost])||I(h,[T.ATotalCost,T.AEncodeCCost])||I(h,[f.NetsdkThrCost,f.UpRTTHalf])||I(h,[E.PubSdkType,E.PubSdkVersion])){var b=c[h]||T[h]||f[h]||E[h];this.pub[b]=m}else if(I(h,[T.AAIClientQuestionTimestampHEAD,T.AAIClientEncoderCost])||I(h,[f.AIClientNetsdkThrCost,f.AIClientUpRTTHalf]))b=T[h]||f[h],this.AIPub[b]=m;else if(I(h,[T.AAILinuxReceiveCost,T.AIClinetSmartDenoise]))b=T[h],this.AISub[b]=m;else if(I(h,[d.AIAsrCost,d.AIAgentExtraAvatarCost]))b=d[h],this.AIAgent[b]=m;else if(I(h,[y.AIGRTNInternalRTTHalf,y.AIGRTNDownRTTHalf])){b=y[h];for(var D=0,U="".concat(b,"_").concat(D);this.AIGrtn.hasOwnProperty(U);)U="".concat(b,"_").concat(D++);this.AIGrtn[U]=m}else if(I(h,[_.NGX_RTC_SEI_CUMULATIVE_DELAY_KEY_INTERNAL_RTT_HALF,_.NGX_RTC_SEI_CUMULATIVE_DELAY_KEY_DOWN_RTT_HALF])){for(b=_[h],D=0,U="".concat(b,"_").concat(D);this.grtn.hasOwnProperty(U);)U="".concat(b,"_").concat(D++);this.grtn[U]=m}else this.other[h]=m}};function I(e,t){return e>=t[0]&&e<=t[1]}t.CumuDelaySeiPayloadParser=h;var v=function(){function e(e){this.byteOffset=0,this.bitOffset=0;var t=new Uint8Array(e);this.buffer=t}return e.prototype.readBits=function(e){void 0===e&&(e=1);for(var t=0,r=0;r<e;){if(this.byteOffset>=this.buffer.byteLength)throw new Error("readBits out of range");var o=8-this.bitOffset,n=Math.min(o,e-r);t=t<<n|this.getBitsFromByte(this.buffer,this.byteOffset,this.bitOffset,this.bitOffset+n-1),this.bitOffset+=n,r+=n,8===this.bitOffset&&(this.byteOffset++,this.bitOffset=0)}return 32===e&&(t>>>=0),t},e.prototype.hasNext=function(){return this.byteOffset<this.buffer.byteLength},e.prototype.getBitsFromByte=function(e,t,r,o){if(t<0||t>=e.byteLength||r<0||o>7||r>o)throw new Error("Invalid parameters");return e[t]>>7-o&(1<<o-r+1)-1},e}()},594:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.readUUID=t.discardEPB=t.insertEPB=t.SODBtoRBSP=t.convertPayloadSize=t.NALU=t.SEI=t.parseSei=t.insertSei=void 0;var o=r(649);t.insertSei=function(e,t,r,o){void 0===r&&(r=5);for(var a=e.data,s=new DataView(a),u=0;;){if(1===s.getUint32(u)){s.getUint8(u+4);var l=new n(t,r,o).buffer,A=new i(l).buffer,C=new ArrayBuffer(A.byteLength+a.byteLength),c=new Uint8Array(C),T=new Uint8Array(A);c.set(T);var f=new Uint8Array(a);c.set(f,A.byteLength),e.data=C,u+=1;break}if((u+=1)+4>=s.byteLength)break}};t.parseSei=function(e){for(var r=[],o=new DataView(e),n=0;;){var i=n,s=o.getUint32(i);if(i+=4,1===s){if(6===(31&o.getUint8(i++))){for(var u=o.getUint8(i++),l=a(u)?16:0,A=0;255==o.getUint8(i);)i++,A+=255;if((A+=o.getUint8(i++))>0&&o.byteLength>i+A){var C=new Uint8Array(o.buffer),c="";if(a(u)){var T=C.slice(i,i+l);c=(0,t.readUUID)((0,t.discardEPB)(T))}var f=C.slice(i+l,i+A);i+=A,r.push({payloadType:u,uuid:c,data:f.buffer})}}n=i}else n+=1;if(n+4>=o.byteLength)break}return r};var n=function(e,r,o){void 0===r&&(r=5);var n=a(r)?16:0,i=e.byteLength+n,s=(0,t.convertPayloadSize)(i),u=s.buffer.byteLength,l=new ArrayBuffer(1+u+n+e.byteLength),A=new Uint8Array(l),C=0;if(A[C++]=r,A.set(s,C),C+=s.byteLength,a(r)){o=(o||"00000000-0000-0000-0000-000000000000").replace(/-/g,"");for(var c=0;c<16;c++)A[C+c]=parseInt(o.substr(2*c,2),16);C+=16}var T=new Uint8Array(e);A.set(T,C);var f=(0,t.SODBtoRBSP)(A);this.buffer=f.buffer};t.SEI=n;var i=function(e){var t=new Uint8Array([0,0,0,1]),r=new Uint8Array([6]),o=new ArrayBuffer(t.byteLength+r.byteLength+e.byteLength),n=new Uint8Array(o);n.set(t),n.set(r,t.byteLength),n.set(new Uint8Array(e),t.byteLength+r.byteLength),this.buffer=o};t.NALU=i;t.convertPayloadSize=function(e){if(e<=0)throw new Error("payloadSize must be a positive integer.");for(var t=Math.ceil(e/255),r=new ArrayBuffer(t),o=new DataView(r),n=0;n<t-1;n++)o.setUint8(n,255);return o.setUint8(t-1,e%255&255),new Uint8Array(r)};t.SODBtoRBSP=function(e){for(var r=new Uint8Array(e),o="",n=0;n<r.length;n++)o+=r[n].toString(2).padStart(8,"0");for(o+="1";o.length%8!=0;)o+="0";var i=o.length/8,a=new Uint8Array(i);for(n=0;n<i;n++)a[n]=parseInt(o.slice(8*n,8*n+8),2);return(0,t.insertEPB)(a)};t.insertEPB=function(e){for(var t=[],r=0,o=0;o<e.length;o++)t.push(e[o]),0===e[o]?2===++r&&o<e.length-1&&e[o+1]<=3&&(t.push(3),r=0):r=0;return new Uint8Array(t)};t.discardEPB=function(e){for(var t=e.byteLength,r=[],o=1;o<t-2;)0===e[o]&&0===e[o+1]&&3===e[o+2]?(r.push(o+2),o+=2):o++;if(0===r.length)return e;var n=t-r.length,i=new Uint8Array(n),a=0;for(o=0;o<n;a++,o++)a===r[0]&&(a++,r.shift()),i[o]=e[a];return i};t.readUUID=function(e){if(16!==e.length)throw new Error("UUID must be 16 bytes long.");var t=e.reduce((function(e,t){return e+t.toString(16).padStart(2,"0")}),"");return"".concat(t.slice(0,8),"-").concat(t.slice(8,12),"-").concat(t.slice(12,16),"-").concat(t.slice(16,20),"-").concat(t.slice(20))};var a=function(e){return 5===e||e===o.CUMU_DELAY_SEI_PAYLOAD_TYPE}},718:function(e,t){var r=this&&this.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var o,n=0,i=t.length;n<i;n++)!o&&n in t||(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.hebtLog=t.createUUID=t.evaluateNetworkCondition=t.makeCancelable=t.hasVideoTrack=t.hasAudioTrack=t.getVideoTrack=t.getAudioTrack=t.pruneSubUrl=t.getJitterBufferDelayAvg=void 0,t.lowercaseFirstLetter=function(e){return e.replace(/([A-Za-z])/,(function(e){return e.toLowerCase()}))},t.underlineToCamelCase=function(e){return e.replace(/_([a-z])/g,(function(e,t){return t.toUpperCase()}))};t.getJitterBufferDelayAvg=function(e,t){return e&&t?Number(e)/Number(t)*1e3:-1};t.pruneSubUrl=function(e,t){var r=e||"";return r=r.replace("@subaudio=no","").replace("@subvideo=no",""),t&&(r=r.split("?")[0]),r};t.getAudioTrack=function(e){return e.getAudioTracks()[0]};t.getVideoTrack=function(e){return e.getVideoTracks()[0]};t.hasAudioTrack=function(e){return e.getAudioTracks().length>0};t.hasVideoTrack=function(e){return e.getVideoTracks().length>0};t.makeCancelable=function(e){var t=!1;return{promise:new Promise((function(r,o){e.then((function(e){return t?o({isCanceled:!0}):r(e)})),e.catch((function(e){return o(t?{isCanceled:!0}:e)}))})),cancel:function(){t=!0}}};t.evaluateNetworkCondition=function(e,t,r,o,n){var i=0;if(!navigator.onLine)return i=6;var a=[{loss:0,rtt:0,jbd:1},{loss:0,rtt:1,jbd:0},{loss:0,rtt:.5,jbd:.5},{loss:1,rtt:0,jbd:0},{loss:.8,rtt:0,jbd:.2},{loss:.8,rtt:.2,jbd:0},{loss:.6,rtt:.2,jbd:.2}],s=-1,u=-1,l=-1;if("number"==typeof t&&t>=0||"number"==typeof r&&r>=0){s=0;var A=!1,C=!1;"number"==typeof t&&t>=0&&(s+=t,A=!0),"number"==typeof r&&r>=0&&(s+=r,C=!0),A&&!C&&(s*=2),C&&!A&&(s*=1.8)}if("number"==typeof e&&e>=0&&(l=e),"number"==typeof o&&o>=0||"number"==typeof n&&n>=0){u=0;"number"==typeof o&&o>=0&&(u+=o),"number"==typeof n&&n>=0&&(u+=n)}var c;if((c=4*(-1!==s?1:0)+2*(-1!==l?1:0)+(-1!==u?1:0))>0){var T=1.2*s*a[c-1].loss+l/1500*a[c-1].rtt+u/3e3*a[c-1].jbd;i=T<=.1?1:T<=.23?2:T<=.36?3:T<=.49?4:5}else i=0;return i};t.createUUID=function(e,t){var r,o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=[];if(t=t||o.length,e)for(r=0;r<e;r++)n[r]=o[0|Math.random()*t];else{var i=void 0;for(n[8]=n[13]=n[18]=n[23]="-",n[14]="4",r=0;r<36;r++)n[r]||(i=0|16*Math.random(),n[r]=o[19==r?3&i|8:i])}return n.join("")};t.hebtLog=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];window.RTS_HEBT_DEBUG&&console.log.apply(console,r(["[rts hebt]"],e,!1))}}},t={};function r(o){var n=t[o];if(void 0!==n)return n.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,r),i.exports}var o,n,i,a,s,u,l,A,C,c,T,f;a=r(594),s=r(718),u=r(649),l=r(917),A=self,C=!1,c=0,T=function(e,t,r,s){if(e===l.EWorkerSource.Sender){var A=new TransformStream({transform:function(e,t){var r=e;if(e.type){if(o)try{(!o.keyframeOnly||o.keyframeOnly&&"key"===e.type)&&((0,a.insertSei)(e,o.sei,o.payloadType,o.uuid),void 0===o.repeatCount?o=null:-1!==o.repeatCount&&(o.repeatCount--,o.repeatCount<0&&(o=null)))}catch(t){e=r,console.log("error in inserting user SEI",t)}else if(C)try{if("key"===e.type&&n){var i={};n.v_encode_time_avg&&(i[u.ECumuDelayVideoKey.VEncPlugCost]=Math.ceil(n.v_encode_time_avg)),n.v_packet_send_delay_avg&&(i[u.ECumuDelayAVCommonKey.PacerCost]=Math.ceil(n.v_packet_send_delay_avg)),n.rtt&&(i[u.ECumuDelayAVCommonKey.UpRTTHalf]=Math.ceil(n.rtt/2*1e3)),i[u.ECumuDelayVideoKey.VTotalCost]=Math.ceil((i[u.ECumuDelayVideoKey.VEncPlugCost]||0)+(i[u.ECumuDelayAVCommonKey.PacerCost]||0)),(0,a.insertSei)(e,new u.CumuDelaySeiPayload({msid:n.vMsid||"",kv:i,sendTs:!0,windowTimeOrigin:c}).buffer,u.CUMU_DELAY_SEI_PAYLOAD_TYPE,(0,a.readUUID)(new Uint8Array(u.CUMU_DELAY_UUID)))}}catch(t){e=r,console.log("error in inserting cumuDelay SEI",t)}r=null,s&&s(e)}t.enqueue(e)}});t.pipeThrough(A).pipeTo(r)}else e===l.EWorkerSource.Receiver&&(A=new TransformStream({transform:function(e,t){var r,o,n,a,l,A,C,c,T,f,d,E=e;if(e.type){try{if(i){var _=((r={})[u.ECumuDelaySubKey.DownRTTHalf]=Math.ceil(((null===(n=null===(o=i.video)||void 0===o?void 0:o.transportStats)||void 0===n?void 0:n.rtt)||0)/2*1e3),r[u.ECumuDelaySubKey.VAssemblyCost]=Math.ceil((null===(l=null===(a=i.video)||void 0===a?void 0:a.inboundRtpStatsPerSec)||void 0===l?void 0:l.totalAssemblyTimeAvg)||0),r[u.ECumuDelaySubKey.VJitterBufferDelay]=Math.ceil((null===(C=null===(A=i.video)||void 0===A?void 0:A.inboundRtpStatsPerSec)||void 0===C?void 0:C.jitterBufferDelayAvg)||0),r[u.ECumuDelaySubKey.VDecPlugCost]=Math.ceil((null===(T=null===(c=i.video)||void 0===c?void 0:c.inboundRtpStatsPerSec)||void 0===T?void 0:T.decodeTimeAvg)||0),r[u.ECumuDelaySubKey.VTotalCost]=Math.ceil((null===(d=null===(f=i.video)||void 0===f?void 0:f.inboundRtpStatsPerSec)||void 0===d?void 0:d.totalProcessingDelayAvg)||0),r);_[u.ECumuDelaySubKey.VTotalCost]||(_[u.ECumuDelaySubKey.VTotalCost]=Math.ceil((_[u.ECumuDelaySubKey.VAssemblyCost]||0)+(_[u.ECumuDelaySubKey.VJitterBufferDelay]||0)+(_[u.ECumuDelaySubKey.VDecPlugCost]||0))),e.subStats=_}}catch(t){console.log("error in parsing SEI",t),e=E}E=null,s&&s(e)}delete e.subStats,t.enqueue(e)}}),t.pipeThrough(A).pipeTo(r))},f=function(e){var t=e.data.slice(0);A.postMessage({type:"encodedFrame",data:t,frameInfo:{type:e.type,timestamp:e.timestamp},subStats:e.subStats},[t]),t=null},A.RTCTransformEvent&&(A.onrtctransform=function(e){var t=e.transformer,r=t.options.source,o=t.readable,n=t.writable;T(r,o,n,(function(e){r===l.EWorkerSource.Receiver&&f(e)}))}),onmessage=function(e){switch(e.data.operation){case l.EWorkerAction.Setup:t=e.data,r=t.source,a=t.readable,u=t.writable,T(r,a,u,(function(e){r===l.EWorkerSource.Receiver&&f(e)}));break;case l.EWorkerAction.InserSEI:!function(e){(o=e)&&(o.uuid=(0,s.createUUID)().toLowerCase(),o.repeatCount=o.repeatCount||0)}(e.data);break;case l.EWorkerAction.UpdatePubStats:!function(e){n=e.stats}(e.data);break;case l.EWorkerAction.UpdateSubStats:!function(e){i=e.stats}(e.data);break;case l.EWorkerAction.SwitchCumuDelay:!function(e){C=e.enable,c=e.windowTimeOrigin}(e.data)}var t,r,a,u}})();',"Worker",void 0,void 0)}},5512:g=>{g.exports=function(c,s,d,l){var p=self||window;try{try{var S;try{S=new p.Blob([c])}catch{(S=new(p.BlobBuilder||p.WebKitBlobBuilder||p.MozBlobBuilder||p.MSBlobBuilder)).append(c),S=S.getBlob()}var T=p.URL||p.webkitURL,y=T.createObjectURL(S),R=new p[s](y,d);return T.revokeObjectURL(y),R}catch{return new p[s]("data:application/javascript,".concat(encodeURIComponent(c)),d)}}catch{if(!l)throw Error("Inline worker is not supported");return new p[s](l,d)}}},2632:(g,c,s)=>{s.r(c),s.d(c,{default:()=>v});function d(h,m,_){Object.defineProperty(h,m,{writable:!0,enumerable:!0,configurable:!0,value:_})}Array(32);var l,p,S;class T{constructor(m){var _,A;this.timer=null,this.time=10,this.count=10,this.arr=[],this.time=(_=m.time)!=null?_:10,this.count=(A=m.count)!=null?A:10,m.host.startsWith("http://")||m.host.startsWith("https://")?this.url=m.host+"/logstores/"+m.logstore+"/track":this.url="https://"+m.project+"."+m.host+"/logstores/"+m.logstore+"/track",this.opt=m,m.installUnloadHook&&typeof m.installUnloadHook=="function"&&m.installUnloadHook((()=>{this.sendImmediateInner()}))}assemblePayload(m=this.arr){const _={__logs__:m};return this.opt.tags&&(_.__tags__=this.opt.tags),this.opt.topic&&(_.__topic__=this.opt.topic),this.opt.source&&(_.__source__=this.opt.source),JSON.stringify(_)}platformSend(){if(this.opt.sendPayload&&typeof this.opt.sendPayload=="function"){const m=this.assemblePayload();this.opt.sendPayload(this.url,m)}}transString(m){let _={};for(let A in m)typeof m[A]=="object"?_[A]=JSON.stringify(m[A]):_[A]=String(m[A]);return _}sendImmediateInner(){this.arr&&this.arr.length>0&&(this.platformSend(),this.timer!=null&&(clearTimeout(this.timer),this.timer=null),this.arr=[])}sendInner(){if(this.timer)this.arr.length>=this.count&&(clearTimeout(this.timer),this.timer=null,this.sendImmediateInner());else{const m=this;this.arr.length>=this.count||this.time<=0?this.sendImmediateInner():this.timer=setTimeout((function(){m.sendImmediateInner()}),1e3*this.time)}}send(m){const _=this.transString(m);this.arr.push(_),this.sendInner()}sendImmediate(m){const _=this.transString(m);this.arr.push(_),this.sendImmediateInner()}sendBatchLogs(m){const _=m.map((A=>this.transString(A)));this.arr.push(..._),this.sendInner()}sendBatchLogsImmediate(m){const _=m.map((A=>this.transString(A)));this.arr.push(..._),this.sendImmediateInner()}}function y(h,m){const _=new window.XMLHttpRequest;_.open("POST",`${h}?APIVersion=0.6.0`,!0),_.send(m)}function R(h,m){try{if(m.length>=32768)return void y(h,m);(function(_,A){return!(!navigator||!navigator.sendBeacon)&&navigator.sendBeacon(`${_}?APIVersion=0.6.0`,A)})(h,m)||y(h,m)}catch(_){window&&window.console&&typeof window.console.error=="function"&&(console.error(`Failed to log to ali log service because of this exception:
`+_),console.error("Failed log data:",h))}}class v extends T{constructor(m){super(Object.assign({},m,{installUnloadHook:_=>{window.addEventListener("beforeunload",(()=>{_()}))},sendPayload:(_,A)=>{R(_,A)}}))}}l=window,p="SLS_Tracker",S=v,d(l,p,S)},4198:g=>{g.exports=JSON.parse('{"name":"axios","version":"0.21.4","description":"Promise based HTTP client for the browser and node.js","main":"index.js","scripts":{"test":"grunt test","start":"node ./sandbox/server.js","build":"NODE_ENV=production grunt build","preversion":"npm test","version":"npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json","postversion":"git push && git push --tags","examples":"node ./examples/server.js","coveralls":"cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js","fix":"eslint --fix lib/**/*.js"},"repository":{"type":"git","url":"https://github.com/axios/axios.git"},"keywords":["xhr","http","ajax","promise","node"],"author":"Matt Zabriskie","license":"MIT","bugs":{"url":"https://github.com/axios/axios/issues"},"homepage":"https://axios-http.com","devDependencies":{"coveralls":"^3.0.0","es6-promise":"^4.2.4","grunt":"^1.3.0","grunt-banner":"^0.6.0","grunt-cli":"^1.2.0","grunt-contrib-clean":"^1.1.0","grunt-contrib-watch":"^1.0.0","grunt-eslint":"^23.0.0","grunt-karma":"^4.0.0","grunt-mocha-test":"^0.13.3","grunt-ts":"^6.0.0-beta.19","grunt-webpack":"^4.0.2","istanbul-instrumenter-loader":"^1.0.0","jasmine-core":"^2.4.1","karma":"^6.3.2","karma-chrome-launcher":"^3.1.0","karma-firefox-launcher":"^2.1.0","karma-jasmine":"^1.1.1","karma-jasmine-ajax":"^0.1.13","karma-safari-launcher":"^1.0.0","karma-sauce-launcher":"^4.3.6","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","load-grunt-tasks":"^3.5.2","minimist":"^1.2.0","mocha":"^8.2.1","sinon":"^4.5.0","terser-webpack-plugin":"^4.2.3","typescript":"^4.0.5","url-search-params":"^0.10.0","webpack":"^4.44.2","webpack-dev-server":"^3.11.0"},"browser":{"./lib/adapters/http.js":"./lib/adapters/xhr.js"},"jsdelivr":"dist/axios.min.js","unpkg":"dist/axios.min.js","typings":"./index.d.ts","dependencies":{"follow-redirects":"^1.14.0"},"bundlesize":[{"path":"./dist/axios.min.js","threshold":"5kB"}]}')}},o={};function u(g){var c=o[g];if(c!==void 0)return c.exports;var s=o[g]={exports:{}};return n[g].call(s.exports,s,s.exports,u),s.exports}return u.n=g=>{var c=g&&g.__esModule?()=>g.default:()=>g;return u.d(c,{a:c}),c},u.d=(g,c)=>{for(var s in c)u.o(c,s)&&!u.o(g,s)&&Object.defineProperty(g,s,{enumerable:!0,get:c[s]})},u.o=(g,c)=>Object.prototype.hasOwnProperty.call(g,c),u.r=g=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})},u(8156)})()))})(Yd)),Yd.exports}var wt=BR(),Xd={exports:{}},_v;function VR(){return _v||(_v=1,(function(i){var e=Object.prototype.hasOwnProperty,n="~";function o(){}Object.create&&(o.prototype=Object.create(null),new o().__proto__||(n=!1));function u(d,l,p){this.fn=d,this.context=l,this.once=p||!1}function g(d,l,p,S,T){if(typeof p!="function")throw new TypeError("The listener must be a function");var y=new u(p,S||d,T),R=n?n+l:l;return d._events[R]?d._events[R].fn?d._events[R]=[d._events[R],y]:d._events[R].push(y):(d._events[R]=y,d._eventsCount++),d}function c(d,l){--d._eventsCount===0?d._events=new o:delete d._events[l]}function s(){this._events=new o,this._eventsCount=0}s.prototype.eventNames=function(){var l=[],p,S;if(this._eventsCount===0)return l;for(S in p=this._events)e.call(p,S)&&l.push(n?S.slice(1):S);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(p)):l},s.prototype.listeners=function(l){var p=n?n+l:l,S=this._events[p];if(!S)return[];if(S.fn)return[S.fn];for(var T=0,y=S.length,R=new Array(y);T<y;T++)R[T]=S[T].fn;return R},s.prototype.listenerCount=function(l){var p=n?n+l:l,S=this._events[p];return S?S.fn?1:S.length:0},s.prototype.emit=function(l,p,S,T,y,R){var v=n?n+l:l;if(!this._events[v])return!1;var h=this._events[v],m=arguments.length,_,A;if(h.fn){switch(h.once&&this.removeListener(l,h.fn,void 0,!0),m){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,p),!0;case 3:return h.fn.call(h.context,p,S),!0;case 4:return h.fn.call(h.context,p,S,T),!0;case 5:return h.fn.call(h.context,p,S,T,y),!0;case 6:return h.fn.call(h.context,p,S,T,y,R),!0}for(A=1,_=new Array(m-1);A<m;A++)_[A-1]=arguments[A];h.fn.apply(h.context,_)}else{var E=h.length,b;for(A=0;A<E;A++)switch(h[A].once&&this.removeListener(l,h[A].fn,void 0,!0),m){case 1:h[A].fn.call(h[A].context);break;case 2:h[A].fn.call(h[A].context,p);break;case 3:h[A].fn.call(h[A].context,p,S);break;case 4:h[A].fn.call(h[A].context,p,S,T);break;default:if(!_)for(b=1,_=new Array(m-1);b<m;b++)_[b-1]=arguments[b];h[A].fn.apply(h[A].context,_)}}return!0},s.prototype.on=function(l,p,S){return g(this,l,p,S,!1)},s.prototype.once=function(l,p,S){return g(this,l,p,S,!0)},s.prototype.removeListener=function(l,p,S,T){var y=n?n+l:l;if(!this._events[y])return this;if(!p)return c(this,y),this;var R=this._events[y];if(R.fn)R.fn===p&&(!T||R.once)&&(!S||R.context===S)&&c(this,y);else{for(var v=0,h=[],m=R.length;v<m;v++)(R[v].fn!==p||T&&!R[v].once||S&&R[v].context!==S)&&h.push(R[v]);h.length?this._events[y]=h.length===1?h[0]:h:c(this,y)}return this},s.prototype.removeAllListeners=function(l){var p;return l?(p=n?n+l:l,this._events[p]&&c(this,p)):(this._events=new o,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,i.exports=s})(Xd)),Xd.exports}var HR=VR();const Ei=A1(HR);var jR=Object.defineProperty,zR=Object.defineProperties,FR=Object.getOwnPropertyDescriptors,cl=Object.getOwnPropertySymbols,GR=Object.getPrototypeOf,aS=Object.prototype.hasOwnProperty,sS=Object.prototype.propertyIsEnumerable,WR=Reflect.get,Mh=(i,e,n)=>e in i?jR(i,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[e]=n,Qe=(i,e)=>{for(var n in e||(e={}))aS.call(e,n)&&Mh(i,n,e[n]);if(cl)for(var n of cl(e))sS.call(e,n)&&Mh(i,n,e[n]);return i},Vr=(i,e)=>zR(i,FR(e)),jn=(i,e)=>{var n={};for(var o in i)aS.call(i,o)&&e.indexOf(o)<0&&(n[o]=i[o]);if(i!=null&&cl)for(var o of cl(i))e.indexOf(o)<0&&sS.call(i,o)&&(n[o]=i[o]);return n},W=(i,e,n)=>(Mh(i,typeof e!="symbol"?e+"":e,n),n),cS=(i,e,n)=>WR(GR(i),n,e),pe=(i,e,n)=>new Promise((o,u)=>{var g=d=>{try{s(n.next(d))}catch(l){u(l)}},c=d=>{try{s(n.throw(d))}catch(l){u(l)}},s=d=>d.done?o(d.value):Promise.resolve(d.value).then(g,c);s((n=n.apply(i,e)).next())}),lS=(i=>(i.EnableNonOnePcDefaultJoinMode="h5_enable_non_one_pc_default_join_mode",i))(lS||{});function qR(i,e,n){Object.defineProperty(i,e,{writable:!0,enumerable:!0,configurable:!0,value:n})}function uS(i,e,n,o){qR(i,e,n)}Array(32);var el=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function KR(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function YR(i){if(i.__esModule)return i;var e=i.default;if(typeof e=="function"){var n=function o(){return this instanceof o?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(i).forEach(function(o){var u=Object.getOwnPropertyDescriptor(i,o);Object.defineProperty(n,o,u.get?u:{enumerable:!0,get:function(){return i[o]}})}),n}var dS={exports:{}},Tv={exports:{}};const XR=YR(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var Av;function At(){return Av||(Av=1,Tv.exports=(function(){var i=i||(function(e,n){var o;if(typeof window<"u"&&window.crypto&&(o=window.crypto),typeof self<"u"&&self.crypto&&(o=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(o=globalThis.crypto),!o&&typeof window<"u"&&window.msCrypto&&(o=window.msCrypto),!o&&el!==void 0&&el.crypto&&(o=el.crypto),!o)try{o=XR}catch{}var u=function(){if(o){if(typeof o.getRandomValues=="function")try{return o.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof o.randomBytes=="function")try{return o.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},g=Object.create||(function(){function h(){}return function(m){var _;return h.prototype=m,_=new h,h.prototype=null,_}})(),c={},s=c.lib={},d=s.Base={extend:function(h){var m=g(this);return h&&m.mixIn(h),m.hasOwnProperty("init")&&this.init!==m.init||(m.init=function(){m.$super.init.apply(this,arguments)}),m.init.prototype=m,m.$super=this,m},create:function(){var h=this.extend();return h.init.apply(h,arguments),h},init:function(){},mixIn:function(h){for(var m in h)h.hasOwnProperty(m)&&(this[m]=h[m]);h.hasOwnProperty("toString")&&(this.toString=h.toString)},clone:function(){return this.init.prototype.extend(this)}},l=s.WordArray=d.extend({init:function(h,m){h=this.words=h||[],this.sigBytes=m!=n?m:4*h.length},toString:function(h){return(h||S).stringify(this)},concat:function(h){var m=this.words,_=h.words,A=this.sigBytes,E=h.sigBytes;if(this.clamp(),A%4)for(var b=0;b<E;b++){var w=_[b>>>2]>>>24-b%4*8&255;m[A+b>>>2]|=w<<24-(A+b)%4*8}else for(var C=0;C<E;C+=4)m[A+C>>>2]=_[C>>>2];return this.sigBytes+=E,this},clamp:function(){var h=this.words,m=this.sigBytes;h[m>>>2]&=4294967295<<32-m%4*8,h.length=e.ceil(m/4)},clone:function(){var h=d.clone.call(this);return h.words=this.words.slice(0),h},random:function(h){for(var m=[],_=0;_<h;_+=4)m.push(u());return new l.init(m,h)}}),p=c.enc={},S=p.Hex={stringify:function(h){for(var m=h.words,_=h.sigBytes,A=[],E=0;E<_;E++){var b=m[E>>>2]>>>24-E%4*8&255;A.push((b>>>4).toString(16)),A.push((15&b).toString(16))}return A.join("")},parse:function(h){for(var m=h.length,_=[],A=0;A<m;A+=2)_[A>>>3]|=parseInt(h.substr(A,2),16)<<24-A%8*4;return new l.init(_,m/2)}},T=p.Latin1={stringify:function(h){for(var m=h.words,_=h.sigBytes,A=[],E=0;E<_;E++){var b=m[E>>>2]>>>24-E%4*8&255;A.push(String.fromCharCode(b))}return A.join("")},parse:function(h){for(var m=h.length,_=[],A=0;A<m;A++)_[A>>>2]|=(255&h.charCodeAt(A))<<24-A%4*8;return new l.init(_,m)}},y=p.Utf8={stringify:function(h){try{return decodeURIComponent(escape(T.stringify(h)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(h){return T.parse(unescape(encodeURIComponent(h)))}},R=s.BufferedBlockAlgorithm=d.extend({reset:function(){this._data=new l.init,this._nDataBytes=0},_append:function(h){typeof h=="string"&&(h=y.parse(h)),this._data.concat(h),this._nDataBytes+=h.sigBytes},_process:function(h){var m,_=this._data,A=_.words,E=_.sigBytes,b=this.blockSize,w=E/(4*b),C=(w=h?e.ceil(w):e.max((0|w)-this._minBufferSize,0))*b,P=e.min(4*C,E);if(C){for(var U=0;U<C;U+=b)this._doProcessBlock(A,U);m=A.splice(0,C),_.sigBytes-=P}return new l.init(m,P)},clone:function(){var h=d.clone.call(this);return h._data=this._data.clone(),h},_minBufferSize:0});s.Hasher=R.extend({cfg:d.extend(),init:function(h){this.cfg=this.cfg.extend(h),this.reset()},reset:function(){R.reset.call(this),this._doReset()},update:function(h){return this._append(h),this._process(),this},finalize:function(h){return h&&this._append(h),this._doFinalize()},blockSize:16,_createHelper:function(h){return function(m,_){return new h.init(_).finalize(m)}},_createHmacHelper:function(h){return function(m,_){return new v.HMAC.init(h,_).finalize(m)}}});var v=c.algo={};return c})(Math);return i})()),Tv.exports}var Cv,wv={exports:{}};function ll(){return Cv||(Cv=1,wv.exports=(function(i){return o=(n=i).lib,u=o.Base,g=o.WordArray,(c=n.x64={}).Word=u.extend({init:function(s,d){this.high=s,this.low=d}}),c.WordArray=u.extend({init:function(s,d){s=this.words=s||[],this.sigBytes=d!=e?d:8*s.length},toX32:function(){for(var s=this.words,d=s.length,l=[],p=0;p<d;p++){var S=s[p];l.push(S.high),l.push(S.low)}return g.create(l,this.sigBytes)},clone:function(){for(var s=u.clone.call(this),d=s.words=this.words.slice(0),l=d.length,p=0;p<l;p++)d[p]=d[p].clone();return s}}),i;var e,n,o,u,g,c})(At())),wv.exports}var Dv,Ov={exports:{}};function JR(){return Dv||(Dv=1,Ov.exports=(function(i){return(function(){if(typeof ArrayBuffer=="function"){var e=i.lib.WordArray,n=e.init,o=e.init=function(u){if(u instanceof ArrayBuffer&&(u=new Uint8Array(u)),(u instanceof Int8Array||typeof Uint8ClampedArray<"u"&&u instanceof Uint8ClampedArray||u instanceof Int16Array||u instanceof Uint16Array||u instanceof Int32Array||u instanceof Uint32Array||u instanceof Float32Array||u instanceof Float64Array)&&(u=new Uint8Array(u.buffer,u.byteOffset,u.byteLength)),u instanceof Uint8Array){for(var g=u.byteLength,c=[],s=0;s<g;s++)c[s>>>2]|=u[s]<<24-s%4*8;n.call(this,c,g)}else n.apply(this,arguments)};o.prototype=e}})(),i.lib.WordArray})(At())),Ov.exports}var Iv,Mv={exports:{}};function QR(){return Iv||(Iv=1,Mv.exports=(function(i){return(function(){var e=i,n=e.lib.WordArray,o=e.enc;function u(g){return g<<8&4278255360|g>>>8&16711935}o.Utf16=o.Utf16BE={stringify:function(g){for(var c=g.words,s=g.sigBytes,d=[],l=0;l<s;l+=2){var p=c[l>>>2]>>>16-l%4*8&65535;d.push(String.fromCharCode(p))}return d.join("")},parse:function(g){for(var c=g.length,s=[],d=0;d<c;d++)s[d>>>1]|=g.charCodeAt(d)<<16-d%2*16;return n.create(s,2*c)}},o.Utf16LE={stringify:function(g){for(var c=g.words,s=g.sigBytes,d=[],l=0;l<s;l+=2){var p=u(c[l>>>2]>>>16-l%4*8&65535);d.push(String.fromCharCode(p))}return d.join("")},parse:function(g){for(var c=g.length,s=[],d=0;d<c;d++)s[d>>>1]|=u(g.charCodeAt(d)<<16-d%2*16);return n.create(s,2*c)}}})(),i.enc.Utf16})(At())),Mv.exports}var Nv,kv={exports:{}};function ho(){return Nv||(Nv=1,kv.exports=(function(i){return(function(){var e=i,n=e.lib.WordArray;function o(u,g,c){for(var s=[],d=0,l=0;l<g;l++)if(l%4){var p=c[u.charCodeAt(l-1)]<<l%4*2|c[u.charCodeAt(l)]>>>6-l%4*2;s[d>>>2]|=p<<24-d%4*8,d++}return n.create(s,d)}e.enc.Base64={stringify:function(u){var g=u.words,c=u.sigBytes,s=this._map;u.clamp();for(var d=[],l=0;l<c;l+=3)for(var p=(g[l>>>2]>>>24-l%4*8&255)<<16|(g[l+1>>>2]>>>24-(l+1)%4*8&255)<<8|g[l+2>>>2]>>>24-(l+2)%4*8&255,S=0;S<4&&l+.75*S<c;S++)d.push(s.charAt(p>>>6*(3-S)&63));var T=s.charAt(64);if(T)for(;d.length%4;)d.push(T);return d.join("")},parse:function(u){var g=u.length,c=this._map,s=this._reverseMap;if(!s){s=this._reverseMap=[];for(var d=0;d<c.length;d++)s[c.charCodeAt(d)]=d}var l=c.charAt(64);if(l){var p=u.indexOf(l);p!==-1&&(g=p)}return o(u,g,s)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}})(),i.enc.Base64})(At())),kv.exports}var Pv,Lv={exports:{}};function $R(){return Pv||(Pv=1,Lv.exports=(function(i){return(function(){var e=i,n=e.lib.WordArray;function o(u,g,c){for(var s=[],d=0,l=0;l<g;l++)if(l%4){var p=c[u.charCodeAt(l-1)]<<l%4*2|c[u.charCodeAt(l)]>>>6-l%4*2;s[d>>>2]|=p<<24-d%4*8,d++}return n.create(s,d)}e.enc.Base64url={stringify:function(u,g){g===void 0&&(g=!0);var c=u.words,s=u.sigBytes,d=g?this._safe_map:this._map;u.clamp();for(var l=[],p=0;p<s;p+=3)for(var S=(c[p>>>2]>>>24-p%4*8&255)<<16|(c[p+1>>>2]>>>24-(p+1)%4*8&255)<<8|c[p+2>>>2]>>>24-(p+2)%4*8&255,T=0;T<4&&p+.75*T<s;T++)l.push(d.charAt(S>>>6*(3-T)&63));var y=d.charAt(64);if(y)for(;l.length%4;)l.push(y);return l.join("")},parse:function(u,g){g===void 0&&(g=!0);var c=u.length,s=g?this._safe_map:this._map,d=this._reverseMap;if(!d){d=this._reverseMap=[];for(var l=0;l<s.length;l++)d[s.charCodeAt(l)]=l}var p=s.charAt(64);if(p){var S=u.indexOf(p);S!==-1&&(c=S)}return o(u,c,d)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"}})(),i.enc.Base64url})(At())),Lv.exports}var Uv,xv={exports:{}};function fo(){return Uv||(Uv=1,xv.exports=(function(i){return(function(e){var n=i,o=n.lib,u=o.WordArray,g=o.Hasher,c=n.algo,s=[];(function(){for(var y=0;y<64;y++)s[y]=4294967296*e.abs(e.sin(y+1))|0})();var d=c.MD5=g.extend({_doReset:function(){this._hash=new u.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(y,R){for(var v=0;v<16;v++){var h=R+v,m=y[h];y[h]=16711935&(m<<8|m>>>24)|4278255360&(m<<24|m>>>8)}var _=this._hash.words,A=y[R+0],E=y[R+1],b=y[R+2],w=y[R+3],C=y[R+4],P=y[R+5],U=y[R+6],B=y[R+7],L=y[R+8],H=y[R+9],O=y[R+10],x=y[R+11],F=y[R+12],N=y[R+13],k=y[R+14],M=y[R+15],j=_[0],G=_[1],z=_[2],V=_[3];j=l(j,G,z,V,A,7,s[0]),V=l(V,j,G,z,E,12,s[1]),z=l(z,V,j,G,b,17,s[2]),G=l(G,z,V,j,w,22,s[3]),j=l(j,G,z,V,C,7,s[4]),V=l(V,j,G,z,P,12,s[5]),z=l(z,V,j,G,U,17,s[6]),G=l(G,z,V,j,B,22,s[7]),j=l(j,G,z,V,L,7,s[8]),V=l(V,j,G,z,H,12,s[9]),z=l(z,V,j,G,O,17,s[10]),G=l(G,z,V,j,x,22,s[11]),j=l(j,G,z,V,F,7,s[12]),V=l(V,j,G,z,N,12,s[13]),z=l(z,V,j,G,k,17,s[14]),j=p(j,G=l(G,z,V,j,M,22,s[15]),z,V,E,5,s[16]),V=p(V,j,G,z,U,9,s[17]),z=p(z,V,j,G,x,14,s[18]),G=p(G,z,V,j,A,20,s[19]),j=p(j,G,z,V,P,5,s[20]),V=p(V,j,G,z,O,9,s[21]),z=p(z,V,j,G,M,14,s[22]),G=p(G,z,V,j,C,20,s[23]),j=p(j,G,z,V,H,5,s[24]),V=p(V,j,G,z,k,9,s[25]),z=p(z,V,j,G,w,14,s[26]),G=p(G,z,V,j,L,20,s[27]),j=p(j,G,z,V,N,5,s[28]),V=p(V,j,G,z,b,9,s[29]),z=p(z,V,j,G,B,14,s[30]),j=S(j,G=p(G,z,V,j,F,20,s[31]),z,V,P,4,s[32]),V=S(V,j,G,z,L,11,s[33]),z=S(z,V,j,G,x,16,s[34]),G=S(G,z,V,j,k,23,s[35]),j=S(j,G,z,V,E,4,s[36]),V=S(V,j,G,z,C,11,s[37]),z=S(z,V,j,G,B,16,s[38]),G=S(G,z,V,j,O,23,s[39]),j=S(j,G,z,V,N,4,s[40]),V=S(V,j,G,z,A,11,s[41]),z=S(z,V,j,G,w,16,s[42]),G=S(G,z,V,j,U,23,s[43]),j=S(j,G,z,V,H,4,s[44]),V=S(V,j,G,z,F,11,s[45]),z=S(z,V,j,G,M,16,s[46]),j=T(j,G=S(G,z,V,j,b,23,s[47]),z,V,A,6,s[48]),V=T(V,j,G,z,B,10,s[49]),z=T(z,V,j,G,k,15,s[50]),G=T(G,z,V,j,P,21,s[51]),j=T(j,G,z,V,F,6,s[52]),V=T(V,j,G,z,w,10,s[53]),z=T(z,V,j,G,O,15,s[54]),G=T(G,z,V,j,E,21,s[55]),j=T(j,G,z,V,L,6,s[56]),V=T(V,j,G,z,M,10,s[57]),z=T(z,V,j,G,U,15,s[58]),G=T(G,z,V,j,N,21,s[59]),j=T(j,G,z,V,C,6,s[60]),V=T(V,j,G,z,x,10,s[61]),z=T(z,V,j,G,b,15,s[62]),G=T(G,z,V,j,H,21,s[63]),_[0]=_[0]+j|0,_[1]=_[1]+G|0,_[2]=_[2]+z|0,_[3]=_[3]+V|0},_doFinalize:function(){var y=this._data,R=y.words,v=8*this._nDataBytes,h=8*y.sigBytes;R[h>>>5]|=128<<24-h%32;var m=e.floor(v/4294967296),_=v;R[15+(h+64>>>9<<4)]=16711935&(m<<8|m>>>24)|4278255360&(m<<24|m>>>8),R[14+(h+64>>>9<<4)]=16711935&(_<<8|_>>>24)|4278255360&(_<<24|_>>>8),y.sigBytes=4*(R.length+1),this._process();for(var A=this._hash,E=A.words,b=0;b<4;b++){var w=E[b];E[b]=16711935&(w<<8|w>>>24)|4278255360&(w<<24|w>>>8)}return A},clone:function(){var y=g.clone.call(this);return y._hash=this._hash.clone(),y}});function l(y,R,v,h,m,_,A){var E=y+(R&v|~R&h)+m+A;return(E<<_|E>>>32-_)+R}function p(y,R,v,h,m,_,A){var E=y+(R&h|v&~h)+m+A;return(E<<_|E>>>32-_)+R}function S(y,R,v,h,m,_,A){var E=y+(R^v^h)+m+A;return(E<<_|E>>>32-_)+R}function T(y,R,v,h,m,_,A){var E=y+(v^(R|~h))+m+A;return(E<<_|E>>>32-_)+R}n.MD5=g._createHelper(d),n.HmacMD5=g._createHmacHelper(d)})(Math),i.MD5})(At())),xv.exports}var Bv,Vv={exports:{}};function hS(){return Bv||(Bv=1,Vv.exports=(function(i){return n=(e=i).lib,o=n.WordArray,u=n.Hasher,g=e.algo,c=[],s=g.SHA1=u.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(d,l){for(var p=this._hash.words,S=p[0],T=p[1],y=p[2],R=p[3],v=p[4],h=0;h<80;h++){if(h<16)c[h]=0|d[l+h];else{var m=c[h-3]^c[h-8]^c[h-14]^c[h-16];c[h]=m<<1|m>>>31}var _=(S<<5|S>>>27)+v+c[h];_+=h<20?1518500249+(T&y|~T&R):h<40?1859775393+(T^y^R):h<60?(T&y|T&R|y&R)-1894007588:(T^y^R)-899497514,v=R,R=y,y=T<<30|T>>>2,T=S,S=_}p[0]=p[0]+S|0,p[1]=p[1]+T|0,p[2]=p[2]+y|0,p[3]=p[3]+R|0,p[4]=p[4]+v|0},_doFinalize:function(){var d=this._data,l=d.words,p=8*this._nDataBytes,S=8*d.sigBytes;return l[S>>>5]|=128<<24-S%32,l[14+(S+64>>>9<<4)]=Math.floor(p/4294967296),l[15+(S+64>>>9<<4)]=p,d.sigBytes=4*l.length,this._process(),this._hash},clone:function(){var d=u.clone.call(this);return d._hash=this._hash.clone(),d}}),e.SHA1=u._createHelper(s),e.HmacSHA1=u._createHmacHelper(s),i.SHA1;var e,n,o,u,g,c,s})(At())),Vv.exports}var Hv,jv={exports:{}};function Jd(){return Hv||(Hv=1,jv.exports=(function(i){return(function(e){var n=i,o=n.lib,u=o.WordArray,g=o.Hasher,c=n.algo,s=[],d=[];(function(){function S(v){for(var h=e.sqrt(v),m=2;m<=h;m++)if(!(v%m))return!1;return!0}function T(v){return 4294967296*(v-(0|v))|0}for(var y=2,R=0;R<64;)S(y)&&(R<8&&(s[R]=T(e.pow(y,.5))),d[R]=T(e.pow(y,1/3)),R++),y++})();var l=[],p=c.SHA256=g.extend({_doReset:function(){this._hash=new u.init(s.slice(0))},_doProcessBlock:function(S,T){for(var y=this._hash.words,R=y[0],v=y[1],h=y[2],m=y[3],_=y[4],A=y[5],E=y[6],b=y[7],w=0;w<64;w++){if(w<16)l[w]=0|S[T+w];else{var C=l[w-15],P=(C<<25|C>>>7)^(C<<14|C>>>18)^C>>>3,U=l[w-2],B=(U<<15|U>>>17)^(U<<13|U>>>19)^U>>>10;l[w]=P+l[w-7]+B+l[w-16]}var L=R&v^R&h^v&h,H=(R<<30|R>>>2)^(R<<19|R>>>13)^(R<<10|R>>>22),O=b+((_<<26|_>>>6)^(_<<21|_>>>11)^(_<<7|_>>>25))+(_&A^~_&E)+d[w]+l[w];b=E,E=A,A=_,_=m+O|0,m=h,h=v,v=R,R=O+(H+L)|0}y[0]=y[0]+R|0,y[1]=y[1]+v|0,y[2]=y[2]+h|0,y[3]=y[3]+m|0,y[4]=y[4]+_|0,y[5]=y[5]+A|0,y[6]=y[6]+E|0,y[7]=y[7]+b|0},_doFinalize:function(){var S=this._data,T=S.words,y=8*this._nDataBytes,R=8*S.sigBytes;return T[R>>>5]|=128<<24-R%32,T[14+(R+64>>>9<<4)]=e.floor(y/4294967296),T[15+(R+64>>>9<<4)]=y,S.sigBytes=4*T.length,this._process(),this._hash},clone:function(){var S=g.clone.call(this);return S._hash=this._hash.clone(),S}});n.SHA256=g._createHelper(p),n.HmacSHA256=g._createHmacHelper(p)})(Math),i.SHA256})(At())),jv.exports}var zv,Fv,Gv={exports:{}};function Wv(){return Fv||(Fv=1,Gv.exports=(function(i){return(function(){var e=i,n=e.lib.Hasher,o=e.x64,u=o.Word,g=o.WordArray,c=e.algo;function s(){return u.create.apply(u,arguments)}var d=[s(1116352408,3609767458),s(1899447441,602891725),s(3049323471,3964484399),s(3921009573,2173295548),s(961987163,4081628472),s(1508970993,3053834265),s(2453635748,2937671579),s(2870763221,3664609560),s(3624381080,2734883394),s(310598401,1164996542),s(607225278,1323610764),s(1426881987,3590304994),s(1925078388,4068182383),s(2162078206,991336113),s(2614888103,633803317),s(3248222580,3479774868),s(3835390401,2666613458),s(4022224774,944711139),s(264347078,2341262773),s(604807628,2007800933),s(770255983,1495990901),s(1249150122,1856431235),s(1555081692,3175218132),s(1996064986,2198950837),s(2554220882,3999719339),s(2821834349,766784016),s(2952996808,2566594879),s(3210313671,3203337956),s(3336571891,1034457026),s(3584528711,2466948901),s(113926993,3758326383),s(338241895,168717936),s(666307205,1188179964),s(773529912,1546045734),s(1294757372,1522805485),s(1396182291,2643833823),s(1695183700,2343527390),s(1986661051,1014477480),s(2177026350,1206759142),s(2456956037,344077627),s(2730485921,1290863460),s(2820302411,3158454273),s(3259730800,3505952657),s(3345764771,106217008),s(3516065817,3606008344),s(3600352804,1432725776),s(4094571909,1467031594),s(275423344,851169720),s(430227734,3100823752),s(506948616,1363258195),s(659060556,3750685593),s(883997877,3785050280),s(958139571,3318307427),s(1322822218,3812723403),s(1537002063,2003034995),s(1747873779,3602036899),s(1955562222,1575990012),s(2024104815,1125592928),s(2227730452,2716904306),s(2361852424,442776044),s(2428436474,593698344),s(2756734187,3733110249),s(3204031479,2999351573),s(3329325298,3815920427),s(3391569614,3928383900),s(3515267271,566280711),s(3940187606,3454069534),s(4118630271,4000239992),s(116418474,1914138554),s(174292421,2731055270),s(289380356,3203993006),s(460393269,320620315),s(685471733,587496836),s(852142971,1086792851),s(1017036298,365543100),s(1126000580,2618297676),s(1288033470,3409855158),s(1501505948,4234509866),s(1607167915,987167468),s(1816402316,1246189591)],l=[];(function(){for(var S=0;S<80;S++)l[S]=s()})();var p=c.SHA512=n.extend({_doReset:function(){this._hash=new g.init([new u.init(1779033703,4089235720),new u.init(3144134277,2227873595),new u.init(1013904242,4271175723),new u.init(2773480762,1595750129),new u.init(1359893119,2917565137),new u.init(2600822924,725511199),new u.init(528734635,4215389547),new u.init(1541459225,327033209)])},_doProcessBlock:function(S,T){for(var y=this._hash.words,R=y[0],v=y[1],h=y[2],m=y[3],_=y[4],A=y[5],E=y[6],b=y[7],w=R.high,C=R.low,P=v.high,U=v.low,B=h.high,L=h.low,H=m.high,O=m.low,x=_.high,F=_.low,N=A.high,k=A.low,M=E.high,j=E.low,G=b.high,z=b.low,V=w,re=C,Q=P,Z=U,q=B,Y=L,J=H,$=O,te=x,ie=F,se=N,he=k,de=M,be=j,Re=G,Te=z,Ae=0;Ae<80;Ae++){var Ie,Le,Be=l[Ae];if(Ae<16)Le=Be.high=0|S[T+2*Ae],Ie=Be.low=0|S[T+2*Ae+1];else{var $e=l[Ae-15],Ne=$e.high,ze=$e.low,Je=(Ne>>>1|ze<<31)^(Ne>>>8|ze<<24)^Ne>>>7,rt=(ze>>>1|Ne<<31)^(ze>>>8|Ne<<24)^(ze>>>7|Ne<<25),It=l[Ae-2],dt=It.high,Ct=It.low,_t=(dt>>>19|Ct<<13)^(dt<<3|Ct>>>29)^dt>>>6,ft=(Ct>>>19|dt<<13)^(Ct<<3|dt>>>29)^(Ct>>>6|dt<<26),pt=l[Ae-7],jt=pt.high,yt=pt.low,Nt=l[Ae-16],kt=Nt.high,fi=Nt.low;Le=(Le=(Le=Je+jt+((Ie=rt+yt)>>>0<rt>>>0?1:0))+_t+((Ie+=ft)>>>0<ft>>>0?1:0))+kt+((Ie+=fi)>>>0<fi>>>0?1:0),Be.high=Le,Be.low=Ie}var X,ae=te&se^~te&de,ne=ie&he^~ie&be,oe=V&Q^V&q^Q&q,fe=re&Z^re&Y^Z&Y,ve=(V>>>28|re<<4)^(V<<30|re>>>2)^(V<<25|re>>>7),le=(re>>>28|V<<4)^(re<<30|V>>>2)^(re<<25|V>>>7),Oe=(te>>>14|ie<<18)^(te>>>18|ie<<14)^(te<<23|ie>>>9),_e=(ie>>>14|te<<18)^(ie>>>18|te<<14)^(ie<<23|te>>>9),Ue=d[Ae],Fe=Ue.high,Ke=Ue.low,nt=Re+Oe+((X=Te+_e)>>>0<Te>>>0?1:0),Ni=le+fe;Re=de,Te=be,de=se,be=he,se=te,he=ie,te=J+(nt=(nt=(nt=nt+ae+((X+=ne)>>>0<ne>>>0?1:0))+Fe+((X+=Ke)>>>0<Ke>>>0?1:0))+Le+((X+=Ie)>>>0<Ie>>>0?1:0))+((ie=$+X|0)>>>0<$>>>0?1:0)|0,J=q,$=Y,q=Q,Y=Z,Q=V,Z=re,V=nt+(ve+oe+(Ni>>>0<le>>>0?1:0))+((re=X+Ni|0)>>>0<X>>>0?1:0)|0}C=R.low=C+re,R.high=w+V+(C>>>0<re>>>0?1:0),U=v.low=U+Z,v.high=P+Q+(U>>>0<Z>>>0?1:0),L=h.low=L+Y,h.high=B+q+(L>>>0<Y>>>0?1:0),O=m.low=O+$,m.high=H+J+(O>>>0<$>>>0?1:0),F=_.low=F+ie,_.high=x+te+(F>>>0<ie>>>0?1:0),k=A.low=k+he,A.high=N+se+(k>>>0<he>>>0?1:0),j=E.low=j+be,E.high=M+de+(j>>>0<be>>>0?1:0),z=b.low=z+Te,b.high=G+Re+(z>>>0<Te>>>0?1:0)},_doFinalize:function(){var S=this._data,T=S.words,y=8*this._nDataBytes,R=8*S.sigBytes;return T[R>>>5]|=128<<24-R%32,T[30+(R+128>>>10<<5)]=Math.floor(y/4294967296),T[31+(R+128>>>10<<5)]=y,S.sigBytes=4*T.length,this._process(),this._hash.toX32()},clone:function(){var S=n.clone.call(this);return S._hash=this._hash.clone(),S},blockSize:32});e.SHA512=n._createHelper(p),e.HmacSHA512=n._createHmacHelper(p)})(),i.SHA512})(At(),ll())),Gv.exports}var qv,Kv,Yv={exports:{}};function ZR(){return Kv||(Kv=1,Yv.exports=(function(i){return(function(e){var n=i,o=n.lib,u=o.WordArray,g=o.Hasher,c=n.x64.Word,s=n.algo,d=[],l=[],p=[];(function(){for(var y=1,R=0,v=0;v<24;v++){d[y+5*R]=(v+1)*(v+2)/2%64;var h=(2*y+3*R)%5;y=R%5,R=h}for(y=0;y<5;y++)for(R=0;R<5;R++)l[y+5*R]=R+(2*y+3*R)%5*5;for(var m=1,_=0;_<24;_++){for(var A=0,E=0,b=0;b<7;b++){if(1&m){var w=(1<<b)-1;w<32?E^=1<<w:A^=1<<w-32}128&m?m=m<<1^113:m<<=1}p[_]=c.create(A,E)}})();var S=[];(function(){for(var y=0;y<25;y++)S[y]=c.create()})();var T=s.SHA3=g.extend({cfg:g.cfg.extend({outputLength:512}),_doReset:function(){for(var y=this._state=[],R=0;R<25;R++)y[R]=new c.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(y,R){for(var v=this._state,h=this.blockSize/2,m=0;m<h;m++){var _=y[R+2*m],A=y[R+2*m+1];_=16711935&(_<<8|_>>>24)|4278255360&(_<<24|_>>>8),A=16711935&(A<<8|A>>>24)|4278255360&(A<<24|A>>>8),(z=v[m]).high^=A,z.low^=_}for(var E=0;E<24;E++){for(var b=0;b<5;b++){for(var w=0,C=0,P=0;P<5;P++)w^=(z=v[b+5*P]).high,C^=z.low;var U=S[b];U.high=w,U.low=C}for(b=0;b<5;b++){var B=S[(b+4)%5],L=S[(b+1)%5],H=L.high,O=L.low;for(w=B.high^(H<<1|O>>>31),C=B.low^(O<<1|H>>>31),P=0;P<5;P++)(z=v[b+5*P]).high^=w,z.low^=C}for(var x=1;x<25;x++){var F=(z=v[x]).high,N=z.low,k=d[x];k<32?(w=F<<k|N>>>32-k,C=N<<k|F>>>32-k):(w=N<<k-32|F>>>64-k,C=F<<k-32|N>>>64-k);var M=S[l[x]];M.high=w,M.low=C}var j=S[0],G=v[0];for(j.high=G.high,j.low=G.low,b=0;b<5;b++)for(P=0;P<5;P++){var z=v[x=b+5*P],V=S[x],re=S[(b+1)%5+5*P],Q=S[(b+2)%5+5*P];z.high=V.high^~re.high&Q.high,z.low=V.low^~re.low&Q.low}z=v[0];var Z=p[E];z.high^=Z.high,z.low^=Z.low}},_doFinalize:function(){var y=this._data,R=y.words;this._nDataBytes;var v=8*y.sigBytes,h=32*this.blockSize;R[v>>>5]|=1<<24-v%32,R[(e.ceil((v+1)/h)*h>>>5)-1]|=128,y.sigBytes=4*R.length,this._process();for(var m=this._state,_=this.cfg.outputLength/8,A=_/8,E=[],b=0;b<A;b++){var w=m[b],C=w.high,P=w.low;C=16711935&(C<<8|C>>>24)|4278255360&(C<<24|C>>>8),P=16711935&(P<<8|P>>>24)|4278255360&(P<<24|P>>>8),E.push(P),E.push(C)}return new u.init(E,_)},clone:function(){for(var y=g.clone.call(this),R=y._state=this._state.slice(0),v=0;v<25;v++)R[v]=R[v].clone();return y}});n.SHA3=g._createHelper(T),n.HmacSHA3=g._createHmacHelper(T)})(Math),i.SHA3})(At(),ll())),Yv.exports}var Xv,Jv,Qv={exports:{}};function Nh(){return Jv||(Jv=1,Qv.exports=(function(i){var e,n,o;n=(e=i).lib.Base,o=e.enc.Utf8,e.algo.HMAC=n.extend({init:function(u,g){u=this._hasher=new u.init,typeof g=="string"&&(g=o.parse(g));var c=u.blockSize,s=4*c;g.sigBytes>s&&(g=u.finalize(g)),g.clamp();for(var d=this._oKey=g.clone(),l=this._iKey=g.clone(),p=d.words,S=l.words,T=0;T<c;T++)p[T]^=1549556828,S[T]^=909522486;d.sigBytes=l.sigBytes=s,this.reset()},reset:function(){var u=this._hasher;u.reset(),u.update(this._iKey)},update:function(u){return this._hasher.update(u),this},finalize:function(u){var g=this._hasher,c=g.finalize(u);return g.reset(),g.finalize(this._oKey.clone().concat(c))}})})(At())),Qv.exports}var $v,Zv,e0={exports:{}};function Ln(){return Zv||(Zv=1,e0.exports=(function(i){return n=(e=i).lib,o=n.Base,u=n.WordArray,g=e.algo,c=g.MD5,s=g.EvpKDF=o.extend({cfg:o.extend({keySize:4,hasher:c,iterations:1}),init:function(d){this.cfg=this.cfg.extend(d)},compute:function(d,l){for(var p,S=this.cfg,T=S.hasher.create(),y=u.create(),R=y.words,v=S.keySize,h=S.iterations;R.length<v;){p&&T.update(p),p=T.update(d).finalize(l),T.reset();for(var m=1;m<h;m++)p=T.finalize(p),T.reset();y.concat(p)}return y.sigBytes=4*v,y}}),e.EvpKDF=function(d,l,p){return s.create(p).compute(d,l)},i.EvpKDF;var e,n,o,u,g,c,s})(At(),hS(),Nh())),e0.exports}var t0,i0={exports:{}};function bi(){return t0||(t0=1,i0.exports=(function(i){i.lib.Cipher||(function(e){var n=i,o=n.lib,u=o.Base,g=o.WordArray,c=o.BufferedBlockAlgorithm,s=n.enc;s.Utf8;var d=s.Base64,l=n.algo.EvpKDF,p=o.Cipher=c.extend({cfg:u.extend(),createEncryptor:function(E,b){return this.create(this._ENC_XFORM_MODE,E,b)},createDecryptor:function(E,b){return this.create(this._DEC_XFORM_MODE,E,b)},init:function(E,b,w){this.cfg=this.cfg.extend(w),this._xformMode=E,this._key=b,this.reset()},reset:function(){c.reset.call(this),this._doReset()},process:function(E){return this._append(E),this._process()},finalize:function(E){return E&&this._append(E),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:(function(){function E(b){return typeof b=="string"?A:m}return function(b){return{encrypt:function(w,C,P){return E(C).encrypt(b,w,C,P)},decrypt:function(w,C,P){return E(C).decrypt(b,w,C,P)}}}})()});o.StreamCipher=p.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var S=n.mode={},T=o.BlockCipherMode=u.extend({createEncryptor:function(E,b){return this.Encryptor.create(E,b)},createDecryptor:function(E,b){return this.Decryptor.create(E,b)},init:function(E,b){this._cipher=E,this._iv=b}}),y=S.CBC=(function(){var E=T.extend();function b(w,C,P){var U,B=this._iv;B?(U=B,this._iv=e):U=this._prevBlock;for(var L=0;L<P;L++)w[C+L]^=U[L]}return E.Encryptor=E.extend({processBlock:function(w,C){var P=this._cipher,U=P.blockSize;b.call(this,w,C,U),P.encryptBlock(w,C),this._prevBlock=w.slice(C,C+U)}}),E.Decryptor=E.extend({processBlock:function(w,C){var P=this._cipher,U=P.blockSize,B=w.slice(C,C+U);P.decryptBlock(w,C),b.call(this,w,C,U),this._prevBlock=B}}),E})(),R=(n.pad={}).Pkcs7={pad:function(E,b){for(var w=4*b,C=w-E.sigBytes%w,P=C<<24|C<<16|C<<8|C,U=[],B=0;B<C;B+=4)U.push(P);var L=g.create(U,C);E.concat(L)},unpad:function(E){var b=255&E.words[E.sigBytes-1>>>2];E.sigBytes-=b}};o.BlockCipher=p.extend({cfg:p.cfg.extend({mode:y,padding:R}),reset:function(){var E;p.reset.call(this);var b=this.cfg,w=b.iv,C=b.mode;this._xformMode==this._ENC_XFORM_MODE?E=C.createEncryptor:(E=C.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==E?this._mode.init(this,w&&w.words):(this._mode=E.call(C,this,w&&w.words),this._mode.__creator=E)},_doProcessBlock:function(E,b){this._mode.processBlock(E,b)},_doFinalize:function(){var E,b=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(b.pad(this._data,this.blockSize),E=this._process(!0)):(E=this._process(!0),b.unpad(E)),E},blockSize:4});var v=o.CipherParams=u.extend({init:function(E){this.mixIn(E)},toString:function(E){return(E||this.formatter).stringify(this)}}),h=(n.format={}).OpenSSL={stringify:function(E){var b=E.ciphertext,w=E.salt;return(w?g.create([1398893684,1701076831]).concat(w).concat(b):b).toString(d)},parse:function(E){var b,w=d.parse(E),C=w.words;return C[0]==1398893684&&C[1]==1701076831&&(b=g.create(C.slice(2,4)),C.splice(0,4),w.sigBytes-=16),v.create({ciphertext:w,salt:b})}},m=o.SerializableCipher=u.extend({cfg:u.extend({format:h}),encrypt:function(E,b,w,C){C=this.cfg.extend(C);var P=E.createEncryptor(w,C),U=P.finalize(b),B=P.cfg;return v.create({ciphertext:U,key:w,iv:B.iv,algorithm:E,mode:B.mode,padding:B.padding,blockSize:E.blockSize,formatter:C.format})},decrypt:function(E,b,w,C){return C=this.cfg.extend(C),b=this._parse(b,C.format),E.createDecryptor(w,C).finalize(b.ciphertext)},_parse:function(E,b){return typeof E=="string"?b.parse(E,this):E}}),_=(n.kdf={}).OpenSSL={execute:function(E,b,w,C,P){if(C||(C=g.random(8)),P)U=l.create({keySize:b+w,hasher:P}).compute(E,C);else var U=l.create({keySize:b+w}).compute(E,C);var B=g.create(U.words.slice(b),4*w);return U.sigBytes=4*b,v.create({key:U,iv:B,salt:C})}},A=o.PasswordBasedCipher=m.extend({cfg:m.cfg.extend({kdf:_}),encrypt:function(E,b,w,C){var P=(C=this.cfg.extend(C)).kdf.execute(w,E.keySize,E.ivSize,C.salt,C.hasher);C.iv=P.iv;var U=m.encrypt.call(this,E,b,P.key,C);return U.mixIn(P),U},decrypt:function(E,b,w,C){C=this.cfg.extend(C),b=this._parse(b,C.format);var P=C.kdf.execute(w,E.keySize,E.ivSize,b.salt,C.hasher);return C.iv=P.iv,m.decrypt.call(this,E,b,P.key,C)}})})()})(At(),Ln())),i0.exports}var r0,n0={exports:{}};function e_(){return r0||(r0=1,n0.exports=(function(i){return i.mode.CFB=(function(){var e=i.lib.BlockCipherMode.extend();function n(o,u,g,c){var s,d=this._iv;d?(s=d.slice(0),this._iv=void 0):s=this._prevBlock,c.encryptBlock(s,0);for(var l=0;l<g;l++)o[u+l]^=s[l]}return e.Encryptor=e.extend({processBlock:function(o,u){var g=this._cipher,c=g.blockSize;n.call(this,o,u,c,g),this._prevBlock=o.slice(u,u+c)}}),e.Decryptor=e.extend({processBlock:function(o,u){var g=this._cipher,c=g.blockSize,s=o.slice(u,u+c);n.call(this,o,u,c,g),this._prevBlock=s}}),e})(),i.mode.CFB})(At(),bi())),n0.exports}var o0,a0={exports:{}};function t_(){return o0||(o0=1,a0.exports=(function(i){return i.mode.CTR=(e=i.lib.BlockCipherMode.extend(),n=e.Encryptor=e.extend({processBlock:function(o,u){var g=this._cipher,c=g.blockSize,s=this._iv,d=this._counter;s&&(d=this._counter=s.slice(0),this._iv=void 0);var l=d.slice(0);g.encryptBlock(l,0),d[c-1]=d[c-1]+1|0;for(var p=0;p<c;p++)o[u+p]^=l[p]}}),e.Decryptor=n,e),i.mode.CTR;var e,n})(At(),bi())),a0.exports}var s0,c0={exports:{}};function i_(){return s0||(s0=1,c0.exports=(function(i){return i.mode.CTRGladman=(function(){var e=i.lib.BlockCipherMode.extend();function n(g){if(255&~(g>>24))g+=1<<24;else{var c=g>>16&255,s=g>>8&255,d=255&g;c===255?(c=0,s===255?(s=0,d===255?d=0:++d):++s):++c,g=0,g+=c<<16,g+=s<<8,g+=d}return g}function o(g){return(g[0]=n(g[0]))===0&&(g[1]=n(g[1])),g}var u=e.Encryptor=e.extend({processBlock:function(g,c){var s=this._cipher,d=s.blockSize,l=this._iv,p=this._counter;l&&(p=this._counter=l.slice(0),this._iv=void 0),o(p);var S=p.slice(0);s.encryptBlock(S,0);for(var T=0;T<d;T++)g[c+T]^=S[T]}});return e.Decryptor=u,e})(),i.mode.CTRGladman})(At(),bi())),c0.exports}var l0,u0={exports:{}};function r_(){return l0||(l0=1,u0.exports=(function(i){return i.mode.OFB=(e=i.lib.BlockCipherMode.extend(),n=e.Encryptor=e.extend({processBlock:function(o,u){var g=this._cipher,c=g.blockSize,s=this._iv,d=this._keystream;s&&(d=this._keystream=s.slice(0),this._iv=void 0),g.encryptBlock(d,0);for(var l=0;l<c;l++)o[u+l]^=d[l]}}),e.Decryptor=n,e),i.mode.OFB;var e,n})(At(),bi())),u0.exports}var d0,h0,f0,p0,m0,g0,v0,y0,S0,b0={exports:{}};function n_(){return S0||(S0=1,b0.exports=(function(i){return(function(){var e=i,n=e.lib,o=n.WordArray,u=n.BlockCipher,g=e.algo,c=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],s=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],d=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],l=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],p=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],S=g.DES=u.extend({_doReset:function(){for(var v=this._key.words,h=[],m=0;m<56;m++){var _=c[m]-1;h[m]=v[_>>>5]>>>31-_%32&1}for(var A=this._subKeys=[],E=0;E<16;E++){var b=A[E]=[],w=d[E];for(m=0;m<24;m++)b[m/6|0]|=h[(s[m]-1+w)%28]<<31-m%6,b[4+(m/6|0)]|=h[28+(s[m+24]-1+w)%28]<<31-m%6;for(b[0]=b[0]<<1|b[0]>>>31,m=1;m<7;m++)b[m]=b[m]>>>4*(m-1)+3;b[7]=b[7]<<5|b[7]>>>27}var C=this._invSubKeys=[];for(m=0;m<16;m++)C[m]=A[15-m]},encryptBlock:function(v,h){this._doCryptBlock(v,h,this._subKeys)},decryptBlock:function(v,h){this._doCryptBlock(v,h,this._invSubKeys)},_doCryptBlock:function(v,h,m){this._lBlock=v[h],this._rBlock=v[h+1],T.call(this,4,252645135),T.call(this,16,65535),y.call(this,2,858993459),y.call(this,8,16711935),T.call(this,1,1431655765);for(var _=0;_<16;_++){for(var A=m[_],E=this._lBlock,b=this._rBlock,w=0,C=0;C<8;C++)w|=l[C][((b^A[C])&p[C])>>>0];this._lBlock=b,this._rBlock=E^w}var P=this._lBlock;this._lBlock=this._rBlock,this._rBlock=P,T.call(this,1,1431655765),y.call(this,8,16711935),y.call(this,2,858993459),T.call(this,16,65535),T.call(this,4,252645135),v[h]=this._lBlock,v[h+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function T(v,h){var m=(this._lBlock>>>v^this._rBlock)&h;this._rBlock^=m,this._lBlock^=m<<v}function y(v,h){var m=(this._rBlock>>>v^this._lBlock)&h;this._lBlock^=m,this._rBlock^=m<<v}e.DES=u._createHelper(S);var R=g.TripleDES=u.extend({_doReset:function(){var v=this._key.words;if(v.length!==2&&v.length!==4&&v.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var h=v.slice(0,2),m=v.length<4?v.slice(0,2):v.slice(2,4),_=v.length<6?v.slice(0,2):v.slice(4,6);this._des1=S.createEncryptor(o.create(h)),this._des2=S.createEncryptor(o.create(m)),this._des3=S.createEncryptor(o.create(_))},encryptBlock:function(v,h){this._des1.encryptBlock(v,h),this._des2.decryptBlock(v,h),this._des3.encryptBlock(v,h)},decryptBlock:function(v,h){this._des3.decryptBlock(v,h),this._des2.encryptBlock(v,h),this._des1.decryptBlock(v,h)},keySize:6,ivSize:2,blockSize:2});e.TripleDES=u._createHelper(R)})(),i.TripleDES})(At(),ho(),fo(),Ln(),bi())),b0.exports}var E0,R0,_0,T0,A0={exports:{}};function o_(){return T0||(T0=1,A0.exports=(function(i){return(function(){var e=i,n=e.lib.BlockCipher,o=e.algo;const u=16,g=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],c=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var s={pbox:[],sbox:[]};function d(y,R){let v=R>>24&255,h=R>>16&255,m=R>>8&255,_=255&R,A=y.sbox[0][v]+y.sbox[1][h];return A^=y.sbox[2][m],A+=y.sbox[3][_],A}function l(y,R,v){let h,m=R,_=v;for(let A=0;A<u;++A)m^=y.pbox[A],_=d(y,m)^_,h=m,m=_,_=h;return h=m,m=_,_=h,_^=y.pbox[u],m^=y.pbox[u+1],{left:m,right:_}}function p(y,R,v){let h,m=R,_=v;for(let A=u+1;A>1;--A)m^=y.pbox[A],_=d(y,m)^_,h=m,m=_,_=h;return h=m,m=_,_=h,_^=y.pbox[1],m^=y.pbox[0],{left:m,right:_}}function S(y,R,v){for(let E=0;E<4;E++){y.sbox[E]=[];for(let b=0;b<256;b++)y.sbox[E][b]=c[E][b]}let h=0;for(let E=0;E<u+2;E++)y.pbox[E]=g[E]^R[h],h++,h>=v&&(h=0);let m=0,_=0,A=0;for(let E=0;E<u+2;E+=2)A=l(y,m,_),m=A.left,_=A.right,y.pbox[E]=m,y.pbox[E+1]=_;for(let E=0;E<4;E++)for(let b=0;b<256;b+=2)A=l(y,m,_),m=A.left,_=A.right,y.sbox[E][b]=m,y.sbox[E][b+1]=_;return!0}var T=o.Blowfish=n.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var y=this._keyPriorReset=this._key,R=y.words,v=y.sigBytes/4;S(s,R,v)}},encryptBlock:function(y,R){var v=l(s,y[R],y[R+1]);y[R]=v.left,y[R+1]=v.right},decryptBlock:function(y,R){var v=p(s,y[R],y[R+1]);y[R]=v.left,y[R+1]=v.right},blockSize:2,keySize:4,ivSize:2});e.Blowfish=n._createHelper(T)})(),i.Blowfish})(At(),ho(),fo(),Ln(),bi())),A0.exports}dS.exports=(function(i){return i})(At(),ll(),JR(),QR(),ho(),$R(),fo(),hS(),Jd(),zv||(zv=1,(function(i){return n=(e=i).lib.WordArray,o=e.algo,u=o.SHA256,g=o.SHA224=u.extend({_doReset:function(){this._hash=new n.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var c=u._doFinalize.call(this);return c.sigBytes-=4,c}}),e.SHA224=u._createHelper(g),e.HmacSHA224=u._createHmacHelper(g),i.SHA224;var e,n,o,u,g})(At(),Jd())),Wv(),qv||(qv=1,(function(i){return n=(e=i).x64,o=n.Word,u=n.WordArray,g=e.algo,c=g.SHA512,s=g.SHA384=c.extend({_doReset:function(){this._hash=new u.init([new o.init(3418070365,3238371032),new o.init(1654270250,914150663),new o.init(2438529370,812702999),new o.init(355462360,4144912697),new o.init(1731405415,4290775857),new o.init(2394180231,1750603025),new o.init(3675008525,1694076839),new o.init(1203062813,3204075428)])},_doFinalize:function(){var d=c._doFinalize.call(this);return d.sigBytes-=16,d}}),e.SHA384=c._createHelper(s),e.HmacSHA384=c._createHmacHelper(s),i.SHA384;var e,n,o,u,g,c,s})(At(),ll(),Wv())),ZR(),Xv||(Xv=1,(function(i){return(function(){var e=i,n=e.lib,o=n.WordArray,u=n.Hasher,g=e.algo,c=o.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),s=o.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),d=o.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),l=o.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),p=o.create([0,1518500249,1859775393,2400959708,2840853838]),S=o.create([1352829926,1548603684,1836072691,2053994217,0]),T=g.RIPEMD160=u.extend({_doReset:function(){this._hash=o.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(A,E){for(var b=0;b<16;b++){var w=E+b,C=A[w];A[w]=16711935&(C<<8|C>>>24)|4278255360&(C<<24|C>>>8)}var P,U,B,L,H,O,x,F,N,k,M,j=this._hash.words,G=p.words,z=S.words,V=c.words,re=s.words,Q=d.words,Z=l.words;for(O=P=j[0],x=U=j[1],F=B=j[2],N=L=j[3],k=H=j[4],b=0;b<80;b+=1)M=P+A[E+V[b]]|0,M+=b<16?y(U,B,L)+G[0]:b<32?R(U,B,L)+G[1]:b<48?v(U,B,L)+G[2]:b<64?h(U,B,L)+G[3]:m(U,B,L)+G[4],M=(M=_(M|=0,Q[b]))+H|0,P=H,H=L,L=_(B,10),B=U,U=M,M=O+A[E+re[b]]|0,M+=b<16?m(x,F,N)+z[0]:b<32?h(x,F,N)+z[1]:b<48?v(x,F,N)+z[2]:b<64?R(x,F,N)+z[3]:y(x,F,N)+z[4],M=(M=_(M|=0,Z[b]))+k|0,O=k,k=N,N=_(F,10),F=x,x=M;M=j[1]+B+N|0,j[1]=j[2]+L+k|0,j[2]=j[3]+H+O|0,j[3]=j[4]+P+x|0,j[4]=j[0]+U+F|0,j[0]=M},_doFinalize:function(){var A=this._data,E=A.words,b=8*this._nDataBytes,w=8*A.sigBytes;E[w>>>5]|=128<<24-w%32,E[14+(w+64>>>9<<4)]=16711935&(b<<8|b>>>24)|4278255360&(b<<24|b>>>8),A.sigBytes=4*(E.length+1),this._process();for(var C=this._hash,P=C.words,U=0;U<5;U++){var B=P[U];P[U]=16711935&(B<<8|B>>>24)|4278255360&(B<<24|B>>>8)}return C},clone:function(){var A=u.clone.call(this);return A._hash=this._hash.clone(),A}});function y(A,E,b){return A^E^b}function R(A,E,b){return A&E|~A&b}function v(A,E,b){return(A|~E)^b}function h(A,E,b){return A&b|E&~b}function m(A,E,b){return A^(E|~b)}function _(A,E){return A<<E|A>>>32-E}e.RIPEMD160=u._createHelper(T),e.HmacRIPEMD160=u._createHmacHelper(T)})(),i.RIPEMD160})(At())),Nh(),$v||($v=1,(function(i){return o=(n=(e=i).lib).Base,u=n.WordArray,c=(g=e.algo).SHA256,s=g.HMAC,d=g.PBKDF2=o.extend({cfg:o.extend({keySize:4,hasher:c,iterations:25e4}),init:function(l){this.cfg=this.cfg.extend(l)},compute:function(l,p){for(var S=this.cfg,T=s.create(S.hasher,l),y=u.create(),R=u.create([1]),v=y.words,h=R.words,m=S.keySize,_=S.iterations;v.length<m;){var A=T.update(p).finalize(R);T.reset();for(var E=A.words,b=E.length,w=A,C=1;C<_;C++){w=T.finalize(w),T.reset();for(var P=w.words,U=0;U<b;U++)E[U]^=P[U]}y.concat(A),h[0]++}return y.sigBytes=4*m,y}}),e.PBKDF2=function(l,p,S){return d.create(S).compute(l,p)},i.PBKDF2;var e,n,o,u,g,c,s,d})(At(),Jd(),Nh())),Ln(),bi(),e_(),t_(),i_(),r_(),d0||(d0=1,(function(i){return i.mode.ECB=((e=i.lib.BlockCipherMode.extend()).Encryptor=e.extend({processBlock:function(n,o){this._cipher.encryptBlock(n,o)}}),e.Decryptor=e.extend({processBlock:function(n,o){this._cipher.decryptBlock(n,o)}}),e),i.mode.ECB;var e})(At(),bi())),h0||(h0=1,(function(i){return i.pad.AnsiX923={pad:function(e,n){var o=e.sigBytes,u=4*n,g=u-o%u,c=o+g-1;e.clamp(),e.words[c>>>2]|=g<<24-c%4*8,e.sigBytes+=g},unpad:function(e){var n=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=n}},i.pad.Ansix923})(At(),bi())),f0||(f0=1,(function(i){return i.pad.Iso10126={pad:function(e,n){var o=4*n,u=o-e.sigBytes%o;e.concat(i.lib.WordArray.random(u-1)).concat(i.lib.WordArray.create([u<<24],1))},unpad:function(e){var n=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=n}},i.pad.Iso10126})(At(),bi())),p0||(p0=1,(function(i){return i.pad.Iso97971={pad:function(e,n){e.concat(i.lib.WordArray.create([2147483648],1)),i.pad.ZeroPadding.pad(e,n)},unpad:function(e){i.pad.ZeroPadding.unpad(e),e.sigBytes--}},i.pad.Iso97971})(At(),bi())),m0||(m0=1,(function(i){return i.pad.ZeroPadding={pad:function(e,n){var o=4*n;e.clamp(),e.sigBytes+=o-(e.sigBytes%o||o)},unpad:function(e){var n=e.words,o=e.sigBytes-1;for(o=e.sigBytes-1;o>=0;o--)if(n[o>>>2]>>>24-o%4*8&255){e.sigBytes=o+1;break}}},i.pad.ZeroPadding})(At(),bi())),g0||(g0=1,(function(i){return i.pad.NoPadding={pad:function(){},unpad:function(){}},i.pad.NoPadding})(At(),bi())),v0||(v0=1,(function(i){return n=(e=i).lib.CipherParams,o=e.enc.Hex,e.format.Hex={stringify:function(u){return u.ciphertext.toString(o)},parse:function(u){var g=o.parse(u);return n.create({ciphertext:g})}},i.format.Hex;var e,n,o})(At(),bi())),y0||(y0=1,(function(i){return(function(){var e=i,n=e.lib.BlockCipher,o=e.algo,u=[],g=[],c=[],s=[],d=[],l=[],p=[],S=[],T=[],y=[];(function(){for(var h=[],m=0;m<256;m++)h[m]=m<128?m<<1:m<<1^283;var _=0,A=0;for(m=0;m<256;m++){var E=A^A<<1^A<<2^A<<3^A<<4;E=E>>>8^255&E^99,u[_]=E,g[E]=_;var b=h[_],w=h[b],C=h[w],P=257*h[E]^16843008*E;c[_]=P<<24|P>>>8,s[_]=P<<16|P>>>16,d[_]=P<<8|P>>>24,l[_]=P,P=16843009*C^65537*w^257*b^16843008*_,p[E]=P<<24|P>>>8,S[E]=P<<16|P>>>16,T[E]=P<<8|P>>>24,y[E]=P,_?(_=b^h[h[h[C^b]]],A^=h[h[A]]):_=A=1}})();var R=[0,1,2,4,8,16,32,64,128,27,54],v=o.AES=n.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var h=this._keyPriorReset=this._key,m=h.words,_=h.sigBytes/4,A=4*((this._nRounds=_+6)+1),E=this._keySchedule=[],b=0;b<A;b++)b<_?E[b]=m[b]:(P=E[b-1],b%_?_>6&&b%_==4&&(P=u[P>>>24]<<24|u[P>>>16&255]<<16|u[P>>>8&255]<<8|u[255&P]):(P=u[(P=P<<8|P>>>24)>>>24]<<24|u[P>>>16&255]<<16|u[P>>>8&255]<<8|u[255&P],P^=R[b/_|0]<<24),E[b]=E[b-_]^P);for(var w=this._invKeySchedule=[],C=0;C<A;C++){if(b=A-C,C%4)var P=E[b];else P=E[b-4];w[C]=C<4||b<=4?P:p[u[P>>>24]]^S[u[P>>>16&255]]^T[u[P>>>8&255]]^y[u[255&P]]}}},encryptBlock:function(h,m){this._doCryptBlock(h,m,this._keySchedule,c,s,d,l,u)},decryptBlock:function(h,m){var _=h[m+1];h[m+1]=h[m+3],h[m+3]=_,this._doCryptBlock(h,m,this._invKeySchedule,p,S,T,y,g),_=h[m+1],h[m+1]=h[m+3],h[m+3]=_},_doCryptBlock:function(h,m,_,A,E,b,w,C){for(var P=this._nRounds,U=h[m]^_[0],B=h[m+1]^_[1],L=h[m+2]^_[2],H=h[m+3]^_[3],O=4,x=1;x<P;x++){var F=A[U>>>24]^E[B>>>16&255]^b[L>>>8&255]^w[255&H]^_[O++],N=A[B>>>24]^E[L>>>16&255]^b[H>>>8&255]^w[255&U]^_[O++],k=A[L>>>24]^E[H>>>16&255]^b[U>>>8&255]^w[255&B]^_[O++],M=A[H>>>24]^E[U>>>16&255]^b[B>>>8&255]^w[255&L]^_[O++];U=F,B=N,L=k,H=M}F=(C[U>>>24]<<24|C[B>>>16&255]<<16|C[L>>>8&255]<<8|C[255&H])^_[O++],N=(C[B>>>24]<<24|C[L>>>16&255]<<16|C[H>>>8&255]<<8|C[255&U])^_[O++],k=(C[L>>>24]<<24|C[H>>>16&255]<<16|C[U>>>8&255]<<8|C[255&B])^_[O++],M=(C[H>>>24]<<24|C[U>>>16&255]<<16|C[B>>>8&255]<<8|C[255&L])^_[O++],h[m]=F,h[m+1]=N,h[m+2]=k,h[m+3]=M},keySize:8});e.AES=n._createHelper(v)})(),i.AES})(At(),ho(),fo(),Ln(),bi())),n_(),E0||(E0=1,(function(i){return(function(){var e=i,n=e.lib.StreamCipher,o=e.algo,u=o.RC4=n.extend({_doReset:function(){for(var s=this._key,d=s.words,l=s.sigBytes,p=this._S=[],S=0;S<256;S++)p[S]=S;S=0;for(var T=0;S<256;S++){var y=S%l,R=d[y>>>2]>>>24-y%4*8&255;T=(T+p[S]+R)%256;var v=p[S];p[S]=p[T],p[T]=v}this._i=this._j=0},_doProcessBlock:function(s,d){s[d]^=g.call(this)},keySize:8,ivSize:0});function g(){for(var s=this._S,d=this._i,l=this._j,p=0,S=0;S<4;S++){l=(l+s[d=(d+1)%256])%256;var T=s[d];s[d]=s[l],s[l]=T,p|=s[(s[d]+s[l])%256]<<24-8*S}return this._i=d,this._j=l,p}e.RC4=n._createHelper(u);var c=o.RC4Drop=u.extend({cfg:u.cfg.extend({drop:192}),_doReset:function(){u._doReset.call(this);for(var s=this.cfg.drop;s>0;s--)g.call(this)}});e.RC4Drop=n._createHelper(c)})(),i.RC4})(At(),ho(),fo(),Ln(),bi())),R0||(R0=1,(function(i){return(function(){var e=i,n=e.lib.StreamCipher,o=e.algo,u=[],g=[],c=[],s=o.Rabbit=n.extend({_doReset:function(){for(var l=this._key.words,p=this.cfg.iv,S=0;S<4;S++)l[S]=16711935&(l[S]<<8|l[S]>>>24)|4278255360&(l[S]<<24|l[S]>>>8);var T=this._X=[l[0],l[3]<<16|l[2]>>>16,l[1],l[0]<<16|l[3]>>>16,l[2],l[1]<<16|l[0]>>>16,l[3],l[2]<<16|l[1]>>>16],y=this._C=[l[2]<<16|l[2]>>>16,4294901760&l[0]|65535&l[1],l[3]<<16|l[3]>>>16,4294901760&l[1]|65535&l[2],l[0]<<16|l[0]>>>16,4294901760&l[2]|65535&l[3],l[1]<<16|l[1]>>>16,4294901760&l[3]|65535&l[0]];for(this._b=0,S=0;S<4;S++)d.call(this);for(S=0;S<8;S++)y[S]^=T[S+4&7];if(p){var R=p.words,v=R[0],h=R[1],m=16711935&(v<<8|v>>>24)|4278255360&(v<<24|v>>>8),_=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8),A=m>>>16|4294901760&_,E=_<<16|65535&m;for(y[0]^=m,y[1]^=A,y[2]^=_,y[3]^=E,y[4]^=m,y[5]^=A,y[6]^=_,y[7]^=E,S=0;S<4;S++)d.call(this)}},_doProcessBlock:function(l,p){var S=this._X;d.call(this),u[0]=S[0]^S[5]>>>16^S[3]<<16,u[1]=S[2]^S[7]>>>16^S[5]<<16,u[2]=S[4]^S[1]>>>16^S[7]<<16,u[3]=S[6]^S[3]>>>16^S[1]<<16;for(var T=0;T<4;T++)u[T]=16711935&(u[T]<<8|u[T]>>>24)|4278255360&(u[T]<<24|u[T]>>>8),l[p+T]^=u[T]},blockSize:4,ivSize:2});function d(){for(var l=this._X,p=this._C,S=0;S<8;S++)g[S]=p[S];for(p[0]=p[0]+1295307597+this._b|0,p[1]=p[1]+3545052371+(p[0]>>>0<g[0]>>>0?1:0)|0,p[2]=p[2]+886263092+(p[1]>>>0<g[1]>>>0?1:0)|0,p[3]=p[3]+1295307597+(p[2]>>>0<g[2]>>>0?1:0)|0,p[4]=p[4]+3545052371+(p[3]>>>0<g[3]>>>0?1:0)|0,p[5]=p[5]+886263092+(p[4]>>>0<g[4]>>>0?1:0)|0,p[6]=p[6]+1295307597+(p[5]>>>0<g[5]>>>0?1:0)|0,p[7]=p[7]+3545052371+(p[6]>>>0<g[6]>>>0?1:0)|0,this._b=p[7]>>>0<g[7]>>>0?1:0,S=0;S<8;S++){var T=l[S]+p[S],y=65535&T,R=T>>>16,v=((y*y>>>17)+y*R>>>15)+R*R,h=((4294901760&T)*T|0)+((65535&T)*T|0);c[S]=v^h}l[0]=c[0]+(c[7]<<16|c[7]>>>16)+(c[6]<<16|c[6]>>>16)|0,l[1]=c[1]+(c[0]<<8|c[0]>>>24)+c[7]|0,l[2]=c[2]+(c[1]<<16|c[1]>>>16)+(c[0]<<16|c[0]>>>16)|0,l[3]=c[3]+(c[2]<<8|c[2]>>>24)+c[1]|0,l[4]=c[4]+(c[3]<<16|c[3]>>>16)+(c[2]<<16|c[2]>>>16)|0,l[5]=c[5]+(c[4]<<8|c[4]>>>24)+c[3]|0,l[6]=c[6]+(c[5]<<16|c[5]>>>16)+(c[4]<<16|c[4]>>>16)|0,l[7]=c[7]+(c[6]<<8|c[6]>>>24)+c[5]|0}e.Rabbit=n._createHelper(s)})(),i.Rabbit})(At(),ho(),fo(),Ln(),bi())),_0||(_0=1,(function(i){return(function(){var e=i,n=e.lib.StreamCipher,o=e.algo,u=[],g=[],c=[],s=o.RabbitLegacy=n.extend({_doReset:function(){var l=this._key.words,p=this.cfg.iv,S=this._X=[l[0],l[3]<<16|l[2]>>>16,l[1],l[0]<<16|l[3]>>>16,l[2],l[1]<<16|l[0]>>>16,l[3],l[2]<<16|l[1]>>>16],T=this._C=[l[2]<<16|l[2]>>>16,4294901760&l[0]|65535&l[1],l[3]<<16|l[3]>>>16,4294901760&l[1]|65535&l[2],l[0]<<16|l[0]>>>16,4294901760&l[2]|65535&l[3],l[1]<<16|l[1]>>>16,4294901760&l[3]|65535&l[0]];this._b=0;for(var y=0;y<4;y++)d.call(this);for(y=0;y<8;y++)T[y]^=S[y+4&7];if(p){var R=p.words,v=R[0],h=R[1],m=16711935&(v<<8|v>>>24)|4278255360&(v<<24|v>>>8),_=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8),A=m>>>16|4294901760&_,E=_<<16|65535&m;for(T[0]^=m,T[1]^=A,T[2]^=_,T[3]^=E,T[4]^=m,T[5]^=A,T[6]^=_,T[7]^=E,y=0;y<4;y++)d.call(this)}},_doProcessBlock:function(l,p){var S=this._X;d.call(this),u[0]=S[0]^S[5]>>>16^S[3]<<16,u[1]=S[2]^S[7]>>>16^S[5]<<16,u[2]=S[4]^S[1]>>>16^S[7]<<16,u[3]=S[6]^S[3]>>>16^S[1]<<16;for(var T=0;T<4;T++)u[T]=16711935&(u[T]<<8|u[T]>>>24)|4278255360&(u[T]<<24|u[T]>>>8),l[p+T]^=u[T]},blockSize:4,ivSize:2});function d(){for(var l=this._X,p=this._C,S=0;S<8;S++)g[S]=p[S];for(p[0]=p[0]+1295307597+this._b|0,p[1]=p[1]+3545052371+(p[0]>>>0<g[0]>>>0?1:0)|0,p[2]=p[2]+886263092+(p[1]>>>0<g[1]>>>0?1:0)|0,p[3]=p[3]+1295307597+(p[2]>>>0<g[2]>>>0?1:0)|0,p[4]=p[4]+3545052371+(p[3]>>>0<g[3]>>>0?1:0)|0,p[5]=p[5]+886263092+(p[4]>>>0<g[4]>>>0?1:0)|0,p[6]=p[6]+1295307597+(p[5]>>>0<g[5]>>>0?1:0)|0,p[7]=p[7]+3545052371+(p[6]>>>0<g[6]>>>0?1:0)|0,this._b=p[7]>>>0<g[7]>>>0?1:0,S=0;S<8;S++){var T=l[S]+p[S],y=65535&T,R=T>>>16,v=((y*y>>>17)+y*R>>>15)+R*R,h=((4294901760&T)*T|0)+((65535&T)*T|0);c[S]=v^h}l[0]=c[0]+(c[7]<<16|c[7]>>>16)+(c[6]<<16|c[6]>>>16)|0,l[1]=c[1]+(c[0]<<8|c[0]>>>24)+c[7]|0,l[2]=c[2]+(c[1]<<16|c[1]>>>16)+(c[0]<<16|c[0]>>>16)|0,l[3]=c[3]+(c[2]<<8|c[2]>>>24)+c[1]|0,l[4]=c[4]+(c[3]<<16|c[3]>>>16)+(c[2]<<16|c[2]>>>16)|0,l[5]=c[5]+(c[4]<<8|c[4]>>>24)+c[3]|0,l[6]=c[6]+(c[5]<<16|c[5]>>>16)+(c[4]<<16|c[4]>>>16)|0,l[7]=c[7]+(c[6]<<8|c[6]>>>24)+c[5]|0}e.RabbitLegacy=n._createHelper(s)})(),i.RabbitLegacy})(At(),ho(),fo(),Ln(),bi())),o_());const ms=KR(dS.exports);function a_(i){return e=this,n=null,o=function*(){const u=new Date;if(i.refreshSTSTokenInterval||(i.refreshSTSTokenInterval=3e5),!i.stsTokenFreshTime||+u-i.stsTokenFreshTime>=i.refreshSTSTokenInterval){i.stsTokenFreshTime=u;try{yield i.refreshSTSToken()}catch(g){typeof console.error=="function"&&console.error(`Some error occured during excuting refreshSTSToken, see:
`+g)}}return null},new Promise((u,g)=>{var c=l=>{try{d(o.next(l))}catch(p){g(p)}},s=l=>{try{d(o.throw(l))}catch(p){g(p)}},d=l=>l.done?u(l.value):Promise.resolve(l.value).then(c,s);d((o=o.apply(e,n)).next())});var e,n,o}function Zh(i){return{transString:function(e){let n={},o=0,u=!1;for(let g in e)g!=="time"&&g!=="__time__"||typeof e[g]!="number"?typeof e[g]=="object"?n[g]=JSON.stringify(e[g]):n[g]=String(e[g]):(o=e[g],u=!0);return n.__time__=u?o:Math.floor(new Date().getTime()/1e3),n},process:function(e,n){return o=this,u=null,g=function*(){yield a_(i);let c=e.slice(e.indexOf("/logstores")),s=n.length,d=(l=n,ms.MD5(l).toString().toUpperCase());var l;let p=new Date().toUTCString(),S=new Map,T=new Map([["Content-Type","application/json"],["Content-MD5",d],["x-log-bodyrawsize",s.toString()]]);i.securityToken&&T.set("x-acs-security-token",i.securityToken),(function(R,v,h,m,_,A,E,b){var w;let C="";A.set("x-log-apiversion","0.6.0"),A.set("x-log-signaturemethod","hmac-sha1"),C+=R+`
`+E+`
`+((w=A.get("Content-Type"))!=null?w:"")+`
`+b+`
`;const P=(L,H)=>L[0].localeCompare(H[0]),U=L=>L[0].startsWith("x-log-")||L[0].startsWith("x-acs-");try{const L=[...A.entries()].filter(U).sort(P).map(H=>H[0]+":"+H[1]+`
`).join("");C+=L}catch{}C+=v,_.size>0&&(C+="?");try{C+=[..._.entries()].sort(P).map(L=>L[0]+"="+L[1]).join("&")}catch{}const B="LOG "+h+":"+ms.HmacSHA1(C,m).toString(ms.enc.Base64);A.set("Authorization",B),A.set("x-log-date",b)})("POST",c,i.accessKeyId,i.accessKeySecret,S,T,d,p);let y=Object.fromEntries(T);return{data:n,header:y}},new Promise((c,s)=>{var d=S=>{try{p(g.next(S))}catch(T){s(T)}},l=S=>{try{p(g.throw(S))}catch(T){s(T)}},p=S=>S.done?c(S.value):Promise.resolve(S.value).then(d,l);p((g=g.apply(o,u)).next())});var o,u,g}}}typeof window<"u"&&uS(window,"stsPlugin",Zh);for(var Qd,wi=[],$d=0;$d<256;++$d)wi.push(($d+256).toString(16).slice(1));var s_=new Uint8Array(16);function c_(){if(!Qd&&!(Qd=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Qd(s_)}const C0={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Er(i,e,n){if(C0.randomUUID&&!e&&!i)return C0.randomUUID();var o=(i=i||{}).random||(i.rng||c_)();return o[6]=15&o[6]|64,o[8]=63&o[8]|128,(function(u,g=0){return(wi[u[g+0]]+wi[u[g+1]]+wi[u[g+2]]+wi[u[g+3]]+"-"+wi[u[g+4]]+wi[u[g+5]]+"-"+wi[u[g+6]]+wi[u[g+7]]+"-"+wi[u[g+8]]+wi[u[g+9]]+"-"+wi[u[g+10]]+wi[u[g+11]]+wi[u[g+12]]+wi[u[g+13]]+wi[u[g+14]]+wi[u[g+15]]).toLowerCase()})(o)}var l_=/d{1,4}|D{3,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|W{1,2}|[LlopSZN]|"[^"]*"|'[^']*'/g,u_=/\b(?:[A-Z]{1,3}[A-Z][TC])(?:[-+]\d{4})?|((?:Australian )?(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time)\b/g,d_=/[^-+\dA-Z]/g;function ef(i,e,n,o){if(arguments.length!==1||typeof i!="string"||/\d/.test(i)||(e=i,i=void 0),(i=i||i===0?i:new Date)instanceof Date||(i=new Date(i)),isNaN(i))throw TypeError("Invalid date");var u=(e=String(w0[e]||e||w0.default)).slice(0,4);u!=="UTC:"&&u!=="GMT:"||(e=e.slice(4),n=!0,u==="GMT:"&&(o=!0));var g=function(){return n?"getUTC":"get"},c=function(){return i[g()+"Date"]()},s=function(){return i[g()+"Day"]()},d=function(){return i[g()+"Month"]()},l=function(){return i[g()+"FullYear"]()},p=function(){return i[g()+"Hours"]()},S=function(){return i[g()+"Minutes"]()},T=function(){return i[g()+"Seconds"]()},y=function(){return i[g()+"Milliseconds"]()},R=function(){return n?0:i.getTimezoneOffset()},v=function(){return h_(i)},h={d:function(){return c()},dd:function(){return ir(c())},ddd:function(){return Gi.dayNames[s()]},DDD:function(){return D0({y:l(),m:d(),d:c(),_:g(),dayName:Gi.dayNames[s()],short:!0})},dddd:function(){return Gi.dayNames[s()+7]},DDDD:function(){return D0({y:l(),m:d(),d:c(),_:g(),dayName:Gi.dayNames[s()+7]})},m:function(){return d()+1},mm:function(){return ir(d()+1)},mmm:function(){return Gi.monthNames[d()]},mmmm:function(){return Gi.monthNames[d()+12]},yy:function(){return String(l()).slice(2)},yyyy:function(){return ir(l(),4)},h:function(){return p()%12||12},hh:function(){return ir(p()%12||12)},H:function(){return p()},HH:function(){return ir(p())},M:function(){return S()},MM:function(){return ir(S())},s:function(){return T()},ss:function(){return ir(T())},l:function(){return ir(y(),3)},L:function(){return ir(Math.floor(y()/10))},t:function(){return p()<12?Gi.timeNames[0]:Gi.timeNames[1]},tt:function(){return p()<12?Gi.timeNames[2]:Gi.timeNames[3]},T:function(){return p()<12?Gi.timeNames[4]:Gi.timeNames[5]},TT:function(){return p()<12?Gi.timeNames[6]:Gi.timeNames[7]},Z:function(){return o?"GMT":n?"UTC":p_(i)},o:function(){return(R()>0?"-":"+")+ir(100*Math.floor(Math.abs(R())/60)+Math.abs(R())%60,4)},p:function(){return(R()>0?"-":"+")+ir(Math.floor(Math.abs(R())/60),2)+":"+ir(Math.floor(Math.abs(R())%60),2)},S:function(){return["th","st","nd","rd"][c()%10>3?0:(c()%100-c()%10!=10)*c()%10]},W:function(){return v()},WW:function(){return ir(v())},N:function(){return f_(i)}};return e.replace(l_,function(m){return m in h?h[m]():m.slice(1,m.length-1)})}var w0={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",paddedShortDate:"mm/dd/yyyy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},Gi={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],timeNames:["a","p","am","pm","A","P","AM","PM"]},ir=function(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2;return String(i).padStart(e,"0")},D0=function(i){var e=i.y,n=i.m,o=i.d,u=i._,g=i.dayName,c=i.short,s=c!==void 0&&c,d=new Date,l=new Date;l.setDate(l[u+"Date"]()-1);var p=new Date;return p.setDate(p[u+"Date"]()+1),d[u+"FullYear"]()===e&&d[u+"Month"]()===n&&d[u+"Date"]()===o?s?"Tdy":"Today":l[u+"FullYear"]()===e&&l[u+"Month"]()===n&&l[u+"Date"]()===o?s?"Ysd":"Yesterday":p[u+"FullYear"]()===e&&p[u+"Month"]()===n&&p[u+"Date"]()===o?s?"Tmw":"Tomorrow":g},h_=function(i){var e=new Date(i.getFullYear(),i.getMonth(),i.getDate());e.setDate(e.getDate()-(e.getDay()+6)%7+3);var n=new Date(e.getFullYear(),0,4);n.setDate(n.getDate()-(n.getDay()+6)%7+3);var o=e.getTimezoneOffset()-n.getTimezoneOffset();e.setHours(e.getHours()-o);var u=(e-n)/6048e5;return 1+Math.floor(u)},f_=function(i){var e=i.getDay();return e===0&&(e=7),e},p_=function(i){return(String(i).match(u_)||[""]).pop().replace(d_,"").replace(/GMT\+0000/g,"UTC")},ua=(i=>(i.prod="rs.rtn.aliyuncs.com",i.pre="prs.rtn.aliyuncs.com",i))(ua||{});const yl="7.2.1";class ei{static getVersionNumber(){let e=yl.split("."),n="";return e.forEach(o=>{o.length===1?n+="0"+o:n+=o}),parseInt(n)}static queryingParam(e){let n=[];if(e)for(let o in e)n.push(o+"="+e[o]);return n.join("&")}static getQueryParams(e){const n=window.location.search.substring(1).split("&");for(let o=0;o<n.length;o++){const u=n[o].split("=");if(decodeURIComponent(u[0])===e)return decodeURIComponent(u[1])}}static createCallid(e=""){const n=Er();return e&&n&&n.length>e.length?`${e}${n.substring(e.length)}`:n}static checkSubOptionsValid(e){if(e){const{audio:n,video:o,screen:u}=e;if(n===!1&&o===!1&&u===!1)return!1}return!0}static isNetworkAvailable(){return pe(this,null,function*(){const e=ua.prod,{onLine:n}=navigator;if(!n)return!1;try{return yield fetch(`https://${e}/roomserver/v1/ws/version`),!0}catch{return!1}})}static toString(e){let n;if(e instanceof Error)n=e.message;else if(typeof e=="string")n=e;else try{n=JSON.stringify(e)}catch{n="undefined"}return n}static paramArrayToString(e){let n="";for(let o=0;o<e.length;o++)n!==""&&(n+=" "),n+=ei.toString(e[o]);return n}static removeQueryString(e){if(!e)return e;let n=e.indexOf("?");return n>0?e.substring(0,n):e}}const{BrowserUtil:m_}=wt.AliRTS,g_="EdgeHTML",O0="Blink",v_="Trident",y_="Gecko",S_="WebKit",Fc=(i,e)=>{const n=e.match(i);return n&&n.length>0&&n[1]||""},b_=[{test:[/\sedg\//i,[/edg([ea]|ios)/i]],describe(i){if(/\sedg\//i.test(i))return{name:O0};const e=Fc(/edge\/(\d+(\.?_?\d+)+)/i,i);return{name:g_,version:e}}},{test:[/trident/i],describe(i){const e={name:v_},n=Fc(/trident\/(\d+(\.?_?\d+)+)/i,i);return n&&(e.version=n),e}},{test(i){const e=/gecko/i.test(i),n=/like gecko/i.test(i);return e&&!n},describe(i){const e={name:y_},n=Fc(/gecko\/(\d+(\.?_?\d+)+)/i,i);return n&&(e.version=n),e}},{test:[/(apple)?webkit\/537\.36/i],describe:()=>({name:O0})},{test:[/(apple)?webkit/i],describe(i){const e={name:S_},n=Fc(/webkit\/(\d+(\.?_?\d+)+)/i,i);return n&&(e.version=n),e}}],tf=(i,e)=>i.find(n=>typeof n.test=="function"?n.test(e):Array.isArray(n.test)?n.test.some(o=>typeof o=="string"?e.indexOf(o)>-1:o instanceof RegExp&&o.test(e)):void 0),E_=()=>{try{const i=navigator.userAgent||"",e=tf(b_,i);if(e){const n=e.describe(i);return`${n.name}/${n.version||m_.browserVersion}`}}catch{}return navigator.userAgent},R_=[{test:["wow64","win64","x64"],describe:()=>"amd64"},{test:["i686","x86"],describe:()=>"x86"},{test:["aarch64","arm64"],describe:()=>"arm64"},{test:["arm"],describe:()=>"arm"}],fS=()=>{let i="unknown";try{const e=navigator.userAgent||"",n=tf(R_,e);if(!n)return i;i=n.describe(e)}catch{}return i},__=[{test:[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],describe:()=>"Samsung"},{test:[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i,/\((ipad);[-\w\),; ]+apple/i,/(macintosh);/i],describe:()=>"Apple"},{test:[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],describe:()=>"Huawei"},{test:[/(?:honor)([-\w ]+)[;\)]/i],describe:()=>"Honor"},{test:[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],describe:()=>"Xiaomi"},{test:[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],describe:()=>"Oppo"},{test:[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],describe:()=>"Vivo"},{test:[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],describe:()=>"Realme"},{test:[/(pixel c)\b/i,/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],describe:()=>"Google"},{test:[/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],describe:()=>"ZTE"},{test:[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],describe:()=>"Meizu"}],T_=()=>{let i="Unknown";try{const e=navigator.userAgent||"",n=tf(__,e);if(!n)return i;i=n.describe(e)}catch{}return i};class pS{constructor(e){var n,o;this.timer=null,this.time=10,this.count=10,this.arr=[],this.time=(n=e.time)!=null?n:10,this.count=(o=e.count)!=null?o:10,e.host.startsWith("http://")||e.host.startsWith("https://")?this.url=e.host+"/logstores/"+e.logstore+"/track":this.url="https://"+e.project+"."+e.host+"/logstores/"+e.logstore+"/track",this.opt=e,e.installUnloadHook&&typeof e.installUnloadHook=="function"&&e.installUnloadHook(()=>{this.sendImmediateInner()})}assemblePayload(e){const n={__logs__:e};return this.opt.tags&&(n.__tags__=this.opt.tags),this.opt.topic&&(n.__topic__=this.opt.topic),this.opt.source&&(n.__source__=this.opt.source),JSON.stringify(n)}platformSend(){if(this.opt.sendPayload&&typeof this.opt.sendPayload=="function"){const e=this.assemblePayload(this.arr);this.opt.sendPayload(this.url,e)}}transString(e){let n={};for(let o in e)typeof e[o]=="object"?n[o]=JSON.stringify(e[o]):n[o]=String(e[o]);return n}sendImmediateInner(){this.arr&&this.arr.length>0&&(this.platformSend(),this.timer!=null&&(clearTimeout(this.timer),this.timer=null),this.arr=[])}sendInner(){if(this.timer)this.arr.length>=this.count&&(clearTimeout(this.timer),this.timer=null,this.sendImmediateInner());else{const e=this;this.arr.length>=this.count||this.time<=0?this.sendImmediateInner():this.timer=setTimeout(function(){e.sendImmediateInner()},1e3*this.time)}}send(e){const n=this.transString(e);this.arr.push(n),this.sendInner()}sendImmediate(e){const n=this.transString(e);this.arr.push(n),this.sendImmediateInner()}sendBatchLogs(e){const n=e.map(o=>this.transString(o));this.arr.push(...n),this.sendInner()}sendBatchLogsImmediate(e){const n=e.map(o=>this.transString(o));this.arr.push(...n),this.sendImmediateInner()}overwriteTransString(e){this.transString=e.transString}getOpt(){return this.opt}}function I0(i,e){return new Promise((n,o)=>{const u=new window.XMLHttpRequest;u.onload=()=>{u.status>=200&&u.status<300?n():o(new Error(`HTTP ${u.status}: ${u.statusText}`))},u.onerror=()=>{o(new Error("Network error occurred"))},u.ontimeout=()=>{o(new Error("Request timeout"))},u.timeout=1e4,u.open("POST",`${i}?APIVersion=0.6.0`,!0),u.send(e)})}function A_(i,e,n=!1){return pe(this,null,function*(){try{if(n||e.length>=32768)return void(yield I0(i,e));(function(o,u){return!(!navigator||!navigator.sendBeacon)&&navigator.sendBeacon(`${o}?APIVersion=0.6.0`,u)})(i,e)||(yield I0(i,e))}catch(o){const u=o instanceof Error?o:new Error(String(o));throw window&&window.console&&typeof window.console.error=="function"&&(console.error(`Failed to log to ali log service because of this exception:
`+u.message),console.error("Failed log data:",i)),u}})}let C_=class extends pS{constructor(i){const e=i,{maxRetries:n=10,retryDelay:o=2e3,backoffMultiplier:u=2,maxRetryDelay:g=3e5,enableLocalStorage:c=!0,maxStorageSize:s=1e3,storageKey:d="artc_reliable_logs",enableNetworkMonitor:l=!0,onNetworkChange:p=()=>{},forceXhrMode:S=!0,debug:T=!1}=e,y=jn(e,["maxRetries","retryDelay","backoffMultiplier","maxRetryDelay","enableLocalStorage","maxStorageSize","storageKey","enableNetworkMonitor","onNetworkChange","forceXhrMode","debug"]);super(Object.assign({},y,{installUnloadHook:R=>{window.addEventListener("beforeunload",()=>{this.saveFailedLogs(),R()}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&this.saveFailedLogs()})},sendPayload:(R,v)=>pe(this,null,function*(){return Promise.resolve()})})),W(this,"reliableConfig"),W(this,"failedLogs",new Map),W(this,"networkStatus","online"),W(this,"retryTimer",null),W(this,"originalSendPayload",null),this.reliableConfig={maxRetries:n,retryDelay:o,backoffMultiplier:u,maxRetryDelay:g,enableLocalStorage:c,maxStorageSize:s,storageKey:d,enableNetworkMonitor:l,onNetworkChange:p,forceXhrMode:S,debug:T},this.originalSendPayload=(R,v)=>pe(this,null,function*(){return A_(R,v,S)}),this.getOpt().sendPayload=(R,v)=>pe(this,null,function*(){return this.reliableSendAsync(R,v)}),this.initNetworkMonitor(),this.loadFailedLogs(),this.startRetryTimer()}reliableSendAsync(i,e){return pe(this,null,function*(){const n=this.generateId();try{yield Promise.resolve(this.originalSendPayload(i,e)),this.debug(`Log ${n} sent successfully`)}catch(o){this.debug(`Log ${n} failed, adding to retry queue:`,o),this.addToFailedQueue(n,i,e,o)}})}addToFailedQueue(i,e,n,o){const u={id:i,data:{error:o.message},timestamp:Date.now(),retryCount:0,lastRetryTime:0,url:e,payload:n};this.failedLogs.set(i,u),this.scheduleRetry(u)}scheduleRetry(i){if(i.retryCount>=this.reliableConfig.maxRetries)return this.debug(`Log ${i.id} exceeded max retries, removing from queue`),void this.failedLogs.delete(i.id);const e=Math.min(this.reliableConfig.retryDelay*Math.pow(this.reliableConfig.backoffMultiplier,i.retryCount),this.reliableConfig.maxRetryDelay);this.debug(`Scheduling retry for log ${i.id} in ${e}ms (attempt ${i.retryCount+1}/${this.reliableConfig.maxRetries})`),setTimeout(()=>{this.retryLog(i)},e)}retryLog(i){return pe(this,null,function*(){if(this.failedLogs.has(i.id)){i.retryCount++,i.lastRetryTime=Date.now();try{if(this.networkStatus==="offline")return this.debug(`Log ${i.id} retry skipped - network offline`),void this.scheduleRetry(i);yield this.originalSendPayload(i.url,i.payload),this.debug(`Log ${i.id} retry successful`),this.failedLogs.delete(i.id)}catch(e){this.debug(`Log ${i.id} retry failed:`,e),this.scheduleRetry(i)}}})}initNetworkMonitor(){this.reliableConfig.enableNetworkMonitor&&typeof window<"u"&&(this.networkStatus=navigator.onLine?"online":"offline",window.addEventListener("online",()=>{this.handleNetworkChange("online")}),window.addEventListener("offline",()=>{this.handleNetworkChange("offline")}),this.debug(`Network monitor initialized. Current status: ${this.networkStatus}`))}handleNetworkChange(i){const e=this.networkStatus;this.networkStatus=i,this.debug(`Network status changed: ${e} -> ${i}`),this.reliableConfig.onNetworkChange(i==="online"),i==="online"&&e==="offline"&&(this.debug("Network recovered, retrying failed logs"),this.retryAllFailedLogs())}retryAllFailedLogs(){this.failedLogs.size!==0&&(this.debug(`Retrying ${this.failedLogs.size} failed logs after network recovery`),Array.from(this.failedLogs.values()).forEach(i=>{setTimeout(()=>this.retryLog(i),100*Math.random())}))}startRetryTimer(){typeof window<"u"&&(this.retryTimer=window.setInterval(()=>{if(this.failedLogs.size>0&&this.networkStatus==="online"){const i=Date.now();Array.from(this.failedLogs.values()).forEach(e=>{i-e.lastRetryTime>this.reliableConfig.retryDelay&&this.retryLog(e)})}},this.reliableConfig.retryDelay),this.debug(`Retry timer started with interval ${this.reliableConfig.retryDelay}ms`))}loadFailedLogs(){if(this.reliableConfig.enableLocalStorage&&typeof localStorage<"u")try{const i=localStorage.getItem(this.reliableConfig.storageKey);if(i){const e=JSON.parse(i);e.forEach(n=>{this.failedLogs.set(n.id,n)}),this.debug(`Loaded ${e.length} failed logs from storage`),localStorage.removeItem(this.reliableConfig.storageKey),this.networkStatus==="online"&&this.retryAllFailedLogs()}}catch(i){this.debug("Failed to load failed logs from storage:",i)}}saveFailedLogs(){if(this.reliableConfig.enableLocalStorage&&typeof localStorage<"u"&&this.failedLogs.size!==0)try{const i=Array.from(this.failedLogs.values()).slice(-this.reliableConfig.maxStorageSize);localStorage.setItem(this.reliableConfig.storageKey,JSON.stringify(i)),this.debug(`Saved ${i.length} failed logs to storage`)}catch(i){this.debug("Failed to save failed logs to storage:",i)}}generateId(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}debug(...i){this.reliableConfig.debug&&typeof console<"u"&&console.log("[ReliableWebTracker]",...i)}useStsPlugin(i){this.originalSendPayload=(e,n)=>pe(this,null,function*(){return(function(o,u,g){return pe(this,null,function*(){try{o=o.slice(0,-6);const{data:c,header:s}=yield g.process(o,u);return new Promise((d,l)=>{const p=new window.XMLHttpRequest;p.onload=()=>{p.status>=200&&p.status<300?d():l(new Error(`HTTP ${p.status}: ${p.statusText}`))},p.onerror=()=>{l(new Error("Network error occurred"))},p.ontimeout=()=>{l(new Error("Request timeout"))},p.timeout=1e4,p.open("POST",o,!0);for(let S in s)p.setRequestHeader(S,s[S]);p.send(c)})}catch(c){const s=c instanceof Error?c:new Error(String(c));throw window&&window.console&&typeof window.console.error=="function"&&(console.error(`Failed to log to ali log service because of this exception:
`+s.message),console.error("Failed log data:",o)),s}})})(e,n,i)}),this.getOpt().sendPayload=(e,n)=>pe(this,null,function*(){return this.reliableSendAsync(e,n)}),this.overwriteTransString(i)}getStatus(){return{networkStatus:this.networkStatus,failedLogsCount:this.failedLogs.size,isRetryActive:this.retryTimer!==null,config:this.reliableConfig}}retryAll(){this.debug("Manual retry triggered"),this.retryAllFailedLogs()}clearFailedLogs(){const i=this.failedLogs.size;this.failedLogs.clear(),this.debug(`Cleared ${i} failed logs`)}getFailedLogs(){return Array.from(this.failedLogs.values())}destroy(){this.retryTimer&&(clearInterval(this.retryTimer),this.retryTimer=null),this.saveFailedLogs(),this.failedLogs.clear(),this.debug("WebTrackerBrowser destroyed")}};const{BrowserUtil:M0,SystenUtil:N0}=wt.AliRTS,w_=fS(),Gc=6e5,Wc={host:"cn-hangzhou.log.aliyuncs.com",project:"alivc-aio",logstore:"logger",time:10,count:10};function Zd(){return ef(new Date,"HH:MM:ss.l")}function k0(){return ef(new Date,"isoDate")}var mS=(i=>(i[i.DEBUG=0]="DEBUG",i[i.INFO=1]="INFO",i[i.API=2]="API",i[i.WARNING=3]="WARNING",i[i.ERROR=4]="ERROR",i[i.NONE=5]="NONE",i))(mS||{});class D_{constructor(){W(this,"tracker"),W(this,"stsPlugin"),W(this,"stsData"),W(this,"stsExpiration",Date.now()),W(this,"clientId",Er()),W(this,"bSesid",Er()),W(this,"logLevel",3),W(this,"appId",""),W(this,"sessionId",""),W(this,"logCache",[]),W(this,"updateTaskTimer"),W(this,"endReported",!0),W(this,"logSequence",0),W(this,"sendLogBeforeUnload",e=>pe(this,null,function*(){if(!this.stsPlugin)return;this.logSequence+=1,e.unshift(this.getLogParams(710203,{log:`[${k0()} ${Zd()}] [INF] beforeunload`,stat_log_seq:this.logSequence}));const n=`https://${Wc.project}.${Wc.host}/logstores/${Wc.logstore}`,o={__logs__:e.map(c=>this.stsPlugin.transString(c))},{data:u,header:g}=yield this.stsPlugin.process(n,JSON.stringify(o));fetch(n,{keepalive:!0,method:"POST",headers:g,body:u})})),W(this,"logMethod",(e,n=console.log)=>(...o)=>{let u=Zd();this.logLevel<=e&&n(u,...o);let g=ei.paramArrayToString(o);e>0&&this.addLog(g)}),W(this,"d",this.logMethod(0,console.debug)),W(this,"i",this.logMethod(1)),W(this,"w",this.logMethod(3,console.warn)),W(this,"e",this.logMethod(4,(...e)=>{const[n,...o]=e;console.error(n,"<error>",o)})),W(this,"ev",this.logMethod(2)),W(this,"a",this.logMethod(2,(...e)=>{const[n,...o]=e;if(o.length>2){const u=`${o[1]}`;u.startsWith("__g__")&&console.group(`${u.substring(5)}_${o[2]}`)}console.log(n,...o)})),W(this,"ar",this.logMethod(2,(...e)=>{const[n,...o]=e;console.log(n,...o),o.length>2&&`${o[1]}`.startsWith("__g__")&&console.groupEnd()})),W(this,"ae",this.logMethod(2,(...e)=>{const[n,...o]=e;console.error(n,"<error>",...o),o.length>2&&`${o[1]}`.startsWith("__g__")&&console.groupEnd()})),window.addEventListener("beforeunload",()=>{this.reportEnd(!0)})}init(){this.reset(),this.startSTSUpdateTask()}destroy(){this.updateTaskTimer&&clearTimeout(this.updateTaskTimer)}reset(){this.bSesid=Er(),this.endReported=!0,this.logSequence=0,this.appId="",this.sessionId=""}startSTSUpdateTask(){return pe(this,null,function*(){this.updateTaskTimer&&clearTimeout(this.updateTaskTimer);try{const e=yield this.refreshSTSToken();this.createTracker(e)}catch{}this.updateTaskTimer=setTimeout(()=>{this.startSTSUpdateTask()},Gc)})}refreshSTSToken(){return pe(this,null,function*(){if(!this.stsData||this.stsExpiration<=Date.now()+Gc){const e=yield this.requestSTSToken(),n=new Date(e?.Expiration).getTime()||0,o=Date.now()+Gc;this.stsExpiration=Math.max(n,o),this.stsData=e}return this.stsData})}requestSTSToken(){const e=Date.now(),n=`${this.clientId}|woMMssV6jmyol9fr|${e}`,o={Action:"AssumeSlsRoleV2",AuthInfo:ms.MD5(n).toString(ms.enc.Hex),ClientId:this.clientId,BusinessType:"logger",AppVersion:"1.0",Version:"2017-03-14",AuthTimestamp:`${e}`,TerminalType:"web",DeviceModel:"",Format:"JSON",SignatureMethod:"HMAC-SHA1",SignatureVersion:"1.0",Timestamp:ef(e,"isoUtcDateTime")},u=new URLSearchParams(o).toString();return fetch(`https://slsrole.alicdn.com/?${u}`).then(g=>g.json()).then(g=>JSON.parse(window.atob(g.SlsAuthResult)))}createTracker(e){if(!this.tracker){const n={accessKeyId:e.AccessKeyId,accessKeySecret:e.AccessKeySecret,securityToken:e.SecurityToken,refreshSTSTokenInterval:Gc,stsTokenFreshTime:void 0,refreshSTSToken:()=>{this.refreshSTSToken().then(g=>{n.accessKeyId=g.AccessKeyId,n.accessKeySecret=g.AccessKeySecret,n.securityToken=g.SecurityToken}).catch(()=>{})}},o=new C_(Wc),u=Zh(n);o.useStsPlugin(u),this.stsPlugin=u,this.tracker=o,this.reportStartAndCache()}}changeConfig(e){e.logLevel!==void 0&&e.logLevel>=0&&e.logLevel<=5&&(this.logLevel=e.logLevel)}setSessionID(e,n){e&&n&&(this.appId=e,this.sessionId=n,this.reportStartAndCache())}reportStartAndCache(){if(!this.tracker||!this.sessionId)return;this.endReported=!1;const e={task_btm_sec:0,task_duration:0,task_etm_sec:0,task_type:"session"},n=[this.getLogParams(710201,e),this.getLogParams(710202,e)];this.tracker.sendBatchLogsImmediate(n),this.logCache.forEach(o=>{this.sendLog(o)})}reportEnd(e=!1){if(!this.tracker||!this.sessionId||this.endReported)return void this.reset();const n={task_btm_sec:0,task_duration:0,task_etm_sec:0,task_type:"session"},o=[this.getLogParams(710204,n),this.getLogParams(710205,n)];e?this.sendLogBeforeUnload(o):(this.tracker.sendBatchLogsImmediate(o),this.endReported=!0),this.reset()}getLogParams(e,n){return Qe({appid:`${window.location.host}`,appid_list:this.appId,appver:"",b_sesid:this.bSesid,biz_type:"rtc",cpu_info:w_,db:M0.browserName,dm:M0.browserVersion,install_uuid:this.clientId,logger_v:"0.0.1",os:N0.systemName,osv:N0.systemVersion,p_sesid:this.bSesid,sdk_version:yl,sdkname:"AliRTCSdk",stm:Date.now(),tar_pf:"web",traceid:this.sessionId,event_id:e},n||{})}sendLog(e){if(!this.tracker||!this.sessionId)return;this.logSequence+=1;const n=this.getLogParams(710203,{log:e,stat_log_seq:this.logSequence});this.tracker.send(n)}addLog(e){const n=Zd(),o=`[${k0()} ${n}] ${e}`;this.sessionId&&this.tracker?this.sendLog(o):(this.logCache.push(o),this.logCache.length>=200&&this.logCache.shift())}}class ke{static getLogger(){return this.logger||(this.logger=new D_),this.logger}static init(){this.getLogger().init()}static destroy(){this.getLogger().destroy()}static setLogLevel(e){this.getLogger().changeConfig({logLevel:e})}static setSessionID(e,n){this.getLogger().setSessionID(e,n)}static reportEnd(){this.getLogger().reportEnd()}static interface(...e){this.getLogger().a("[API]",...e)}static interfaceResult(e,n,o,...u){o?this.getLogger().ar("[ARE]",e,n,...u):this.getLogger().ae("[ARE]",e,n,...u)}static event(...e){this.getLogger().ev("[EVT]",...e)}static debug(...e){this.getLogger().d("[DBG]",...e)}static info(...e){this.getLogger().i("[INF]",...e)}static warn(...e){this.getLogger().w("[WARN]",...e)}static error(...e){this.getLogger().e("[ERR]",...e)}}W(ke,"logger");var eh,th,kh={exports:{}};eh=kh,th=kh.exports,(function(i,e){var n="function",o="undefined",u="object",g="string",c="major",s="model",d="name",l="type",p="vendor",S="version",T="architecture",y="console",R="mobile",v="tablet",h="smarttv",m="wearable",_="embedded",A="Amazon",E="Apple",b="ASUS",w="BlackBerry",C="Browser",P="Chrome",U="Firefox",B="Google",L="Huawei",H="LG",O="Microsoft",x="Motorola",F="Opera",N="Samsung",k="Sharp",M="Sony",j="Xiaomi",G="Zebra",z="Facebook",V="Chromium OS",re="Mac OS",Q=" Browser",Z=function(Re){for(var Te={},Ae=0;Ae<Re.length;Ae++)Te[Re[Ae].toUpperCase()]=Re[Ae];return Te},q=function(Re,Te){return typeof Re===g&&Y(Te).indexOf(Y(Re))!==-1},Y=function(Re){return Re.toLowerCase()},J=function(Re,Te){if(typeof Re===g)return Re=Re.replace(/^\s\s*/,""),typeof Te===o?Re:Re.substring(0,500)},$=function(Re,Te){for(var Ae,Ie,Le,Be,$e,Ne,ze=0;ze<Te.length&&!$e;){var Je=Te[ze],rt=Te[ze+1];for(Ae=Ie=0;Ae<Je.length&&!$e&&Je[Ae];)if($e=Je[Ae++].exec(Re))for(Le=0;Le<rt.length;Le++)Ne=$e[++Ie],typeof(Be=rt[Le])===u&&Be.length>0?Be.length===2?typeof Be[1]==n?this[Be[0]]=Be[1].call(this,Ne):this[Be[0]]=Be[1]:Be.length===3?typeof Be[1]!==n||Be[1].exec&&Be[1].test?this[Be[0]]=Ne?Ne.replace(Be[1],Be[2]):e:this[Be[0]]=Ne?Be[1].call(this,Ne,Be[2]):e:Be.length===4&&(this[Be[0]]=Ne?Be[3].call(this,Ne.replace(Be[1],Be[2])):e):this[Be]=Ne||e;ze+=2}},te=function(Re,Te){for(var Ae in Te)if(typeof Te[Ae]===u&&Te[Ae].length>0){for(var Ie=0;Ie<Te[Ae].length;Ie++)if(q(Te[Ae][Ie],Re))return Ae==="?"?e:Ae}else if(q(Te[Ae],Re))return Ae==="?"?e:Ae;return Te.hasOwnProperty("*")?Te["*"]:Re},ie={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},se={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[S,[d,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[S,[d,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[d,S],[/opios[\/ ]+([\w\.]+)/i],[S,[d,F+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[S,[d,F+" GX"]],[/\bopr\/([\w\.]+)/i],[S,[d,F]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[S,[d,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[S,[d,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[d,S],[/quark(?:pc)?\/([-\w\.]+)/i],[S,[d,"Quark"]],[/\bddg\/([\w\.]+)/i],[S,[d,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[S,[d,"UC"+C]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[S,[d,"WeChat"]],[/konqueror\/([\w\.]+)/i],[S,[d,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[S,[d,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[S,[d,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[S,[d,"Smart Lenovo "+C]],[/(avast|avg)\/([\w\.]+)/i],[[d,/(.+)/,"$1 Secure "+C],S],[/\bfocus\/([\w\.]+)/i],[S,[d,U+" Focus"]],[/\bopt\/([\w\.]+)/i],[S,[d,F+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[S,[d,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[S,[d,"Dolphin"]],[/coast\/([\w\.]+)/i],[S,[d,F+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[S,[d,"MIUI"+Q]],[/fxios\/([\w\.-]+)/i],[S,[d,U]],[/\bqihoobrowser\/?([\w\.]*)/i],[S,[d,"360"]],[/\b(qq)\/([\w\.]+)/i],[[d,/(.+)/,"$1Browser"],S],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[d,/(.+)/,"$1"+Q],S],[/samsungbrowser\/([\w\.]+)/i],[S,[d,N+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[S,[d,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[d,"Sogou Mobile"],S],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[d,S],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[d],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[S,d],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[d,z],S],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[d,S],[/\bgsa\/([\w\.]+) .*safari\//i],[S,[d,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[S,[d,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[S,[d,P+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[d,P+" WebView"],S],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[S,[d,"Android "+C]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[d,S],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[S,[d,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[S,d],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[d,[S,te,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[d,S],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[d,"Netscape"],S],[/(wolvic|librewolf)\/([\w\.]+)/i],[d,S],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[S,[d,U+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[d,[S,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[d,[S,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[T,"amd64"]],[/(ia32(?=;))/i],[[T,Y]],[/((?:i[346]|x)86)[;\)]/i],[[T,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[T,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[T,"armhf"]],[/windows (ce|mobile); ppc;/i],[[T,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[T,/ower/,"",Y]],[/(sun4\w)[;\)]/i],[[T,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[T,Y]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[s,[p,N],[l,v]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[s,[p,N],[l,R]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[s,[p,E],[l,R]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[s,[p,E],[l,v]],[/(macintosh);/i],[s,[p,E]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[s,[p,k],[l,R]],[/(?:honor)([-\w ]+)[;\)]/i],[s,[p,"Honor"],[l,R]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[s,[p,L],[l,v]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[s,[p,L],[l,R]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[s,/_/g," "],[p,j],[l,R]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[s,/_/g," "],[p,j],[l,v]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[s,[p,"OPPO"],[l,R]],[/\b(opd2\d{3}a?) bui/i],[s,[p,"OPPO"],[l,v]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[s,[p,"Vivo"],[l,R]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[s,[p,"Realme"],[l,R]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[s,[p,x],[l,R]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[s,[p,x],[l,v]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[s,[p,H],[l,v]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[s,[p,H],[l,R]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[s,[p,"Lenovo"],[l,v]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[s,/_/g," "],[p,"Nokia"],[l,R]],[/(pixel c)\b/i],[s,[p,B],[l,v]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[s,[p,B],[l,R]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[s,[p,M],[l,R]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[s,"Xperia Tablet"],[p,M],[l,v]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[s,[p,"OnePlus"],[l,R]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[s,[p,A],[l,v]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[s,/(.+)/g,"Fire Phone $1"],[p,A],[l,R]],[/(playbook);[-\w\),; ]+(rim)/i],[s,p,[l,v]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[s,[p,w],[l,R]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[s,[p,b],[l,v]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[s,[p,b],[l,R]],[/(nexus 9)/i],[s,[p,"HTC"],[l,v]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[p,[s,/_/g," "],[l,R]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[s,[p,"TCL"],[l,v]],[/(itel) ((\w+))/i],[[p,Y],s,[l,te,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[s,[p,"Acer"],[l,v]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[s,[p,"Meizu"],[l,R]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[s,[p,"Ulefone"],[l,R]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[s,[p,"Energizer"],[l,R]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[s,[p,"Cat"],[l,R]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[s,[p,"Smartfren"],[l,R]],[/droid.+; (a(?:015|06[35]|142p?))/i],[s,[p,"Nothing"],[l,R]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[p,s,[l,R]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[p,s,[l,v]],[/(surface duo)/i],[s,[p,O],[l,v]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[s,[p,"Fairphone"],[l,R]],[/(u304aa)/i],[s,[p,"AT&T"],[l,R]],[/\bsie-(\w*)/i],[s,[p,"Siemens"],[l,R]],[/\b(rct\w+) b/i],[s,[p,"RCA"],[l,v]],[/\b(venue[\d ]{2,7}) b/i],[s,[p,"Dell"],[l,v]],[/\b(q(?:mv|ta)\w+) b/i],[s,[p,"Verizon"],[l,v]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[s,[p,"Barnes & Noble"],[l,v]],[/\b(tm\d{3}\w+) b/i],[s,[p,"NuVision"],[l,v]],[/\b(k88) b/i],[s,[p,"ZTE"],[l,v]],[/\b(nx\d{3}j) b/i],[s,[p,"ZTE"],[l,R]],[/\b(gen\d{3}) b.+49h/i],[s,[p,"Swiss"],[l,R]],[/\b(zur\d{3}) b/i],[s,[p,"Swiss"],[l,v]],[/\b((zeki)?tb.*\b) b/i],[s,[p,"Zeki"],[l,v]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[p,"Dragon Touch"],s,[l,v]],[/\b(ns-?\w{0,9}) b/i],[s,[p,"Insignia"],[l,v]],[/\b((nxa|next)-?\w{0,9}) b/i],[s,[p,"NextBook"],[l,v]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[p,"Voice"],s,[l,R]],[/\b(lvtel\-)?(v1[12]) b/i],[[p,"LvTel"],s,[l,R]],[/\b(ph-1) /i],[s,[p,"Essential"],[l,R]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[s,[p,"Envizen"],[l,v]],[/\b(trio[-\w\. ]+) b/i],[s,[p,"MachSpeed"],[l,v]],[/\btu_(1491) b/i],[s,[p,"Rotor"],[l,v]],[/(shield[\w ]+) b/i],[s,[p,"Nvidia"],[l,v]],[/(sprint) (\w+)/i],[p,s,[l,R]],[/(kin\.[onetw]{3})/i],[[s,/\./g," "],[p,O],[l,R]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[s,[p,G],[l,v]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[s,[p,G],[l,R]],[/smart-tv.+(samsung)/i],[p,[l,h]],[/hbbtv.+maple;(\d+)/i],[[s,/^/,"SmartTV"],[p,N],[l,h]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[p,H],[l,h]],[/(apple) ?tv/i],[p,[s,E+" TV"],[l,h]],[/crkey/i],[[s,P+"cast"],[p,B],[l,h]],[/droid.+aft(\w+)( bui|\))/i],[s,[p,A],[l,h]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[s,[p,k],[l,h]],[/(bravia[\w ]+)( bui|\))/i],[s,[p,M],[l,h]],[/(mitv-\w{5}) bui/i],[s,[p,j],[l,h]],[/Hbbtv.*(technisat) (.*);/i],[p,s,[l,h]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[p,J],[s,J],[l,h]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[l,h]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[p,s,[l,y]],[/droid.+; (shield) bui/i],[s,[p,"Nvidia"],[l,y]],[/(playstation [345portablevi]+)/i],[s,[p,M],[l,y]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[s,[p,O],[l,y]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[s,[p,N],[l,m]],[/((pebble))app/i],[p,s,[l,m]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[s,[p,E],[l,m]],[/droid.+; (glass) \d/i],[s,[p,B],[l,m]],[/droid.+; (wt63?0{2,3})\)/i],[s,[p,G],[l,m]],[/droid.+; (glass) \d/i],[s,[p,B],[l,m]],[/(pico) (4|neo3(?: link|pro)?)/i],[p,s,[l,m]],[/; (quest( \d| pro)?)/i],[s,[p,z],[l,m]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[p,[l,_]],[/(aeobc)\b/i],[s,[p,A],[l,_]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[s,[l,R]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[s,[l,v]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[l,v]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[l,R]],[/(android[-\w\. ]{0,9});.+buil/i],[s,[p,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[S,[d,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[d,S],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[S,[d,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[d,S],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[S,d]],os:[[/microsoft (windows) (vista|xp)/i],[d,S],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[d,[S,te,ie]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[S,te,ie],[d,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[S,/_/g,"."],[d,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[d,re],[S,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[S,d],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[d,S],[/\(bb(10);/i],[S,[d,w]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[S,[d,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[S,[d,U+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[S,[d,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[S,[d,"watchOS"]],[/crkey\/([\d\.]+)/i],[S,[d,P+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[d,V],S],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[d,S],[/(sunos) ?([\w\.\d]*)/i],[[d,"Solaris"],S],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[d,S]]},he=function(Re,Te){if(typeof Re===u&&(Te=Re,Re=e),!(this instanceof he))return new he(Re,Te).getResult();var Ae=typeof i!==o&&i.navigator?i.navigator:e,Ie=Re||(Ae&&Ae.userAgent?Ae.userAgent:""),Le=Ae&&Ae.userAgentData?Ae.userAgentData:e,Be=Te?(function(Ne,ze){var Je={};for(var rt in Ne)ze[rt]&&ze[rt].length%2==0?Je[rt]=ze[rt].concat(Ne[rt]):Je[rt]=Ne[rt];return Je})(se,Te):se,$e=Ae&&Ae.userAgent==Ie;return this.getBrowser=function(){var Ne,ze={};return ze[d]=e,ze[S]=e,$.call(ze,Ie,Be.browser),ze[c]=typeof(Ne=ze[S])===g?Ne.replace(/[^\d\.]/g,"").split(".")[0]:e,$e&&Ae&&Ae.brave&&typeof Ae.brave.isBrave==n&&(ze[d]="Brave"),ze},this.getCPU=function(){var Ne={};return Ne[T]=e,$.call(Ne,Ie,Be.cpu),Ne},this.getDevice=function(){var Ne={};return Ne[p]=e,Ne[s]=e,Ne[l]=e,$.call(Ne,Ie,Be.device),$e&&!Ne[l]&&Le&&Le.mobile&&(Ne[l]=R),$e&&Ne[s]=="Macintosh"&&Ae&&typeof Ae.standalone!==o&&Ae.maxTouchPoints&&Ae.maxTouchPoints>2&&(Ne[s]="iPad",Ne[l]=v),Ne},this.getEngine=function(){var Ne={};return Ne[d]=e,Ne[S]=e,$.call(Ne,Ie,Be.engine),Ne},this.getOS=function(){var Ne={};return Ne[d]=e,Ne[S]=e,$.call(Ne,Ie,Be.os),$e&&!Ne[d]&&Le&&Le.platform&&Le.platform!="Unknown"&&(Ne[d]=Le.platform.replace(/chrome os/i,V).replace(/macos/i,re)),Ne},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Ie},this.setUA=function(Ne){return Ie=typeof Ne===g&&Ne.length>500?J(Ne,500):Ne,this},this.setUA(Ie),this};he.VERSION="1.0.40",he.BROWSER=Z([d,S,c]),he.CPU=Z([T]),he.DEVICE=Z([s,p,l,y,R,h,v,m,_]),he.ENGINE=he.OS=Z([d,S]),eh.exports&&(th=eh.exports=he),th.UAParser=he;var de=typeof i!==o&&(i.jQuery||i.Zepto);if(de&&!de.ua){var be=new he;de.ua=be.getResult(),de.ua.get=function(){return be.getUA()},de.ua.set=function(Re){be.setUA(Re);var Te=be.getResult();for(var Ae in Te)de.ua[Ae]=Te[Ae]}}})(typeof window=="object"?window:el);var O_=kh.exports,ci=(i=>(i.KEEPALIVE="keepalive",i.JOINCHANNEL="joinchannel",i.NOTIFYJOIN="notifyjoin",i.NOTIFYSTATUS="notifystatus",i.STATUSREPORT="statusreport",i.LEAVECHANNEL="leavechannel",i.NOTIFYLEAVE="notifyleave",i.NOTIFYPUBLISH="notifypublish",i.BYE="bye",i.RECONNECT="reconnect",i.PUBLISH="publish",i.REFRESHURL="refreshurl",i.UNSUBSCRIBE="unsubscribe",i.ROLEUPDATE="roleupdate",i))(ci||{});class Sl{constructor(e,n){W(this,"authInfo"),W(this,"userName"),W(this,"seqIndex",0),this.authInfo=e,this.userName=typeof n=="number"?n.toString():n}get roleAuth(){if(this.authInfo.role){const{timestamp:e,nonce:n,token:o,role:u}=this.authInfo;return{timestamp:e,nonce:n,token:o,tokenrole:u}}}static get adaptInfo(){var e,n,o,u;let g=new O_.UAParser().getResult();return{os_name:((e=g.os.name)==null?void 0:e.replace(" ",""))+"_"+((n=g.browser.name)==null?void 0:n.replace(" ","")),device_name:((o=g.device.model)==null?void 0:o.replace(" ",""))||"",brand_name:((u=g.device.vendor)==null?void 0:u.replace(" ",""))||"",device_key:window.navigator.userAgent,os_version:g.browser.version||"",sdk_version:"7.2.1",version:"v1"}}refreshAuthInfo(e){this.authInfo=e}getSeqIndex(){return this.seqIndex}createKeepAlivePackage(){return this.createBaseSendPackage("keepalive")}createJoinPackage(e){let n=this.createBaseSendPackage("joinchannel");return n.header.displayName=this.userName,n.header.clientversion=ei.getVersionNumber().toString(),n.header.platform="web",this.roleAuth&&(n.data.auth=this.roleAuth),n.data.adapt=Sl.adaptInfo,e&&(n.data=Qe(Qe({},n.data),e)),n}createLeavePackage(){return this.createBaseSendPackage("leavechannel")}createStatusPackage(e){let n=this.createBaseSendPackage("statusreport");return n.header.displayName=this.userName,n.data.status=e,n}createPublishPackage(){let e=this.createBaseSendPackage("publish");return e.data.users=[{}],this.roleAuth&&(e.data.auth=this.roleAuth),e}createRoleUpdatePackage(){let e=this.createBaseSendPackage("roleupdate");return e.header.displayName=this.userName,e}createReconnectPackage(e){let n=this.createBaseSendPackage("reconnect");return n.header.displayName=this.userName,n.header.clientversion=ei.getVersionNumber().toString(),n.header.platform="web",n.data=Qe(Qe({},n.data),e??{}),this.roleAuth&&(n.data.auth=this.roleAuth),n}createRefreshUrlPackage(){let e=this.createBaseSendPackage("refreshurl");return e.header.displayName=this.userName,e}createResponsePackage(e,n){return{version:1,code:200,tid:e,msgtype:n}}createBaseSendPackage(e){var n;return++this.seqIndex,{version:1,msgtype:e,tid:Er(),header:{appid:this.authInfo.appId,channelid:this.authInfo.channelId,sessionid:(n=this.authInfo.sessionId)!=null?n:"",userid:this.authInfo.userId},data:{seq:this.seqIndex}}}}var Dr=(i=>(i.pre="pre",i.prod="prod",i))(Dr||{}),Un=(i=>(i.AliRtcSdkCommunication="communication",i.AliRtcSdkInteractiveLive="interactive_live",i.AliRtcSdkInteractiveWithLowLatencyLive="cdn_live",i))(Un||{}),lo=(i=>(i.AliRtcSdkInteractive="interactive",i.AliRtcSdkLive="live",i))(lo||{}),ln=(i=>(i[i.AliEngineLocalDeviceTypeUnknown=0]="AliEngineLocalDeviceTypeUnknown",i[i.AliEngineLocalDeviceTypeMic=1]="AliEngineLocalDeviceTypeMic",i[i.AliEngineLocalDeviceTypeSpeaker=2]="AliEngineLocalDeviceTypeSpeaker",i[i.AliEngineLocalDeviceTypeAudioDevice=3]="AliEngineLocalDeviceTypeAudioDevice",i[i.AliEngineLocalDeviceTypeCamera=4]="AliEngineLocalDeviceTypeCamera",i[i.AliEngineLocalDeviceTypeDisplay=5]="AliEngineLocalDeviceTypeDisplay",i[i.AliEngineLocalDeviceTypeVideoDevice=6]="AliEngineLocalDeviceTypeVideoDevice",i))(ln||{}),vi=(i=>(i[i.AliEngineLocalDeviceExceptionTypeUnknown=0]="AliEngineLocalDeviceExceptionTypeUnknown",i[i.AliEngineLocalDeviceExceptionTypeMicOpenFail=1]="AliEngineLocalDeviceExceptionTypeMicOpenFail",i[i.AliEngineLocalDeviceExceptionTypeMicInterrupt=2]="AliEngineLocalDeviceExceptionTypeMicInterrupt",i[i.AliEngineLocalDeviceExceptionTypeMicAuthFail=3]="AliEngineLocalDeviceExceptionTypeMicAuthFail",i[i.AliEngineLocalDeviceExceptionTypeMicNotAvailable=4]="AliEngineLocalDeviceExceptionTypeMicNotAvailable",i[i.AliEngineLocalDeviceExceptionTypeSpeakerOpenFail=5]="AliEngineLocalDeviceExceptionTypeSpeakerOpenFail",i[i.AliEngineLocalDeviceExceptionTypeSpeakerInterrupt=6]="AliEngineLocalDeviceExceptionTypeSpeakerInterrupt",i[i.AliEngineLocalDeviceExceptionTypeSpeakerNotAvailable=7]="AliEngineLocalDeviceExceptionTypeSpeakerNotAvailable",i[i.AliEngineLocalDeviceExceptionTypeAudioDeviceException=8]="AliEngineLocalDeviceExceptionTypeAudioDeviceException",i[i.AliEngineLocalDeviceExceptionTypeCameraOpenFail=9]="AliEngineLocalDeviceExceptionTypeCameraOpenFail",i[i.AliEngineLocalDeviceExceptionTypeCameraInterrupt=10]="AliEngineLocalDeviceExceptionTypeCameraInterrupt",i[i.AliEngineLocalDeviceExceptionTypeCameraAuthFail=11]="AliEngineLocalDeviceExceptionTypeCameraAuthFail",i[i.AliEngineLocalDeviceExceptionTypeDisplayException=12]="AliEngineLocalDeviceExceptionTypeDisplayException",i[i.AliEngineLocalDeviceExceptionTypeVideoDeviceException=13]="AliEngineLocalDeviceExceptionTypeVideoDeviceException",i))(vi||{}),Et=(i=>(i[i.AliRtcConnectionStatusInit=0]="AliRtcConnectionStatusInit",i[i.AliRtcConnectionStatusDisconnected=1]="AliRtcConnectionStatusDisconnected",i[i.AliRtcConnectionStatusConnecting=2]="AliRtcConnectionStatusConnecting",i[i.AliRtcConnectionStatusConnected=3]="AliRtcConnectionStatusConnected",i[i.AliRtcConnectionStatusReconnecting=4]="AliRtcConnectionStatusReconnecting",i[i.AliRtcConnectionStatusFailed=5]="AliRtcConnectionStatusFailed",i))(Et||{}),an=(i=>(i[i.AliRtcConnectionChangedDummyReason=0]="AliRtcConnectionChangedDummyReason",i[i.AliRtcConnectionMediaPathChanged=1]="AliRtcConnectionMediaPathChanged",i[i.AliRtcConnectionSignalingHeartbeatTimeout=2]="AliRtcConnectionSignalingHeartbeatTimeout",i[i.AliRtcConnectionSignalingHeartbeatAlive=3]="AliRtcConnectionSignalingHeartbeatAlive",i[i.AliRtcConnectionSignalingHttpDnsResolved=4]="AliRtcConnectionSignalingHttpDnsResolved",i[i.AliRtcConnectionSignalingHttpDnsFailure=5]="AliRtcConnectionSignalingHttpDnsFailure",i[i.AliRtcConnectionSignalingGslbFailure=6]="AliRtcConnectionSignalingGslbFailure",i[i.AliRtcConnectionSignalingGslbSuccess=7]="AliRtcConnectionSignalingGslbSuccess",i[i.AliRtcConnectionSignalingJoinRoomFailure=8]="AliRtcConnectionSignalingJoinRoomFailure",i[i.AliRtcConnectionSignalingJoinRoomSuccess=9]="AliRtcConnectionSignalingJoinRoomSuccess",i[i.AliRtcConnectionSignalingLeaveRoom=10]="AliRtcConnectionSignalingLeaveRoom",i[i.AliRtcConnectionSignalingConnecting=11]="AliRtcConnectionSignalingConnecting",i[i.AliRtcConnectionChangedNetworkInterrupted=12]="AliRtcConnectionChangedNetworkInterrupted",i))(an||{}),rf=(i=>(i[i.AliRtcUserOfflineQuit=0]="AliRtcUserOfflineQuit",i[i.AliRtcUserOfflineDropped=1]="AliRtcUserOfflineDropped",i[i.AliRtcUserOfflineBecomeAudience=2]="AliRtcUserOfflineBecomeAudience",i))(rf||{}),da=(i=>(i[i.AliRtcAudioTrackNo=0]="AliRtcAudioTrackNo",i[i.AliRtcAudioTrackMic=1]="AliRtcAudioTrackMic",i[i.AliRtcAudioTrackDual=2]="AliRtcAudioTrackDual",i))(da||{}),Rt=(i=>(i[i.AliRtcVideoTrackNo=0]="AliRtcVideoTrackNo",i[i.AliRtcVideoTrackCamera=1]="AliRtcVideoTrackCamera",i[i.AliRtcVideoTrackScreen=2]="AliRtcVideoTrackScreen",i[i.AliRtcVideoTrackBoth=3]="AliRtcVideoTrackBoth",i))(Rt||{}),tt=(i=>(i[i.AliRtcStatePublishIdle=0]="AliRtcStatePublishIdle",i[i.AliRtcStateNoPublish=1]="AliRtcStateNoPublish",i[i.AliRtcStatePublishing=2]="AliRtcStatePublishing",i[i.AliRtcStatePublished=3]="AliRtcStatePublished",i[i.AliRtcStateReconnecting=4]="AliRtcStateReconnecting",i))(tt||{}),ht=(i=>(i[i.AliRtcStateSubscribeIdle=0]="AliRtcStateSubscribeIdle",i[i.AliRtcStateNoSubscribe=1]="AliRtcStateNoSubscribe",i[i.AliRtcStateSubscribing=2]="AliRtcStateSubscribing",i[i.AliRtcStateSubscribed=3]="AliRtcStateSubscribed",i[i.AliRtcStateReconnecting=4]="AliRtcStateReconnecting",i))(ht||{}),Di=(i=>(i[i.AliRtcVideoStreamTypeNone=0]="AliRtcVideoStreamTypeNone",i[i.AliRtcVideoStreamTypeHigh=1]="AliRtcVideoStreamTypeHigh",i[i.AliRtcVideoStreamTypeLow=2]="AliRtcVideoStreamTypeLow",i))(Di||{}),Ss=(i=>(i[i.CAMERA_INVALID=-1]="CAMERA_INVALID",i[i.CAMERA_REAR=0]="CAMERA_REAR",i[i.CAMERA_FRONT=1]="CAMERA_FRONT",i))(Ss||{});const P0="ALI_RTC_SDK_ALLOCATE_RESULT",gS=class tl{constructor(e,n,o){W(this,"result",null),W(this,"pms");let u=localStorage.getItem(P0);if(u){const y=JSON.parse(u);y.appId===n.appId&&y.expireTs-3e5>Date.now()?this.result=y.allocatedData:ke.info(`[${tl.logName}]`,"allocate","cached data is invalid")}const{appId:g,channelId:c,userId:s,timestamp:d,token:l,nonce:p}=n,S=new URLSearchParams({appid:g,channelid:c,userid:s,timestamp:`${d}`,token:l,nonce:p??"",adapt:"true",clitype:"2"});o&&S.set("joinmode",o);const T=e===Dr.pre?ua.pre:ua.prod;this.pms=fetch(`https://${T}/gslb/v1/allocate?${S.toString()}`,{method:"POST",body:JSON.stringify(Sl.adaptInfo)}).then(y=>y.json()).then(y=>{if(y.code===0){const R=y.data;this.result=R;const{ice_ufrag:v}=R.h5auth,[h,m]=atob(v).split("_"),_={appId:g,expireTs:1e3*parseInt(m),allocatedData:R};return ke.info(`[${tl.logName}]`,"got allocate result and save",R.h5auth.ice_ufrag),localStorage.setItem(P0,JSON.stringify(_)),R}return null}).catch(y=>(ke.error(`[${tl.logName}]`,"allocate",y),null))}};W(gS,"logName","Allocator");let ih=gS;var je=(i=>(i[i.ERR_JOIN_ALREADY_JOINED=16843521]="ERR_JOIN_ALREADY_JOINED",i[i.ERR_JOIN_BAD_APPID=33620481]="ERR_JOIN_BAD_APPID",i[i.ERR_JOIN_INVALID_APPID=33620482]="ERR_JOIN_INVALID_APPID",i[i.ERR_JOIN_BAD_CHANNEL=33620484]="ERR_JOIN_BAD_CHANNEL",i[i.ERR_JOIN_INVALID_CHANNEL=33620483]="ERR_JOIN_INVALID_CHANNEL",i[i.ERR_JOIN_BAD_TOKEN=33620485]="ERR_JOIN_BAD_TOKEN",i[i.ERR_JOIN_TIMEOUT=16908804]="ERR_JOIN_TIMEOUT",i[i.ERR_JOIN_ERR_JOIN_BAD_PARAMBAD=16974081]="ERR_JOIN_ERR_JOIN_BAD_PARAMBAD",i[i.ERR_JOIN_CHANNEL_FAILED=16974338]="ERR_JOIN_CHANNEL_FAILED",i[i.ERR_LOG_ALREADY_INIT=16974085]="ERR_LOG_ALREADY_INIT",i[i.ERR_LOG_ROOT_PATH_ERROR=16974086]="ERR_LOG_ROOT_PATH_ERROR",i[i.ERR_MIC_OPEN_FAIL=17040388]="ERR_MIC_OPEN_FAIL",i[i.ERR_SPEAKER_OPEN_FAIL=17040389]="ERR_SPEAKER_OPEN_FAIL",i[i.ERR_MIC_INTERRUPT=17040390]="ERR_MIC_INTERRUPT",i[i.ERR_SPEAKER_INTERRUPT=17040391]="ERR_SPEAKER_INTERRUPT",i[i.ERR_MIC_AUTH_FAIL=17040392]="ERR_MIC_AUTH_FAIL",i[i.ERR_MIC_NOT_AVAILABLE=17040393]="ERR_MIC_NOT_AVAILABLE",i[i.ERR_SPEAKER_NOT_AVAILABLE=17040400]="ERR_SPEAKER_NOT_AVAILABLE",i[i.ERR_CAMERA_OPEN_FAIL=17039620]="ERR_CAMERA_OPEN_FAIL",i[i.ERR_CAMERA_AUTH_FAIL=17039621]="ERR_CAMERA_AUTH_FAIL",i[i.ERR_CAMERA_INTERRUPT=17039622]="ERR_CAMERA_INTERRUPT",i[i.ERR_CAMERA_NOT_AVAILABLE=17039623]="ERR_CAMERA_NOT_AVAILABLE",i[i.ERR_VIDEO_DISPLAY_OPEN_FAIL=17039873]="ERR_VIDEO_DISPLAY_OPEN_FAIL",i[i.ERR_VIDEO_DISPLAY_INTERRUPT=1064992]="ERR_VIDEO_DISPLAY_INTERRUPT",i[i.ERR_ICE_CONNECTION_CONNECT_FAIL=17105409]="ERR_ICE_CONNECTION_CONNECT_FAIL",i[i.ERR_ICE_CONNECTION_RECONNECT_FAI=17105410]="ERR_ICE_CONNECTION_RECONNECT_FAI",i[i.ERR_ICE_CONNECTION_MOBILITY_FAIL=17105411]="ERR_ICE_CONNECTION_MOBILITY_FAIL",i[i.ERR_ICE_CONNECTION_HEARTBEAT_TIMEOUT=16908812]="ERR_ICE_CONNECTION_HEARTBEAT_TIMEOUT",i[i.ERR_LATENCY_LIVE_COMMUNICATION_FAILED=17235971]="ERR_LATENCY_LIVE_COMMUNICATION_FAILED",i[i.ERR_LATENCY_LIVE_MEIDASETTING_FAILED=17235972]="ERR_LATENCY_LIVE_MEIDASETTING_FAILED",i[i.ERR_LATENCY_LIVE_NONE_BROADCASTER=17235973]="ERR_LATENCY_LIVE_NONE_BROADCASTER",i[i.ERR_LATENCY_LIVE_NEED_RESTART=17235974]="ERR_LATENCY_LIVE_NEED_RESTART",i[i.ERR_LATENCY_LIVE_NEED_RESTART_AGAIN_LATER=17235975]="ERR_LATENCY_LIVE_NEED_RESTART_AGAIN_LATER",i[i.ERR_LATENCY_LIVE_SERVICE_UNAVAILABLE=17235976]="ERR_LATENCY_LIVE_SERVICE_UNAVAILABLE",i[i.ERR_LATENCY_LIVE_MEDIACONNECTION_INTERRUPTION=17235977]="ERR_LATENCY_LIVE_MEDIACONNECTION_INTERRUPTION",i[i.ERR_SDK_PUBLISH_INVAILD=16974597]="ERR_SDK_PUBLISH_INVAILD",i[i.ERR_SDK_PUBLISH_NOT_JOIN_CHANNEL=16843782]="ERR_SDK_PUBLISH_NOT_JOIN_CHANNEL",i[i.ERR_SDK_PUBLISH_AUDIO_STREAM_FAILED=16843856]="ERR_SDK_PUBLISH_AUDIO_STREAM_FAILED",i[i.ERR_SDK_PUBLISH_VIDEO_STREAM_FAILED=16843857]="ERR_SDK_PUBLISH_VIDEO_STREAM_FAILED",i[i.ERR_SDK_PUBLISH_DUAL_STREAM_FAILED=16843858]="ERR_SDK_PUBLISH_DUAL_STREAM_FAILED",i[i.ERR_SDK_PUBLISH_SCEEN_SHARE_FAILED=16843859]="ERR_SDK_PUBLISH_SCEEN_SHARE_FAILED",i[i.ERR_SDK_PUBLISH_SCREEN_SHARE_CONFIG_ERROR=16843860]="ERR_SDK_PUBLISH_SCREEN_SHARE_CONFIG_ERROR",i[i.ERR_SDK_SUBSCRIBE_INVAILD=16974852]="ERR_SDK_SUBSCRIBE_INVAILD",i[i.ERR_SDK_SUBSCRIBE_NOT_JOIN_CHANNEL=16844112]="ERR_SDK_SUBSCRIBE_NOT_JOIN_CHANNEL",i[i.ERR_SDK_SUBSCRIBE_AUDIO_STREAM_FAILED=16844113]="ERR_SDK_SUBSCRIBE_AUDIO_STREAM_FAILED",i[i.ERR_SDK_SUBSCRIBE_VIDEO_STREAM_FAILED=16844114]="ERR_SDK_SUBSCRIBE_VIDEO_STREAM_FAILED",i[i.ERR_SDK_SUBSCRIBE_DUAL_STREAM_FAILED=16844115]="ERR_SDK_SUBSCRIBE_DUAL_STREAM_FAILED",i[i.ERR_SDK_SUBSCRIBE_SCREEN_SHARE_FAILED=16844116]="ERR_SDK_SUBSCRIBE_SCREEN_SHARE_FAILED",i[i.ERR_SDK_SUBSCRIBE_DATA_FAILED=16844117]="ERR_SDK_SUBSCRIBE_DATA_FAILED",i[i.ERR_SDK_SUBSCRIBE_DATA_ERROR=16844118]="ERR_SDK_SUBSCRIBE_DATA_ERROR",i[i.ERR_SDK_INVALID_STATE=16974340]="ERR_SDK_INVALID_STATE",i[i.ERR_INVALID_ARGUMENTS=16974083]="ERR_INVALID_ARGUMENTS",i[i.ERR_SESSION_REMOVED=33620229]="ERR_SESSION_REMOVED",i[i.ERR_SDK_UPDATE_ROLE_CHANNEL=16908801]="ERR_SDK_UPDATE_ROLE_CHANNEL",i[i.ERR_INNER=-1]="ERR_INNER",i[i.ERR_SDK_MPU_TASK_PUBLISH_OK=0]="ERR_SDK_MPU_TASK_PUBLISH_OK",i[i.ERR_SDK_MPU_TASK_STREAM_NOT_FOUND=17825793]="ERR_SDK_MPU_TASK_STREAM_NOT_FOUND",i[i.ERR_SDK_MPU_TASK_STREAM_ALREADY_EXIST=17825794]="ERR_SDK_MPU_TASK_STREAM_ALREADY_EXIST",i[i.ERR_SDK_MPU_TASK_INVALID_PARAM=17825795]="ERR_SDK_MPU_TASK_INVALID_PARAM",i[i.ERR_SDK_MPU_TASK_INTERNAL_ERROR=17825796]="ERR_SDK_MPU_TASK_INTERNAL_ERROR",i[i.ERR_SDK_MPU_TASK_RTMP_SERVER_ERROR=17825797]="ERR_SDK_MPU_TASK_RTMP_SERVER_ERROR",i[i.ERR_SDK_MPU_TASK_RTMP_STREAM_URL_ERROR=17825798]="ERR_SDK_MPU_TASK_RTMP_STREAM_URL_ERROR",i[i.ERR_SDK_MPU_TASK_PUBLISH_TIMEOUT=17825799]="ERR_SDK_MPU_TASK_PUBLISH_TIMEOUT",i[i.ERR_SDK_MPU_TASK_NOT_AUTHORIZED=17825800]="ERR_SDK_MPU_TASK_NOT_AUTHORIZED",i[i.ERR_SDK_CHANNEL_RELAY_STATE_ERROR=18874369]="ERR_SDK_CHANNEL_RELAY_STATE_ERROR",i[i.ERR_SDK_CHANNEL_RELAY_SRC_NOT_ALLOW=18874370]="ERR_SDK_CHANNEL_RELAY_SRC_NOT_ALLOW",i[i.ERR_SDK_CHANNEL_RELAY_JOIN_DEST_FAILED=18874371]="ERR_SDK_CHANNEL_RELAY_JOIN_DEST_FAILED",i[i.ERR_SDK_CHANNEL_RELAY_TOKEN_INVALID=18874372]="ERR_SDK_CHANNEL_RELAY_TOKEN_INVALID",i[i.ERR_SDK_CHANNEL_RELAY_ROLE_ERROR=18874373]="ERR_SDK_CHANNEL_RELAY_ROLE_ERROR",i[i.ERR_SDK_CHANNEL_RELAY_INVALID_PARAM=18874374]="ERR_SDK_CHANNEL_RELAY_INVALID_PARAM",i[i.ERR_SDK_CHANNEL_RELAY_TO_SELF_ERROR=18874375]="ERR_SDK_CHANNEL_RELAY_TO_SELF_ERROR",i))(je||{});class Ve extends Error{constructor(e,n,o){super(n),W(this,"_code"),W(this,"_extra"),this._code=e,this._extra=o}static fromRtsError(e){return e instanceof Ve?e:new Ve(e?.errorCode||-1,e?.message||e?.errorCodeName||"rts error",e)}static fromError(e,n=-1,o=""){return new Ve(n,e?.message||e?.reason||o||"error",e)}get code(){return this._code}set code(e){this._code=e}get reason(){return this.message}get extra(){return this._extra}}function L0(i){var e;if(((e=i?.nodeName)==null?void 0:e.toLowerCase())==="video")return i.setAttribute("playsinline",""),i;if(typeof i=="string"){let n=document.getElementById(i);if(n){if(n.nodeName.toLocaleLowerCase()==="video")return n.setAttribute("playsinline",""),n;throw new Ve(je.ERR_INVALID_ARGUMENTS,"element should be HtmlVideoElement")}throw new Ve(je.ERR_INVALID_ARGUMENTS,"element not founded")}throw new Ve(je.ERR_INVALID_ARGUMENTS,"element id should be string")}function Ph(i){var e;const n=[];if(Array.isArray(i))i.forEach(o=>{try{n.push(L0(o))}catch{}});else if(typeof i=="string"||((e=i?.nodeName)==null?void 0:e.toLowerCase())==="video")try{n.push(L0(i))}catch{}return n}function Bn(i){return new Promise(e=>setTimeout(e,i))}function U0(i,e,n=1e3,o=u=>!0){return pe(this,null,function*(){let u=0;for(;u<e;)try{return yield i(u)}catch(g){if(u++,u>=e||!o(g))throw g||void 0;yield new Promise(c=>setTimeout(c,n))}})}function rh(i,e){let n=e;return typeof window.__ali_prefer_media_server=="string"&&window.__ali_prefer_media_server!==""&&(n=window.__ali_prefer_media_server),n?`${i}&ali_prefer_media_server=${n}`:i}function uo(i,e){var n;try{const{archCfgs:o}=i;if(!o||!Array.isArray(o))return;const u=o.find(g=>g.arch==="grtn");return u?(n=u.user_specified)==null?void 0:n[e]:void 0}catch{return}}function ra(i,e){try{const{config:n}=i;return n?n?.[e]:void 0}catch{return}}class nf{constructor(e,n){W(this,"originTrack"),W(this,"originVideo"),W(this,"targetWidth"),W(this,"targetHeight"),W(this,"targetFrameRate"),W(this,"targetCanvas"),W(this,"animationFrameId"),W(this,"resultTrack"),this.targetWidth=n.width,this.targetHeight=n.height,this.targetFrameRate=n.frameRate,this.originTrack=e,this.originVideo=document.createElement("video"),this.originVideo.muted=!0,this.originVideo.autoplay=!0,this.originVideo.controls=!1,this.targetCanvas=document.createElement("canvas"),this.targetCanvas.width=this.targetWidth,this.targetCanvas.height=this.targetHeight}updateOptions(e){this.targetWidth=e.width,this.targetHeight=e.height,this.targetFrameRate=e.frameRate,this.targetCanvas.width=this.targetWidth,this.targetCanvas.height=this.targetHeight,this.resultTrack&&this.resultTrack.applyConstraints({frameRate:this.targetFrameRate})}dispose(){}getVideoTrack(){return this.resultTrack||(this.resultTrack=this.targetCanvas.captureStream().getVideoTracks()[0],this.resultTrack.applyConstraints({frameRate:this.targetFrameRate})),this.resultTrack}cancelAnimation(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=void 0)}getPositionAndSize(e,n,o,u){const g=n/e,c=u/o;let s=o,d=u,l=0,p=0;return c>g?(s=Math.round(d/g),l=Math.round((o-s)/2)):c<g&&(d=Math.round(s*g),p=Math.round((u-d)/2)),{x:l,y:p,width:s,height:d}}}class I_ extends nf{constructor(e,n){super(e,n),W(this,"targetCtx"),this.targetCtx=this.targetCanvas.getContext("2d"),this.startRender=this.startRender.bind(this),this.stopRender=this.startRender.bind(this),this.initStream(e)}initStream(e){const n=new MediaStream;n.addTrack(e),this.originVideo.srcObject=n,this.originVideo.play(),this.originVideo.addEventListener("canplay",this.startRender),this.originVideo.addEventListener("pause",this.stopRender),this.originVideo.addEventListener("ended",this.stopRender)}startRender(){this.cancelAnimation();const e=()=>{if(!this.targetCtx)return;const n=this.getPositionAndSize(this.originVideo.videoWidth,this.originVideo.videoHeight,this.targetWidth,this.targetHeight);this.targetCtx.drawImage(this.originVideo,0,0,this.originVideo.videoWidth,this.originVideo.videoHeight,n.x,n.y,n.width,n.height),this.originVideo.paused||this.originVideo.ended||(this.animationFrameId=requestAnimationFrame(e))};e()}stopRender(){this.cancelAnimation()}dispose(){this.stopRender(),this.originVideo.removeEventListener("play",this.startRender),this.originVideo.removeEventListener("pause",this.stopRender),this.originVideo.removeEventListener("ended",this.stopRender),this.originVideo.pause(),this.originVideo.srcObject=null}}function x0(i,e,n){const o=i.createShader(e);if(o)return i.shaderSource(o,n),i.compileShader(o),i.getShaderParameter(o,i.COMPILE_STATUS)?o:(console.error(`An error occurred compiling the shaders: ${i.getShaderInfoLog(o)}`),i.deleteShader(o),null);console.error("create shader failed")}class B0 extends nf{constructor(e,n){super(e,n),W(this,"targetCtx"),W(this,"targetTexture"),W(this,"locationMap"),this.targetCtx=this.targetCanvas.getContext("webgl2"),this.locationMap={},this.startRender=this.startRender.bind(this),this.stopRender=this.startRender.bind(this),this.updateBuffer=this.updateBuffer.bind(this),this.initGL(),this.initStream(e)}static isSupport(){return(function(){let e;try{const n=document.createElement("canvas");n.width=1,n.height=1;const o={alpha:!1,depth:!1,stencil:!1,antialias:!1,preferLowPowerToHighPerformance:!0};e=n.getContext("webgl2",o)}catch{return!1}return!!e})()}initGL(){const e=this.targetCtx;if(!e)return;this.targetTexture=(function(s){const d=s.createTexture();return s.bindTexture(s.TEXTURE_2D,d),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),d})(e);const n=(function(s,d,l){const p=x0(s,s.VERTEX_SHADER,d),S=x0(s,s.FRAGMENT_SHADER,l),T=s.createProgram();if(T&&p&&S)return s.attachShader(T,p),s.attachShader(T,S),s.linkProgram(T),s.getProgramParameter(T,s.LINK_STATUS)?T:(console.error(`Unable to initialize the shader program: ${s.getProgramInfoLog(T)}`),null)})(e,`
attribute vec2 a_position;
attribute vec2 a_texCoord;

uniform vec2 u_resolution;
varying vec2 v_texCoord;

void main() {
  // convert the rectangle from pixels to 0.0 to 1.0
  vec2 zeroToOne = a_position / u_resolution;

  // convert from 0->1 to 0->2
  vec2 zeroToTwo = zeroToOne * 2.0;

  // convert from 0->2 to -1->+1 (clipspace)
  vec2 clipSpace = zeroToTwo - 1.0;

  gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);

  v_texCoord = a_texCoord;
}
`,`
precision mediump float;

varying lowp vec2 v_texCoord;
uniform sampler2D u_texture;

void main() {
  gl_FragColor = texture2D(u_texture, v_texCoord);
}
`);if(!n)return void console.log("[ScalerWebGL] program is null.");e.useProgram(n);const o=e.getAttribLocation(n,"a_position"),u=e.getAttribLocation(n,"a_texCoord"),g=e.getUniformLocation(n,"u_resolution");if(!g)return void console.log("[ScalerWebGL] resolutionLocation is null.");const c=e.getUniformLocation(n,"u_texture");c?(this.locationMap={program:n,positionLocation:o,texCoordLocation:u,resolutionLocation:g,textureLocation:c},this.updateBuffer()):console.log("[ScalerWebGL] textureLocation is null.")}initStream(e){const n=new MediaStream;n.addTrack(e),this.originVideo.srcObject=n,this.originVideo.play(),this.originVideo.addEventListener("canplay",this.startRender),this.originVideo.addEventListener("pause",this.stopRender),this.originVideo.addEventListener("ended",this.stopRender),this.originVideo.addEventListener("resize",this.updateBuffer)}startRender(){this.cancelAnimation();const e=()=>{this.targetCtx&&(this.renderTexture(),this.originVideo.paused||this.originVideo.ended||(this.animationFrameId=requestAnimationFrame(e)))};e()}updateBuffer(){const e=this.targetCtx,n=this.locationMap.positionLocation,o=this.locationMap.texCoordLocation,u=this.locationMap.resolutionLocation;if(!e||!this.originVideo.videoWidth||!this.originVideo.videoHeight)return;const g=this.getPositionAndSize(this.originVideo.videoWidth,this.originVideo.videoHeight,this.targetWidth,this.targetHeight),c=(function(d,l,p,S=0,T=0){const y=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,y);const R=l+S,v=p+T,h=[S,T,R,T,S,v,S,v,R,T,R,v];return d.bufferData(d.ARRAY_BUFFER,new Float32Array(h),d.STATIC_DRAW),y})(e,g.width,g.height,g.x,g.y);e.enableVertexAttribArray(n),e.bindBuffer(e.ARRAY_BUFFER,c),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(o);const s=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,s),e.vertexAttribPointer(o,2,e.FLOAT,!1,0,0),e.uniform2f(u,this.targetWidth,this.targetHeight)}renderTexture(){const e=this.targetTexture,n=this.targetCtx,o=this.locationMap.textureLocation;e&&n&&(n.bindTexture(n.TEXTURE_2D,e),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,this.originVideo),n.useProgram(this.locationMap.program),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,e),n.uniform1i(o,0),n.viewport(0,0,n.canvas.width,n.canvas.height),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.drawArrays(n.TRIANGLES,0,6))}stopRender(){this.cancelAnimation()}updateOptions(e){super.updateOptions(e),this.updateBuffer()}dispose(){this.stopRender(),this.originVideo.removeEventListener("play",this.startRender),this.originVideo.removeEventListener("pause",this.stopRender),this.originVideo.removeEventListener("ended",this.stopRender),this.originVideo.removeEventListener("resize",this.updateBuffer),this.originVideo.pause(),this.originVideo.srcObject=null}}class V0 extends nf{constructor(e,n){super(e,n),W(this,"processor"),W(this,"trackGenerator"),W(this,"worker"),this.processor=new MediaStreamTrackProcessor({track:e}),this.trackGenerator=new MediaStreamTrackGenerator({kind:"video"}),this.startTransform()}static isSupport(){return"MediaStreamTrackProcessor"in window&&"MediaStreamTrackGenerator"in window&&"TransformStream"in window&&"VideoFrame"in window}startTransform(){const e=new Blob([`
var targetOptions={
  width: 320,
  height: 180,
  ratio: 0.5625,
  interval: 66,
};
var timer;
var reader;
var writer;

function updateOptions(data) {
  targetOptions.width=data.width||320;
  targetOptions.height=data.height||180;
  targetOptions.ratio=targetOptions.height/targetOptions.width;
  targetOptions.interval=Math.floor(1000/data.frameRate)||66;
}

function postError(err, defaultMsg) {
  var msg=err ? err.message : '';
  postMessage({ type: 'error', messge: msg || defaultMsg });
}

function startLoop(data) {
  if(timer){
    clearInterval(timer);
  }
  timer=setInterval(() => {
    reader.read().then(function (ret){
      var videoFrame=ret.value;
      if(ret.done || !videoFrame) {
        return;
      }

      var vratio=videoFrame.displayHeight/videoFrame.displayWidth;
      var vw=videoFrame.displayWidth;
      var vh=videoFrame.displayHeight;
      var vx=0;
      var vy=0;
      if(targetOptions.ratio>vratio){
        vw=Math.round(vh/targetOptions.ratio);
        vx=Math.round((videoFrame.displayWidth-vw)/2);
      }else if(targetOptions.ratio<vratio){
        vh=Math.round(vw*targetOptions.ratio);
        vy=Math.round((videoFrame.displayHeight-vh)/2);
      }
      var newFrame=new VideoFrame(videoFrame,{
        displayWidth:targetOptions.width,
        displayHeight:targetOptions.height,
        visibleRect:{
          x:vx,
          y:vy,
          width:vw,
          height:vh,
        },
        timestamp:videoFrame.timestamp,
      });

      writer.write(newFrame).catch(function (err){
        postError(err, 'write error');
      });
      videoFrame.close();
    }).catch(function (err){
      postError(err, 'read error');
    });
  }, targetOptions.interval);
}

onmessage = function(evt) {
  var data=evt.data;
  switch (data.type) {
    case 'startRender':
      updateOptions(data);
      reader=data.readable.getReader();
      writer=data.writable.getWriter();
      startLoop(data);
      break;
    case 'updateOptions':
      updateOptions(data);
      startLoop(data);
      break;
    default:
      break;
  }
}
`],{type:"text/javascript"}),n=(window.URL||window.webkitURL).createObjectURL(e);this.worker=new Worker(n);const{readable:o}=this.processor,{writable:u}=this.trackGenerator;this.worker.postMessage({type:"startRender",readable:o,writable:u,width:this.targetWidth,height:this.targetHeight,frameRate:this.targetFrameRate},[o,u])}updateOptions(e){super.updateOptions(e),this.worker&&this.worker.postMessage(Qe({type:"updateOptions"},e))}dispose(){try{this.processor.readable.cancel(),this.trackGenerator.writable.close()}catch{}}getVideoTrack(){return this.trackGenerator}}class Lh{static isSupport(){return typeof HTMLCanvasElement.prototype.captureStream=="function"}static getInstance(e,n){return V0.isSupport()?new V0(e,n):B0.isSupport()?new B0(e,n):new I_(e,n)}}var H0,j0,M_=Object.defineProperty,ao=(i,e,n)=>(((o,u,g)=>{u in o?M_(o,u,{enumerable:!0,configurable:!0,writable:!0,value:g}):o[u]=g})(i,typeof e!="symbol"?e+"":e,n),n),nh={exports:{}},oh={exports:{}};function Li(){if(j0)return H0;j0=1,Date.now=Date.now||function(){return new Date().getTime()};var i=Date.now(),e=function(){},n={noop:e,warn:(function(){var o=typeof console=="object"?console.warn:e;try{var u={warn:o};u.warn.call(u)}catch{return e}return o})(),key:"__bl",selfErrKey:"ARMS_SDK_ERROR",selfErrPage:"ARMSSDK",win:typeof window=="object"&&window.document?window:void 0,regionMap:{cn:"https://arms-retcode.aliyuncs.com/r.png?",sg:"https://arms-retcode-sg.aliyuncs.com/r.png?",sg_2:"https://retcode-sg-lazada.arms.aliyuncs.com/r.png?",daily:"http://arms-retcode-daily.alibaba.net/r.png?",daily_2:"https://arms-retcode-daily.alibaba.net/r.png?",daily_3:"http://arms-retcode-daily.aliyun.test/r.png?",us:"https://retcode-us-west-1.arms.aliyuncs.com/r.png?",tw:"https://arms-retcode.orientalgame.com.tw/r.png?",tw_sg:"https://arms-retcode-sg.orientalgame.com.tw/r.png?",hz_finance:"https://arms-retcode-hz-finance.aliyuncs.com/r.png?"},defaultImgUrl:"https://arms-retcode.aliyuncs.com/r.png?",createObject:function(o){if(Object.create)return Object.create(o);var u=function(){};return u.prototype=o,new u},each:function(o,u){var g=0,c=o.length;if(this.T(o,"Array"))for(;g<c&&u.call(o[g],o[g],g)!==!1;g++);else for(g in o)if(u.call(o[g],o[g],g)===!1)break;return o},safetyCall:function(o,u,g){if(typeof o!="function")return g;try{return o.apply(this,u)}catch{return g}},T:function(o,u){var g=Object.prototype.toString.call(o).substring(8).replace("]","");return u?g===u:g},duration:function(){var o=Date;try{performance&&this.T(performance.now,"Function")&&(o=performance)}catch{o=Date}var u=o.now();return function(){return Math.round(o.now()-u)}},filterByRule:function(){var o=[].slice.call(arguments),u=o.length;if(u<2)return o[0];var g=o[u-1],c=o[0];if(!c)return"";if(!g)return c;var s=this,d=s.T(g),l=o.slice(0,u-1);return d==="Function"?s.safetyCall(g,l,c):d==="Array"?(this.each(g,function(p){l[0]=c=s.filterByRule.apply(s,[].concat(l,p))}),c):d==="Object"?c.replace(g.rule,g.target||""):c.replace(g,"")},ignoreByRule:function(o,u){if(!o||!u)return!1;if((this.isString(u)||u.source||this.T(u)==="Function")&&(u=[u]),!this.isArray(u))return this.warn("[arms] invalid rules of ignore config, (list of) String/RegExp/Funcitons are available"),!1;for(var g,c=[],s=0,d=u.length;s<d;s++)if(g=u[s],this.isString(g))c.push(g.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"));else if(g&&g.source)c.push(g.source);else if(g&&this.T(g)==="Function"&&this.safetyCall(g,[o],!1)===!0)return!0;var l=new RegExp(c.join("|"),"i");return!!(c.length&&l.test&&l.test(o))},J:function(o){if(!o||typeof o!="string")return o;var u=null;try{u=JSON.parse(o)}catch{}return u},pick:function(o){return o===1||Math.ceil(Math.random()*o)===1},verifyConfig:function(o){if("sample"in o){var u=o.sample,g=u;u&&/^\d+(\.\d+)?%$/.test(u)&&(g=parseInt(100/parseFloat(u))),0<g&&1>g&&(g=parseInt(1/g)),g>=1&&g<=100?o.sample=g:delete o.sample}return o},on:function(o,u,g,c,s){return o.addEventListener?(s=s||!1,o.addEventListener(u,function d(l){c&&o.removeEventListener(u,d,s),g.call(this,l)},s)):o.attachEvent&&o.attachEvent("on"+u,function d(l){c&&o.detachEvent("on"+u,d),g.call(this,l)}),this},off:function(o,u,g){return g?(o.removeEventListener?o.removeEventListener(u,g):o.detachEvent&&o.detachEvent(u,g),this):this},delay:function(o,u){return u===-1?(o(),null):setTimeout(o,u||0)},ext:function(o){for(var u=1,g=arguments.length;u<g;u++){var c=arguments[u];for(var s in c)Object.prototype.hasOwnProperty.call(c,s)&&(o[s]=c[s])}return o},sub:function(o,u){var g={};return this.each(o,function(c,s){u.indexOf(s)!==-1&&(g[s]=c)}),g},uu:function(){for(var o,u,g=20,c=new Array(g),s=Date.now().toString(36).split("");g-- >0;)u=(o=36*Math.random()|0).toString(36),c[g]=o%3?u:u.toUpperCase();for(var d=0;d<8;d++)c.splice(3*d+2,0,s[d]);return c.join("")},guid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(o){var u=16*Math.random()|0;return(o==="x"?u:3&u|8).toString(16)})},seq:function(){return(i++).toString(36)},decode:function(o){try{o=decodeURIComponent(o)}catch{}return o},encode:function(o,u){try{o=u?encodeURIComponent(o).replace(/\(/g,"%28").replace(/\)/g,"%29"):encodeURIComponent(o)}catch{}return o},serialize:function(o){o=o||{};var u=[];for(var g in o)Object.prototype.hasOwnProperty.call(o,g)&&o[g]!==void 0&&u.push(g+"="+this.encode(o[g],g==="msg"));return u.join("&")},checkAPI:function(o,u){if(!o||typeof o!="string")return!1;var g=/arms-retcode[\w-]*\.aliyuncs/.test(o);return!g&&u&&(g=/(alicdn\.com)|(mmstat\.com)/.test(o)),!g},checkAutoError:function(o){return!(!o||!o.message||/failed[\w\s]+fetch/i.test(o.message))},cutUrlSearch:function(o){return o&&typeof o=="string"?o.replace(/^(https?:)?\/\//,"").replace(/\?.*$/,""):""},removeUrlSearch:function(o){return o&&typeof o=="string"?o.replace(/\?.*$/,""):""},createFakeToString:function(o){return function(){return o+"() { [native code] }"}},checkSameOrigin:function(o,u){if(!u||!o)return!1;var g="//"+u.split("/")[2];return o===u||o.slice(0,u.length+1)===u+"/"||o===g||o.slice(0,g.length+1)===g+"/"||!/^(\/\/|http:|https:).*/.test(o)},getRandIP:function(){for(var o=[],u=0;u<4;u++){var g=Math.floor(256*Math.random());o[u]=(g>15?"":"0")+g.toString(16)}return o.join("").replace(/^0/,"1")},getSortNum:function(o){return o?(o+=1)>=1e3&&o<=9999?o:o<1e3?o+1e3:o%1e4+1e3:1e3},getRandNum:function(o){return o&&typeof o=="string"?o.length<5?this.getNum(5):o.substring(o.length-5):this.getNum(5)},getNum:function(o){for(var u=[],g=0;g<o;g++){var c=Math.floor(16*Math.random());u[g]=c.toString(16)}return u.join("")},getCurDomain:function(){return location&&location.hostname||""},getSrcType:function(o,u){var g=location&&location.host||"";if(!g)return"";var c=new URL(o).host;if(c===g)return"self";for(var s=0;s<u.length;s+=1)if(c.includes(u[s]))return"cdn";return"others"},parseFetchHeaders:function(o){if(!o)return{};var u={};try{if(typeof o.keys=="function")for(var g=o.keys(),c=g.next();!c.done;){var s=c.value;u[s]=o.get(s),c=g.next()}else u=o}catch{u={}}return u},parseXhrHeaders:function(o){if(!o&&typeof o!="string")return{};var u={};try{u=o.split(`\r
`).reduce(function(g,c){var s=c.split(": ");return g[s[0]]=s[1],g},{})}catch{u={}}return u},getQuerys:function(o){if(!o)return"";var u={},g=[],c="",s="";try{var d=[];if(o.indexOf("?")>=0&&(d=o.substring(o.indexOf("?")+1,o.length).split("&")),d.length>0)for(var l in d)c=(g=d[l].split("="))[0],s=g[1],u[c]=s}catch{u={}}return u},getURL:function(o){if(!o)return null;var u={},g=o.length,c=o.indexOf("://");if(c<0)return null;u.protocol=o.substring(0,c+1);var s=o.indexOf("#"),d=o.indexOf("?");s<0&&(s=g),d<0&&(d=s),u.search=o.substring(d,s).substring(0,1e3);var l=o.substring(c+3,d),p=l.indexOf("/");return p<0&&(p=l.length),u.domain=l.substring(0,p).split(":")[0],u.path=l.substring(p,l.length).substring(0,1e3),u},getResType:function(o,u){if(["script","img","other"].indexOf(o)>-1)return o;if(["video"].indexOf(o)>-1)return"media";if(["document","iframe"].indexOf(o)>-1)return"doc";var g=u?this.getURL(u):null,c=g&&g.path?g.path.lastIndexOf("."):-1,s=(c>0?g.path.substr(c+1):"").toLowerCase();if(s){if(["eot","woff","woff2","ttf"].indexOf(s)>-1)return"font";if(s==="css")return"css";if(s==="js")return"script"}return["fetch","xmlhttprequest","beacon"].indexOf(o)>-1?"api":"others"},areInOrder:function(){for(var o=1;o<arguments.length;o+=1)if(arguments[o-1]>arguments[o])return!1;return!0},getFetchSnapshot:function(o,u,g){var c,s;try{var d=(o&&typeof o[0]!="string"?o[0].url:o[0])||"",l=(o&&typeof o[0]!="string"?o[0]:o[1])||{},p=l.method.toUpperCase()==="POST"?l.body:this.getQuerys(d);c={originApi:d,method:l.method||"unknown",params:p,response:u||"",reqHeaders:this.parseFetchHeaders(l.headers||null),resHeaders:this.parseFetchHeaders(g)},s=JSON&&JSON.stringify(c)||"{}"}catch{s="{}"}return s},getXhrSnapshot:function(o,u,g){if(!o||!u||!g)return{};var c,s;try{var d="";g.responseType===""||g.responseType==="text"?d=g.responseText:g.responseType==="document"&&(d=g.responseXML),c={originApi:o,method:u,params:this.getQuerys(o),response:d,reqHeaders:{},resHeaders:this.parseXhrHeaders(typeof g.getAllResponseHeaders=="function"&&g.getAllResponseHeaders()||"")},s=JSON&&JSON.stringify(c)||"{}"}catch{s="{}"}return s},isRobot:function(){var o=["nuhk","googlebot/","googlebot-image","yammybot","openbot","slurp","msnbot","ask jeeves/teoma","ia_archiver","baiduspider","bingbot/","adsbot"];if(!navigator||typeof navigator.userAgent!="string")return!1;try{for(var u=navigator.userAgent.toLowerCase(),g=0;g<o.length;g++){var c=o[g];if(u.lastIndexOf(c)>=0)return!0}}catch{this.warn("[arms] useragent parse error")}return!1},isFunction:function(o){return typeof o=="function"},isPlainObject:function(o){return Object.prototype.toString.call(o)==="[object Object]"},isString:function(o){return Object.prototype.toString.call(o)==="[object String]"},isArray:function(o){return Object.prototype.toString.call(o)==="[object Array]"},joinRegExp:function(o){for(var u,g=[],c=0,s=o.length;c<s;c++)u=o[c],this.isString(u)?g.push(u.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")):u&&u.source&&g.push(u.source);return new RegExp(g.join("|"),"i")},reWriteMethod:function(o,u,g){if(o!==null){var c=o[u];o[u]=g(c)}},checkSDKError:function(o,u){return!(!o&&!u)&&(!!new RegExp(this.selfErrKey,"i").test(o)||!!this.ignoreByRule(u,[/retcode.alicdn.com\/retcode\/bl.js/,/g.alicdn.com\/retcode\/cloud-sdk\/bl.js/,/laz-g-cdn.alicdn.com\/retcode\/cloud-sdk\/bl.js/,/local.taobao.com:8880\/build\/bl/]))},sdkError:function(o){return{msg:o,message:this.selfErrKey}},dealParam:function(o,u,g){var c={};try{c=this.isPlainObject(o)?this.ext({key:o.key||"default",val:o.val||o.value||g},o,{begin:Date.now()}):{key:o||"default",val:u||g,begin:Date.now()}}catch(s){this.warn("[retcode] baseLog error: "+s)}return c}};return H0=n}var ah,z0,F0,G0,sh={exports:{}},ch={exports:{}};function N_(){if(F0)return ch.exports;F0=1;var i=Li(),e=(function(){if(z0)return ah;z0=1;var g=Li();return ah=function(c,s,d){typeof c=="object"&&(c=g.serialize(c));var l=s+c+(d?"&post_res=":"");window&&window.navigator&&typeof window.navigator.sendBeacon=="function"?window.navigator.sendBeacon(l,d||"&post_res="):g.warn("[arms] navigator.sendBeacon not surported")},ah})(),n="aokcdqn3ly@e629dabd48a9933",o=function(g,c){var s;if(c.t==="error"&&(s=g.requestQueue[0])&&s.t==="error"&&c.msg===s.msg)return c.times=s.times+1,void(g.requestQueue[0]=c);if(c.t==="behavior"){var d=g.requestQueue&&g.requestQueue.length;if(d>0&&g.requestQueue[d-1].t==="behavior"){var l=c.behavior||[];g.requestQueue[d-1].behavior.concat(l)}else g.requestQueue.push(c)}else g.requestQueue.unshift(c);return g.onReady(function(){g.requestTimmer=i.delay(function(){g.clear()},g.requestQueue[0]&&g.requestQueue[0].t==="error"?3e3:-1)}),!0},u=function(g){return this.ver="1.8.36-beta.12",this._conf=i.ext({},u.dftCon),this.sampleCache={},this.requestQueue=[],this.selfQueue=[],this.sdkFlag=!0,this.hash=i.seq(),this.resetPageview(),this.setConfig(g),this.rip=i.getRandIP(),this.record=999,this["EagleEye-TraceID"]=this.getTraceId()["EagleEye-TraceID"],this._common={},this};return u.dftCon={sample:1,pvSample:1,tag:"",imgUrl:"https://arms-retcode.aliyuncs.com/r.png?",region:null,ignore:{ignoreUrls:[],ignoreApis:[],ignoreErrors:[/^Script error\.?$/],ignoreResErrors:[],ignoreResources:[/\/(bl|wl)(.debug)?.js$/]},release:void 0,environment:"prod",beforeReport:null,parseTraceId:null},u.prototype={constructor:u,onReady:function(g){return g()},getPage:function(){var g=this._conf.page;return i.safetyCall(g,[],g+"")},setPage:function(){},setConfig:function(g){g&&typeof g=="object"&&(i.verifyConfig(g),g=this.setImgUrl(g),this._conf=i.ext({},this._conf,g))},setImgUrl:function(g){var c=g.region,s=g.imgUrl;if(c){var d=i.regionMap[c];return g.imgUrl=d||i.defaultImgUrl,g}return s&&(g.imgUrl=s),g},checkImgUrl:function(){return!0},sendRequest:function(){},sendBeacon:function(g,c,s){e(g,c||this.getConfig("imgUrl"),s)},postData:function(){},commonInfo:function(){return{}},setCommonInfo:function(g){g&&typeof g=="object"&&(this._common=i.ext({},this._common,g))},resetPageview:function(){this.pageview=i.uu(),this.sBegin=Date.now()},getUsername:function(){if(this.username)return this.username;var g=this._conf,c=g&&g.setUsername;if(typeof c=="function")try{var s=c();typeof s=="string"&&(s=s.substr(0,40),this.username=s)}catch(d){i.warn("[arms] setUsername fail",d)}return this.username},getTraceId:function(){var g=this.rip,c=Date.now(),s=i.getSortNum(this.record),d=g+c+s+i.getRandNum(this._conf.pid);return this["EagleEye-TraceID"]=d,this.record=s,{"EagleEye-TraceID":d}},getUberTraceId:function(g){var c=this.rip,s=Date.now(),d=i.getSortNum(this.record),l=i.getRandNum(this._conf.pid),p=c+s+d+i.getNum(2)+l,S=p.substring(0,16);return g=g?"1":"0",p[0]==="0"&&(p[0]="1"),p[16]==="0"&&(p[16]="1"),{"uber-trace-id":p+":"+S+":0:"+g,traceId:p}},getB3TraceId:function(g){var c=this.rip,s=Date.now(),d=i.getSortNum(this.record),l=i.getRandNum(this._conf.pid),p=c+s+d+i.getNum(2)+l,S=p.substring(0,16);return g=g?"1":"0",p[0]==="0"&&(p[0]="1"),p[16]==="0"&&(p[16]="1"),{b3:p+"-"+S+"-"+g+"-0","X-B3-TraceId":p,"X-B3-ParentSpanId":"0","X-B3-SpanId":S,"X-B3-Sampled":g}},getPageviewId:function(){return{"EagleEye-SessionID":this.pageview}},getConfig:function(g){return g?this._conf[g]:i.ext({},this._conf)},sampling:function(g){return g===1||(typeof this.sampleCache[g]=="boolean"||(this.sampleCache[g]=i.pick(g)),this.sampleCache[g])},clear:function(g){var c;clearTimeout(this.requestTimmer),this.requestTimmer=null;for(var s=this._conf&&typeof this._conf.sendRequest=="function";c=this.requestQueue.pop();)if(c.t==="res")this.postData(c,"res");else if(c.t==="error")this.postData(c,"err");else if(c.t==="api")this.postData(c,"apiSnapshot");else if(c.t==="behavior")this.postData(c,"behavior");else if(c.t==="health"&&!s&&window&&window.navigator&&typeof window.navigator.sendBeacon=="function")this.sendBeacon(c);else if(c.t==="resource"&&!s&&window&&window.navigator&&typeof window.navigator.sendBeacon=="function"){var d=JSON.stringify({resource:c.resource});delete c.resource,this.sendBeacon(c,null,d)}else c.t==="resource"?this.postData(c,"resource"):this.sendRequest(c);return g&&this.clearSelf(),this},clearSelf:function(){var g;for(clearTimeout(this.Timmer),this.Timmer=null;g=this.selfQueue.pop();)this.postData(g,"err");return this},_lg:function(g,c,s,d){var l=this,p=l._conf,S=l.getPage(),T=p.ignore||{},y=T.ignoreErrors,R=T.ignoreResErrors,v=T.ignoreUrls,h=T.ignoreApis;if(l._isRobot||i.ignoreByRule(S,v)||i.ignoreByRule(i.decode(S),v)||g==="error"&&(i.ignoreByRule(c.msg,y)||i.ignoreByRule(i.decode(c.msg),y))||g==="resourceError"&&(i.ignoreByRule(c.src,R)||i.ignoreByRule(i.decode(c.src),R))||g==="api"&&(i.ignoreByRule(c.api,h)||i.ignoreByRule(i.decode(c.api),h))||!l.checkImgUrl(p.imgUrl)||!c||p.disabled||!p.pid||d===0)return l;var m=c.dl;if(delete c.dl,c=i.ext({t:g,times:1,page:S,tag:p.tag||"",release:p.release||"",environment:p.environment,begin:Date.now(),c1:p.c1,c2:p.c2,c3:p.c3},c,l.commonInfo(),l._common,{pid:p.pid,_v:l.ver,pv_id:l.pageview,username:l.getUsername(),sampling:s||1,dl:m,z:i.seq()}),i.T(p.beforeReport)==="Function")try{if(!(c=p.beforeReport(c)))return l}catch{return l}return d===1?o(l,c):s&&!l.sampling(s)?l:o(l,c)},_self:function(g,c,s){var d=this,l=d._conf;if(g!=="error"||!d.checkImgUrl(l.imgUrl)||!c||l.disabled||!l.pid||s&&!d.sampling(s))return d;c=i.ext({t:g,times:1,page:i.selfErrPage,tag:l.pid,begin:Date.now()},c,{pid:n,_v:d.ver,sampling:s||1,z:i.seq()});var p=d.selfQueue[0];if(p){p.times++;try{p.err&&c.err&&p.err.msg_raw&&c.err.msg_raw&&p.err.msg_raw.split("&").indexOf(c.err.msg_raw)<0&&p.err.msg_raw.length<1e3&&(p.err.msg_raw+="&"+c.err.msg_raw)}catch{}}else d.selfQueue.unshift(c),d.onReady(function(){d.sdkFlag&&(d.sdkFlag=!1,d.Timmer=i.delay(function(){d.clearSelf()},1e4))})},custom:function(g,c){if(!g||typeof g!="object")return this;var s=!1,d={begin:Date.now()};return i.each(g,function(l,p){return!(s=p&&p.length<=20)&&i.warn("[retcode] invalid key: "+p),d["x-"+p]=l,s}),s?this._lg("custom",d,c||1):this}},ch.exports=u,ch.exports}var W0,lh={exports:{}},q0,uh,K0,dh={exports:{}};function k_(){if(K0)return uh;K0=1;var i=Li();return uh=function(e,n){var o=[],u=null,g=n&&n.location&&n.location.href,c=void 0,s=null,d=function(S,T,y){if(S!==null){var R=S[T];S[T]=y(R)}},l=function(S){var T,y,R,v,h,m=[];if(!S||typeof S.tagName!="string")return"";if(m.push(S.tagName.toLowerCase()),typeof S.id=="string"&&m.push("#".concat(S.id)),typeof(T=S.className)=="string")for(y=T.split(/\s+/),h=0;h<y.length;h++)m.push(".".concat(y[h]));var _=["type","name","title","alt","data-arms-attr"];for(h=0;h<_.length;h++)R=_[h],typeof(v=S.getAttribute(R))=="string"&&m.push("[".concat(R,'="').concat(v,'"]'));return m.join("")},p=function(S,T){return function(y){if(y&&y!==s){var R;s=y;try{R=y.target}catch{R="<unknown>"}if(R.length!==0){var v={type:"ui.".concat(S),data:{message:(function(h){if(!h||h.nodeType!==1)return"";for(var m=h||null,_=[],A=0,E=0,b="";m&&A++<5&&!((b=l(m))==="html"||A>1&&E+3*_.length+b.length>=80);)_.push(b),E+=b.length,m=m.parentNode;return _.reverse().join(" > ")})(R)},timestamp:Date.now()};S==="click"?u&&u.addBehavior(v):S==="keypress"&&(c||u&&u.addBehavior(v),clearTimeout(c),c=setTimeout(function(){c=void 0},100))}}}};i.ext(e.prototype,{addBehavior:function(S){if(this.getConfig("behavior")&&S&&typeof S=="object"){var T={},y=S.data||{};if(S.type)T=y;else{if(typeof y.name!="string"||typeof y.message!="string")return;T.name=y.name.substr(0,20),T.message=y.message.substr(0,200)}T.message&&(T.message=i.encode(T.message));var R={type:S.type||"custom",data:T||{},timestamp:S.timestamp||Date.now(),page:S.page||n&&n.location&&n.location.pathname};return o.push(R),o=o.slice(-100)}},getBehavior:function(){return o||[]},setBehavior:function(S){return S&&(o=S),o},reportBehavior:function(S){var T=this;T.getConfig("behavior")&&(T.sendBhTimer&&(clearTimeout(T.sendBhTimer),T.sendBhTimer=void 0),T.sendBhTimer=setTimeout(function(){o&&o.length>0&&(T.behavior(o),o=[],T.sendBhTimer=void 0,S&&typeof S=="function"&&S())},0))},initBehavior:function(){if(!this.hasInitBehavior&&!u){try{(function(){if(document&&document.referrer&&document.location){var T=document.referrer,y=document.location.href;if(T!==""){var R={type:"navigation",data:{from:T,to:y}};g=y,u&&u.addBehavior(R)}}})(),n&&n.document&&n.document.addEventListener&&(n.document.addEventListener("click",p("click"),!1),n.document.addEventListener("keypress",p("keypress"),!1)),(function(){if((function(){var v=n&&n.chrome,h=v&&v.app&&v.app.runtime,m="history"in n&&!!n.history.pushState&&!!n.history.replaceState;return!h&&m})()){var T=function(v,h){var m={type:"navigation",data:{from:v,to:h}};u&&u.addBehavior(m),g=h},y=n.onpopstate;n.onpopstate=function(){for(var v=arguments.length,h=new Array(v),m=0;m<v;m++)h[m]=arguments[m];var _=n.location.href;if(T(g,_),y)return y.apply(this,h)};var R=function(v){return function(){for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];var A=m.length>2?m[2]:void 0;return A&&T(g,String(A)),v.apply(this,m)}};d(n.history,"pushState",R),d(n.history,"replaceState",R)}})();var S=this.getConfig("enableConsole");S&&(function(T){if(n&&n.console){var y=["debug","info","warn","log","error","assert"];i.isArray(T)&&(y=T);for(var R=0;R<y.length;R++){var v=y[R];v&&i.isString(v)&&n.console[v]&&typeof n.console[v]=="function"&&d(n.console,v,function(h){var m=v;return function(){for(var _=arguments.length,A=new Array(_),E=0;E<_;E++)A[E]=arguments[E];var b={type:"console",data:{level:m,message:A}};if(u&&u.addBehavior(b),m==="error")for(var w=0;w<A.length;w++){var C=A[w];C&&C.message&&C.stack&&u&&u.errorHandler(new ErrorEvent("error",{error:C,message:C.message}))}h&&Function.prototype.apply.call(h,n.console,A)}})}}})(S)}catch(T){i.warn("[arms] error in initBehavior",T)}u=this,this.hasInitBehavior=!0}return this}})},uh}var Y0,hh,X0,fh,J0,Q0,$0,ph,Z0,ey,ty,iy,ry,mh,ny,oy,ay,sy={};function Uh(){return Y0||(Y0=1,sy.TIMING_KEYS=["startTime","fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","requestStart","responseStart","responseEnd","","domInteractive","","domContentLoadedEventEnd","","loadEventStart","","msFirstPaint","secureConnectionStart","redirectStart","redirectEnd"]),sy}function P_(){return $0||($0=1,Q0=function(i,e,n){var o=Li(),u=(function(){if(X0)return hh;X0=1;var v=Li(),h=Uh().TIMING_KEYS;return hh=function(){var m=v.win||{},_=m.performance;if(!_||typeof _!="object"||typeof _.getEntriesByType!="function")return null;var A={},E=_.timing||{},b=_.getEntriesByType("resource")||[];if(A.begin=E[h[1]]||Date.now(),typeof m.PerformanceNavigationTiming=="function"){var w=_.getEntriesByType("navigation")[0];w&&(E=w)}return v.each({dom:[10,8],load:[14,1]},function(C,P){var U=E[h[C[1]]],B=E[h[C[0]]];if(U>0&&B>0){var L=Math.round(B-U);L>=0&&L<6e5&&(A[P]=L)}}),A.res=JSON.stringify(b),A},hh})(),g=(function(){if(J0)return fh;J0=1;var v=Li(),h=Uh().TIMING_KEYS;return fh=function(){var m=v.win||{},_=m.performance;if(!_||typeof _!="object")return null;var A={},E=_.timing||{},b=Date.now(),w=1;if(typeof m.PerformanceNavigationTiming=="function"){var C=_.getEntriesByType("navigation")[0];C&&(E=C,w=2)}v.each({dns:[3,2],tcp:[5,4],ssl:[5,17],ttfb:[7,6],trans:[8,7],dom:[10,8],res:[14,12],firstbyte:[7,2],fpt:[8,1],tti:[10,1],ready:[12,1],load:[14,1]},function(H,O){var x=E[h[H[1]]],F=E[h[H[0]]];if(w===2||x>0&&F>0){var N=Math.round(F-x);N>=0&&N<6e5&&(A[O]=N)}});var P=m.navigator.connection,U=_.navigation||{};A.ct=P?P.effectiveType||P.type:"";var B=P&&(P.downlink||P.downlinkMax||P.bandwidth)||null;if((B=B>999?999:B)&&(A.bandwidth=B),A.navtype=U.type===1?"Reload":"Other",w===1&&E[h[16]]>0&&E[h[1]]>0){var L=E[h[16]]-E[h[1]];L>=0&&L<36e5&&(A.fpt=L)}return w===1&&E[h[1]]>0?A.begin=E[h[1]]:w===2&&A.load>0?A.begin=b-A.load:A.begin=b,A},fh})(),c=null,s=n.documentElement,d=e.innerWidth||s.clientWidth||n.body.clientWidth,l=e.innerHeight||s.clientHeight||n.body.clientHeight,p=e.navigator.connection,S={sr:screen.width+"x"+screen.height,vp:d+"x"+l,ct:p?p.effectiveType||p.type:""},T={},y=function(v,h,m,_,A){if(h===void 0){var E,b;if(!T[v]){E=new RegExp(v+"=([^;]+)");try{b=E.exec(n.cookie)}catch(C){return o.warn("[retcode] can not get cookie:",C),null}b&&(T[v]=b[1])}return T[v]}var w=v+"="+h;w+="; path=/",m&&(w+="; max-age="+m);try{return n.cookie=w,!!n.cookie}catch(C){return o.warn("[retcode] can not set cookie: ",C),!1}},R=function(v){var h=v._conf.uid||y("_nk_")||y("_bl_uid");return h||(h=o.uu(),y("_bl_uid",h,15552e3))?h:null};return o.ext(i.prototype,{activeErrHandler:function(v){return c&&!v||(c=this),this},errorHandler:function(v){if(!v)return this;var h=v.type;if(h==="error"){var m=v.target||v.srcElement;!m||!m.tagName||v.message||v.filename||v.lineno||v.colno?this.error(v.error||{message:v.message},v):this.resourceErrorHandler(v)}else h==="unhandledrejection"&&o.T(v.reason,"Error")&&o.checkAutoError(v.reason)&&this.error(v.reason);try{this.getConfig("behavior")&&this.reportBehavior&&this.reportBehavior()}catch{}return this},resourceErrorHandler:function(v){var h=this,m=v.target||v.srcElement;try{var _=h.getSrc(m),A=typeof m.tagName=="string"?m.tagName.toLowerCase():"",E=h.getXPath(m,5),b=o.getURL(_),w={src:_&&_.substring(0,1e3),node_name:A,xpath:E,res_type:o.getResType(A,_),res_name:b.path,domain:b.domain};return h._conf.enableResource&&h.fixResourceStatus&&v.timeStamp&&h.fixResourceStatus({src:_,node_name:A,res_type:o.getResType(A,_),timeStamp:v.timeStamp,domain:b.domain}),h._lg("resourceError",w),h}catch(C){return o.warn("[ARMS] resourceErrorHandler error :",C),h}},getSrc:function(v){var h=v.src||v.href;try{if(!h){var m=(typeof v.tagName=="string"?v.tagName.toLowerCase():"")==="object",_=v.getAttribute("classid")&&v.getAttribute("classid").toLowerCase()==="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"||v.getAttribute("type")==="application/x-shockwave-flash";m&&_&&(h=v.getAttribute("data")||v.getAttribute("codebase")),h||(h=v.outerHTML||v.innerHTML)}}catch{h=""}return h},getXPath:function(v,h){var m=v.id?"#"+v.id:"",_=typeof v.className=="string"?"."+v.className.split(" ").join("."):"",A=(typeof v.tagName=="string"?v.tagName.toLowerCase():"")+m+_;return v.parentNode&&v.parentNode.tagName&&h-1!=0?this.getXPath(v.parentNode,h-1)+" > "+A:A},sendPerformance:function(v){var h=this;h.onReady(function(){var m=g();m&&m.load&&m.load>0&&(m.page=h.getPage(!0),v&&(m=o.ext(m,v)),m.autoSend=!0,h.performance(m))})},sendResources:function(v){var h=this;h.onReady(function(){var m=u();m&&m.load&&m.load>0&&(m.load&&m.load<=2e3||m.load&&m.load<=8e3&&Math.random()>.05||(m.page=h.getPage(!0),m.dl=location.href,v&&(m=o.ext(m,v)),h._lg("res",m,h.getConfig("sample"))))})},sendPV:function(){var v=this;v.onReady(function(){var h,m,_=(h=R(v),m=e.devicePixelRatio||1,{uid:h,dt:n.title,dl:location.href,dr:n.referrer,dpr:m.toFixed(2),de:(n.characterSet||n.defaultCharset||"").toLowerCase(),ul:s.lang,begin:Date.now()});_&&_.uid&&v._lg("pv",_,v.getConfig("pvSample"))})},commonInfo:function(){return S.uid=R(this),S.sid=(function(v){if(v.session)return v.session;var h;try{if(typeof window=="object"&&typeof sessionStorage=="object"&&typeof sessionStorage.getItem=="function")return typeof(h=sessionStorage.getItem("_bl_sid"))=="string"?(v.session=h,h):(h=o.uu(),v.session=h,typeof sessionStorage.setItem=="function"&&sessionStorage.setItem("_bl_sid",h),h)}catch(m){o.warn("[ARMS] getSid error :",m)}return v.session=h=o.uu(),h})(this),S},handleUnload:function(v){var h=Date.now();if(h-this._lastUnload<200)return this;this._lastUnload=h,this.sendHealth(v),this.speedCache&&(this._lg("speed",this.speedCache),this.speedCache=null,clearTimeout(this.speedTimmer)),this._conf&&this._conf.enableResource&&this.resourceComboReport(),this.clear(!0)},bindHashChange:function(v){var h=this;if(!v^h.hashChangeHandler)return h;v?(h.hackHistoryState(),h.hashChangeHandler=function(m){var _=h._conf.parseHash(location.hash);_&&h.setPage(_,m!==!1)},h.stateChangeHandler=function(m){var _=h._conf.parseHash(m.detail);_&&h.setPage(_)},o.on(e,"hashchange",h.hashChangeHandler),o.on(e,"historystatechange",h.stateChangeHandler),h.hashChangeHandler(!1)):(o.off(e,"hashchange",h.hashChangeHandler),o.off(e,"historystatechange",h.stateChangeHandler),h.hashChangeHandler=null,h.stateChangeHandler=null)},initHandler:function(){var v=this;if(v.hasInitHandler)return v;var h=v._conf;return o.on(e,"beforeunload",function(){v.handleUnload(0)}),v.bindHashChange(h.enableSPA),v.activeErrHandler(!1),v.hasInitHandler=!0,v}}),o.on(e,"error",function(v){c&&c.errorHandler(v)},!1,!0).on(e,"unhandledrejection",function(v){c&&c.errorHandler(v)}),i}),Q0}function L_(){if(Z0)return ph;Z0=1;var i=Li();return ph=function(e,n,o){function u(p,S,T){var y=0,R=p.tagName;if(R!=="SCRIPT"&&R!=="STYLE"&&R!=="META"&&R!=="HEAD"){var v=p.children?p.children.length:0;if(v>0)for(var h=p.children,m=v-1;m>=0;m--)y+=u(h[m],S+1,y>0);if(y<=0&&!T&&!(p.getBoundingClientRect&&p.getBoundingClientRect().top<c))return 0;y+=1+.5*S}return y}function g(p){for(var S=1;S<p.length;S++)if(p[S].score<p[S-1].score)return p.splice(S,1),g(p);return p}var c=n.innerHeight||0,s=[],d=null,l=0;i.ext(e.prototype,{initFmpObserver:function(p){var S=this;if(!S._conf||!S._conf.useFmp)return null;if(!n.MutationObserver)return i.warn("[retcode] first meaningful paint can not be retrieved"),S.sendPerformance(),null;i.on(n,"beforeunload",function(){S.endObserving(0,!0)});var T=n.MutationObserver;return(d=new T(function(){(function(y){var R=Date.now()-y,v=o.querySelector("body");if(v){var h=0;h+=u(v,1,!1),s.push({score:h,t:R})}else s.push({score:0,t:R})})(S._startTime)})).observe(document,{childList:!0,subtree:!0}),l=1,S.onReady(function(){S.endObserving(p)}),d},endObserving:function(p,S){var T,y,R,v=this;if(d&&l)if(v.fmpTimmer&&(clearTimeout(v.fmpTimmer),v.fmpTimmer=null),S||(T=v._startTime,y=p,(R=Date.now()-T)>y||R-(s&&s.length&&s[s.length-1].t||0)>1e3)){d.disconnect(),l=0,s=g(s);for(var h=null,m=1;m<s.length;m++)if(s[m].t>=s[m-1].t){var _=s[m].score-s[m-1].score;(!h||h.rate<=_)&&(h={t:s[m].t,rate:_})}h&&h.t>0&&h.t<36e5?v.sendPerformance({fmp:h.t}):v.sendPerformance()}else v.fmpTimmer=i.delay(function(){v.endObserving(p)},500)}})},ph}function U_(){if(oy)return oh.exports;oy=1;var i=Li(),e=(function(){if(G0)return sh.exports;G0=1;var d=Li(),l=N_(),p=["api","success","time","code","msg","trace","traceId","begin","pv_id","sid","seq","domain","flag","apiSnapshot","tag","c1","c2","c3"],S=function(y){var R=(y.key||"default").split("::");return R.length>1?d.ext(y,{group:R[0],key:R[1]}):d.ext(y,{group:"default_group",key:R[0]})},T=function(y){var R;l.call(this,y);try{R=typeof performance=="object"?performance.timing.fetchStart:Date.now()}catch{R=Date.now()}return this._startTime=R,this};return T.prototype=d.createObject(l.prototype),d.ext(l.dftCon,{startTime:null}),d.ext(T.prototype,{constructor:T,_super:l,sum:function(y,R,v){try{var h=d.dealParam(y,R,1);return this._lg("sum",S(h),v)}catch(m){d.warn("[retcode] can not get parseStatData: "+m)}},avg:function(y,R,v){try{var h=d.dealParam(y,R,0);return this._lg("avg",S(h),v)}catch(m){d.warn("[retcode] can not get parseStatData: "+m)}},percent:function(y,R,v,h){try{return this._lg("percent",S({key:y,subkey:R,val:v||0,begin:Date.now()}),h)}catch(m){d.warn("[retcode] can not get parseStatData: "+m)}},msg:function(y,R){if(y&&!(y.length>180))return this.custom({msg:y},R)},error:function(y,R){if(!y)return d.warn("[retcode] invalid param e: "+y),this;arguments.length===1?(typeof y=="string"&&(y={message:y},R={}),typeof y=="object"&&(R=y=y.error||y)):(typeof y=="string"&&(y={message:y}),typeof R!="object"&&(R={}));var v=y.name||"CustomError",h=y.message||"",m=y.stack||"";R=R||{};var _=typeof location=="object"&&typeof location.href=="string"&&location.href.substring(0,500)||"";if(d.checkSDKError(h,R.filename)){var A=/^Script error\.?$/,E=y.msg||y.message;if(d.ignoreByRule(E,A)||d.ignoreByRule(d.decode(E),A))return this;var b={msg:d.selfErrKey,err:{msg_raw:d.encode(y.msg||y.message)}};return this._self("error",b,1)}for(var w={begin:Date.now(),cate:v,msg:h&&h.substring(0,1e3),stack:m&&m.substring(0,1e3),file:d.removeUrlSearch(R.filename||""),line:R.lineno||"",col:R.colno||"",err:{msg_raw:d.encode(h),stack_raw:d.encode(m)},dl:_},C=["tag","c1","c2","c3"],P=0;P<C.length;P++){var U=C[P];R[U]&&(w[U]=R[U])}var B=(this.getConfig("ignore")||{}).ignoreErrors;return d.ignoreByRule(w.msg,B)||d.ignoreByRule(d.decode(w.msg),B)?this:(this.beforeSend&&this.beforeSend("error",w),this._lg("error",w,1))},behavior:function(y){if(y){var R=typeof y=="object"&&y.behavior?y:{behavior:y};return this.beforeSend&&this.beforeSend("behavior",R),this._lg("behavior",R,1)}},api:function(y,R,v,h,m,_,A,E,b,w,C,P,U,B,L,H){if(!y)return d.warn("[retcode] api is null"),this;if(y=typeof y=="string"?{api:y,success:R,time:v,code:h,msg:m,begin:_,traceId:A,pv_id:E,apiSnapshot:b,domain:w,flag:P,tag:U,c1:B,c2:L,c3:H}:d.sub(y,p),!d.checkAPI(y.api,!0))return this;y.code=y.code||"";var O=y.msg||"";if(O=typeof O=="string"?O.substring(0,1e3):O,y.msg=O,y.success=y.success?1:0,y.time=+y.time,y.begin=y.begin,y.traceId=y.traceId||"",y.pv_id=y.pv_id||"",y.domain=y.domain||"",y.flag=y.flag,y.dl=typeof location=="object"&&typeof location.href=="string"&&location.href.substring(0,500)||"",y.apiSnapshot&&(typeof y.apiSnapshot=="object"&&(y.apiSnapshot=JSON.stringify(y.apiSnapshot)),typeof y.apiSnapshot!="string"&&delete y.apiSnapshot,y.apiSnapshot.length>2e3&&(y.apiSnapshot=y.apiSnapshot.substring(0,2e3))),C&&(y.traceOrigin=C),!y.api||isNaN(y.time))return d.warn("[retcode] invalid time or api"),this;var x=(this.getConfig("ignore")||{}).ignoreApis;return d.ignoreByRule(y.api,x)||d.ignoreByRule(d.decode(y.api),x)||y.time<0?this:(this.beforeSend&&this.beforeSend("api",y),this._lg("api",y,y.success&&this.getConfig("sample"),y.flag))},speed:function(y,R,v){var h=this,m=this.getConfig("startTime")||this._startTime;return/^s(\d|1[0])$/.test(y)?(R=typeof R!="number"?Date.now()-m:R>=m?R-m:R,h.speedCache=h.speedCache||{},h.speedCache[y]=R,h.speedCache.begin=m,clearTimeout(h.speedTimmer),h.speedTimmer=setTimeout(function(){v||(h.speedCache.page=h.getPage(!0)),h._lg("speed",h.speedCache),h.speedCache=null},5e3),h):(d.warn("[retcode] invalid point: "+y),h)},performance:function(y){if(y&&typeof y=="object"&&!this.hasSendPerf){var R={},v={},h=this.getConfig("autoSendPerf");if(y.autoSend&&h)return v=d.ext(this.perfData||{},y),this.hasSendPerf=!0,this._lg("perf",v,this.getConfig("sample"));if(y.autoSend&&!h)return delete y.autoSend,this.perfData?(v=d.ext(this.perfData||{},y),this.hasSendPerf=!0,this._lg("perf",v,this.getConfig("sample"))):void(this.perfData=y);for(var m in y)(/^t([1-9]|1[0])$/.test(m)||m==="ctti"||m==="cfpt")&&(R[m]=y[m]);if(y.autoSend===!0||!h&&(h||this.perfData))return y.autoSend!==!0&&h===!1&&this.perfData?(R=d.ext(this.perfData||{},R),this.hasSendPerf=!0,this._lg("perf",R,this.getConfig("sample"))):void 0;this.perfData=d.ext(this.perfData||{},R)}},resource:function(y,R){if(!y||!d.isPlainObject(y))return d.warn("[arms] invalid param data: "+y),this;var v=Object.keys(y),h=["begin","dom","load","res","dl"],m=!1;for(var _ in h)if(v.indexOf(h[_])<0){m=!0;break}if(m)return d.warn("[arms] lack param data: "+y),this;var A={begin:y.begin||Date.now(),dom:y.dom||"",load:y.load||"",res:d.isArray(y.res)?JSON.stringify(y.res):JSON.stringify([]),dl:y.dl||""};return this._lg("res",A,R)},event:function(y,R){if(typeof y=="object"&&y&&y.key){var v={},h=["key","success","time","c1","c2","c3"];for(var m in y)h.indexOf(m)>-1&&(v[m]=y[m]);v.success=y.success===!1?0:1,this._lg("event",v,R)}}}),T._super=l,T._root=l,l.Reporter=T,sh.exports=T,sh.exports})(),n=(function(){if(W0)return lh.exports;W0=1;var d=Li(),l=typeof window=="object"?window:{},p=l.__oFetch_||l.fetch;return p=typeof p=="function"?p:void 0,lh.exports=function(S,T){var y=-1;typeof S=="object"&&(y=S.z,S=d.serialize(S));var R=T+S;if(p)return p(R,{method:"HEAD",mode:"no-cors"}).catch(d.noop);if(l.document&&l.document.createElement){var v="__request_hold_"+y,h=l[v]=new Image;h.onload=h.onerror=function(){l[v]=void 0},h.src=R,h=null}},lh.exports})(),o=(function(){if(q0)return dh.exports;q0=1;var d=Li(),l=typeof window=="object"?window:{},p=l.__oXMLHttpRequest_||l.XMLHttpRequest;return p=typeof p=="function"?p:void 0,dh.exports=function(S,T){try{var y=new p;y.open("POST",T,!0),y.setRequestHeader("Content-Type","text/plain"),y.send(JSON.stringify(S))}catch(R){d.warn(`[retcode] Failed to log, exception is :
`+R)}},dh.exports})(),u=i.win,g=u.document,c=/^(error|api|speed|sum|avg|percent|custom|msg|setPage|setConfig|behavior|performance)$/,s=function(d){var l=this;return e.call(l,d),l._initialPage=d.page&&i.safetyCall(d.page,[],d.page+"")||null,l._isRobot=i.isRobot(),l._health={errcount:0,apisucc:0,apifail:0},l.beforeSend=function(p,S){p==="error"?l._health.errcount++:p==="api"&&l._health[S.success?"apisucc":"apifail"]++},d.enableInstanceAutoSend!==!1&&(l.initHandler(),l.initHook(),l.initFmpObserver(1e4),l._conf&&l._conf.behavior&&typeof l.initBehavior=="function"&&l.initBehavior(),l._conf&&l._conf.enableResource&&typeof l.initResource=="function"&&l.initResource()),Object.defineProperty&&u.addEventListener&&Object.defineProperty(l,"pipe",{set:l.sendPipe}),l};return s.prototype=i.createObject(e.prototype),i.ext(e._root.dftCon,{uid:null,setUsername:null,ignoreUrlPath:null,ignoreApiPath:null,urlHelper:[{rule:/\/([a-z\-_]+)?\d{2,20}/g,target:"/$1**"},/\/$/],resourceHelper:[],apiHelper:{rule:/\/([a-z\-_]+)?\d{2,20}/g,target:"/$1**"},ignoreUrlCase:!0,imgUrl:"https://arms-retcode.aliyuncs.com/r.png?",cdnHostList:[],resourceTypes:["css","script","img","font"],resourceSlow:2e3,disableHook:!1,autoSendPv:!0,autoSendPerf:!0,enableSPA:!1,enableLinkTrace:!1,linkType:"arms",enableApiCors:!1,sendResource:!0,behavior:!0,enableConsole:!1,parseHash:function(d){return(d?i.cutUrlSearch(d.replace(/^#\/?/,"")):"")||"[index]"},parseResponse:function(d){if(!d||typeof d!="object")return{};var l=d.code,p=d.msg||d.message||d.subMsg||d.errorMsg||d.ret||d.errorResponse||"";return typeof p=="object"&&(l=l||p.code,p=p.msg||p.message||p.info||p.ret||JSON.stringify(p)),{msg:p,code:l,success:!0}}}),i.ext(s.prototype,{constructor:s,_super:e,onReady:function(d){var l=this;if(l.hasReady)return d();g.readyState==="complete"?(l.hasReady=!0,d()):i.on(u,"load",function(){l.hasReady=!0,d()},!0)},getPage:function(d){var l=this._conf,p=l.page,S=location,T=S.host+S.pathname;return p&&!d?i.safetyCall(p,[],p+""):this._initialPage||i.filterByRule(l.ignoreUrlCase?T.toLowerCase():T,S.href,l.ignoreUrlPath?l.ignoreUrlPath:l.urlHelper)},setPage:function(d,l){var p=this,S=p.prevPage;if(l!==!1){if(!d||d===S)return p;p.prevPage=d,clearTimeout(p.sendPVTimmer),p.handleUnload(1),p.resetPageview(),p.sendPVTimmer=setTimeout(function(){p.sendPV()},10)}else p.prevPage=d;return p._conf.page=d,p},setConfig:function(d,l){if(d&&typeof d=="object"){i.verifyConfig(d),d=this.setImgUrl(d);var p=this._conf;if(this._conf=i.ext({},p,d),!l){var S="disableHook";S in d&&p[S]!==d[S]&&(d[S]?this.removeHook():this.addHook()),(S="enableSPA")in d&&p[S]!==d[S]&&this.bindHashChange(d[S])}}},sendRequest:function(d){n(d,this.getConfig("imgUrl"))},postData:function(d,l){var p={};p[l]=d[l],delete d[l];var S="";typeof d=="object"&&(S=i.serialize(d)),o(p,this.getConfig("imgUrl")+S+"&post_res=")},sendPipe:function(d){var l=this;if(!d||!d.length)return l;try{if(i.T(d[0])==="Array")return i.each(d,function(S){return l.sendPipe(S)});if(i.T(d)!=="Array")return l;var p=d.shift();if(!c.test(p))return l;l[p].apply(l,d)}catch(S){return i.warn("[retcode] error in sendPipe",S),l}},sendHealth:function(){var d=i.ext({},this._health);d.healthy=d.errcount>0?0:1,d.begin=Date.now();var l=d.begin-this.sBegin;d.stay=l,this._lg("health",d,1),this._health={errcount:0,apisucc:0,apifail:0}},createInstance:function(d){d=i.ext({pid:this._conf.pid},d);var l=this.__proto__.constructor(d);return d.page&&l.sendPV(),l}}),k_()(s,u),P_()(s,u,g),L_()(s,u,g),(ty||(ty=1,ey=function(d,l){var p=Li(),S=null,T=p.getCurDomain(),y=function(_,A,E,b,w,C,P,U,B,L,H,O,x){var F=p.J(w)||null,N=p.safetyCall(A,[F,b],null);if(!N)return!1;var k=N.code||C,M=!("success"in N)||N.success;_.api(E,M,P,k,N.msg,U,B,L,M?{}:H,T,O,x)},R="fetch",v="__oFetch_",h="__oXMLHttpRequest_",m="XMLHttpRequest";return p.ext(d.prototype,{removeHook:function(_,A){return S&&(A||this===S)?(l[v]&&(l[R]=l[v],delete l[v]),l[h]&&(l[m]=l[h],delete l[h]),S=null,this):this},addHook:function(_){return!_&&S||(S||((function(){if(typeof l[R]=="function"){var A=l[R];l[v]=A,l[R]=function(E,b){var w=arguments.length===1?[arguments[0]]:Array.apply(null,arguments),C=S;if(!C||!C.api||b&&(b.method==="HEAD"||b.mode==="no-cors"))return A.apply(l,w);b||(b={});var P=Date.now(),U=C._conf,B=p.duration(),L=(E&&typeof E!="string"?E.url:E)||"",H=L;L=p.cutUrlSearch(L);var O=(U.ignore||{}).ignoreApis,x=U.parseTraceId;if(!p.checkAPI(L,!0)||p.ignoreByRule(L,O))return A.apply(l,w);L=p.filterByRule(L,H,U.ignoreApiPath?U.ignoreApiPath:U.apiHelper);var F=U.enableLinkTrace,N="",k="",M=C.getConfig("pid"),j=null,G=C.getConfig("sample"),z=C.getConfig("linkType"),V=1;if(G&&!C.sampling(G)&&(V=0),F){var re="";try{re=location.origin?location.origin:location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")}catch{re=""}var Q=p.checkSameOrigin(H,re);if(C.getConfig("enableApiCors")||Q)if(E&&typeof E!="string")try{if(w[0].headers&&typeof w[0].headers.get=="function"&&typeof w[0].headers.append=="function")switch(z){case"arms":var Z=w[0].headers.get("EagleEye-TraceID"),q=w[0].headers.get("EagleEye-SessionID"),Y=w[0].headers.get("EagleEye-pAppName");Z?N=Z:(N=C.getTraceId()["EagleEye-TraceID"],w[0].headers.append("EagleEye-TraceID",N)),q?k=q:(k=C.getPageviewId()["EagleEye-SessionID"],w[0].headers.append("EagleEye-SessionID",k)),Y||w[0].headers.append("EagleEye-pAppName",M);break;case"b3":var J=w[0].headers.get("X-B3-TraceId");if(J)N=J;else{var $=C.getB3TraceId(V);w[0].headers.append("X-B3-TraceId",$["X-B3-TraceId"]),w[0].headers.append("X-B3-ParentSpanId",$["X-B3-ParentSpanId"]),w[0].headers.append("X-B3-SpanId",$["X-B3-SpanId"]),w[0].headers.append("X-B3-Sampled",$["X-B3-Sampled"]),w[0].headers.append("X-Request-ID",p.guid()),N=$["X-B3-TraceId"]}k=C.pageview;break;default:var te=w[0].headers.get("uber-trace-id");te?N=te.split(":")[0]:(te=C.getUberTraceId(V),w[0].headers.append("uber-trace-id",te["uber-trace-id"]),N=te.traceId),k=C.pageview}}catch(he){p.warn(`[retcode] fetch failed to set header, exception is :
`+he)}else switch(b.headers=b.headers?b.headers:{},z){case"arms":b.headers["EagleEye-TraceID"]?N=b.headers["EagleEye-TraceID"]:(N=C.getTraceId()["EagleEye-TraceID"],b.headers["EagleEye-TraceID"]=N),b.headers["EagleEye-SessionID"]?k=b.headers["EagleEye-SessionID"]:(k=C.getPageviewId()["EagleEye-SessionID"],b.headers["EagleEye-SessionID"]=k),b.headers["EagleEye-pAppName"]||(b.headers["EagleEye-pAppName"]=M);break;case"b3":if(b.headers["X-B3-TraceId"])N=b.headers["X-B3-TraceId"];else{var ie=C.getB3TraceId(V);b.headers["X-B3-TraceId"]=ie["X-B3-TraceId"],b.headers["X-B3-ParentSpanId"]=ie["X-B3-ParentSpanId"],b.headers["X-B3-SpanId"]=ie["X-B3-SpanId"],b.headers["X-B3-Sampled"]=ie["X-B3-Sampled"],b.headers["X-Request-ID"]=p.guid(),N=ie["X-B3-TraceId"]}k=C.getPageviewId()["EagleEye-SessionID"];break;default:if(b.headers["uber-trace-id"])N=b.headers["uber-trace-id"].split(":")[0];else{var se=C.getUberTraceId(V);b.headers["uber-trace-id"]=se["uber-trace-id"],N=se.traceId}k=C.getPageviewId()["EagleEye-SessionID"]}}return A.apply(l,w).then(function(he){if(!C||!C.api)return he;try{if(!he||typeof he.clone!="function")return he;var de=he.clone(),be=de.headers;if(be&&typeof be.get=="function"){var Re=be.get("content-type");if(Re&&!/(text)|(json)/.test(Re))return he;if(!N){var Te=p.parseFetchHeaders(be);typeof Te=="object"&&Te["eagleeye-traceid"]&&(N=Te["eagleeye-traceid"],j="response")}}var Ae=B();return de.text().then(function(Ie){if(!N&&p.isFunction(x)){var Le=x(de,Ie);Le&&p.isString(Le)&&(N=Le)}var Be=p.getFetchSnapshot(w,Ie,be);de.ok?y(C,U.parseResponse,L,H,Ie,de.status||200,Ae,P,N,k,Be,j,V):(C.api(L,!1,Ae,de.status||404,de.statusText,P,N,k,Be,T,j,V),U.enableResource&&S.fixResourceStatus&&S.fixResourceStatus({src:de.url,res_type:"api"}))}),he}catch(Ie){return p.warn("[ARMS] fetch response error :",Ie),he}}).catch(function(he){if(!C||!C.api)throw he;var de=B();throw C.api(L,!1,de,he.name||"Error",he.message,P,N,k,{},T),U.enableResource&&S.fixResourceStatus&&S.fixResourceStatus({src:H,res_type:"api"}),he})},l[R].toString=p.createFakeToString(R)}})(),(function(){if(typeof l[m]=="function"){var A,E=l[m];l[h]=E;var b=function(w){var C=new E(w),P=S;if(!P||!P.api||!C.addEventListener)return C;var U,B,L,H,O=C.send,x=C.open,F=C.setRequestHeader,N=P._conf,k=(N.ignore||{}).ignoreApis,M=N.parseTraceId,j=P.getConfig("enableLinkTrace"),G="",z="",V="",re=null,Q=P.getConfig("sample"),Z=P.getConfig("linkType"),q=1;return Q&&!P.sampling(Q)&&(q=0),C.open=function(Y,J){A=Y;var $=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);x.apply(C,$),H=J||"",L=p.cutUrlSearch(H);var te=!p.checkAPI(L,!0)||p.ignoreByRule(L,k);if(L=L?p.filterByRule(L,H,N.ignoreApiPath?N.ignoreApiPath:N.apiHelper):"",!te&&j){var ie="";try{ie=location.origin?location.origin:location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")}catch{ie=""}var se=p.checkSameOrigin(H,ie);if((P.getConfig("enableApiCors")||se)&&F&&typeof F=="function")switch(Z){case"arms":G=P.getTraceId()["EagleEye-TraceID"],F.apply(C,["EagleEye-TraceID",G]),z=P.getPageviewId()["EagleEye-SessionID"],F.apply(C,["EagleEye-SessionID",z]),V=P.getConfig("pid"),F.apply(C,["EagleEye-pAppName",V]);break;case"b3":var he=P.getB3TraceId(q);F.apply(C,["X-B3-TraceId",he["X-B3-TraceId"]]),F.apply(C,["X-B3-ParentSpanId",he["X-B3-ParentSpanId"]]),F.apply(C,["X-B3-SpanId",he["X-B3-SpanId"]]),F.apply(C,["X-B3-Sampled",he["X-B3-Sampled"]]),F.apply(C,["X-Request-ID",p.guid()]),G=he["X-B3-TraceId"],z=P.getPageviewId()["EagleEye-SessionID"];break;default:var de=P.getUberTraceId(q);F.apply(C,["uber-trace-id",de["uber-trace-id"]]),G=de.traceId,z=P.getPageviewId()["EagleEye-SessionID"]}}},C.send=function(){U=Date.now(),B=p.duration();var Y=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);O.apply(C,Y)},p.on(C,"readystatechange",function(){if(L&&C.readyState===4){var Y=B(),J=p.getXhrSnapshot(H,A,C);if(!G){var $=p.parseXhrHeaders(typeof C.getAllResponseHeaders=="function"&&C.getAllResponseHeaders()||"");typeof $=="object"&&$["eagleeye-traceid"]&&(G=$["eagleeye-traceid"],re="response")}if(!G&&p.isFunction(M)){var te=M(C);te&&p.isString(te)&&(G=te)}if(C.status>=200&&C.status<=299){var ie=C.status||200;if(typeof C.getResponseHeader=="function"){var se=C.getResponseHeader("Content-Type");if(se&&!/(text)|(json)/.test(se))return}C.responseType&&C.responseType!=="text"?P.api(L,!0,Y,ie,"",U,G,z,{},T,re,q):y(P,N.parseResponse,L,H,C.responseText,ie,Y,U,G,z,J,re,q)}else P.api(L,!1,Y,C.status||"FAILED",C.statusText,U,G,z,J,T,re,q),N.enableResource&&S.fixResourceStatus&&S.fixResourceStatus({src:C.responseURL||H,res_type:"api"})}}),C};b.prototype=E.prototype,p.each(Object.keys(E),function(w){b[w]=E[w]}),l[m]=b,l[m].toString=p.createFakeToString(m)}})()),S=this),this},initHook:function(){return this.hasInitHook||(this.getConfig("disableHook")||this.addHook(),this.hasInitHook=!0),this}}),d}),ey)(s,u),(ry||(ry=1,iy=function(d,l){var p=Li(),S=l.history||{},T=l.document,y=function(v,h){var m;l.CustomEvent?m=new CustomEvent(v,{detail:h}):((m=T.createEvent("HTMLEvents")).initEvent(v,!1,!0),m.detail=h),l.dispatchEvent(m)},R=function(v){var h=S[v];typeof h=="function"&&(S[v]=function(m,_,A){var E=arguments.length===1?[arguments[0]]:Array.apply(null,arguments),b=location.href,w=h.apply(S,E);if(!A||typeof A!="string"||A===b)return w;try{var C=b.split("#"),P=A.split("#"),U=p.cutUrlSearch(C[0]),B=p.cutUrlSearch(P[0]),L=C[1]&&C[1].replace(/^\/?(.*)/,"$1"),H=P[1]&&P[1].replace(/^\/?(.*)/,"$1");L!==H?y("historystatechange",H):U!==B&&y("historystatechange",B)}catch(O){p.warn("[retcode] error in "+v+": "+O)}return w},S[v].toString=p.createFakeToString(v))};p.ext(d.prototype,{hackHistoryState:function(){return this.hasHackedHistoryState||(R("pushState"),R("replaceState"),this.hasHackedHistoryState=!0),this}})}),iy)(s,u),(function(){if(ny)return mh;ny=1;var d=Li(),l=Uh().TIMING_KEYS;return mh=function(p,S){function T(v,h,m){if(v instanceof S.PerformanceResourceTiming&&v.initiatorType){var _=d.getResType(v.initiatorType,v.name),A=h.resourceTypes||[],E=(h.ignore||{}).ignoreResources;if(_&&A.includes(_)&&!d.ignoreByRule(v.name,E)&&!d.ignoreByRule(d.decode(v.name),E)){var b=v[l[0]],w=v[l[1]],C=v[l[2]],P=v[l[3]],U=v[l[4]],B=v[l[5]],L=v[l[6]],H=v[l[7]],O=v[l[8]],x=v[l[18]],F=v[l[19]];if(!m.has(v)&&(!d.areInOrder(b,w,C,P,U,B,L,H,O)||b>H))return;if(x<b&&(x=b),F<b&&(F=w),d.areInOrder(b,x,F,w))return{domain:d.getURL(v.name).domain,res_type:_,src_type:d.getSrcType(v.name,h.cdnHostList),success:1,size:Math.round(v.decodedBodySize),duration:Math.round(v.duration),timeStamp:v.responseEnd,timing:v}}}}var y="_resource-"+Date.now(),R="_resource_error-"+Date.now();d.ext(p.prototype,{initResource:function(){var v=this,h=S.performance,m=S.PerformanceObserver;if(v[R]||(v[R]=new WeakMap),!h||!m||typeof h!="object"||typeof h.getEntriesByType!="function")return null;var _=h.getEntriesByType("resource")||[];return setTimeout(function(){v.setResource(_)},10),new m(function(A){setTimeout(function(){v.setResource(A.getEntries())},10)}).observe({entryTypes:["resource"]}),this.onReady(function(){setTimeout(v.resourceComboReport.bind(v),5e3)}),v},setResource:function(v){var h=this._conf,m=this[R];if(d.isArray(v)&&v.length){this[y]||(this[y]={});for(var _=this[y],A=0,E=v.length;A<E;A+=1){var b=v[A];if(d.checkAPI(b.name,!1)){var w=T(b,h,m);if(w){var C=w.res_type+"-"+w.domain;C in _||(_[C]=[]),_[C].push(w)}}}return this}},fixResourceStatus:function(v){var h=S.performance;if(!h||typeof h.getEntriesByName!="function")return null;var m=this[R];if(!v.src||!d.checkAPI(v.src,!1))return this;var _=v.timeStamp||h.now(),A=h.getEntriesByName(v.src,"resource");return d.each(A,function(E){m.has(E)||_-E.responseEnd<100&&m.set(E,{success:0})}),this},resourceComboReport:function(){var v=this[y]||{},h=this._conf.resourceSlow||2e3,m=this[R];this[y]={};var _=Object.keys(v);if(_.length!==0){var A=[];d.each(_,function(C){var P=v[C],U={domain:"",res_type:"",src_type:"",size:0,duration:0,count:0,err_count:0,err_duration:0,slow_count:0,slow_duration:0,timings:[]};d.each(P,function(B){var L=B.timing||{},H=m.get(B.timing),O=H?H.success:1,x=B.duration>h?1:0;U.domain=B.domain,U.res_type=B.res_type,U.src_type=B.src_type,U.count+=1,U.duration+=B.duration,U.size+=B.size,O||(U.err_count+=1,U.err_duration+=B.duration),x&&(U.slow_count+=1,U.slow_duration+=B.duration);try{var F=JSON.parse(JSON.stringify(L));F.success=O,F.resourceSlow=h,F.isSlow=x,U.timings.push(F)}catch{}}),U.count&&(U.size=Math.round(U.size/U.count),U.duration=Math.round(U.duration/U.count)),U.slow_count&&(U.slow_duration=Math.round(U.slow_duration/U.slow_count)),U.err_count&&(U.err_duration=Math.round(U.err_duration/U.err_count)),U.timings.length>20&&(U.timings.sort(function(B,L){return L.duration-B.duration}),U.timings.length=20),U.timings=encodeURIComponent(JSON.stringify(U.timings)),A.push(U)});var E={_combo:1,resource:JSON.stringify(A)},b=S.navigator.connection;E.ct=b?b.effectiveType||b.type:"";var w=b&&(b.downlink||b.downlinkMax||b.bandwidth)||null;(w=w>999?999:w)&&(E.bandwidth=w),this._lg("resource",E,this.getConfig("sample"))}}})},mh})()(s,u),s._super=e,s._root=e._root,e.Browser=s,oh.exports=s,oh.exports}var x_={getArmsLogger:function(){return(function(){if(ay)return nh.exports;function i(g,c){var s=e[o]=new n(g);s.sendPipe(c);var d=s._conf;return d.autoSendPv!==!1&&s.sendPV(),d&&d.useFmp||s.sendPerformance(),d&&d.sendResource&&s.sendResources(),e[u]=!0,s}ay=1;var e=window,n=e.BrowserLogger=U_(),o=Li().key,u="__hasInitBlSdk";return n.singleton=function(g,c){return e[u]?e[o]:i(g,c)},n.createExtraInstance=function(g){g&&typeof g=="object"&&g.enableInstanceAutoSend!==!0&&(g.enableInstanceAutoSend=!1);var c=new n(g),s=c._conf;return s.enableInstanceAutoSend&&(s.autoSendPv!==!1&&c.sendPV(),s&&s.useFmp||c.sendPerformance(),s&&s.sendResource&&c.sendResources()),c},typeof window=="object"&&window.navigator&&e[o]&&(n.bl=(function(){if(e[u])return e[o];var g={},c=[];return o in e&&(g=e[o].config||{},c=e[o].pipe||[]),i(g,c)})()),nh.exports=n,nh.exports})()}};const cy="https://arms-retcode.aliyuncs.com/r.png?",ly="https://arms-retcode-sg.aliyuncs.com/r.png?",uy="https://retcode-us-west-1.arms.aliyuncs.com/r.png?",dy="e1iftji1w7@7ec1cef2cc88733",hy="e1iftji1w7@10a06d1ec260adc",fy="e1iftji1w7@10a06d1ec260adc",gh={cn:{reportUrl:cy,pid:dy},"cn-hangzhou":{reportUrl:cy,pid:dy},sg:{reportUrl:ly,pid:hy},"ap-southeast-1":{reportUrl:ly,pid:hy},usw:{reportUrl:uy,pid:fy},"us-west-1":{reportUrl:uy,pid:fy}},B_=i=>!!Object.isExtensible(i)&&(e=>Object.prototype.toString.call(e).slice(8,-1))(i)==="Object";function py(i,e){if(typeof i!="string")return!1;const n=i.indexOf(e);if(n<0)return!1;const o=i.indexOf(`
`);return o<0||n<o}function sn(i,e,n){return typeof i=="function"?(function(o,u,g){const c={MediaboxWrapperFunctionApply(s,d,l){let p;try{p=Reflect.apply(s,d,l)}catch(S){throw g(S),S}return sn(p,u,g)},MediaboxWrapperFunctionGet(s,d){const l=Object.getOwnPropertyDescriptor(s,d);return!l||l.writable||l.configurable?sn(s[d],u,g):s[d]},MediaboxWrapperClassConstructor(s,d){let l;try{l=new s(...d)}catch(p){throw g(p),p}return sn(l,u,g)}};return new Proxy(o,{apply:c.MediaboxWrapperFunctionApply,get:c.MediaboxWrapperFunctionGet,construct:c.MediaboxWrapperClassConstructor})})(i,e+1,n):i instanceof Promise?i.then(o=>sn(o,e+1,n)).catch(o=>(n(o),Promise.reject(o))):Array.isArray(i)?(i.forEach((o,u)=>{i[u]=sn(o,e+1,n)}),i):(o=>o!==null&&typeof o=="object")(i)&&B_(i)?(function(o,u,g){var c;if(Reflect.get(o,"__v_skip")===!0)return o;const s=[],d=typeof Object.getOwnPropertyDescriptors=="function"?Object.getOwnPropertyDescriptors((c=Object.getPrototypeOf(o))!=null?c:{}):{};for(const p of Object.keys(d))d[p].get&&s.push(p);const l={MediaboxWrapperObjectGetter(p,S){if(typeof S=="string"&&s.indexOf(S)>-1){let T;try{T=p[S]}catch(y){throw g(y),y}return sn(T,u,g)}return u>10?p[S]:sn(p[S],u,g)},MediaboxWrapperObjectSetter:(p,S,T)=>(p[S]=sn(T,u,g),!0)};return Object.defineProperty(o,"__v_skip",{configurable:!0,enumerable:!1,writable:!1,value:!0}),new Proxy(o,{get:l.MediaboxWrapperObjectGetter,set:l.MediaboxWrapperObjectSetter})})(i,e+1,n):i}function my(i){return typeof i=="string"&&(i.indexOf("g.alicdn.com/apsara-media-")>-1||i.indexOf("g.alicdn.com/thor-server")>-1||i.indexOf("MediaboxWrapper")>-1)}class gy extends Error{constructor(e){super(e),this.name="MQTError"}}let V_=1;class of{constructor(e){var n,o;ao(this,"armsLogger"),ao(this,"isReady",!1),ao(this,"isDestroyed",!1),ao(this,"options"),ao(this,"queue",[]),ao(this,"marker"),ao(this,"helper",{MediaboxWrapperQueue:u=>new gy(u),MediaboxWrapperInitiative:u=>new gy(u)}),this.options=Vr(Qe({},e),{region:e.deferRegionSet?void 0:(n=e.region)!=null?n:"cn",env:(o=e.env)!=null?o:"prod"}),this.marker=`-${V_++}-`,this.initArmsLogger()}static get version(){return"0.23.0"}initArmsLogger(e){const{region:n,env:o,disabled:u}=this.options;if(u||this.armsLogger)return;if(e&&!n)throw new Error("region is required");if(!n)return;if(!gh[n])throw new Error(`region ${n} is not supported`);const g=x_.getArmsLogger();this.armsLogger=g.createExtraInstance({enableInstanceAutoSend:!0,pid:gh[n].pid,tag:this.options.businessName,release:`${this.options.businessName}_${this.options.version}`,imgUrl:gh[n].reportUrl,behavior:!0,sample:1,disableHook:!0,environment:o,beforeReport:c=>{var s;if(this.isDestroyed||py(c.stack,this.marker)||c.t!=="pv"&&c.t!=="error")return!1;if(c.c1=(s=this.options.cid)!=null?s:window.location.host,c.c2=of.version,this.options.customData&&(c.c3=new URLSearchParams(this.options.customData).toString()),c.t==="error"){if((function(d){return typeof d=="string"&&(d.indexOf("g.alicdn.com/apsara-media-")>-1||d.indexOf("g.alicdn.com/thor-server")>-1)})(c.file)||my(c.stack)){let d=c;return this.options.beforeSend&&(d=this.options.beforeSend(c)),this.isReady?d:(d&&this.queue.push(d),!1)}return!1}return c}})}wrap(e){return this.options.disabled||typeof Proxy>"u"?e:sn(e,0,n=>{var o;n instanceof Error&&typeof n.stack=="string"&&my(n.stack)&&((o=this.armsLogger)==null||o.error(n),n.stack=(function(u,g){if(typeof u!="string")return g;if(py(u,g))return u;const c=u.indexOf(`
`);return c<0?`${u}${g}`:`${u.slice(0,c)}${g}${u.slice(c)}`})(n.stack,this.marker))})}updateOptions(e){this.options=Qe(Qe({},this.options),e)}setReady(){this.initArmsLogger(!0),this.isReady=!0,this.queue.length&&this.queue.forEach(e=>{var n;(n=this.armsLogger)==null||n.error(this.helper.MediaboxWrapperQueue(e.msg),{filename:e.file,lineno:e.line,colno:e.col})})}report(e,n){var o;(o=this.armsLogger)==null||o.error(this.helper.MediaboxWrapperInitiative(e),n)}destroy(){this.isDestroyed=!0}}var Xt=(i=>(i.PullStreamStats="remoteStat",i.RtsSubscribeExceeds="rtsSubscribeExceeds",i.UserJoined="userJoined",i.UserLeft="userLeft",i.Bye="bye",i.MuteAudio="muteAudio",i.UnmuteAudio="unmuteAudio",i.MuteVideo="muteVideo",i.UnmuteVideo="unmuteVideo",i.MuteScreen="muteScreen",i.UnmuteScreen="unmuteScreen",i.Error="error",i))(Xt||{}),Ui=(i=>(i.Local="local-device-status-change",i.Remote="remote-device-status-change",i))(Ui||{}),De=(i=>(i.Audio="sophon_audio",i.VideoLarge="sophon_video_camera_large",i.VideoSmall="sophon_video_camera_small",i.Screen="sophon_video_screen_share",i.Data="sophon_data",i))(De||{}),xh=(i=>(i.Audio="rts audio",i.VideoLarge="rts video",i))(xh||{}),Pn=(i=>(i.Add="add",i.Delete="delete",i.Replace="replace",i.Stop="stop",i.UnPublish="unpublish",i))(Pn||{}),bs=(i=>(i[i.Camera=0]="Camera",i[i.Screen=1]="Screen",i[i.Image=2]="Image",i))(bs||{}),ul=(i=>(i[i.Microphone=0]="Microphone",i[i.Screen=1]="Screen",i[i.Mixed=2]="Mixed",i))(ul||{}),Ht=(i=>(i.InRoom="inRoom",i.Join="join",i.Publish="publish",i.User="user",i.Resume="resume",i.Retry="retry",i.Reconnect="reconnect",i))(Ht||{}),xr=(i=>(i[i.MANUAL=0]="MANUAL",i[i.JOIN_CHANNEL=1]="JOIN_CHANNEL",i[i.ROLE_CHANGE=2]="ROLE_CHANGE",i[i.RECONNECT=3]="RECONNECT",i))(xr||{});function la(){}const vS=class hs{static getInstance(){var e;return hs.instance||(hs.instance=new AudioContext),(e=hs.instance.resume())==null||e.then(la,la).catch(la),hs.instance}};W(vS,"instance");let gs=vS;const dl=()=>{var i;const e=gs.getInstance();e.state!=="running"&&e.state!=="closed"&&((i=e.resume())==null||i.then(la,la).catch(la)),window.removeEventListener("mousedown",dl),window.removeEventListener("touchstart",dl)};window.addEventListener("mousedown",dl),window.addEventListener("touchstart",dl);class H_ extends Ei{constructor(){super(),W(this,"audioContext"),W(this,"stream"),W(this,"sourceNode"),W(this,"analyser"),this.audioContext=gs.getInstance(),this.stream=new MediaStream}getLevel(){return this.analyser?this.analyser.getLevel():0}start(e,n=1e3){this.sourceNode&&this.stop(),this.stream.addTrack(e),this.sourceNode=this.audioContext.createMediaStreamSource(this.stream);const o=this.audioContext.createMediaStreamDestination();this.analyser=(function(u,g,c,s,d){let l,p=s,S=0;const T=u.createAnalyser();T.fftSize=256;const y=new Uint8Array(T.frequencyBinCount);g.connect(T),T.connect(c);const R=()=>{l&&window.clearInterval(l)},v=()=>{u.state==="suspended"&&u.resume(),l=window.setInterval(()=>{T.getByteFrequencyData(y);let h=Math.round(y.reduce((m,_)=>m+_)/y.length);h=Math.min(100,h),S=h,d&&d(h)},p)};return v(),{updateInterval:h=>{R(),p=h,v()},getLevel:()=>S,dispose:()=>{R(),g.disconnect(),T.disconnect()}}})(this.audioContext,this.sourceNode,o,n,u=>{this.emit("audioLevel",u)})}stop(){this.analyser&&this.analyser.dispose(),this.analyser=void 0,this.sourceNode=void 0,this.stream.getAudioTracks().forEach(e=>{this.stream.removeTrack(e)})}dispose(){this.stop()}}class yS extends Ei{constructor(e,n,o,u){super(),W(this,"uid"),W(this,"name"),W(this,"rtsManager"),W(this,"callId",""),W(this,"audioLevelMonitor"),W(this,"audioVolumeIndicationInterval",0),this.uid=e,this.name=n,this.rtsManager=o,this.audioVolumeIndicationInterval=u,this.audioLevelMonitor=new H_}get userId(){return this.uid}get displayname(){return this.name}createCallId(e=!1){this.callId&&!e||(this.callId=ei.createCallid())}setUserInfo(e,n){this.uid=e,this.name=n}refreshUserInfo(e){this.uid=e}getAudioLevel(){return this.audioLevelMonitor.getLevel()}enableAudioVolumeIndication(e){this.audioVolumeIndicationInterval=e}clear(){this.audioLevelMonitor.dispose()}}class SS{static getCurrentStatus(e){let n=0;e.micOpen&&(n+=1),e.micInterrupted&&(n+=2),e.cameraOpen&&(n+=4),e.screenShare&&(n+=128),e.audioDisable&&(n+=8),e.videoDisable&&(n+=16),e.screenDisable&&(n+=256);let o=n.toString(16);for(;o.length<16;)o="0"+o;return o}static parseStatus(e){let n=parseInt(e,16);return{micOpen:!!(1&n),micInterrupted:!!(2&n),cameraOpen:!!(4&n),screenShare:!!(128&n),audioDisable:!!(8&n),videoDisable:!!(16&n),screenDisable:!!(256&n),backgroundMode:!!(32&n),accompanyPlaying:!!(64&n)}}}const ge=(i,e)=>(n,o,u)=>{const g=u.value;return u.value=function(...c){var s;const d=`[${((s=n.constructor)==null?void 0:s.logName)||""}]`,l=Date.now();let p=[];if(i)try{p=i(c)}catch{}ke.interface(d,o,...p);const S=g.apply(this,c);return Promise.resolve(S).then(T=>T).catch(T=>T).then(T=>{var y;let R="";const v=T instanceof Error,h=v&&((y=n.constructor)==null?void 0:y.logError);if(e||v){if(h)R=T;else if(v)R=T.message||"";else{if(!e)return;if(T===void 0)R="";else try{R=e(T)}catch{}}ke.interfaceResult(d,o,!(v&&h),Date.now()-l+"ms",R)}}),S},u},He=i=>i,bS="customVideoProfile",ES="customScreenProfile",Bh={width:1280,height:720,frameRate:30,maxBitrate:2e3},vy={width:1920,height:1080,frameRate:30,maxBitrate:2600};var fs=(i=>(i[i.ERROR_DEVICE_UNKNOWNERROR=1e4]="ERROR_DEVICE_UNKNOWNERROR",i[i.ERROR_DEVICE_AUDIODEVICE_NOTFOUND=10001]="ERROR_DEVICE_AUDIODEVICE_NOTFOUND",i[i.ERROR_DEVICE_AUDIODEVICE_NOTALLOWED=10002]="ERROR_DEVICE_AUDIODEVICE_NOTALLOWED",i[i.ERROR_DEVICE_AUDIODEVICE_NOTREADABLE=10003]="ERROR_DEVICE_AUDIODEVICE_NOTREADABLE",i[i.ERROR_DEVICE_VIDEODEVICE_NOTFOUND=10004]="ERROR_DEVICE_VIDEODEVICE_NOTFOUND",i[i.ERROR_DEVICE_VIDEODEVICE_NOTALLOWED=10005]="ERROR_DEVICE_VIDEODEVICE_NOTALLOWED",i[i.ERROR_DEVICE_VIDEODEVICE_NOTREADABLE=10006]="ERROR_DEVICE_VIDEODEVICE_NOTREADABLE",i[i.ERROR_SCREENSHARE_NOTSUPPORT=10010]="ERROR_SCREENSHARE_NOTSUPPORT",i[i.ERROR_SCREENSHARE_NOTALLOWED=10011]="ERROR_SCREENSHARE_NOTALLOWED",i[i.ERROR_SCREENSHARE_ENDED=10012]="ERROR_SCREENSHARE_ENDED",i[i.ERROR_SCREENSHARE_NOPERMISSION=10013]="ERROR_SCREENSHARE_NOPERMISSION",i[i.ERROR_SCREENSHARE_SAFARI_INVALIDACCESS=10014]="ERROR_SCREENSHARE_SAFARI_INVALIDACCESS",i[i.ERROR_SCREENSHARE_UNKNOWNERRO=10019]="ERROR_SCREENSHARE_UNKNOWNERRO",i[i.ERROR_DEVICE_NOTALLOWED=10021]="ERROR_DEVICE_NOTALLOWED",i[i.ERROR_DEVICE_NOTSUPPORT=2e4]="ERROR_DEVICE_NOTSUPPORT",i))(fs||{});const j_={1e4:vi.AliEngineLocalDeviceExceptionTypeUnknown,2e4:vi.AliEngineLocalDeviceExceptionTypeUnknown,10001:vi.AliEngineLocalDeviceExceptionTypeMicNotAvailable,10002:vi.AliEngineLocalDeviceExceptionTypeMicAuthFail,10003:vi.AliEngineLocalDeviceExceptionTypeMicOpenFail,10005:vi.AliEngineLocalDeviceExceptionTypeCameraAuthFail,10004:vi.AliEngineLocalDeviceExceptionTypeVideoDeviceException,10006:vi.AliEngineLocalDeviceExceptionTypeCameraOpenFail,10010:vi.AliEngineLocalDeviceExceptionTypeDisplayException,10011:vi.AliEngineLocalDeviceExceptionTypeDisplayException,10012:vi.AliEngineLocalDeviceExceptionTypeDisplayException,10013:vi.AliEngineLocalDeviceExceptionTypeDisplayException,10014:vi.AliEngineLocalDeviceExceptionTypeDisplayException,10019:vi.AliEngineLocalDeviceExceptionTypeDisplayException};var nr=(i=>(i.CREATE_ENGINE="create_engine",i.JOIN="join",i.WANT_INSERT_PUB_TASK="wantInsertPubTask",i.INSERT_PUB_TASK="InsertPubTask",i.HANDLE_PUB_TASK="HandlePubTask",i.RECV_NOTIFY_PUBLISH="RecvNotifyPublish",i.INSERT_SUB_TASK="InsertSubTask",i.HANDLE_SUB_TASK="HandleSubTask",i.FIRST_REMOTE="first_remote",i))(nr||{}),Sr=(i=>(i.START="start",i.SEND_SIG="send_sig",i.RECV_RST="recv_rst",i.END="end",i.RECEIVED="received",i.DECODED="decoded",i.PLAYED="played",i))(Sr||{});const RS=(i,e,n=!1)=>{const o=()=>(i.muted=!0,Promise.race([Bn(500),i._playPromise||Promise.resolve()]).catch(()=>{}).then(()=>{let u;return n&&i.srcObject===e?u=Promise.resolve():(i.load(),i.srcObject=e,u=i.play(),i._playPromise=u),u}));return new Promise(u=>{if(wt.AliRTS.BrowserUtil.isMicroMessenger){const g=window.top!==window.self,c=window.WeixinJSBridge||window.top.WeixinJSBridge;c?c.invoke("getNetworkType",{},()=>{u(o())}):(g?window.top.document:document).addEventListener("WeixinJSBridgeReady",()=>{c.invoke("getNetworkType",{},()=>{u(o())})}),setTimeout(()=>{u(o())},1e3)}else setTimeout(()=>{u(o())},0)})},Ur=i=>{Promise.race([Bn(100),i._playPromise||Promise.resolve()]).catch(()=>{}).then(()=>{i.srcObject=null,i._playPromise=void 0})};var _S=(i=>(i[i.AliEngineDataMsgNone=0]="AliEngineDataMsgNone",i[i.AliEngineDataMsgMusicProgress=1]="AliEngineDataMsgMusicProgress",i[i.AliEngineDataMsgCustom=2]="AliEngineDataMsgCustom",i))(_S||{});class bl{constructor(e,n,o,u=0){W(this,"msgType"),W(this,"msgId"),W(this,"protocolVersion"),W(this,"tlvVersion"),this.msgType=e,this.msgId=n,this.protocolVersion=o,this.tlvVersion=u}build(){const e=new Uint8Array(4);return e.set(Uint8Array.from([this.protocolVersion,this.tlvVersion<<4|15&this.msgType]),0),e.set(Uint16Array.from([this.msgId]),2),e}static parse(e){const n=new DataView(e),o=n.getUint8(0),u=n.getUint8(1)>>4,g=15&n.getUint8(1),c=n.getUint16(2);return new bl(g,c,o,u)}}class qc{constructor(e,n,o){if(W(this,"_byteArray"),this._byteArray=new Uint8Array(0),e!==void 0&&n!==void 0&&o!==void 0){const u=new bl(e,n,o).build();this._byteArray=new Uint8Array(u.byteLength+this._byteArray.byteLength),this._byteArray.set(u,0)}}write(e,n){const o=this._byteArray,u=new ArrayBuffer(5),g=new DataView(u);g.setUint8(0,e),g.setUint32(1,n.byteLength);const c=new Uint8Array(o.byteLength+5+n.byteLength);c.set(o,0),c.set(new Uint8Array(u),o.byteLength),c.set(new Uint8Array(n),o.byteLength+5),this._byteArray=c}static parse(e){const n={},o=new DataView(e);let u=0;for(;u<e.byteLength;){const g=o.getUint8(u),c=o.getUint32(u+1);if(!(u+5+c<=e.byteLength))break;{const s=e.slice(u+5,u+5+c);n[g]=s,u+=5+c}}return n}get buffer(){return this._byteArray.buffer}}class Es{constructor(e=0,n=!0,o=1,u=!1,g=0,c=!1,s=!1,d=3){W(this,"_fin",!0),W(this,"_hasExtension",!1),W(this,"_version",0),W(this,"_frameType",1),W(this,"_isEncrypted",!1),W(this,"_isCompressed",!1),W(this,"_signalType",3),W(this,"_payloadLength",0),this._fin=n,this._hasExtension=u,this._version=g,this._frameType=o,this._isEncrypted=c,this._isCompressed=s,this._signalType=d,this._payloadLength=e}get fin(){return this._fin}get hasExtension(){return this._hasExtension}get version(){return this._version}get frameType(){return this._frameType}get isEncrypted(){return this._isEncrypted}get isCompressed(){return this._isCompressed}get signalType(){return this._signalType}get payloadLength(){return this._payloadLength}toBuffer(){const e=new ArrayBuffer(4),n=new DataView(e);return n.setUint8(0,(this._fin?1:0)<<7|(this._hasExtension?1:0)<<6|this._version<<4|15&this._frameType),n.setUint8(1,(this._isEncrypted?1:0)<<7|(this._isCompressed?1:0)<<6|15&this._signalType),n.setUint16(2,this._payloadLength),e}static parse(e){const n=new DataView(e),o=n.getUint8(0)>>7==1,u=(64&n.getUint8(0))>>6==1,g=(48&n.getUint8(0))>>4,c=15&n.getUint8(0),s=n.getUint8(1)>>7==1,d=(64&n.getUint8(1))>>6==1,l=15&n.getUint8(1),p=n.getUint16(2);return new Es(p,o,c,u,g,s,d,l)}}class El{constructor(e,n){W(this,"_body"),W(this,"_header",new Es),this._header=e,this._body=n}get header(){return this._header}get isFin(){return this._header.fin}get body(){return this._body}toGRTNBuffer(){const e=this._header.toBuffer(),n=this._body,o=new ArrayBuffer(4);new DataView(o).setUint8(0,1*Math.pow(2,4));const u=new Uint8Array(o.byteLength+e.byteLength+n.byteLength);return u.set(new Uint8Array(o),0),u.set(new Uint8Array(e),o.byteLength),u.set(new Uint8Array(n),o.byteLength+e.byteLength),u.buffer}static parse(e){const n=e.slice(0,4),o=Es.parse(n);let u=new ArrayBuffer(0);return e.byteLength-4>=o.payloadLength&&(u=e.slice(4,4+o.payloadLength)),new El(o,u)}}const vh=i=>{const e=i.byteLength,n=new DataView(i);let o=0;for(let u=0;u<e;u++)o=256*o+n.getUint8(u);return o};let yy=0;class mo{constructor(e,n=0,o=0,u=0){W(this,"data"),W(this,"networkTime"),W(this,"futureOrProgress"),W(this,"type"),this.data=e,this.type=n,this.networkTime=o,this.futureOrProgress=u}toBuffer(){const e=new qc(0,0,0);e.write(1,Uint8Array.from([0]).buffer),e.write(2,Uint16Array.from([0]).buffer),yy++,e.write(3,Uint32Array.from([yy]).buffer);const n=new qc;return n.write(1,Uint8Array.from([0]).buffer),n.write(2,Uint8Array.from([this.type]).buffer),n.write(3,Uint32Array.from([this.futureOrProgress]).buffer),n.write(4,Uint32Array.from([Number(this.networkTime>>32&4294967295),Number(4294967295&this.networkTime)]).buffer),n.write(5,this.data),e.write(30,n.buffer),e.buffer}static parse(e){if(!e||e.byteLength<4)return;bl.parse(e.slice(0,4));const n=qc.parse(e.slice(4))[30];if(!n)return;const o=qc.parse(n),u=o[2],g=o[3],c=o[4],s=o[5];return s.byteLength!==0?new mo(s,vh(u),vh(c),vh(g)):void 0}}var z_=Object.defineProperty,F_=Object.getOwnPropertyDescriptor,Wt=(i,e,n,o)=>{for(var u,g=F_(e,n),c=i.length-1;c>=0;c--)(u=i[c])&&(g=u(e,n,g)||g);return g&&z_(e,n,g),g};class cs extends Ei{constructor(){super(),W(this,"_state"),W(this,"time"),this._state=tt.AliRtcStatePublishIdle,this.time=Date.now()}get state(){return this._state}setState(e){const n=this._state,o=this.time;this._state=e,this.time=Date.now(),this.emit("change",n,e,Math.floor((this.time-o)/1e3))}}var on;const Ft=(on=class extends yS{constructor(i){const{rtsManager:e,localStreamManager:n,slsReporter:o,signalingManager:u,audioVolumeIndicationInterval:g,parameter:c}=i;super("","",e,g),W(this,"sessionId",""),W(this,"traceId",""),W(this,"_url",""),W(this,"joinTime",0),W(this,"publishPromise",Promise.resolve({traceId:"",l1ip:void 0})),W(this,"previewElements",[]),W(this,"screenPreviewElements",[]),W(this,"streamManager"),W(this,"dc"),W(this,"streamTracks"),W(this,"publishId",Er()),W(this,"signalingManager"),W(this,"shouldPublish",!1),W(this,"monitorTimerId"),W(this,"monitorDataCache",{}),W(this,"candidateDataCache",[]),W(this,"pcMediaStatsMap",{}),W(this,"slsReporter"),W(this,"audioPubState"),W(this,"videoPubState"),W(this,"videoSmallPubState"),W(this,"screenPubState"),W(this,"dataPubState"),W(this,"parameter",{}),W(this,"onTrackEnd",s=>{this.emit(s)}),this.streamManager=n,this.signalingManager=u,this.slsReporter=o,this.parameter=c,this.streamManager.on("trackended",s=>{this.onTrackEnd(s)}),this.streamManager.on("publishupdate",()=>{this.publishUpdate()}),this.audioPubState=new cs,this.audioPubState.on("change",(s,d,l)=>{this.emit("audioPublishStateChanged",s,d,l)}),this.videoPubState=new cs,this.videoPubState.on("change",(s,d,l)=>{this.emit("videoPublishStateChanged",s,d,l)}),this.videoSmallPubState=new cs,this.videoSmallPubState.on("change",(s,d,l)=>{this.emit("dualStreamPublishStateChanged",s,d,l)}),this.screenPubState=new cs,this.screenPubState.on("change",(s,d,l)=>{this.emit("screenPublishStateChanged",s,d,l)}),this.dataPubState=new cs,this.dataPubState.on("change",(s,d,l)=>{this.emit("dataPublishStateChanged",s,d,l)}),this.startStreamMonitor(),this.createCallId()}get url(){return this._url}set url(i){this._url=i,this.rtsManager.updateAuth(i)}get joined(){return!!this.uid}get isPublishing(){return this.rtsManager.publishingTracks.length>0}get publishStreams(){return this.streamManager.publishStreams}get cameraTrack(){return this.streamManager.cameraStreamInfo.originVideoTrack}get screenTrack(){return this.streamManager.screenStreamInfo.originVideoTrack}get audioTrack(){return this.streamManager.cameraStreamInfo.originAudioTrack}get hasCamera(){return!!this.streamManager.cameraStreamInfo.originVideoTrack}get hasMicrophone(){return!!this.streamManager.cameraStreamInfo.originAudioTrack}get hasScreenShare(){return!!this.streamManager.screenStreamInfo.originVideoTrack}get hasCameraTrackInMS(){var i;return!!((i=this.streamTracks)!=null&&i.find(({ssrc:e,type:n,msid:o})=>n==="video"&&e&&o===De.VideoLarge))}get hasCameraDualTrackInMS(){var i;return!!((i=this.streamTracks)!=null&&i.find(({ssrc:e,type:n,msid:o})=>n==="video"&&e&&o===De.VideoSmall))}get hasScreenTrackInMS(){var i;return!!((i=this.streamTracks)!=null&&i.find(({ssrc:e,type:n,msid:o})=>n==="video"&&e&&o===De.Screen))}get hasAudioTrackInMS(){var i;return!!((i=this.streamTracks)!=null&&i.find(({ssrc:e,type:n,msid:o})=>n==="audio"&&e&&o===De.Audio))}get cameraDirection(){var i,e;return(e=(i=this.streamManager.cameraStreamInfo)==null?void 0:i.cameraVideoConstraints)==null?void 0:e.facingMode}get audioCaptureDisabled(){return this.streamManager.audioCaptureDisabled}get cameraCaptureDisabled(){return this.streamManager.cameraCaptureDisabled}get publishLocalVideoStreamEnabled(){return this.streamManager.publishLocalVideoStreamEnabled}get publishLocalAudioStreamEnabled(){return this.streamManager.publishLocalAudioStreamEnabled}get publishLocalScreenStreamEnabled(){return this.streamManager.publishLocalScreenStreamEnabled}setPublishLocalAudioStreamEnabled(i){this.streamManager.publishLocalAudioStreamEnabled=i}setPublishLocalVideoStreamEnabled(i){this.streamManager.publishLocalVideoStreamEnabled=i}setPublishLocalScreenStreamEnabled(i){this.streamManager.publishLocalScreenStreamEnabled=i}initInfo(i,e){this.joinTime=Date.now(),this.rtsManager.localJoinTime=this.joinTime,this.setUserInfo(i.userId,i.userId),this.url=e,this.sessionId=i.sessionId||ei.createCallid("web"),this.updatePubId()}setVideoProfile(i){return pe(this,null,function*(){yield this.streamManager.setVideoProfile(bS,i)})}setVideoContentHint(i){this.streamManager.setVideoContentHint(i)}setScreenContentHint(i){this.streamManager.setScreenContentHint(i)}setAudioProfile(i){return pe(this,null,function*(){yield this.streamManager.setAudioProfile(i)})}setScreenProfile(i){return pe(this,null,function*(){yield this.streamManager.setScreenProfile(ES,i)})}setCameraDirection(i){if(i===Ss.CAMERA_FRONT)this.streamManager.setCameraVideoConstraints({facingMode:"user"});else{if(i!==Ss.CAMERA_REAR)throw new Ve(je.ERR_CAMERA_OPEN_FAIL,`camera direction set to  ${i} failed`);this.streamManager.setCameraVideoConstraints({facingMode:"environment"})}}setCameraDeviceId(i){this.streamManager.setCameraVideoConstraints({deviceId:i})}muteLocalCamera(i){this.streamManager.setCameraMuted(i),this.slsReporter.reportMute(this.callId,!i,"video")}muteLocalMic(i){this.streamManager.setAudioMuted(i),this.slsReporter.reportMute(this.callId,!i,"audio")}muteLocalScreen(i){this.streamManager.setScreenMuted(i),this.slsReporter.reportMute(this.callId,!i,"screen")}setMicrophoneDeviceId(i){this.streamManager.setMicAudioConstraints({deviceId:i})}setMicrophoneConstraints(i){this.streamManager.setMicAudioConstraints(i)}updatePubId(){this.publishId=Er()}clearPublishState(){this.streamTracks=void 0}leave(){return pe(this,null,function*(){this.shouldPublish=!1,this.isPublishing&&(yield this.unPublish()),this.joinTime=0,this.dc=void 0})}clear(){return pe(this,null,function*(){cS(on.prototype,this,"clear").call(this),this.stopPreview(),this.resetPreviewElements(),this.resetSecondayPreviewElements(),this.clearStream(),yield this.leave(),this.streamManager.cameraCaptureDisabled=!1})}resetElement(i){this.previewElements.includes(i)&&(Ur(i),this.previewElements.splice(this.previewElements.indexOf(i),1)),this.screenPreviewElements.includes(i)&&(Ur(i),this.screenPreviewElements.splice(this.screenPreviewElements.indexOf(i),1))}setPreviewElement(i){const{videoElement:e,screen:n}=i;n?this.screenPreviewElements.includes(e)||(this.screenPreviewElements.push(e),this.preview(i)):this.previewElements.includes(e)||(this.previewElements.push(e),this.preview(i))}startDefaultCameraAndMic(i){return pe(this,null,function*(){const{hasCamera:e,cameraCaptureDisabled:n,publishLocalVideoStreamEnabled:o}=this,{hasMicrophone:u,audioCaptureDisabled:g,publishLocalAudioStreamEnabled:c}=this,s=!e&&!i&&!n&&o,d=!u&&!g&&c;try{s&&d?yield this.startCameraAndMic():s?yield this.startCameraCapture():d&&(yield this.startAudioCapture())}catch(l){const p=l.errorCode;let S=je.ERR_CAMERA_OPEN_FAIL;throw s?((p===fs.ERROR_DEVICE_VIDEODEVICE_NOTALLOWED||fs.ERROR_DEVICE_NOTALLOWED)&&(S=je.ERR_CAMERA_AUTH_FAIL),S=je.ERR_CAMERA_OPEN_FAIL):((p===fs.ERROR_DEVICE_AUDIODEVICE_NOTALLOWED||fs.ERROR_DEVICE_NOTALLOWED)&&(S=je.ERR_MIC_AUTH_FAIL),S=je.ERR_MIC_OPEN_FAIL),new Ve(S,`auto open fail: ${l.message}`)}})}setViewConfig(i,e){if(i){if(![Rt.AliRtcVideoTrackCamera,Rt.AliRtcVideoTrackScreen].includes(e))throw new Ve(je.ERR_INVALID_ARGUMENTS,"set view config invalid track",{track:e});i.forEach(n=>{this.setPreviewElement({videoElement:n,screen:e===Rt.AliRtcVideoTrackScreen})})}else e===Rt.AliRtcVideoTrackCamera?this.stopPreview({primary:!0,screen:!1}):this.stopPreview({primary:!1,screen:!0})}startCameraCapture(){return pe(this,null,function*(){return this.streamManager.cameraCaptureDisabled=!1,yield this.createLocalStream({video:!0})})}stopCameraCapture(){return pe(this,null,function*(){this.streamManager.cameraCaptureDisabled=!0,yield this.stopLocalStream({video:!0})})}startAudioCapture(){return pe(this,null,function*(){return this.streamManager.audioCaptureDisabled=!1,yield this.createLocalStream({audio:!0})})}stopAudioCapture(){return pe(this,null,function*(){this.streamManager.audioCaptureDisabled=!0,yield this.stopLocalStream({audio:!0})})}startCameraAndMic(){return pe(this,null,function*(){return this.streamManager.cameraCaptureDisabled=!1,this.streamManager.audioCaptureDisabled=!1,yield this.createLocalStream({video:!0,audio:!0})})}preview(i){return pe(this,null,function*(){const{videoElement:e,screen:n}=i??{};try{let o=n?this.streamManager.screenStreamInfo.previewStream:this.streamManager.cameraStreamInfo.previewStream;if(!e)throw new Ve(je.ERR_INVALID_ARGUMENTS,"no video element found",{videoElement:e});return o?(RS(e,o.mediaStream),this.setPreviewElement(i),o.mediaStream):void ke.info(`[${on.logName}]`,"preview no stream founded")}catch(o){const u=je.ERR_INNER;throw Ve.fromError(o,u,"preview failed")}})}previewAll(i){return pe(this,null,function*(){const{primary:e=!0,screen:n=!0}=i??{};if(e&&this.previewElements.length)for(let o=0;o<this.previewElements.length;o++){const u=this.previewElements[o];yield this.preview({videoElement:u})}if(n&&this.screenPreviewElements.length)for(let o=0;o<this.screenPreviewElements.length;o++){const u=this.screenPreviewElements[o];yield this.preview({videoElement:u,screen:!0})}})}stopPreview(i){const{videoElement:e,primary:n=!0,screen:o=!0}=i||{};if(e){const u=this.previewElements.findIndex(g=>g===e);if(u>=0)this.previewElements.splice(u,1),Ur(e);else{const g=this.screenPreviewElements.findIndex(c=>c===e);g>=0&&(this.screenPreviewElements.splice(g,1),Ur(e))}}else n&&(this.previewElements.forEach(u=>{Ur(u)}),this.previewElements=[]),o&&(this.screenPreviewElements.forEach(u=>{Ur(u)}),this.screenPreviewElements=[])}resumePublish(){return pe(this,null,function*(){this.shouldPublish&&(this.createCallId(!0),yield this.startPublish(!0))})}createLocalStream(i){return pe(this,null,function*(){try{if(i.video)for(let n=0;n<this.previewElements.length;n++){const o=this.previewElements[n];Ur(o)}else if(i.screen)for(let n=0;n<this.screenPreviewElements.length;n++){const o=this.screenPreviewElements[n];Ur(o)}const e=yield this.streamManager.createLocalStream(i);return e!=null&&e.audioTrack&&this.audioVolumeIndicationInterval>0&&this.audioLevelMonitor.start(e.audioTrack,this.audioVolumeIndicationInterval),i.video?this.previewAll({primary:!0}):i.screen&&this.previewAll({screen:!0}),e}catch(e){const n=j_[e.errorCode];throw n&&(i.audio?this.emit("localDeviceException",ln.AliEngineLocalDeviceTypeMic,n,""):i.video?this.emit("localDeviceException",ln.AliEngineLocalDeviceTypeCamera,n,""):i.screen?this.emit("localDeviceException",ln.AliEngineLocalDeviceTypeDisplay,n,""):this.emit("localDeviceException",ln.AliEngineLocalDeviceTypeUnknown,n,"")),e}})}stopLocalStream(i){return pe(this,null,function*(){i.audio&&this.audioLevelMonitor.stop(),yield this.streamManager.stopLocalStream(i)})}compareAndPublish(i,e,n){return pe(this,null,function*(){var o,u;if(!i&&!e)return;if(i&&!e){const c={};return n===De.Audio?c.audio=!0:n===De.VideoLarge||n===De.VideoSmall?(c.video=!0,c.vMsid=n):n===De.Screen&&(c.screen=!0),yield this.publishDeleteTracks(c)}const g={};if(e!=null&&e.hasVideo&&(g.isScreen=n===De.Screen,g.vMsid=n),e!=null&&e.hasAudio&&(g.aMsid=n),!i&&e)return yield this.publishAdd(e,g,!1);if(i&&e&&i.trackId!==(((o=e.videoTrack)==null?void 0:o.id)||((u=e.audioTrack)==null?void 0:u.id)))return yield this.publishReplace(e,g)})}reportAudioProfile(){const i=this.streamManager.cameraStreamInfo.audioProfile||"standard",e=wt.AliRTS.AudioProfileMap.get(i);this.slsReporter.reportPublishProfile(De.Audio,{a_profile:i,bits:e?.maxBitrate||0,samplerate:e?.sampleRate||0,channel:e?.channelCount||0})}reportVideoProfile(){const i=this.streamManager.cameraStreamInfo.videoProfile||"",e=wt.AliRTS.VideoProfileMap.get(i);e&&this.slsReporter.reportPublishProfile(De.VideoLarge,{v_profile:i,wdth:e?.width||0,hgt:e?.height||0,fps:e?.frameRate||0,bitrate:e?.maxBitrate||0})}reportScreenProfile(){const i=this.streamManager.screenStreamInfo.videoProfile||"",e=wt.AliRTS.VideoProfileMap.get(i);e&&this.slsReporter.reportPublishProfile(De.Screen,{v_profile:i,wdth:e?.width||0,hgt:e?.height||0,fps:e?.frameRate||0,bitrate:e?.maxBitrate||0})}updateDataChannel(i){i&&(this.dc=i,this.dc.datachannel&&(this.dc.datachannel.binaryType="arraybuffer"))}publishDataChannel(){return pe(this,null,function*(){if(this.dataPubState.state!==tt.AliRtcStatePublishing){this.dataPubState.setState(tt.AliRtcStatePublishing);try{const i=yield this.rtsManager.publishAddDataChannel(this.url);i?(this.updateDataChannel(i),this.dataPubState.setState(tt.AliRtcStatePublished)):(this.dataPubState.setState(tt.AliRtcStateNoPublish),this.emit("publishDataError",new Ve(je.ERR_INNER,"publishDataError")))}catch(i){ke.error("[LocalUser]","publishDataChannel error",i),this.dataPubState.setState(tt.AliRtcStateNoPublish)}}})}startPublish(){return pe(this,arguments,function*(i=!1,e=xr.MANUAL){var n;if(!this.joined)return;this.shouldPublish=!0;const o=this.streamManager.publishStreams,{audio:u,video:g,videoSmall:c,screen:s}=o;if(u||g||c||s)try{const d=new Date().getTime();u&&this.audioPubState.setState(tt.AliRtcStatePublishing),g&&this.videoPubState.setState(tt.AliRtcStatePublishing),c&&this.videoSmallPubState.setState(tt.AliRtcStatePublishing),s&&this.screenPubState.setState(tt.AliRtcStatePublishing),this.publishPromise=this.rtsManager.publish(this,i,e);const{traceId:l,l1ip:p}=yield this.publishPromise;this.streamTracks=this.rtsManager.publishingTracks,this.traceId=l;const S={type:Pn.Add,userid:this.userId,sessionid:this.sessionId,displayname:this.name,pubid:this.publishId,resume:i,subscribe:{signal:"",pullstreamurl:this.url},l1ip:this.parameter.reportL1IP?p:void 0,callid:this.callId,tracks:this.streamTracks,traceid:l};(n=this.parameter.data)!=null&&n.enablePubDataChannel&&this.publishDataChannel().then(()=>{this.syncPublishToRoomServer(S,o,d)}),l&&(this.traceId=l),u&&this.reportAudioProfile(),g&&this.reportVideoProfile(),s&&this.reportScreenProfile(),yield this.syncPublishToRoomServer(S,o,d),u&&this.audioPubState.setState(tt.AliRtcStatePublished),g&&this.videoPubState.setState(tt.AliRtcStatePublished),c&&this.videoSmallPubState.setState(tt.AliRtcStatePublished),s&&this.screenPubState.setState(tt.AliRtcStatePublished)}catch(d){throw u&&this.audioPubState.setState(tt.AliRtcStateNoPublish),g&&this.videoPubState.setState(tt.AliRtcStateNoPublish),c&&this.videoSmallPubState.setState(tt.AliRtcStateNoPublish),s&&this.screenPubState.setState(tt.AliRtcStateNoPublish),d}else ke.event(`[${on.logName}]`,"startPublish no stream founded")})}updateStreams(){return pe(this,null,function*(){yield this.streamManager.updateStreams()})}publishUpdate(i){return pe(this,null,function*(){var e,n,o,u,g;if(ke.info(`[${on.logName}]`,"publishUpdate",i||"-",this.shouldPublish),!this.shouldPublish)return;if(!this.rtsManager.isConnecting&&!this.rtsManager.isConnected)return void(yield this.startPublish());yield this.publishPromise;const c=this.streamManager.publishStreams;let s;const d=new Date().getTime();try{const l=(e=this.streamTracks)==null?void 0:e.find(({ssrc:m,type:_,msid:A})=>_==="audio"&&m&&A===De.Audio),p=yield this.compareAndPublish(l,c.audio,De.Audio);p&&(s=p);const S=(n=this.streamTracks)==null?void 0:n.find(({ssrc:m,type:_,msid:A})=>_==="video"&&m&&A===De.VideoLarge),T=yield this.compareAndPublish(S,c.video,De.VideoLarge);T&&(s=T);const y=(o=this.streamTracks)==null?void 0:o.find(({ssrc:m,type:_,msid:A})=>_==="video"&&m&&A===De.VideoSmall),R=yield this.compareAndPublish(y,c.videoSmall,De.VideoSmall);R&&(s=R);const v=(u=this.streamTracks)==null?void 0:u.find(({ssrc:m,type:_,msid:A})=>_==="video"&&m&&A===De.Screen),h=yield this.compareAndPublish(v,c.screen,De.Screen);h&&(s=h),(g=this.parameter.data)!=null&&g.enablePubDataChannel&&!this.dc&&(yield this.publishDataChannel()),s||i!==xr.RECONNECT?s&&(yield this.syncPublishToRoomServer(s,c,d)):this.syncPublishToRoomServer({type:Pn.Add,userid:this.userId,sessionid:this.sessionId,displayname:this.name,pubid:this.publishId,subscribe:{signal:"",pullstreamurl:this.url},callid:this.callId,tracks:this.rtsManager.publishingTracks,traceid:this.traceId},c,Date.now())}catch(l){const{code:p}=l??{},S=this.url;throw p===403&&S&&(yield this.refreshPushStreamUrl(),s=yield this.publishUpdate()),l}return s})}syncPublishToRoomServer(i,e,n){return pe(this,null,function*(){var o;if(!i)return void ke.event(`[${on.logName}]`,"sync publish to room server failed because no publishInfo");let u=i;if(this.dc){const c=i,{tracks:s}=c,d=jn(c,["tracks"]);u=Vr(Qe({},d),{tracks:[...s,{type:"data",msid:De.Data,ssrc:`web_${this.callId.substring(0,8)}_${((o=this.dc.datachannel)==null?void 0:o.id)||"0"}`,codec:"text"}]})}const g=yield this.signalingManager.publish(u);i.signaltid=g.tid})}refreshPushStreamUrl(){return pe(this,null,function*(){const i=new Ve(je.ERR_INNER,"refresh push stream url error"),e=this.url;if(!e)throw i;const n=yield this.signalingManager.refreshUrl({pushstreamurl:e});if(!(n!=null&&n.pushstreamurl))throw i;this.url=n.pushstreamurl})}publishAdd(i,e,n=!1,o=0){return pe(this,null,function*(){const u=e?.aMsid===De.Audio,g=e?.vMsid===De.VideoLarge,c=e?.vMsid===De.VideoSmall,s=e?.vMsid===De.Screen;u&&this.audioPubState.setState(tt.AliRtcStatePublishing),g&&this.videoPubState.setState(tt.AliRtcStatePublishing),c&&this.videoSmallPubState.setState(tt.AliRtcStatePublishing),s&&this.screenPubState.setState(tt.AliRtcStatePublishing);try{const d=yield this.rtsManager.publishAdd(this,i,e,!1,!0);d&&(this.traceId=d),u&&(this.audioPubState.setState(tt.AliRtcStatePublished),this.reportAudioProfile()),g&&(this.videoPubState.setState(tt.AliRtcStatePublished),this.reportVideoProfile()),c&&this.videoSmallPubState.setState(tt.AliRtcStatePublished),s&&(this.screenPubState.setState(tt.AliRtcStatePublished),this.reportScreenProfile()),this.streamTracks=this.rtsManager.publishingTracks;const l={type:Pn.Add,userid:this.userId,sessionid:"",displayname:this.name,pubid:this.publishId,resume:n,subscribe:{signal:"",pullstreamurl:this.url},callid:this.callId,tracks:this.streamTracks,traceid:d};return this.reportSelfDeviceStatus(),this.monitorTimerId||this.startStreamMonitor(),l}catch(d){let l=je.ERR_SDK_PUBLISH_INVAILD;if(u&&(this.audioPubState.setState(tt.AliRtcStateNoPublish),l=je.ERR_SDK_PUBLISH_AUDIO_STREAM_FAILED),g&&(this.videoPubState.setState(tt.AliRtcStateNoPublish),l=je.ERR_SDK_PUBLISH_VIDEO_STREAM_FAILED),c&&(this.videoSmallPubState.setState(tt.AliRtcStateNoPublish),l=je.ERR_SDK_PUBLISH_DUAL_STREAM_FAILED),s&&(this.screenPubState.setState(tt.AliRtcStateNoPublish),l=je.ERR_SDK_PUBLISH_SCEEN_SHARE_FAILED),d.errorCode===15006&&o<3)return this.publishAdd(i,e,n,o+1);throw Ve.fromError(d,l,"publish add failed")}})}publishReplace(i,e){return pe(this,null,function*(){try{yield this.rtsManager.publishReplace(this.url,i,e),this.streamTracks=this.rtsManager.publishingTracks;const n=e?.vMsid===De.VideoLarge,o=e?.vMsid===De.Screen;n&&this.streamManager.setVideoProfile(void 0,void 0,!0),o&&this.streamManager.setScreenProfile(void 0,void 0);const u={type:Pn.Replace,userid:this.userId,sessionid:"",pubid:this.publishId,displayname:this.name,subscribe:{signal:"",pullstreamurl:this.url},callid:this.callId,tracks:this.streamTracks};return this.reportSelfDeviceStatus(),u}catch(n){throw Ve.fromError(n,je.ERR_INNER,`publish replace failed, vMsid: ${e?.vMsid} aMsid: ${e?.aMsid}`)}})}publishDeleteTracks(i){return pe(this,null,function*(){const e={type:Pn.Delete,userid:this.userId,sessionid:"",displayname:this.displayname,callid:this.callId,pubid:this.publishId,subscribe:{signal:"",pullstreamurl:this.url},tracks:[]};try{return yield this.rtsManager.publishDelete(this.url,i),this.streamTracks=this.rtsManager.publishingTracks,i.audio&&this.audioPubState.setState(tt.AliRtcStateNoPublish),i.video&&(i.vMsid===De.VideoSmall?this.videoSmallPubState.setState(tt.AliRtcStateNoPublish):this.videoPubState.setState(tt.AliRtcStateNoPublish)),i.screen&&this.screenPubState.setState(tt.AliRtcStateNoPublish),e.tracks=this.streamTracks,this.reportSelfDeviceStatus(),e}catch(n){throw Ve.fromError(n,je.ERR_INNER,"publish delete tracks failed")}})}publishStop(){return pe(this,null,function*(){ke.info(`[${on.logName}]`,"publishStop",{url:this.url});const i=new Date().getTime();try{const e=this.hasAudioTrackInMS,n=this.hasCameraTrackInMS,o=this.hasCameraDualTrackInMS,u=this.hasScreenTrackInMS;yield this.rtsManager.publishStop(this.url),e&&this.audioPubState.setState(tt.AliRtcStateNoPublish),n&&this.videoPubState.setState(tt.AliRtcStateNoPublish),o&&this.videoSmallPubState.setState(tt.AliRtcStateNoPublish),u&&this.screenPubState.setState(tt.AliRtcStateNoPublish),this.traceId="",Object.keys(this.monitorDataCache).forEach(c=>{this.reportPublishMonitor(c)}),this.streamTracks=[];const g={type:Pn.Stop,userid:this.userId,sessionid:this.sessionId,displayname:this.displayname,callid:this.callId,pubid:this.publishId,subscribe:{signal:"",pullstreamurl:this.url},tracks:[]};return this.syncPublishToRoomServer(g,{},i),g}catch(e){throw Ve.fromError(e,je.ERR_INNER,"publish stop failed")}})}unPublish(){return pe(this,null,function*(){this.shouldPublish=!1;const i=new Date().getTime();let e={type:Pn.UnPublish,userid:this.userId,sessionid:"",displayname:this.displayname,callid:this.callId,pubid:this.publishId,subscribe:{signal:"",pullstreamurl:this.url},tracks:[]};try{if(this.isPublishing){const n=this.hasAudioTrackInMS,o=this.hasCameraTrackInMS,u=this.hasCameraDualTrackInMS,g=this.hasScreenTrackInMS;yield this.rtsManager.unpublish(),this.streamTracks=[],this.stopStreamMonitor(),n&&this.audioPubState.setState(tt.AliRtcStateNoPublish),o&&this.videoPubState.setState(tt.AliRtcStateNoPublish),u&&this.videoSmallPubState.setState(tt.AliRtcStateNoPublish),g&&this.screenPubState.setState(tt.AliRtcStateNoPublish),this.traceId="",this.clearStream()}return this.dc&&(this.rtsManager.publishStopDataChannel(this.url,this.dc),this.dataPubState.setState(tt.AliRtcStateNoPublish),this.dc=void 0),this.slsReporter.reportUnpublish(this.callId||"",i,0,""),e}catch(n){throw Ve.fromError(n,je.ERR_INNER,"unpublish failed")}})}reportSelfDeviceStatus(){this.emit(Ui.Local,this.getDeviceStatus())}getDeviceStatus(){var i,e,n,o;let u={micOpen:!1,micInterrupted:!1,cameraOpen:!1,screenShare:!1,audioDisable:!0,videoDisable:!0,screenDisable:!0,backgroundMode:!1,accompanyPlaying:!1};return u.cameraOpen=this.hasCameraTrackInMS,u.videoDisable=this.hasCamera&&!((i=this.streamManager.cameraStreamInfo.originVideoTrack)!=null&&i.enabled),u.micOpen=this.hasAudioTrackInMS,u.audioDisable=this.hasMicrophone&&!((e=this.streamManager.cameraStreamInfo.originAudioTrack)!=null&&e.enabled),u.screenShare=this.hasScreenTrackInMS,u.screenDisable=this.hasScreenShare&&!((o=(n=this.streamManager.screenStreamInfo)==null?void 0:n.originVideoTrack)!=null&&o.enabled),SS.getCurrentStatus(u)}resetPreviewElements(){this.previewElements.forEach(i=>{i.srcObject=null,i._playPromise=void 0},[]),this.previewElements=[]}resetSecondayPreviewElements(){this.screenPreviewElements.forEach(i=>{i.srcObject=null,i._playPromise=void 0},[]),this.screenPreviewElements=[]}getMediaStats(i){return this.pcMediaStatsMap[i]}reportPublishMonitor(i){if(!i)return;let e;try{e=i===De.Audio?this.rtsManager.getStreamByMsid({url:this.url,aMsid:i}).audioTrack:this.rtsManager.getStreamByMsid({url:this.url,vMsid:i}).videoTrack}catch{}this.slsReporter.reportPublishMonitor(this.callId,this.traceId||"",i,e,this.monitorDataCache[i]),this.monitorDataCache[i]=[]}reportNetwork(){this.slsReporter.reportNetworkMonitor(this.candidateDataCache),this.candidateDataCache=[]}startStreamMonitor(){this.monitorTimerId||(this.monitorTimerId=window.setInterval(()=>pe(this,null,function*(){var i,e;try{const n=yield this.rtsManager.getPCStats();let o,u;if(n?.forEach(c=>{c.type==="media-source"||c.type==="media-playout"?c.id&&(this.pcMediaStatsMap[c.id]=c):c.type==="candidate-pair"&&c.state==="succeeded"&&(o=c)}),((i=this.candidateDataCache)==null?void 0:i.length)>0){const c=this.candidateDataCache[this.candidateDataCache.length-1]||{},s=c,{_last:d}=s;u=jn(s,["_last"])}((e=this.candidateDataCache)==null?void 0:e.length)>=30&&this.reportNetwork(),o&&(o._last=u,this.candidateDataCache.push(o));let g=Object.keys(this.monitorDataCache).filter(c=>{var s;return((s=this.monitorDataCache[c])==null?void 0:s.length)>0});(this.streamTracks||[]).forEach(c=>{const s=c.msid;if(!s)return;let d;g.includes(s)&&(g=g.filter(l=>l!==s)),d=s===De.Audio?this.rtsManager.getPublishAudioStats(this.url):this.rtsManager.getPublishVideoStats(this.url,s),d.then(l=>{if(!l.timestamp)return;this.monitorDataCache[s]||(this.monitorDataCache[s]=[]);const p=this.getMediaStats(l.mediaSourceId);l._source=p;const S=this.monitorDataCache[s];let T;if(S?.length>0){const y=S[S.length-1]||{},R=y,{_last:v}=R;T=jn(R,["_last"])}S?.length>=30&&this.reportPublishMonitor(s),l._last=T,l._codec=c.codec||"",this.monitorDataCache[s].push(l)})}),g.forEach(c=>{this.reportPublishMonitor(c)})}catch{}}),1e3))}stopStreamMonitor(){this.monitorTimerId&&(clearInterval(this.monitorTimerId),this.monitorTimerId=void 0),Object.keys(this.monitorDataCache).forEach(i=>{this.reportPublishMonitor(i)})}clearStream(){this.streamManager.stop(),this.audioPubState.setState(tt.AliRtcStatePublishIdle),this.videoPubState.setState(tt.AliRtcStatePublishIdle),this.videoSmallPubState.setState(tt.AliRtcStatePublishIdle),this.screenPubState.setState(tt.AliRtcStatePublishIdle)}getCurrentCameraDeviceId(){var i;return(i=this.streamManager.cameraStreamInfo.originVideoTrack)==null?void 0:i.getSettings().deviceId}getCurrentMicDeviceId(){var i;return(i=this.streamManager.cameraStreamInfo.originAudioTrack)==null?void 0:i.getSettings().deviceId}enableAudioVolumeIndication(i){this.audioVolumeIndicationInterval!==i&&(this.audioVolumeIndicationInterval>0&&i<=0&&this.audioLevelMonitor.stop(),i>0&&this.streamManager.cameraStreamInfo.originAudioTrack&&this.audioLevelMonitor.start(this.streamManager.cameraStreamInfo.originAudioTrack,i),this.audioVolumeIndicationInterval=i)}sendSEI(i,e,n){return pe(this,null,function*(){if(!this.url)return;let o=0;return o=!e||e<1?1:e-1,this.rtsManager.sendSEI(this.url,i,o,n)})}sendDataChannelMessage(i){var e;if(!((e=this.parameter.data)!=null&&e.enablePubDataChannel))throw new Ve(je.ERR_INNER,"data channel publish is not enabled");if(!this.dc)throw new Ve(je.ERR_INNER,"data channel is not ready");const n=(function(o,u){let g=0;const c=[];for(;g<o.byteLength;){const s=Math.min(u,o.byteLength-g),d=o.slice(g,g+s);c.push(d),g+=s}return c})(i.toBuffer(),1156);n.forEach((o,u)=>{const g=new El(new Es(o.byteLength,u===n.length-1,u===0?1:0),o);this.dc.send(g.toGRTNBuffer())})}getStats(){return pe(this,null,function*(){const i=[];if(this.hasAudioTrackInMS){const u=yield this.rtsManager.getPublishAudioStats(this.url);u&&i.push({stats:u,track:da.AliRtcAudioTrackMic})}const e=[];if(this.hasCameraTrackInMS){const u=yield this.rtsManager.getPublishVideoStats(this.url,De.VideoLarge);u&&e.push({track:Rt.AliRtcVideoTrackCamera,streamType:Di.AliRtcVideoStreamTypeHigh,stats:u})}if(this.hasCameraDualTrackInMS){const u=yield this.rtsManager.getPublishVideoStats(this.url,De.VideoSmall);u&&e.push({track:Rt.AliRtcVideoTrackCamera,streamType:Di.AliRtcVideoStreamTypeLow,stats:u})}if(this.hasScreenTrackInMS){const u=yield this.rtsManager.getPublishVideoStats(this.url,De.Screen);u&&e.push({track:Rt.AliRtcVideoTrackScreen,stats:u})}let n;const o=yield this.rtsManager.getPCStats();return o?.forEach(u=>{u.type==="candidate-pair"&&u.state==="succeeded"&&(n=u)}),{audio:i,video:e,candidate:n}})}markReconnect(i){const e=[],n=this.streamManager.publishStreams;!n.audio||i&&!i.includes(De.Audio)||e.push(this.audioPubState),!n.video||i&&!i.includes(De.VideoLarge)||e.push(this.videoPubState),!n.screen||i&&!i.includes(De.Screen)||e.push(this.screenPubState),!this.dc||i&&!i.includes(De.Data)||e.push(this.dataPubState),e.forEach(o=>{o.setState(tt.AliRtcStateReconnecting)})}markReconnected(i){var e;const n=[],o=this.streamManager.publishStreams;if(!o.audio||i&&!i.includes(De.Audio)||n.push(this.audioPubState),!o.video||i&&!i.includes(De.VideoLarge)||n.push(this.videoPubState),!o.screen||i&&!i.includes(De.Screen)||n.push(this.screenPubState),this.dc&&(!i||i.includes(De.Data))&&(n.push(this.dataPubState),(e=this.parameter.data)==null?void 0:e.enablePubDataChannel)){const u=this.rtsManager.getDatachannelByMsid({url:this.url,msid:De.Data});this.updateDataChannel(u)}this.publishUpdate(xr.RECONNECT),n.forEach(u=>{u.setState(tt.AliRtcStatePublished)})}},W(on,"logName","LocalUser"),on);Wt([ge()],Ft.prototype,"clearPublishState"),Wt([ge()],Ft.prototype,"clear"),Wt([ge(He)],Ft.prototype,"startDefaultCameraAndMic"),Wt([ge()],Ft.prototype,"setViewConfig"),Wt([ge()],Ft.prototype,"startCameraCapture"),Wt([ge()],Ft.prototype,"stopCameraCapture"),Wt([ge()],Ft.prototype,"startAudioCapture"),Wt([ge()],Ft.prototype,"stopAudioCapture"),Wt([ge()],Ft.prototype,"startCameraAndMic"),Wt([ge()],Ft.prototype,"stopPreview"),Wt([ge()],Ft.prototype,"resumePublish"),Wt([ge()],Ft.prototype,"createLocalStream"),Wt([ge()],Ft.prototype,"stopLocalStream"),Wt([ge()],Ft.prototype,"updateDataChannel"),Wt([ge(He)],Ft.prototype,"startPublish"),Wt([ge()],Ft.prototype,"updateStreams"),Wt([ge(([i])=>[i])],Ft.prototype,"syncPublishToRoomServer"),Wt([ge()],Ft.prototype,"refreshPushStreamUrl"),Wt([ge(([i,e,n])=>[JSON.stringify(n)])],Ft.prototype,"publishAdd"),Wt([ge(([i,e])=>[JSON.stringify(e)])],Ft.prototype,"publishReplace"),Wt([ge(He)],Ft.prototype,"publishDeleteTracks"),Wt([ge()],Ft.prototype,"publishStop"),Wt([ge()],Ft.prototype,"unPublish"),Wt([ge(([i,e,n])=>[i.length,e,n])],Ft.prototype,"sendSEI"),Wt([ge(He)],Ft.prototype,"markReconnect"),Wt([ge(He)],Ft.prototype,"markReconnected");let G_=Ft;var vr=(i=>(i.OPUS="opus",i.H264="H264",i.H265="H265",i.AV1="AV1",i.UNKNOWN="",i))(vr||{}),vt=(i=>(i[i.NotSubscribe=0]="NotSubscribe",i[i.Subscribing=1]="Subscribing",i[i.Subscribed=2]="Subscribed",i))(vt||{}),go=(i=>(i.VideoTrackEnded="videoTrackEnded",i.AudioTrackEnded="audioTrackEnded",i.ScreenTrackEnded="screenTrackEnded",i))(go||{});const TS=i=>pe(void 0,null,function*(){return yield wt.AliRTS.createStream({custom:!0,mediaStream:i})}),ls=i=>pe(void 0,null,function*(){const e=(n=>{const o=new MediaStream;return o.addTrack(n),o})(i);return yield TS(e)});var W_=Object.defineProperty,q_=Object.getOwnPropertyDescriptor;class af extends Ei{constructor(){super(),W(this,"audioInfo",{subscribeState:vt.NotSubscribe,ssrc:"",msid:"",pt:0,red:0,codec:vr.UNKNOWN}),W(this,"videoLargeInfo",{subscribeState:vt.NotSubscribe,ssrc:"",msid:"",pt:0,red:0,codec:vr.UNKNOWN}),W(this,"videoSmallInfo",{subscribeState:vt.NotSubscribe,ssrc:"",msid:"",pt:0,red:0,codec:vr.UNKNOWN}),W(this,"screenInfo",{subscribeState:vt.NotSubscribe,ssrc:"",msid:"",pt:0,red:0,codec:vr.UNKNOWN}),W(this,"dataInfo",{subscribeState:vt.NotSubscribe,ssrc:"",msid:"",pt:0,red:0,codec:vr.UNKNOWN}),W(this,"audioVolume",1),W(this,"audioMuted",!1),W(this,"userStatus")}getAudioInfo(){return this.audioInfo}getVideoSmallInfo(){return this.videoSmallInfo}getVideoLargeInfo(){return this.videoLargeInfo}getScreenInfo(){return this.screenInfo}getDataInfo(){return this.dataInfo}get subscribingInfos(){return[this.audioInfo,this.videoLargeInfo,this.videoSmallInfo,this.screenInfo].filter(e=>e.msid&&e.subscribeState===vt.Subscribed)}get hasTrack(){return this.hasAudio||this.hasVideo||this.hasScreen||this.hasData}get hasAudio(){return this.audioInfo.ssrc!==""}get hasVideo(){return this.videoLargeInfo.ssrc!==""||this.videoSmallInfo.ssrc!==""}get hasVideoLarge(){return this.videoLargeInfo.ssrc!==""}get hasVideoSmall(){return this.videoSmallInfo.ssrc!==""}get hasScreen(){return this.screenInfo.ssrc!==""}get hasData(){return this.dataInfo.ssrc!==""}get isAudioSubscribed(){return this.audioInfo.subscribeState===vt.Subscribed}get isAudioSubscribing(){return this.audioInfo.subscribeState===vt.Subscribing}get isVideoSubscribed(){return this.isVideoLargeSubscribed||this.isVideoSmallSubscribed}get isVideoSubscribing(){return this.isVideoLargeSubscribing||this.isVideoSmallSubscribing}get isVideoLargeSubscribed(){return this.videoLargeInfo.subscribeState===vt.Subscribed}get isVideoLargeSubscribing(){return this.videoLargeInfo.subscribeState===vt.Subscribing}get isVideoSmallSubscribed(){return this.videoSmallInfo.subscribeState===vt.Subscribed}get isVideoSmallSubscribing(){return this.videoSmallInfo.subscribeState===vt.Subscribing}get isScreenSubscribed(){return this.screenInfo.subscribeState===vt.Subscribed}get isScreenSubscribing(){return this.screenInfo.subscribeState===vt.Subscribing}get isDataSubscribed(){return this.dataInfo.subscribeState===vt.Subscribed}get isDataSubscribing(){return this.dataInfo.subscribeState===vt.Subscribing}get audioCodec(){return this.audioInfo.codec}get videoCodec(){return this.hasVideoLarge?this.videoLargeInfo.codec:this.hasVideoSmall?this.videoSmallInfo.codec:this.hasScreen?this.screenInfo.codec:vr.UNKNOWN}get audioTrackInfo(){return this.hasAudio?da.AliRtcAudioTrackMic:da.AliRtcAudioTrackNo}get videoTrackInfo(){return this.hasVideo&&this.hasScreen?Rt.AliRtcVideoTrackBoth:this.hasVideo?Rt.AliRtcVideoTrackCamera:this.hasScreen?Rt.AliRtcVideoTrackScreen:Rt.AliRtcVideoTrackNo}updateTracks(e){let n="",o="",u="",g="",c="";return e?(e.forEach(s=>{var d;let l=vr.UNKNOWN;const p=((d=s?.attr)==null?void 0:d.reason)==="reconnect";if(s.userdata){const{codec:T}=JSON.parse(s.userdata);T&&(l=T)}var S;(S=s.msid)===De.Audio||S===xh.Audio?(n=s.ssrc,this.audioInfo.msid=s.msid,this.audioInfo.codec=l,(p||this.audioInfo.ssrc!==n)&&(this.audioInfo.subscribeState=vt.NotSubscribe)):(T=>T===De.VideoSmall)(s.msid)?(u=s.ssrc,this.videoSmallInfo.msid=s.msid,this.videoSmallInfo.codec=l,(p||this.videoSmallInfo.ssrc!==u)&&(this.videoSmallInfo.subscribeState=vt.NotSubscribe)):(T=>T===De.VideoLarge||T===xh.VideoLarge)(s.msid)?(o=s.ssrc,this.videoLargeInfo.msid=s.msid,this.videoLargeInfo.codec=l,(p||this.videoLargeInfo.ssrc!==o)&&(this.videoLargeInfo.subscribeState=vt.NotSubscribe)):(T=>T===De.Screen)(s.msid)?(g=s.ssrc,this.screenInfo.msid=s.msid,this.screenInfo.codec=l,(p||this.screenInfo.ssrc!==g)&&(this.screenInfo.subscribeState=vt.NotSubscribe)):(T=>T===De.Data)(s.msid)&&(c=s.ssrc,this.dataInfo.msid=s.msid,this.dataInfo.codec=l,(p||this.dataInfo.ssrc!==c)&&(this.dataInfo.subscribeState=vt.NotSubscribe))}),this.updateRemoteTrackSsrc(n,o,u,g,c)):this.updateRemoteTrackSsrc(n,o,u,g,c),{}}updateRemoteTrackSsrc(e,n,o,u,g){this.audioInfo.ssrc=e,this.videoSmallInfo.ssrc=o,this.videoLargeInfo.ssrc=n,this.screenInfo.ssrc=u,this.dataInfo.ssrc=g}markRemoteTrackSubscribing(e){return e.video&&(e.vMsid===this.videoSmallInfo.msid&&(this.videoSmallInfo.subscribeState=vt.Subscribing),e.vMsid!==this.videoLargeInfo.msid&&e.vMsid||(this.videoLargeInfo.subscribeState=vt.Subscribing)),e.screen&&(this.screenInfo.subscribeState=vt.Subscribing),e.audio&&(this.audioInfo.subscribeState=vt.Subscribing),e.data&&(this.dataInfo.subscribeState=vt.Subscribing),{videoLargeInfo:this.videoLargeInfo,videoSmallInfo:this.videoSmallInfo}}updateRemoteTrackSubState(e){return e.video!==void 0&&(e.vMsid!==this.videoSmallInfo.msid&&e.vMsid||(this.videoSmallInfo.subscribeState=e.video?vt.Subscribed:vt.NotSubscribe),e.vMsid!==this.videoLargeInfo.msid&&e.vMsid||(this.videoLargeInfo.subscribeState=e.video?vt.Subscribed:vt.NotSubscribe)),e.screen!==void 0&&(this.screenInfo.subscribeState=e.screen?vt.Subscribed:vt.NotSubscribe),e.audio!==void 0&&(this.audioInfo.subscribeState=e.audio?vt.Subscribed:vt.NotSubscribe),e.data!==void 0&&(this.dataInfo.subscribeState=e.data?vt.Subscribed:vt.NotSubscribe),{audioInfo:this.audioInfo,videoLargeInfo:this.videoLargeInfo,videoSmallInfo:this.videoSmallInfo,screenInfo:this.screenInfo,dataInfo:this.dataInfo}}updateRemoteUserDeviceStatus(e){let n=SS.parseStatus(e);const{audioDisable:o,videoDisable:u,screenDisable:g}=n;return this.userStatus?(this.userStatus.audioDisable!=o&&(this.userStatus.audioDisable=o,this.emit(Ui.Remote,o?Xt.MuteAudio:Xt.UnmuteAudio)),this.userStatus.videoDisable!=u&&(this.userStatus.videoDisable=u,this.emit(Ui.Remote,u?Xt.MuteVideo:Xt.UnmuteVideo)),this.userStatus.screenDisable!=g&&(this.userStatus.screenDisable=g,this.emit(Ui.Remote,g?Xt.MuteScreen:Xt.UnmuteScreen))):(this.userStatus=n,this.emit(Ui.Remote,o?Xt.MuteAudio:Xt.UnmuteAudio),this.emit(Ui.Remote,u?Xt.MuteVideo:Xt.UnmuteVideo),this.emit(Ui.Remote,g?Xt.MuteScreen:Xt.UnmuteScreen)),!1}}W(af,"logName","RemoteStreamInfo");((i,e,n,o)=>{for(var u,g=q_(e,n),c=i.length-1;c>=0;c--)(u=i[c])&&(g=u(e,n,g)||g);g&&W_(e,n,g)})([ge()],af.prototype,"updateRemoteTrackSubState");class K_{constructor(e){W(this,"remoteUser"),this.remoteUser=e}get userId(){return this.remoteUser.userId}get displayName(){return this.remoteUser.displayname}get isMuteAudioPlaying(){return this.remoteUser.getAudioMuted()}get hasAudio(){return this.remoteUser.hasAudioTrack}get hasCamera(){return this.remoteUser.hasVideoTrack}get hasCameraLarge(){return this.remoteUser.hasVideoLargeTrack}get hasCameraSmall(){return this.remoteUser.hasVideoSmallTrack}get hasScreenShare(){return this.remoteUser.hasScreenTrack}get isAudioSubscribing(){return this.remoteUser.isAudioSubscribing}get isVideoSubscribing(){return this.remoteUser.isVideoSubscribing}get isVideoLargeSubscribing(){return this.remoteUser.isVideoLargeSubscribing}get isVideoSmallSubscribing(){return this.remoteUser.isVideoSmallSubscribing}get isScreenSubscribing(){return this.remoteUser.isScreenSubscribing}get audioElement(){return this.remoteUser.getAudioElement()}}var Y_=Object.defineProperty,X_=Object.getOwnPropertyDescriptor,mi=(i,e,n,o)=>{for(var u,g=X_(e,n),c=i.length-1;c>=0;c--)(u=i[c])&&(g=u(e,n,g)||g);return g&&Y_(e,n,g),g};class na extends Ei{constructor(){super(),W(this,"state"),W(this,"time"),W(this,"_enabled"),this.state=ht.AliRtcStateSubscribeIdle,this.time=Date.now(),this._enabled=!0}setState(e){if(this.state===e)return;const n=this.state,o=this.time;this.state=e,this.time=Date.now(),this.emit("change",n,e,Math.floor((this.time-o)/1e3))}get currentState(){return this.state}getEnabled(){return this._enabled}setEnabled(e){this._enabled=e}}var Pi;const li=(Pi=class extends yS{constructor(i){var e;const{userId:n,displayName:o,rtsManager:u,usersViewMap:g,slsReporter:c,signalingManager:s,localUser:d,audioVolumeIndicationInterval:l,playoutVolume:p,parameter:S}=i;super(n,o,u,l),W(this,"remoteCallId",""),W(this,"remoteUserInfo"),W(this,"localUser"),W(this,"lastPubId",""),W(this,"stream"),W(this,"screenStream"),W(this,"viewMap"),W(this,"audioTrack"),W(this,"audioElement"),W(this,"subscribed",!1),W(this,"mediaStream"),W(this,"secondaryMediaStream"),W(this,"prevSubConfig"),W(this,"signalingManager"),W(this,"slsReporter"),W(this,"wantSubAudio",!1),W(this,"wantSubVideo",!1),W(this,"wantSubScreen",!1),W(this,"defaultVideoStreamType",Di.AliRtcVideoStreamTypeHigh),W(this,"audioMuted",!1),W(this,"playoutVolume",1),W(this,"playoutGainNode"),W(this,"audioSubState"),W(this,"videoSubState"),W(this,"videoLargeSubState",new na),W(this,"videoSmallSubState",new na),W(this,"screenSubState"),W(this,"dataSubState"),W(this,"dc"),W(this,"dcMsgWaitingPieces",[]),W(this,"streamInfo"),W(this,"_streamUrl",""),W(this,"parameter",{}),W(this,"monitorTimerId"),W(this,"monitorDataCache",{}),W(this,"traceId",""),W(this,"handleAudioContextSuspended",T=>{T.target.state==="suspended"&&this.emit("remoteAudioPlayError",this.uid,"AudioContext suspended")}),W(this,"onDataChannelMessage",T=>{var y;const R=El.parse(T.slice(4));let v;if(R.body){if(!R.isFin)return R.header.frameType===1&&(this.dcMsgWaitingPieces=[]),void this.dcMsgWaitingPieces.push(R.body);if(this.dcMsgWaitingPieces.length>0){const h=this.dcMsgWaitingPieces.reduce((m,_)=>m+_.byteLength,R.body.byteLength);try{const m=new ArrayBuffer(h);let _=0;for(let A=0;A<this.dcMsgWaitingPieces.length;A++){const E=this.dcMsgWaitingPieces[A];new Uint8Array(m,_,E.byteLength).set(new Uint8Array(E)),_+=E.byteLength}new Uint8Array(m,_,R.body.byteLength).set(new Uint8Array(R.body)),v=mo.parse(m)}catch{}this.dcMsgWaitingPieces=[],v||(v=mo.parse(R.body))}else v=mo.parse(R.body);v||ke.event(`[${Pi.logName}]`,`parse data channel message fail, piece count: ${this.dcMsgWaitingPieces.length+1}`)}v&&(ke.event(`[${Pi.logName}]`,`receive dc message, length(${(y=v.data)==null?void 0:y.byteLength})`),this.emit("remoteDataChannelMessage",this.uid,v))}),W(this,"onDataChannelError",T=>{this.emit("occurError",Ve.fromError(T,je.ERR_SDK_SUBSCRIBE_DATA_ERROR))}),W(this,"dataChannelConnected",T=>{T&&(this.dc=T,this.dc.datachannel&&(this.dc.datachannel.binaryType="arraybuffer"),this.dc.off("message",this.onDataChannelMessage),this.dc.off("error",this.onDataChannelError),this.dc.on("message",this.onDataChannelMessage),this.dc.on("error",this.onDataChannelError))}),W(this,"handleAudioPaused",()=>{this.emit("remoteAudioPlayError",this.uid,"paused")}),this.streamInfo=new af,this.remoteUserInfo=new K_(this),this.parameter=S,this.streamInfo.on(Ui.Remote,T=>{this.emit(Ui.Remote,T,this.userId)}),this.signalingManager=s,this.viewMap=(e=g[n])!=null?e:{cameraViews:[],screenViews:[]},g[n]=this.viewMap,this.slsReporter=c,this.localUser=d,this.audioSubState=new na,this.audioSubState.on("change",(T,y,R)=>{this.emit("audioSubscribeStateChanged",this.uid,T,y,R)}),this.videoSubState=new na,this.videoSubState.on("change",(T,y,R)=>{this.emit("videoSubscribeStateChanged",this.uid,T,y,R)}),this.screenSubState=new na,this.screenSubState.on("change",(T,y,R)=>{this.emit("screenSubscribeStateChanged",this.uid,T,y,R)}),this.dataSubState=new na,this.dataSubState.on("change",(T,y,R)=>{this.emit("dataSubscribeStateChanged",this.uid,T,y,R)}),this.playoutVolume=p}get streamUrl(){return this._streamUrl}set streamUrl(i){this._streamUrl=i,this.rtsManager.updateAuth(i)}isWantSubAudio(){return this.wantSubAudio}setWantSubAudio(i){this.wantSubAudio=i}isWantSubVideo(){return this.wantSubVideo}setWantSubVideo(i){this.wantSubVideo=i}isWantSubScreen(){return this.wantSubScreen}setWantSubScreen(i){this.wantSubScreen=i}setRemoteDefaultVideoStreamType(i){i!==this.defaultVideoStreamType&&(this.defaultVideoStreamType=i,this.updateSubscribe(Ht.User))}setAudioMuted(i){this.audioMuted=i,this.toggleAudio(!i)}getAudioElement(){return this.audioElement}setPlayoutVolume(i){if(this.playoutVolume=i,this.audioElement)if(this.parameter.enableAudioContextPlayoutVolume)if(this.playoutGainNode)this.playoutGainNode.gain.value=i;else{const e=this.audioElement.srcObject;if(e){const n=gs.getInstance();n.addEventListener("statechange",this.handleAudioContextSuspended);const o=n.createMediaStreamSource(e);this.audioElement.muted=!0,this.playoutGainNode=n.createGain(),o.connect(this.playoutGainNode),this.playoutGainNode.gain.value=i,this.playoutGainNode.connect(n.destination)}}else this.audioElement.volume=i}getAudioMuted(){return this.audioMuted}get hasAudioTrack(){return this.streamInfo.hasAudio}get hasVideoTrack(){return this.streamInfo.hasVideo}get hasVideoLargeTrack(){return this.streamInfo.hasVideoLarge}get hasVideoSmallTrack(){return this.streamInfo.hasVideoSmall}get hasScreenTrack(){return this.streamInfo.hasScreen}get isAudioSubscribing(){return this.streamInfo.isAudioSubscribed||this.streamInfo.isAudioSubscribing}get isVideoSubscribing(){return this.streamInfo.isVideoSubscribed||this.streamInfo.isVideoSubscribing}get isVideoLargeSubscribing(){return this.streamInfo.isVideoLargeSubscribed||this.streamInfo.isVideoLargeSubscribing}get isVideoSmallSubscribing(){return this.streamInfo.isVideoSmallSubscribed||this.streamInfo.isVideoSmallSubscribing}get isScreenSubscribing(){return this.streamInfo.isScreenSubscribed||this.streamInfo.isScreenSubscribing}get isDataSubscribing(){return this.streamInfo.isDataSubscribed||this.streamInfo.isDataSubscribing}get audioEnabled(){var i,e;return!!((e=(i=this.stream)==null?void 0:i.audioTrack)!=null&&e.enabled)}get videoEnabled(){var i,e;return!!((e=(i=this.stream)==null?void 0:i.videoTrack)!=null&&e.enabled)}get screenEnabled(){var i,e;return!!((e=(i=this.screenStream)==null?void 0:i.videoTrack)!=null&&e.enabled)}get getAudioTrack(){return this.audioTrack}get getCameraStream(){return this.stream}get getScreenStream(){return this.screenStream}setViewConfig(i,e){if(e!==Rt.AliRtcVideoTrackScreen&&e!==Rt.AliRtcVideoTrackCamera)throw new Ve(je.ERR_INVALID_ARGUMENTS,"track is not AliRtcVideoTrackScreen or AliRtcVideoTrackCamera");i?Ph(i).forEach(n=>{n.setAttribute("playsinline",""),wt.AliRTS.BrowserUtil.isMicroMessenger&&(n.setAttribute("x5-video-player-type","h5-page"),n.setAttribute("x5-playsinline",""),wt.AliRTS.SystenUtil.isAndroid||wt.AliRTS.SystenUtil.isIos&&n.setAttribute("x-webkit-airplay","allow")),e===Rt.AliRtcVideoTrackScreen?this.viewMap.screenViews.push(n):this.viewMap.cameraViews.push(n),this.play(n,e===Rt.AliRtcVideoTrackScreen)}):(this.stopPlayAll(e===Rt.AliRtcVideoTrackScreen),e===Rt.AliRtcVideoTrackScreen?this.viewMap.screenViews=[]:this.viewMap.cameraViews=[])}clear(i=!0){return pe(this,null,function*(){cS(Pi.prototype,this,"clear").call(this),this.stopPlayAudio(),this.stopStreamMonitor(),i&&this.subscribeDeleteAllTracks(this.streamUrl).catch(e=>{ke.event(`[${Pi.logName}]`,`stopSubscribeAllTracks error: ${e.message||e}`)}),this.clearStream(),this.clearScreenStream(),this.playoutGainNode&&(this.playoutGainNode.disconnect(),this.playoutGainNode=void 0,gs.getInstance().removeEventListener("statechange",this.handleAudioContextSuspended)),this.streamInfo.removeAllListeners(Ui.Remote)})}updateRemoteUserDeviceStatus(i){this.streamInfo.updateRemoteUserDeviceStatus(i)}updateRemoteTracks(i,e,n,o){return pe(this,null,function*(){return this.remoteCallId=i,this.streamUrl&&this.streamInfo.hasTrack||(this.streamUrl=e),this.streamInfo.updateTracks(o)})}subscribe(i,e){return pe(this,arguments,function*(n,o,u=Date.now()){var g,c;let s=n;if(!s){const{hasAudio:y,hasVideo:R,hasScreen:v,hasData:h}=(g=this.streamInfo)!=null?g:{};s={audio:this.wantSubAudio&&y,video:this.wantSubVideo&&R,screen:this.wantSubScreen&&v,data:((c=this.parameter.data)==null?void 0:c.enableSubDataChannel)&&h}}this.streamInfo.markRemoteTrackSubscribing(s);const{screen:d,audio:l,video:p,vMsid:S}=s,T=[];(p||l)&&T.push({audio:l,video:p,vMsid:S}),d&&T.push({screen:d}),(T.length!==0||n!=null&&n.data)&&(yield Promise.all(T.map(y=>this.subscribeProxy(y,o||Ht.User,u))),n!=null&&n.data&&this.subscribeDataChannel())})}subscribeProxy(i,e,n){return pe(this,null,function*(){var o,u;let g=new Date().getTime(),c="";try{i.audio&&this.audioSubState.setState(ht.AliRtcStateSubscribing),i.video&&(this.videoSubState.currentState!==ht.AliRtcStateSubscribeIdle&&this.videoSubState.currentState!==ht.AliRtcStateNoSubscribe||this.videoSubState.setState(ht.AliRtcStateSubscribing)),i.screen&&this.screenSubState.setState(ht.AliRtcStateSubscribing);const s=yield this.rtsManager.subscribe({remoteUser:this,options:i},e,((o=this.localUser)==null?void 0:o.callId)||"",this.callId,n);this.streamInfo.updateRemoteTrackSubState(i),c=s.traceId||"";const{stream:d}=s;if(c&&(this.traceId=c),i.audio){const S=d.audioTrack;S&&(this.audioTrack=S,(u=d.mediaStream)==null||u.removeTrack(S),this.playAudio(),this.audioVolumeIndicationInterval&&this.audioLevelMonitor.start(S,this.audioVolumeIndicationInterval)),this.audioSubState.getEnabled()||this.toggleAudio(!1),this.audioSubState.setState(ht.AliRtcStateSubscribed)}i.video&&(this.updateStream(d,this.isVideoLargeSubscribing&&this.isVideoSmallSubscribing),this.videoSubState.getEnabled()||this.toggleVideo(!1),this.videoSubState.setState(ht.AliRtcStateSubscribed),i.vMsid===De.VideoSmall?this.videoSmallSubState.setState(ht.AliRtcStateSubscribed):this.videoLargeSubState.setState(ht.AliRtcStateSubscribed)),i.screen&&(this.updateScreenStream(d),this.videoSubState.getEnabled()||this.toggleScreen(!1),this.screenSubState.setState(ht.AliRtcStateSubscribed));const l=new Date().getTime()-g,p=Date.now();setTimeout(()=>{this.slsReporter.reportSubscribe(this.callId,this.remoteCallId,!!i.video&&i.vMsid===De.VideoLarge,!!i.video&&i.vMsid===De.VideoSmall,!!i.screen,!!i.audio,0,"",l,{pctid:this.rtsManager.pcTraceId,subtid:this.traceId,ajsub:e===Ht.Join?1:0,url:this.streamUrl,est:g},p)},6e3),this.startStreamMonitor(),s.isHTTP&&s.statsCheckPromise&&(yield Promise.race([s.statsCheckPromise,Bn(1500)]))}catch(s){const d=new Date().getTime()-g;i.audio&&this.audioSubState.setState(ht.AliRtcStateNoSubscribe),i.video&&this.videoSubState.setState(ht.AliRtcStateNoSubscribe),i.screen&&this.screenSubState.setState(ht.AliRtcStateNoSubscribe),s&&(s.message=`user(${this.uid}) subscribe error, ${s?.message||""}`);let l=je.ERR_INNER;i.audio&&(l=je.ERR_SDK_SUBSCRIBE_AUDIO_STREAM_FAILED),i.video&&(l=i.vMsid===De.VideoSmall?je.ERR_SDK_SUBSCRIBE_DUAL_STREAM_FAILED:je.ERR_SDK_SUBSCRIBE_VIDEO_STREAM_FAILED),i.screen&&(l=je.ERR_SDK_SUBSCRIBE_SCREEN_SHARE_FAILED),this.slsReporter.reportSubscribe(this.callId,this.remoteCallId,!!i.video&&i.vMsid===De.VideoLarge,!!i.video&&i.vMsid===De.VideoSmall,!!i.screen,!!i.audio,l,"",d,{pctid:this.rtsManager.pcTraceId,subtid:"",ajsub:e===Ht.Join?1:0,url:this.streamUrl,est:g});const p=Ve.fromError(s,l);throw this.emit("remoteSubscribeError",p),p}})}subscribeDeleteTracks(i){return pe(this,null,function*(){const{audio:e,video:n,screen:o,data:u,vMsid:g}=i,c=[];(e||n||u)&&c.push({audio:e,video:n,vMsid:g}),o&&c.push({screen:o}),c.length!==0&&(yield Promise.all(c.map(s=>this.subscribeDeleteProxy(s))),i.data&&this.subscribeDeleteDataChannel())})}subscribeDeleteProxy(i){return pe(this,null,function*(){try{const e=yield this.rtsManager.subscribeDelete({remoteUser:this,options:i}),{stream:n}=e??{},o={};i.audio===!0&&(o.audio=!1,this.audioSubState.setState(ht.AliRtcStateNoSubscribe)),i.video===!0&&(o.video=!1,i.vMsid===De.VideoSmall?(this.videoSmallSubState.setState(ht.AliRtcStateNoSubscribe),this.videoLargeSubState.currentState!==ht.AliRtcStateNoSubscribe&&this.videoLargeSubState.currentState!==ht.AliRtcStateSubscribeIdle||this.videoSubState.setState(ht.AliRtcStateNoSubscribe)):(this.videoLargeSubState.setState(ht.AliRtcStateNoSubscribe),this.videoSmallSubState.currentState!==ht.AliRtcStateNoSubscribe&&this.videoSmallSubState.currentState!==ht.AliRtcStateSubscribeIdle||this.videoSubState.setState(ht.AliRtcStateNoSubscribe))),i.screen===!0&&(o.screen=!1,this.screenSubState.setState(ht.AliRtcStateNoSubscribe));const{callId:u,remoteCallId:g}=this,c={callid:u,remoteCallid:g,remoteStream:n};return i.audio&&(this.audioLevelMonitor.stop(),this.stopPlayAudio(),this.audioTrack=void 0),this.streamInfo.updateRemoteTrackSubState({audio:i.audio!==!0&&void 0,video:i.video!==!0&&void 0,screen:i.screen!==!0&&void 0,vMsid:i.vMsid}),c}catch(e){throw Ve.fromError(e,je.ERR_INNER,"subscribe delete failed")}})}restore(){this.callId="",this.clearStream(),this.clearScreenStream(),this.audioTrack=void 0,this.streamInfo.updateRemoteTrackSubState({audio:!1,video:!1,screen:!1,data:!1}),this.audioElement&&this.audioElement.removeEventListener("pause",this.handleAudioPaused)}resumeAudio(){return pe(this,null,function*(){const i=gs.getInstance();return i.state!=="running"&&i.resume(),this.audioElement?this.audioElement.play():this.playAudio()})}resumeVideo(i){return pe(this,null,function*(){return i&&i!==Rt.AliRtcVideoTrackCamera&&i!==Rt.AliRtcVideoTrackBoth?i&&i!==Rt.AliRtcVideoTrackScreen&&i!==Rt.AliRtcVideoTrackBoth?void 0:this.playAll(!0):this.playAll()})}resumePlay(){this.playAudio(),this.playAll(),this.playAll(!0)}stopSubscribe(i){return pe(this,null,function*(){let e=new Date().getTime();try{i?yield this.subscribeDeleteTracks(i):yield this.subscribeDeleteAllTracks(this.streamUrl),this.slsReporter.reportUnsubscribe(this.callId,this.remoteCallId,new Date().getTime()-e,0,"")}catch(n){throw this.slsReporter.reportUnsubscribe(this.callId,this.remoteCallId,new Date().getTime()-e,0,""),n}})}subscribeDeleteAllTracks(i){return pe(this,null,function*(){var e,n,o,u;const{callId:g,remoteCallId:c}=this;if((this.isAudioSubscribing||this.isVideoSubscribing||this.isScreenSubscribing||this.dc)&&i)try{yield this.subscribeDeleteTracks({audio:this.isAudioSubscribing,video:this.isVideoSubscribing,screen:this.isScreenSubscribing,data:!!this.dc}),this.restore();const s={callid:g,remoteCallid:c,remoteStream:this.stream};return this.callId="",s}catch(s){if(((u=(o=(n=(e=s?.extraInfo)==null?void 0:e.parsedData)==null?void 0:n.streams)==null?void 0:o[0])==null?void 0:u.res_code)!==404)throw Ve.fromError(s,je.ERR_INNER,"subscribe stop failed")}})}updateStream(i,e=!1){return pe(this,null,function*(){this.stream&&this.stream.videoTrack&&i.mediaStream&&e&&(yield new Promise(n=>{let o,u;if(i.mediaStream){u=document.createElement("video");const g=()=>{ke.event(`[${Pi.logName}]`,`uid: ${this.userId} new mediaStream canplay`),u&&u.removeEventListener("canplaythrough",g,!1),u=void 0,clearTimeout(o),n(!0)};u.addEventListener("canplaythrough",g,!1),(u._playPromise||Promise.resolve()).then(()=>{u&&i.mediaStream&&(u.srcObject=i.mediaStream)})}else n(!0);o=window.setTimeout(()=>{ke.event(`[${Pi.logName}]`,`uid: ${this.userId} new mediaStream timeout`),u=void 0,n(!0)},3e3)}),this.updateSubscribe(Ht.User)),this.stream=i,this.playAll(!1,e),!this.subscribed&&i&&(this.subscribed=!0),i.hasAudio&&this.isAudioSubscribing&&i.enableAudio(),i.hasVideo&&this.isVideoSubscribing&&i.enableVideo()})}updateScreenStream(i){this.screenStream=i,this.playAll(!0),!this.subscribed&&i&&(this.subscribed=!0),i.hasVideo&&this.isScreenSubscribing&&i.enableVideo()}clearStream(){var i;(i=this.stream)==null||i.stop(),this.stream=void 0}clearScreenStream(){var i;(i=this.screenStream)==null||i.stop(),this.screenStream=void 0}subscribeDataChannel(){if(this.dc)try{this.dcMsgWaitingPieces=[],this.dc.off("message",this.onDataChannelMessage),this.dc=void 0}catch{}(this.streamInfo.hasAudio||this.streamInfo.hasVideo||this.streamInfo.hasScreen)&&(this.dataSubState.setState(ht.AliRtcStateSubscribing),this.rtsManager.subscribeAddDataChannel(this.streamUrl).then(i=>{if(i)return this.dataChannelConnected(i),this.dataSubState.setState(ht.AliRtcStateSubscribed),void this.streamInfo.updateRemoteTrackSubState({data:!0});throw new Error("no dc founded")}).catch(i=>{const e=Ve.fromError(i,je.ERR_INNER,"subscribe data failed");this.emit("remoteSubscribeError",e),this.dataSubState.setState(ht.AliRtcStateNoSubscribe)}))}subscribeDeleteDataChannel(){if(this.dc){try{this.rtsManager.subscribeDeleteDatachannel(this.streamUrl,this.dc)}catch{}this.dcMsgWaitingPieces=[],this.dc.off("message",this.onDataChannelMessage),this.dc.off("error",this.onDataChannelError),this.dataSubState.setState(ht.AliRtcStateNoSubscribe),this.dc=void 0,this.streamInfo.updateRemoteTrackSubState({data:!1})}}getRetryOptions(){var i,e;const n={};this.wantSubAudio&&this.streamInfo.hasAudio&&(n.audio=!0,n.aMsid=((i=this.streamInfo.getAudioInfo())==null?void 0:i.msid)||De.Audio),this.wantSubVideo&&this.streamInfo.hasVideo&&(this.defaultVideoStreamType===Di.AliRtcVideoStreamTypeLow&&this.streamInfo.hasVideoSmall?(n.video=!0,n.vMsid=De.VideoSmall):this.streamInfo.hasVideoLarge&&(n.video=!0,n.vMsid=((e=this.streamInfo.getVideoLargeInfo())==null?void 0:e.msid)||De.VideoLarge)),this.wantSubScreen&&this.streamInfo.hasScreen&&(n.screen=!0);let o={};if(n.audio||n.video)o={audio:n.audio,video:n.video},this.streamInfo.updateRemoteTrackSubState({screen:!1,data:!1});else{if(!n.screen)return;o={screen:n.screen},this.streamInfo.updateRemoteTrackSubState({data:!1})}return{remoteUser:this,options:o}}updateSubscribe(i){var e,n,o,u,g,c;const s=Date.now(),d={},l={};return this.wantSubAudio&&!this.isAudioSubscribing&&this.streamInfo.hasAudio&&this.audioSubState.currentState!==ht.AliRtcStateReconnecting?(d.audio=!0,d.aMsid=((e=this.streamInfo.getAudioInfo())==null?void 0:e.msid)||De.Audio):this.wantSubAudio&&this.streamInfo.hasAudio||!this.isAudioSubscribing||(l.audio=!0,l.aMsid=((n=this.streamInfo.getAudioInfo())==null?void 0:n.msid)||De.Audio),this.wantSubVideo&&this.streamInfo.hasVideo?(this.defaultVideoStreamType===Di.AliRtcVideoStreamTypeLow&&!this.isVideoSmallSubscribing&&this.streamInfo.hasVideoSmall&&this.videoSmallSubState.currentState!==ht.AliRtcStateReconnecting?(d.video=!0,d.vMsid=De.VideoSmall):this.isVideoLargeSubscribing||!this.streamInfo.hasVideoLarge||this.defaultVideoStreamType===Di.AliRtcVideoStreamTypeLow&&this.isVideoSmallSubscribing||this.videoLargeSubState.currentState===ht.AliRtcStateReconnecting||(d.video=!0,d.vMsid=((o=this.streamInfo.getVideoLargeInfo())==null?void 0:o.msid)||De.VideoLarge),this.defaultVideoStreamType===Di.AliRtcVideoStreamTypeLow&&this.isVideoLargeSubscribing&&this.isVideoSmallSubscribing&&this.streamInfo.hasVideoSmall?(l.video=!0,l.vMsid=De.VideoLarge):this.defaultVideoStreamType===Di.AliRtcVideoStreamTypeHigh&&this.isVideoLargeSubscribing&&this.isVideoSmallSubscribing&&(l.video=!0,l.vMsid=De.VideoSmall)):this.wantSubVideo&&this.streamInfo.hasVideo||!this.isVideoSubscribing||(l.video=!0,l.vMsid=this.streamInfo.isVideoSmallSubscribed||this.streamInfo.isVideoSmallSubscribing?De.VideoSmall:((u=this.streamInfo.getVideoLargeInfo())==null?void 0:u.msid)||De.VideoLarge),this.wantSubScreen&&!this.isScreenSubscribing&&this.streamInfo.hasScreen&&this.screenSubState.currentState!==ht.AliRtcStateReconnecting?d.screen=!0:this.wantSubScreen&&this.streamInfo.hasScreen||!this.isScreenSubscribing||(l.screen=!0),(g=this.parameter.data)!=null&&g.enableSubDataChannel&&!this.isDataSubscribing&&this.streamInfo.hasData&&this.dataSubState.currentState!==ht.AliRtcStateReconnecting?d.data=!0:(c=this.parameter.data)!=null&&c.enableSubDataChannel&&this.streamInfo.hasData||!this.isDataSubscribing||(l.data=!0),this.dc&&d.data&&this.subscribeDeleteDataChannel(),(d.audio||d.video||d.screen||d.data)&&(this.createCallId(),this.subscribe(d,i,s)),(l.audio||l.video||l.screen)&&this.subscribeDeleteTracks(l),{addOption:d,deleteOption:l}}handleAutoPlayFailed(){ke.event(`[${Pi.logName}]`,"auto play failed"),this.emit("remoteAudioAutoPlayFail",this.uid);const i=()=>{this.resumeAudio().then(()=>{document.removeEventListener("click",i,!1),document.removeEventListener("touchstart",i,!1)})};document.addEventListener("click",i,!1),document.addEventListener("touchstart",i,!1)}handleVideoPlayFailded(i,e){this.emit("remoteVideoAutoPlayFail",this.uid,e);const n=()=>{var o;const u=(o=e===Rt.AliRtcVideoTrackScreen?this.screenStream:this.stream)==null?void 0:o.mediaStream;i.srcObject===u&&this.play(i,e===Rt.AliRtcVideoTrackScreen),document.removeEventListener("click",n,!1),document.removeEventListener("touchstart",n,!1)};document.addEventListener("click",n,!1),document.addEventListener("touchstart",n,!1)}playAudio(){return pe(this,null,function*(){var i,e;if(this.audioTrack){if(this.toggleAudio(!this.audioMuted),this.audioElement||(ke.event(`[${Pi.logName}]`,this.userId,"create audio element"),this.audioElement=document.createElement("audio"),this.audioElement.setAttribute("autoplay","autoplay"),this.audioElement.addEventListener("pause",this.handleAudioPaused),this.setPlayoutVolume(this.playoutVolume)),((e=(i=this.audioElement.srcObject)==null?void 0:i.getAudioTracks())==null?void 0:e[0])!==this.audioTrack){let n=this.audioElement.srcObject;n?n.getAudioTracks().forEach(o=>{n.removeTrack(o)}):(n=new MediaStream,this.audioElement.srcObject=n),n.addTrack(this.audioTrack)}if(wt.AliRTS.SystenUtil.isIos&&parseInt(wt.AliRTS.SystenUtil.systemVersion)<=13){ke.event(`[${Pi.logName}]`,"play audio for iOS 13-");const n=this.audioElement;n.setAttribute("autoplay","");const o=()=>{n.removeEventListener("playing",o),n.pause(),n.play().catch(()=>{this.handleAutoPlayFailed()})};this.audioElement.addEventListener("playing",o)}else(()=>{var n;ke.event(`[${Pi.logName}]`,"try play audio"),(n=this.audioElement)==null||n.play().then(()=>{ke.event(`[${Pi.logName}]`,"play audio success")}).catch(()=>{this.handleAutoPlayFailed()})})()}else ke.event(`[${Pi.logName}]`,this.userId,"audio track is null")})}stopPlayAudio(){this.audioElement&&(this.audioElement.pause(),this.audioElement.removeEventListener("pause",this.handleAudioPaused))}playAll(i=!1,e=!1){i?(this.viewMap.screenViews||[]).forEach(n=>{this.play(n,i,e)}):(this.viewMap.cameraViews||[]).forEach(n=>{this.play(n,i,e)})}play(i,e=!1,n=!1){const o=e?this.screenStream:this.stream;i&&o&&o.mediaStream&&RS(i,o.mediaStream,n).catch(u=>{u.code!==20&&u.name!=="AbortError"&&this.handleVideoPlayFailded(i,e?Rt.AliRtcVideoTrackScreen:Rt.AliRtcVideoTrackCamera)})}stopPlayAll(i=!1){i?this.viewMap.screenViews.forEach(e=>{Ur(e)}):this.viewMap.cameraViews.forEach(e=>{Ur(e)})}toggleAudio(i=!0){this.audioSubState.setEnabled(i),this.audioElement&&(this.audioElement.muted=!i)}toggleVideo(i=!0){this.videoSubState.setEnabled(i),this.stream&&(i?this.stream.enableVideo():this.stream.disableVideo())}toggleScreen(i=!0){this.screenSubState.setEnabled(i),this.screenStream&&(i?this.screenStream.enableVideo():this.screenStream.disableVideo())}getStats(){return pe(this,null,function*(){var i,e,n;const o=[];if(this.isAudioSubscribing){const g=yield this.rtsManager.getSubscribeAudioStats(this.streamUrl);g&&o.push({uid:this.uid,track:da.AliRtcAudioTrackMic,stats:g})}const u=[];if(this.streamInfo.isVideoLargeSubscribed){const g=yield this.rtsManager.getSubscribeVideoStats(this.streamUrl,((i=this.streamInfo.getVideoLargeInfo())==null?void 0:i.msid)||De.VideoLarge);g&&u.push({uid:this.uid,track:Rt.AliRtcVideoTrackCamera,streamType:Di.AliRtcVideoStreamTypeHigh,stats:g})}if(this.streamInfo.isVideoSmallSubscribed){const g=yield this.rtsManager.getSubscribeVideoStats(this.streamUrl,((e=this.streamInfo.getVideoSmallInfo())==null?void 0:e.msid)||De.VideoSmall);g&&u.push({uid:this.uid,track:Rt.AliRtcVideoTrackCamera,streamType:Di.AliRtcVideoStreamTypeLow,stats:g})}if(this.isScreenSubscribing){const g=yield this.rtsManager.getSubscribeVideoStats(this.streamUrl,((n=this.streamInfo.getScreenInfo())==null?void 0:n.msid)||De.Screen);g&&u.push({uid:this.uid,track:Rt.AliRtcVideoTrackScreen,stats:g})}return{audio:o,video:u}})}enableAudioVolumeIndication(i){this.audioVolumeIndicationInterval!==i&&(this.audioVolumeIndicationInterval>0&&i<=0&&this.audioLevelMonitor.stop(),i>0&&this.audioTrack&&this.audioLevelMonitor.start(this.audioTrack,i),this.audioVolumeIndicationInterval=i)}reportSubscribeMonitor(i){i&&(this.slsReporter.reportSubscribeMonitor(this.callId,this.remoteCallId,this.traceId,i,this.monitorDataCache[i]),this.monitorDataCache[i]=[])}startStreamMonitor(){this.monitorTimerId||(this.monitorTimerId=window.setInterval(()=>pe(this,null,function*(){try{if(this.streamInfo.subscribingInfos.length===0)return void this.stopStreamMonitor();let i=Object.keys(this.monitorDataCache).filter(e=>{var n;return((n=this.monitorDataCache[e])==null?void 0:n.length)>0});this.streamInfo.subscribingInfos.forEach(e=>{const n=e.msid;if(!n)return;let o;i.includes(n)&&(i=i.filter(g=>g!==n));const u=n===De.Audio;o=u?this.rtsManager.getSubscribeAudioStats(this.streamUrl):this.rtsManager.getSubscribeVideoStats(this.streamUrl,n),o.then(g=>{var c;if(!g.timestamp)return;this.monitorDataCache[n]||(this.monitorDataCache[n]=[]);const s=this.monitorDataCache[n];let d;if(s?.length>0){const l=s[s.length-1]||{},p=l,{_last:S}=p;d=jn(p,["_last"])}s?.length>=30&&this.reportSubscribeMonitor(n),g._last=d,g._codec=e.codec,u&&(g._source=(c=this.localUser)==null?void 0:c.getMediaStats(g.playoutId)),this.monitorDataCache[n].push(g)})}),i.forEach(e=>{this.reportSubscribeMonitor(e)})}catch{}}),1e3))}stopStreamMonitor(){this.monitorTimerId&&(clearInterval(this.monitorTimerId),this.monitorTimerId=void 0),Object.keys(this.monitorDataCache).forEach(i=>{this.reportSubscribeMonitor(i)})}markReconnect(i){const e=[];!this.isAudioSubscribing||i&&!i.includes(this.streamInfo.getAudioInfo().msid)||e.push(this.audioSubState),this.isVideoSubscribing&&(!i||i.includes(this.streamInfo.getVideoLargeInfo().msid)||i.includes(this.streamInfo.getVideoSmallInfo().msid))&&e.push(this.videoSubState),!this.isScreenSubscribing||i&&!i.includes(this.streamInfo.getScreenInfo().msid)||e.push(this.screenSubState),!this.isDataSubscribing||i&&!i.includes(De.Data)||e.push(this.dataSubState),e.forEach(n=>{n.setState(ht.AliRtcStateReconnecting)})}markReconnected(i){const e=[],n=this.streamInfo.getAudioInfo().msid||De.Audio;if(this.isAudioSubscribing&&(!i||i.includes(n))){e.push(this.audioSubState);const c=this.rtsManager.getStreamByMsid({url:this.streamUrl,aMsid:n});c&&c.audioTrack&&(this.audioTrack=c.audioTrack,this.audioVolumeIndicationInterval>0&&(this.audioLevelMonitor.stop(),this.audioLevelMonitor.start(this.audioTrack,this.audioVolumeIndicationInterval)),this.playAudio())}const o=this.streamInfo.getVideoLargeInfo().msid||De.VideoLarge,u=this.streamInfo.getVideoSmallInfo().msid||De.VideoSmall;if(this.isVideoSubscribing&&(!i||i.includes(o)||i.includes(u))){e.push(this.videoSubState);const c=this.rtsManager.getStreamByMsid({url:this.streamUrl,vMsid:this.streamInfo.isVideoSmallSubscribed||this.streamInfo.isVideoSmallSubscribing?u:o});c&&c.mediaStream&&(this.stream=c,this.playAll(!1))}const g=this.streamInfo.getScreenInfo().msid||De.Screen;if(this.isScreenSubscribing&&(!i||i.includes(g))){e.push(this.screenSubState);const c=this.rtsManager.getStreamByMsid({url:this.streamUrl,vMsid:g});c&&c.mediaStream&&(this.screenStream=c,this.playAll(!0))}if(this.isDataSubscribing&&(!i||i.includes(this.streamInfo.getDataInfo().msid))){e.push(this.dataSubState);const c=this.rtsManager.getDatachannelByMsid({url:this.streamUrl,msid:this.streamInfo.getDataInfo().msid||De.Data});this.dataChannelConnected(c)}e.forEach(c=>{c.setState(ht.AliRtcStateSubscribed)}),i||this.updateSubscribe(Ht.Reconnect)}},W(Pi,"logName","RemoteUser"),Pi);mi([ge()],li.prototype,"clear"),mi([ge()],li.prototype,"updateRemoteUserDeviceStatus"),mi([ge()],li.prototype,"updateRemoteTracks"),mi([ge(He)],li.prototype,"subscribe"),mi([ge()],li.prototype,"subscribeProxy"),mi([ge(He)],li.prototype,"subscribeDeleteProxy"),mi([ge()],li.prototype,"restore"),mi([ge(He)],li.prototype,"resumeAudio"),mi([ge(He)],li.prototype,"stopSubscribe"),mi([ge(He)],li.prototype,"subscribeDeleteAllTracks"),mi([ge()],li.prototype,"clearStream"),mi([ge()],li.prototype,"clearScreenStream"),mi([ge()],li.prototype,"updateSubscribe"),mi([ge()],li.prototype,"playAudio"),mi([ge()],li.prototype,"stopPlayAudio"),mi([ge((i,e,n)=>[typeof i=="string"?i:i?.nodeType,e||"-",n||"-"])],li.prototype,"play"),mi([ge()],li.prototype,"stopPlayAll"),mi([ge(He)],li.prototype,"markReconnect"),mi([ge(He)],li.prototype,"markReconnected");let J_=li;var Vn=(i=>(i[i.AliRtcPluginErrorCodeSuccess=0]="AliRtcPluginErrorCodeSuccess",i[i.AliRtcPluginErrorCodeFailed=-1]="AliRtcPluginErrorCodeFailed",i[i.AliRtcPluginErrorNoFindPlugin=-2]="AliRtcPluginErrorNoFindPlugin",i[i.AliRtcPluginErrorParameterError=-3]="AliRtcPluginErrorParameterError",i[i.AliRtcPluginErrorLoadError=-4]="AliRtcPluginErrorLoadError",i[i.AliRtcPluginErrorCreateError=-5]="AliRtcPluginErrorCreateError",i[i.AliRtcPluginErrorInitError=-6]="AliRtcPluginErrorInitError",i[i.AliRtcPluginErrorInitTokenError=-7]="AliRtcPluginErrorInitTokenError",i))(Vn||{});class Q_ extends Ei{constructor(){super(...arguments),W(this,"plugins",new Map)}add(e,n){if(this.plugins.has(e.name))throw new Ve(Vn.AliRtcPluginErrorCreateError,`Plugin ${e.name} already exists`);this.plugins.set(e.name,e),n&&e.setOptions(n),this.emit("added",e),e.on("enabled",()=>this.emit("added",e)),e.on("disabled",()=>this.emit("removed",e)),e.on("updated",()=>this.emit("updated",e))}remove(e){const n=this.plugins.get(e);if(!n)throw new Ve(Vn.AliRtcPluginErrorNoFindPlugin,`Plugin ${e} not founded`);this.plugins.delete(e),n.removeAllListeners(),this.emit("removed",n)}removeAll(){this.plugins.forEach(e=>{this.remove(e.name)})}get(e){return this.plugins.get(e)}has(e){return!!this.plugins.get(e)}getAll(){return Array.from(this.plugins.values())}}var $_=Object.defineProperty,Z_=Object.getOwnPropertyDescriptor,gi=(i,e,n,o)=>{for(var u,g=Z_(e,n),c=i.length-1;c>=0;c--)(u=i[c])&&(g=u(e,n,g)||g);return g&&$_(e,n,g),g};const Kc=([i])=>{const{remoteUser:e,options:n}=i;return[`user(${e.userId})`,n]};var Qt;const ui=(Qt=class extends Ei{constructor(i,e,n){var o,u;super(),W(this,"rts"),W(this,"encodedInsertableStreams",!0),W(this,"audioRedEnabled",!1),W(this,"localStreamManager"),W(this,"slsReporter"),W(this,"_rtsPeerConnectionType","publish"),W(this,"connecting",!1),W(this,"connected",!1),W(this,"rtsDisconnected",!1),W(this,"_pcTraceId",""),W(this,"_localJoinTime",0),W(this,"connectionResolve"),W(this,"connectingPromise"),W(this,"dcResolve"),W(this,"dcReject"),W(this,"dcConnectingPromise"),W(this,"_publishingTracks",[]),W(this,"parameter",{}),W(this,"preferredPubL1Ip"),W(this,"preferredSubL1Ip"),W(this,"traceIdMap",{}),this.localStreamManager=i,this.slsReporter=e,this.parameter=n,this.rts=wt.AliRTS.createClient({singlePcConfig:{usePcReconnect:!0},datachannelDelayOpen:!0,signalDatachannelInitOptions:(o=n?.net)!=null&&o.datachannelInitOptions?(u=n?.net)==null?void 0:u.datachannelInitOptions:void 0}),this.addRTSListener()}addRTSListener(){this.rts.on("connectStatusChange",i=>{var e,n,o,u;if(ke.event(`[${Qt.logName}]`,"rts connectStatusChange to:",i.status),i.status===wt.EConnectStatus.CONNECT_STATUS_DISCONNECTED)this.dcReject&&this.dcReject(),this.setConnected(!1),this.rtsDisconnected=!0,this.slsReporter.reportWarning("rts disconnected"),this.emit("disconnected");else if(i.status===wt.EConnectStatus.CONNECT_STATUS_CONNECTED){if(this.rtsDisconnected){const g=(u=(o=(n=(e=this.rts.commonController)==null?void 0:e.peerCore)==null?void 0:n.getSignal())==null?void 0:o.getDatachannelCore())==null?void 0:u.readyState;ke.event(`[${Qt.logName}]`,"dcReadyState:",g),g==="open"&&this.dcResolve&&this.dcResolve(!0)}this.rtsDisconnected=!1,this.setConnected(!0)}}),this.rts.on("reconnect",i=>{var e,n,o;ke.debug(`[${Qt.logName}]`,"reconnect",i),this.emit("reconnect",i.type,(e=i.extraInfo)==null?void 0:e.url,(o=(n=i.extraInfo)==null?void 0:n.msids)==null?void 0:o.map(u=>u.name))}),this.rts.on("reconnectFinish",i=>{var e;ke.debug(`[${Qt.logName}]`,"reconnectFinish",i),this.emit("reconnectFinish",i?.type||"pc",i?.latestUrl,(e=i?.msids)==null?void 0:e.map(n=>n.name));try{this.emit("connected",!0,this._rtsPeerConnectionType)}catch(n){ke.error(`[${Qt.logName}]`,"emit connected error:",n)}}),this.rts.on("datachannelStatusChange",i=>{ke.event(`[${Qt.logName}]`,"rts datachannelStatusChange to:",i.status),i.status===wt.EDatachannelStatus.DATACHANNEL_STATUS_OPEN?this.dcResolve&&this.dcResolve(!0):i.status===wt.EDatachannelStatus.DATACHANNEL_STATUS_CLOSE&&(this.dcReject&&this.dcReject(),this.dcConnectingPromise=new Promise((e,n)=>{this.dcResolve=e,this.dcReject=n}))}),this.rts.on("receivedSEI",i=>{var e;if(this.emit("seimessage",i.url,i.sei.payloadType,i.sei.data),i.sei.payloadType===99)try{const n=JSON.parse(new TextDecoder().decode(i.sei.data));this.slsReporter.reportLoopAudioDelay(((e=this.publishingTracks.find(o=>o.type==="audio"))==null?void 0:e.ssrc)||"",n)}catch{}}),this.rts.on("onError",i=>{ke.event(`[${Qt.logName}]`,"rts onError event:",i)}),this.rts.on("reconnect",i=>{ke.event(`[${Qt.logName}]`,"rts reconnect event:",i)}),this.rts.on("traceId",({url:i,traceId:e})=>{i&&e&&this.traceIdMap[i]!==e&&(this.traceIdMap[i]=e,this.emit("traceIdUpdated",i,e))})}updateAuth(i){this.rts.updateAuth(i)}get pcTraceId(){return this._pcTraceId}set localJoinTime(i){this._localJoinTime=i}setEncodedInsertableStreams(i){this.encodedInsertableStreams=i}setReceiverPreferredVideoCodecH265(){var i;let e=(i=RTCRtpReceiver.getCapabilities("video"))==null?void 0:i.codecs;if(!e||e.length===0)return;const n=e.filter(u=>u.mimeType.toLowerCase()!=="video/rtx");let o=n.findIndex(u=>u.mimeType==="video/H265");if(o+1){let u=n[o];n.splice(o,1),n.unshift(u),this.rts.setReceiverCodecPreferences({video:n})}}setSenderPreferredVideoCodecH265(){var i;let e=(i=RTCRtpSender.getCapabilities("video"))==null?void 0:i.codecs;if(!e||e.length===0)return;const n=e.filter(u=>u.mimeType.toLowerCase()!=="video/rtx");let o=n.findIndex(u=>u.mimeType==="video/H265");if(o+1){let u=n[o];n.splice(o,1),n.unshift(u),this.rts.setSenderCodecPreferences({video:n})}}supportVideoCodec(i){var e,n,o;return i===vr.H265?(e=RTCRtpSender.getCapabilities("video"))==null?void 0:e.codecs.some(u=>u.mimeType==="video/H265"):i===vr.H264?(n=RTCRtpSender.getCapabilities("video"))==null?void 0:n.codecs.some(u=>u.mimeType==="video/H264"):i===vr.AV1&&((o=RTCRtpSender.getCapabilities("video"))==null?void 0:o.codecs.some(u=>u.mimeType==="video/AV1"))}changeVideoCodec(i){this.supportVideoCodec(i)?(ke.info(`[${Qt.logName}]`,"changeVideoCodec to:",i),vr.H265===i&&(this.setSenderPreferredVideoCodecH265(),this.setReceiverPreferredVideoCodecH265())):ke.warn(`[${Qt.logName}]`,`not support video codec: ${i}`)}setAudioRedEnabled(i){var e;if(i!==this.audioRedEnabled){try{const n=[...((e=RTCRtpReceiver.getCapabilities("audio"))==null?void 0:e.codecs)||[]];if(n.length>0){if(i){const o=n.findIndex(g=>g.mimeType==="audio/red"),u=n.findIndex(g=>g.mimeType==="audio/opus");if(o>-1&&u>-1&&o>u){const g=n[u];n[u]=n[o],n[o]=g}}this.rts.setSenderCodecPreferences({audio:n}),this.rts.setReceiverCodecPreferences({audio:n})}}catch{}this.audioRedEnabled=i}}clear(){this.setConnected(!1),this.rtsDisconnected=!1,this._publishingTracks=[];try{this.rts.removeAllListeners(),this.rts.unpublish(),this.rts.unsubscribe()}catch{}this.rts=wt.AliRTS.createClient(),this.addRTSListener()}startConnect(){this.connecting=!0,this.connectingPromise=new Promise(i=>{this.connectionResolve=i}),this.dcConnectingPromise=new Promise((i,e)=>{this.dcResolve=i,this.dcReject=e})}setConnected(i){var e;this.connected=i,this.connecting=!1,(e=this.connectionResolve)==null||e.call(this,!0)}get isConnecting(){return this.connecting}get isConnected(){return this.connected}get publishingTracks(){return this._publishingTracks}getPubMsid(i,e){const{aMsid:n,vMsid:o}=e??{},u={};return i.hasAudio&&(u.aMsid=[n??De.Audio]),i.hasScreen&&(u.vMsid=[De.Screen]),i.hasVideo&&(u.vMsid=[o??(e!=null&&e.isScreen?De.Screen:De.VideoLarge)]),u}updatePublishingTracks(i){i&&(this._publishingTracks=i.map(({msid:e,from:n,ssrc:o,codec:u,type:g,trackId:c})=>({msid:e,from:n,type:g,ssrc:`${o}`,codec:u??"",trackId:c})))}httpPublish(i){return pe(this,arguments,function*(e,n=!1,o=xr.MANUAL){let u;const g=Date.now(),c=e.url,s=e.callId;this.startConnect();const{publishStream:d,videoSmallStream:l,screenStream:p,vMsid:S}=yield this.localStreamManager.createHTTPPublishStream();if(!d)return ke.warn(`[${Qt.logName}]`,"publishStream is null"),{traceId:"",l1ip:u};const T=this.getPubMsid(d,{vMsid:S});T.answerSdpHook=_=>{const A=/\d+\.\d+\.\d+\.\d+(?=\s+1106|\s+8000)/.exec(_);return A!=null&&A[0]&&(u=A[0]),_},this.handleHTTPConfig(T),this._rtsPeerConnectionType="publish";let y=!d.hasVideo,R=S,v="";const h=Date.now();try{v=yield this.rts.publish(rh(c,this.preferredPubL1Ip),d,T)}catch(_){this.setConnected(!1);const A=2e3-(Date.now()-h);throw A<=0?this.emit("disconnected"):setTimeout(()=>{this.emit("disconnected")},A),this.slsReporter.reportPublish(n,c,s,d.hasVideo&&(!S||S===De.VideoLarge),d.hasVideo&&S===De.VideoSmall,d.hasVideo&&S===De.Screen,d.hasAudio,_?.errorCode||-1,this.pcTraceId,"",h,h),Ve.fromRtsError(_)}v&&(this._pcTraceId=v),ke.event(`[${Qt.logName}]`,"rts publish success",v);const m=Date.now();setTimeout(()=>{this.slsReporter.reportPublish(n,c,s,d.hasVideo&&(!S||S===De.VideoLarge),d.hasVideo&&S===De.VideoSmall,d.hasVideo&&S===De.Screen,d.hasAudio,0,this.pcTraceId,e.traceId,h,m)},6e3),this.slsReporter.reportConnectionLatencyEvent(nr.HANDLE_PUB_TASK,Sr.START,s,v,g),this.slsReporter.reportConnectionLatencyEvent(nr.HANDLE_PUB_TASK,Sr.END,s,v,Date.now());try{const _=Date.now();return this._pcTraceId=v,this.setConnected(!0),this._publishingTracks=this.rts.getPublishTrackInfoList(),l&&(yield this.publishAdd(e,l,{vMsid:De.VideoSmall},n),y=!1,R=De.VideoSmall),p&&(yield this.publishAdd(e,p,{vMsid:De.Screen},n),y=!1,R=De.Screen),yield this.waitPublishSender(c,y,R),this.slsReporter.reportPublishFirstPacket(n,s,h,_,this._localJoinTime,y?De.Audio:T.vMsid,v||"",v||"",o),{traceId:v,l1ip:u}}catch(_){throw this.setConnected(!1),Ve.fromError(_)}})}waitPublishSender(i,e=!1,n){return pe(this,null,function*(){return Promise.race([Bn(1e3),((o,u)=>{let g=0;const c=()=>(e?this.rts.getPublishAudioStats(i,n):this.rts.getPublishVideoStats(i,n)).then(s=>!(s.bytesSent>0)&&g<o?(g++,new Promise(d=>setTimeout(()=>d(c()),u))):Promise.resolve());return c()})(5,100)]).catch(()=>{})})}getPublishVideoStats(i,e){return pe(this,null,function*(){return yield this.rts.getPublishVideoStats(i,e)})}getPublishAudioStats(i,e){return pe(this,null,function*(){return yield this.rts.getPublishAudioStats(i,e)})}publishAdd(i,e,n){return pe(this,arguments,function*(o,u,g,c=!1,s=!1,d=xr.MANUAL){var l,p,S,T;const y=o.url,R=o.callId;yield this.dcConnectingPromise;const v=Date.now(),h=this.getPubMsid(u,g);try{const m=yield U0(_=>pe(this,null,function*(){return _>0&&ke.event(`[${Qt.logName}]`,`publishAdd retry times: ${_}`),this.isConnected?(yield this.dcConnectingPromise,this.rts.publishAdd([Qe({url:y,stream:u,updateSourceStream:!1},h)])):Promise.reject(new Ve(je.ERR_INNER,"rts not connected"))}),10,0,_=>_?.errorCode===15006);if(m){const _=Date.now(),[A]=m,E=Date.now();return setTimeout(()=>{var b,w,C,P;this.slsReporter.reportPublish(!1,y,R,((b=h.vMsid)==null?void 0:b[0])===De.VideoLarge,((w=h.vMsid)==null?void 0:w[0])===De.VideoSmall,((C=h.vMsid)==null?void 0:C[0])===De.Screen,((P=h.aMsid)==null?void 0:P[0])===De.Audio,0,this.pcTraceId,A.traceId||"",v,E)},6e3),A.traceId&&(this._pcTraceId=A.traceId),this.updatePublishingTracks(A.trackInfoList),s&&(yield this.waitPublishSender(y,!u.hasVideo,u.hasVideo?g?.vMsid:g?.aMsid)),this.slsReporter.reportPublishFirstPacket(c,R,v,_,this._localJoinTime,(u.hasVideo?g?.vMsid:g?.aMsid)||"",this.pcTraceId,A.traceId||"",d),A.traceId||""}}catch(m){throw this.slsReporter.reportPublish(!1,y,R,((l=h.vMsid)==null?void 0:l[0])===De.VideoLarge,((p=h.vMsid)==null?void 0:p[0])===De.VideoSmall,((S=h.vMsid)==null?void 0:S[0])===De.Screen,((T=h.aMsid)==null?void 0:T[0])===De.Audio,m?.errorCode||-1,this.pcTraceId,"",v),m!=null&&m.errorCode?Ve.fromRtsError(m):Ve.fromError(m)}return""})}publishDelete(i,e){return pe(this,null,function*(){var n,o,u,g,c,s,d,l;yield this.dcConnectingPromise;const p=(o=(n=this.publishingTracks)==null?void 0:n.find(({msid:v})=>v===De.Audio))==null?void 0:o.msid,S=(g=(u=this.publishingTracks)==null?void 0:u.find(({msid:v})=>v===De.VideoLarge))==null?void 0:g.msid,T=(s=(c=this.publishingTracks)==null?void 0:c.find(({msid:v})=>v===De.Screen))==null?void 0:s.msid,y=[];e.screen&&T?y.push(T):e.video&&y.push(e.vMsid||S);const R=[];e.audio&&p&&R.push(p),ke.event(Qt.logName,"publishDelete",{streamUrl:i,aMsid:R,vMsid:y});try{const[v]=(yield this.rts.publishDeleteTracks([{url:i,aMsid:R,vMsid:y}]))||[];return ke.event(Qt.logName,"publishDelete",{result:v}),v&&this.updatePublishingTracks(v.trackInfoList),((l=(d=v?.trackInfoList)==null?void 0:d[0])==null?void 0:l.trackId)||""}catch(v){throw Ve.fromRtsError(v)}})}publishReplace(i,e,n){return pe(this,null,function*(){var o,u;yield this.dcConnectingPromise;const{vMsid:g,aMsid:c}=n??{};try{const s=yield this.rts.publishReplaceTracks([{url:i,stream:e,vMsid:g,aMsid:c}]),[d]=s;return this.updatePublishingTracks(d.trackInfoList),((u=(o=d?.trackInfoList)==null?void 0:o[0])==null?void 0:u.trackId)||""}catch(s){throw Ve.fromRtsError(s)}})}publishStop(i){return pe(this,null,function*(){return yield this.rts.publishStop([{url:i}]),this._publishingTracks=[],""})}publishAddDataChannel(i){return pe(this,null,function*(){yield this.dcConnectingPromise;const e=yield this.rts.publishAddDatachannel({signalUrl:i,url:rh(i,this.preferredPubL1Ip),label:De.Data,msid:De.Data}),n=e?.datachannel;if(n&&n.send){const o=new ArrayBuffer(4);new DataView(o).setUint8(0,240),n.datachannel.send(o)}return n})}publishStopDataChannel(i,e){return pe(this,null,function*(){return yield this.rts.publishStopDatachannel({url:i,datachannel:e})})}unpublish(){return pe(this,null,function*(){yield this.rts.unpublish(),this._publishingTracks=[],this.connecting=!1,this.connected=!1})}getSubConfig(i,e){let n=e??{};e||(n={audio:!0,video:!0,screen:!0});const o={};return n.audio&&(o.aMsid=[i?.getAudioInfo().msid||De.Audio]),n.video?n.vMsid?o.vMsid=[n.vMsid]:o.vMsid=i!=null&&i.hasVideoLarge?[i?.getVideoLargeInfo().msid||De.VideoLarge]:i!=null&&i.hasVideoSmall?[i?.getVideoSmallInfo().msid||De.VideoSmall]:[De.VideoLarge]:n.screen&&(o.vMsid=[i?.getScreenInfo().msid||De.Screen]),o}handleHTTPConfig(i){var e,n,o,u,g,c,s,d,l,p;if(this.encodedInsertableStreams&&(i.encodedInsertableStreams=!0),(n=(e=this.parameter)==null?void 0:e.net)!=null&&n.useTCP&&(i.tcpOnly=!0),(u=(o=this.parameter)==null?void 0:o.net)!=null&&u.cumuDelay&&(i.cumuDelay=!0),(c=(g=this.parameter)==null?void 0:g.net)!=null&&c.disableHeartbeat&&(i.disableHeartbeat=!0),(d=(s=this.parameter)==null?void 0:s.net)==null?void 0:d.mediaTimeout){const S=(p=(l=this.parameter)==null?void 0:l.net)==null?void 0:p.mediaTimeout;S>1e3&&S<1e5&&(i.mediaTimeout=S)}i.retryTimes=17,i.retryInterval=5e3}httpSubscribe(i){return pe(this,null,function*(){var e,n;const{remoteUser:o,options:u}=i;let g=o.streamUrl;u.video||u.screen?u!=null&&u.audio||(g+="@subaudio=no"):g+="@subvideo=no";const c=this.getSubConfig(o.streamInfo,u);this.handleHTTPConfig(c),this._rtsPeerConnectionType="subscribe",(n=(e=this.parameter)==null?void 0:e.net)!=null&&n.rrtr&&(c.offerSdpHook=s=>{const d=s.replace(/(a=rtpmap:(\d+).*\r\n)/g,`$1a=rtcp-fb:$2 rrtr\r
`);return d.includes(`a=rtcp-rsize\r
`)?d:d.replace(/(m=(video|audio).*\r\n)/g,`$1a=rtcp-rsize\r
`)});try{this.startConnect();const s=yield this.rts.subscribe(rh(g,this.preferredSubL1Ip),c);return this._pcTraceId=s.traceId,this.setConnected(!0),{traceId:s.traceId,stream:s}}catch(s){throw this.setConnected(!1),this.emit("disconnected"),Ve.fromRtsError(s)}})}subscribeAdd(i){return pe(this,null,function*(){var e,n,o,u;const{remoteUser:g,options:c}=i,s=Vr(Qe({url:g.streamUrl,subAudio:!!c.audio,subVideo:!(!c.screen&&!c.video)},this.getSubConfig(g.streamInfo,c)),{targetStream:c.screen?g.getScreenStream:g.getCameraStream});yield this.dcConnectingPromise;try{return(yield U0(d=>pe(this,null,function*(){return yield this.dcConnectingPromise,d>0&&ke.event(`[${Qt.logName}]`,`subscribeAdd retry times: ${d}`),this.isConnected?this.rts.subscribeAdd([s]):Promise.reject()}),10,100,d=>{var l,p,S,T;return d?.errorCode===15006||d?.errorCode===15004&&((T=(S=(p=(l=d.extraInfo)==null?void 0:l.parsedData)==null?void 0:p.streams)==null?void 0:S[0])==null?void 0:T.res_code)===404}))[0]}catch(d){if(((u=(o=(n=(e=d?.extraInfo)==null?void 0:e.parsedData)==null?void 0:n.streams)==null?void 0:o[0])==null?void 0:u.res_code)===508)return this.emit("subscribeexceeds"),null;throw Ve.fromRtsError(d)}})}subscribeDelete(i){return pe(this,null,function*(){var e,n,o,u;const{remoteUser:g,options:c}=i,s=Vr(Qe({url:g.streamUrl,subAudio:!!c.audio,subVideo:!(!c.screen&&!c.video)},this.getSubConfig(g.streamInfo,c)),{targetStream:c.screen?g.getScreenStream:g.getCameraStream});yield this.dcConnectingPromise;try{return ke.event(`[${Qt.logName}]`,"subscribeDeleteTracks",JSON.stringify({url:s.url,subAudio:s.subAudio,subVideo:s.subVideo,aMsid:s.aMsid,vMsid:s.vMsid})),(yield this.rts.subscribeDeleteTracks([s]))[0]}catch(d){if(((u=(o=(n=(e=d?.extraInfo)==null?void 0:e.parsedData)==null?void 0:n.streams)==null?void 0:o[0])==null?void 0:u.res_code)===404)return;throw Ve.fromRtsError(d)}})}subscribeAddDataChannel(i){return pe(this,null,function*(){yield this.dcConnectingPromise;const e=yield this.rts.subscribeAddDatachannel({signalUrl:i,url:i,label:De.Data,msid:De.Data}),n=e?.datachannel;if(n&&n.send){const o=new ArrayBuffer(4);new DataView(o).setUint8(0,240),n.send(o)}return n})}subscribeDeleteDatachannel(i,e){return pe(this,null,function*(){let n;try{n=yield this.rts.subscribeDeleteDatachannel({url:i,msid:De.Data,datachannel:e})}catch{}return n})}publish(i){return pe(this,arguments,function*(e,n=!1,o=xr.MANUAL){const u=e.url;let g,c="";if(this.connecting&&(yield this.connectingPromise),this.connected){yield this.dcConnectingPromise;let s,d=!1;const{audio:l,video:p,videoSmall:S,screen:T}=this.localStreamManager.publishStreams;l&&(c=yield this.publishAdd(e,l,{aMsid:De.Audio},n),d=!0,s=De.Audio,yield Bn(100)),p&&(c=yield this.publishAdd(e,p,{vMsid:De.VideoLarge},n),d=!1,s=De.VideoLarge,yield Bn(100)),S&&(c=yield this.publishAdd(e,S,{vMsid:De.VideoSmall},n),d=!1,s=De.VideoSmall,yield Bn(100)),T&&(c=yield this.publishAdd(e,T,{isScreen:!0,vMsid:De.Screen},n),d=!1,s=De.Screen),s&&(yield this.waitPublishSender(u,d,s))}else{const s=yield this.httpPublish(e,n,o);c=s.traceId,g=s.l1ip}return{traceId:c,l1ip:g}})}reportSubscribeLatency(i,e,n,o){const u=[];i.audio&&u.push(i.aMsid||De.Audio),i.video?u.push(i.vMsid||De.VideoLarge):i.screen&&u.push(De.Screen),u.forEach(g=>{this.slsReporter.reportConnectionLatencyEvent(nr.HANDLE_SUB_TASK,Sr.START,e,g,n,0,o),this.slsReporter.reportConnectionLatencyEvent(nr.HANDLE_SUB_TASK,Sr.END,e,g,Date.now(),0,o)})}subscribe(i,e,n,o,u){return pe(this,null,function*(){let g=!1;const{options:c,remoteUser:s}=i;if(c.video&&c.screen)throw new Ve(je.ERR_INNER,"subscribe error, video and screen cannot be subscribed at the same time");let d;this.connecting&&(yield this.connectingPromise);let l=Date.now();this.connected?d=yield this.subscribeAdd(i):(g=!0,d=yield this.httpSubscribe(i)),this.reportSubscribeLatency(c,n,l,g);const p=Date.now();let S=De.VideoLarge,T=c.video||c.screen,y=c.audio;c.video&&c.vMsid?S=c.vMsid:c.screen&&(S=De.Screen);let R=0,v=0,h=0;const m=((_,A)=>{let E=0;const b=()=>{let w;return y&&!R&&(w=this.rts.getSubscribeAudioStats(s.streamUrl).then(C=>{if(C.packetsReceived>0)R=Date.now(),ke.debug(`[${Qt.logName}]`,s.userId,"Stats ");else if(!T)return E<_&&(E++,new Promise(P=>setTimeout(()=>P(b()),A)));return!0})),T&&!h&&(w=this.rts.getSubscribeVideoStats(s.streamUrl,S).then(C=>(!v&&C.packetsReceived>0&&(v=Date.now(),ke.debug(`[${Qt.logName}]`,s.userId,"Stats ")),C.framesDecoded>0?(h=Date.now(),ke.debug(`[${Qt.logName}]`,s.userId,"Stats "),!0):E<_?(E++,new Promise(P=>setTimeout(()=>P(b()),A))):(ke.event(`[${Qt.logName}]`,s.userId,""),!1)))),Promise.resolve(w)};return b()})(20,100);return m.then(()=>{v&&this.slsReporter.reportSubscribeFirstPacket(e===Ht.Resume,n,o,S,{fprt:v-l,ifsprtc:h?h-l:0,ajsub:e===Ht.Join?1:0,pctid:this.pcTraceId,subtid:d?.traceId||"",sstc:p-l}),h&&this.slsReporter.reportSubscribeFirstFrame(e===Ht.Resume,n,o,S,{fvfrt:h-l,fp2fftc:h-v,ajsub:e===Ht.Join?1:0,tffrtc:e===Ht.Join?h-this.localJoinTime:h-u,pctid:this.pcTraceId,subtid:d?.traceId||"",fvfdtc:h-l}),R&&(this.slsReporter.reportConnectionLatencyEvent(nr.FIRST_REMOTE,Sr.DECODED,n,De.Audio,R),this.slsReporter.reportSubscribeFirstPacket(e===Ht.Resume,n,o,De.Audio,{fprt:R-l,ifsprtc:R-l,ajsub:e===Ht.Join?1:0,pctid:this.pcTraceId,subtid:d?.traceId||"",sstc:p-l}))}),d&&(d.isHTTP=g,d.statsCheckPromise=m),d})}getSubscribeVideoStats(i,e){return pe(this,null,function*(){return yield this.rts.getSubscribeVideoStats(i,e)})}getSubscribeAudioStats(i,e){return pe(this,null,function*(){return yield this.rts.getSubscribeAudioStats(i,e)})}getStreamByMsid(i){return this.rts.commonController.streamManager.getStreamByMsid(i)}getDatachannelByMsid(i){var e;return(e=this.rts.commonController.datachannelManager)==null?void 0:e.getByMsid(i)}getPCStats(){return pe(this,null,function*(){var i,e;return(e=(i=this.rts.commonController.peerCore)==null?void 0:i.pc)==null?void 0:e.getStats()})}sendSEI(i,e,n,o){return pe(this,null,function*(){return this.rts.sendSEI({url:i,vMsid:De.VideoLarge,data:e,repeatCount:n,payloadType:o})})}},W(Qt,"logName","RtsManager"),Qt);gi([ge(He)],ui.prototype,"startConnect"),gi([ge()],ui.prototype,"updatePublishingTracks"),gi([ge(He,He)],ui.prototype,"httpPublish"),gi([ge(He,He)],ui.prototype,"waitPublishSender"),gi([ge(([i,e,n])=>[i,JSON.stringify(n)],He)],ui.prototype,"publishAdd"),gi([ge(He,He)],ui.prototype,"publishDelete"),gi([ge(([i,e,n])=>[i,JSON.stringify(n)])],ui.prototype,"publishReplace"),gi([ge(He)],ui.prototype,"publishStop"),gi([ge(He)],ui.prototype,"publishAddDataChannel"),gi([ge(He)],ui.prototype,"publishStopDataChannel"),gi([ge()],ui.prototype,"unpublish"),gi([ge(Kc,({traceId:i})=>i)],ui.prototype,"httpSubscribe"),gi([ge(Kc,({traceId:i})=>i)],ui.prototype,"subscribeAdd"),gi([ge(Kc)],ui.prototype,"subscribeDelete"),gi([ge(He)],ui.prototype,"subscribeAddDataChannel"),gi([ge(He)],ui.prototype,"subscribeDeleteDatachannel"),gi([ge(He)],ui.prototype,"publish"),gi([ge(Kc)],ui.prototype,"subscribe"),gi([ge()],ui.prototype,"sendSEI");let eT=ui;class yh{constructor(e=Bh){W(this,"defaultProfile"),W(this,"profile"),W(this,"profileMap",new Map),W(this,"audioProfile"),W(this,"contentHint"),this.defaultProfile=Qe({},e)}updateProfile(e,n){this.profileMap.set(e,Qe(Qe(Qe({},this.defaultProfile),this.profileMap.get(e)||{}),n||{})),this.profile=e}get videoProfile(){return this.profile}updateAudioProfile(e){this.audioProfile=e}setContentHint(e,n){n&&(this.contentHint=n),this.contentHint&&e&&(e.contentHint=this.contentHint)}setVideoProfile(e,n,o=!1){return pe(this,null,function*(){if(!this.profile)return;const u=this.profileMap.get(this.profile)||n?.VideoProfileMap.get(this.profile);if(u){if(!o&&e&&e.readyState==="live"&&e.applyConstraints)try{yield e.applyConstraints(u)}catch{}if(n){const g=Qe({},u);u.maxSendFrameRate&&(g.frameRate=u.maxSendFrameRate),n?.VideoProfileMap.set(this.profile,g),yield n.setVideoProfile(this.profile)}}})}}var di=(i=>(i[i.AliRtcSdkStreamTypeCapture=0]="AliRtcSdkStreamTypeCapture",i[i.AliRtcSdkStreamTypeScreen=1]="AliRtcSdkStreamTypeScreen",i))(di||{});class Sy extends Ei{constructor(e){super(),W(this,"type"),W(this,"originVideoTrack"),W(this,"videoSource"),W(this,"_videoMuted",!1),W(this,"originAudioTrack"),W(this,"audioSource"),W(this,"_audioMuted",!1),W(this,"_targetVideoTrack"),W(this,"_targetDualVideoTrack"),W(this,"_targetAudioTrack"),W(this,"_publishVideoStream"),W(this,"_publishDualVideoStream"),W(this,"_publishAudioStream"),W(this,"_previewStream"),W(this,"plugins",[]),W(this,"_profileManager"),W(this,"cameraVideoConstraints"),W(this,"micAudioConstraints"),W(this,"onVideoTrackEnded",()=>{this.emit("videotrackended")}),W(this,"onAudioTrackEnded",()=>{this.emit("audiotrackended")}),this.type=e}get profileManager(){return this._profileManager}get audioProfile(){var e;return(e=this.profileManager)==null?void 0:e.audioProfile}updateSource(e,n,o){return pe(this,null,function*(){var u,g,c,s,d,l;const{videoTrack:p,audioTrack:S}=e;p&&((u=this.originVideoTrack)==null||u.removeEventListener("ended",this.onVideoTrackEnded)),S&&((g=this.originAudioTrack)==null||g.removeEventListener("ended",this.onAudioTrackEnded)),this.type===di.AliRtcSdkStreamTypeScreen?this.stop():(p&&((c=this.originVideoTrack)==null||c.stop()),S&&((s=this.originAudioTrack)==null||s.stop())),p&&(this.originVideoTrack=p,(d=this.originVideoTrack)==null||d.addEventListener("ended",this.onVideoTrackEnded),this.videoSource=n||bs.Camera,this.updateVideoTrack(p)),S&&(this.originAudioTrack=S,(l=this.originAudioTrack)==null||l.addEventListener("ended",this.onAudioTrackEnded),this.audioSource=o||ul.Microphone,this.updateAudioTrack(S))})}get currentProfile(){var e;return(e=this.profileManager)==null?void 0:e.profile}get currentVideoTrack(){return this._targetVideoTrack}get currentDualVideoTrack(){return this._targetDualVideoTrack}get publishVideoStream(){return this._publishVideoStream}get publishDualVideoStream(){return this._publishDualVideoStream}get currentAudioTrack(){return this._targetAudioTrack}get publishAudioStream(){return this._publishAudioStream}get previewStream(){return this._previewStream}updateVideoTrack(e,n=!1){return pe(this,null,function*(){(this._targetVideoTrack!==e||n)&&(this._targetVideoTrack=e)})}updateDualVideoTrack(e,n=!1){return pe(this,null,function*(){(this._targetDualVideoTrack!==e||n)&&(this._targetDualVideoTrack=e)})}updateAudioTrack(e,n=!1){return pe(this,null,function*(){(this._targetAudioTrack!==e||n)&&(this._targetAudioTrack=e)})}setAudioMuted(e){var n,o;this._audioMuted=e,e?(n=this.publishAudioStream)==null||n.disableAudio():(o=this.publishAudioStream)==null||o.enableAudio()}get isAudioMuted(){return this._audioMuted}setVideoMuted(e){var n,o;this._videoMuted=e,e?(n=this.publishVideoStream)==null||n.disableVideo():(o=this.publishVideoStream)==null||o.enableVideo()}get isVideoMuted(){return this._videoMuted}process(e){return pe(this,null,function*(){var n,o,u,g,c,s,d,l,p,S,T,y;this._targetAudioTrack=this.originAudioTrack,this._targetVideoTrack=this.originVideoTrack;for(const R of this.plugins)try{yield R.execute(this,e)}catch(v){console.error(`error in plugin-${R.name}, error: ${v}`)}this._targetVideoTrack?((o=(n=this._publishVideoStream)==null?void 0:n.videoTrack)==null?void 0:o.id)!==this._targetVideoTrack.id&&(this._publishVideoStream=yield ls(this._targetVideoTrack),this.setVideoMuted(this._videoMuted),(u=this.profileManager)==null||u.setVideoProfile(this.originVideoTrack,this._publishVideoStream,!0),(g=this.profileManager)==null||g.setContentHint(this._targetVideoTrack),this.previewStream?(c=this.previewStream)==null||c.mergeStream(this._publishVideoStream):this._previewStream=yield ls(this._targetVideoTrack)):(this._publishVideoStream=void 0,(s=this.previewStream)==null||s.deleteTracks({video:!0})),this._targetDualVideoTrack?((l=(d=this._publishDualVideoStream)==null?void 0:d.videoTrack)==null?void 0:l.id)!==this._targetDualVideoTrack.id&&(this._publishDualVideoStream=yield ls(this._targetDualVideoTrack),this._videoMuted?this._publishDualVideoStream.disableVideo():this._publishDualVideoStream.enableVideo()):this._publishDualVideoStream=void 0,this._targetAudioTrack?((S=(p=this._publishAudioStream)==null?void 0:p.audioTrack)==null?void 0:S.id)!==this._targetAudioTrack.id&&(this._publishAudioStream=yield ls(this._targetAudioTrack),this.setAudioMuted(this._audioMuted),this.previewStream?(T=this.previewStream)==null||T.mergeStream(this._publishAudioStream):this._previewStream=yield ls(this._targetAudioTrack)):(this._publishAudioStream=void 0,(y=this.previewStream)==null||y.deleteTracks({audio:!0}))})}stopVideo(){var e,n;this.originVideoTrack&&((e=this.originVideoTrack)==null||e.removeEventListener("ended",this.onAudioTrackEnded),(n=this.originVideoTrack)==null||n.stop(),this.originVideoTrack=void 0),this.updateVideoTrack(void 0)}stopAudio(){var e,n;this.originAudioTrack&&((e=this.originAudioTrack)==null||e.removeEventListener("ended",this.onAudioTrackEnded),(n=this.originAudioTrack)==null||n.stop(),this.originAudioTrack=void 0),this.updateAudioTrack(void 0)}stop(){this.stopVideo(),this.stopAudio()}updateVideoProfile(e,n,o=!1){return pe(this,null,function*(){this._profileManager||(this._profileManager=new yh(this.type===di.AliRtcSdkStreamTypeScreen?vy:Bh)),e&&this._profileManager.updateProfile(e,n),yield this._profileManager.setVideoProfile(this.originVideoTrack,this._publishVideoStream,o)})}get videoProfile(){var e;return(e=this.profileManager)==null?void 0:e.videoProfile}setVideoContentHint(e){this._profileManager||(this._profileManager=new yh(this.type===di.AliRtcSdkStreamTypeScreen?vy:Bh)),this._profileManager.setContentHint(this.currentVideoTrack,e)}updateAudioProfile(e){return pe(this,null,function*(){this._profileManager||(this._profileManager=new yh),this._profileManager.updateAudioProfile(e)})}cloneVideoProfile(e){return pe(this,null,function*(){var n;yield(n=this.profileManager)==null?void 0:n.setVideoProfile(void 0,e)})}addPlugin(e){const n=this.plugins.findIndex(o=>o.zIndex>e.zIndex);n>-1?this.plugins.splice(n,0,e):this.plugins.push(e)}removePlugin(e){const n=this.plugins.indexOf(e);return n>-1&&(e.clear(this),this.plugins.splice(n,1),!0)}}var tT=Object.defineProperty,iT=Object.getOwnPropertyDescriptor,Ar=(i,e,n,o)=>{for(var u,g=iT(e,n),c=i.length-1;c>=0;c--)(u=i[c])&&(g=u(e,n,g)||g);return g&&tT(e,n,g),g},oa;const gr=(oa=class extends Ei{constructor(i,e){super(),W(this,"pluginManager"),W(this,"slsReporter"),W(this,"publishingCameraVideoStream"),W(this,"publishingScreenVideoStream"),W(this,"cameraStreamInfo",new Sy(di.AliRtcSdkStreamTypeCapture)),W(this,"screenStreamInfo",new Sy(di.AliRtcSdkStreamTypeScreen)),W(this,"streamInfos",[this.cameraStreamInfo,this.screenStreamInfo]),W(this,"_audioCaptureDisabled",!1),W(this,"_cameraCaptureDisabled",!1),W(this,"_publishLocalAudioStreamEnabled",!0),W(this,"_publishLocalVideoStreamEnabled",!0),W(this,"_publishLocalScreenStreamEnabled",!0),this.screenStreamInfo.setVideoContentHint("motion"),this.pluginManager=i,this.slsReporter=e,this.cameraStreamInfo.on("videotrackended",()=>pe(this,null,function*(){yield this.stopLocalStream({video:!0}),this.emit("trackended",go.VideoTrackEnded)})),this.cameraStreamInfo.on("audiotrackended",()=>pe(this,null,function*(){yield this.stopLocalStream({audio:!0}),this.emit("trackended",go.AudioTrackEnded)})),this.screenStreamInfo.on("videotrackended",()=>pe(this,null,function*(){yield this.stopLocalStream({screen:!0}),this.emit("trackended",go.ScreenTrackEnded)})),this.pluginManager.on("added",n=>pe(this,null,function*(){if(ke.info(`[${oa.logName}]`,"plugin added",n.name),!n.isSupported("7.2.1"))return console.warn(`${n.name} is not supported!!!`),void n.emit("unsupported");try{yield n.init()}catch(o){n.emit("error",Ve.fromError(o,Vn.AliRtcPluginErrorInitError))}n.streamType===di.AliRtcSdkStreamTypeCapture&&(this.cameraStreamInfo.addPlugin(n),yield this.cameraStreamInfo.process(this.streamInfos)),n.streamType===di.AliRtcSdkStreamTypeScreen&&(this.screenStreamInfo.addPlugin(n),yield this.screenStreamInfo.process(this.streamInfos)),this.emit("publishupdate")})),this.pluginManager.on("removed",n=>pe(this,null,function*(){this.cameraStreamInfo.removePlugin(n)&&(yield this.cameraStreamInfo.process(this.streamInfos)),this.screenStreamInfo.removePlugin(n)&&(yield this.screenStreamInfo.process(this.streamInfos)),this.emit("publishupdate")})),this.pluginManager.on("updated",()=>pe(this,null,function*(){yield this.updateStreams()}))}get hasCamera(){return!!this.cameraStreamInfo.originVideoTrack}get audioCaptureDisabled(){return this._audioCaptureDisabled}set audioCaptureDisabled(i){this._audioCaptureDisabled=i}get cameraCaptureDisabled(){return this._cameraCaptureDisabled}set cameraCaptureDisabled(i){this._cameraCaptureDisabled=i}setAudioMuted(i){this.cameraStreamInfo.setAudioMuted(i)}get isAudioMuted(){return this.cameraStreamInfo.isAudioMuted}setCameraMuted(i){this.cameraStreamInfo.setVideoMuted(i)}get isCameraMuted(){return this.cameraStreamInfo.isVideoMuted}setScreenMuted(i){this.screenStreamInfo.setVideoMuted(i)}get isScreenMuted(){return this.screenStreamInfo.isVideoMuted}get publishLocalAudioStreamEnabled(){return this._publishLocalAudioStreamEnabled}set publishLocalAudioStreamEnabled(i){this._publishLocalAudioStreamEnabled=i}get publishLocalVideoStreamEnabled(){return this._publishLocalVideoStreamEnabled}set publishLocalVideoStreamEnabled(i){this._publishLocalVideoStreamEnabled=i}get publishLocalScreenStreamEnabled(){return this._publishLocalScreenStreamEnabled}set publishLocalScreenStreamEnabled(i){this._publishLocalScreenStreamEnabled=i}updateStreams(){return pe(this,null,function*(){yield this.cameraStreamInfo.process(this.streamInfos),yield this.screenStreamInfo.process(this.streamInfos),this.emit("publishupdate")})}setAvailableCameraDeviceId(){return pe(this,null,function*(){var i,e,n,o;if((i=this.cameraStreamInfo.cameraVideoConstraints)!=null&&i.deviceId){let u=(e=this.cameraStreamInfo.cameraVideoConstraints)==null?void 0:e.deviceId;const g=yield wt.AliRTS.getCameraList();g.find(c=>c.deviceId===u)||(u=(o=(n=g.find(c=>!!c.deviceId))==null?void 0:n.deviceId)!=null?o:""),this.cameraStreamInfo.cameraVideoConstraints.deviceId=u}})}setAvailableMicrophoneDeviceId(){return pe(this,null,function*(){var i,e,n,o;if((i=this.cameraStreamInfo.micAudioConstraints)!=null&&i.deviceId){let u=(e=this.cameraStreamInfo.micAudioConstraints)==null?void 0:e.deviceId;const g=yield wt.AliRTS.getMicList();g.find(c=>c.deviceId===u)||(u=(o=(n=g.find(c=>!!c.deviceId))==null?void 0:n.deviceId)!=null?o:""),this.cameraStreamInfo.micAudioConstraints.deviceId=u}})}createLocalStream(i){return pe(this,null,function*(){var e;const{screen:n,mediaStream:o,videoProfile:u,screenProfile:g}=i;let{video:c,audio:s}=i;const d=(p=>{const{audio:S,video:T,screen:y}=p;if(T&&y)throw new Ve(je.ERR_INNER,"create stream error, cannot create video && screen together");return!!(T||S||y)})(i);let l;if(d){o||(c===!0&&this.cameraStreamInfo.cameraVideoConstraints?(yield this.setAvailableCameraDeviceId(),c=Qe({},this.cameraStreamInfo.cameraVideoConstraints)):typeof c=="object"&&(yield this.setAvailableCameraDeviceId(),c=Qe(Qe({},c),this.cameraStreamInfo.cameraVideoConstraints)),s===void 0&&this.audioCaptureDisabled?s=!1:s&&(s===!0&&this.cameraStreamInfo.micAudioConstraints?(yield this.setAvailableMicrophoneDeviceId(),s=Qe({},this.cameraStreamInfo.micAudioConstraints)):typeof s=="object"&&(yield this.setAvailableMicrophoneDeviceId(),s=Qe(Qe({},s),this.cameraStreamInfo.micAudioConstraints)),this._audioCaptureDisabled=!1));const p=Date.now();try{l=yield wt.AliRTS.createStream({audio:s,video:c,screen:n,custom:!!o,mediaStream:o,skipProfile:!0}),ke.info(`[${oa.logName}]`,"createLocalStream",{audio:s,video:c,screen:n,custom:!!o,time:Date.now()-p}),s&&!o&&this.slsReporter.reportAudio(null,Date.now()-p,((e=l?.audioTrack)==null?void 0:e.label)||""),n&&!o&&this.slsReporter.reportScreen(null,Date.now()-p)}catch(S){throw s&&!o&&this.slsReporter.reportAudio(S,Date.now()-p,""),n&&!o&&this.slsReporter.reportScreen(null,Date.now()-p),S}if(n)yield this.screenStreamInfo.updateSource(l,bs.Screen,ul.Screen),yield this.setScreenProfile(g||ES),this.setScreenContentHint(),this.publishingScreenVideoStream=void 0;else if(yield this.cameraStreamInfo.updateSource(l,bs.Camera,ul.Microphone),l.hasVideo&&(yield this.setVideoProfile(u||bS),this.setVideoContentHint(),this.publishingCameraVideoStream=void 0),l.hasAudio&&typeof s=="boolean"){const S=this.cameraStreamInfo.audioProfile;S&&(yield l.setAudioProfile(S))}}return wt.AliRTS.SystenUtil.isIos&&wt.AliRTS.SystenUtil.compareVersion("15.1")&&!wt.AliRTS.SystenUtil.compareVersion("15.2")&&(yield Bn(1e3)),yield this.updateStreams(),l})}stopLocalStream(i){return pe(this,null,function*(){const{screen:e,video:n,audio:o}=i??{};let u=!1;n&&this.cameraStreamInfo.originVideoTrack&&(u=!0,this.cameraStreamInfo.stopVideo(),this.publishingCameraVideoStream=void 0),o&&this.cameraStreamInfo.originAudioTrack&&(u=!0,this.cameraStreamInfo.stopAudio()),e&&this.screenStreamInfo.originVideoTrack&&(u=!0,this.screenStreamInfo.stop(),this.publishingScreenVideoStream=void 0,this.slsReporter.reportScreenStop(null)),u&&(yield this.updateStreams())})}get publishStreams(){const{publishLocalVideoStreamEnabled:i,publishLocalAudioStreamEnabled:e,publishLocalScreenStreamEnabled:n}=this;return{video:i?this.cameraStreamInfo.publishVideoStream:void 0,videoSmall:i?this.cameraStreamInfo.publishDualVideoStream:void 0,audio:e?this.cameraStreamInfo.publishAudioStream:void 0,screen:n?this.screenStreamInfo.publishVideoStream:void 0}}createHTTPPublishStream(){return pe(this,null,function*(){var i,e,n,o;let u,g,c,s,d=!1;const l=this.publishStreams;try{if(!(l.audio||l.video||l.videoSmall||l.screen))throw ke.error(`[${oa.logName}]`,"no tracks founded"),new Ve(je.ERR_SDK_PUBLISH_INVAILD,"no tracks founded");const p=new MediaStream;(i=l.audio)!=null&&i.audioTrack&&p.addTrack(l.audio.audioTrack),(e=l.video)!=null&&e.videoTrack?(p.addTrack(l.video.videoTrack),c=l.videoSmall,s=l.screen):(n=l.screen)!=null&&n.videoTrack&&(g=De.Screen,p.addTrack((o=l.screen)==null?void 0:o.videoTrack),d=!0),u=yield TS(p),d?(this.screenStreamInfo.cloneVideoProfile(u),this.publishingScreenVideoStream=u):(this.cameraStreamInfo.cloneVideoProfile(u),this.publishingCameraVideoStream=u)}catch{}return{publishStream:u,videoSmallStream:c,screenStream:s,vMsid:g}})}stop(){this.cameraStreamInfo.stop(),this.screenStreamInfo.stop(),this.updateStreams()}setVideoProfile(i,e,n=!1){return pe(this,null,function*(){yield this.cameraStreamInfo.updateVideoProfile(i,e,n),this.publishingCameraVideoStream&&this.cameraStreamInfo.cloneVideoProfile(this.publishingCameraVideoStream)})}setVideoContentHint(i){this.cameraStreamInfo.setVideoContentHint(i)}setAudioProfile(i){return pe(this,null,function*(){var e;yield this.cameraStreamInfo.updateAudioProfile(i),yield(e=this.publishingCameraVideoStream)==null?void 0:e.setAudioProfile(i)})}setScreenProfile(i,e){return pe(this,null,function*(){yield this.screenStreamInfo.updateVideoProfile(i,e),this.publishingScreenVideoStream&&this.screenStreamInfo.cloneVideoProfile(this.publishingScreenVideoStream)})}setScreenContentHint(i){this.screenStreamInfo.setVideoContentHint(i)}setCameraVideoConstraints(i){var e;this.cameraStreamInfo.cameraVideoConstraints=Qe(Qe({},(e=this.cameraStreamInfo.cameraVideoConstraints)!=null?e:{}),i)}setMicAudioConstraints(i){var e;this.cameraStreamInfo.micAudioConstraints=Qe(Qe({},(e=this.cameraStreamInfo.micAudioConstraints)!=null?e:{}),i)}},W(oa,"logName","LocalStreamManager"),oa);Ar([ge(([i])=>{const{audio:e,video:n,screen:o,custom:u,skipProfile:g,videoProfile:c,screenProfile:s}=i;return[{audio:e,video:n,screen:o,custom:u,skipProfile:g,videoProfile:c,screenProfile:s}]})],gr.prototype,"createLocalStream"),Ar([ge(He)],gr.prototype,"stopLocalStream"),Ar([ge()],gr.prototype,"createHTTPPublishStream"),Ar([ge()],gr.prototype,"stop"),Ar([ge(He)],gr.prototype,"setVideoProfile"),Ar([ge(He)],gr.prototype,"setVideoContentHint"),Ar([ge(He)],gr.prototype,"setAudioProfile"),Ar([ge(He)],gr.prototype,"setScreenProfile"),Ar([ge(He)],gr.prototype,"setScreenContentHint"),Ar([ge(He)],gr.prototype,"setCameraVideoConstraints"),Ar([ge(He)],gr.prototype,"setMicAudioConstraints");let rT=gr;const nT=i=>pe(void 0,null,function*(){const e=new wt.AliRTS.SupportUtil;window.isSecureContext||console.warn("WebRTC  HTTPS https://developer.mozilla.org/zh-CN/docs/Web/Security/Secure_Contexts");let n={support:!1,detail:{isWebRTCSupported:e.checkMediaDevices()&&e.checkWebRtcSupport(),isH264DecodeSupported:!1,isH264EncodeSupported:!1,isScreenShareSupported:!1,isSendMediaExtensionMsgSupported:!1,isBrowserSupported:!0}},o=!1;try{n.detail.isWebRTCSupported?(yield e.isSupport({isReceiveVideo:!0}),o=!0):console.warn(" WebRTC")}catch{o=!1,n.detail.isBrowserSupported=e.checkBrowser({errorCode:0,message:""})}if(n.support=o,e.checkWebRtcSupport()&&i!=="sendonly"){const u=yield e.checkH264Decode();n.detail.isH264DecodeSupported=u,n.support=n.support&&u}if(e.checkWebRtcSupport()&&i!=="recvonly"){const u=yield e.checkH264Encode();n.detail.isH264EncodeSupported=u,n.support=n.support&&u}return n.detail.isScreenShareSupported=e.checkWebRtcSupport()&&e.checkScreenCapture()&&!wt.AliRTS.SystenUtil.isAndroid&&!wt.AliRTS.SystenUtil.isIos,n.detail.isSendMediaExtensionMsgSupported=e.checkWebRtcSupport()&&e.checkEncodedTransformSupport(),n});var oT=(i=>(i[i.PRE_PROCESSOR=0]="PRE_PROCESSOR",i[i.POST_PROCESSOR=1]="POST_PROCESSOR",i))(oT||{}),_s=(i=>(i[i.AUDIO=0]="AUDIO",i[i.VIDEO=1]="VIDEO",i[i.BOTH=2]="BOTH",i))(_s||{});class zn extends Ei{constructor(e,n=di.AliRtcSdkStreamTypeCapture,o=1){super(),W(this,"name"),W(this,"options"),W(this,"type",0),W(this,"streamType"),W(this,"trackType"),W(this,"zIndex",1),W(this,"_isEnable",!0),W(this,"shouldCache",!0),W(this,"lastInputAudioTrack"),W(this,"lastOutputAudioTrack"),W(this,"lastInputVideoTrack"),W(this,"lastOutputVideoTrack"),W(this,"_hasCleared",!0),this.name=e,this.streamType=n,this.trackType=o,this.options=this.initOptions}get initOptions(){return{}}getOptions(){return this.options}init(){return pe(this,null,function*(){})}enable(){this._isEnable||(this._isEnable=!0,this.init(),this.emit("enabled"))}disable(){this._isEnable&&(this._isEnable=!1,this.clear(),this.emit("disabled"))}get isEnable(){return this._isEnable}audioUpdated(e){var n,o;return((n=this.lastInputAudioTrack)==null?void 0:n.id)!==((o=e.currentAudioTrack)==null?void 0:o.id)}videoUpdated(e){var n,o;return((n=this.lastInputVideoTrack)==null?void 0:n.id)!==((o=e.currentVideoTrack)==null?void 0:o.id)}execute(e,n){return pe(this,null,function*(){const o=this.shouldUpdate(e,n);this.lastInputAudioTrack=e.currentAudioTrack,this.lastInputVideoTrack=e.currentVideoTrack,this._hasCleared||o?(yield this.process(e,n),this._hasCleared=!1):this.shouldCache&&(!this.lastOutputAudioTrack||this.trackType!==2&&this.trackType!==0||this.lastOutputAudioTrack&&e.updateAudioTrack(this.lastOutputAudioTrack),!this.lastOutputVideoTrack||this.trackType!==2&&this.trackType!==1||this.lastOutputVideoTrack&&e.updateVideoTrack(this.lastOutputVideoTrack)),this.lastOutputAudioTrack=e.currentAudioTrack,this.lastOutputVideoTrack=e.currentVideoTrack})}clear(e){this._hasCleared=!0,this.lastInputAudioTrack=void 0,this.lastInputVideoTrack=void 0,this.lastOutputAudioTrack=void 0,this.lastOutputVideoTrack=void 0}}class aT extends zn{constructor(){super("AliRtcScreenStandardize",di.AliRtcSdkStreamTypeScreen),W(this,"canvas"),W(this,"lastWidth"),W(this,"lastHeight"),W(this,"isProcessingScreenTrack",!1),this.shouldCache=!1}get initOptions(){return{base:4}}setOptions(e){this.options=e}isSupported(){return!(typeof TransformStream>"u"||typeof MediaStreamTrackProcessor>"u"||typeof MediaStreamTrackGenerator>"u")}updateProcessCanvas(e,n){if(this.canvas&&this.lastWidth===e&&this.lastHeight===n)return;const o=Math.ceil(e/this.options.base)*this.options.base,u=Math.ceil(n/this.options.base)*this.options.base;if(this.canvas||(this.canvas=document.createElement("canvas")),this.canvas.width=o,this.canvas.height=u,this.lastWidth&&e>this.lastWidth||this.lastHeight&&n>this.lastHeight){const g=this.canvas.getContext("2d");g&&g.clearRect(0,0,o,u)}this.lastWidth=e,this.lastHeight=n}shouldProcess(e){var n;let o=!1;if(e.originVideoTrack&&e.videoSource===bs.Screen){const u=(n=e.originVideoTrack)==null?void 0:n.getSettings();if(u){const{width:g,height:c}=u;o=!g||!c||!(g%this.options.base===0&&c%this.options.base===0)}}return o}shouldUpdate(e){return this.shouldProcess(e)!==this.isProcessingScreenTrack}handleFrame(e){return pe(this,null,function*(){var n;const{displayWidth:o,displayHeight:u}=e;if(!o||!u||o%this.options.base===0&&u%this.options.base===0)return e;this.updateProcessCanvas(o,u);const g=(n=this.canvas)==null?void 0:n.getContext("2d");if(this.canvas&&g){g.drawImage(e,0,0,o,u);const c=new VideoFrame(this.canvas,{timestamp:e.timestamp});return e.close(),c}return e})}process(e){return pe(this,null,function*(){var n;if(!this.shouldProcess(e))return this.clear(e),void(this.isProcessingScreenTrack=!1);if(e.originVideoTrack){const l=e.originVideoTrack.getSettings();if(l){const{width:p,height:S}=l;if(!(!p||!S||!(p%this.options.base===0&&S%this.options.base===0)))return void this.clear(e)}}const o=new MediaStreamTrackProcessor({track:e.originVideoTrack}),u=new MediaStreamTrackGenerator({kind:"video"}),g=new MediaStream([u]),c=this,s=new TransformStream({transform(l,p){return pe(this,null,function*(){const S=yield c.handleFrame(l);yield p.enqueue(S),S?.close()})}});o.readable.pipeThrough(s).pipeTo(u.writable);const d=(n=g.getVideoTracks())==null?void 0:n[0];e.updateVideoTrack(d),this.isProcessingScreenTrack=!0})}clear(e){this.canvas=void 0,this.lastWidth=void 0,this.lastHeight=void 0,super.clear(e)}}class sT extends zn{constructor(){super("blankAudio",di.AliRtcSdkStreamTypeCapture,_s.BOTH),W(this,"hasTrack",!1),W(this,"oscillator",null),W(this,"audioTrack",null),W(this,"createAudioTrack",()=>{const e=new AudioContext;this.oscillator=e.createOscillator();const n=e.createGain();n.gain.value=0;const o=e.createMediaStreamDestination();this.oscillator.connect(n),n.connect(o),this.oscillator.start();const u=o.stream;return this.audioTrack=u.getAudioTracks()[0],this.audioTrack}),this.zIndex=9}isSupported(){return!0}setOptions(){throw new Error("Method not implemented.")}shouldUpdate(e,n){return this.hasTrack!==n.some(o=>o.originVideoTrack||o.originAudioTrack)}process(e,n){return pe(this,null,function*(){var o;const u=n.some(g=>g.originVideoTrack||g.originAudioTrack);this.hasTrack=u,u?this.audioTrack&&((o=this.oscillator)==null||o.stop(),this.oscillator=null,this.audioTrack.stop(),this.audioTrack=null):(this.audioTrack||(this.audioTrack=this.createAudioTrack()),e.updateAudioTrack(this.audioTrack))})}}class AS{constructor(e){W(this,"name","COMMON"),this.name=e||this.name}info(...e){}warn(...e){}print(e,...n){const o=e.toLowerCase();o&&console[o](`[${e}][${this.name}]`,...n)}}W(AS,"LEVEL",0);class cT{constructor(){W(this,"logger",new AS("AudioMixer")),W(this,"audioContext",new AudioContext),W(this,"audioDestination",this.audioContext.createMediaStreamDestination()),W(this,"audioTrack",(e=>e.getAudioTracks()[0])(this.audioDestination.stream)),W(this,"sourceNodeMap",{})}get sourceNodeList(){return Object.values(this.sourceNodeMap).map(e=>e.sourceNode).filter(e=>!!e)}get gainNodeList(){return Object.values(this.sourceNodeMap).map(e=>e.gainNode).filter(e=>!!e)}get sourceCount(){return this.sourceNodeList.length}resume(){var e;return(e=this.audioContext)==null?void 0:e.resume()}addTrack(e){this.connectTrack(e)}hasTrack(e){return!!this.sourceNodeMap[e]}removeTrack(e){const{sourceNode:n,gainNode:o}=this.sourceNodeMap[e]||{};o?.disconnect(),n?.disconnect(),delete this.sourceNodeMap[e],n?this.logger.info("SourceNode disconnected. Active source node:",this.sourceNodeList.length):this.logger.warn(`SourceNode ${e} does not exit. Active source node: ${this.sourceNodeList.length}`)}getAudioTrack(){return this.audioTrack}setVolume(e,n){const{gainNode:o}=this.sourceNodeMap[n]||{};o?(this.logger.info(`Setting node(${n}) volume to ${this.scale(e)}`),o.gain.value=this.scale(e)):this.logger.warn(`GainNode ${n} does not exit.`)}reset(){this.disconnectSourceNode(),this.sourceNodeMap={}}dispose(){var e;this.reset(),(e=this.audioTrack)==null||e.stop(),this.audioDestination.disconnect(),this.audioContext.close()}connectTrack(e){if(!this.audioContext)return this.logger.warn("AudioContext not initialized");let n=new MediaStream;n.addTrack(e);const o=this.audioContext.createMediaStreamSource(n),u=this.audioContext.createGain();u.gain.value=1,o.connect(u),u.connect(this.audioDestination),this.sourceNodeMap[e.id]={track:e,sourceNode:o,gainNode:u},this.logger.info("New sourceNode connected. Active source node:",this.sourceNodeList.length)}disconnectSourceNode(){this.sourceNodeList.forEach(e=>e.disconnect()),this.gainNodeList.forEach(e=>e.disconnect())}scale(e){return e/100}}class lT extends zn{constructor(){super("audioMixer",di.AliRtcSdkStreamTypeCapture,_s.AUDIO),W(this,"audioMixer"),W(this,"primaryAudioTrackId"),W(this,"screenAudioTrackId"),W(this,"dirty",!1),this.zIndex=8}get initOptions(){return{audio:1,screen:1}}setOptions(e){Object.entries(e).forEach(([n,o])=>{this.isValidVolume(o)&&(this.options[n]=o)}),this.dirty=!0,this.emit("updated")}isSupported(){return"AudioContext"in window}shouldUpdate(e,n){var o,u;if(e.type!==di.AliRtcSdkStreamTypeCapture)return!1;const g=n.find(s=>s.type===di.AliRtcSdkStreamTypeCapture),c=n.find(s=>s.type===di.AliRtcSdkStreamTypeScreen);return!(this.primaryAudioTrackId===((o=g?.currentAudioTrack)==null?void 0:o.id)&&this.screenAudioTrackId===((u=c?.currentAudioTrack)==null?void 0:u.id)&&!this.dirty)}process(e,n){return pe(this,null,function*(){var o,u;this.dirty=!1;const g=n.find(d=>d.type===di.AliRtcSdkStreamTypeScreen),c=e.currentAudioTrack,s=g?.currentAudioTrack;if(!s&&this.options.audio===1)return this.audioMixer&&(this.audioMixer.dispose(),this.audioMixer=void 0),this.primaryAudioTrackId=c?.id,void e.updateAudioTrack(c);this.audioMixer||(this.audioMixer=new cT),yield this.audioMixer.resume(),this.primaryAudioTrackId&&c?.id!==this.primaryAudioTrackId&&((o=this.audioMixer)==null||o.removeTrack(this.primaryAudioTrackId)),c&&!this.audioMixer.hasTrack(c?.id)&&this.audioMixer.addTrack(c),this.primaryAudioTrackId=c?.id,this.screenAudioTrackId&&s?.id!==this.screenAudioTrackId&&((u=this.audioMixer)==null||u.removeTrack(this.screenAudioTrackId)),s&&!this.audioMixer.hasTrack(s?.id)&&this.audioMixer.addTrack(s),this.screenAudioTrackId=s?.id,this.updateVolume(),e.updateAudioTrack(this.audioMixer.getAudioTrack())})}isValidVolume(e){return e!==void 0&&e>=0&&e<=4}updateVolume(){this.audioMixer&&(this.primaryAudioTrackId&&this.audioMixer.setVolume(100*this.options.audio,this.primaryAudioTrackId),this.screenAudioTrackId&&this.audioMixer.setVolume(100*this.options.screen,this.screenAudioTrackId))}clear(e){var n;(n=this.audioMixer)==null||n.dispose(),super.clear(e)}}class uT extends zn{constructor(){super(...arguments),W(this,"isProcessing",!1),W(this,"videoScaler")}get initOptions(){return{width:320,height:180,frameRate:15}}setOptions(e){var n;this.options=e,(n=this.videoScaler)==null||n.updateOptions(e)}isSupported(){return Lh.isSupport()}shouldUpdate(e){const n=!!e.currentVideoTrack;return this.isProcessing!==n}process(e){return pe(this,null,function*(){if(e.currentVideoTrack){if(this.isProcessing=!0,!this.videoScaler){const o=this.options||this.initOptions;this.videoScaler=Lh.getInstance(e.currentVideoTrack,o)}const n=this.videoScaler.getVideoTrack();n&&e.updateDualVideoTrack(n)}else this.isProcessing&&this.clear()})}clear(e){var n;super.clear(e),this.isProcessing=!1,e?.updateDualVideoTrack(),(n=this.videoScaler)==null||n.dispose()}}function sa(i,e,n,o){return new(n||(n=Promise))(function(u,g){function c(l){try{d(o.next(l))}catch(p){g(p)}}function s(l){try{d(o.throw(l))}catch(p){g(p)}}function d(l){var p;l.done?u(l.value):(p=l.value,p instanceof n?p:new n(function(S){S(p)})).then(c,s)}d((o=o.apply(i,[])).next())})}var xn,Pr;function by(){return sa(this,void 0,void 0,function*(){let i=!1;try{i=yield pe(this,null,function*(){return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]))})}catch{i=!1}return console.log("isSupportedSIMD",i),i})}typeof SuppressedError=="function"&&SuppressedError,(Pr=xn||(xn={}))[Pr.ERROR=0]="ERROR",Pr[Pr.WARN=1]="WARN",Pr[Pr.INFO=2]="INFO",Pr[Pr.LOG=3]="LOG",Pr[Pr.DEBUG=4]="DEBUG";class Vt{static error(...e){var n;Vt.logLevel>=xn.ERROR&&((n=console.error)===null||n===void 0||n.call(console,`[${Vt.logTag}] `,...e))}static warn(...e){var n;Vt.logLevel>=xn.WARN&&((n=console.warn)===null||n===void 0||n.call(console,`[${Vt.logTag}] `,...e))}static info(...e){var n;Vt.logLevel>=xn.INFO&&((n=console.info)===null||n===void 0||n.call(console,`[${Vt.logTag}] `,...e))}static log(...e){var n;Vt.logLevel>=xn.LOG&&((n=console.log)===null||n===void 0||n.call(console,`[${Vt.logTag}] `,...e))}static debug(...e){var n;Vt.logLevel>=xn.DEBUG&&((n=console.debug)===null||n===void 0||n.call(console,`[${Vt.logTag}] `,...e))}}Vt.logLevel=xn.WARN,Vt.logTag="aliyun-audio-3a";class dT{}class Ey extends dT{static isSupported(){return(function(){if(typeof window=="object"&&window!==null){const e="AudioWorklet"in window,n="WebAssembly"in window;return e&&n}return!1})()}static isSupportedSIMD(){return sa(this,void 0,void 0,function*(){return yield by()})}static setLogger(e){Vt.logLevel=e}constructor(e){super(),this.channelCount=1,this.sampleRate=48e3,this.collectDumpOutputData=[],this.collectDumpNearInputData=[],this.collectDumpFarInputData=[],this.collectDumpMetaData=[],this.statUpdateTimer=0,this.statUpdateInterval=5e3,this.options=Object.assign({aecOn:!0,ansOn:!0,agcOn:!0,hdOn:!1,ansMode:1,dumpOn:!1,aiaecOn:!1,wasmCdnPath:"https://g.alicdn.com/code/npm/@ali/aliyun-audio-3a/0.0.6/"},e||{})}initWASM(e,n,o){return sa(this,void 0,void 0,function*(){Vt.log("initWASM",e,n,o);const u=c=>sa(this,void 0,void 0,function*(){try{const s=yield fetch(c,{credentials:"same-origin"});return s.ok||this.onLoadError(new Error(`Failed to fetch WASM: ${s.status}:${s.statusText}, url:${c}`)),s.arrayBuffer()}catch(s){return this.onLoadError(new Error("WASM load error")),Vt.error("Error fetching WASM:",s),new Uint8Array(0)}}),g=c=>sa(this,void 0,void 0,function*(){return fetch(c).then(s=>s.text())});try{const c=yield by(),s=this.options.wasmCdnPath+"audio_module_v2.wasm",d=this.options.wasmCdnPath+"audio_module_v2_simd.wasm",l=yield u(c?d:s),p=this.options.wasmCdnPath+"audio_module_v2.js",S=this.options.wasmCdnPath+"audio_module_v2_simd.js",T=c?S:p,y=yield g(T);e.port.postMessage(Object.assign({type:"init",channelCount:n,sampleRate:o,wasmBuffer:l,isSupportSIMD:c,audioModuleScript:y,logLevel:Vt.logLevel},this.options),[l])}catch(c){Vt.error("Error initializing WASM:",c),this.onLoadError(new Error("WASM init error"))}e.port.onmessage=c=>{c.data.type==="init_done"&&this.onLoadSuccess(void 0),c.data.type==="dump_output_data"&&this.onDumpOutputData(c.data.data),c.data.type==="dump_near_data"&&this.onDumpNearInputData(c.data.data),c.data.type==="dump_far_data"&&this.onDumpFarInputData(c.data.data),c.data.type==="dump_meta_data"&&this.onDumpMeatData(c.data.data),c.data.type==="output_log"&&this.onOutputLog(c.data.data),c.data.type==="apm_stat_data"&&this.onStatData(c.data.data)}})}createProcessor(e,n,o,u,g){return sa(this,void 0,void 0,function*(){this.audioContext=e,this.audioContext.resume(),this.channelCount=o,this.sampleRate=u;try{const d=new Blob(['!function(){"use strict";function t(t,e,a,n){return new(a||(a=Promise))((function(s,i){function o(t){try{h(n.next(t))}catch(t){i(t)}}function r(t){try{h(n.throw(t))}catch(t){i(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof a?e:new a((function(t){t(e)}))).then(o,r)}h((n=n.apply(t,e||[])).next())}))}var e;"function"==typeof SuppressedError&&SuppressedError,function(t){t[t.ERROR=0]="ERROR",t[t.WARN=1]="WARN",t[t.INFO=2]="INFO",t[t.LOG=3]="LOG",t[t.DEBUG=4]="DEBUG"}(e||(e={}));class a{static error(...t){var n;a.logLevel>=e.ERROR&&(null===(n=console.error)||void 0===n||n.call(console,`[${a.logTag}] `,...t))}static warn(...t){var n;a.logLevel>=e.WARN&&(null===(n=console.warn)||void 0===n||n.call(console,`[${a.logTag}] `,...t))}static info(...t){var n;a.logLevel>=e.INFO&&(null===(n=console.info)||void 0===n||n.call(console,`[${a.logTag}] `,...t))}static log(...t){var n;a.logLevel>=e.LOG&&(null===(n=console.log)||void 0===n||n.call(console,`[${a.logTag}] `,...t))}static debug(...t){var n;a.logLevel>=e.DEBUG&&(null===(n=console.debug)||void 0===n||n.call(console,`[${a.logTag}] `,...t))}}a.logLevel=e.WARN,a.logTag="aliyun-audio-3a";const n=Float32Array.BYTES_PER_ELEMENT,s=Uint16Array.BYTES_PER_ELEMENT;class i{constructor(t,e,a,n,s){this._channelData=[],this._name=t,this._isInitialized=!1,this._module=e,this._length=a,this._ringLength=2*a,this._maxChannelCount=s?Math.min(s,32):n,this._channelCount=n,this._allocateHeap(),this._isInitialized=!0,this._readIndex=0,this._writeIndex=0,this._framesAvailable=0,this._channelDataLocal=[];for(let t=0;t<this._channelCount;++t)this._channelDataLocal[t]=new Float32Array(this._ringLength)}_allocateHeap(){const t=this._length*n,e=this._channelCount*t;this._dataPtr=this._module._malloc(e),this._channelData=[];for(let e=0;e<this._channelCount;++e){const a=this._dataPtr+e*t,n=a+t;this._channelData[e]=this._module.HEAPF32.subarray(a>>s,n>>s)}}adaptChannel(t){t<this._maxChannelCount&&(this._channelCount=t)}get length(){return this._isInitialized?this._length:null}get numberOfChannels(){return this._isInitialized?this._channelCount:null}get maxChannelCount(){return this._isInitialized?this._maxChannelCount:null}getChannelData(t){return void 0!==t&&t>=this._channelCount?null:void 0===t?this._channelData:this._channelData[t]}getHeapAddress(){return this._dataPtr}getPointer(){return this._dataPtr}free(){this._isInitialized=!1,null!==this._dataPtr&&this._module._free(this._dataPtr),this._channelData=[]}get framesAvailable(){return this._framesAvailable}push(t){const e=t[0].length;for(let a=0;a<e;++a){for(let e=0;e<this._channelCount;++e)this._channelDataLocal[e][this._writeIndex]=t[e][a];this._writeIndex=(this._writeIndex+1)%this._ringLength}this._framesAvailable+=e,this._framesAvailable>this._ringLength&&(console.warn(this._name,"Too many frames available, overflow"),this._framesAvailable=this._ringLength,this._writeIndex=0)}pull(t){if(0===this._framesAvailable)return void console.warn(this._name,"No frames available");const e=t[0].length;for(let a=0;a<e;++a){for(let e=0;e<this._channelCount;++e)t[e][a]=this._channelDataLocal[e][this._readIndex];this._readIndex=(this._readIndex+1)%this._ringLength}this._framesAvailable-=e,this._framesAvailable<0&&(this._framesAvailable=0,this._readIndex=0)}}class o{constructor(t){this.inited=!1,this.handle=null,this.channelCount=1,this.isEnable=!0,this.dumpAudioData=!1,this.kernelBufferSize=512,this.node=t,this.onDumpOutputDataFunction=null,this.onDumpNearDataFunction=null,this.onDumpFarDataFunction=null,this.onDumpMetaDataFunction=null,this.wasmInvoker=null,this._nearAudioBuffer={},this._outputAudioBuffer={}}destructor(){this.wasmInvoker=null,this.handle=null}init(n){return t(this,void 0,void 0,(function*(){const{wasmBuffer:t,audioModuleScript:s,channelCount:o=1,sampleRate:r=44100,dumpAudioData:h=!1,logLevel:l=e.DEBUG}=n;a.logLevel=l,a.log("AudioAPM init",JSON.stringify(n)),this.channelCount=o,this.dumpAudioData=h;try{const e=new Function(`let module={};let exports={};${s}; return module`)();this.wasmInvoker=yield e.exports({wasmBinary:t})}catch(t){this.node.port.postMessage({type:"error",message:"audioModule init error"}),a.error(t)}this._nearAudioBuffer=new i("inBuffer",this.wasmInvoker,this.kernelBufferSize,2*this.channelCount,32),this._outputAudioBuffer=new i("outBuffer",this.wasmInvoker,this.kernelBufferSize,this.channelCount,32);const u=this.wasmInvoker.addFunction(((t,e)=>{const a=this.wasmInvoker.HEAPU8.subarray(t,t+e),n=String.fromCharCode.apply(null,a);this.node&&this.node.port&&this.node.port.postMessage({type:"output_log",message:"output_log",data:n})}),"vii");if(this.wasmInvoker.__apm_log_callback(u),this.handle=this.wasmInvoker.__apm_create(n.aecOn?1:0,n.ansOn?1:0,n.agcOn?1:0,n.hdOn?1:0,r,o,n.dumpOn?1:0,this.kernelBufferSize),n.aiaecOn){const t=102;this.wasmInvoker.__apm_set_param(this.handle,t,7)}if(n.useHardOnly){const t=108;this.wasmInvoker.__apm_set_param(this.handle,t,1)}this.node.port.postMessage({type:"init_done",message:"init done"}),this.inited=!0}))}getStatData(){if(this.wasmInvoker&&this.isEnable){let t=this.wasmInvoker.__apm_get_stat(this.handle),e=this.wasmInvoker.UTF8ToString(t);this.wasmInvoker._free(t),this.node&&this.node.port&&this.node.port.postMessage({type:"apm_stat_data",message:"apm_stat_data",data:e})}}onOutputLog(t){console.log("[WASM_LOG]",t)}destory(){return t(this,void 0,void 0,(function*(){var t;try{null===(t=this.wasmInvoker)||void 0===t||t.__apm_destory(this.handle),this.inited=!1}catch(t){a.error(t)}finally{this.handle=null}}))}enable(){this.isEnable=!0,a.log("APM enable")}disable(){this.isEnable=!1,a.log("APM disable")}getStat(){if(null==this.wasmInvoker||null==this.handle)return"";let t=this.wasmInvoker.__apm_get_stat(this.handle),e=this.wasmInvoker.UTF8ToString(t);return this.wasmInvoker._free(t),e}startDump(){this.onDumpOutputDataFunction=this.wasmInvoker.addFunction(((t,e)=>{const a=this.wasmInvoker.HEAPU8.subarray(t,t+e),n=new Uint8Array(a);this.node&&this.node.port&&this.node.port.postMessage({type:"dump_output_data",message:"dump_output_data",data:n})}),"vii"),this.onDumpNearDataFunction=this.wasmInvoker.addFunction(((t,e)=>{const a=this.wasmInvoker.HEAPU8.subarray(t,t+e),n=new Uint8Array(a);this.node&&this.node.port&&this.node.port.postMessage({type:"dump_near_data",message:"dump_near_data",data:n})}),"vii"),this.onDumpFarDataFunction=this.wasmInvoker.addFunction(((t,e)=>{const a=this.wasmInvoker.HEAPU8.subarray(t,t+e),n=new Uint8Array(a);this.node&&this.node.port&&this.node.port.postMessage({type:"dump_far_data",message:"dump_far_data",data:n})}),"vii"),this.onDumpMetaDataFunction=this.wasmInvoker.addFunction(((t,e)=>{const a=this.wasmInvoker.HEAPU8.subarray(t,t+e),n=new Uint8Array(a);this.node&&this.node.port&&this.node.port.postMessage({type:"dump_meta_data",message:"dump_meta_data",data:n})}),"vii"),this.wasmInvoker.__apm_dump_start(this.handle,this.onDumpOutputDataFunction,this.onDumpNearDataFunction,this.onDumpFarDataFunction,this.onDumpMetaDataFunction)}stopDump(){this.wasmInvoker.__apm_dump_stop(this.handle),this.wasmInvoker&&(this.wasmInvoker.removeFunction(this.onDumpOutputDataFunction),this.wasmInvoker.removeFunction(this.onDumpNearDataFunction),this.wasmInvoker.removeFunction(this.onDumpFarDataFunction),this.wasmInvoker.removeFunction(this.onDumpMetaDataFunction))}process(t,e,a){if(!this.inited||!this.isEnable){for(let e=0;e<this.channelCount;e++){a[e].set(t[e])}return}const n=this.channelCount;let s=0;if(this.handle&&this.isEnable){const i=t[0].length,o=[];for(let a=0;a<n;a++)e[a]&&e[a].length>0&&(s=1),o.push(t[a]||new Float32Array(i).fill(0)),o.push(e[a]||new Float32Array(i).fill(0));if(this._nearAudioBuffer.push(o),this._nearAudioBuffer.framesAvailable>=this.kernelBufferSize){this._nearAudioBuffer.pull(this._nearAudioBuffer.getChannelData()),this.wasmInvoker.__apm_process_new(this.handle,this._nearAudioBuffer.getHeapAddress(),this._outputAudioBuffer.getHeapAddress(),n,s);const t=this._outputAudioBuffer.getChannelData();this._outputAudioBuffer.push(t)}this._outputAudioBuffer.pull(a)}}}class r extends AudioWorkletProcessor{constructor(){super(),this.apm=new o(this),this.port.onmessage=t=>{const e=t.data||{};switch(a.log("onmessage data",e),e.type){case"init":this.apm.init(e);break;case"destroy":this.apm.destory();break;case"enable":this.apm.enable();break;case"disable":this.apm.disable();break;case"start_dump":this.apm.startDump();break;case"stop_dump":this.apm.stopDump();break;case"get_stat_data":this.apm.getStatData();break;default:a.warn("Unknown message type:",e.type)}}}process(t,e){const a=t[0],n=t.length>1?t[1]:[],s=e[0];return this.apm.process(a,n,s),!0}}registerProcessor("aliyun-web-3a-processor",r)}();\n'],{type:"application/javascript"}),l=URL.createObjectURL(d);yield this.audioContext.audioWorklet.addModule(l)}catch(d){Vt.error("Failed to add module to audio worklet:",d)}let c=new AudioWorkletNode(this.audioContext,"aliyun-web-3a-processor",{numberOfInputs:2,outputChannelCount:[o]});this.workletNode=c,n.connect(c),g&&(this.farNode=g,g.connect(c,0,1));const s=this.audioContext.createMediaStreamDestination();c.connect(s),this.targetMediaTrack=s.stream.getAudioTracks()[0],yield this.initWASM(c,o,u),this.statUpdateTimer=window.setInterval(()=>{this.getStatData()},this.statUpdateInterval)})}addFarNode(e){this.workletNode&&(this.farNode&&this.farNode.disconnect(this.workletNode),e&&(this.farNode=e,e.connect(this.workletNode,0,1)))}getStatData(){var e;try{(e=this.workletNode)===null||e===void 0||e.port.postMessage({type:"get_stat_data"})}catch(n){Vt.error("Failed to post message to worklet node:",n)}}destroy(){if(this.statUpdateTimer&&window.clearInterval(this.statUpdateTimer),this.audioContext&&this.workletNode&&this.workletNode.port)try{this.workletNode.port.postMessage({type:"destroy"}),this.workletNode.port.onmessage=null,this.workletNode.disconnect(),Vt.log("postMessage destroy")}catch(e){Vt.error("Failed to post message to worklet node:",e)}}startDump(){var e;try{(e=this.workletNode)===null||e===void 0||e.port.postMessage({type:"start_dump"})}catch(n){Vt.error("Failed to post message to worklet node:",n)}}stopDump(){var e;try{(e=this.workletNode)===null||e===void 0||e.port.postMessage({type:"stop_dump"})}catch(n){Vt.error("Failed to post message to worklet node:",n)}setTimeout(()=>{this.onDumpOutputData(null,!0),this.onDumpNearInputData(null,!0),this.onDumpFarInputData(null,!0),this.onDumpMeatData(null,!0)},3e3)}onDumpOutputData(e,n=!1){if(e&&e.length>0&&this.collectDumpOutputData.push(e),n&&this.collectDumpOutputData.length>0||1024*this.collectDumpOutputData.length>=this.getMaxDumpBytes()){let o=new Blob(this.collectDumpOutputData);this.onDumpData(o,"output_"+this.sampleRate+"hz_"+this.channelCount+"ch.pcm"),this.collectDumpOutputData=[]}}onDumpNearInputData(e,n=!1){if(e&&e.length>0&&this.collectDumpNearInputData.push(e),n&&this.collectDumpNearInputData.length>0||1024*this.collectDumpNearInputData.length>=this.getMaxDumpBytes()){let o=new Blob(this.collectDumpNearInputData);this.onDumpData(o,"near_input_"+this.sampleRate+"hz_"+this.channelCount+"ch.pcm"),this.collectDumpNearInputData=[]}}onDumpFarInputData(e,n=!1){if(e&&e.length>0&&this.collectDumpFarInputData.push(e),n&&this.collectDumpFarInputData.length>0||1024*this.collectDumpFarInputData.length>=this.getMaxDumpBytes()){let o=new Blob(this.collectDumpFarInputData);this.onDumpData(o,"far_input_"+this.sampleRate+"hz_"+this.channelCount+"ch.pcm"),this.collectDumpFarInputData=[]}}onDumpMeatData(e,n=!1){if(e&&e.length>0&&this.collectDumpMetaData.push(e),n&&this.collectDumpMetaData.length>0||1024*this.collectDumpMetaData.length>=this.getMaxDumpBytes()){let o=new Blob(this.collectDumpMetaData);this.onDumpData(o,"meta_"+this.sampleRate+"hz_"+this.channelCount+"ch.pcm"),this.collectDumpMetaData=[]}}getMaxDumpBytes(){return 600*Number(this.sampleRate.toFixed(0))*Number(this.channelCount.toFixed(0))*2}enable(){var e;if(!((e=this.workletNode)===null||e===void 0)&&e.port)try{this.workletNode.port.postMessage({type:"enable"}),Vt.log("postMessage enable")}catch(n){Vt.error("Failed to post message to worklet node:",n)}}disable(){var e;if(!((e=this.workletNode)===null||e===void 0)&&e.port)try{Vt.log("postMessage disable"),this.workletNode.port.postMessage({type:"disable"})}catch(n){Vt.error("Failed to post message to worklet node:",n)}}on(e,n){e==="loaderror"&&(this.onLoadError=n),e==="loadsuccess"&&(this.onLoadSuccess=n),e==="dumpdata"&&(this.onDumpData=n),e==="outputlog"&&(this.onOutputLog=n),e==="statdata"&&(this.onStatData=n)}onLoadError(e){console.log("onLoadError",e)}onLoadSuccess(e){console.log("onLoadSuccess",e)}onDumpData(e,n){console.log("onDumpData",e,n)}onOutputLog(e){console.log("[WASM]",e)}onStatData(e){console.log("onStatData:",e)}}class hT extends zn{constructor(e){super("AliRtcAudioProcessPlugin",di.AliRtcSdkStreamTypeCapture,_s.AUDIO),W(this,"audioProcessor"),W(this,"slsReporter"),W(this,"enableSoft3ACheck",!1),W(this,"useHardOnly",!1),W(this,"lastDiffOutputLog",""),W(this,"audioContext",new AudioContext({sampleRate:48e3})),W(this,"farNode"),W(this,"createNode",n=>this.audioContext.createMediaStreamSource(new MediaStream([n]))),this.options=e,this.slsReporter=e?.slsReporter,this.enableSoft3ACheck=e?.enableSoft3ACheck||!1,this.useHardOnly=e?.useHardOnly||!1,this.zIndex=7,document.addEventListener("click",this.activeAudioContext)}activeAudioContext(){var e;(e=this.audioContext)==null||e.resume(),document.removeEventListener("click",this.activeAudioContext)}audioUpdated(e){var n,o;return((n=this.lastInputAudioTrack)==null?void 0:n.id)!==((o=e.currentAudioTrack)==null?void 0:o.id)}videoUpdated(e){return console.log("videoUpdated",e),!1}setOptions(e){var n;!this.farNode&&e.farMediaStream&&(this.farNode=this.audioContext.createMediaStreamSource(e.farMediaStream),this.audioProcessor&&((n=this.audioProcessor)==null||n.addFarNode(this.farNode)),this.options=Qe(Qe({},this.options),e))}isSupported(){return Ey.isSupported()}shouldUpdate(e){return!!(e.originAudioTrack&&!this.audioProcessor||!e.originAudioTrack&&this.audioProcessor)}process(e){return pe(this,null,function*(){var n;if(!e.currentAudioTrack)return e.updateAudioTrack(),void this.clear(e);if(!this.audioProcessor){this.audioProcessor=new Ey({aecOn:!0,ansOn:!0,agcOn:!0,dumpOn:((n=this.options)==null?void 0:n.dumpAudioData)||!1,aiaecOn:this.options.aiaecOn||!1,useHardOnly:this.useHardOnly,wasmCdnPath:this.options.wasmCdnPath||"https://g.alicdn.com/code/npm/@ali/aliyun-audio-3a/0.0.6/"}),this.audioProcessor.on("dumpdata",(u,g)=>{let c=3e3;g.includes("far")?c=5e3:g.includes("output")?c=1e4:g.includes("meta")&&(c=8e3),setTimeout(()=>{const s=URL.createObjectURL(u),d=document.createElement("a");d.href=s,d.download=g,document.body.appendChild(d),d.click(),document.body.removeChild(d)},c)}),this.audioProcessor.on("loadsuccess",()=>{var u,g;this.enableSoft3ACheck||e.updateAudioTrack((u=this.audioProcessor)==null?void 0:u.targetMediaTrack),this.options.dumpAudioData&&((g=this.audioProcessor)==null||g.startDump())}),this.audioProcessor.on("loaderror",u=>{this.emit("error",u)}),this.audioProcessor.on("outputlog",u=>{u!=null&&u.includes("diff")&&(this.lastDiffOutputLog=u||"")}),this.audioProcessor.on("statdata",u=>{var g;if(u)try{let c=u;if(this.lastDiffOutputLog){const s=this.extractDiffValue(this.lastDiffOutputLog),d=JSON.parse(u);s!==null&&(d.diff=s);const l=this.extractLeakValue(this.lastDiffOutputLog);l!==null&&(d.leak=l),c=JSON.stringify(d)}(g=this.slsReporter)==null||g.reportPublishAudio3A("","","",c)}catch{}});const o=this.createNode(e.currentAudioTrack);yield this.audioProcessor.createProcessor(this.audioContext,o,1,48e3,this.farNode)}})}extractDiffValue(e){if(!e)return null;const n=e.match(/diff\s*=\s*(-?\d+\.?\d*)/);return n?parseFloat(n[1]):null}extractLeakValue(e){if(!e)return null;const n=e.match(/leak\s*=\s*(-?\d+\.?\d*)/);return n?parseFloat(n[1]):null}clear(e){var n,o,u;this.options.dumpAudioData&&((n=this.audioProcessor)==null||n.stopDump()),super.clear(e),(o=this.audioProcessor)==null||o.destroy(),this.audioProcessor=void 0,document.removeEventListener("click",this.activeAudioContext),(u=this.farNode)==null||u.disconnect(),this.farNode=void 0}dump(){var e;(e=this.audioProcessor)==null||e.stopDump()}}var hl=(i=>(i[i.Default=0]="Default",i[i.Human=1]="Human",i[i.Robot=2]="Robot",i))(hl||{}),fT=Object.defineProperty,pT=Object.getOwnPropertyDescriptor,Ry=(i,e,n,o)=>{for(var u,g=pT(e,n),c=i.length-1;c>=0;c--)(u=i[c])&&(g=u(e,n,g)||g);return g&&fT(e,n,g),g},aa;const Vh=(aa=class extends Ei{constructor(i,e){super(),W(this,"self"),W(this,"remoteUser"),W(this,"sendReadyMsg",!1),W(this,"hasPubDataChannel",!1),W(this,"hasSubDataChannel",!1),W(this,"readyMsgSuccess",!1),W(this,"sendReadyMsgTimer"),W(this,"startReadyMsgTime"),W(this,"robotUserId"),W(this,"onSubscribeDataChannel",n=>{!this.remoteUser&&n&&(this.robotUserId&&this.robotUserId!==n.userId||(this.hasSubDataChannel=!0,this.remoteUser=n,this.remoteUser.on("remoteDataChannelMessage",this.onCheckReadyMsg),this.trySendReadyMsg()))}),W(this,"onCheckReadyMsg",(n,o)=>{var u,g;if(this.sendReadyMsg&&!this.readyMsgSuccess)try{const c=new TextDecoder().decode(o.data),s=JSON.parse(c);s.key==="aliyun_aigc"&&s.type==="ready_resp"&&((u=s.data)==null?void 0:u.ready)===!0&&(ke.event(`[${aa.logName}]`,"onCheckReadyMsg success"),this.readyMsgSuccess=!0,this.emit("dcready",n),(g=this.remoteUser)==null||g.off("remoteDataChannelMessage",this.onCheckReadyMsg),window.clearTimeout(this.sendReadyMsgTimer))}catch{}}),W(this,"onDataPublishStateChange",(n,o)=>{o===tt.AliRtcStatePublished&&(this.hasPubDataChannel=!0,this.trySendReadyMsg())}),this.self=i,this.self.on("dataPublishStateChanged",this.onDataPublishStateChange),this.robotUserId=e}destroy(){this.self.off("dataPublishStateChanged",this.onDataPublishStateChange),window.clearTimeout(this.sendReadyMsgTimer),this.remoteUser=void 0,this.sendReadyMsg=!1,this.hasPubDataChannel=!1,this.hasSubDataChannel=!1,this.readyMsgSuccess=!1,this.startReadyMsgTime=0}trySendReadyMsg(){ke.event(`[${aa.logName}]`,`trySendReadyMsg: pub(${this.hasPubDataChannel}, sub: ${this.hasSubDataChannel})`),this.hasPubDataChannel&&this.hasSubDataChannel&&(this.sendReadyMsg=!0,this.sendReadyMsgLoop())}sendReadyMsgLoop(i=0){return pe(this,null,function*(){const e=JSON.stringify({key:"aliyun_aigc",version:"1.0",type:"ready_req",data:{ready:!0}});try{this.self.sendDataChannelMessage(new mo(new TextEncoder().encode(e).buffer))}catch{}this.startReadyMsgTime||(this.startReadyMsgTime=Date.now());let n=50;const o=Date.now()-this.startReadyMsgTime;n=o<1e3?50:o<2e3?100:o<3e3?500:2e3,i>30?ke.event(`[${aa.logName}]`,"sendReadyMsgLoop fail after 30 times"):this.sendReadyMsgTimer=window.setTimeout(()=>{this.sendReadyMsgLoop(i+1)},n)})}},W(aa,"logName","DataChannelReadyHelper"),aa);Ry([ge()],Vh.prototype,"destroy"),Ry([ge()],Vh.prototype,"sendReadyMsgLoop");let mT=Vh;class gT{constructor(e){W(this,"_useSysEchoCancellation",!0),W(this,"_useSysNoiseSuppression",!0),W(this,"_useSysAutoGainControl",!0),W(this,"_useAIAEC",!1),W(this,"_enableSoft3A",!1),W(this,"_enableSoft3ACheck",!1),W(this,"_useHardOnly",!1),W(this,"_dumpAudioData",!1),W(this,"_useAudio3AConfigFromServer",!0),e&&Object.assign(this,e)}get useSysEchoCancellation(){return this._useSysEchoCancellation}set useSysEchoCancellation(e){this._useSysEchoCancellation=e}get useSysNoiseSuppression(){return this._useSysNoiseSuppression}set useSysNoiseSuppression(e){this._useSysNoiseSuppression=e}get useSysAutoGainControl(){return this._useSysAutoGainControl}set useSysAutoGainControl(e){this._useSysAutoGainControl=e}get useAIAEC(){return this._useAIAEC}set useAIAEC(e){this._useAIAEC=e}get enableSoft3A(){return this._enableSoft3A}set enableSoft3A(e){this._enableSoft3A=e}get enableSoft3ACheck(){return this._enableSoft3ACheck}set enableSoft3ACheck(e){this._enableSoft3ACheck=e}get useHardOnly(){return this._useHardOnly}set useHardOnly(e){this._useHardOnly=e}get dumpAudioData(){return this._dumpAudioData}set dumpAudioData(e){this._dumpAudioData=e}get useAudio3AConfigFromServer(){return this._useAudio3AConfigFromServer}set useAudio3AConfigFromServer(e){this._useAudio3AConfigFromServer=e}loadFromLocalConfig(e){var n,o,u,g,c,s,d,l,p;this.useAudio3AConfigFromServer=(n=e.useAudio3AConfigFromServer)!=null?n:this.useAudio3AConfigFromServer,this.useSysEchoCancellation=(o=e.useSysEchoCancellation)!=null?o:this.useSysEchoCancellation,this.useSysNoiseSuppression=(u=e.useSysNoiseSuppression)!=null?u:this.useSysNoiseSuppression,this.useSysAutoGainControl=(g=e.useSysAutoGainControl)!=null?g:this.useSysAutoGainControl,this.useAIAEC=(c=e.useAIAEC)!=null?c:this.useAIAEC,this.enableSoft3A=(s=e.enableSoft3A)!=null?s:this.enableSoft3A,this.dumpAudioData=(d=e.dumpAudioData)!=null?d:this.dumpAudioData,this.enableSoft3ACheck=(l=e.enableSoft3ACheck)!=null?l:this.enableSoft3ACheck,this.useHardOnly=(p=e.useHardOnly)!=null?p:this.useHardOnly}loadFromServerConfig(e){if(e&&typeof e=="object"){const n=uo(e,"enableSoft3A"),o=ra(e,"enableSoft3A");if(n===!0&&o===!0&&(this.enableSoft3A=!0),this.enableSoft3A){if(e.archCfgs){const u=uo(e,"enableSoft3ACheck");u!==void 0&&(this.enableSoft3ACheck=u);const g=uo(e,"useAIAEC");g!==void 0&&(this.useAIAEC=g);const c=uo(e,"useSysNoiseSuppression");c!==void 0&&(this.useSysNoiseSuppression=c);const s=uo(e,"useSysEchoCancellation");s!==void 0&&(this.useSysEchoCancellation=s);const d=uo(e,"useSysAutoGainControl");d!==void 0&&(this.useSysAutoGainControl=d)}if(e.config){const u=ra(e,"enableSoft3ACheck");u!==void 0&&(this.enableSoft3ACheck=u);const g=ra(e,"useAIAEC");g!==void 0&&(this.useAIAEC=g);const c=ra(e,"useSysNoiseSuppression");c!==void 0&&(this.useSysNoiseSuppression=c);const s=ra(e,"useSysEchoCancellation");s!==void 0&&(this.useSysEchoCancellation=s);const d=ra(e,"useSysAutoGainControl");d!==void 0&&(this.useSysAutoGainControl=d)}ke.info("setAudio3AConfig:","enableSoft3A",this.enableSoft3A,", enableSoft3ACheck",this.enableSoft3ACheck,", useAIAEC",this.useAIAEC,", useSysNoiseSuppression",this.useSysNoiseSuppression,", useSysEchoCancellation",this.useSysEchoCancellation,", useSysAutoGainControl",this.useSysAutoGainControl)}}}}var vT=Object.defineProperty,yT=Object.getOwnPropertyDescriptor,Wi=(i,e,n,o)=>{for(var u,g=yT(e,n),c=i.length-1;c>=0;c--)(u=i[c])&&(g=u(e,n,g)||g);return g&&vT(e,n,g),g};class Ii extends Ei{constructor(e){super(),W(this,"self"),W(this,"userMap",{}),W(this,"usersViewMap",{}),W(this,"rtsManager"),W(this,"localStreamManager"),W(this,"authInfo"),W(this,"signalingManager"),W(this,"pluginManager"),W(this,"audioMixerPlugin"),W(this,"dualVideoPlugin"),W(this,"blankAudioPlugin"),W(this,"audioProcessorPlugin"),W(this,"slsReporter"),W(this,"statsMonitorId"),W(this,"autoSubAudio",!0),W(this,"autoSubVideo",!0),W(this,"autoSubScreen",!0),W(this,"wantSubAudio",!0),W(this,"wantSubVideo",!0),W(this,"wantSubScreen",!0),W(this,"defaultStreamType",Di.AliRtcVideoStreamTypeHigh),W(this,"audioMuted",!1),W(this,"playoutVolume",1),W(this,"refreshUrlTimer"),W(this,"audioVolumeIndicationInterval",0),W(this,"indicationTimer",0),W(this,"parameter",{}),W(this,"audio3AConfig",new gT),W(this,"dcReadyHelper");const{signalingManager:n,slsReporter:o,parameter:u}=e;this.signalingManager=n,this.addSignalingManagerListener(),this.slsReporter=o,u&&(this.parameter=u),this.pluginManager=new Q_,this.localStreamManager=new rT(this.pluginManager,this.slsReporter),this.rtsManager=new eT(this.localStreamManager,this.slsReporter,this.parameter),this.addRTSListener(),this.self=new G_({rtsManager:this.rtsManager,localStreamManager:this.localStreamManager,slsReporter:this.slsReporter,signalingManager:this.signalingManager,pluginManager:this.pluginManager,audioVolumeIndicationInterval:this.audioVolumeIndicationInterval,parameter:this.parameter}),this.audioMixerPlugin=new lT,this.pluginManager.add(this.audioMixerPlugin),this.dualVideoPlugin=new uT("dualVideoPlugin"),new wt.AliRTS.SupportUtil().checkScreenCapture()&&this.pluginManager.add(new aT)}addSignalingManagerListener(){this.signalingManager.on("onNotifyPublish",e=>{e.forEach(n=>{var o;(o=n?.tracks)==null||o.forEach(u=>{var g;if(u.msid===De.Audio&&u.userdata)try{const c=JSON.parse(u.userdata);c.agent_instance&&((g=this.slsReporter)==null||g.setCustomFields({ageniid:c.agent_instance}))}catch(c){console.error("Failed to parse userdata:",c)}})}),this.slsReporter.reportConnectionLatencyEvent(nr.RECV_NOTIFY_PUBLISH,"","",""),ke.event("[Signaling] Notify Publish ",e),e.forEach(n=>{this.onRemotePublishStateChange(n)})}),this.signalingManager.stsManager.on("onTokenUpdate",(e,n)=>{this.slsReporter.updateToken(n,e)})}addRTSListener(){this.rtsManager.on("traceIdUpdated",(e,n)=>{if(ei.removeQueryString(this.self.url)===ei.removeQueryString(e))return void(this.self.traceId=n);const o=this.remoteUsers.find(u=>ei.removeQueryString(u.streamUrl)===ei.removeQueryString(e));o&&(o.traceId=n)}),this.rtsManager.on("reconnect",(e,n,o)=>{if(!e||e==="pc"||e==="all")return this.self.markReconnect(),void this.remoteUsers.forEach(g=>{g.markReconnect()});if(e==="pub"||e==="pub-data")return void this.self.markReconnect(o);const u=this.remoteUsers.find(g=>ei.removeQueryString(g.streamUrl)===ei.removeQueryString(n||""));u?.markReconnect(o)}),this.rtsManager.on("reconnectFinish",(e,n,o)=>{if(ke.event("[RtsManager]","reconnectFinish",e,n,o),!e||e==="pc"||e==="all")return this.self.markReconnected(),void this.remoteUsers.forEach(g=>{g.markReconnected()});if(e==="pub"||e==="pub-data")return void this.self.markReconnected(o);const u=this.remoteUsers.find(g=>ei.removeQueryString(g.streamUrl)===ei.removeQueryString(n||""));u?.markReconnected(o)})}isAutoSubAudio(){return this.autoSubAudio}setAutoSubAudio(e){this.autoSubAudio=e}isAutoSubVideo(){return this.autoSubVideo}setAutoSubVideo(e){this.autoSubVideo=e}isAutoSubScreen(){return this.autoSubScreen}setAutoSubScreen(e){this.autoSubScreen=e}isWantSubAudio(){return this.wantSubAudio}setWantSubAudio(e){this.wantSubAudio=e,this.remoteUsers.forEach(n=>{n.setWantSubAudio(e),n.updateSubscribe(Ht.User)})}isWantSubVideo(){return this.wantSubVideo}setWantSubVideo(e){this.wantSubVideo=e,this.remoteUsers.forEach(n=>{n.setWantSubVideo(e),n.updateSubscribe(Ht.User)})}isWantSubScreen(){return this.wantSubScreen}setWantSubScreen(e){this.wantSubScreen=e,this.remoteUsers.forEach(n=>{n.setWantSubScreen(e),n.updateSubscribe(Ht.User)})}setRemoteDefaultVideoStreamType(e){this.defaultStreamType=e,this.remoteUsers.forEach(n=>{n.setRemoteDefaultVideoStreamType(e)})}setRemoteUserVideoStreamType(e,n){var o;(o=this.getRemoteUser(e))==null||o.setRemoteDefaultVideoStreamType(n)}setAudioMuted(e){this.audioMuted=e,this.remoteUsers.forEach(n=>{n.setAudioMuted(e)})}setLocalViewConfig(e,n){if(!e)return this.publisher.setViewConfig(null,n);const o=Ph(e);o.length!==0&&o.forEach(u=>{this.publisher.resetElement(u),Object.values(this.usersViewMap).forEach(({cameraViews:g=[],screenViews:c=[]})=>{g.includes(u)&&g.splice(g.indexOf(u),1),c.includes(u)&&c.splice(c.indexOf(u),1)}),this.publisher.setViewConfig(o,n)})}setRemoteViewConfig(e,n,o){var u,g;if(!n)return(u=this.userMap[e])==null?void 0:u.setViewConfig(null,o);const c=Ph(n);c.length!==0&&(c.forEach(s=>{this.publisher.resetElement(s),Object.values(this.usersViewMap).forEach(({cameraViews:d=[],screenViews:l=[]})=>{d.includes(s)&&d.splice(d.indexOf(s),1),l.includes(s)&&l.splice(l.indexOf(s),1)})}),(g=this.userMap[e])==null||g.setViewConfig(c,o))}get channel(){var e;return(e=this.authInfo)==null?void 0:e.channelId}get userId(){var e;return(e=this.authInfo)==null?void 0:e.userId}get remoteUsers(){return Object.values(this.userMap)}get publisher(){return this.self}get isSubscribing(){var e;return((e=this.remoteUsers)!=null?e:[]).some(n=>{const{isAudioSubscribing:o,isVideoSubscribing:u,isScreenSubscribing:g}=n;return o||u||g})}onRemotePublishStateChange(e,n=!0){var o;const{userid:u,callid:g,subscribe:c,pubid:s="",tracks:d}=e,l=(o=c?.pullstreamurl)!=null?o:"";let p=this.getRemoteUser(u);if(!p)return;const S=p.streamInfo.audioTrackInfo,T=p.streamInfo.videoTrackInfo;p.updateRemoteTracks(g,l,s,d),S===p.streamInfo.audioTrackInfo&&T===p.streamInfo.videoTrackInfo||this.emit("remoteTrackAvailableChange",u,p.streamInfo.audioTrackInfo,p.streamInfo.videoTrackInfo),n&&p.updateSubscribe(Ht.Publish)}setTimeoutToUpdateAllStreamUrls(e){var n;if(!e)return;let o=354e4;const u=(n=(function(g){var c,s;try{const d=new URL(g),[l,p]=d.pathname.slice(1).split("/"),S=/(\w+)(web\w{5}-\w{4}-\w{4}-\w{4}-\w{12})/.exec(p),T=S?.[1],y=S?.[2],R=new URLSearchParams(d.search);return{appId:l,channelId:T,sessionId:y,timeoutTs:1e3*parseInt((s=(c=R.get("auth_key"))==null?void 0:c.split("-")[0])!=null?s:"0")}}catch{return null}})(e))==null?void 0:n.timeoutTs;u&&(o=u-Date.now()-6e4),this.refreshUrlTimer=window.setTimeout(()=>pe(this,null,function*(){var g;const c=yield this.signalingManager.refreshUrl({pushstreamurl:this.self.url,users:this.remoteUsers.map(s=>({userid:s.userId,subscribe:{pullstreamurl:s.streamUrl}}))});c.pushstreamurl&&(this.self.url=c.pushstreamurl),(g=c.users)==null||g.forEach(s=>{var d;const l=this.getRemoteUser(s.userid);l&&(d=s.subscribe)!=null&&d.pullstreamurl&&(l.streamUrl=s.subscribe.pullstreamurl)}),this.setTimeoutToUpdateAllStreamUrls(c.pushstreamurl)}),o)}init(e,n,o){var u;this.authInfo=e,this.self.enableAudioVolumeIndication(this.audioVolumeIndicationInterval),this.self.initInfo(e,n.pushstreamurl),this.audio3AConfig.useAudio3AConfigFromServer&&this.audio3AConfig.loadFromServerConfig((u=n?.config)==null?void 0:u.data),this.setupAudioProcessingPluginIfNeeded(),o.capabilityProfile===hl.Human&&(this.dcReadyHelper=new mT(this.self,o.robotUserId),this.dcReadyHelper.on("dcready",g=>{var c;this.emit("remoteUserSubscribedDataChannel",g),(c=this.dcReadyHelper)==null||c.destroy(),this.dcReadyHelper=void 0})),this.setTimeoutToUpdateAllStreamUrls(n.pushstreamurl),n.users.forEach(g=>{this.addUser(g,Ht.InRoom)}),this.startStatsMonitor()}leave(){return pe(this,null,function*(){var e;this.stopStatsMonitor(),this.refreshUrlTimer!==void 0&&(window.clearTimeout(this.refreshUrlTimer),this.refreshUrlTimer=void 0),Object.values(this.usersViewMap).forEach(({cameraViews:n=[],screenViews:o=[]})=>{n.forEach(u=>{u.srcObject=null,u._playPromise=void 0}),o.forEach(u=>{u.srcObject=null,u._playPromise=void 0})}),this.usersViewMap={};for(let n in this.userMap)this.userMap[n]&&(this.userMap[n].clear(),delete this.userMap[n]);this.self.leave(),(e=this.dcReadyHelper)==null||e.destroy(),this.dcReadyHelper=void 0,this.localStreamManager.stop(),this.rtsManager.clear(),this.authInfo=void 0})}clear(){return pe(this,null,function*(){yield this.leave(),this.self.clear(),this.pluginManager.removeAll()})}startStatsMonitor(){this.statsMonitorId=window.setInterval(()=>pe(this,null,function*(){if(this.publisher){const{audio:o,video:u,candidate:g}=yield this.publisher.getStats();o&&o.length>0&&this.emit("rtcLocalAudioStats",o),u&&u.length>0&&this.emit("rtcLocalVideoStats",u),g&&this.emit("rtcStats",g)}const e=[],n=[];for(const o of this.remoteUsers){const{audio:u,video:g}=yield o.getStats();u&&u.forEach(c=>{e.push(c)}),g&&g.forEach(c=>{n.push(c)})}e.length>0&&this.emit("rtcRemoteAudioStats",e),n.length>0&&this.emit("rtcRemoteVideoStats",n)}),2e3)}stopStatsMonitor(){this.statsMonitorId&&clearInterval(this.statsMonitorId)}addUser(e,n){const o=e.userid;let u=this.userMap[o];return u||(u=this.executeAddUser(o,e.displayname||"",n),this.userMap[o]=u,this.emit("remoteUserJoin",o,0)),this.onRemotePublishStateChange(e,n!==Ht.InRoom),u}executeAddUser(e,n,o){const u=new J_({userId:e,displayName:n,rtsManager:this.rtsManager,signalingManager:this.signalingManager,usersViewMap:this.usersViewMap,slsReporter:this.slsReporter,localUser:this.self,audioVolumeIndicationInterval:this.audioVolumeIndicationInterval,playoutVolume:this.playoutVolume,parameter:this.parameter});return u.on(Ui.Remote,this.onRemoteDeviceStatusChange.bind(this)),u.on(Xt.PullStreamStats,this.onRemoteStatReport.bind(this)),u.on(Xt.RtsSubscribeExceeds,this.onSubscribeExceeds.bind(this)),u.on("audioSubscribeStateChanged",(g,c,s,d)=>{this.emit("audioSubscribeStateChanged",g,c,s,d,this.channel||"")}),u.on("videoSubscribeStateChanged",(g,c,s,d)=>{this.emit("videoSubscribeStateChanged",g,c,s,d,this.channel||"")}),u.on("screenSubscribeStateChanged",(g,c,s,d)=>{this.emit("screenSubscribeStateChanged",g,c,s,d,this.channel||"")}),u.on("dataSubscribeStateChanged",(g,c,s,d)=>{var l;s===ht.AliRtcStateSubscribed&&((l=this.dcReadyHelper)==null||l.onSubscribeDataChannel(this.userMap[g])),this.emit("dataSubscribeStateChanged",g,c,s,d,this.channel||"")}),u.on("remoteAudioAutoPlayFail",g=>{this.emit("remoteAudioAutoPlayFail",g)}),u.on("remoteVideoAutoPlayFail",(g,c)=>{this.emit("remoteVideoAutoPlayFail",g,c)}),u.on("remoteAudioPlayError",(g,c)=>{this.emit("remoteAudioPlayError",g,c)}),u.on("remoteVideoPlayError",(g,c)=>{this.emit("remoteVideoPlayError",g,c)}),u.on("remoteSubscribeError",g=>{this.emit("remoteSubscribeError",g,u.userId)}),u.on("occurError",g=>{this.emit("occurError",g,u.userId)}),u.on("remoteDataChannelMessage",(g,c)=>{this.emit("remoteDataChannelMessage",g,c)}),u.setWantSubAudio(this.autoSubAudio&&this.wantSubAudio),u.setWantSubVideo(this.autoSubVideo&&this.wantSubVideo),u.setWantSubScreen(this.autoSubScreen&&this.wantSubScreen),u.setRemoteDefaultVideoStreamType(this.defaultStreamType),u.setAudioMuted(this.audioMuted),(this.autoSubAudio||this.autoSubVideo||this.autoSubScreen)&&u.updateSubscribe(o),u}onRemoteDeviceStatusChange(e,n){e===Xt.MuteAudio?this.emit("userAudioMuted",n,!0):e===Xt.UnmuteAudio?this.emit("userAudioMuted",n,!1):e===Xt.MuteVideo?this.emit("userVideoMuted",n,!0):e===Xt.UnmuteVideo?this.emit("userVideoMuted",n,!1):e===Xt.MuteScreen?this.emit("userScreenMuted",n,!0):e===Xt.UnmuteScreen&&this.emit("userScreenMuted",n,!1)}onRemoteStatReport(e,n,o){this.emit(Xt.PullStreamStats,e,n,o)}onSubscribeExceeds(e,n){this.emit(Xt.RtsSubscribeExceeds,e,n)}removeLeftUser(e){return pe(this,null,function*(){e.userid&&this.userMap[e.userid]&&(yield this.userMap[e.userid].clear(!1),delete this.userMap[e.userid])})}diffUsers(e){const n=[],o=[];e.forEach(g=>{g.userid&&(this.userMap[g.userid]?o.push(g):n.push(g))});const u=Object.keys(this.userMap).filter(g=>!e.find(c=>c.userid===g)).map(g=>({userid:g,reason:"",leavecode:rf.AliRtcUserOfflineQuit}));return{joinList:n,leaveList:u,presentList:o}}getRemoteUser(e){return this.userMap[e]}updateRemoteUserDeviceStatus(e){e&&e.userid&&this.userMap[e.userid]&&this.userMap[e.userid].updateRemoteUserDeviceStatus(e.status)}updateAudioWant(e,n){const o=this.userMap[e];if(!o)throw new Ve(je.ERR_INNER,`no remote user(${e}) founded`);o.setWantSubAudio(n),n?o.updateSubscribe(Ht.User):o.stopSubscribe({audio:!0})}updateVideoWant(e,n){const o=this.userMap[e];if(!o)throw new Ve(je.ERR_INNER,`no remote user(${e}) founded`);o.setWantSubVideo(n),n?o.updateSubscribe(Ht.User):o.stopSubscribe({video:!0})}updateScreenWant(e,n){const o=this.userMap[e];if(!o)throw new Ve(je.ERR_INNER,`no remote user(${e}) founded`);o.setWantSubScreen(n),n?o.updateSubscribe(Ht.User):o.stopSubscribe({screen:!0})}stopIndication(){this.indicationTimer&&window.clearInterval(this.indicationTimer)}startIndication(e){this.stopIndication(),this.indicationTimer=window.setInterval(()=>{const n=this.remoteUsers.map(o=>({userId:o.userId,volume:o.getAudioLevel()||0}));n.unshift({userId:"",volume:this.self.getAudioLevel()||0}),this.emit("audioVolume",n)},e)}setEnableDualVideoStream(e,n){if(!this.dualVideoPlugin)return;n&&this.dualVideoPlugin.setOptions(n);const o=this.pluginManager.has(this.dualVideoPlugin.name);e?!o&&this.pluginManager.add(this.dualVideoPlugin):o&&this.pluginManager.remove(this.dualVideoPlugin.name)}setAudioVolume(e){var n;(n=this.audioMixerPlugin)==null||n.setOptions(e)}enableAudioVolumeIndication(e){this.audioVolumeIndicationInterval!==e&&(this.audioVolumeIndicationInterval>0&&e<=0&&this.stopIndication(),e>0&&this.startIndication(e),this.audioVolumeIndicationInterval=e,this.remoteUsers.forEach(n=>{n.enableAudioVolumeIndication(e)}),this.self.enableAudioVolumeIndication(e))}setPlayoutVolume(e){this.playoutVolume=e,this.remoteUsers.forEach(n=>{n.setPlayoutVolume(e)})}refreshAuthInfo(e){this.authInfo&&(this.authInfo=Qe(Qe({},this.authInfo),e)),e.userId&&this.self.refreshUserInfo(e.userId)}setEnableMediaExtensionMsg(e){this.rtsManager.setEncodedInsertableStreams(e)}setAudioRedEnabled(e){this.rtsManager.setAudioRedEnabled(e)}setVideoCodec(e){this.rtsManager.changeVideoCodec(e)}setParameter(e){var n,o,u,g;const c=JSON.parse(e);Object.keys(c).forEach(s=>{const d=this.parameter[s],l=c[s];this.parameter[s]=typeof d=="object"&&typeof l=="object"?Qe(Qe({},d),l):l}),c.enableBlankAudio===!0?(this.blankAudioPlugin||(this.blankAudioPlugin=new sT),this.pluginManager.has((n=this.blankAudioPlugin)==null?void 0:n.name)||this.pluginManager.add(this.blankAudioPlugin)):c.enableBlankAudio===!1&&(this.blankAudioPlugin&&this.pluginManager.remove((o=this.blankAudioPlugin)==null?void 0:o.name),(u=this.blankAudioPlugin)==null||u.clear(),this.blankAudioPlugin=void 0),c.audio&&((g=this.audio3AConfig)==null||g.loadFromLocalConfig(c.audio))}setupAudioProcessingPluginIfNeeded(){if(this.audio3AConfig.enableSoft3A){let e=0;this.audio3AConfig.enableSoft3ACheck&&(e=1e4),setTimeout(()=>{this.audioProcessorPlugin||(this.audioProcessorPlugin=new hT({dumpAudioData:this.audio3AConfig.dumpAudioData,aiaecOn:this.audio3AConfig.useAIAEC,slsReporter:this.slsReporter,enableSoft3ACheck:this.audio3AConfig.enableSoft3ACheck,useHardOnly:this.audio3AConfig.useHardOnly})),this.audioProcessorPlugin&&!this.pluginManager.has(this.audioProcessorPlugin.name)&&(this.audioProcessorPlugin.on("error",({message:n})=>{var o;ke.error("audioProcessorPlugin error:",n),(o=this.self.audioTrack)==null||o.applyConstraints({echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0})}),this.pluginManager.add(this.audioProcessorPlugin))},e)}else this.audioProcessorPlugin&&(this.pluginManager.remove(this.audioProcessorPlugin.name),this.audioProcessorPlugin=void 0);this.self.setMicrophoneConstraints({echoCancellation:this.audio3AConfig.useSysEchoCancellation,noiseSuppression:this.audio3AConfig.useSysNoiseSuppression,autoGainControl:this.audio3AConfig.useSysAutoGainControl})}getParameter(){return JSON.stringify(this.parameter)}sendDataChannelMessage(e){return this.self.sendDataChannelMessage(e)}}W(Ii,"logName","BizControl");Wi([ge()],Ii.prototype,"init"),Wi([ge()],Ii.prototype,"leave"),Wi([ge()],Ii.prototype,"clear"),Wi([ge(He)],Ii.prototype,"addUser"),Wi([ge()],Ii.prototype,"removeLeftUser"),Wi([ge()],Ii.prototype,"diffUsers"),Wi([ge(He)],Ii.prototype,"updateAudioWant"),Wi([ge(He)],Ii.prototype,"updateVideoWant"),Wi([ge(He)],Ii.prototype,"updateScreenWant"),Wi([ge()],Ii.prototype,"stopIndication"),Wi([ge()],Ii.prototype,"startIndication"),Wi([ge(He)],Ii.prototype,"setEnableDualVideoStream"),Wi([ge(He)],Ii.prototype,"setAudioVolume"),Wi([ge()],Ii.prototype,"enableAudioVolumeIndication");var fl=(i=>(i[i.LiveTranscodingSingle=0]="LiveTranscodingSingle",i[i.LiveTranscodingMix=1]="LiveTranscodingMix",i))(fl||{}),CS=(i=>(i[i.LiveTranscodingOrigin=0]="LiveTranscodingOrigin",i[i.LiveTranscodingAudio=1]="LiveTranscodingAudio",i[i.LiveTranscodingVideo=2]="LiveTranscodingVideo",i))(CS||{}),Rs=(i=>(i[i.LiveTranscodingCamera=0]="LiveTranscodingCamera",i[i.LiveTranscodingShareScreen=1]="LiveTranscodingShareScreen",i))(Rs||{});const vs={0:"camera",1:"shareScreen"};var wS=(i=>(i[i.LiveTranscoding_Profile_1IN_1080P=0]="LiveTranscoding_Profile_1IN_1080P",i[i.LiveTranscoding_Profile_1IN_720P=1]="LiveTranscoding_Profile_1IN_720P",i[i.LiveTranscoding_Profile_1IN_360P=2]="LiveTranscoding_Profile_1IN_360P",i[i.LiveTranscoding_Profile_2IN_1080P=3]="LiveTranscoding_Profile_2IN_1080P",i[i.LiveTranscoding_Profile_2IN_720P=4]="LiveTranscoding_Profile_2IN_720P",i[i.LiveTranscoding_Profile_2IN_360P=5]="LiveTranscoding_Profile_2IN_360P",i[i.LiveTranscoding_Profile_4IN_1080P=6]="LiveTranscoding_Profile_4IN_1080P",i[i.LiveTranscoding_Profile_4IN_720P=7]="LiveTranscoding_Profile_4IN_720P",i[i.LiveTranscoding_Profile_4IN_360P=8]="LiveTranscoding_Profile_4IN_360P",i[i.LiveTranscoding_Profile_9IN_1080P=9]="LiveTranscoding_Profile_9IN_1080P",i[i.LiveTranscoding_Profile_9IN_720P=10]="LiveTranscoding_Profile_9IN_720P",i[i.LiveTranscoding_Profile_9IN_360P=11]="LiveTranscoding_Profile_9IN_360P",i[i.LiveTranscoding_Profile_12IN_1080P=12]="LiveTranscoding_Profile_12IN_1080P",i[i.LiveTranscoding_Profile_12IN_720P=13]="LiveTranscoding_Profile_12IN_720P",i[i.LiveTranscoding_Profile_12IN_360P=14]="LiveTranscoding_Profile_12IN_360P",i[i.LiveTranscoding_Profile_16IN_1080P=15]="LiveTranscoding_Profile_16IN_1080P",i[i.LiveTranscoding_Profile_16IN_720P=16]="LiveTranscoding_Profile_16IN_720P",i[i.LiveTranscoding_Profile_16IN_360P=17]="LiveTranscoding_Profile_16IN_360P",i[i.LiveTranscoding_Profile_Mixed=9999]="LiveTranscoding_Profile_Mixed",i))(wS||{});const ST={0:"1IN_1080P",1:"1IN_720P",2:"1IN_360P",3:"2IN_1080P",4:"2IN_720P",5:"2IN_360P",6:"4IN_1080P",7:"4IN_720P",8:"4IN_360P",9:"9IN_1080P",10:"9IN_720P",11:"9IN_360P",12:"12IN_1080P",13:"12IN_720P",14:"12IN_360P",15:"16IN_1080P",16:"16IN_720P",17:"16IN_360P",9999:"Mixed_Audio"};var sf=(i=>(i[i.LiveTranscoding_HZ_48000=48e3]="LiveTranscoding_HZ_48000",i[i.LiveTranscoding_HZ_44100=44100]="LiveTranscoding_HZ_44100",i[i.LiveTranscoding_HZ_32000=32e3]="LiveTranscoding_HZ_32000",i[i.LiveTranscoding_HZ_16000=16e3]="LiveTranscoding_HZ_16000",i[i.LiveTranscoding_HZ_8000=8e3]="LiveTranscoding_HZ_8000",i))(sf||{}),pl=(i=>(i[i.LiveTranscodingNoBody=0]="LiveTranscodingNoBody",i[i.LiveTranscodingBody=1]="LiveTranscodingBody",i))(pl||{}),Rl=(i=>(i[i.NOTO_SERIF_CJKSC_REGULAR=0]="NOTO_SERIF_CJKSC_REGULAR",i[i.ALIBABA_PUHUITI_REGULAR=1]="ALIBABA_PUHUITI_REGULAR",i[i.ALIBABA_PUHUITI_BOLD=2]="ALIBABA_PUHUITI_BOLD",i[i.ALIBABA_PUHUITI_Heavy=3]="ALIBABA_PUHUITI_Heavy",i[i.ALIBABA_PUHUITI_LIGHT=4]="ALIBABA_PUHUITI_LIGHT",i[i.ALIBABA_PUHUITI_MEDIUM=5]="ALIBABA_PUHUITI_MEDIUM",i))(Rl||{}),DS=(i=>(i[i.LiveTranscodingOrigin=0]="LiveTranscodingOrigin",i[i.LiveTranscodingCrop=1]="LiveTranscodingCrop",i[i.LiveTranscodingFill=2]="LiveTranscodingFill",i))(DS||{}),cf=(i=>(i[i.LiveTranscodingNormal=0]="LiveTranscodingNormal",i[i.LiveTranscodingVirtualBackground=1]="LiveTranscodingVirtualBackground",i))(cf||{}),OS=(i=>(i[i.LiveTranscodingState_IDLE=0]="LiveTranscodingState_IDLE",i[i.LiveTranscodingState_CONNNECT=1]="LiveTranscodingState_CONNNECT",i[i.LiveTranscodingState_RUNNING=2]="LiveTranscodingState_RUNNING",i[i.LiveTranscodingState_RECOVERING=3]="LiveTranscodingState_RECOVERING",i[i.LiveTranscodingState_FAILURE=4]="LiveTranscodingState_FAILURE",i[i.LiveTranscodingState_END=5]="LiveTranscodingState_END",i))(OS||{}),cn=(i=>(i[i.LiveTranscodingErrorPublishOk=0]="LiveTranscodingErrorPublishOk",i[i.LiveTranscodingErrorStreamNotFound=17825793]="LiveTranscodingErrorStreamNotFound",i[i.LiveTranscodingErrorStreamAlreadyExist=17825794]="LiveTranscodingErrorStreamAlreadyExist",i[i.LiveTranscodingErrorInvalidParam=17825795]="LiveTranscodingErrorInvalidParam",i[i.LiveTranscodingErrorInternalError=17825796]="LiveTranscodingErrorInternalError",i[i.LiveTranscodingErrorRtmpServerError=17825797]="LiveTranscodingErrorRtmpServerError",i[i.LiveTranscodingErrorRtmpStreamUrlError=17825798]="LiveTranscodingErrorRtmpStreamUrlError",i[i.LiveTranscodingErrorPublishTimeout=17825799]="LiveTranscodingErrorPublishTimeout",i[i.LiveTranscodingErrorNotAuthorized=17825800]="LiveTranscodingErrorNotAuthorized",i))(cn||{}),IS=(i=>(i[i.TrascodingPublishTaskStatusStart=0]="TrascodingPublishTaskStatusStart",i[i.TrascodingPublishTaskStatusUpdate=1]="TrascodingPublishTaskStatusUpdate",i[i.TrascodingPublishTaskStatusStop=2]="TrascodingPublishTaskStatusStop",i))(IS||{}),qi=(i=>(i[i.MPU_TASK_TRANSACTION_START=0]="MPU_TASK_TRANSACTION_START",i[i.MPU_TASK_TRANSACTION_UPDATE=1]="MPU_TASK_TRANSACTION_UPDATE",i[i.MPU_TASK_TRANSACTION_STOP=2]="MPU_TASK_TRANSACTION_STOP",i[i.MPU_TASK_TRANSACTION_LIST=3]="MPU_TASK_TRANSACTION_LIST",i[i.MPU_TASK_TRANSACTION_POLLING=4]="MPU_TASK_TRANSACTION_POLLING",i[i.MPU_TASK_TRANSACTION_ACKNOWLEDGE=5]="MPU_TASK_TRANSACTION_ACKNOWLEDGE",i[i.MPU_TASK_TRANSACTION_END=6]="MPU_TASK_TRANSACTION_END",i))(qi||{});const bT={0:"/libra/v1/sdk/start-task",1:"/libra/v1/sdk/update-task",2:"/libra/v1/sdk/stop-task",3:"/libra/v1/sdk/list-task",4:"/libra/v1/sdk/polling",5:"/libra/v1/sdk/acknowledge",6:"/"};class MS{constructor(e,n,o,u,g,c,s,d){W(this,"videoWidth"),W(this,"videoHeight"),W(this,"videoFramerate",20),W(this,"videoBitrate",2e3),W(this,"videoGop",30),W(this,"audioSamplerate",sf.LiveTranscoding_HZ_44100),W(this,"audioBitrate",500),W(this,"audioChannels",1),this.videoWidth=e,this.videoHeight=n,o&&(this.videoFramerate=o),u&&(this.videoBitrate=u),g&&(this.videoGop=g),c&&(this.audioSamplerate=c),s&&(this.audioBitrate=s),d&&(this.audioChannels=d)}}const lf=i=>((16711680&i)>>16)+(65280&i)+((255&i)<<16),br=(i=0,e)=>{if(e==0)return 0;let n=i/e;return n<0&&(n=0),n>1&&(n=1),n};class Hh{constructor(e,n,o){W(this,"mixMode",fl.LiveTranscodingSingle),W(this,"singleParam"),W(this,"mixParam"),e&&(this.mixMode=e),n&&(this.singleParam=n),o&&(this.mixParam=o)}toJson(e,n,o,u,g){const c={appid:n.appId,channelid:n.channelId};if(e===qi.MPU_TASK_TRANSACTION_POLLING||e===qi.MPU_TASK_TRANSACTION_LIST||e===qi.MPU_TASK_TRANSACTION_ACKNOWLEDGE)return e===qi.MPU_TASK_TRANSACTION_ACKNOWLEDGE&&(c.messageid=g),c;if(c.taskid=o,e!==qi.MPU_TASK_TRANSACTION_STOP){if(c.mixmode=this.mixMode,u&&(c.streamurl=u),this.mixMode===fl.LiveTranscodingSingle){const s=this.singleParam;if(s){c.streamtype=s.streamType,s.sourceType===Rs.LiveTranscodingShareScreen?c.sourcetype=vs[s.sourceType]:c.sourcetype=vs[Rs.LiveTranscodingCamera];const d=[];s.userId&&d.push(s.userId),c.subspecusers=d}}else if(e===qi.MPU_TASK_TRANSACTION_START||e===qi.MPU_TASK_TRANSACTION_UPDATE){const s=this.mixParam;if(s){s.taskProfile&&(c.taskprofile=ST[s.taskProfile]);const d=s.encodeParam||new MS(1280,720);let l=d.videoWidth,p=d.videoHeight;const S={};Object.keys(d).forEach(y=>{const R=d[y];R>0&&(S[y.toLowerCase()]=R)}),S.lowbitratehighquality=0,c.encodeparam=S,c.backgrounds=s.backgrounds.map(y=>y.toJson(l,p)),c.watermarks=s.watermarks.map(y=>y.toJson(l,p)),c.clockwidgets=s.clockWidgets.map(y=>y.toJson(l,p));const T=s.users.map(y=>y.userId);c.subspecusers=[...new Set(T)],c.layouts=[{audiomixcount:s.users.length,panes:s.users.map((y,R)=>y.toJson(R,l,p,s.mediaProcessMode))}],c.layoutids=["0"],c.cropmode=s.cropMode,c.backgroundcolor=lf(s.backgroundColor),c.taskmode=s.mediaProcessMode}}}return c}}const Sh=i=>pe(void 0,null,function*(){const e=new Uint8Array(160).fill(170),n=new TextEncoder().encode(i),o=yield window.crypto.subtle.importKey("raw",e,{name:"HMAC",hash:{name:"SHA-1"}},!1,["sign"]),u=yield window.crypto.subtle.sign("HMAC",o,n);return Array.from(new Uint8Array(u)).map(g=>g.toString(16).padStart(2,"0")).join("")});class ET{constructor(e){W(this,"authInfo"),W(this,"slsReporter"),this.slsReporter=e}doRequest(e,n){var o;const u=this.authInfo;if(!u)return Promise.reject(cn.LiveTranscodingErrorInvalidParam);const g=bT[e],c={appid:u.appId,userid:u.userId,channelid:u.channelId,timestamp:u.timestamp,token:u.token,nonce:u.nonce?u.nonce:"",requestid:ei.createCallid(),tokensid:!1,session:(o=u.sessionId)!=null?o:ei.createCallid()},s=Object.keys(c).map(d=>`${d}=${encodeURIComponent(c[d])}`).join("&");return fetch(`https://gw.rtn.aliyuncs.com${g}?${s}`,{method:"POST",headers:{"Content-Type":"application/json; charset=UTF-8"},body:JSON.stringify(n)}).then(d=>d.status!==200?(this.slsReporter.reportTranscodingError(d.status,n.taskid||""),Promise.reject(new Ve(je.ERR_INNER,`transcoding request failed, status: ${d.status}`))):d).catch(d=>Promise.reject(new Ve(je.ERR_INNER,`transcoding request failed, err: ${d.message}`)))}setAuthInfo(e){this.authInfo=e}clear(){this.authInfo=void 0}startPublishLiveStream(e,n){return pe(this,null,function*(){if(!this.authInfo)return Promise.reject(cn.LiveTranscodingErrorInvalidParam);const o=yield Sh(e.split("?")[0]),u=qi.MPU_TASK_TRANSACTION_UPDATE,g=n.toJson(u,this.authInfo,o,e);return this.doRequest(u,g)})}startPublishLiveStreamWithTaskId(e,n){return pe(this,null,function*(){if(!this.authInfo)return Promise.reject(cn.LiveTranscodingErrorInvalidParam);const o=qi.MPU_TASK_TRANSACTION_UPDATE,u=n.toJson(o,this.authInfo,e);return this.doRequest(o,u)})}updatePublishLiveStream(e,n){return pe(this,null,function*(){if(!this.authInfo)return Promise.reject(cn.LiveTranscodingErrorInvalidParam);const o=yield Sh(e.split("?")[0]),u=qi.MPU_TASK_TRANSACTION_UPDATE,g=n.toJson(u,this.authInfo,o,e);return this.doRequest(u,g)})}updatePublishLiveStreamWithTaskId(e,n){return pe(this,null,function*(){if(!this.authInfo)return Promise.reject(cn.LiveTranscodingErrorInvalidParam);const o=qi.MPU_TASK_TRANSACTION_UPDATE,u=n.toJson(o,this.authInfo,e);return this.doRequest(o,u)})}stopPublishLiveStream(e){return pe(this,null,function*(){if(!this.authInfo)return Promise.reject(cn.LiveTranscodingErrorInvalidParam);const n=yield Sh(e.split("?")[0]),o=qi.MPU_TASK_TRANSACTION_STOP,u=new Hh().toJson(o,this.authInfo,n,e);return this.doRequest(o,u)})}stopPublishLiveStreamWithTaskId(e){if(!this.authInfo)return Promise.reject(cn.LiveTranscodingErrorInvalidParam);const n=qi.MPU_TASK_TRANSACTION_STOP,o=new Hh().toJson(n,this.authInfo,e);return this.doRequest(n,o)}refreshAuthInfo(e){this.authInfo&&this.setAuthInfo(Qe(Qe({},this.authInfo),e))}}function _y(i,e){const n=new window.XMLHttpRequest;n.open("POST",`${i}?APIVersion=0.6.0`,!0),n.send(e)}function RT(i,e){try{if(e.length>=32768)return void _y(i,e);(function(n,o){return!(!navigator||!navigator.sendBeacon)&&navigator.sendBeacon(`${n}?APIVersion=0.6.0`,o)})(i,e)||_y(i,e)}catch(n){window&&window.console&&typeof window.console.error=="function"&&(console.error(`Failed to log to ali log service because of this exception:
`+n),console.error("Failed log data:",i))}}function _T(i,e,n){return o=this,u=null,g=function*(){try{i=i.slice(0,-6);const{data:c,header:s}=yield n.process(i,e),d=new window.XMLHttpRequest;d.open("POST",i,!0);for(let l in s)d.setRequestHeader(l,s[l]);d.send(c)}catch(c){window&&window.console&&typeof window.console.error=="function"&&(console.error(`Failed to log to ali log service because of this exception:
`+c),console.error("Failed log data:",i))}},new Promise((c,s)=>{var d=S=>{try{p(g.next(S))}catch(T){s(T)}},l=S=>{try{p(g.throw(S))}catch(T){s(T)}},p=S=>S.done?c(S.value):Promise.resolve(S.value).then(d,l);p((g=g.apply(o,u)).next())});var o,u,g}class NS extends pS{constructor(e){super(Object.assign({},e,{installUnloadHook:n=>{window.addEventListener("beforeunload",()=>{n()})},sendPayload:(n,o)=>{RT(n,o)}}))}useStsPlugin(e){this.getOpt().sendPayload=(n,o)=>{_T(n,o,e)},this.overwriteTransString(e)}}uS(window,"SLS_Tracker",NS);const kS=class ps{constructor(){W(this,"ntpClock"),this.ntpClock=new wt.AliRTS.Clock}static getInstance(){return ps.instance||(ps.instance=new ps),ps.instance}now(){return this.ntpClock.now()}};W(kS,"instance");let TT=kS;const PS=()=>TT.getInstance(),{BrowserUtil:bh,SystenUtil:Ty}=wt.AliRTS;class Ay{constructor(){W(this,"tracker"),W(this,"param"),W(this,"msgCacheArr",[]),W(this,"index",0),W(this,"stsOpt"),W(this,"slsToken"),W(this,"ossToken"),W(this,"ntpClock"),this.ntpClock=PS()}createTracker(){if(!this.tracker&&this.slsToken&&this.param){const e=this.slsToken;this.ossToken&&(this.param.ossbn=this.ossToken.bucket_name,this.param.ossep=this.ossToken.region_endpoint);const n=new NS({host:e.region_endpoint,project:e.project,logstore:e.log_store_stats}),o={accessKeyId:e.access_key_id,accessKeySecret:e.access_key_secret,securityToken:e.security_token,refreshSTSToken:()=>{this.slsToken&&(o.accessKeyId=this.slsToken.access_key_id,o.accessKeySecret=this.slsToken.access_key_secret,o.securityToken=this.slsToken.security_token)}};this.stsOpt=o;const u=Zh(o);n.useStsPlugin(u),this.tracker=n,this.msgCacheArr.forEach((g,c)=>{var s,d;(d=this.tracker)==null||d.send(Qe(Vr(Qe({},this.param),{stat_log_id:`${((s=this.param)==null?void 0:s.sesid)||"nosession"}-${c}`}),g))}),this.index=this.index+this.msgCacheArr.length,this.msgCacheArr=[]}}start(e){this.initParam(e),this.createTracker()}updateToken(e,n){this.slsToken=e,this.ossToken=n,this.createTracker()}stop(){this.tracker=void 0,this.param=void 0,this.msgCacheArr=[],this.index=0,this.stsOpt=void 0,this.slsToken=void 0,this.ossToken=void 0}sendReport(e){var n,o;let u;e.tm=Date.now();try{u=JSON.parse(JSON.stringify(Qe(Vr(Qe({bt:bh.browserName||"unknown",ntptm:this.ntpClock.now(),ntpofs:this.ntpClock.now()-Date.now()},this.param),{stat_log_id:`${((n=this.param)==null?void 0:n.sesid)||"nosession"}-${this.index}`}),e)))}catch{}u&&(this.tracker?((o=this.tracker)==null||o.send(u),this.index++):this.msgCacheArr.push(u))}initParam(e){let n="";try{n=(localStorage==null?void 0:localStorage.getItem("AliRtcUUID"))||"",n||(n=Er(),localStorage?.setItem("AliRtcUUID",n))}catch{}this.param||(this.param={apid:e.appId,usrid:e.userId,statsvrs:"0.6.1",evetid:0,sesid:e.sessionId,sessionId:e.sessionId,channelid:e.channelId,usrn:e.userId,osn:Ty.systemName,osv:Ty.systemVersion,deb:T_(),den:E_(),udid:n,sdkvrs:yl,acs:"Unknown",cput:fS(),dm:`${window.location.protocol}//${window.location.host}`,bt:bh.browserName,bv:bh.browserVersion,envir:"PRODUCT",args:"",instid:Er()})}}const Gt=(i,e=1,n=6e4,o=0)=>{let u=i;return u||(u=0),Math.min(n,Math.max(o,Math.round(u*e)))},mr=(i,e,n=2e7,o=0)=>{let u=e;(!e||e<0||e>1e4)&&(u=1e3);let g=i;return g||(g=0),Math.min(n,Math.max(o,Math.round(g/(u/1e3))))},so=(i,e)=>{if(e===0||!e)return"0.00";let n=i;return(!n||n<0)&&(n=0),(n/e*100).toFixed(2)},Cy=i=>i>=0&&i<=1?Gt(Math.floor(32767*i),1,32767):0,qt=(i,e)=>{var n,o,u;let g=((n=i._last)==null?void 0:n[e])||0;return i.ssrc&&(o=i._last)!=null&&o.ssrc&&i.ssrc!==((u=i._last)==null?void 0:u.ssrc)&&(g=0),(i?.[e]||0)-g},wy=(i,e)=>Gt(qt(i,e),1e3,1e4),co=(i,e=2e7)=>Gt(i,1,e),LS=class jh{constructor(e){W(this,"engine"),W(this,"logClient"),W(this,"authInfo"),W(this,"ntpClock"),W(this,"customFields",{}),this.logClient=new Ay,this.engine=e,this.ntpClock=PS()}static getLogClient(){return this.staticClient||(this.staticClient=new Ay),this.staticClient}static reportOSSUpload(e,n,o=0){jh.getLogClient().sendReport({errmsg:`${n}/${e}.log`,errtype:o,evetid:70017,sesid:e,sessionId:e,stat_log_id:`${e}-70017`})}setCustomFields(e){this.customFields=Qe(Qe({},this.customFields),e)}getCustomField(e){return this.customFields[e]}start(e){this.authInfo=e,this.logClient.start(e)}updateToken(e,n){this.logClient.updateToken(e,n),jh.getLogClient().updateToken(e,n)}stop(){this.logClient.stop()}reportPublishAudio3A(e,n,o,u){const g={};let c=JSON.parse(u);g.publevel=c.capture_audio_cur_level_db||0,g.eleakrate=c.echo_leak_rate||0,g.playbw=c.render_bandwidth||-1,g.capbw=c.capture_bandwidth||-1,g.diff=c.diff||0,g.leak=c.leak||0,this.log({evetid:10070,traceid:o,calid:e,rmtid:"",args:this.data2String(Qe({calid:e,tckid:n||"audio3a",rmtid:"",traceid:o},g))})}reportPublishMonitor(e,n,o,u,g){if(!o||g.length<=0)return;const c=o===De.Audio,s={ctm:Math.floor(g[0].timestamp||0),src:g[0].ssrc||"",codec:g[0]._codec||""},d=[],l=[],p=[],S=[],T=[],y=[],R=[],v=[],h=[],m=[],_=[],A=[],E=[],b=[],w=[],C=[],P=[],U=[],B=[];try{if(g.forEach(L=>{var H,O,x,F,N,k;if(!L||!L.timestamp)return;const M=(H=L._last)!=null&&H.timestamp?L.timestamp-L._last.timestamp:1e3,j=qt(L,"bytesSent"),G=qt(L,"headerBytesSent"),z=mr(Gt(j+G,8,2e7),M);d.push(z);const V=mr(Gt(j,8,2e7),M);l.push(V);const re=mr(Gt(G,8,2e7),M);p.push(re);const Q=qt(L,"packetsSent"),Z=mr(Q,M);S.push(Z);const q=qt(L,"packetsLost"),Y=mr(q,M);T.push(Y);const J=so(q,Q);if(y.push(J),c)(O=L._source)!=null&&O.audioLevel&&R.push(Cy(L._source.audioLevel)),v.push(0);else{h.push(wy(L,"totalEncodeTime")),m.push(co((x=L._source)==null?void 0:x.framesPerSecond,100)),_.push(co((F=L._source)==null?void 0:F.framesPerSecond,100)),A.push(co(L.framesPerSecond,100)),E.push(co((N=L._source)==null?void 0:N.height,4400)),b.push(co((k=L._source)==null?void 0:k.width,7700)),w.push(co(L.frameHeight,4400)),C.push(co(L.frameWidth,7700));const $=qt(L,"totalPacketSendDelay");P.push(Gt($,1/(q||1),2e3));const te=qt(L,"qpSum");U.push(Gt(te,1/(L.framesPerSecond||1),51)),B.push(0)}}),s.sbr=d.join(","),s.mbrs=l.join(","),s.pbrs=p.join(","),s.ps=S.join(","),s.pl=T.join(","),s.plr=y.join(","),c){const L=u?.getSettings().sampleRate||0;s.ailevel=R.join(","),s.arpc=v.join(","),s.arsr=L,s.aesr=L,s.publevel=-90,s.rawlevel=-90}else s.em=h.join(","),s.cfps=m.join(","),s.ifps=_.join(","),s.sfps=A.join(","),s.ih=E.join(","),s.iw=b.join(","),s.sh=w.join(","),s.sw=C.join(","),s.sd=P.join(","),s.aqp=U.join(","),s.caf=B.join(","),s.can=B.join(","),s.cav=l.join(","),s.ifimax=B.join(","),s.ifimin=B.join(","),s.efimax=B.join(","),s.efimin=B.join(","),s.sfimax=B.join(","),s.sfimin=B.join(","),s.apsnr=B.join(",")}catch{}this.log({evetid:10070,traceid:n,calid:e,rmtid:"",args:this.data2String(Qe({calid:e,tckid:o,rmtid:"",traceid:n},s))})}reportSubscribeMonitor(e,n,o,u,g){if(!u||!g||g.length<=0)return;const c=u===De.Audio,s={ctm:Math.floor(g[0].timestamp||0),src:g[0].ssrc||"",codec:g[0]._codec||""},d=[],l=[],p=[],S=[],T=[],y=[],R=[],v=[],h=[],m=[],_=[],A=[],E=[],b=[],w=[],C=[],P=[],U=[],B=[],L=[],H=[],O=[],x=[],F=[],N=[],k=[],M=[],j=[],G=[],z=[],V=[],re=[],Q=[],Z=[];try{g.forEach(q=>{var Y,J;if(!q||!q.timestamp)return;const $=(Y=q._last)!=null&&Y.timestamp?q.timestamp-q._last.timestamp:1e3,te=qt(q,"bytesReceived"),ie=qt(q,"headerBytesReceived"),se=mr(Gt(te+ie,8,2e7),$);d.push(se);const he=mr(Gt(te,8,2e7),$);l.push(he);const de=mr(Gt(ie,8,2e7),$);p.push(de);const be=qt(q,"packetsReceived"),Re=mr(be,$);S.push(Re);const Te=qt(q,"packetsLost"),Ae=mr(Te,$);T.push(Ae);const Ie=so(Te,be);y.push(Ie);const Le=qt(q,"jitterBufferDelay"),Be=qt(q,"jitterBufferEmittedCount");if(q.jitterBufferDelay&&q.jitterBufferEmittedCount){const Je=Gt(Le,1e3/Be,1e4);R.push(Je)}else R.push(0);const $e=qt(q,"fecPacketsReceived");A.push(so($e,be));const Ne=qt(q,"retransmittedPacketsReceived"),ze=be+Te-Ne;if(h.push(so(be-Ne,ze)),m.push(so(Te,ze)),v.push(so(Ne,ze)),_.push(ze),Q.push(0),Z.push(""),c){b.push(Cy(q.audioLevel));const Je=((dt,Ct)=>{var _t,ft,pt;return(((_t=dt?._source)==null?void 0:_t[Ct])||0)-(((pt=(ft=dt?._last)==null?void 0:ft._source)==null?void 0:pt[Ct])||0)})(q,"synthesizedSamplesEvents");w.push(Je);const rt=wy(q,"synthesizedSamplesDuration");C.push(rt);const It=so(rt,$);E.push(It),P.push(0)}else{const Je=(J=q._last)!=null&&J.totalInterFrameDelay?q.totalInterFrameDelay-q._last.totalInterFrameDelay:0;U.push(Gt(Je,1e3/(q.framesDecoded||30),500)),B.push(Gt(q.framesPerSecond,1,100)),L.push(qt(q,"framesReceived")),re.push(qt(q,"framesRendered")),H.push(Gt(q.frameHeight,1,4400)),O.push(Gt(q.frameWidth,1,7700));const rt=qt(q,"totalProcessingDelay");x.push(Gt(rt,1e3/(q.framesDecoded||30),12e4));const It=qt(q,"nackCount");N.push(It);const dt=qt(q,"pliCount");F.push(dt);const Ct=qt(q,"qpSum");k.push(Gt(Ct,1/(q.framesPerSecond||1),51)),M.push(Gt(q.framesDropped));const _t=qt(q,"totalFreezesDuration");j.push(Gt(_t,1e3,3e4));const ft=qt(q,"jitterBufferEmittedCount"),pt=qt(q,"jitterBufferDelay");pt&&ft?G.push(Gt(pt,1e3/ft,3e4)):G.push(0);const jt=qt(q,"jitterBufferTargetDelay");jt&&ft?z.push(Gt(jt,1e3/ft,3e4)):z.push(0);const yt=qt(q,"jitterBufferMinimumDelay");yt&&ft?V.push(Gt(yt,1e3/ft,3e4)):V.push(0)}}),s.rbr=d.join(","),s.mbrs=l.join(","),s.pbrs=p.join(","),s.pr=S.join(","),s.pl=T.join(","),s.plr=y.join(","),s.jd=R.join(","),s.fecr=A.join(","),s.retransr=v.join(","),s.baser=h.join(","),s.basel=m.join(","),s.recoverr=Q.join(","),s.alll=m.join(","),s.totalc=_.join(","),c?(s.er=E.join(","),s.aolevel=b.join(","),s.asrc=P.join(","),s.scnt=w.join(","),s.sdura=C.join(",")):(s.dm=U.join(","),s.dfps=B.join(","),s.rfps=L.join(","),s.rh=H.join(","),s.rw=O.join(","),s.fpt=Z.join(","),s.ns=N.join(","),s.pliss=F.join(","),s.aqp=k.join(","),s.ofimax=Q.join(","),s.ofimin=Q.join(","),s.dfimax=Q.join(","),s.dfimin=Q.join(","),s.rfimax=Q.join(","),s.rfimin=Q.join(","),s.vrstutter=j.join(","),s.cdm=G.join(","),s.tdm=z.join(","),s.pdm=V.join(","),s.ofps=re.join(","),s.dfbd=M.join(","))}catch{}this.log({evetid:10080,traceid:o,rmtid:n,calid:e,args:this.data2String(Qe({calid:e,rmtid:n,tckid:u,traceid:o},s))})}reportNetworkMonitor(e){if(e.length<=0)return;const n=[],o=[],u=[],g=[],c=[],s=[],d=[],l=[],p=[],S=[];e.forEach((y,R)=>{var v;if(!y.timestamp)return;const h=(v=y._last)!=null&&v.timestamp?y.timestamp-y._last.timestamp:1e3;n.push(Gt(y.currentRoundTripTime,1e3)),o.push(Gt(y.availableOutgoingBitrate,8,2e8)),u.push(mr(Gt(y.bytesSent,8,2e7),h,25e6)),g.push(mr(Gt(y.bytesReceived,8,2e7),h,25e6)),c.push(0),s.push(0),R%5==0&&(d.push(""),l.push(""),p.push(""),S.push(""))});const T={ctm:Math.floor(e[0].timestamp||0),rtt:n.join(","),bsps:u.join(","),brps:g.join(","),cpu:d.join(","),mem:l.join(","),sysmem:p.join(","),systotalmem:S.join(","),audioonly:this.engine.isAudioOnly()?1:0};this.log({evetid:10071,args:this.data2String(Qe({asb:o.join(","),abms:c.join(","),vbms:s.join(",")},T))}),this.log({evetid:10081,args:this.data2String(Qe({},T))})}reportLoopAudioDelay(e,n){var o;const{AIAgent:u={},AIGrtn:g={},AIPub:c={},AISub:s={},pub:d={},sub:l={},grtn:p={}}=n||{};if(Object.keys(u).length===0)return;let S=0;S=Object.keys(p).length?(d.vTotalCost||0)+(d.upRTTHalf||0)+(p.totalCost||0)+(l.downRTTHalf||0)+(l.vTotalCost||0):(d.vEncPlugCost||0)+((d.timestampRecv||0)-(d.timestamp||0))+(l.vJitterBufferDelay||0)+(l.vDecPlugCost||0);const T={};let y=0;for(let v=0;v<10;v++){const h=`ngxRtcSeiCumulativeDelayKeyInternalRttHalf_${v}`,m=`ngxRtcSeiCumulativeDelayKeyGrtnNodeBefPacer_${v}`,_=`ngxRtcSeiCumulativeDelayKeyGrtnNodePacerCost_${v}`;if(!p.hasOwnProperty(h))break;y+=p[h]||0,y+=p[m]||0,y+=p[_]||0,T[`_gnd${v}`]=`gnd[${v}]: {${this.data2String({gnirh:p[h]||0,gnbp:p[m]||0,gnpc:p[_]||0})}}`}const R={};for(let v=0;v<10;v++){const h=`aigrtninternalrtthalf_${v}`,m=`aigrtnbeforepacer_${v}`,_=`aigrtnpacercost_${v}`;if(!g.hasOwnProperty(h))break;R[`_lgnd${v}`]=`lgnd[${v}]: {${this.data2String({gnirh:g[h]||0,gnbp:g[m]||0,gnpc:g[_]||0})}}`}this.log({evetid:10073,args:this.data2String(Vr(Qe({tdlms:S+(u.aiagenttotalcost||0),_:`aiqud:{${this.data2String(Vr(Qe({uid:((o=this.authInfo)==null?void 0:o.userId)||"",sid:c.aAIClientScentenceId||0,quct:65535*(c.aAIClientQuestionTimestampHEAD||0)+(c.aAIClientQuestionTimestampTAIL||0),anct:65535*(c.aAIClientAnswerTimestampHEAD||0)+(c.aAIClientAnswerTimestampTAIL||0),casc:c.aAIClientSourceCost||0,camc:c.aAIClientMixerCost||0,caec:c.aAIClientEncoderCost||0,cantc:c.aIClientNetsdkThrCost||0,caqtc:c.aIClientQosThrCost||0,capc:c.aIClientPacerCost||0,cuphr:c.aIClientUpRTTHalf||0},R),{qgac:0,ldhr:p.ngxRtcSeiCumulativeDelayKeyDownRttHalf_0||0,larc:s.aAILinuxReceiveCost||0,lanqc:s.aAILinuxNeteqCost||0,larsc:s.aAILinuxRemoteSourceCost||0,lapmc:s.aAILinuxPlayMixerCost||0,lapc:s.aAILinuxPlayCost||0,lsdnc:s.aIClinetSmartDenoise||0,asrc:u.aiasrcost||0,llmc:u.aillmcost||0,ttsc:u.aittscost||0,aamc:u.aimutecost||0,aatc:u.aiagenttotalcost||0}))}};`,ssrc:e,tpd:0,scc:c.aAIClientSourceCost||0,mxc:c.aAIClientMixerCost||0,encc:c.aAIClientEncoderCost||0,netc:c.aIClientNetsdkThrCost||0,qostc:c.aIClientQosThrCost||0,pacerc:c.aIClientPacerCost||0,uphr:c.aIClientUpRTTHalf||0},T),{agac:y,dnhr:l.downRTTHalf||0,tsd:l.vTotalCost||0,rcc:s.aAILinuxReceiveCost||0,nqc:s.aAILinuxNeteqCost||0,rscc:s.aAILinuxRemoteSourceCost||0,plmxc:s.aAILinuxPlayMixerCost||0,plc:s.aAILinuxPlayCost||0,dvd:0}))})}reportJoin(e,n,o=""){var u,g;const{start:c,rs:s=0,re:d=0}=n,l=Date.now()-c,p=d-s;let S=0;s&&(S=s-c);let T=0;d&&(T=d-s),this.log({evetid:10010,args:this.data2String({sesid:((u=this.authInfo)==null?void 0:u.sessionId)||"",joitm:l,rslt:e,gslbtm:0,dnstm:0,avcftm:0,gslbrslt:0,dnsrslt:0,avcfrslt:0,mode:2,jrtc:p,usrn:(g=this.authInfo)==null?void 0:g.userId,mgt:"cdn",cttc:S,iptc:T,ndn:1,gslbloc:1,ccag:0,ucag:0,cpg:0,upg:0,tid:o})})}reportJoinConnection(e){this.log({evetid:20002,args:this.data2String(Qe({transretrynum:0,ldnstc:0,tcptc:0,ssltc:0,url:""},e))})}reportLeave(e,n,o){this.log({evetid:10020,args:this.data2String({lvetm:e,rslt:n,tid:o})})}reportPublish(e,n,o,u,g,c,s,d,l,p,S,T){this.log({evetid:e?10032:10030,calid:o,tm:T,args:this.data2String({calid:o,url:n,isvl:u?1:0,isvs:g?1:0,isvss:c?1:0,isaudio:s?1:0,rslt:d,tid:"123",pubtm:Date.now()-S,pctid:l,pubtid:p,isvp:0,isarecording:0,isad:0,isdc:0,pubretry:0,pbrttimes:0})})}reportPublishFirstPacket(e,n,o,u,g,c,s,d,l){const p=Date.now();this.log({evetid:e?10033:10031,calid:n,args:this.data2String({calid:n,fpst:p-o,tckid:c,est:o,pctid:s,pubtid:d,totaltm:p-g,jorm:l===xr.JOIN_CHANNEL?1:0,cptc:0,sptc:u-o,iptc:0,ipc2fptc:0,dctc:0,patc:0})})}reportUnpublish(e,n,o,u){var g;this.log({evetid:10040,args:this.data2String({calid:e,unpubtm:n,rslt:o,tid:u,sesid:((g=this.authInfo)==null?void 0:g.sessionId)||""})})}reportSubscribe(e,n,o,u,g,c,s,d,l,p,S){this.log({evetid:10050,calid:e,rmtid:n,tm:S,args:this.data2String(Qe({calid:e,rmtid:n,isvl:o?1:0,isvs:u?1:0,isvss:g?1:0,isaudio:c?1:0,rslt:s,tid:d,subtm:l,isvp:0,isaplaying:0,isad:0,isdc:0,subretry:0,sbrttimes:0},p))})}reportSubscribeFirstPacket(e,n,o,u,g){this.log({evetid:e?10054:10051,calid:n,rmtid:o,args:this.data2String(Qe({calid:n,rmtid:o,tckid:u,cptc:0,iptc:0,ipc2fptc:0,dctc:0,patc:0},g))})}reportSubscribeFirstFrame(e,n,o,u,g){this.log({evetid:e?10055:10052,calid:n,rmtid:o,args:this.data2String(Qe({calid:n,rmtid:o,tckid:u},g))}),this.log({evetid:e?10058:10057,args:this.data2String(Qe({calid:n,rmtid:o,tckid:u},g))})}reportUnsubscribe(e,n,o,u,g){this.log({evetid:10060,calid:e,args:this.data2String({calid:e,rmtid:n,unsubtm:o,rslt:u,tid:g})})}reportMute(e,n,o){this.log({evetid:11030,args:this.data2String({calid:e,rmtid:"",enable:n?1:0,mt:o})})}reportRoleUpdate(e,n){this.log({evetid:11040,args:this.data2String({or:e||"",nr:n,ctm:Date.now(),rslt:0})})}reportRoleUpdateResult(e,n,o,u){this.log({evetid:11041,args:this.data2String({or:e||"",nr:n,ctm:o,rslt:u})})}reportVideoProfile(e){this.log({evetid:20074,args:this.data2String({pf:e,tckid:"sophon_camera_large"})})}reportScreenProfile(e){this.log({evetid:20074,args:this.data2String({pf:e,tckid:"sophon_screenshare"})})}reportError(e){this.log({evetid:10091,args:this.data2String({rslt:e?.code||-1})})}reportWarning(e){this.log({evetid:10092,args:this.data2String({rslt:-1,errmsg:e})})}reportRoomServerEvent(e,n,o,u){this.log({evetid:20005,args:this.data2String({calid:"",rmtid:"",rt:e?0:1,dr:e?"s":"r",mt:n,ri:o,cs:1,srt:Date.now(),rspc:u?.code||"",mc:JSON.stringify(u)})})}reportTranscodingError(e,n){this.log({evetid:10101,args:this.data2String({rslt:e,taskid:n})})}reportBye(e){var n;this.log({evetid:10093,args:this.data2String({rslt:e,sesid:((n=this.authInfo)==null?void 0:n.sessionId)||""})})}reportAudio(e,n,o){var u;this.log({evetid:80013,args:this.data2String({rslt:e?-1:0,adm:1,adt:0,adr:e?2:0,acms:n,adrpn:o})}),this.log({evetid:80014,args:this.data2String({sesid:((u=this.authInfo)==null?void 0:u.sessionId)||"",rslt:e?-1:0,adm:1,adt:0,adr:e?2:0,acms:n,adrpn:o})})}reportScreen(e,n){var o,u,g,c;this.log({evetid:90013,args:this.data2String({rslt:e?-1:0,vcms:n,vde:(o=e?.code)!=null?o:-1,sesid:((u=this.authInfo)==null?void 0:u.sessionId)||""})}),this.log({evetid:90014,args:this.data2String({rslt:e?-1:0,vcms:n,vde:(g=e?.code)!=null?g:-1,sesid:((c=this.authInfo)==null?void 0:c.sessionId)||""})})}reportScreenStop(e){this.log({evetid:90019,args:this.data2String({rslt:e?e.code||-1:0})}),this.log({evetid:90020,args:this.data2String({rslt:e?e.code||-1:0})})}reportSwitchCamera(e){var n;this.log({evetid:90025,args:this.data2String({rslt:0,td:e,sesid:((n=this.authInfo)==null?void 0:n.sessionId)||""})})}reportPublishProfile(e,n){this.log({evetid:10201,args:this.data2String(Qe({tckid:e},n))})}reportSDKCreated(e){this.log({evetid:70011,createtm:Date.now()-e,tm:e})}reportJoinInvoked(e){this.log({evetid:70012,jnnonce:e.nonce||"",jntoken:e.token||"",jntm:e.timestamp||""})}reportJoinResult(e){this.log({evetid:70013,rslt:e?e.code||-1:0,dnsrslt:0})}reportSTSResult(e,n){this.log({evetid:70014,rslt:e,asty:1,reqtm:Date.now()-n})}reportLeaveInvoked(){this.log({evetid:70015})}reportSEIMessage(e,n,o,u,g){this.log({evetid:40301,args:this.data2String({tm:Date.now(),sei_pt:e,sei_len:n,sei_rep:o,sei_delay:u,sei_key:g})})}reportConnectionLatencyEvent(e,n,o,u,g,c,s=!1){const d={ageniid:this.getCustomField("ageniid")},l=Qe({tm:g||Date.now(),ntptm:c||this.ntpClock.now(),stage:e,status:n,calid:o,tckid:u,cltp:1,http:s?1:0},d);this.log({evetid:12001,args:this.data2String(l)})}log(e){e&&(e.tm=e.tm||new Date().getTime(),ke.debug("[ConsoleLogger]","log",e),this.logClient.sendReport(e))}data2String(e){let n="";for(let o in e)n.length&&(n+="&"),n+=o.startsWith("_")?e[o]:`${o}=${e[o]}`;return n}};W(LS,"staticClient");let AT=LS;const US=class il extends Ei{constructor(e){super(),W(this,"ws"),W(this,"socketStatus",0),W(this,"wsUrl",""),W(this,"lastConnectStartTime",0),W(this,"connectRetryMinTimeGap",5e3),W(this,"shouldReconnect",!0),W(this,"connectRetryCount",0),W(this,"gotErr",!1),W(this,"closedByInvoke",!0),W(this,"isReconnecting",!1),W(this,"networkAvailableChecked",!0),W(this,"reconnectTimeoutId",0),e&&(this.connectRetryMinTimeGap=e),this.onOpen=this.onOpen.bind(this),this.onMessage=this.onMessage.bind(this),this.onError=this.onError.bind(this),this.onClose=this.onClose.bind(this)}get connectUrl(){return this.wsUrl}get connectStatus(){return this.socketStatus}start(e){this.wsUrl=e,this.initWebSocket()}send(e){return!(!this.ws||this.socketStatus!==2)&&(this.ws.send(JSON.stringify(e)),!0)}close(){this.closedByInvoke=!0,this.uninitWebsocket()}markShouldReconnect(e){this.shouldReconnect=e}reconnect(){this.reconnectTimeoutId&&(clearTimeout(this.reconnectTimeoutId),this.reconnectTimeoutId=0),this.emit("onWillReconnect"),this.shouldReconnect?(this.emit("onReconnectStart"),this.isReconnecting=!0,this.initWebSocket()):this.emit("onConnectFail")}onOpen(e){ke.info(`[${il.logName}]`,"onOpen"),this.socketStatus=2,this.connectRetryCount=0,this.shouldReconnect=!0,this.networkAvailableChecked=!1,this.closedByInvoke=!1,this.gotErr=!1,this.isReconnecting=!1,this.emit("onOpen",e)}onMessage(e){this.emit("onMessage",e)}onError(e){this.isReconnecting&&this.emit("onReconnectFail",e),this.emit("onError",e),this.isReconnecting=!1,this.socketStatus!==2&&ei.isNetworkAvailable().then(n=>{n&&console.error(il.logName,"onError, Network is available, token may be invalid")})}onClose(e){return pe(this,null,function*(){if(this.closedByInvoke)this.socketStatus=0;else{if(ke.info(`[${il.logName}]`,`onClose, code: ${e.code}, reason: ${e.reason}, status: ${status}, retryCount: ${this.connectRetryCount}`),(yield ei.isNetworkAvailable())&&!this.networkAvailableChecked)return this.reconnect(),void(this.networkAvailableChecked=!0);if(this.connectRetryCount||this.emit("onNetworkError"),!this.reconnectTimeoutId){this.connectRetryCount+=1;const n=Date.now()-this.lastConnectStartTime;n>=this.connectRetryMinTimeGap?this.reconnect():this.reconnectTimeoutId=window.setTimeout(()=>{this.reconnect()},this.connectRetryMinTimeGap-Math.max(0,n))}this.socketStatus=0,this.emit("onClose",e)}})}initWebSocket(){this.uninitWebsocket(),this.socketStatus=1,this.lastConnectStartTime=Date.now(),this.ws=new WebSocket(this.wsUrl),this.ws.addEventListener("open",this.onOpen),this.ws.addEventListener("message",this.onMessage),this.ws.addEventListener("error",this.onError),this.ws.addEventListener("close",this.onClose)}uninitWebsocket(){this.ws&&(this.ws.removeEventListener("open",this.onOpen),this.ws.removeEventListener("message",this.onMessage),this.ws.removeEventListener("error",this.onError),this.ws.removeEventListener("close",this.onClose),this.ws.readyState!==WebSocket.CLOSED&&this.ws.close(),this.ws=void 0,this.socketStatus=0)}};W(US,"logName","Socket");let CT=US;const xS=class Cr extends Ei{constructor(e,n,o,u,g,c){super(),W(this,"authInfo"),W(this,"userName"),W(this,"channelProfile"),W(this,"clientRole"),W(this,"slsReporter"),W(this,"wsClient"),W(this,"packageCreator"),W(this,"keepAliveTimer",0),W(this,"lastKeepAliveResponseTime",0),W(this,"maxConnectRetryDuration",90),W(this,"packageCache",new Map),W(this,"isFirstConnect",!0),W(this,"aliveChecker",0),W(this,"reconnectData"),W(this,"joinChannelExtraData"),this.authInfo=e,this.userName=n,this.packageCreator=new Sl(e,n),this.channelProfile=o,this.clientRole=u,this.slsReporter=g,c&&(this.maxConnectRetryDuration=c),this.wsClient=new CT,this.wsClient.on("onOpen",this.onOpen.bind(this)),this.wsClient.on("onMessage",this.onMessage.bind(this)),this.wsClient.on("onError",this.onError.bind(this)),this.wsClient.on("onClose",this.onClose.bind(this)),this.wsClient.on("onConnectFail",this.onConnectFail.bind(this)),this.wsClient.on("onAuthInvalid",this.onAuthInvalid.bind(this)),this.wsClient.on("onNetworkError",this.onNetworkError.bind(this)),this.wsClient.on("onWillReconnect",this.onWillReconnect.bind(this)),this.wsClient.on("onReconnectStart",this.onReconnectStart.bind(this)),this.wsClient.on("onReconnectFail",this.onReconnectFail.bind(this))}get retryCount(){return this.wsClient.connectRetryCount}destroy(){this.lastKeepAliveResponseTime=0,this.close()}start(e,n){this.joinChannelExtraData=n,this.wsClient.start(e)}startKeepAlive(){this.keepAliveTimer===0&&(this.keepAliveTimer=window.setInterval(()=>{let e=this.packageCreator.createKeepAlivePackage();this.sendPackage(e)},5e3)),this.checkAlive()}stopKeepAlive(){this.keepAliveTimer!==0&&(clearInterval(this.keepAliveTimer),this.keepAliveTimer=0),this.aliveChecker&&(window.clearTimeout(this.aliveChecker),this.aliveChecker=0)}sendPkgCache(){this.packageCache.forEach(e=>{this.wsClient.send(e)})}leave(){let e=this.packageCreator.createLeavePackage();this.sendPackage(e)}reportStatus(e){let n=this.packageCreator.createStatusPackage(e);this.sendPackage(n)}publish(e){const n=e,{l1ip:o}=n,u=jn(n,["l1ip"]);let g=this.packageCreator.createPublishPackage();g.data.users=[],g.data.l1ip=o,u.subscribe.signal=this.wsClient.connectUrl;const{tracks:c,resume:s}=u;let d="7.2.1";d&&(d=d.split("-")[0]),c.forEach(l=>{const{codec:p,ssrc:S}=l;l.userdata=JSON.stringify({sdk_version:d,codec:p}),l.ssrc=`${S}`,s&&(l.attr={reason:"reconnect"})}),g.data.users.push(u),this.sendPackage(g)}roleUpdate(e){let n=this.packageCreator.createRoleUpdatePackage();n.data.clientrole=e,this.sendPackage(n)}refreshUrl(e){const n=this.packageCreator.createRefreshUrlPackage();n.data=Qe(Vr(Qe({},n.data),{sessionid:n.header.sessionid}),e),this.sendPackage(n)}refreshAuthInfo(e){this.authInfo=e,this.packageCreator.refreshAuthInfo(e)}close(){ke.info(`[${Cr.logName}] close`),this.stopKeepAlive(),this.wsClient.off("onOpen",this.onOpen.bind(this)),this.wsClient.off("onMessage",this.onMessage.bind(this)),this.wsClient.off("onError",this.onError.bind(this)),this.wsClient.off("onClose",this.onClose.bind(this)),this.wsClient.off("onConnectFail",this.onConnectFail.bind(this)),this.wsClient.off("onAuthInvalid",this.onAuthInvalid.bind(this)),this.wsClient.off("onReconnectStart"),this.wsClient.off("onReconnectFail"),this.wsClient.close()}sendPackage(e){[ci.KEEPALIVE,ci.RECONNECT,ci.JOINCHANNEL].includes(e.msgtype)||this.packageCache.set(e.tid,e),this.wsClient.send(e),e.msgtype!==ci.KEEPALIVE&&this.slsReporter.reportRoomServerEvent(!0,e.msgtype,e.tid,e)}updateReconnectData(e){this.reconnectData=e}onOpen(){if(ke.info(`[${Cr.logName}] onOpen`),this.isFirstConnect){let e=this.packageCreator.createJoinPackage(this.joinChannelExtraData);e.data.configure={channelprofile:this.channelProfile},this.channelProfile!==Un.AliRtcSdkInteractiveLive&&this.channelProfile!==Un.AliRtcSdkInteractiveWithLowLatencyLive||(e.data.configure.clientrole=this.clientRole),this.sendPackage(e)}else{this.stopKeepAlive();const e=this.packageCreator.createReconnectPackage(this.reconnectData);this.sendPackage(e)}}onMessage(e){try{let n=JSON.parse(e.data);this.packageCache.delete(n.tid),this.onRecvMessage(n),n!=null&&n.msgtype&&n?.msgtype!==ci.KEEPALIVE&&this.slsReporter.reportRoomServerEvent(!1,n.msgtype,n.tid,n)}catch(n){ke.warn(`[${Cr.logName}] onMessage err`,n,e)}}onError(e){ke.warn(`[${Cr.logName}] onError`,e),this.isFirstConnect&&this.onConnectFail()}onConnectFail(){ke.warn(`[${Cr.logName}] onConnectFail`);const e=new Ve(je.ERR_INNER,"Signaling connect failed.");this.isFirstConnect?this.emit("onJoinChannelResult",e):this.emit("onConnectFail",e)}onAuthInvalid(){ke.warn(`[${Cr.logName}] onAuthInvalid`),this.isFirstConnect&&this.emit("onAuthInvalid")}onNetworkError(){ke.warn(`[${Cr.logName}] onNetworkError`);const e=new Ve(je.ERR_INNER,"Network error, signaling connect failed.");this.emit("onNetworkError",e)}onClose(e){ke.info(`[${Cr.logName}] onClose`,e),this.stopKeepAlive()}onKeepAliveRsp(){this.emit("onKeepAliveRsp"),this.lastKeepAliveResponseTime=Date.now(),this.checkAlive()}onWillReconnect(){this.lastKeepAliveResponseTime||(this.lastKeepAliveResponseTime=Date.now()),Date.now()-this.lastKeepAliveResponseTime>1e3*this.maxConnectRetryDuration&&this.wsClient.markShouldReconnect(!1)}onReconnectStart(){this.emit("onReconnectStart")}onReconnectFail(){this.emit("onReconnectFail",new Ve(je.ERR_INNER,"signaling reconnect failed."))}checkAlive(){window.clearTimeout(this.aliveChecker),this.aliveChecker=window.setTimeout(()=>{ke.info(`[${Cr.logName}] not alive, reconnect`),this.stopKeepAlive(),this.emit("onReconnectStart"),this.wsClient.reconnect()},15e3)}onRecvMessage(e){switch(e.msgtype!==ci.KEEPALIVE&&ke.info(`[${Cr.logName}] recv msg: ${e.msgtype}`),e.msgtype){case ci.JOINCHANNEL:this.onJoinResult(e);break;case ci.KEEPALIVE:this.onKeepAliveRsp();break;case ci.PUBLISH:this.onPublishResult(e);break;case ci.NOTIFYJOIN:this.onNotifyJoin(e);break;case ci.NOTIFYSTATUS:this.onNotifyStatus(e);break;case ci.LEAVECHANNEL:this.onLeaveResult(e);break;case ci.NOTIFYLEAVE:this.onNotifyLeave(e);break;case ci.NOTIFYPUBLISH:this.onNotifyPublish(e);break;case ci.STATUSREPORT:this.onStatusReport(e);break;case ci.BYE:this.onBye(e);break;case ci.ROLEUPDATE:this.onRoleUpdateResult(e);break;case ci.REFRESHURL:this.onRefreshUrlResult(e);break;case ci.RECONNECT:this.onReconnectResult(e);break;default:this.onUnknownMessage(e)}}onJoinResult(e){this.isFirstConnect=!1,this.emit("onJoinChannelResult",e)}onLeaveResult(e){this.emit("onLeaveResult",e.code,e.tid)}onPublishResult(e){this.emit("onPublishResult",e.code,e.tid,e.description)}onRoleUpdateResult(e){this.emit("onRoleUpdateResult",e.code,e.tid,e.description)}onRefreshUrlResult(e){this.emit("onRefreshUrlResult",e)}onReconnectResult(e){if(e.code===200)this.sendPkgCache(),this.startKeepAlive(),this.emit("onReconnectSuccess",e.data.users);else{const n=new Ve(je.ERR_INNER,`reconnect failed, code: ${e.code};description: ${e.description}`);e.code===403&&(n.code=403),this.emit("onReconnectFail",n),this.close()}}onNotifyJoin(e){let n=this.packageCreator.createResponsePackage(e.tid,e.msgtype);this.wsClient.send(n),e&&e.data&&e.data.users&&this.emit("onNotifyJoin",e.data.users)}onNotifyStatus(e){let n=this.packageCreator.createResponsePackage(e.tid,e.msgtype);this.wsClient.send(n),e.data&&e.data.status&&e.data.status.length&&this.emit("onNotifyStatus",e.data.status)}onNotifyLeave(e){let n=this.packageCreator.createResponsePackage(e.tid,e.msgtype);this.wsClient.send(n),e.data&&e.data.users&&e.data.users.length&&this.emit("onNotifyLeave",e.data.users)}onNotifyPublish(e){let n=this.packageCreator.createResponsePackage(e.tid,e.msgtype);this.wsClient.send(n),e.data&&e.data.users&&e.data.users.length&&this.emit("onNotifyPublish",e.data.users)}onStatusReport(e){this.emit("onStatusReport",e.code,e.tid,e.description)}onBye(e){this.stopKeepAlive(),this.emit("onBye",e.reason,e.description)}onUnknownMessage(e){this.emit("onUnknownMessage",e)}};W(xS,"logName","RSMessageCenter");let wT=xS;var DT=Object.defineProperty,OT=Object.getOwnPropertyDescriptor,Eh=(i,e,n,o)=>{for(var u,g=OT(e,n),c=i.length-1;c>=0;c--)(u=i[c])&&(g=u(e,n,g)||g);return g&&DT(e,n,g),g},rr;const rl=(rr=class extends Ei{constructor(i,e,n,o=Dr.prod){super(),W(this,"messageCenter"),W(this,"authInfo"),W(this,"userName"),W(this,"channelProfile"),W(this,"clientRole"),W(this,"slsReporter"),W(this,"reconnectData"),W(this,"roomServerUri",""),this.channelProfile=i,this.clientRole=e,this.slsReporter=n,this.reconnectData={role:{channelprofile:i,clientrole:e}};const u=o===Dr.pre?ua.pre:ua.prod;this.roomServerUri=`wss://${u}/roomserver/v1/ws`}updateReconnectData(i){var e;this.reconnectData=i,(e=this.messageCenter)==null||e.updateReconnectData(this.reconnectData)}reset(){ke.info("[roomsig] reset"),this.messageCenter&&(this.messageCenter.destroy(),this.messageCenter=void 0),this.authInfo=void 0}join(i,e,n,o){return pe(this,null,function*(){return new Promise((u,g)=>{const c={};this.authInfo=i,this.userName=e,this.messageCenter=new wT(i,e,this.channelProfile,this.clientRole,this.slsReporter,n),this.initMessageCenter(),this.messageCenter.once("onJoinChannelResult",d=>{var l,p,S;if(ke.info(`[${rr.logName}]`,"join result: ",d),c.taskretrynum=((l=this.messageCenter)==null?void 0:l.retryCount)||0,d.code==200){(p=this.messageCenter)==null||p.sendPkgCache(),(S=this.messageCenter)==null||S.startKeepAlive();let T=d.data;T.tid=d.tid,T.users=d.data.users,T.timestamp=d.timestamp,c.est&&(c.joinconnecttc=Date.now()-c.est),this.slsReporter.reportJoinConnection(c),u(T)}else this.reset(),g(this.handleSignalError(d.code,d.reason,je.ERR_JOIN_CHANNEL_FAILED))}),this.messageCenter.once("onAuthInvalid",()=>{this.reset(),g(new Ve(je.ERR_JOIN_BAD_TOKEN,"join failed because authentication failed"))}),ke.info(`[${rr.logName}]`,"start ws connecting roomserver and auto join when connected");const s={appid:this.authInfo.appId,channelid:this.authInfo.channelId,userid:this.authInfo.userId,nonce:this.authInfo.nonce||"",timestamp:this.authInfo.timestamp,token:this.authInfo.token,authtype:"app",tid:Er()};i.role&&(s.tokenrole=i.role),c.est=Date.now(),this.messageCenter.start(this.roomServerUri+"?"+ei.queryingParam(s),o)})})}leave(){return ke.info("[roomsig] leave .."),new Promise((i,e)=>{this.messageCenter?(this.messageCenter.on("onLeaveResult",(n,o)=>{ke.info(`[${rr.logName}]`,"recv leave response "+n),n===200?(this.updateReconnectData(),this.reset(),i({tid:o})):e(this.handleSignalError(n,"leave error"))}),ke.info(`[${rr.logName}]`,"send leave request"),this.messageCenter.leave()):(ke.info(`[${rr.logName}]`,"no message center, ok to leave"),i({tid:""}))})}publish(i){return new Promise((e,n)=>{var o;this.messageCenter?(this.messageCenter.once("onPublishResult",(u,g,c)=>{ke.info(`[${rr.logName}]`,"recv pubish response "+u),u===200?(this.updateReconnectData(Vr(Qe({},this.reconnectData),{publish:{users:[i]}})),e({tid:g})):n(this.handleSignalError(u,`publish error, ${c}`))}),this.authInfo&&(i.sessionid=(o=this.authInfo.sessionId)!=null?o:""),i.callid||(i.callid=Er()),ke.info(`[${rr.logName}]`,"assign callid "+i.callid+" and send publish request"),this.messageCenter.publish(i)):n(this.handleSignalError(-1,"publish error, no message center"))})}roleUpdate(i){return new Promise((e,n)=>{this.messageCenter?(this.messageCenter.on("onRoleUpdateResult",(o,u,g)=>{var c,s;ke.info(`[${rr.logName}]`,"recv role update response "+o),o===200?((s=(c=this.reconnectData)==null?void 0:c.role)!=null&&s.clientrole&&(this.reconnectData.role.clientrole=i,this.updateReconnectData(this.reconnectData)),e({tid:u})):n(this.handleSignalError(o,`role update error, ${g}`))}),this.messageCenter.roleUpdate(i)):n(this.handleSignalError(-1,"role update error, no message center"))})}setChannelProfile(i){this.channelProfile=i}refreshUrl(i){return ke.info(`[${rr.logName}]`,"refreshUrl .."),new Promise((e,n)=>{this.messageCenter?(this.messageCenter.on("onRefreshUrlResult",o=>{const{code:u,description:g,data:c={}}=o||{};ke.info("recv refresh url response "+u),u===200?e(c):n(this.handleSignalError(u,`refresh url error, ${g}`))}),ke.info("send refresh url request"),this.messageCenter.refreshUrl(i)):n(this.handleSignalError(-1,"refresh url error, no message center"))})}reportStatus(i){return ke.info(`[${rr.logName}]`,"reportStatus "+i),new Promise((e,n)=>{this.messageCenter?(this.messageCenter.once("onStatusReport",(o,u)=>{o===200?e():n(new Ve(o,u))}),this.messageCenter.reportStatus(i)):n(new Ve(-1,"No messageCenter"))})}handleSignalError(i,e,n=je.ERR_INNER){return new Ve(n,`signal error: code - ${i}; description - ${e}`)}refreshAuthInfo(i){return pe(this,null,function*(){var e;this.authInfo&&(this.authInfo=i,(e=this.messageCenter)==null||e.refreshAuthInfo(this.authInfo))})}initMessageCenter(){var i,e,n,o,u,g,c,s,d,l,p,S,T;(i=this.messageCenter)==null||i.on("onKeepAliveRsp",()=>{this.emit("onKeepAliveRsp")}),(e=this.messageCenter)==null||e.on("onNotifyJoin",y=>{this.emit("onNotifyJoin",y)}),(n=this.messageCenter)==null||n.on("onNotifyStatus",y=>{this.emit("onNotifyStatus",y)}),(o=this.messageCenter)==null||o.on("onNotifyLeave",y=>{this.emit("onNotifyLeave",y)}),(u=this.messageCenter)==null||u.on("onNotifyPublish",y=>{this.emit("onNotifyPublish",y)}),(g=this.messageCenter)==null||g.on("onBye",(y,R)=>{this.emit("onBye",y,R)}),(c=this.messageCenter)==null||c.on("onReconnectStart",()=>{this.emit("onReconnectStart")}),(s=this.messageCenter)==null||s.on("onReconnectSuccess",y=>{this.emit("onReconnectSuccess",y)}),(d=this.messageCenter)==null||d.on("onReconnectFail",y=>{this.emit("onReconnectFail",y)}),(l=this.messageCenter)==null||l.on("onConnectFail",y=>{this.emit("onConnectFail",y),this.reset()}),(p=this.messageCenter)==null||p.on("onNetworkError",y=>{this.emit("onNetworkError",y)}),(S=this.messageCenter)==null||S.on("onAuthInvalid",()=>{this.emit("onAuthInvalid")}),(T=this.messageCenter)==null||T.on("onUnknownMessage",y=>{this.emit("onUnknownMessage",y)})}},W(rr,"logName","RoomServerSignaling"),rr);Eh([ge()],rl.prototype,"join"),Eh([ge()],rl.prototype,"publish"),Eh([ge()],rl.prototype,"roleUpdate");let IT=rl;const MT=6e5,BS=class zh extends Ei{constructor(e,n){super(),W(this,"env"),W(this,"authInfo"),W(this,"timer"),W(this,"slsReporter"),W(this,"expiration",0),W(this,"skipTime",0),W(this,"requestToken",()=>pe(this,null,function*(){if(this.skipTime=0,!this.authInfo)return;const{appId:o,channelId:u,userId:g,nonce:c="",token:s,timestamp:d,sessionId:l,role:p}=this.authInfo;let S="https://gw.rtn.aliyuncs.com";this.env===Dr.pre&&(S="https://pgw.rtn.aliyuncs.com");const T=`${S}/gslb/v1/stsupdate?appid=${o}&channelid=${u}&userid=${g}&nonce=${c}&token=${s}&timestamp=${d}&session=${l}${p?`&tokenrole=${p}`:""}&slstoken=true&osstoken=true&tokensid=false`,y=Date.now();fetch(T).then(R=>R.json()).then(R=>{var v,h;if(R.code!==0)throw new Error;{const m=(v=R.data)==null?void 0:v.oss,_=(h=R.data)==null?void 0:h.sls;this.expiration=m.expiration||_.expiration,this.emit("onTokenUpdate",m,_),ke.event(`[${zh.logName}]`,"getToken",m,_)}this.slsReporter.reportSTSResult(200,y)}).catch(R=>{this.slsReporter.reportSTSResult(-1,y),ke.error(`[${zh.logName}]`,"getToken",R.message)})})),this.slsReporter=e,this.env=n}refreshAuthInfo(e){this.authInfo=e}startSTSUpdate(e){this.authInfo=e,this.requestToken(),this.timer&&clearInterval(this.timer),this.timer=window.setInterval(()=>{this.expiration&&Math.floor((Date.now()+9e5)/1e3)<this.expiration&&this.skipTime<12?this.skipTime+=1:this.requestToken()},MT)}clear(){this.timer&&clearInterval(this.timer)}};W(BS,"logName","StsManager");let NT=BS;var kT=Object.defineProperty,PT=Object.getOwnPropertyDescriptor;class uf extends Ei{constructor(e,n,o,u=Dr.prod){super(),W(this,"signaling"),W(this,"authInfo"),W(this,"userName"),W(this,"channelProfile"),W(this,"clientRole"),W(this,"env",Dr.prod),W(this,"maxSignalingReconnectDuration"),W(this,"stsManager"),W(this,"slsReporter"),this.channelProfile=e,this.clientRole=n,this.env=u,this.slsReporter=o,this.stsManager=new NT(o,u)}reset(){var e;ke.info("[signalingmanager] reset"),(e=this.signaling)==null||e.reset(),this.stsManager.clear(),this.signaling=void 0,this.authInfo=void 0}join(e,n=e.userId,o,u,g){return this.maxSignalingReconnectDuration=o,this.userName=n,new Promise((c,s)=>{this.signaling?s(new Ve(je.ERR_JOIN_ALREADY_JOINED,"already joined")):(ke.info("[signalingmanager] create signaling"),this.signaling=new IT(this.channelProfile,this.clientRole,this.slsReporter,this.env),this.initSignaling(),u&&(u.rs=Date.now()),this.signaling.join(e,n,o,g).then(d=>{this.authInfo=e,u&&(u.re=Date.now()),c(d)}).catch(d=>{this.reset(),s(d)}),this.stsManager.startSTSUpdate(e))})}retryJoin(){const e=this.authInfo;this.reset(),e&&this.join(e,this.userName,this.maxSignalingReconnectDuration)}leave(){return new Promise((e,n)=>{this.signaling?this.signaling.leave().then(o=>{this.reset(),e(o)}).catch(o=>{n(o)}):e({tid:""})})}publish(e){return new Promise((n,o)=>{var u;this.signaling&&this.authInfo?(e.userid=this.authInfo.userId,e.displayname=(u=this.userName)!=null?u:this.authInfo.userId,this.signaling.publish(e).then(g=>{n(g)}).catch(g=>{o(g)})):o(new Ve(je.ERR_SDK_PUBLISH_NOT_JOIN_CHANNEL,"no signaling"))})}reportStatus(e){return new Promise((n,o)=>{this.signaling?this.signaling.reportStatus(e).then(()=>{n()}).catch(u=>{o(u)}):o(new Ve(-1,"no signaling"))})}setClientRole(e){return pe(this,null,function*(){const n=this.clientRole;if(!this.signaling)return void(this.clientRole=e);const o=Date.now();try{const u=yield this.signaling.roleUpdate(e);return this.slsReporter.reportRoleUpdateResult(n,e,Date.now()-o,0),u}catch(u){this.slsReporter.reportRoleUpdateResult(n,e,Date.now()-o,u.code||-1)}})}setChannelProfile(e){this.signaling?this.signaling.setChannelProfile(e):this.channelProfile=e}refreshUrl(e){return this.signaling?this.signaling.refreshUrl(e):Promise.reject(new Ve(je.ERR_SDK_INVALID_STATE,"should join first"))}refreshAuthInfo(e){return pe(this,null,function*(){var n;try{this.authInfo&&(this.authInfo=Qe(Qe({},this.authInfo),e),(n=this.signaling)==null||n.refreshAuthInfo(this.authInfo),this.stsManager.refreshAuthInfo(this.authInfo))}catch(o){throw o}})}initSignaling(){var e,n,o,u,g,c,s,d,l,p,S,T,y,R;(e=this.signaling)==null||e.on("onKeepAliveRsp",this.onKeepAliveRsp.bind(this)),(n=this.signaling)==null||n.on("onNotifyJoin",this.onNotifyJoin.bind(this)),(o=this.signaling)==null||o.on("onNotifyStatus",this.onNotifyStatus.bind(this)),(u=this.signaling)==null||u.on("onNotifyLeave",this.onNotifyLeave.bind(this)),(g=this.signaling)==null||g.on("onNotifyPublish",this.onNotifyPublish.bind(this)),(c=this.signaling)==null||c.on("onBye",this.onBye.bind(this)),(s=this.signaling)==null||s.on("onReconnectStart",this.onReconnectStart.bind(this)),(d=this.signaling)==null||d.on("onReconnectSuccess",this.onReconnectSuccess.bind(this)),(l=this.signaling)==null||l.on("onReconnectFail",this.onReconnectFail.bind(this)),(p=this.signaling)==null||p.on("onConnectFail",this.onConnectFail.bind(this)),(S=this.signaling)==null||S.on("onNetworkError",this.onNetworkError.bind(this)),(T=this.signaling)==null||T.on("onAuthInvalid",this.onAuthInvalid.bind(this)),(y=this.signaling)==null||y.on("onError",this.onError.bind(this)),(R=this.signaling)==null||R.on("onUnknownMessage",this.onUnknownMessage.bind(this))}onKeepAliveRsp(){this.emit("onKeepAliveRsp")}onNotifyJoin(e){this.emit("onNotifyJoin",e)}onNotifyStatus(e){this.emit("onNotifyStatus",e)}onNotifyLeave(e){this.emit("onNotifyLeave",e)}onNotifyPublish(e){this.emit("onNotifyPublish",e)}onBye(e,n){this.emit("onBye",e,n)}onConnectFail(e){this.reset(),this.emit("onConnectFail",e)}onNetworkError(e){this.emit("onNetworkError",e)}onAuthInvalid(){}onReconnectStart(){this.emit("onReconnectStart")}onReconnectSuccess(e){this.emit("onReconnectSuccess",e)}onReconnectFail(e){this.emit("onReconnectFail",e)}onError(e){this.emit("onError",e)}onUnknownMessage(e){this.emit("onUnknownMessage",e)}}W(uf,"logName","SignalingManager");((i,e,n,o)=>{for(var u,g=PT(e,n),c=i.length-1;c>=0;c--)(u=i[c])&&(g=u(e,n,g)||g);g&&kT(e,n,g)})([ge(He)],uf.prototype,"publish");class LT{constructor(e){W(this,"taskProfile"),W(this,"encodeParam"),W(this,"users",[]),W(this,"backgroundColor",0),W(this,"backgrounds",[]),W(this,"watermarks",[]),W(this,"clockWidgets",[]),W(this,"cropMode"),W(this,"mediaProcessMode"),this.taskProfile=e}}class UT{constructor(e,n,o){W(this,"userId"),W(this,"streamType"),W(this,"sourceType"),this.userId=e,this.streamType=n,this.sourceType=o}}class xT{constructor(e,n,o,u=0,g=16777215,c=Rl.NOTO_SERIF_CJKSC_REGULAR){W(this,"x"),W(this,"y"),W(this,"fontSize"),W(this,"zOrder"),W(this,"fontColor"),W(this,"fontType"),this.x=e,this.y=n,this.fontSize=o,this.zOrder=u,this.fontColor=g,this.fontType=c}toJson(e,n){return{x:br(this.x,e),y:br(this.y,n),fonttype:this.fontType,fontsize:this.fontSize,fontcolor:lf(this.fontColor),zorder:this.zOrder}}}var VS=(i=>(i[i.NOT_DISPLAY=0]="NOT_DISPLAY",i[i.ALWAYS=1]="ALWAYS",i[i.WHEN_NO_VIDEO=2]="WHEN_NO_VIDEO",i))(VS||{});class HS{constructor(e,n,o,u,g,c=0,s=1,d=1){W(this,"url"),W(this,"x"),W(this,"y"),W(this,"width"),W(this,"height"),W(this,"alpha"),W(this,"display",1),W(this,"zOrder"),this.url=e,this.x=n,this.y=o,this.width=u,this.height=g,this.zOrder=c,this.alpha=s,this.display=d}toJson(e,n){return{url:this.url,alpha:this.alpha,display:this.display,x:br(this.x,e),y:br(this.y,n),width:br(this.width,e),height:br(this.height,n),zorder:this.zOrder}}}W(HS,"DisplayType",VS);class BT{constructor(e,n,o,u,g=0,c=16777215,s=Rl.NOTO_SERIF_CJKSC_REGULAR){W(this,"text"),W(this,"x"),W(this,"y"),W(this,"fontSize"),W(this,"zOrder"),W(this,"fontColor"),W(this,"fontType"),this.text=e,this.x=n,this.y=o,this.fontSize=u,this.zOrder=g,this.fontColor=c,this.fontType=s}toJson(e,n){return{text:this.text,x:br(this.x,e),y:br(this.y,n),fonttype:this.fontType,fontsize:this.fontSize,fontcolor:lf(this.fontColor),zorder:this.zOrder}}}class VT{constructor(e,n,o,u,g,c=0,s){W(this,"userId"),W(this,"x"),W(this,"y"),W(this,"width"),W(this,"height"),W(this,"zOrder"),W(this,"sourceType"),W(this,"segmentType",pl.LiveTranscodingNoBody),W(this,"images",[]),W(this,"texts",[]),this.userId=typeof e=="number"?e.toString():e,this.x=n,this.y=o,this.width=u,this.height=g,this.zOrder=c,s&&(this.sourceType=s)}toJson(e,n,o,u){const g={paneid:e,majorpane:0,x:br(this.x,n),y:br(this.y,o),width:br(this.width,n),height:br(this.height,o),zorder:this.zOrder,userid:this.userId,images:this.images.map(c=>c.toJson(n,o)),texts:this.texts.map(c=>c.toJson(n,o))};return this.sourceType&&vs[this.sourceType]?g.sourcetype=vs[this.sourceType]:g.sourcetype=vs[Rs.LiveTranscodingCamera],this.segmentType&&u===cf.LiveTranscodingVirtualBackground?g.segmenttype=this.segmentType:g.segmenttype=pl.LiveTranscodingNoBody,g}}class HT{constructor(e){W(this,"_updateables"),W(this,"_useWebworker"),W(this,"_inited"),W(this,"_active"),W(this,"_previousRAFTime"),W(this,"_previousWorkerTime"),W(this,"_webWorkerString"),W(this,"_webWorker"),W(this,"_intervalThreshold"),W(this,"_rafId"),this._updateables=[],this._useWebworker=!1,this._inited=!1,this._active=!1,this._previousRAFTime=void 0,this._previousWorkerTime=void 0,this._intervalThreshold=e&&e>0&&e<=60?1/e:.1,this._webWorkerString=`
          var running = false;
          function tick(){
              postMessage(Date.now());
              if (running){
                  setTimeout(tick, ${Math.floor(1e3*this._intervalThreshold)});
              }
          }
          self.addEventListener('message',function(msg){
              var data = msg.data;
              if (data === 'start'){
                  running = true;
                  tick();
              }
              if (data === 'stop') running = false;
          });`,this._webWorker=void 0}_initWebWorker(){window.URL=window.URL||window.webkitURL;let e=new Blob([this._webWorkerString],{type:"application/javascript"});this._webWorker=new Worker(URL.createObjectURL(e)),this._webWorker.onmessage=n=>{let o=n.data;this._updateWorkerTime(o)}}_lostVisibility(){var e;this._previousWorkerTime=Date.now(),this._useWebworker=!0,this._webWorker||this._initWebWorker(),this._active&&((e=this._webWorker)==null||e.postMessage("start"))}_gainedVisibility(){this._useWebworker=!1,this._previousRAFTime=void 0,this._webWorker&&this._webWorker.postMessage("stop"),this._active&&(this._rafId=requestAnimationFrame(this._updateRAFTime.bind(this)))}_init(){if(window.Worker){if(document.hidden===void 0)return window.addEventListener("focus",this._gainedVisibility.bind(this)),void window.addEventListener("blur",this._lostVisibility.bind(this));document.addEventListener("visibilitychange",()=>{document.hidden===!0?this._lostVisibility():this._gainedVisibility()},!1)}}_updateWorkerTime(e){let n=(e-(this._previousWorkerTime||0))/1e3;n>this._intervalThreshold&&(this._update(n),this._previousWorkerTime=e)}_updateRAFTime(e){this._previousRAFTime===void 0&&(this._previousRAFTime=e);let n=(e-this._previousRAFTime)/1e3;n>this._intervalThreshold&&(this._update(n),this._previousRAFTime=e),!this._useWebworker&&this._active?this._rafId=requestAnimationFrame(this._updateRAFTime.bind(this)):this._rafId=0}_update(e){for(let n=0;n<this._updateables.length;n++)this._updateables[n]._update(typeof e=="number"?e:parseFloat(e))}register(e){this._updateables.push(e),this._inited===!1&&(this._inited=!0,this._init()),this._active===!1&&(this._rafId=requestAnimationFrame(this._updateRAFTime.bind(this)),this._active=!0)}unregister(e){const n=this._updateables.indexOf(e);n!==-1&&this._updateables.splice(n,1),this._updateables.length===0&&(this._active=!1,this._rafId&&(cancelAnimationFrame(this._rafId),this._rafId=0),this._useWebworker&&this._webWorker&&this._webWorker.postMessage("stop"))}}class jT extends zn{constructor(e,n=10){super("AliRtcImageHolder"),W(this,"url"),W(this,"image"),W(this,"canvas"),W(this,"mediaStream"),W(this,"updateableManager"),W(this,"updateable"),W(this,"hasVideoTrack",!1),this.url=e,this.canvas=document.createElement("canvas"),this.canvas.width=1280,this.canvas.height=720,this.drawImageToCanvas(),this.updateableManager=new HT(n)}get initOptions(){return{imageUrl:""}}setOptions(e){e.imageUrl&&(this.options=e,e.imageUrl!==this.url&&this.drawImageToCanvas())}drawImageToCanvas(){return pe(this,null,function*(){if(!this.url)return;const e=this.canvas.getContext("2d"),n=document.createElement("img");let o;this.image=n,n.crossOrigin="anonymous",n.src=this.url;const{width:u,height:g}=yield new Promise(c=>{n.onload=()=>{o&&clearTimeout(o),c({width:n.width||16,height:n.height||16})},n.onerror=()=>{o&&clearTimeout(o),c({width:16,height:16})},o=setTimeout(()=>{c({width:16,height:16})},5e3)});this.canvas.width=u,this.canvas.height=g,e.drawImage(n,0,0,u,g)})}start(){return pe(this,null,function*(){var e;if(!this.url)throw new Error("no image url founded");if(!this.canvas)throw new Error("get canvas error");const n=this.canvas.captureStream(25),o=this.canvas.getContext("2d");return this.image&&this.image.width&&o.drawImage(this.image,0,0,this.image.width,this.image.height),this.mediaStream=n,o.fillStyle="transparent",this.updateable={_update:()=>{o.fillRect(0,0,1,1)}},this.updateableManager.register(this.updateable),(e=n.getVideoTracks())==null?void 0:e[0]})}stop(){var e,n;this.updateable&&(this.updateableManager.unregister(this.updateable),this.updateable=null),(n=(e=this.mediaStream)==null?void 0:e.getVideoTracks()[0])==null||n.stop(),this.mediaStream=void 0}isSupported(){return!0}shouldUpdate(e){return this.hasVideoTrack===!!e.originVideoTrack}process(e){return pe(this,null,function*(){if(this.hasVideoTrack=!!e.originVideoTrack,e.originVideoTrack){const o=e.currentVideoTrack;return o&&o.id===e.originVideoTrack.id||e.updateVideoTrack(e.originVideoTrack),void this.stop()}const n=yield this.start();e.updateVideoTrack(n)})}}class ys{static checkString(e){return typeof e=="string"}static checkNumber(e){return typeof e=="number"}static checkHtmlVideoElement(e){return e&&e.nodeName==="VIDEO"}static checkHtmlAudioElement(e){return e&&e.nodeName==="AUDIO"}static checkAuthInfo(e){return e?e.appId?e.channelId?ys.checkString(e.channelId)?e.userId?ys.checkString(e.userId)?e.timestamp?ys.checkNumber(e.timestamp)?e.token?null:new Ve(je.ERR_JOIN_ERR_JOIN_BAD_PARAMBAD,"no token founded"):new Ve(je.ERR_JOIN_ERR_JOIN_BAD_PARAMBAD,"timestamp is not number"):new Ve(je.ERR_JOIN_ERR_JOIN_BAD_PARAMBAD,"no timestamp founded"):new Ve(je.ERR_JOIN_ERR_JOIN_BAD_PARAMBAD,"userId is not string"):new Ve(je.ERR_JOIN_ERR_JOIN_BAD_PARAMBAD,"no userId founded"):new Ve(je.ERR_JOIN_ERR_JOIN_BAD_PARAMBAD,"channelId is not string"):new Ve(je.ERR_JOIN_ERR_JOIN_BAD_PARAMBAD,"no channelId founded"):new Ve(je.ERR_JOIN_ERR_JOIN_BAD_PARAMBAD,"no appId founded"):new Ve(je.ERR_JOIN_ERR_JOIN_BAD_PARAMBAD,"no authInfo founded")}static checkMediaStreamTrack(e){return e instanceof MediaStreamTrack}static checkVideoEncoderConfiguration(e){return e&&(e.width||e.height||e.frameRate||e.bitrateMax)}}var zT=Object.defineProperty,FT=Object.getOwnPropertyDescriptor,qe=(i,e,n,o)=>{for(var u,g=FT(e,n),c=i.length-1;c>=0;c--)(u=i[c])&&(g=u(e,n,g)||g);return g&&zT(e,n,g),g},Ye;const We=(Ye=class extends Ei{constructor(i){super(),W(this,"channelProfile"),W(this,"clientRole"),W(this,"signalingManager"),W(this,"bizControl"),W(this,"liveTranscoding"),W(this,"maxSignalingReconnectDuration"),W(this,"slsReporter"),W(this,"connectState",Et.AliRtcConnectionStatusInit),W(this,"networkError",!1),W(this,"_audioOnlyMode",!1),W(this,"_authInfoWillExpireTimer",null),W(this,"_authInfoExpiredTimer",null),W(this,"_serverCheckAuthInfoTimestamp",null),W(this,"_localCheckAuthInfoTimestamp",null),W(this,"_proxyAiTid",null),W(this,"_agentParam",null),this.config=i;const e=Date.now();ke.init(),this.slsReporter=new AT(this),this.channelProfile=Un.AliRtcSdkCommunication,this.clientRole=lo.AliRtcSdkLive,this.liveTranscoding=new ET(this.slsReporter),this.signalingManager=new uf(this.channelProfile,this.clientRole,this.slsReporter,i?.env===Dr.pre?Dr.pre:Dr.prod),this.addSignalingManagerListeners(),this.maxSignalingReconnectDuration=i?.maxSignalingReconnectDuration,this.bizControl=new Ii({slsReporter:this.slsReporter,signalingManager:this.signalingManager,parameter:i?.parameter}),this.addBizControlListeners(),this.addPublisherListeners(),this.slsReporter.reportConnectionLatencyEvent(nr.CREATE_ENGINE,Sr.START,"","",e),this.slsReporter.reportConnectionLatencyEvent(nr.CREATE_ENGINE,Sr.END,"","",Date.now()),this.slsReporter.reportSDKCreated(e)}static getSdkVersion(){return yl}static setLogLevel(i){ke.setLogLevel(i)}static getInstance(i){return Ye._instance||(Ye._instance=new Ye(i)),Ye._instance}destroy(){return pe(this,null,function*(){Ye._instance=void 0,yield this.leaveChannel(),yield this.bizControl.clear(),ke.destroy()})}get channel(){return this.bizControl.channel}get userId(){return this.bizControl.userId}get remoteUsers(){return this.bizControl.remoteUsers}get publisher(){return this.bizControl.publisher}get publishAudioStream(){return this.publisher.publishStreams.audio}get isPublishing(){const{publisher:i}=this.bizControl;return!!i&&i.isPublishing}get currentRoleCanPublish(){return this.channelProfile===Un.AliRtcSdkCommunication||this.clientRole===lo.AliRtcSdkInteractive}addPublisherListeners(){this.publisher.on(Ui.Local,i=>{ke.event("[Publisher] Device Status Change",i),this.onLocalDeviceStatusChange(i)}),this.publisher.on(go.VideoTrackEnded,()=>{ke.event("[Publisher] VideoTrack Ended"),this.emit("localDeviceException",ln.AliEngineLocalDeviceTypeCamera,vi.AliEngineLocalDeviceExceptionTypeCameraInterrupt,"")}),this.publisher.on(go.ScreenTrackEnded,()=>{ke.event("[Publisher] ScreenTrack Ended"),this.emit("localDeviceException",ln.AliEngineLocalDeviceTypeDisplay,vi.AliEngineLocalDeviceExceptionTypeDisplayException,"")}),this.publisher.on(go.AudioTrackEnded,()=>{ke.event("[Publisher] AudioTrack Ended"),this.emit("localDeviceException",ln.AliEngineLocalDeviceTypeMic,vi.AliEngineLocalDeviceExceptionTypeMicInterrupt,"")}),this.publisher.on("localDeviceException",(i,e,n="")=>{this.emit("localDeviceException",i,e,n)}),this.publisher.on("audioPublishStateChanged",(i,e,n)=>{var o;this.emit("audioPublishStateChanged",i,e,n,(o=this.channel)!=null?o:"")}),this.publisher.on("videoPublishStateChanged",(i,e,n)=>{var o;this.emit("videoPublishStateChanged",i,e,n,(o=this.channel)!=null?o:"")}),this.publisher.on("dualStreamPublishStateChanged",(i,e,n)=>{var o;this.emit("dualStreamPublishStateChanged",i,e,n,(o=this.channel)!=null?o:"")}),this.publisher.on("screenPublishStateChanged",(i,e,n)=>{var o;this.emit("screenSharePublishStateChanged",i,e,n,(o=this.channel)!=null?o:"")}),this.publisher.on("dataPublishStateChanged",(i,e,n)=>{var o;this.emit("dataPublishStateChanged",i,e,n,(o=this.channel)!=null?o:"")})}occurError(i,e){ke.event(`[${Ye.logName}]`,"Occur Error",i,e),this.emit("onOccurError",i,e),this.emit("occurError",i,e)}addBizControlListeners(){this.bizControl.rtsManager.on("disconnected",()=>pe(this,null,function*(){ke.event(`[${Ye.logName}]`,"RTS Disconnected"),(yield ei.isNetworkAvailable())?this.onNetworkRecovery():this.onNetworkError()})),this.bizControl.rtsManager.on("subscribeexceeds",()=>pe(this,null,function*(){ke.event(`[${Ye.logName}]`,"RTS SubscribeExceeds"),this.bizControl.rtsManager.clear(),yield this.resumePublishForNetworkRecovery(),yield this.resumeSubList()})),this.bizControl.rtsManager.on("seimessage",(i,e,n)=>{const o=this.remoteUsers.find(u=>u.streamUrl===i);o&&this.emit("mediaExtensionMsgReceived",o.userId,n,e)}),this.bizControl.on(Ui.Remote,(i,e)=>{ke.event(`[${Ye.logName}]`,"RemoteUser Device Status Change",i,e)}),this.bizControl.on("remoteUserJoin",(i,e)=>{this.emit("remoteUserOnLineNotify",i,e)}),this.bizControl.on("remoteTrackAvailableChange",(i,e,n)=>{this.emit("remoteTrackAvailableNotify",i,e,n)}),this.bizControl.on("audioSubscribeStateChanged",(i,e,n,o,u)=>{this.emit("audioSubscribeStateChanged",i,e,n,o,u)}),this.bizControl.on("videoSubscribeStateChanged",(i,e,n,o,u)=>{this.emit("videoSubscribeStateChanged",i,e,n,o,u)}),this.bizControl.on("screenSubscribeStateChanged",(i,e,n,o,u)=>{this.emit("screenShareSubscribeStateChanged",i,e,n,o,u)}),this.bizControl.on("dataSubscribeStateChanged",(i,e,n,o,u)=>{this.emit("dataSubscribeStateChanged",i,e,n,o,u)}),this.bizControl.on("userAudioMuted",(i,e)=>{this.emit("userAudioMuted",i,e)}),this.bizControl.on("userVideoMuted",(i,e)=>{this.emit("userVideoMuted",i,e)}),this.bizControl.on("userScreenMuted",(i,e)=>{this.emit("userScreenMuted",i,e)}),this.bizControl.on("audioVolume",i=>{this.emit("audioVolume",i)}),this.bizControl.on("remoteAudioAutoPlayFail",i=>{this.emit("remoteAudioAutoPlayFail",i)}),this.bizControl.on("remoteVideoAutoPlayFail",(i,e)=>{this.emit("remoteVideoAutoPlayFail",i,e)}),this.bizControl.on("remoteAudioPlayError",(i,e)=>{this.emit("remoteAudioPlayError",i,e)}),this.bizControl.on("remoteVideoPlayError",(i,e)=>{this.emit("remoteVideoPlayError",i,e)}),this.bizControl.on("rtcStats",i=>{this.emit("rtcStats",i)}),this.bizControl.on("rtcLocalAudioStats",i=>{this.emit("rtcLocalAudioStats",i)}),this.bizControl.on("rtcLocalVideoStats",i=>{this.emit("rtcLocalVideoStats",i)}),this.bizControl.on("rtcRemoteAudioStats",i=>{this.emit("rtcRemoteAudioStats",i)}),this.bizControl.on("rtcRemoteVideoStats",i=>{this.emit("rtcRemoteVideoStats",i)}),this.bizControl.on("remoteSubscribeError",(i,e)=>{this.occurError(i,e),this.slsReporter.reportError(i)}),this.bizControl.on("occurError",(i,e)=>{this.occurError(i,e),this.slsReporter.reportError(i)}),this.bizControl.on("remoteDataChannelMessage",(i,e)=>{this.emit("dataChannelMsg",i,e)}),this.bizControl.on("remoteUserSubscribedDataChannel",i=>{this.emit("remoteUserSubscribedDataChannel",i)})}addSignalingManagerListeners(){this.signalingManager.on("onKeepAliveRsp",()=>{this.networkError&&(ke.event("[Signaling] Receive KeepAlive Response",`networkError: ${this.networkError}`),this.onNetworkRecovery())}),this.signalingManager.on("onNotifyJoin",i=>{ke.event("[Signaling] Notify Join ",i),this.handleUsersJoin(i)}),this.signalingManager.on("onNotifyStatus",i=>{ke.event("[Signaling] Notify Status ",i),i.forEach(e=>{this.bizControl.updateRemoteUserDeviceStatus(e)})}),this.signalingManager.on("onNotifyLeave",i=>{ke.event("[Signaling] Notify Leave ",i),i.forEach(e=>pe(this,null,function*(){yield this.bizControl.removeLeftUser(e),this.emit("remoteUserOffLineNotify",e.userid,e.leavecode)}))}),this.signalingManager.on("onBye",(i,e)=>{ke.event("[Signaling] Bye ",i,e),this.slsReporter.reportError({message:`reason: ${i}, description: ${e}`}),this.emit("bye",i),this.signalingManager.reset(),this.leaveChannel(),this.slsReporter.reportBye(i)}),this.signalingManager.on("onConnectFail",i=>{ke.event("[Signaling] Connect Failed ",i),this.onError(i),this.backToUnpublishStatus(),this.bizControl.leave(),this.signalingManager.reset(),this.connectState=Et.AliRtcConnectionStatusFailed,this.emit("connectionStatusChange",Et.AliRtcConnectionStatusFailed,an.AliRtcConnectionChangedNetworkInterrupted)}),this.signalingManager.on("onNetworkError",i=>{this.slsReporter.reportWarning("signaling network error"),ke.event("[Signaling] Network error ",i),this.onNetworkError()}),this.signalingManager.on("onAuthInvalid",()=>{ke.event("[Signaling] Auth Invalid")}),this.signalingManager.on("onReconnectStart",()=>{this.onNetworkError(),ke.event("[Signaling] Reconnect Start "),this.connectState=Et.AliRtcConnectionStatusReconnecting,this.emit("connectionStatusChange",Et.AliRtcConnectionStatusReconnecting,an.AliRtcConnectionSignalingConnecting)}),this.signalingManager.on("onReconnectSuccess",i=>{ke.event("[Signaling] Reconnect Success ",i),this.onNetworkRecovery(i)}),this.signalingManager.on("onReconnectFail",i=>{this.slsReporter.reportWarning("signaling reconnect fail: ${err.code}"),ke.event("[Signaling] Reconnect Failed ",i),i.code===403&&this.emit("authInfoExpired")}),this.signalingManager.on("onError",i=>{this.slsReporter.reportWarning("signaling error: ${err.message}"),ke.event("[Signaling] Error ",i),this.onError(i)}),this.signalingManager.on("onUnknownMessage",i=>{if(i.msgtype==="proxyai"&&i.tid===this._proxyAiTid){let e=i.data.retcode;e===200&&(e=0),this.emit("AIAgentResult",e,this._agentParam.action,i.data.body)}})}backToUnpublishStatus(){this.connectState=Et.AliRtcConnectionStatusDisconnected,this.publisher.isPublishing&&this.publisher.clearPublishState(),this.networkError=!1}handleUsersJoin(i){i.forEach(e=>{this.bizControl.addUser(e,Ht.Join)})}onLocalDeviceStatusChange(i){ke.event(`[${Ye.logName}]`,Ui.Local,i),this.signalingManager.reportStatus(i).then(()=>{ke.debug("[signaling] reportStatus suc")}).catch(e=>{ke.error("[signaling] reportStatus failed",e)})}resumePublishForNetworkRecovery(){return pe(this,null,function*(){try{yield this.publisher.resumePublish()}catch(i){const{code:e}=i;if(e===10205){let n=1;try{yield new Promise((o,u)=>{const g=setInterval(()=>pe(this,null,function*(){n>1&&(clearInterval(g),u()),n+=1;try{yield this.publisher.resumePublish(),clearInterval(g),o()}catch(c){const{code:s}=c;s!==10205&&(clearInterval(g),u())}}),1e3)})}catch{}}throw i}})}onNetworkRecovery(i){return pe(this,null,function*(){ke.event(Ye.logName,"onNetworkRecovery",`rts isConnected: ${this.bizControl.rtsManager.isConnected}; rts isConnecting: ${this.bizControl.rtsManager.isConnecting}`,{users:i}),yield this.resumeSubList(i),this.networkError&&(this.networkError=!1,this.publisher.reportSelfDeviceStatus(),this.connectState=Et.AliRtcConnectionStatusConnected,this.emit("connectionStatusChange",Et.AliRtcConnectionStatusConnected,an.AliRtcConnectionSignalingHeartbeatAlive))})}resumeSubList(i){return pe(this,null,function*(){if(i){const{joinList:e,leaveList:n,presentList:o}=this.bizControl.diffUsers(i);ke.info(`[${Ye.logName}]`,"resumeSubList",{joinList:e,leaveList:n,presentList:o}),this.handleUsersJoin(e),n.forEach(u=>{ke.event(Ye.logName,Xt.UserLeft,u.userid,u.reason),this.bizControl.onRemotePublishStateChange({userid:u.userid,displayname:"",callid:"",tracks:[]}),this.bizControl.removeLeftUser(u),this.emit("remoteUserOffLineNotify",u.userid,rf.AliRtcUserOfflineQuit)}),o.forEach(u=>{this.bizControl.onRemotePublishStateChange(u)})}else for(let e=0;e<this.remoteUsers.length;e++){const n=this.remoteUsers[e];try{n.restore(),n.updateSubscribe(Ht.Resume)}catch{}}})}retrySubscribe(i){return pe(this,null,function*(){const e=this.bizControl.getRemoteUser(i);if(!e)throw new Ve(je.ERR_INNER,`no remote user(${i}) founded`);e.restore(),e.updateSubscribe(Ht.Retry)})}onNetworkError(){this.connectState===Et.AliRtcConnectionStatusConnected&&(this.networkError||(this.connectState=Et.AliRtcConnectionStatusDisconnected,this.emit("connectionStatusChange",Et.AliRtcConnectionStatusDisconnected,an.AliRtcConnectionChangedNetworkInterrupted)),this.networkError=!0)}onError(i){this.slsReporter.reportError(i),ke.event(Ye.logName,Xt.Error,i)}setEnableDualVideoStream(i,e){this.bizControl.setEnableDualVideoStream(i,e)}hadPushStream(i){if(!this.publisher||!i)throw new Ve(je.ERR_INNER,"stream is not publishing")}getCurrentMicDeviceId(){return this.publisher.getCurrentMicDeviceId()}setChannelProfile(i){if(![Et.AliRtcConnectionStatusInit,Et.AliRtcConnectionStatusDisconnected,Et.AliRtcConnectionStatusFailed].includes(this.connectState))throw new Ve(je.ERR_INNER,"cannot set channel profile in call");this.channelProfile=i,this.channelProfile===Un.AliRtcSdkCommunication&&(this.clientRole=lo.AliRtcSdkLive),this.signalingManager.setChannelProfile(i)}startDefaultDevices(){return pe(this,null,function*(){if(!this.publisher)return;const{hasCamera:i,hasMicrophone:e,hasScreenShare:n}=this.publisher;if(!i&&!e&&!n){try{yield this.publisher.startDefaultCameraAndMic(this._audioOnlyMode)}catch(o){ke.warn(`[${Ye.logName}]`,"startDefaultDevices failed",o.code,o.message),o instanceof Ve&&this.occurError(o);const u=o.code;this.occurError(new Ve(u>=je.ERR_CAMERA_OPEN_FAIL&&u<=je.ERR_CAMERA_NOT_AVAILABLE?je.ERR_SDK_PUBLISH_VIDEO_STREAM_FAILED:je.ERR_SDK_PUBLISH_AUDIO_STREAM_FAILED,`auto publish device failed, ${o.message||""}`))}yield this.publisher.previewAll()}})}startPublish(i){return pe(this,null,function*(){try{yield this.publisher.startPublish(!1,i)}catch(e){const n=this.publisher.publishStreams||{},o=[];n!=null&&n.audio&&o.push(je.ERR_SDK_PUBLISH_AUDIO_STREAM_FAILED),n!=null&&n.video&&o.push(je.ERR_SDK_PUBLISH_VIDEO_STREAM_FAILED),o.forEach(u=>{this.occurError(new Ve(u,`auto publish stream failed, ${e.message||""}`))})}})}setClientRole(i){return pe(this,null,function*(){try{if(this.channelProfile===Un.AliRtcSdkCommunication)return;if(!Object.values(lo).includes(i))throw new Ve(je.ERR_INVALID_ARGUMENTS,`set client role error, role value(${i}) is invalid`);if(this.clientRole===i)return;this.slsReporter.reportRoleUpdate(this.clientRole,i),this.isInCall()?this.clientRole===lo.AliRtcSdkInteractive?(this.publisher.isPublishing?yield this.publisher.unPublish():yield this.publisher.clearStream(),yield this.signalingManager.setClientRole(i)):(yield this.signalingManager.setClientRole(i),yield this.startDefaultDevices(),yield this.startPublish(xr.ROLE_CHANGE)):yield this.signalingManager.setClientRole(i),this.clientRole=i}catch(e){throw e.code===403&&this.emit("authInfoExpired"),e}})}getCurrentClientRole(){return this.clientRole}setAudioOnlyMode(i){if(this.isInCall())throw new Ve(je.ERR_INNER,"can not change audioOnly mode in call");this._audioOnlyMode=i}setAudioRedEnabled(i){if(this.isInCall())throw new Ve(je.ERR_INNER,"can not change audioRedEnabled in call");this.bizControl.setAudioRedEnabled(i)}setVideoCodec(i){this.bizControl.setVideoCodec(i)}setCheckAuthInfoTimer(i,e){const n=1e3*(i-e);this._authInfoExpiredTimer=window.setTimeout(()=>{this.emit("authInfoExpired")},n),this._authInfoWillExpireTimer=window.setTimeout(()=>{this.emit("authInfoWillExpire")},n-3e4),this._serverCheckAuthInfoTimestamp=e,this._localCheckAuthInfoTimestamp=+Date.now()/1e3}clearCheckAuthInfoTimer(){this._authInfoExpiredTimer&&window.clearTimeout(this._authInfoExpiredTimer),this._authInfoWillExpireTimer&&window.clearTimeout(this._authInfoWillExpireTimer)}joinChannel(i,e){return pe(this,arguments,function*(n,o,u={}){const g=Date.now();let c,s=typeof o=="string"?o:o?.userName;if(typeof n=="string")try{const p=JSON.parse(window.atob(n));c={appId:p.appid,channelId:p.channelid,userId:p.userid,timestamp:p.timestamp,nonce:p.nonce,token:p.token}}catch(p){throw new Ve(je.ERR_INVALID_ARGUMENTS,`authInfo is invalid: ${p.message||""}`)}else c=n;s||(s=c.userId);const d={start:Date.now()};let l=ys.checkAuthInfo(c);if(Et.AliRtcConnectionStatusInit!==this.connectState&&Et.AliRtcConnectionStatusDisconnected!==this.connectState&&Et.AliRtcConnectionStatusFailed!==this.connectState){const p=new Ve(je.ERR_JOIN_ALREADY_JOINED,"already joined");throw this.connectState===Et.AliRtcConnectionStatusConnecting&&(p.message="Repeated operation during login"),this.slsReporter.reportJoin(p.code,d,""),p}{if(l)throw this.connectState=Et.AliRtcConnectionStatusFailed,this.slsReporter.reportJoin(l.code,d,""),this.slsReporter.reportJoinResult(l),l;c.sessionId=ei.createCallid("web"),this.slsReporter.start(c),this.slsReporter.reportConnectionLatencyEvent(nr.JOIN,Sr.START,"","",g),this.connectState=Et.AliRtcConnectionStatusConnecting,this.emit("connectionStatusChange",Et.AliRtcConnectionStatusConnecting,an.AliRtcConnectionSignalingConnecting),ke.setSessionID(c.appId,c.sessionId);const p=()=>pe(this,null,function*(){var S,T;try{let v="Conference";typeof o=="object"&&o.capabilityProfile===hl.Human&&(v="AIUser");const h=JSON.parse(this.getParameter());h.joinMode&&(v=h.joinMode);const m=new ih(((S=this.config)==null?void 0:S.env)||Dr.prod,c,v);if(m.result){const b=(y=m.result.config,R=lS.EnableNonOnePcDefaultJoinMode,uo(y?.data,R));m.result.useonepc&&b!==!1||(v=""),ke.info(`[${ih.logName}]`,"got allocate result from localStorage",`joinMode: ${v}`,m.result.useonepc,b)}else ke.info(`[${ih.logName}]`,"no allocate result in localStorage",`joinMode: ${v}`);v&&(u.joinmode=v);const _=Date.now(),A=yield this.signalingManager.join(c,s,this.maxSignalingReconnectDuration,d,u);A.l1ip?(ke.info("allocate l1 pub ip with mode",v,A.l1ip),this.bizControl.rtsManager.preferredPubL1Ip=A.l1ip):this.bizControl.rtsManager.preferredPubL1Ip=void 0,A.l1subip?(ke.info("allocate l1 sub ip with mode",v,A.l1subip),this.bizControl.rtsManager.preferredSubL1Ip=A.l1subip):this.bizControl.rtsManager.preferredSubL1Ip=void 0;const E=Date.now();this.connectState=Et.AliRtcConnectionStatusConnected,this.emit("connectionStatusChange",Et.AliRtcConnectionStatusConnected,an.AliRtcConnectionSignalingJoinRoomSuccess),this.bizControl.init(c,A,{capabilityProfile:typeof o=="object"?o.capabilityProfile:hl.Default,robotUserId:typeof o=="object"?o.robotUserId:void 0}),this.setCheckAuthInfoTimer(c.timestamp,A.timestamp),this.liveTranscoding.setAuthInfo(c),this.slsReporter.reportJoin(0,d,A.tid),this.slsReporter.reportJoinResult(null),this.slsReporter.reportConnectionLatencyEvent(nr.JOIN,Sr.SEND_SIG,"","",_),this.slsReporter.reportConnectionLatencyEvent(nr.JOIN,Sr.RECV_RST,"","",E),this.slsReporter.reportConnectionLatencyEvent(nr.JOIN,Sr.END,"","")}catch(v){const h=(T=v.code)!=null?T:-1,m=v.reason||v.message||"";throw this.connectState=Et.AliRtcConnectionStatusDisconnected,this.emit("connectionStatusChange",Et.AliRtcConnectionStatusDisconnected,an.AliRtcConnectionSignalingJoinRoomFailure),this.slsReporter.reportJoin(h,d,""),this.slsReporter.reportJoinResult(v),new Ve(h,m)}var y,R});this.currentRoleCanPublish?(yield Promise.all([p(),this.startDefaultDevices()]),yield this.startPublish(xr.JOIN_CHANNEL)):yield p(),this.publisher.reportSelfDeviceStatus(),this.remoteUsers.forEach(S=>{S.updateSubscribe(Ht.Join)})}})}joinAIChannel(i,e,n){return pe(this,null,function*(){return this._proxyAiTid=Er(),this._agentParam=n,this.joinChannel(i,e,{proxyai:{tid:this._proxyAiTid,region:n.region,proxydata:JSON.stringify({Region:n.region,Action:n.action,ActionParams:n.params})}})})}leaveChannel(){return pe(this,null,function*(){var i;this.slsReporter.reportLeaveInvoked(),yield this.bizControl.leave();let e=new Date().getTime();if(Et.AliRtcConnectionStatusConnected===this.connectState)try{let n;n=yield this.signalingManager.leave(),this.slsReporter.reportLeave(new Date().getTime()-e,0,(i=n?.tid)!=null?i:"")}catch(n){this.slsReporter.reportLeave(new Date().getTime()-e,n.code,n.reason)}else this.slsReporter.reportLeave(0,0,"");this.networkError=!1,this.connectState=Et.AliRtcConnectionStatusDisconnected,this.clearCheckAuthInfoTimer(),this.liveTranscoding.clear(),this.slsReporter.stop(),this.signalingManager.reset(),ke.reportEnd()})}isInCall(){return this.connectState===Et.AliRtcConnectionStatusConnected}refreshAuthInfo(i){return pe(this,null,function*(){let e;if(typeof i=="string")try{const d=JSON.parse(window.atob(i));e={userId:d.userid,timestamp:d.timestamp,nonce:d.nonce,token:d.token}}catch(d){throw new Ve(je.ERR_INVALID_ARGUMENTS,`authInfo is invalid: ${d.message||""}`)}else e=i;const{userId:n,nonce:o,timestamp:u,token:g,role:c}=e,s={userId:n,nonce:o,timestamp:u,token:g,role:c};try{yield this.signalingManager.refreshAuthInfo(s),this.bizControl.refreshAuthInfo(s),this.liveTranscoding.refreshAuthInfo(s),this.clearCheckAuthInfoTimer(),this._serverCheckAuthInfoTimestamp&&this._localCheckAuthInfoTimestamp&&e.timestamp&&this.setCheckAuthInfoTimer(e.timestamp,this._serverCheckAuthInfoTimestamp+(Date.now()-this._localCheckAuthInfoTimestamp))}catch(d){throw d}})}isAudioOnly(){return this._audioOnlyMode}publishLocalAudioStream(i){return pe(this,null,function*(){this.publisher.setPublishLocalAudioStreamEnabled(i),this.connectState===Et.AliRtcConnectionStatusConnected&&(i?this.publisher.hasMicrophone?yield this.publisher.updateStreams():yield this.startAudioCapture():yield this.publisher.publishUpdate())})}isLocalAudioStreamPublished(){var i;return(i=this.publisher.publishLocalAudioStreamEnabled)!=null?i:!0}setDefaultSubscribeAllRemoteAudioStreams(i){this.bizControl.setAutoSubAudio(i)}subscribeAllRemoteAudioStreams(i){this.bizControl.setWantSubAudio(i)}subscribeRemoteAudioStream(i,e){if(e&&!this.bizControl.isWantSubAudio)throw new Ve(je.ERR_INVALID_ARGUMENTS,"subscribeAllRemoteAudioStreams(true) must be called first");this.bizControl.updateAudioWant(i,e)}resumeRemoteAudioStream(i){const e=this.bizControl.getRemoteUser(i);if(!e)throw new Ve(je.ERR_INNER,`no remote user(${i}) founded`);e.resumeAudio()}stopRemoteAudioPlay(i){const e=this.bizControl.getRemoteUser(i);if(!e)throw new Ve(je.ERR_INNER,`no remote user(${i}) founded`);e.stopPlayAudio()}publishLocalVideoStream(i){return pe(this,null,function*(){this.publisher.setPublishLocalVideoStreamEnabled(i),this.connectState===Et.AliRtcConnectionStatusConnected&&(i?this.publisher.hasCamera?yield this.publisher.updateStreams():yield this.enableLocalVideo():yield this.publisher.publishUpdate())})}isLocalVideoStreamPublished(){var i;return(i=this.publisher.publishLocalVideoStreamEnabled)!=null?i:!0}setRemoteDefaultVideoStreamType(i){[Di.AliRtcVideoStreamTypeHigh,Di.AliRtcVideoStreamTypeLow].includes(i)&&this.bizControl.setRemoteDefaultVideoStreamType(i)}setRemoteUserVideoStreamType(i,e){[Di.AliRtcVideoStreamTypeHigh,Di.AliRtcVideoStreamTypeLow].includes(e)&&this.bizControl.setRemoteUserVideoStreamType(i,e)}setDefaultSubscribeAllRemoteVideoStreams(i){this.bizControl.setAutoSubVideo(i),this.bizControl.setAutoSubScreen(i)}subscribeAllRemoteVideoStreams(i){this.bizControl.setWantSubVideo(i),this.bizControl.setWantSubScreen(i)}subscribeRemoteMediaStream(i,e,n,o){const u=this.bizControl.getRemoteUser(i);if(!u)throw new Ve(je.ERR_INNER,`no remote user(${i}) founded`);!n||e!==Rt.AliRtcVideoTrackScreen&&e!==Rt.AliRtcVideoTrackBoth?u.setWantSubScreen(!1):u.setWantSubScreen(!0),!n||e!==Rt.AliRtcVideoTrackCamera&&e!==Rt.AliRtcVideoTrackBoth?u.setWantSubVideo(!1):u.setWantSubVideo(!0),u.setWantSubAudio(o),u.updateSubscribe(Ht.User)}resumeRemoteMediaStream(i,e){const n=this.bizControl.getRemoteUser(i);n&&n.resumeVideo(e)}getOnlineRemoteUsers(){return this.bizControl.remoteUsers.map(i=>i.userId)}getUserInfo(i){var e;return(e=this.bizControl.getRemoteUser(i))==null?void 0:e.remoteUserInfo}isUserOnline(i){return!!this.bizControl.remoteUsers.find(e=>e.userId===i)}startScreenShare(i){return pe(this,null,function*(){const e={video:!1,audio:!1},{audio:n=!1,videoTrack:o,audioTrack:u}=i||{};if(o||u){e.screen=!0;const g=new MediaStream;o&&g.addTrack(o),u&&g.addTrack(u),e.mediaStream=g}else e.screen=!n||{audio:!0};yield this.publisher.createLocalStream(e)})}stopScreenShare(){return pe(this,null,function*(){this.publisher.stopLocalStream({screen:!0})})}setScreenShareConfiguration(i){return pe(this,null,function*(){const{width:e,height:n}=i;if(e&&!isNaN(e)&&n&&!isNaN(n)&&e*n>9437184)throw new Ve(je.ERR_INVALID_ARGUMENTS,"width * height must be less than 9437184");const o=i,{bitrate:u}=o,g=jn(o,["bitrate"]),c=Qe({},g);u&&(c.maxBitrate=i.bitrate),yield this.publisher.setScreenProfile(c)})}setScreenShareContentHint(i){return pe(this,null,function*(){i&&this.publisher.setScreenContentHint(i)})}publishLocalScreenShareStream(i,e){return pe(this,null,function*(){this.publisher.setPublishLocalScreenStreamEnabled(i),this.connectState===Et.AliRtcConnectionStatusConnected&&(i?this.publisher.hasScreenShare?yield this.publisher.updateStreams():yield this.startScreenShare(e):yield this.publisher.publishUpdate())})}isScreenSharePublished(){var i;return(i=this.publisher.publishLocalScreenStreamEnabled)!=null?i:!0}setAudioShareVolume(i){if(typeof i!="number")throw new Ve(je.ERR_INVALID_ARGUMENTS,"volume must be a number");this.bizControl.setAudioVolume({screen:Math.max(0,Math.min(i,400))/100})}enableAudioVolumeIndication(i){this.bizControl.enableAudioVolumeIndication(i)}muteLocalMic(i=!1){this.publisher.muteLocalMic(i),this.connectState===Et.AliRtcConnectionStatusConnected&&this.isPublishing&&this.publisher.reportSelfDeviceStatus()}muteRemoteAudioPlaying(i,e=!1){const n=this.bizControl.getRemoteUser(i);if(!n)throw new Ve(je.ERR_INNER,`no remote user(${i}) founded`);n.setAudioMuted(e)}muteAllRemoteAudioPlaying(i=!1){this.bizControl.setAudioMuted(i)}startAudioCapture(i){return pe(this,null,function*(){const e={audio:i||!0};yield this.publisher.createLocalStream(e)})}setAudioConstraints(i){return pe(this,null,function*(){yield this.publisher.setMicrophoneConstraints(i)})}stopAudioCapture(){this.publisher.stopAudioCapture()}switchMicrophone(i,e){return pe(this,null,function*(){if(yield this.publisher.setMicrophoneDeviceId(i),!this.publisher.audioCaptureDisabled){if(e)return void(yield this.publisher.createLocalStream({audio:!0,mediaStream:new MediaStream([e])}));yield this.publisher.createLocalStream({audio:{deviceId:i}})}})}setRecordingVolume(i){if(typeof i!="number")throw new Ve(je.ERR_INVALID_ARGUMENTS,"volume must be a number");this.bizControl.setAudioVolume({audio:Math.max(0,Math.min(i,400))/100})}setPlayoutVolume(i){if(typeof i!="number")throw new Ve(je.ERR_INVALID_ARGUMENTS,"volume must be a number");this.bizControl.setPlayoutVolume(Math.max(0,Math.min(i,100))/100)}setRemoteAudioVolume(i,e){const n=this.bizControl.getRemoteUser(i);if(!n)throw new Ve(je.ERR_INNER,`no remote user(${i}) founded`);if(typeof e!="number")throw new Ve(je.ERR_INVALID_ARGUMENTS,"volume must be a number");n.setPlayoutVolume(Math.max(0,Math.min(e,100))/100)}setAudioProfile(i){return pe(this,null,function*(){yield this.publisher.setAudioProfile(i)})}getAudioTrack(i){return pe(this,null,function*(){if(!i)return this.publisher.audioTrack;const e=this.bizControl.getRemoteUser(i);return e?.getAudioTrack})}setLocalViewConfig(i,e){return pe(this,null,function*(){var n;if(this._audioOnlyMode)throw new Ve(je.ERR_INNER,"Cannot set local view in audio only mode");(n=this.bizControl)==null||n.setLocalViewConfig(i,e),e===Rt.AliRtcVideoTrackCamera&&this.publisher.hasCamera?yield this.startPreview():e===Rt.AliRtcVideoTrackScreen&&this.publisher.hasScreenShare&&(yield this.startPreviewScreen())})}setCameraCapturerConfiguration(i){return pe(this,null,function*(){const e=i,{cameraDirection:n,deviceId:o,bitrate:u,maxSendFrameRate:g}=e,c=jn(e,["cameraDirection","deviceId","bitrate","maxSendFrameRate"]),s=Qe({},c);u&&(s.maxBitrate=u),g&&(s.maxSendFrameRate=g),Object.keys(s).length>0&&(yield this.publisher.setVideoProfile(s)),n!==void 0&&this.publisher.setCameraDirection(n),o&&this.publisher.setCameraDeviceId(o)})}setCameraCapturerContentHint(i){return pe(this,null,function*(){i&&this.publisher.setVideoContentHint(i)})}enableLocalVideo(i=!0){return pe(this,null,function*(){var e,n,o,u,g,c;if(this._audioOnlyMode)throw new Ve(je.ERR_INNER,"Cannot enable local video in audio only mode");i?((e=this.publisher.publishStreams)!=null&&e.video&&((o=(n=this.publisher.publishStreams)==null?void 0:n.video)==null||o.disableVideo(),(c=(g=(u=this.publisher.publishStreams)==null?void 0:u.video)==null?void 0:g.videoTrack)==null||c.stop()),yield this.publisher.startCameraCapture()):yield this.publisher.stopCameraCapture()})}muteLocalCamera(i){return pe(this,null,function*(){this.publisher.muteLocalCamera(i),this.connectState===Et.AliRtcConnectionStatusConnected&&this.isPublishing&&this.publisher.reportSelfDeviceStatus()})}muteLocalScreen(i){return pe(this,null,function*(){this.publisher.muteLocalScreen(i),this.connectState===Et.AliRtcConnectionStatusConnected&&this.isPublishing&&this.publisher.reportSelfDeviceStatus()})}setRemoteViewConfig(i,e,n){this.bizControl.setRemoteViewConfig(e,i,n)}isCameraOn(){var i;return(i=this.publisher.hasCamera)!=null?i:!1}switchCamera(i,e){return pe(this,null,function*(){var n;if(this._audioOnlyMode)throw new Ve(je.ERR_INNER,"Cannot switch camera in audio only mode");const o={};if(i?(o.deviceId=i,this.slsReporter.reportSwitchCamera(i)):e||(o.cameraDirection=this.publisher.cameraDirection==="environment"?Ss.CAMERA_FRONT:Ss.CAMERA_REAR,this.slsReporter.reportSwitchCamera(this.publisher.cameraDirection||"")),yield this.setCameraCapturerConfiguration(o),!this.publisher.cameraCaptureDisabled){(n=this.publisher.cameraTrack)==null||n.stop();const u={video:!0};e&&(u.mediaStream=new MediaStream([e])),yield this.publisher.createLocalStream(u)}})}getCurrentCameraDeviceId(){return this.publisher.getCurrentCameraDeviceId()}startPreview(){return pe(this,null,function*(){if(this._audioOnlyMode)throw new Ve(je.ERR_INNER,"Cannot start preview camera in audio only mode");this.publisher.hasCamera||(yield this.enableLocalVideo(!0)),yield this.publisher.previewAll({screen:!1})})}startPreviewScreen(i){return pe(this,null,function*(){if(this._audioOnlyMode)throw new Ve(je.ERR_INNER,"Cannot start preview screen share in audio only mode");this.publisher.hasScreenShare||(yield this.startScreenShare(i)),yield this.publisher.previewAll({primary:!1})})}stopPreview(){return pe(this,null,function*(){yield this.publisher.stopPreview({primary:!0,screen:!1})})}stopPreviewScreen(){return pe(this,null,function*(){yield this.publisher.stopPreview({primary:!1,screen:!0})})}getVideoTrack(i){return pe(this,null,function*(){var e,n;const{userId:o,streamType:u}=i;if(!o)return u===di.AliRtcSdkStreamTypeCapture?this.publisher.cameraTrack:this.publisher.screenTrack;const g=this.bizControl.getRemoteUser(o);return u===di.AliRtcSdkStreamTypeCapture?(e=g?.getCameraStream)==null?void 0:e.videoTrack:(n=g?.getScreenStream)==null?void 0:n.videoTrack})}startPublishLiveStream(i,e){return pe(this,null,function*(){return this.liveTranscoding.startPublishLiveStream(i,e)})}updatePublishLiveStream(i,e){return pe(this,null,function*(){return this.liveTranscoding.updatePublishLiveStream(i,e)})}updatePublishLiveStreamWithTaskId(i,e){return this.liveTranscoding.updatePublishLiveStreamWithTaskId(i,e)}stopPublishLiveStream(i){return pe(this,null,function*(){return this.liveTranscoding.stopPublishLiveStream(i)})}stopPublishLiveStreamWithTaskId(i){return this.liveTranscoding.stopPublishLiveStreamWithTaskId(i)}setEnableMediaExtensionMsg(i){var e;(e=this.bizControl)==null||e.setEnableMediaExtensionMsg(!!i)}sendMediaExtensionMsg(i,e){return pe(this,null,function*(){return this.sendMediaExtensionMsgEx(i,e,5)})}sendMediaExtensionMsgEx(i,e,n){return pe(this,null,function*(){if(!this.publisher||!this.isPublishing)throw new Ve(je.ERR_INNER,"you should publish first");return this.slsReporter.reportSEIMessage(n,i.byteLength,e,0,!1),this.publisher.sendSEI(i,e,n)})}enablePlugin(i,e){this.bizControl.pluginManager.add(i,e)}removePlugin(i){this.bizControl.pluginManager.remove(i)}setPluginOption(i,e){const n=this.bizControl.pluginManager.get(i);n&&e&&n.setOptions(e)}getPluginByName(i){return this.bizControl.pluginManager.get(i)}getPluginOption(i){const e=this.bizControl.pluginManager.get(i);return e?.getOptions()}isBeautyAvailable(){return this.bizControl.pluginManager.has("AliRtcBeauty")}isBeautyEnabled(){const i=this.bizControl.pluginManager.get("AliRtcBeauty");if(!i)throw new Ve(Vn.AliRtcPluginErrorNoFindPlugin,"you should enable beautyPlugin first");return!!(i!=null&&i.isEnable)}setBeautyEffect(i,e){const n=this.bizControl.pluginManager.get("AliRtcBeauty");if(!n)throw new Ve(Vn.AliRtcPluginErrorNoFindPlugin,"you should enable beautyPlugin first");i?n.enable():n.disable(),n.setOptions({basicBeauty:{skinBuffing:Math.max(Math.min(1,+e.smoothnessLevel),0),whitening:Math.max(Math.min(1,+e.whiteningLevel),0)}})}enableBackgroundExchange(i,e){const n=this.bizControl.pluginManager.get("AliRtcBeauty");if(!n||!n.isEnable)throw new Ve(Vn.AliRtcPluginErrorNoFindPlugin,"you should enable beautyPlugin first");const o={setSegmentBackgroundImage:{backgroundImgUrl:i?e:""}};i&&(o.segmentBackgroundProcess={enable:!1}),n.setOptions(o)}enableBackgroundBlur(i){const e=this.bizControl.pluginManager.get("AliRtcBeauty");if(!e||!e.isEnable)throw new Ve(Vn.AliRtcPluginErrorNoFindPlugin,"you should enable beautyPlugin first");const n={segmentBackgroundProcess:{type:0,enable:i}};i&&(n.setSegmentBackgroundImage={type:0,backgroundImgUrl:""}),e.setOptions(n)}setParameter(i){this.bizControl.setParameter(i)}getParameter(){return this.bizControl.getParameter()}sendDataChannelMessage(i){this.bizControl.sendDataChannelMessage(i)}},W(Ye,"logName","AliRtcEngine"),W(Ye,"logError",!0),W(Ye,"isSupported",nT),W(Ye,"isDualVideoStreamSupported",Lh.isSupport),W(Ye,"getCameraList",()=>pe(Ye,null,function*(){return(yield wt.AliRTS.getCameraList()).filter(i=>i.deviceId)})),W(Ye,"getMicrophoneList",()=>pe(Ye,null,function*(){return(yield wt.AliRTS.getMicList()).filter(i=>i.deviceId)})),W(Ye,"getSpeakerList",()=>pe(Ye,null,function*(){return(yield wt.AliRTS.getSpeakerList()).filter(i=>i.deviceId)})),W(Ye,"_instance"),W(Ye,"AliRtcSdkChannelProfile",Un),W(Ye,"AliRtcSdkClientRole",lo),W(Ye,"AliRtcVideoStreamType",Di),W(Ye,"AliRtcVideoTrack",Rt),W(Ye,"AliRtcAudioTrack",da),W(Ye,"AliRtcPublishState",tt),W(Ye,"AliRtcSubscribeState",ht),W(Ye,"AliRtcRawDataStreamType",di),W(Ye,"AliRtcLogLevel",mS),W(Ye,"AliRtcEngineLocalDeviceType",ln),W(Ye,"AliRtcEngineLocalDeviceExceptionType",vi),W(Ye,"AliRtcConnectionStatus",Et),W(Ye,"AliRtcConnectionStatusChangeReason",an),W(Ye,"AliRtcPlugin",zn),W(Ye,"AliRtcPluginTrackType",_s),W(Ye,"AliRtcImageHolderPlugin",jT),W(Ye,"AliRtcLiveTranscodingParam",Hh),W(Ye,"AliRtcLiveTranscodingEncodeParam",MS),W(Ye,"AliRtcLiveTranscodingMixParam",LT),W(Ye,"AliRtcLiveTranscodingSingleParam",UT),W(Ye,"AliRtcTranscodingClockWidget",xT),W(Ye,"AliRtcTranscodingImage",HS),W(Ye,"AliRtcTranscodingText",BT),W(Ye,"AliRtcTranscodingUser",VT),W(Ye,"AliRtcLiveTranscodingMixMode",fl),W(Ye,"AliRtcLiveTranscodingStreamType",CS),W(Ye,"AliRtcLiveTranscodingSourceType",Rs),W(Ye,"AliRtcLiveTranscodingTaskProfile",wS),W(Ye,"AliRtcLiveTranscodingAudioSampleRate",sf),W(Ye,"AliRtcLiveTranscodingSegmentType",pl),W(Ye,"AliRtcLiveTranscodingFontType",Rl),W(Ye,"AliRtcLiveTranscodingCropMode",DS),W(Ye,"AliRtcLiveTranscodingMediaProcessMode",cf),W(Ye,"AliRtcLiveTranscodingState",OS),W(Ye,"AliRtcLiveTranscodingErrorCode",cn),W(Ye,"AliRtcTrascodingPublishTaskStatus",IS),W(Ye,"AliRtcDataChannelMsg",mo),W(Ye,"AliRtcDataMsgType",_S),W(Ye,"Plugin",zn),Ye);qe([ge()],We.prototype,"destroy"),qe([ge()],We.prototype,"backToUnpublishStatus"),qe([ge()],We.prototype,"resumePublishForNetworkRecovery"),qe([ge()],We.prototype,"onNetworkRecovery"),qe([ge()],We.prototype,"resumeSubList"),qe([ge(He)],We.prototype,"retrySubscribe"),qe([ge(He)],We.prototype,"setEnableDualVideoStream"),qe([ge(He)],We.prototype,"setChannelProfile"),qe([ge(He)],We.prototype,"setClientRole"),qe([ge(He)],We.prototype,"setAudioOnlyMode"),qe([ge()],We.prototype,"clearCheckAuthInfoTimer"),qe([ge(He)],We.prototype,"joinChannel"),qe([ge(He)],We.prototype,"joinAIChannel"),qe([ge(He)],We.prototype,"leaveChannel"),qe([ge(He)],We.prototype,"refreshAuthInfo"),qe([ge(He)],We.prototype,"publishLocalAudioStream"),qe([ge(He)],We.prototype,"setDefaultSubscribeAllRemoteAudioStreams"),qe([ge(He)],We.prototype,"subscribeAllRemoteAudioStreams"),qe([ge(He)],We.prototype,"subscribeRemoteAudioStream"),qe([ge(He)],We.prototype,"resumeRemoteAudioStream"),qe([ge(He)],We.prototype,"stopRemoteAudioPlay"),qe([ge(He)],We.prototype,"publishLocalVideoStream"),qe([ge(He)],We.prototype,"setRemoteDefaultVideoStreamType"),qe([ge(He)],We.prototype,"setRemoteUserVideoStreamType"),qe([ge(He)],We.prototype,"setDefaultSubscribeAllRemoteVideoStreams"),qe([ge(He)],We.prototype,"subscribeAllRemoteVideoStreams"),qe([ge(He)],We.prototype,"subscribeRemoteMediaStream"),qe([ge(He)],We.prototype,"resumeRemoteMediaStream"),qe([ge(([i])=>[`${i?.audio}`])],We.prototype,"startScreenShare"),qe([ge()],We.prototype,"stopScreenShare"),qe([ge(He)],We.prototype,"setScreenShareConfiguration"),qe([ge(He)],We.prototype,"setScreenShareContentHint"),qe([ge()],We.prototype,"publishLocalScreenShareStream"),qe([ge(He)],We.prototype,"setAudioShareVolume"),qe([ge(He)],We.prototype,"enableAudioVolumeIndication"),qe([ge(He)],We.prototype,"muteLocalMic"),qe([ge(He)],We.prototype,"muteRemoteAudioPlaying"),qe([ge(He)],We.prototype,"muteAllRemoteAudioPlaying"),qe([ge(He)],We.prototype,"startAudioCapture"),qe([ge(He)],We.prototype,"setAudioConstraints"),qe([ge()],We.prototype,"stopAudioCapture"),qe([ge(He)],We.prototype,"switchMicrophone"),qe([ge(He)],We.prototype,"setRecordingVolume"),qe([ge(He)],We.prototype,"setPlayoutVolume"),qe([ge(He)],We.prototype,"setRemoteAudioVolume"),qe([ge(He)],We.prototype,"setAudioProfile"),qe([ge(He)],We.prototype,"getAudioTrack"),qe([ge(He)],We.prototype,"setLocalViewConfig"),qe([ge(He)],We.prototype,"setCameraCapturerConfiguration"),qe([ge(He)],We.prototype,"setCameraCapturerContentHint"),qe([ge(He)],We.prototype,"enableLocalVideo"),qe([ge(He)],We.prototype,"muteLocalCamera"),qe([ge(He)],We.prototype,"muteLocalScreen"),qe([ge(He)],We.prototype,"setRemoteViewConfig"),qe([ge(He)],We.prototype,"switchCamera"),qe([ge()],We.prototype,"startPreview"),qe([ge()],We.prototype,"startPreviewScreen"),qe([ge()],We.prototype,"stopPreview"),qe([ge()],We.prototype,"stopPreviewScreen"),qe([ge()],We.prototype,"startPublishLiveStream"),qe([ge()],We.prototype,"updatePublishLiveStream"),qe([ge()],We.prototype,"updatePublishLiveStreamWithTaskId"),qe([ge()],We.prototype,"stopPublishLiveStream"),qe([ge()],We.prototype,"stopPublishLiveStreamWithTaskId"),qe([ge(He)],We.prototype,"setEnableMediaExtensionMsg"),qe([ge(([i,e,n])=>[i.byteLength,e,n])],We.prototype,"sendMediaExtensionMsgEx"),qe([ge(([i,e])=>[i.name||"",e])],We.prototype,"enablePlugin"),qe([ge(He)],We.prototype,"removePlugin"),qe([ge(He)],We.prototype,"setPluginOption"),qe([ge(He)],We.prototype,"getPluginByName"),qe([ge(He)],We.prototype,"getPluginOption"),qe([ge(He)],We.prototype,"setBeautyEffect"),qe([ge(He)],We.prototype,"enableBackgroundExchange"),qe([ge(He)],We.prototype,"enableBackgroundBlur"),qe([ge(He)],We.prototype,"setParameter"),qe([ge(([i])=>{var e;return[(e=i.data)==null?void 0:e.byteLength]})],We.prototype,"sendDataChannelMessage"),qe([ge(He)],We,"setLogLevel");let jS=We;var Dy;const zS=new of({businessName:"imp-web-rtc",version:(Dy=jS.getSdkVersion())!=null?Dy:"unknown",env:"prod",disabled:window.AliRtcOptionsDisableProxy===!0});zS.setReady();const Oy=zS.wrap(jS);function FS(i,e){return function(){return i.apply(e,arguments)}}const{toString:GT}=Object.prototype,{getPrototypeOf:df}=Object,{iterator:_l,toStringTag:GS}=Symbol,Tl=(i=>e=>{const n=GT.call(e);return i[n]||(i[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),Or=i=>(i=i.toLowerCase(),e=>Tl(e)===i),Al=i=>e=>typeof e===i,{isArray:pa}=Array,ha=Al("undefined");function Ts(i){return i!==null&&!ha(i)&&i.constructor!==null&&!ha(i.constructor)&&Ki(i.constructor.isBuffer)&&i.constructor.isBuffer(i)}const WS=Or("ArrayBuffer");function WT(i){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(i):e=i&&i.buffer&&WS(i.buffer),e}const qT=Al("string"),Ki=Al("function"),qS=Al("number"),As=i=>i!==null&&typeof i=="object",KT=i=>i===!0||i===!1,nl=i=>{if(Tl(i)!=="object")return!1;const e=df(i);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(GS in i)&&!(_l in i)},YT=i=>{if(!As(i)||Ts(i))return!1;try{return Object.keys(i).length===0&&Object.getPrototypeOf(i)===Object.prototype}catch{return!1}},XT=Or("Date"),JT=Or("File"),QT=Or("Blob"),$T=Or("FileList"),ZT=i=>As(i)&&Ki(i.pipe),eA=i=>{let e;return i&&(typeof FormData=="function"&&i instanceof FormData||Ki(i.append)&&((e=Tl(i))==="formdata"||e==="object"&&Ki(i.toString)&&i.toString()==="[object FormData]"))},tA=Or("URLSearchParams"),[iA,rA,nA,oA]=["ReadableStream","Request","Response","Headers"].map(Or),aA=i=>i.trim?i.trim():i.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Cs(i,e,{allOwnKeys:n=!1}={}){if(i===null||typeof i>"u")return;let o,u;if(typeof i!="object"&&(i=[i]),pa(i))for(o=0,u=i.length;o<u;o++)e.call(null,i[o],o,i);else{if(Ts(i))return;const g=n?Object.getOwnPropertyNames(i):Object.keys(i),c=g.length;let s;for(o=0;o<c;o++)s=g[o],e.call(null,i[s],s,i)}}function KS(i,e){if(Ts(i))return null;e=e.toLowerCase();const n=Object.keys(i);let o=n.length,u;for(;o-- >0;)if(u=n[o],e===u.toLowerCase())return u;return null}const po=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,YS=i=>!ha(i)&&i!==po;function Fh(){const{caseless:i,skipUndefined:e}=YS(this)&&this||{},n={},o=(u,g)=>{const c=i&&KS(n,g)||g;nl(n[c])&&nl(u)?n[c]=Fh(n[c],u):nl(u)?n[c]=Fh({},u):pa(u)?n[c]=u.slice():(!e||!ha(u))&&(n[c]=u)};for(let u=0,g=arguments.length;u<g;u++)arguments[u]&&Cs(arguments[u],o);return n}const sA=(i,e,n,{allOwnKeys:o}={})=>(Cs(e,(u,g)=>{n&&Ki(u)?i[g]=FS(u,n):i[g]=u},{allOwnKeys:o}),i),cA=i=>(i.charCodeAt(0)===65279&&(i=i.slice(1)),i),lA=(i,e,n,o)=>{i.prototype=Object.create(e.prototype,o),i.prototype.constructor=i,Object.defineProperty(i,"super",{value:e.prototype}),n&&Object.assign(i.prototype,n)},uA=(i,e,n,o)=>{let u,g,c;const s={};if(e=e||{},i==null)return e;do{for(u=Object.getOwnPropertyNames(i),g=u.length;g-- >0;)c=u[g],(!o||o(c,i,e))&&!s[c]&&(e[c]=i[c],s[c]=!0);i=n!==!1&&df(i)}while(i&&(!n||n(i,e))&&i!==Object.prototype);return e},dA=(i,e,n)=>{i=String(i),(n===void 0||n>i.length)&&(n=i.length),n-=e.length;const o=i.indexOf(e,n);return o!==-1&&o===n},hA=i=>{if(!i)return null;if(pa(i))return i;let e=i.length;if(!qS(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=i[e];return n},fA=(i=>e=>i&&e instanceof i)(typeof Uint8Array<"u"&&df(Uint8Array)),pA=(i,e)=>{const o=(i&&i[_l]).call(i);let u;for(;(u=o.next())&&!u.done;){const g=u.value;e.call(i,g[0],g[1])}},mA=(i,e)=>{let n;const o=[];for(;(n=i.exec(e))!==null;)o.push(n);return o},gA=Or("HTMLFormElement"),vA=i=>i.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,o,u){return o.toUpperCase()+u}),Iy=(({hasOwnProperty:i})=>(e,n)=>i.call(e,n))(Object.prototype),yA=Or("RegExp"),XS=(i,e)=>{const n=Object.getOwnPropertyDescriptors(i),o={};Cs(n,(u,g)=>{let c;(c=e(u,g,i))!==!1&&(o[g]=c||u)}),Object.defineProperties(i,o)},SA=i=>{XS(i,(e,n)=>{if(Ki(i)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const o=i[n];if(Ki(o)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},bA=(i,e)=>{const n={},o=u=>{u.forEach(g=>{n[g]=!0})};return pa(i)?o(i):o(String(i).split(e)),n},EA=()=>{},RA=(i,e)=>i!=null&&Number.isFinite(i=+i)?i:e;function _A(i){return!!(i&&Ki(i.append)&&i[GS]==="FormData"&&i[_l])}const TA=i=>{const e=new Array(10),n=(o,u)=>{if(As(o)){if(e.indexOf(o)>=0)return;if(Ts(o))return o;if(!("toJSON"in o)){e[u]=o;const g=pa(o)?[]:{};return Cs(o,(c,s)=>{const d=n(c,u+1);!ha(d)&&(g[s]=d)}),e[u]=void 0,g}}return o};return n(i,0)},AA=Or("AsyncFunction"),CA=i=>i&&(As(i)||Ki(i))&&Ki(i.then)&&Ki(i.catch),JS=((i,e)=>i?setImmediate:e?((n,o)=>(po.addEventListener("message",({source:u,data:g})=>{u===po&&g===n&&o.length&&o.shift()()},!1),u=>{o.push(u),po.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",Ki(po.postMessage)),wA=typeof queueMicrotask<"u"?queueMicrotask.bind(po):typeof process<"u"&&process.nextTick||JS,DA=i=>i!=null&&Ki(i[_l]),Ce={isArray:pa,isArrayBuffer:WS,isBuffer:Ts,isFormData:eA,isArrayBufferView:WT,isString:qT,isNumber:qS,isBoolean:KT,isObject:As,isPlainObject:nl,isEmptyObject:YT,isReadableStream:iA,isRequest:rA,isResponse:nA,isHeaders:oA,isUndefined:ha,isDate:XT,isFile:JT,isBlob:QT,isRegExp:yA,isFunction:Ki,isStream:ZT,isURLSearchParams:tA,isTypedArray:fA,isFileList:$T,forEach:Cs,merge:Fh,extend:sA,trim:aA,stripBOM:cA,inherits:lA,toFlatObject:uA,kindOf:Tl,kindOfTest:Or,endsWith:dA,toArray:hA,forEachEntry:pA,matchAll:mA,isHTMLForm:gA,hasOwnProperty:Iy,hasOwnProp:Iy,reduceDescriptors:XS,freezeMethods:SA,toObjectSet:bA,toCamelCase:vA,noop:EA,toFiniteNumber:RA,findKey:KS,global:po,isContextDefined:YS,isSpecCompliantForm:_A,toJSONObject:TA,isAsyncFn:AA,isThenable:CA,setImmediate:JS,asap:wA,isIterable:DA};function ct(i,e,n,o,u){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=i,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),o&&(this.request=o),u&&(this.response=u,this.status=u.status?u.status:null)}Ce.inherits(ct,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ce.toJSONObject(this.config),code:this.code,status:this.status}}});const QS=ct.prototype,$S={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(i=>{$S[i]={value:i}});Object.defineProperties(ct,$S);Object.defineProperty(QS,"isAxiosError",{value:!0});ct.from=(i,e,n,o,u,g)=>{const c=Object.create(QS);Ce.toFlatObject(i,c,function(p){return p!==Error.prototype},l=>l!=="isAxiosError");const s=i&&i.message?i.message:"Error",d=e==null&&i?i.code:e;return ct.call(c,s,d,n,o,u),i&&c.cause==null&&Object.defineProperty(c,"cause",{value:i,configurable:!0}),c.name=i&&i.name||"Error",g&&Object.assign(c,g),c};const OA=null;function Gh(i){return Ce.isPlainObject(i)||Ce.isArray(i)}function ZS(i){return Ce.endsWith(i,"[]")?i.slice(0,-2):i}function My(i,e,n){return i?i.concat(e).map(function(u,g){return u=ZS(u),!n&&g?"["+u+"]":u}).join(n?".":""):e}function IA(i){return Ce.isArray(i)&&!i.some(Gh)}const MA=Ce.toFlatObject(Ce,{},null,function(e){return/^is[A-Z]/.test(e)});function Cl(i,e,n){if(!Ce.isObject(i))throw new TypeError("target must be an object");e=e||new FormData,n=Ce.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(v,h){return!Ce.isUndefined(h[v])});const o=n.metaTokens,u=n.visitor||p,g=n.dots,c=n.indexes,d=(n.Blob||typeof Blob<"u"&&Blob)&&Ce.isSpecCompliantForm(e);if(!Ce.isFunction(u))throw new TypeError("visitor must be a function");function l(R){if(R===null)return"";if(Ce.isDate(R))return R.toISOString();if(Ce.isBoolean(R))return R.toString();if(!d&&Ce.isBlob(R))throw new ct("Blob is not supported. Use a Buffer instead.");return Ce.isArrayBuffer(R)||Ce.isTypedArray(R)?d&&typeof Blob=="function"?new Blob([R]):Buffer.from(R):R}function p(R,v,h){let m=R;if(R&&!h&&typeof R=="object"){if(Ce.endsWith(v,"{}"))v=o?v:v.slice(0,-2),R=JSON.stringify(R);else if(Ce.isArray(R)&&IA(R)||(Ce.isFileList(R)||Ce.endsWith(v,"[]"))&&(m=Ce.toArray(R)))return v=ZS(v),m.forEach(function(A,E){!(Ce.isUndefined(A)||A===null)&&e.append(c===!0?My([v],E,g):c===null?v:v+"[]",l(A))}),!1}return Gh(R)?!0:(e.append(My(h,v,g),l(R)),!1)}const S=[],T=Object.assign(MA,{defaultVisitor:p,convertValue:l,isVisitable:Gh});function y(R,v){if(!Ce.isUndefined(R)){if(S.indexOf(R)!==-1)throw Error("Circular reference detected in "+v.join("."));S.push(R),Ce.forEach(R,function(m,_){(!(Ce.isUndefined(m)||m===null)&&u.call(e,m,Ce.isString(_)?_.trim():_,v,T))===!0&&y(m,v?v.concat(_):[_])}),S.pop()}}if(!Ce.isObject(i))throw new TypeError("data must be an object");return y(i),e}function Ny(i){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(i).replace(/[!'()~]|%20|%00/g,function(o){return e[o]})}function hf(i,e){this._pairs=[],i&&Cl(i,this,e)}const eb=hf.prototype;eb.append=function(e,n){this._pairs.push([e,n])};eb.toString=function(e){const n=e?function(o){return e.call(this,o,Ny)}:Ny;return this._pairs.map(function(u){return n(u[0])+"="+n(u[1])},"").join("&")};function NA(i){return encodeURIComponent(i).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function tb(i,e,n){if(!e)return i;const o=n&&n.encode||NA;Ce.isFunction(n)&&(n={serialize:n});const u=n&&n.serialize;let g;if(u?g=u(e,n):g=Ce.isURLSearchParams(e)?e.toString():new hf(e,n).toString(o),g){const c=i.indexOf("#");c!==-1&&(i=i.slice(0,c)),i+=(i.indexOf("?")===-1?"?":"&")+g}return i}class ky{constructor(){this.handlers=[]}use(e,n,o){return this.handlers.push({fulfilled:e,rejected:n,synchronous:o?o.synchronous:!1,runWhen:o?o.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Ce.forEach(this.handlers,function(o){o!==null&&e(o)})}}const ib={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},kA=typeof URLSearchParams<"u"?URLSearchParams:hf,PA=typeof FormData<"u"?FormData:null,LA=typeof Blob<"u"?Blob:null,UA={isBrowser:!0,classes:{URLSearchParams:kA,FormData:PA,Blob:LA},protocols:["http","https","file","blob","url","data"]},ff=typeof window<"u"&&typeof document<"u",Wh=typeof navigator=="object"&&navigator||void 0,xA=ff&&(!Wh||["ReactNative","NativeScript","NS"].indexOf(Wh.product)<0),BA=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",VA=ff&&window.location.href||"http://localhost",HA=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:ff,hasStandardBrowserEnv:xA,hasStandardBrowserWebWorkerEnv:BA,navigator:Wh,origin:VA},Symbol.toStringTag,{value:"Module"})),Mi={...HA,...UA};function jA(i,e){return Cl(i,new Mi.classes.URLSearchParams,{visitor:function(n,o,u,g){return Mi.isNode&&Ce.isBuffer(n)?(this.append(o,n.toString("base64")),!1):g.defaultVisitor.apply(this,arguments)},...e})}function zA(i){return Ce.matchAll(/\w+|\[(\w*)]/g,i).map(e=>e[0]==="[]"?"":e[1]||e[0])}function FA(i){const e={},n=Object.keys(i);let o;const u=n.length;let g;for(o=0;o<u;o++)g=n[o],e[g]=i[g];return e}function rb(i){function e(n,o,u,g){let c=n[g++];if(c==="__proto__")return!0;const s=Number.isFinite(+c),d=g>=n.length;return c=!c&&Ce.isArray(u)?u.length:c,d?(Ce.hasOwnProp(u,c)?u[c]=[u[c],o]:u[c]=o,!s):((!u[c]||!Ce.isObject(u[c]))&&(u[c]=[]),e(n,o,u[c],g)&&Ce.isArray(u[c])&&(u[c]=FA(u[c])),!s)}if(Ce.isFormData(i)&&Ce.isFunction(i.entries)){const n={};return Ce.forEachEntry(i,(o,u)=>{e(zA(o),u,n,0)}),n}return null}function GA(i,e,n){if(Ce.isString(i))try{return(e||JSON.parse)(i),Ce.trim(i)}catch(o){if(o.name!=="SyntaxError")throw o}return(n||JSON.stringify)(i)}const ws={transitional:ib,adapter:["xhr","http","fetch"],transformRequest:[function(e,n){const o=n.getContentType()||"",u=o.indexOf("application/json")>-1,g=Ce.isObject(e);if(g&&Ce.isHTMLForm(e)&&(e=new FormData(e)),Ce.isFormData(e))return u?JSON.stringify(rb(e)):e;if(Ce.isArrayBuffer(e)||Ce.isBuffer(e)||Ce.isStream(e)||Ce.isFile(e)||Ce.isBlob(e)||Ce.isReadableStream(e))return e;if(Ce.isArrayBufferView(e))return e.buffer;if(Ce.isURLSearchParams(e))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(g){if(o.indexOf("application/x-www-form-urlencoded")>-1)return jA(e,this.formSerializer).toString();if((s=Ce.isFileList(e))||o.indexOf("multipart/form-data")>-1){const d=this.env&&this.env.FormData;return Cl(s?{"files[]":e}:e,d&&new d,this.formSerializer)}}return g||u?(n.setContentType("application/json",!1),GA(e)):e}],transformResponse:[function(e){const n=this.transitional||ws.transitional,o=n&&n.forcedJSONParsing,u=this.responseType==="json";if(Ce.isResponse(e)||Ce.isReadableStream(e))return e;if(e&&Ce.isString(e)&&(o&&!this.responseType||u)){const c=!(n&&n.silentJSONParsing)&&u;try{return JSON.parse(e,this.parseReviver)}catch(s){if(c)throw s.name==="SyntaxError"?ct.from(s,ct.ERR_BAD_RESPONSE,this,null,this.response):s}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Mi.classes.FormData,Blob:Mi.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ce.forEach(["delete","get","head","post","put","patch"],i=>{ws.headers[i]={}});const WA=Ce.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),qA=i=>{const e={};let n,o,u;return i&&i.split(`
`).forEach(function(c){u=c.indexOf(":"),n=c.substring(0,u).trim().toLowerCase(),o=c.substring(u+1).trim(),!(!n||e[n]&&WA[n])&&(n==="set-cookie"?e[n]?e[n].push(o):e[n]=[o]:e[n]=e[n]?e[n]+", "+o:o)}),e},Py=Symbol("internals");function us(i){return i&&String(i).trim().toLowerCase()}function ol(i){return i===!1||i==null?i:Ce.isArray(i)?i.map(ol):String(i)}function KA(i){const e=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let o;for(;o=n.exec(i);)e[o[1]]=o[2];return e}const YA=i=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(i.trim());function Rh(i,e,n,o,u){if(Ce.isFunction(o))return o.call(this,e,n);if(u&&(e=n),!!Ce.isString(e)){if(Ce.isString(o))return e.indexOf(o)!==-1;if(Ce.isRegExp(o))return o.test(e)}}function XA(i){return i.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,n,o)=>n.toUpperCase()+o)}function JA(i,e){const n=Ce.toCamelCase(" "+e);["get","set","has"].forEach(o=>{Object.defineProperty(i,o+n,{value:function(u,g,c){return this[o].call(this,e,u,g,c)},configurable:!0})})}let Yi=class{constructor(e){e&&this.set(e)}set(e,n,o){const u=this;function g(s,d,l){const p=us(d);if(!p)throw new Error("header name must be a non-empty string");const S=Ce.findKey(u,p);(!S||u[S]===void 0||l===!0||l===void 0&&u[S]!==!1)&&(u[S||d]=ol(s))}const c=(s,d)=>Ce.forEach(s,(l,p)=>g(l,p,d));if(Ce.isPlainObject(e)||e instanceof this.constructor)c(e,n);else if(Ce.isString(e)&&(e=e.trim())&&!YA(e))c(qA(e),n);else if(Ce.isObject(e)&&Ce.isIterable(e)){let s={},d,l;for(const p of e){if(!Ce.isArray(p))throw TypeError("Object iterator must return a key-value pair");s[l=p[0]]=(d=s[l])?Ce.isArray(d)?[...d,p[1]]:[d,p[1]]:p[1]}c(s,n)}else e!=null&&g(n,e,o);return this}get(e,n){if(e=us(e),e){const o=Ce.findKey(this,e);if(o){const u=this[o];if(!n)return u;if(n===!0)return KA(u);if(Ce.isFunction(n))return n.call(this,u,o);if(Ce.isRegExp(n))return n.exec(u);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=us(e),e){const o=Ce.findKey(this,e);return!!(o&&this[o]!==void 0&&(!n||Rh(this,this[o],o,n)))}return!1}delete(e,n){const o=this;let u=!1;function g(c){if(c=us(c),c){const s=Ce.findKey(o,c);s&&(!n||Rh(o,o[s],s,n))&&(delete o[s],u=!0)}}return Ce.isArray(e)?e.forEach(g):g(e),u}clear(e){const n=Object.keys(this);let o=n.length,u=!1;for(;o--;){const g=n[o];(!e||Rh(this,this[g],g,e,!0))&&(delete this[g],u=!0)}return u}normalize(e){const n=this,o={};return Ce.forEach(this,(u,g)=>{const c=Ce.findKey(o,g);if(c){n[c]=ol(u),delete n[g];return}const s=e?XA(g):String(g).trim();s!==g&&delete n[g],n[s]=ol(u),o[s]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const n=Object.create(null);return Ce.forEach(this,(o,u)=>{o!=null&&o!==!1&&(n[u]=e&&Ce.isArray(o)?o.join(", "):o)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,n])=>e+": "+n).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...n){const o=new this(e);return n.forEach(u=>o.set(u)),o}static accessor(e){const o=(this[Py]=this[Py]={accessors:{}}).accessors,u=this.prototype;function g(c){const s=us(c);o[s]||(JA(u,c),o[s]=!0)}return Ce.isArray(e)?e.forEach(g):g(e),this}};Yi.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Ce.reduceDescriptors(Yi.prototype,({value:i},e)=>{let n=e[0].toUpperCase()+e.slice(1);return{get:()=>i,set(o){this[n]=o}}});Ce.freezeMethods(Yi);function _h(i,e){const n=this||ws,o=e||n,u=Yi.from(o.headers);let g=o.data;return Ce.forEach(i,function(s){g=s.call(n,g,u.normalize(),e?e.status:void 0)}),u.normalize(),g}function nb(i){return!!(i&&i.__CANCEL__)}function ma(i,e,n){ct.call(this,i??"canceled",ct.ERR_CANCELED,e,n),this.name="CanceledError"}Ce.inherits(ma,ct,{__CANCEL__:!0});function ob(i,e,n){const o=n.config.validateStatus;!n.status||!o||o(n.status)?i(n):e(new ct("Request failed with status code "+n.status,[ct.ERR_BAD_REQUEST,ct.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function QA(i){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(i);return e&&e[1]||""}function $A(i,e){i=i||10;const n=new Array(i),o=new Array(i);let u=0,g=0,c;return e=e!==void 0?e:1e3,function(d){const l=Date.now(),p=o[g];c||(c=l),n[u]=d,o[u]=l;let S=g,T=0;for(;S!==u;)T+=n[S++],S=S%i;if(u=(u+1)%i,u===g&&(g=(g+1)%i),l-c<e)return;const y=p&&l-p;return y?Math.round(T*1e3/y):void 0}}function ZA(i,e){let n=0,o=1e3/e,u,g;const c=(l,p=Date.now())=>{n=p,u=null,g&&(clearTimeout(g),g=null),i(...l)};return[(...l)=>{const p=Date.now(),S=p-n;S>=o?c(l,p):(u=l,g||(g=setTimeout(()=>{g=null,c(u)},o-S)))},()=>u&&c(u)]}const ml=(i,e,n=3)=>{let o=0;const u=$A(50,250);return ZA(g=>{const c=g.loaded,s=g.lengthComputable?g.total:void 0,d=c-o,l=u(d),p=c<=s;o=c;const S={loaded:c,total:s,progress:s?c/s:void 0,bytes:d,rate:l||void 0,estimated:l&&s&&p?(s-c)/l:void 0,event:g,lengthComputable:s!=null,[e?"download":"upload"]:!0};i(S)},n)},Ly=(i,e)=>{const n=i!=null;return[o=>e[0]({lengthComputable:n,total:i,loaded:o}),e[1]]},Uy=i=>(...e)=>Ce.asap(()=>i(...e)),eC=Mi.hasStandardBrowserEnv?((i,e)=>n=>(n=new URL(n,Mi.origin),i.protocol===n.protocol&&i.host===n.host&&(e||i.port===n.port)))(new URL(Mi.origin),Mi.navigator&&/(msie|trident)/i.test(Mi.navigator.userAgent)):()=>!0,tC=Mi.hasStandardBrowserEnv?{write(i,e,n,o,u,g,c){if(typeof document>"u")return;const s=[`${i}=${encodeURIComponent(e)}`];Ce.isNumber(n)&&s.push(`expires=${new Date(n).toUTCString()}`),Ce.isString(o)&&s.push(`path=${o}`),Ce.isString(u)&&s.push(`domain=${u}`),g===!0&&s.push("secure"),Ce.isString(c)&&s.push(`SameSite=${c}`),document.cookie=s.join("; ")},read(i){if(typeof document>"u")return null;const e=document.cookie.match(new RegExp("(?:^|; )"+i+"=([^;]*)"));return e?decodeURIComponent(e[1]):null},remove(i){this.write(i,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function iC(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}function rC(i,e){return e?i.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):i}function ab(i,e,n){let o=!iC(e);return i&&(o||n==!1)?rC(i,e):e}const xy=i=>i instanceof Yi?{...i}:i;function yo(i,e){e=e||{};const n={};function o(l,p,S,T){return Ce.isPlainObject(l)&&Ce.isPlainObject(p)?Ce.merge.call({caseless:T},l,p):Ce.isPlainObject(p)?Ce.merge({},p):Ce.isArray(p)?p.slice():p}function u(l,p,S,T){if(Ce.isUndefined(p)){if(!Ce.isUndefined(l))return o(void 0,l,S,T)}else return o(l,p,S,T)}function g(l,p){if(!Ce.isUndefined(p))return o(void 0,p)}function c(l,p){if(Ce.isUndefined(p)){if(!Ce.isUndefined(l))return o(void 0,l)}else return o(void 0,p)}function s(l,p,S){if(S in e)return o(l,p);if(S in i)return o(void 0,l)}const d={url:g,method:g,data:g,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,withXSRFToken:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,beforeRedirect:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:s,headers:(l,p,S)=>u(xy(l),xy(p),S,!0)};return Ce.forEach(Object.keys({...i,...e}),function(p){const S=d[p]||u,T=S(i[p],e[p],p);Ce.isUndefined(T)&&S!==s||(n[p]=T)}),n}const sb=i=>{const e=yo({},i);let{data:n,withXSRFToken:o,xsrfHeaderName:u,xsrfCookieName:g,headers:c,auth:s}=e;if(e.headers=c=Yi.from(c),e.url=tb(ab(e.baseURL,e.url,e.allowAbsoluteUrls),i.params,i.paramsSerializer),s&&c.set("Authorization","Basic "+btoa((s.username||"")+":"+(s.password?unescape(encodeURIComponent(s.password)):""))),Ce.isFormData(n)){if(Mi.hasStandardBrowserEnv||Mi.hasStandardBrowserWebWorkerEnv)c.setContentType(void 0);else if(Ce.isFunction(n.getHeaders)){const d=n.getHeaders(),l=["content-type","content-length"];Object.entries(d).forEach(([p,S])=>{l.includes(p.toLowerCase())&&c.set(p,S)})}}if(Mi.hasStandardBrowserEnv&&(o&&Ce.isFunction(o)&&(o=o(e)),o||o!==!1&&eC(e.url))){const d=u&&g&&tC.read(g);d&&c.set(u,d)}return e},nC=typeof XMLHttpRequest<"u",oC=nC&&function(i){return new Promise(function(n,o){const u=sb(i);let g=u.data;const c=Yi.from(u.headers).normalize();let{responseType:s,onUploadProgress:d,onDownloadProgress:l}=u,p,S,T,y,R;function v(){y&&y(),R&&R(),u.cancelToken&&u.cancelToken.unsubscribe(p),u.signal&&u.signal.removeEventListener("abort",p)}let h=new XMLHttpRequest;h.open(u.method.toUpperCase(),u.url,!0),h.timeout=u.timeout;function m(){if(!h)return;const A=Yi.from("getAllResponseHeaders"in h&&h.getAllResponseHeaders()),b={data:!s||s==="text"||s==="json"?h.responseText:h.response,status:h.status,statusText:h.statusText,headers:A,config:i,request:h};ob(function(C){n(C),v()},function(C){o(C),v()},b),h=null}"onloadend"in h?h.onloadend=m:h.onreadystatechange=function(){!h||h.readyState!==4||h.status===0&&!(h.responseURL&&h.responseURL.indexOf("file:")===0)||setTimeout(m)},h.onabort=function(){h&&(o(new ct("Request aborted",ct.ECONNABORTED,i,h)),h=null)},h.onerror=function(E){const b=E&&E.message?E.message:"Network Error",w=new ct(b,ct.ERR_NETWORK,i,h);w.event=E||null,o(w),h=null},h.ontimeout=function(){let E=u.timeout?"timeout of "+u.timeout+"ms exceeded":"timeout exceeded";const b=u.transitional||ib;u.timeoutErrorMessage&&(E=u.timeoutErrorMessage),o(new ct(E,b.clarifyTimeoutError?ct.ETIMEDOUT:ct.ECONNABORTED,i,h)),h=null},g===void 0&&c.setContentType(null),"setRequestHeader"in h&&Ce.forEach(c.toJSON(),function(E,b){h.setRequestHeader(b,E)}),Ce.isUndefined(u.withCredentials)||(h.withCredentials=!!u.withCredentials),s&&s!=="json"&&(h.responseType=u.responseType),l&&([T,R]=ml(l,!0),h.addEventListener("progress",T)),d&&h.upload&&([S,y]=ml(d),h.upload.addEventListener("progress",S),h.upload.addEventListener("loadend",y)),(u.cancelToken||u.signal)&&(p=A=>{h&&(o(!A||A.type?new ma(null,i,h):A),h.abort(),h=null)},u.cancelToken&&u.cancelToken.subscribe(p),u.signal&&(u.signal.aborted?p():u.signal.addEventListener("abort",p)));const _=QA(u.url);if(_&&Mi.protocols.indexOf(_)===-1){o(new ct("Unsupported protocol "+_+":",ct.ERR_BAD_REQUEST,i));return}h.send(g||null)})},aC=(i,e)=>{const{length:n}=i=i?i.filter(Boolean):[];if(e||n){let o=new AbortController,u;const g=function(l){if(!u){u=!0,s();const p=l instanceof Error?l:this.reason;o.abort(p instanceof ct?p:new ma(p instanceof Error?p.message:p))}};let c=e&&setTimeout(()=>{c=null,g(new ct(`timeout ${e} of ms exceeded`,ct.ETIMEDOUT))},e);const s=()=>{i&&(c&&clearTimeout(c),c=null,i.forEach(l=>{l.unsubscribe?l.unsubscribe(g):l.removeEventListener("abort",g)}),i=null)};i.forEach(l=>l.addEventListener("abort",g));const{signal:d}=o;return d.unsubscribe=()=>Ce.asap(s),d}},sC=function*(i,e){let n=i.byteLength;if(n<e){yield i;return}let o=0,u;for(;o<n;)u=o+e,yield i.slice(o,u),o=u},cC=async function*(i,e){for await(const n of lC(i))yield*sC(n,e)},lC=async function*(i){if(i[Symbol.asyncIterator]){yield*i;return}const e=i.getReader();try{for(;;){const{done:n,value:o}=await e.read();if(n)break;yield o}}finally{await e.cancel()}},By=(i,e,n,o)=>{const u=cC(i,e);let g=0,c,s=d=>{c||(c=!0,o&&o(d))};return new ReadableStream({async pull(d){try{const{done:l,value:p}=await u.next();if(l){s(),d.close();return}let S=p.byteLength;if(n){let T=g+=S;n(T)}d.enqueue(new Uint8Array(p))}catch(l){throw s(l),l}},cancel(d){return s(d),u.return()}},{highWaterMark:2})},Vy=64*1024,{isFunction:Yc}=Ce,uC=(({Request:i,Response:e})=>({Request:i,Response:e}))(Ce.global),{ReadableStream:Hy,TextEncoder:jy}=Ce.global,zy=(i,...e)=>{try{return!!i(...e)}catch{return!1}},dC=i=>{i=Ce.merge.call({skipUndefined:!0},uC,i);const{fetch:e,Request:n,Response:o}=i,u=e?Yc(e):typeof fetch=="function",g=Yc(n),c=Yc(o);if(!u)return!1;const s=u&&Yc(Hy),d=u&&(typeof jy=="function"?(R=>v=>R.encode(v))(new jy):async R=>new Uint8Array(await new n(R).arrayBuffer())),l=g&&s&&zy(()=>{let R=!1;const v=new n(Mi.origin,{body:new Hy,method:"POST",get duplex(){return R=!0,"half"}}).headers.has("Content-Type");return R&&!v}),p=c&&s&&zy(()=>Ce.isReadableStream(new o("").body)),S={stream:p&&(R=>R.body)};u&&["text","arrayBuffer","blob","formData","stream"].forEach(R=>{!S[R]&&(S[R]=(v,h)=>{let m=v&&v[R];if(m)return m.call(v);throw new ct(`Response type '${R}' is not supported`,ct.ERR_NOT_SUPPORT,h)})});const T=async R=>{if(R==null)return 0;if(Ce.isBlob(R))return R.size;if(Ce.isSpecCompliantForm(R))return(await new n(Mi.origin,{method:"POST",body:R}).arrayBuffer()).byteLength;if(Ce.isArrayBufferView(R)||Ce.isArrayBuffer(R))return R.byteLength;if(Ce.isURLSearchParams(R)&&(R=R+""),Ce.isString(R))return(await d(R)).byteLength},y=async(R,v)=>{const h=Ce.toFiniteNumber(R.getContentLength());return h??T(v)};return async R=>{let{url:v,method:h,data:m,signal:_,cancelToken:A,timeout:E,onDownloadProgress:b,onUploadProgress:w,responseType:C,headers:P,withCredentials:U="same-origin",fetchOptions:B}=sb(R),L=e||fetch;C=C?(C+"").toLowerCase():"text";let H=aC([_,A&&A.toAbortSignal()],E),O=null;const x=H&&H.unsubscribe&&(()=>{H.unsubscribe()});let F;try{if(w&&l&&h!=="get"&&h!=="head"&&(F=await y(P,m))!==0){let z=new n(v,{method:"POST",body:m,duplex:"half"}),V;if(Ce.isFormData(m)&&(V=z.headers.get("content-type"))&&P.setContentType(V),z.body){const[re,Q]=Ly(F,ml(Uy(w)));m=By(z.body,Vy,re,Q)}}Ce.isString(U)||(U=U?"include":"omit");const N=g&&"credentials"in n.prototype,k={...B,signal:H,method:h.toUpperCase(),headers:P.normalize().toJSON(),body:m,duplex:"half",credentials:N?U:void 0};O=g&&new n(v,k);let M=await(g?L(O,B):L(v,k));const j=p&&(C==="stream"||C==="response");if(p&&(b||j&&x)){const z={};["status","statusText","headers"].forEach(Z=>{z[Z]=M[Z]});const V=Ce.toFiniteNumber(M.headers.get("content-length")),[re,Q]=b&&Ly(V,ml(Uy(b),!0))||[];M=new o(By(M.body,Vy,re,()=>{Q&&Q(),x&&x()}),z)}C=C||"text";let G=await S[Ce.findKey(S,C)||"text"](M,R);return!j&&x&&x(),await new Promise((z,V)=>{ob(z,V,{data:G,headers:Yi.from(M.headers),status:M.status,statusText:M.statusText,config:R,request:O})})}catch(N){throw x&&x(),N&&N.name==="TypeError"&&/Load failed|fetch/i.test(N.message)?Object.assign(new ct("Network Error",ct.ERR_NETWORK,R,O),{cause:N.cause||N}):ct.from(N,N&&N.code,R,O)}}},hC=new Map,cb=i=>{let e=i&&i.env||{};const{fetch:n,Request:o,Response:u}=e,g=[o,u,n];let c=g.length,s=c,d,l,p=hC;for(;s--;)d=g[s],l=p.get(d),l===void 0&&p.set(d,l=s?new Map:dC(e)),p=l;return l};cb();const pf={http:OA,xhr:oC,fetch:{get:cb}};Ce.forEach(pf,(i,e)=>{if(i){try{Object.defineProperty(i,"name",{value:e})}catch{}Object.defineProperty(i,"adapterName",{value:e})}});const Fy=i=>`- ${i}`,fC=i=>Ce.isFunction(i)||i===null||i===!1;function pC(i,e){i=Ce.isArray(i)?i:[i];const{length:n}=i;let o,u;const g={};for(let c=0;c<n;c++){o=i[c];let s;if(u=o,!fC(o)&&(u=pf[(s=String(o)).toLowerCase()],u===void 0))throw new ct(`Unknown adapter '${s}'`);if(u&&(Ce.isFunction(u)||(u=u.get(e))))break;g[s||"#"+c]=u}if(!u){const c=Object.entries(g).map(([d,l])=>`adapter ${d} `+(l===!1?"is not supported by the environment":"is not available in the build"));let s=n?c.length>1?`since :
`+c.map(Fy).join(`
`):" "+Fy(c[0]):"as no adapter specified";throw new ct("There is no suitable adapter to dispatch the request "+s,"ERR_NOT_SUPPORT")}return u}const lb={getAdapter:pC,adapters:pf};function Th(i){if(i.cancelToken&&i.cancelToken.throwIfRequested(),i.signal&&i.signal.aborted)throw new ma(null,i)}function Gy(i){return Th(i),i.headers=Yi.from(i.headers),i.data=_h.call(i,i.transformRequest),["post","put","patch"].indexOf(i.method)!==-1&&i.headers.setContentType("application/x-www-form-urlencoded",!1),lb.getAdapter(i.adapter||ws.adapter,i)(i).then(function(o){return Th(i),o.data=_h.call(i,i.transformResponse,o),o.headers=Yi.from(o.headers),o},function(o){return nb(o)||(Th(i),o&&o.response&&(o.response.data=_h.call(i,i.transformResponse,o.response),o.response.headers=Yi.from(o.response.headers))),Promise.reject(o)})}const ub="1.13.2",wl={};["object","boolean","number","function","string","symbol"].forEach((i,e)=>{wl[i]=function(o){return typeof o===i||"a"+(e<1?"n ":" ")+i}});const Wy={};wl.transitional=function(e,n,o){function u(g,c){return"[Axios v"+ub+"] Transitional option '"+g+"'"+c+(o?". "+o:"")}return(g,c,s)=>{if(e===!1)throw new ct(u(c," has been removed"+(n?" in "+n:"")),ct.ERR_DEPRECATED);return n&&!Wy[c]&&(Wy[c]=!0,console.warn(u(c," has been deprecated since v"+n+" and will be removed in the near future"))),e?e(g,c,s):!0}};wl.spelling=function(e){return(n,o)=>(console.warn(`${o} is likely a misspelling of ${e}`),!0)};function mC(i,e,n){if(typeof i!="object")throw new ct("options must be an object",ct.ERR_BAD_OPTION_VALUE);const o=Object.keys(i);let u=o.length;for(;u-- >0;){const g=o[u],c=e[g];if(c){const s=i[g],d=s===void 0||c(s,g,i);if(d!==!0)throw new ct("option "+g+" must be "+d,ct.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new ct("Unknown option "+g,ct.ERR_BAD_OPTION)}}const al={assertOptions:mC,validators:wl},Lr=al.validators;let vo=class{constructor(e){this.defaults=e||{},this.interceptors={request:new ky,response:new ky}}async request(e,n){try{return await this._request(e,n)}catch(o){if(o instanceof Error){let u={};Error.captureStackTrace?Error.captureStackTrace(u):u=new Error;const g=u.stack?u.stack.replace(/^.+\n/,""):"";try{o.stack?g&&!String(o.stack).endsWith(g.replace(/^.+\n.+\n/,""))&&(o.stack+=`
`+g):o.stack=g}catch{}}throw o}}_request(e,n){typeof e=="string"?(n=n||{},n.url=e):n=e||{},n=yo(this.defaults,n);const{transitional:o,paramsSerializer:u,headers:g}=n;o!==void 0&&al.assertOptions(o,{silentJSONParsing:Lr.transitional(Lr.boolean),forcedJSONParsing:Lr.transitional(Lr.boolean),clarifyTimeoutError:Lr.transitional(Lr.boolean)},!1),u!=null&&(Ce.isFunction(u)?n.paramsSerializer={serialize:u}:al.assertOptions(u,{encode:Lr.function,serialize:Lr.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),al.assertOptions(n,{baseUrl:Lr.spelling("baseURL"),withXsrfToken:Lr.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let c=g&&Ce.merge(g.common,g[n.method]);g&&Ce.forEach(["delete","get","head","post","put","patch","common"],R=>{delete g[R]}),n.headers=Yi.concat(c,g);const s=[];let d=!0;this.interceptors.request.forEach(function(v){typeof v.runWhen=="function"&&v.runWhen(n)===!1||(d=d&&v.synchronous,s.unshift(v.fulfilled,v.rejected))});const l=[];this.interceptors.response.forEach(function(v){l.push(v.fulfilled,v.rejected)});let p,S=0,T;if(!d){const R=[Gy.bind(this),void 0];for(R.unshift(...s),R.push(...l),T=R.length,p=Promise.resolve(n);S<T;)p=p.then(R[S++],R[S++]);return p}T=s.length;let y=n;for(;S<T;){const R=s[S++],v=s[S++];try{y=R(y)}catch(h){v.call(this,h);break}}try{p=Gy.call(this,y)}catch(R){return Promise.reject(R)}for(S=0,T=l.length;S<T;)p=p.then(l[S++],l[S++]);return p}getUri(e){e=yo(this.defaults,e);const n=ab(e.baseURL,e.url,e.allowAbsoluteUrls);return tb(n,e.params,e.paramsSerializer)}};Ce.forEach(["delete","get","head","options"],function(e){vo.prototype[e]=function(n,o){return this.request(yo(o||{},{method:e,url:n,data:(o||{}).data}))}});Ce.forEach(["post","put","patch"],function(e){function n(o){return function(g,c,s){return this.request(yo(s||{},{method:e,headers:o?{"Content-Type":"multipart/form-data"}:{},url:g,data:c}))}}vo.prototype[e]=n(),vo.prototype[e+"Form"]=n(!0)});let gC=class db{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(g){n=g});const o=this;this.promise.then(u=>{if(!o._listeners)return;let g=o._listeners.length;for(;g-- >0;)o._listeners[g](u);o._listeners=null}),this.promise.then=u=>{let g;const c=new Promise(s=>{o.subscribe(s),g=s}).then(u);return c.cancel=function(){o.unsubscribe(g)},c},e(function(g,c,s){o.reason||(o.reason=new ma(g,c,s),n(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=o=>{e.abort(o)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new db(function(u){e=u}),cancel:e}}};function vC(i){return function(n){return i.apply(null,n)}}function yC(i){return Ce.isObject(i)&&i.isAxiosError===!0}const qh={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(qh).forEach(([i,e])=>{qh[e]=i});function hb(i){const e=new vo(i),n=FS(vo.prototype.request,e);return Ce.extend(n,vo.prototype,e,{allOwnKeys:!0}),Ce.extend(n,e,null,{allOwnKeys:!0}),n.create=function(u){return hb(yo(i,u))},n}const ri=hb(ws);ri.Axios=vo;ri.CanceledError=ma;ri.CancelToken=gC;ri.isCancel=nb;ri.VERSION=ub;ri.toFormData=Cl;ri.AxiosError=ct;ri.Cancel=ri.CanceledError;ri.all=function(e){return Promise.all(e)};ri.spread=vC;ri.isAxiosError=yC;ri.mergeConfig=yo;ri.AxiosHeaders=Yi;ri.formToJSON=i=>rb(Ce.isHTMLForm(i)?new FormData(i):i);ri.getAdapter=lb.getAdapter;ri.HttpStatusCode=qh;ri.default=ri;const{Axios:DC,AxiosError:OC,CanceledError:IC,isCancel:MC,CancelToken:NC,VERSION:kC,all:PC,Cancel:LC,isAxiosError:UC,spread:xC,toFormData:BC,AxiosHeaders:VC,HttpStatusCode:HC,formToJSON:jC,getAdapter:zC,mergeConfig:FC}=ri,SC=()=>`https://${window.location.hostname}:3000`,bC=SC(),fb=ri.create({baseURL:bC,timeout:15e3});async function EC(i,e,n){return(await fb.post("/api/agent-accept-call",{sessionId:i,agentId:e,region:n})).data}async function RC(i){return(await fb.get(`/api/session-history/${i}`)).data}const _C=()=>{const[i,e]=ot.useState(null),[n,o]=ot.useState(!1),[u,g]=ot.useState(null),[c,s]=ot.useState("idle"),[d,l]=ot.useState(null),[p,S]=ot.useState(!1),T=ot.useRef(null),y=ot.useRef(0),R=ot.useCallback(()=>{if(!T.current)return;const b=T.current;b.on("bye",()=>{s("ending")}),b.on("authInfoExpired",()=>{l("RTC "),s("error")}),b.on("authInfoWillExpire",()=>{l("RTC ")})},[]),v=ot.useCallback(async()=>{if(!T.current){s("idle");return}const b=++y.current;s("ending");try{await T.current.stopPreview(),await T.current.leaveChannel(),T.current.destroy()}catch(w){y.current===b&&(l(w instanceof Error?w.message:"RTC "),s("error"));return}y.current===b&&(T.current=null,s("idle"))},[]),h=ot.useCallback(async b=>{const w=++y.current;if(l(null),s("starting"),!(await Oy.isSupported()).support){s("error"),l(" RTC");return}T.current=Oy.getInstance(),R(),T.current.on("onRemoteUserOnLineNotify",P=>{console.log("[RTC] Remote user joined:",P),T.current?.subscribe(P).catch(U=>{console.error("[RTC] Failed to subscribe remote user:",U)})}),T.current.on("onError",P=>{console.error("[RTC] Error occurred:",P),l(P.message||"RTC ")});try{console.log("[RTC] Joining independent channel:",{channelId:b.channelId,rtcUserId:b.rtcUserId,rtcAppId:b.rtcAppId,rtcTimestamp:b.rtcTimestamp}),await T.current.joinChannel({appId:b.rtcAppId,channelId:b.channelId,userId:b.rtcUserId,token:b.rtcToken,timestamp:b.rtcTimestamp,nonce:b.rtcNonce||""}),console.log("[RTC] Channel joined successfully");try{await T.current.startPreview(),console.log("[RTC] Local preview started")}catch(P){console.warn("[RTC] Start preview failed (may be normal):",P)}y.current===w&&(s("joined"),console.log("[RTC] Successfully joined channel, audio should be publishing automatically"))}catch(P){y.current===w&&(s("error"),l(P instanceof Error?P.message:"RTC "),console.error("[RTC] Failed to join channel:",P))}},[R]),m=ot.useCallback(async(b,w,C)=>{o(!0),g(null);try{const P=await EC(b,w,C);if(!P.success||!P.data)throw new Error(P.message||"");return e(P.data),P.data}catch(P){const U=P instanceof Error?P.message:"";throw g(U),P}finally{o(!1)}},[]),_=ot.useCallback(async b=>{const w=await RC(b);if(!w.success||!w.data)throw new Error(w.message||"");return w.data},[]),A=ot.useCallback(()=>{e(null)},[]),E=ot.useCallback(async()=>{if(!T.current||c!=="joined"){console.warn("[RTC] Cannot toggle mute: engine not ready or not joined");return}try{const b=!p;await T.current.muteLocalMic(b),S(b),console.log(`[RTC] Microphone ${b?"muted":"unmuted"}`)}catch(b){console.error("[RTC] Failed to toggle mute:",b),l(b instanceof Error?b.message:"")}},[p,c]);return ot.useEffect(()=>{if(!i){v();return}h(i)},[i,h,v]),ot.useEffect(()=>()=>{v()},[v]),{activeCall:i,loading:n,error:u,rtcStatus:c,rtcError:d,isMuted:p,toggleMute:E,acceptCall:m,loadSessionHistory:_,endCall:A}};function TC(){const[i,e]=ot.useState("agent-001"),[n,o]=ot.useState("1"),[u,g]=ot.useState([]),{connected:c,agentInfo:s,statusLabel:d,agentStatus:l,pendingSessions:p,events:S,lastEndedSessionId:T,connectAgent:y,disconnect:R,updateStatus:v,acceptSession:h,rejectSession:m,hangupSession:_}=xR(),{activeCall:A,loading:E,error:b,rtcStatus:w,rtcError:C,isMuted:P,toggleMute:U,acceptCall:B,loadSessionHistory:L,endCall:H}=_C(),O=ot.useMemo(()=>s?.agentId||i,[s,i]),x=()=>{i.trim()&&y({agentId:i,name:n||""})},F=async j=>{if(O){h(j);try{const G=await B(j,O);if(console.log("[Agent] Accept call result:",{sessionId:j,hasConversationHistory:!!G.conversationHistory,conversationHistoryCount:G.conversationHistory?.length||0,conversationHistory:G.conversationHistory}),G.conversationHistory&&G.conversationHistory.length>0)console.log("[Agent] Setting history from accept result"),g(G.conversationHistory);else{console.log("[Agent] No history in result, fetching from API...");const z=await L(j);console.log("[Agent] Session history from API:",z),g(z.conversationHistory||[])}v("busy")}catch(G){console.error("[Agent] Accept error:",G);return}}},N=j=>{m(j,""),v("online")},k=()=>{A?.sessionId&&_(A.sessionId),H(),v("online")},M=ot.useCallback(()=>{H(),v("online")},[H,v]);return ot.useEffect(()=>{!A?.sessionId||!T||A.sessionId===T&&M()},[A?.sessionId,M,T]),Ge.jsxs("div",{children:[Ge.jsx("h1",{children:""}),Ge.jsxs("section",{children:[Ge.jsxs("label",{children:["ID",Ge.jsx("input",{value:i,onChange:j=>e(j.target.value),disabled:c})]}),Ge.jsxs("label",{children:["",Ge.jsx("input",{value:n,onChange:j=>o(j.target.value),disabled:c})]})]}),Ge.jsx(U1,{connected:c,agentInfo:s,statusLabel:d,agentStatus:l,onConnect:x,onDisconnect:R,onStatusChange:v}),b&&Ge.jsxs("p",{children:[": ",b]}),C&&Ge.jsxs("p",{children:["RTC: ",C]}),Ge.jsxs("p",{children:["RTC : ",w]}),E&&Ge.jsx("p",{children:"..."}),Ge.jsx(x1,{sessions:p,onAccept:F,onReject:N}),Ge.jsx(B1,{activeCall:A,history:u,isMuted:P,rtcStatus:w,onHangup:k,onToggleMute:U}),Ge.jsxs("section",{children:[Ge.jsx("h3",{children:""}),Ge.jsx("ul",{children:S.map((j,G)=>Ge.jsx("li",{children:j},`${j}-${G}`))})]})]})}L1.createRoot(document.getElementById("root")).render(Ge.jsx(ot.StrictMode,{children:Ge.jsx(TC,{})}));
